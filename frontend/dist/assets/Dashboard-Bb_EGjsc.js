import{j as jsxRuntimeExports,a as useUserRole,b as useProfileInfo,u as useAuthStore}from"./index-67lOYeQn.js";import{g as getDefaultExportFromCjs,d as commonjsGlobal,r as reactExports,a as React}from"./vendor-CytKP1XG.js";import{C as CreateSessionModal}from"./CreateSessionModal-c5Wfvj6q.js";import{A as AnimatePresence,m as motion,X,v as Phone,w as MicOff,x as Mic,y as VideoOff,V as Video,z as PhoneOff,D as Plus,g as Calendar,T as TrendingUp,I as Clock,h as Users,l as Award,p as ArrowRight,G as Gamepad2,j as BarChart3}from"./ui-B9NvKoMF.js";import"./router-RO4D7ex0.js";import"./charts-DqeNaFAB.js";var AgoraRTC_NProduction={exports:{}};(function(s,o){(function(l,p){s.exports=p()})(commonjsGlobal,function(){function l(e,r){return r.forEach(function(i){i&&typeof i!="string"&&!Array.isArray(i)&&Object.keys(i).forEach(function(d){if(d!=="default"&&!(d in e)){var h=Object.getOwnPropertyDescriptor(i,d);Object.defineProperty(e,d,h.get?h:{enumerable:!0,get:function(){return i[d]}})}})}),Object.freeze(e)}var p=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{};function _(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var A=function(e){try{return!!e()}catch{return!0}},k=!A(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),j=k,B=Function.prototype,z=B.call,Vt=j&&B.bind.bind(z,z),_e=j?Vt:function(e){return function(){return z.apply(e,arguments)}},_n=_e({}.isPrototypeOf),_o=function(e){return e&&e.Math===Math&&e},_c=_o(typeof globalThis=="object"&&globalThis)||_o(typeof window=="object"&&window)||_o(typeof self=="object"&&self)||_o(typeof p=="object"&&p)||_o(typeof p=="object"&&p)||function(){return this}()||Function("return this")(),_d=k,_h=Function.prototype,_p=_h.apply,_f=_h.call,e_=typeof Reflect=="object"&&Reflect.apply||(_d?_f.bind(_p):function(){return _f.apply(_p,arguments)}),u_=_e,w_=u_({}.toString),O_=u_("".slice),y_=function(e){return O_(w_(e),8,-1)},Z_=y_,NE=_e,i_=function(e){if(Z_(e)==="Function")return NE(e)},S_=typeof document=="object"&&document.all,h_=S_===void 0&&S_!==void 0?function(e){return typeof e=="function"||e===S_}:function(e){return typeof e=="function"},I_={},vf=!A(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!==7}),o_=k,d_=Function.prototype.call,g_=o_?d_.bind(d_):function(){return d_.apply(d_,arguments)},v_={},M_={}.propertyIsEnumerable,R_=Object.getOwnPropertyDescriptor,X_=R_&&!M_.call({1:2},1);v_.f=X_?function(e){var r=R_(this,e);return!!r&&r.enumerable}:M_;var q_,lE,Lb=function(e,r){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:r}},vS=A,jT=y_,tN=Object,z1=_e("".split),UI=vS(function(){return!tN("z").propertyIsEnumerable(0)})?function(e){return jT(e)==="String"?z1(e,""):tN(e)}:tN,z0=function(e){return e==null},Y0=z0,Y1=TypeError,hS=function(e){if(Y0(e))throw new Y1("Can't call method on "+e);return e},vE=UI,Eg=hS,z_=function(e){return vE(Eg(e))},YE=h_,UE=function(e){return typeof e=="object"?e!==null:YE(e)},bS={},J0=bS,eN=_c,aZ=h_,QG=function(e){return aZ(e)?e:void 0},HS=function(e,r){return arguments.length<2?QG(J0[e])||QG(eN[e]):J0[e]&&J0[e][r]||eN[e]&&eN[e][r]},ZG=_c.navigator,$G=ZG&&ZG.userAgent,XR=$G?String($G):"",t6=_c,J1=XR,e6=t6.process,n6=t6.Deno,r6=e6&&e6.versions||n6&&n6.version,i6=r6&&r6.v8;i6&&(lE=(q_=i6.split("."))[0]>0&&q_[0]<4?1:+(q_[0]+q_[1])),!lE&&J1&&(!(q_=J1.match(/Edge\/(\d+)/))||q_[1]>=74)&&(q_=J1.match(/Chrome\/(\d+)/))&&(lE=+q_[1]);var X0=lE,o6=X0,cZ=A,uZ=_c.String,VI=!!Object.getOwnPropertySymbols&&!cZ(function(){var e=Symbol("symbol detection");return!uZ(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&o6&&o6<41}),s6=VI&&!Symbol.sham&&typeof Symbol.iterator=="symbol",dZ=HS,lZ=h_,hZ=_n,pZ=Object,nN=s6?function(e){return typeof e=="symbol"}:function(e){var r=dZ("Symbol");return lZ(r)&&hZ(r.prototype,pZ(e))},fZ=String,jI=function(e){try{return fZ(e)}catch{return"Object"}},mZ=h_,_Z=jI,EZ=TypeError,lT=function(e){if(mZ(e))return e;throw new EZ(_Z(e)+" is not a function")},gZ=lT,vZ=z0,NP=function(e,r){var i=e[r];return vZ(i)?void 0:gZ(i)},a6=g_,c6=h_,u6=UE,bZ=TypeError,d6={exports:{}},l6=_c,yZ=Object.defineProperty,SZ=_c,TZ=function(e,r){try{yZ(l6,e,{value:r,configurable:!0,writable:!0})}catch{l6[e]=r}return r},h6="__core-js_shared__",p6=d6.exports=SZ[h6]||TZ(h6,{});(p6.versions||(p6.versions=[])).push({version:"3.42.0",mode:"pure",copyright:"© 2014-2025 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.42.0/LICENSE",source:"https://github.com/zloirock/core-js"});var X1=d6.exports,f6=X1,FI=function(e,r){return f6[e]||(f6[e]=r||{})},RZ=hS,IZ=Object,OR=function(e){return IZ(RZ(e))},wZ=OR,CZ=_e({}.hasOwnProperty),DS=Object.hasOwn||function(e,r){return CZ(wZ(e),r)},AZ=_e,OZ=0,NZ=Math.random(),PZ=AZ(1 .toString),Q1=function(e){return"Symbol("+(e===void 0?"":e)+")_"+PZ(++OZ+NZ,36)},DZ=FI,m6=DS,kZ=Q1,LZ=VI,MZ=s6,BI=_c.Symbol,Z1=DZ("wks"),xZ=MZ?BI.for||BI:BI&&BI.withoutSetter||kZ,tS=function(e){return m6(Z1,e)||(Z1[e]=LZ&&m6(BI,e)?BI[e]:xZ("Symbol."+e)),Z1[e]},UZ=g_,_6=UE,E6=nN,VZ=NP,jZ=function(e,r){var i,d;if(c6(i=e.toString)&&!u6(d=a6(i,e))||c6(i=e.valueOf)&&!u6(d=a6(i,e)))return d;throw new bZ("Can't convert object to primitive value")},FZ=TypeError,BZ=tS("toPrimitive"),GZ=function(e,r){if(!_6(e)||E6(e))return e;var i,d=VZ(e,BZ);if(d){if(i=UZ(d,e,r),!_6(i)||E6(i))return i;throw new FZ("Can't convert object to primitive value")}return jZ(e)},qZ=nN,$1=function(e){var r=GZ(e,"string");return qZ(r)?r:r+""},g6=UE,tM=_c.document,WZ=g6(tM)&&g6(tM.createElement),eM=function(e){return WZ?tM.createElement(e):{}},KZ=eM,v6=!vf&&!A(function(){return Object.defineProperty(KZ("div"),"a",{get:function(){return 7}}).a!==7}),HZ=vf,zZ=g_,YZ=v_,JZ=Lb,XZ=z_,QZ=$1,ZZ=DS,$Z=v6,b6=Object.getOwnPropertyDescriptor;I_.f=HZ?b6:function(e,r){if(e=XZ(e),r=QZ(r),$Z)try{return b6(e,r)}catch{}if(ZZ(e,r))return JZ(!zZ(YZ.f,e,r),e[r])};var t$=A,e$=h_,n$=/#|\.prototype\./,rN=function(e,r){var i=i$[r$(e)];return i===s$||i!==o$&&(e$(r)?t$(r):!!r)},r$=rN.normalize=function(e){return String(e).replace(n$,".").toLowerCase()},i$=rN.data={},o$=rN.NATIVE="N",s$=rN.POLYFILL="P",y6=rN,a$=lT,c$=k,u$=i_(i_.bind),f0=function(e,r){return a$(e),r===void 0?e:c$?u$(e,r):function(){return e.apply(r,arguments)}},FT={},S6=vf&&A(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!==42}),d$=UE,l$=String,h$=TypeError,oT=function(e){if(d$(e))return e;throw new h$(l$(e)+" is not an object")},p$=vf,f$=v6,m$=S6,PP=oT,T6=$1,_$=TypeError,nM=Object.defineProperty,E$=Object.getOwnPropertyDescriptor,rM="enumerable",iM="configurable",oM="writable";FT.f=p$?m$?function(e,r,i){if(PP(e),r=T6(r),PP(i),typeof e=="function"&&r==="prototype"&&"value"in i&&oM in i&&!i[oM]){var d=E$(e,r);d&&d[oM]&&(e[r]=i.value,i={configurable:iM in i?i[iM]:d[iM],enumerable:rM in i?i[rM]:d[rM],writable:!1})}return nM(e,r,i)}:nM:function(e,r,i){if(PP(e),r=T6(r),PP(i),f$)try{return nM(e,r,i)}catch{}if("get"in i||"set"in i)throw new _$("Accessors not supported");return"value"in i&&(e[r]=i.value),e};var g$=FT,v$=Lb,Q0=vf?function(e,r,i){return g$.f(e,r,v$(1,i))}:function(e,r,i){return e[r]=i,e},iN=_c,b$=e_,y$=i_,S$=h_,T$=I_.f,R$=y6,GI=bS,I$=f0,qI=Q0,R6=DS,w$=function(e){var r=function(i,d,h){if(this instanceof r){switch(arguments.length){case 0:return new e;case 1:return new e(i);case 2:return new e(i,d)}return new e(i,d,h)}return b$(e,this,arguments)};return r.prototype=e.prototype,r},bE=function(e,r){var i,d,h,f,g,b,C,P,x,H=e.target,$=e.global,_t=e.stat,_i=e.proto,ue=$?iN:_t?iN[H]:iN[H]&&iN[H].prototype,_r=$?GI:GI[H]||qI(GI,H,{})[H],Fi=_r.prototype;for(f in r)d=!(i=R$($?f:H+(_t?".":"#")+f,e.forced))&&ue&&R6(ue,f),b=_r[f],d&&(C=e.dontCallGetSet?(x=T$(ue,f))&&x.value:ue[f]),g=d&&C?C:r[f],(i||_i||typeof b!=typeof g)&&(P=e.bind&&d?I$(g,iN):e.wrap&&d?w$(g):_i&&S$(g)?y$(g):g,(e.sham||g&&g.sham||b&&b.sham)&&qI(P,"sham",!0),qI(_r,f,P),_i&&(R6(GI,h=H+"Prototype")||qI(GI,h,{}),qI(GI[h],f,g),e.real&&Fi&&(i||!Fi[f])&&qI(Fi,f,g)))},C$=Math.ceil,A$=Math.floor,O$=Math.trunc||function(e){var r=+e;return(r>0?A$:C$)(r)},N$=O$,sM=function(e){var r=+e;return r!=r||r===0?0:N$(r)},P$=sM,D$=Math.max,k$=Math.min,aM=function(e,r){var i=P$(e);return i<0?D$(i+r,0):k$(i,r)},L$=sM,M$=Math.min,I6=function(e){var r=L$(e);return r>0?M$(r,9007199254740991):0},x$=I6,m0=function(e){return x$(e.length)},U$=z_,V$=aM,j$=m0,w6=function(e){return function(r,i,d){var h=U$(r),f=j$(h);if(f===0)return!e&&-1;var g,b=V$(d,f);if(e&&i!=i){for(;f>b;)if((g=h[b++])!=g)return!0}else for(;f>b;b++)if((e||b in h)&&h[b]===i)return e||b||0;return!e&&-1}},cM={includes:w6(!0),indexOf:w6(!1)},F$=cM.includes;bE({target:"Array",proto:!0,forced:A(function(){return!Array(1).includes()})},{includes:function(e){return F$(this,e,arguments.length>1?arguments[1]:void 0)}});var B$=_c,G$=bS,BT=function(e,r){var i=G$[e+"Prototype"],d=i&&i[r];if(d)return d;var h=B$[e],f=h&&h.prototype;return f&&f[r]},q$=BT("Array","includes"),W$=UE,K$=y_,H$=tS("match"),C6=function(e){var r;return W$(e)&&((r=e[H$])!==void 0?!!r:K$(e)==="RegExp")},z$=C6,Y$=TypeError,A6={};A6[tS("toStringTag")]="z";var uM=String(A6)==="[object z]",J$=uM,X$=h_,DP=y_,Q$=tS("toStringTag"),Z$=Object,$$=DP(function(){return arguments}())==="Arguments",_0=J$?DP:function(e){var r,i,d;return e===void 0?"Undefined":e===null?"Null":typeof(i=function(h,f){try{return h[f]}catch{}}(r=Z$(e),Q$))=="string"?i:$$?DP(r):(d=DP(r))==="Object"&&X$(r.callee)?"Arguments":d},t2=_0,e2=String,hT=function(e){if(t2(e)==="Symbol")throw new TypeError("Cannot convert a Symbol value to a string");return e2(e)},n2=tS("match"),r2=bE,i2=function(e){if(z$(e))throw new Y$("The method doesn't accept regular expressions");return e},o2=hS,O6=hT,s2=function(e){var r=/./;try{"/./"[e](r)}catch{try{return r[n2]=!1,"/./"[e](r)}catch{}}return!1},a2=_e("".indexOf);r2({target:"String",proto:!0,forced:!s2("includes")},{includes:function(e){return!!~a2(O6(o2(this)),O6(i2(e)),arguments.length>1?arguments[1]:void 0)}});var c2=BT("String","includes"),N6=_n,u2=q$,d2=c2,dM=Array.prototype,lM=String.prototype,l2=function(e){var r=e.includes;return e===dM||N6(dM,e)&&r===dM.includes?u2:typeof e=="string"||e===lM||N6(lM,e)&&r===lM.includes?d2:r},E_=_(l2),h2=lT,p2=OR,f2=UI,m2=m0,P6=TypeError,D6="Reduce of empty array with no initial value",_2=function(e){return function(r,i,d,h){var f=p2(r),g=f2(f),b=m2(f);if(h2(i),b===0&&d<2)throw new P6(D6);var C=e?b-1:0,P=e?-1:1;if(d<2)for(;;){if(C in g){h=g[C],C+=P;break}if(C+=P,e?C<0:b<=C)throw new P6(D6)}for(;e?C>=0:b>C;C+=P)C in g&&(h=i(h,g[C],C,f));return h}},E2={left:_2(!1)},g2=A,kP=function(e,r){var i=[][e];return!!i&&g2(function(){i.call(null,r||function(){return 1},1)})},oN=_c,v2=XR,b2=y_,LP=function(e){return v2.slice(0,e.length)===e},hM=LP("Bun/")?"BUN":LP("Cloudflare-Workers")?"CLOUDFLARE":LP("Deno/")?"DENO":LP("Node.js/")?"NODE":oN.Bun&&typeof Bun.version=="string"?"BUN":oN.Deno&&typeof Deno.version=="object"?"DENO":b2(oN.process)==="process"?"NODE":oN.window&&oN.document?"BROWSER":"REST",MP=hM==="NODE",y2=E2.left;bE({target:"Array",proto:!0,forced:!MP&&X0>79&&X0<83||!kP("reduce")},{reduce:function(e){var r=arguments.length;return y2(this,e,r,r>1?arguments[1]:void 0)}});var S2=BT("Array","reduce"),T2=_n,R2=S2,pM=Array.prototype,I2=function(e){var r=e.reduce;return e===pM||T2(pM,e)&&r===pM.reduce?R2:r},k6=I2,GT=_(k6),w2=y_,sN=Array.isArray||function(e){return w2(e)==="Array"},C2=bE,A2=sN,O2=_e([].reverse),L6=[1,2];C2({target:"Array",proto:!0,forced:String(L6)===String(L6.reverse())},{reverse:function(){return A2(this)&&(this.length=this.length),O2(this)}});var N2=BT("Array","reverse"),P2=_n,D2=N2,fM=Array.prototype,k2=function(e){var r=e.reverse;return e===fM||P2(fM,e)&&r===fM.reverse?D2:r},M6=k2,x6=_(M6),L2=Q1,U6=FI("keys"),xP=function(e){return U6[e]||(U6[e]=L2(e))},M2=!A(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),x2=DS,U2=h_,V2=OR,j2=M2,V6=xP("IE_PROTO"),mM=Object,F2=mM.prototype,_M=j2?mM.getPrototypeOf:function(e){var r=V2(e);if(x2(r,V6))return r[V6];var i=r.constructor;return U2(i)&&r instanceof i?i.prototype:r instanceof mM?F2:null},B2=_e,G2=lT,q2=UE,W2=function(e){return q2(e)||e===null},K2=String,H2=TypeError,z2=function(e,r,i){try{return B2(G2(Object.getOwnPropertyDescriptor(e,r)[i]))}catch{}},Y2=UE,J2=hS,X2=function(e){if(W2(e))return e;throw new H2("Can't set "+K2(e)+" as a prototype")},Q2=Object.setPrototypeOf||("__proto__"in{}?function(){var e,r=!1,i={};try{(e=z2(Object.prototype,"__proto__","set"))(i,[]),r=i instanceof Array}catch{}return function(d,h){return J2(d),X2(h),Y2(d)&&(r?e(d,h):d.__proto__=h),d}}():void 0),UP={},VP={},EM=DS,Z2=z_,$2=cM.indexOf,ttt=VP,j6=_e([].push),F6=function(e,r){var i,d=Z2(e),h=0,f=[];for(i in d)!EM(ttt,i)&&EM(d,i)&&j6(f,i);for(;r.length>h;)EM(d,i=r[h++])&&(~$2(f,i)||j6(f,i));return f},gM=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],ett=F6,ntt=gM.concat("length","prototype");UP.f=Object.getOwnPropertyNames||function(e){return ett(e,ntt)};var aN={};aN.f=Object.getOwnPropertySymbols;var rtt=HS,itt=UP,ott=aN,stt=oT,att=_e([].concat),ctt=rtt("Reflect","ownKeys")||function(e){var r=itt.f(stt(e)),i=ott.f;return i?att(r,i(e)):r},B6=DS,utt=ctt,dtt=I_,ltt=FT,vM={},htt=F6,ptt=gM,jP=Object.keys||function(e){return htt(e,ptt)},ftt=vf,mtt=S6,_tt=FT,Ett=oT,gtt=z_,vtt=jP;vM.f=ftt&&!mtt?Object.defineProperties:function(e,r){Ett(e);for(var i,d=gtt(r),h=vtt(r),f=h.length,g=0;f>g;)_tt.f(e,i=h[g++],d[i]);return e};var FP,G6=HS("document","documentElement"),btt=oT,ytt=vM,q6=gM,Stt=VP,Ttt=G6,Rtt=eM,bM="prototype",yM="script",W6=xP("IE_PROTO"),SM=function(){},K6=function(e){return"<"+yM+">"+e+"</"+yM+">"},H6=function(e){e.write(K6("")),e.close();var r=e.parentWindow.Object;return e=null,r},BP=function(){try{FP=new ActiveXObject("htmlfile")}catch{}var e,r,i;BP=typeof document<"u"?document.domain&&FP?H6(FP):(r=Rtt("iframe"),i="java"+yM+":",r.style.display="none",Ttt.appendChild(r),r.src=String(i),(e=r.contentWindow.document).open(),e.write(K6("document.F=Object")),e.close(),e.F):H6(FP);for(var d=q6.length;d--;)delete BP[bM][q6[d]];return BP()};Stt[W6]=!0;var cN=Object.create||function(e,r){var i;return e!==null?(SM[bM]=btt(e),i=new SM,SM[bM]=null,i[W6]=e):i=BP(),r===void 0?i:ytt.f(i,r)},Itt=UE,wtt=Q0,z6=Error,Ctt=_e("".replace),Att=String(new z6("zxcasd").stack),Y6=/\n\s*at [^:]*:[^\n]*/,Ott=Y6.test(Att),Ntt=Lb,Ptt=!A(function(){var e=new Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",Ntt(1,7)),e.stack!==7)}),Dtt=Q0,ktt=function(e,r){if(Ott&&typeof e=="string"&&!z6.prepareStackTrace)for(;r--;)e=Ctt(e,Y6,"");return e},Ltt=Ptt,J6=Error.captureStackTrace,WI={},Mtt=WI,xtt=tS("iterator"),Utt=Array.prototype,X6=function(e){return e!==void 0&&(Mtt.Array===e||Utt[xtt]===e)},Vtt=_0,Q6=NP,jtt=z0,Ftt=WI,Btt=tS("iterator"),GP=function(e){if(!jtt(e))return Q6(e,Btt)||Q6(e,"@@iterator")||Ftt[Vtt(e)]},Gtt=g_,qtt=lT,Wtt=oT,Ktt=jI,Htt=GP,ztt=TypeError,TM=function(e,r){var i=arguments.length<2?Htt(e):r;if(qtt(i))return Wtt(Gtt(i,e));throw new ztt(Ktt(e)+" is not iterable")},Ytt=g_,Z6=oT,Jtt=NP,$6=function(e,r,i){var d,h;Z6(e);try{if(!(d=Jtt(e,"return"))){if(r==="throw")throw i;return i}d=Ytt(d,e)}catch(f){h=!0,d=f}if(r==="throw")throw i;if(h)throw d;return Z6(d),i},Xtt=f0,Qtt=g_,Ztt=oT,$tt=jI,tet=X6,eet=m0,t5=_n,net=TM,ret=GP,e5=$6,iet=TypeError,qP=function(e,r){this.stopped=e,this.result=r},n5=qP.prototype,uN=function(e,r,i){var d,h,f,g,b,C,P,x=i&&i.that,H=!(!i||!i.AS_ENTRIES),$=!(!i||!i.IS_RECORD),_t=!(!i||!i.IS_ITERATOR),_i=!(!i||!i.INTERRUPTED),ue=Xtt(r,x),_r=function(Di){return d&&e5(d,"normal",Di),new qP(!0,Di)},Fi=function(Di){return H?(Ztt(Di),_i?ue(Di[0],Di[1],_r):ue(Di[0],Di[1])):_i?ue(Di,_r):ue(Di)};if($)d=e.iterator;else if(_t)d=e;else{if(!(h=ret(e)))throw new iet($tt(e)+" is not iterable");if(tet(h)){for(f=0,g=eet(e);g>f;f++)if((b=Fi(e[f]))&&t5(n5,b))return b;return new qP(!1)}d=net(e,h)}for(C=$?e.next:d.next;!(P=Qtt(C,d)).done;){try{b=Fi(P.value)}catch(Di){e5(d,"throw",Di)}if(typeof b=="object"&&b&&t5(n5,b))return b}return new qP(!1)},oet=hT,set=bE,aet=_n,cet=_M,WP=Q2,uet=function(e,r,i){for(var d=utt(r),h=ltt.f,f=dtt.f,g=0;g<d.length;g++){var b=d[g];B6(e,b)||i&&B6(i,b)||h(e,b,f(r,b))}},r5=cN,RM=Q0,IM=Lb,det=function(e,r){Itt(r)&&"cause"in r&&wtt(e,"cause",r.cause)},het=function(e,r,i,d){Ltt&&(J6?J6(e,r):Dtt(e,"stack",ktt(i,d)))},pet=uN,fet=function(e,r){return e===void 0?arguments.length<2?"":r:oet(e)},met=tS("toStringTag"),KP=Error,_et=[].push,KI=function(e,r){var i,d=aet(wM,this);WP?i=WP(new KP,d?cet(this):wM):(i=d?this:r5(wM),RM(i,met,"Error")),r!==void 0&&RM(i,"message",fet(r)),het(i,KI,i.stack,1),arguments.length>2&&det(i,arguments[2]);var h=[];return pet(e,_et,{that:h}),RM(i,"errors",h),i};WP?WP(KI,KP):uet(KI,KP,{name:!0});var wM=KI.prototype=r5(KP.prototype,{constructor:IM(1,KI),message:IM(1,""),name:IM(1,"AggregateError")});set({global:!0},{AggregateError:KI});var HP,dN,zP,Eet=h_,i5=_c.WeakMap,get=Eet(i5)&&/native code/.test(String(i5)),o5=_c,vet=UE,bet=Q0,CM=DS,AM=X1,yet=xP,Tet=VP,s5="Object already initialized",OM=o5.TypeError,Ret=o5.WeakMap;if(get||AM.state){var NR=AM.state||(AM.state=new Ret);NR.get=NR.get,NR.has=NR.has,NR.set=NR.set,HP=function(e,r){if(NR.has(e))throw new OM(s5);return r.facade=e,NR.set(e,r),r},dN=function(e){return NR.get(e)||{}},zP=function(e){return NR.has(e)}}else{var HI=yet("state");Tet[HI]=!0,HP=function(e,r){if(CM(e,HI))throw new OM(s5);return r.facade=e,bet(e,HI,r),r},dN=function(e){return CM(e,HI)?e[HI]:{}},zP=function(e){return CM(e,HI)}}var Z0,a5,c5,$0={set:HP,get:dN,has:zP,enforce:function(e){return zP(e)?dN(e):HP(e,{})},getterFor:function(e){return function(r){var i;if(!vet(r)||(i=dN(r)).type!==e)throw new OM("Incompatible receiver, "+e+" required");return i}}},NM=vf,Iet=DS,u5=Function.prototype,wet=NM&&Object.getOwnPropertyDescriptor,d5=Iet(u5,"name"),l5={PROPER:d5&&(function(){}).name==="something",CONFIGURABLE:d5&&(!NM||NM&&wet(u5,"name").configurable)},Cet=Q0,E0=function(e,r,i,d){return d&&d.enumerable?e[r]=i:Cet(e,r,i),e},Aet=A,Oet=h_,Net=UE,Pet=cN,h5=_M,Det=E0,PM=tS("iterator"),p5=!1;[].keys&&("next"in(c5=[].keys())?(a5=h5(h5(c5)))!==Object.prototype&&(Z0=a5):p5=!0);var ket=!Net(Z0)||Aet(function(){var e={};return Z0[PM].call(e)!==e});Oet((Z0=ket?{}:Pet(Z0))[PM])||Det(Z0,PM,function(){return this});var f5={IteratorPrototype:Z0,BUGGY_SAFARI_ITERATORS:p5},Let=_0,Met=uM?{}.toString:function(){return"[object "+Let(this)+"]"},xet=uM,Uet=FT.f,Vet=Q0,jet=DS,Fet=Met,m5=tS("toStringTag"),QR=function(e,r,i,d){var h=i?e:e&&e.prototype;h&&(jet(h,m5)||Uet(h,m5,{configurable:!0,value:r}),d&&!xet&&Vet(h,"toString",Fet))},Bet=f5.IteratorPrototype,Get=cN,qet=Lb,Wet=QR,Ket=WI,Het=function(){return this},DM=function(e,r,i,d){var h=r+" Iterator";return e.prototype=Get(Bet,{next:qet(+!d,i)}),Wet(e,h,!1,!0),Ket[h]=Het,e},zet=bE,Yet=g_,Jet=l5,Xet=DM,Qet=_M,Zet=QR,_5=E0,E5=WI,$et=f5,tnt=Jet.PROPER,YP=$et.BUGGY_SAFARI_ITERATORS,kM=tS("iterator"),g5="keys",JP="values",v5="entries",ent=function(){return this},b5=function(e,r,i,d,h,f,g){Xet(i,r,d);var b,C,P,x=function(Fi){if(Fi===h&&ue)return ue;if(!YP&&Fi&&Fi in _t)return _t[Fi];switch(Fi){case g5:case JP:case v5:return function(){return new i(this,Fi)}}return function(){return new i(this)}},H=r+" Iterator",$=!1,_t=e.prototype,_i=_t[kM]||_t["@@iterator"]||h&&_t[h],ue=!YP&&_i||x(h),_r=r==="Array"&&_t.entries||_i;if(_r&&(b=Qet(_r.call(new e)))!==Object.prototype&&b.next&&(Zet(b,H,!0,!0),E5[H]=ent),tnt&&h===JP&&_i&&_i.name!==JP&&($=!0,ue=function(){return Yet(_i,this)}),h)if(C={values:x(JP),keys:f?ue:x(g5),entries:x(v5)},g)for(P in C)(YP||$||!(P in _t))&&_5(_t,P,C[P]);else zet({target:r,proto:!0,forced:YP||$},C);return g&&_t[kM]!==ue&&_5(_t,kM,ue,{}),E5[r]=ue,C},XP=function(e,r){return{value:e,done:r}},nnt=z_,y5=WI,S5=$0;FT.f;var rnt=b5,QP=XP,T5="Array Iterator",int=S5.set,ont=S5.getterFor(T5);rnt(Array,"Array",function(e,r){int(this,{type:T5,target:nnt(e),index:0,kind:r})},function(){var e=ont(this),r=e.target,i=e.index++;if(!r||i>=r.length)return e.target=null,QP(void 0,!0);switch(e.kind){case"keys":return QP(i,!1);case"values":return QP(r[i],!1)}return QP([i,r[i]],!1)},"values"),y5.Arguments=y5.Array;var snt=FT,ZP=function(e,r,i){return snt.f(e,r,i)},ant=HS,cnt=ZP,unt=vf,R5=tS("species"),dnt=_n,lnt=TypeError,LM=function(e,r){if(dnt(r,e))return e;throw new lnt("Incorrect invocation")},hnt=h_,MM=X1,pnt=_e(Function.toString);hnt(MM.inspectSource)||(MM.inspectSource=function(e){return pnt(e)});var I5=MM.inspectSource,fnt=_e,mnt=A,w5=h_,_nt=_0,Ent=I5,C5=function(){},A5=HS("Reflect","construct"),xM=/^\s*(?:class|function)\b/,gnt=fnt(xM.exec),vnt=!xM.test(C5),lN=function(e){if(!w5(e))return!1;try{return A5(C5,[],e),!0}catch{return!1}},O5=function(e){if(!w5(e))return!1;switch(_nt(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return vnt||!!gnt(xM,Ent(e))}catch{return!0}};O5.sham=!0;var hN,zI,N5,UM,$P=!A5||mnt(function(){var e;return lN(lN.call)||!lN(Object)||!lN(function(){e=!0})||e})?O5:lN,bnt=$P,ynt=jI,Snt=TypeError,P5=oT,Tnt=function(e){if(bnt(e))return e;throw new Snt(ynt(e)+" is not a constructor")},Rnt=z0,Int=tS("species"),VM=function(e,r){var i,d=P5(e).constructor;return d===void 0||Rnt(i=P5(d)[Int])?r:Tnt(i)},g0=_e([].slice),wnt=TypeError,tI=function(e,r){if(e<r)throw new wnt("Not enough arguments");return e},D5=/(?:ipad|iphone|ipod).*applewebkit/i.test(XR),wT=_c,Cnt=e_,Ant=f0,k5=h_,Ont=DS,L5=A,M5=G6,Nnt=g0,x5=eM,Pnt=tI,Dnt=D5,knt=MP,jM=wT.setImmediate,FM=wT.clearImmediate,Lnt=wT.process,BM=wT.Dispatch,Mnt=wT.Function,U5=wT.MessageChannel,xnt=wT.String,GM=0,pN={},V5="onreadystatechange";L5(function(){hN=wT.location});var qM=function(e){if(Ont(pN,e)){var r=pN[e];delete pN[e],r()}},WM=function(e){return function(){qM(e)}},j5=function(e){qM(e.data)},F5=function(e){wT.postMessage(xnt(e),hN.protocol+"//"+hN.host)};jM&&FM||(jM=function(e){Pnt(arguments.length,1);var r=k5(e)?e:Mnt(e),i=Nnt(arguments,1);return pN[++GM]=function(){Cnt(r,void 0,i)},zI(GM),GM},FM=function(e){delete pN[e]},knt?zI=function(e){Lnt.nextTick(WM(e))}:BM&&BM.now?zI=function(e){BM.now(WM(e))}:U5&&!Dnt?(UM=(N5=new U5).port2,N5.port1.onmessage=j5,zI=Ant(UM.postMessage,UM)):wT.addEventListener&&k5(wT.postMessage)&&!wT.importScripts&&hN&&hN.protocol!=="file:"&&!L5(F5)?(zI=F5,wT.addEventListener("message",j5,!1)):zI=V5 in x5("script")?function(e){M5.appendChild(x5("script"))[V5]=function(){M5.removeChild(this),qM(e)}}:function(e){setTimeout(WM(e),0)});var tD={set:jM,clear:FM},B5=_c,Unt=vf,Vnt=Object.getOwnPropertyDescriptor,G5=function(e){if(!Unt)return B5[e];var r=Vnt(B5,e);return r&&r.value},q5=function(){this.head=null,this.tail=null};q5.prototype={add:function(e){var r={item:e,next:null},i=this.tail;i?i.next=r:this.head=r,this.tail=r},get:function(){var e=this.head;if(e)return(this.head=e.next)===null&&(this.tail=null),e.item}};var YI,KM,HM,zM,W5,K5=q5,jnt=/ipad|iphone|ipod/i.test(XR)&&typeof Pebble<"u",Fnt=/web0s(?!.*chrome)/i.test(XR),JI=_c,Bnt=G5,H5=f0,YM=tD.set,Gnt=K5,qnt=D5,Wnt=jnt,Knt=Fnt,JM=MP,z5=JI.MutationObserver||JI.WebKitMutationObserver,Y5=JI.document,J5=JI.process,sD=JI.Promise,XM=Bnt("queueMicrotask");if(!XM){var uD=new Gnt,_D=function(){var e,r;for(JM&&(e=J5.domain)&&e.exit();r=uD.get();)try{r()}catch(i){throw uD.head&&YI(),i}e&&e.enter()};qnt||JM||Knt||!z5||!Y5?!Wnt&&sD&&sD.resolve?((zM=sD.resolve(void 0)).constructor=sD,W5=H5(zM.then,zM),YI=function(){W5(_D)}):JM?YI=function(){J5.nextTick(_D)}:(YM=H5(YM,JI),YI=function(){YM(_D)}):(KM=!0,HM=Y5.createTextNode(""),new z5(_D).observe(HM,{characterData:!0}),YI=function(){HM.data=KM=!KM}),XM=function(e){uD.head||YI(),uD.add(e)}}var X5=XM,XI=function(e){try{return{error:!1,value:e()}}catch(r){return{error:!0,value:r}}},eI=_c.Promise,Hnt=_c,fN=eI,znt=h_,Ynt=y6,Jnt=I5,Xnt=tS,Q5=hM,QM=X0,Z5=fN&&fN.prototype,Qnt=Xnt("species"),$5=znt(Hnt.PromiseRejectionEvent),Znt=Ynt("Promise",function(){var e=Jnt(fN),r=e!==String(fN);if(!r&&QM===66||!Z5.catch||!Z5.finally)return!0;if(!QM||QM<51||!/native code/.test(e)){var i=new fN(function(h){h(1)}),d=function(h){h(function(){},function(){})};if((i.constructor={})[Qnt]=d,!(i.then(function(){})instanceof d))return!0}return!(r||Q5!=="BROWSER"&&Q5!=="DENO"||$5)}),mN={CONSTRUCTOR:Znt,REJECTION_EVENT:$5},PR={},_q=lT,$nt=TypeError,trt=function(e){var r,i;this.promise=new e(function(d,h){if(r!==void 0||i!==void 0)throw new $nt("Bad Promise constructor");r=d,i=h}),this.resolve=_q(r),this.reject=_q(i)};PR.f=function(e){return new trt(e)};var ZM,tW,ert=bE,ED=MP,v0=_c,_N=g_,nrt=E0,rrt=QR,irt=function(e){var r=ant(e);unt&&r&&!r[R5]&&cnt(r,R5,{configurable:!0,get:function(){return this}})},ort=lT,$M=h_,srt=UE,art=LM,crt=VM,eW=tD.set,_x=X5,urt=function(e,r){try{arguments.length===1?console.error(e):console.error(e,r)}catch{}},drt=XI,lrt=K5,nW=$0,tU=eI,rW=mN,iW=PR,vD="Promise",oW=rW.CONSTRUCTOR,hrt=rW.REJECTION_EVENT,eU=nW.getterFor(vD),prt=nW.set,frt=tU&&tU.prototype,EN=tU,nU=frt,sW=v0.TypeError,rU=v0.document,iU=v0.process,oU=iW.f,mrt=oU,_rt=!!(rU&&rU.createEvent&&v0.dispatchEvent),aW="unhandledrejection",cW=function(e){var r;return!(!srt(e)||!$M(r=e.then))&&r},uW=function(e,r){var i,d,h,f=r.value,g=r.state===1,b=g?e.ok:e.fail,C=e.resolve,P=e.reject,x=e.domain;try{b?(g||(r.rejection===2&&grt(r),r.rejection=1),b===!0?i=f:(x&&x.enter(),i=b(f),x&&(x.exit(),h=!0)),i===e.promise?P(new sW("Promise-chain cycle")):(d=cW(i))?_N(d,i,C,P):C(i)):P(f)}catch(H){x&&!h&&x.exit(),P(H)}},dW=function(e,r){e.notified||(e.notified=!0,_x(function(){for(var i,d=e.reactions;i=d.get();)uW(i,e);e.notified=!1,r&&!e.rejection&&Ert(e)}))},lW=function(e,r,i){var d,h;_rt?((d=rU.createEvent("Event")).promise=r,d.reason=i,d.initEvent(e,!1,!0),v0.dispatchEvent(d)):d={promise:r,reason:i},!hrt&&(h=v0["on"+e])?h(d):e===aW&&urt("Unhandled promise rejection",i)},Ert=function(e){_N(eW,v0,function(){var r,i=e.facade,d=e.value;if(hW(e)&&(r=drt(function(){ED?iU.emit("unhandledRejection",d,i):lW(aW,i,d)}),e.rejection=ED||hW(e)?2:1,r.error))throw r.value})},hW=function(e){return e.rejection!==1&&!e.parent},grt=function(e){_N(eW,v0,function(){var r=e.facade;ED?iU.emit("rejectionHandled",r):lW("rejectionhandled",r,e.value)})},QI=function(e,r,i){return function(d){e(r,d,i)}},ZI=function(e,r,i){e.done||(e.done=!0,i&&(e=i),e.value=r,e.state=2,dW(e,!0))},sU=function(e,r,i){if(!e.done){e.done=!0,i&&(e=i);try{if(e.facade===r)throw new sW("Promise can't be resolved itself");var d=cW(r);d?_x(function(){var h={done:!1};try{_N(d,r,QI(sU,h,e),QI(ZI,h,e))}catch(f){ZI(h,f,e)}}):(e.value=r,e.state=1,dW(e,!1))}catch(h){ZI({done:!1},h,e)}}};oW&&(nU=(EN=function(e){art(this,nU),ort(e),_N(ZM,this);var r=eU(this);try{e(QI(sU,r),QI(ZI,r))}catch(i){ZI(r,i)}}).prototype,(ZM=function(e){prt(this,{type:vD,done:!1,notified:!1,parent:!1,reactions:new lrt,rejection:!1,state:0,value:null})}).prototype=nrt(nU,"then",function(e,r){var i=eU(this),d=oU(crt(this,EN));return i.parent=!0,d.ok=!$M(e)||e,d.fail=$M(r)&&r,d.domain=ED?iU.domain:void 0,i.state===0?i.reactions.add(d):_x(function(){uW(d,i)}),d.promise}),tW=function(){var e=new ZM,r=eU(e);this.promise=e,this.resolve=QI(sU,r),this.reject=QI(ZI,r)},iW.f=oU=function(e){return e===EN||e===void 0?new tW(e):mrt(e)}),ert({global:!0,wrap:!0,forced:oW},{Promise:EN}),rrt(EN,vD,!1,!0),irt(vD);var pW=tS("iterator"),fW=!1;try{var vrt=0,mW={next:function(){return{done:!!vrt++}},return:function(){fW=!0}};mW[pW]=function(){return this},Array.from(mW,function(){throw 2})}catch{}var brt=eI,yrt=function(e,r){try{if(!r&&!fW)return!1}catch{return!1}var i=!1;try{var d={};d[pW]=function(){return{next:function(){return{done:i=!0}}}},e(d)}catch{}return i},yD=mN.CONSTRUCTOR||!yrt(function(e){brt.all(e).then(void 0,function(){})}),Srt=g_,Trt=lT,Rrt=PR,Irt=XI,wrt=uN;bE({target:"Promise",stat:!0,forced:yD},{all:function(e){var r=this,i=Rrt.f(r),d=i.resolve,h=i.reject,f=Irt(function(){var g=Trt(r.resolve),b=[],C=0,P=1;wrt(e,function(x){var H=C++,$=!1;P++,Srt(g,r,x).then(function(_t){$||($=!0,b[H]=_t,--P||d(b))},h)}),--P||d(b)});return f.error&&h(f.value),i.promise}});var Crt=bE,Art=mN.CONSTRUCTOR;eI&&eI.prototype,Crt({target:"Promise",proto:!0,forced:Art,real:!0},{catch:function(e){return this.then(void 0,e)}});var Ort=g_,Nrt=lT,Prt=PR,Drt=XI,krt=uN;bE({target:"Promise",stat:!0,forced:yD},{race:function(e){var r=this,i=Prt.f(r),d=i.reject,h=Drt(function(){var f=Nrt(r.resolve);krt(e,function(g){Ort(f,r,g).then(i.resolve,d)})});return h.error&&d(h.value),i.promise}});var Lrt=PR;bE({target:"Promise",stat:!0,forced:mN.CONSTRUCTOR},{reject:function(e){var r=Lrt.f(this);return(0,r.reject)(e),r.promise}});var Mrt=oT,xrt=UE,Urt=PR,_W=function(e,r){if(Mrt(e),xrt(r)&&r.constructor===e)return r;var i=Urt.f(e);return(0,i.resolve)(r),i.promise},Vrt=bE,jrt=eI,Frt=mN.CONSTRUCTOR,Brt=_W,Grt=HS("Promise"),qrt=!Frt;Vrt({target:"Promise",stat:!0,forced:!0},{resolve:function(e){return Brt(qrt&&this===Grt?jrt:this,e)}});var Wrt=g_,Krt=lT,Hrt=PR,zrt=XI,Yrt=uN;bE({target:"Promise",stat:!0,forced:yD},{allSettled:function(e){var r=this,i=Hrt.f(r),d=i.resolve,h=i.reject,f=zrt(function(){var g=Krt(r.resolve),b=[],C=0,P=1;Yrt(e,function(x){var H=C++,$=!1;P++,Wrt(g,r,x).then(function(_t){$||($=!0,b[H]={status:"fulfilled",value:_t},--P||d(b))},function(_t){$||($=!0,b[H]={status:"rejected",reason:_t},--P||d(b))})}),--P||d(b)});return f.error&&h(f.value),i.promise}});var Jrt=g_,Xrt=lT,Qrt=HS,Zrt=PR,$rt=XI,tit=uN,EW="No one promise resolved";bE({target:"Promise",stat:!0,forced:yD},{any:function(e){var r=this,i=Qrt("AggregateError"),d=Zrt.f(r),h=d.resolve,f=d.reject,g=$rt(function(){var b=Xrt(r.resolve),C=[],P=0,x=1,H=!1;tit(e,function($){var _t=P++,_i=!1;x++,Jrt(b,r,$).then(function(ue){_i||H||(H=!0,h(ue))},function(ue){_i||H||(_i=!0,C[_t]=ue,--x||f(new i(C,EW)))})}),--x||f(new i(C,EW))});return g.error&&f(g.value),d.promise}});var eit=bE,nit=e_,rit=g0,iit=PR,oit=lT,gW=XI,aU=_c.Promise,vW=!1;eit({target:"Promise",stat:!0,forced:!aU||!aU.try||gW(function(){aU.try(function(e){vW=e===8},8)}).error||!vW},{try:function(e){var r=arguments.length>1?rit(arguments,1):[],i=iit.f(this),d=gW(function(){return nit(oit(e),void 0,r)});return(d.error?i.reject:i.resolve)(d.value),i.promise}});var sit=PR;bE({target:"Promise",stat:!0},{withResolvers:function(){var e=sit.f(this);return{promise:e.promise,resolve:e.resolve,reject:e.reject}}});var ait=bE,cU=eI,cit=A,uit=HS,dit=h_,lit=VM,bW=_W,hit=cU&&cU.prototype;ait({target:"Promise",proto:!0,real:!0,forced:!!cU&&cit(function(){hit.finally.call({then:function(){}},function(){})})},{finally:function(e){var r=lit(this,uit("Promise")),i=dit(e);return this.then(i?function(d){return bW(r,e()).then(function(){return d})}:e,i?function(d){return bW(r,e()).then(function(){throw d})}:e)}});var uU=_e,pit=sM,fit=hT,mit=hS,_it=uU("".charAt),yW=uU("".charCodeAt),Eit=uU("".slice),SW=function(e){return function(r,i){var d,h,f=fit(mit(r)),g=pit(i),b=f.length;return g<0||g>=b?e?"":void 0:(d=yW(f,g))<55296||d>56319||g+1===b||(h=yW(f,g+1))<56320||h>57343?e?_it(f,g):d:e?Eit(f,g,g+2):h-56320+(d-55296<<10)+65536}},dU={codeAt:SW(!1),charAt:SW(!0)},git=dU.charAt,vit=hT,TW=$0,bit=b5,RW=XP,IW="String Iterator",yit=TW.set,Sit=TW.getterFor(IW);bit(String,"String",function(e){yit(this,{type:IW,string:vit(e),index:0})},function(){var e,r=Sit(this),i=r.string,d=r.index;return d>=i.length?RW(void 0,!0):(e=git(i,d),r.index+=e.length,RW(e,!1))});var Tit=bS.Promise,Rit={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Iit=_c,wit=QR,wW=WI;for(var lU in Rit)wit(Iit[lU],lU),wW[lU]=wW.Array;var CW=Tit,T_=_(CW),Cit=BT("Array","values"),Ait=_0,Oit=DS,Nit=_n,Pit=Cit,hU=Array.prototype,Dit={DOMTokenList:!0,NodeList:!0},kit=function(e){var r=e.values;return e===hU||Nit(hU,e)&&r===hU.values||Oit(Dit,Ait(e))?Pit:r},sT=_(kit),AW=jI,Lit=TypeError,OW=g0,Mit=Math.floor,pU=function(e,r){var i=e.length;if(i<8)for(var d,h,f=1;f<i;){for(h=f,d=e[f];h&&r(e[h-1],d)>0;)e[h]=e[--h];h!==f++&&(e[h]=d)}else for(var g=Mit(i/2),b=pU(OW(e,0,g),r),C=pU(OW(e,g),r),P=b.length,x=C.length,H=0,$=0;H<P||$<x;)e[H+$]=H<P&&$<x?r(b[H],C[$])<=0?b[H++]:C[$++]:H<P?b[H++]:C[$++];return e},NW=pU,PW=XR.match(/firefox\/(\d+)/i),xit=!!PW&&+PW[1],Uit=/MSIE|Trident/.test(XR),DW=XR.match(/AppleWebKit\/(\d+)\./),Vit=!!DW&&+DW[1],jit=bE,kW=_e,Fit=lT,Bit=OR,LW=m0,Git=function(e,r){if(!delete e[r])throw new Lit("Cannot delete property "+AW(r)+" of "+AW(e))},MW=hT,fU=A,qit=NW,Wit=kP,xW=xit,Kit=Uit,UW=X0,VW=Vit,b0=[],jW=kW(b0.sort),Hit=kW(b0.push),zit=fU(function(){b0.sort(void 0)}),Yit=fU(function(){b0.sort(null)}),Jit=Wit("sort"),FW=!fU(function(){if(UW)return UW<70;if(!(xW&&xW>3)){if(Kit)return!0;if(VW)return VW<603;var e,r,i,d,h="";for(e=65;e<76;e++){switch(r=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:i=3;break;case 68:case 71:i=4;break;default:i=2}for(d=0;d<47;d++)b0.push({k:r+d,v:i})}for(b0.sort(function(f,g){return g.v-f.v}),d=0;d<b0.length;d++)r=b0[d].k.charAt(0),h.charAt(h.length-1)!==r&&(h+=r);return h!=="DGBEFHACIJK"}});jit({target:"Array",proto:!0,forced:zit||!Yit||!Jit||!FW},{sort:function(e){e!==void 0&&Fit(e);var r=Bit(this);if(FW)return e===void 0?jW(r):jW(r,e);var i,d,h=[],f=LW(r);for(d=0;d<f;d++)d in r&&Hit(h,r[d]);for(qit(h,function(g){return function(b,C){return C===void 0?-1:b===void 0?1:g!==void 0?+g(b,C)||0:MW(b)>MW(C)?1:-1}}(e)),i=LW(h),d=0;d<i;)r[d]=h[d++];for(;d<f;)Git(r,d++);return r}});var Xit=BT("Array","sort"),Qit=_n,Zit=Xit,mU=Array.prototype,$it=function(e){var r=e.sort;return e===mU||Qit(mU,e)&&r===mU.sort?Zit:r},nI=_($it),tot=bE,eot=_e,not=aM,rot=RangeError,BW=String.fromCharCode,GW=String.fromCodePoint,iot=eot([].join);tot({target:"String",stat:!0,forced:!!GW&&GW.length!==1},{fromCodePoint:function(e){for(var r,i=[],d=arguments.length,h=0;d>h;){if(r=+arguments[h++],not(r,1114111)!==r)throw new rot(r+" is not a valid code point");i[h]=r<65536?BW(r):BW(55296+((r-=65536)>>10),r%1024+56320)}return iot(i,"")}});var oot=A,sot=tS("iterator"),SD=!oot(function(){var e=new URL("b?a=1&b=2&c=3","https://a"),r=e.searchParams,i=new URLSearchParams("a=1&a=2&b=3"),d="";return e.pathname="c%20d",r.forEach(function(h,f){r.delete("b"),d+=f+h}),i.delete("a",2),i.delete("b",void 0),!e.toJSON||!i.has("a",1)||i.has("a",2)||!i.has("a",void 0)||i.has("b")||!r.size&&!0||!r.sort||e.href!=="https://a/c%20d?a=1&c=3"||r.get("c")!=="3"||String(new URLSearchParams("?a=1"))!=="a=1"||!r[sot]||new URL("https://a@b").username!=="a"||new URLSearchParams(new URLSearchParams("a=b")).get("a")!=="b"||new URL("https://тест").host!=="xn--e1aybc"||new URL("https://a#б").hash!=="#%D0%B1"||d!=="a1c3"||new URL("https://x",void 0).host!=="x"}),aot=E0,_U=bE,qW=_c,EU=G5,cot=HS,TD=g_,uR=_e,gN=vf,WW=SD,KW=E0,uot=ZP,dot=function(e,r,i){for(var d in r)i&&i.unsafe&&e[d]?e[d]=r[d]:aot(e,d,r[d],i);return e},lot=QR,hot=DM,gU=$0,HW=LM,vU=h_,pot=DS,fot=f0,mot=_0,_ot=oT,zW=UE,aT=hT,Eot=cN,YW=Lb,JW=TM,got=GP,RD=XP,$I=tI,vot=NW,bot=tS("iterator"),_w="URLSearchParams",XW=_w+"Iterator",QW=gU.set,qT=gU.getterFor(_w),yot=gU.getterFor(XW),ZW=EU("fetch"),ID=EU("Request"),vN=EU("Headers"),bU=ID&&ID.prototype,$W=vN&&vN.prototype,Sot=qW.TypeError,Tot=qW.encodeURIComponent,Rot=String.fromCharCode,Iot=cot("String","fromCodePoint"),wot=parseInt,wD=uR("".charAt),t8=uR([].join),y0=uR([].push),e8=uR("".replace),Cot=uR([].shift),n8=uR([].splice),r8=uR("".split),i8=uR("".slice),Aot=uR(/./.exec),Oot=/\+/g,Not=/^[0-9a-f]+$/i,o8=function(e,r){var i=i8(e,r,r+2);return Aot(Not,i)?wot(i,16):NaN},Pot=function(e){for(var r=0,i=128;i>0&&e&i;i>>=1)r++;return r},Dot=function(e){var r=null;switch(e.length){case 1:r=e[0];break;case 2:r=(31&e[0])<<6|63&e[1];break;case 3:r=(15&e[0])<<12|(63&e[1])<<6|63&e[2];break;case 4:r=(7&e[0])<<18|(63&e[1])<<12|(63&e[2])<<6|63&e[3]}return r>1114111?null:r},s8=function(e){for(var r=(e=e8(e,Oot," ")).length,i="",d=0;d<r;){var h=wD(e,d);if(h==="%"){if(wD(e,d+1)==="%"||d+3>r){i+="%",d++;continue}var f=o8(e,d+1);if(f!=f){i+=h,d++;continue}d+=2;var g=Pot(f);if(g===0)h=Rot(f);else{if(g===1||g>4){i+="�",d++;continue}for(var b=[f],C=1;C<g&&!(++d+3>r||wD(e,d)!=="%");){var P=o8(e,d+1);if(P!=P){d+=3;break}if(P>191||P<128)break;y0(b,P),d+=2,C++}if(b.length!==g){i+="�";continue}var x=Dot(b);x===null?i+="�":h=Iot(x)}}i+=h,d++}return i},kot=/[!'()~]|%20/g,Lot={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+"},Mot=function(e){return Lot[e]},a8=function(e){return e8(Tot(e),kot,Mot)},yU=hot(function(e,r){QW(this,{type:XW,target:qT(e).entries,index:0,kind:r})},_w,function(){var e=yot(this),r=e.target,i=e.index++;if(!r||i>=r.length)return e.target=null,RD(void 0,!0);var d=r[i];switch(e.kind){case"keys":return RD(d.key,!1);case"values":return RD(d.value,!1)}return RD([d.key,d.value],!1)},!0),c8=function(e){this.entries=[],this.url=null,e!==void 0&&(zW(e)?this.parseObject(e):this.parseQuery(typeof e=="string"?wD(e,0)==="?"?i8(e,1):e:aT(e)))};c8.prototype={type:_w,bindURL:function(e){this.url=e,this.update()},parseObject:function(e){var r,i,d,h,f,g,b,C=this.entries,P=got(e);if(P)for(i=(r=JW(e,P)).next;!(d=TD(i,r)).done;){if(f=(h=JW(_ot(d.value))).next,(g=TD(f,h)).done||(b=TD(f,h)).done||!TD(f,h).done)throw new Sot("Expected sequence with length 2");y0(C,{key:aT(g.value),value:aT(b.value)})}else for(var x in e)pot(e,x)&&y0(C,{key:x,value:aT(e[x])})},parseQuery:function(e){if(e)for(var r,i,d=this.entries,h=r8(e,"&"),f=0;f<h.length;)(r=h[f++]).length&&(i=r8(r,"="),y0(d,{key:s8(Cot(i)),value:s8(t8(i,"="))}))},serialize:function(){for(var e,r=this.entries,i=[],d=0;d<r.length;)e=r[d++],y0(i,a8(e.key)+"="+a8(e.value));return t8(i,"&")},update:function(){this.entries.length=0,this.parseQuery(this.url.query)},updateURL:function(){this.url&&this.url.update()}};var CD=function(){HW(this,_C);var e=QW(this,new c8(arguments.length>0?arguments[0]:void 0));gN||(this.size=e.entries.length)},_C=CD.prototype;if(dot(_C,{append:function(e,r){var i=qT(this);$I(arguments.length,2),y0(i.entries,{key:aT(e),value:aT(r)}),gN||this.length++,i.updateURL()},delete:function(e){for(var r=qT(this),i=$I(arguments.length,1),d=r.entries,h=aT(e),f=i<2?void 0:arguments[1],g=f===void 0?f:aT(f),b=0;b<d.length;){var C=d[b];if(C.key!==h||g!==void 0&&C.value!==g)b++;else if(n8(d,b,1),g!==void 0)break}gN||(this.size=d.length),r.updateURL()},get:function(e){var r=qT(this).entries;$I(arguments.length,1);for(var i=aT(e),d=0;d<r.length;d++)if(r[d].key===i)return r[d].value;return null},getAll:function(e){var r=qT(this).entries;$I(arguments.length,1);for(var i=aT(e),d=[],h=0;h<r.length;h++)r[h].key===i&&y0(d,r[h].value);return d},has:function(e){for(var r=qT(this).entries,i=$I(arguments.length,1),d=aT(e),h=i<2?void 0:arguments[1],f=h===void 0?h:aT(h),g=0;g<r.length;){var b=r[g++];if(b.key===d&&(f===void 0||b.value===f))return!0}return!1},set:function(e,r){var i=qT(this);$I(arguments.length,1);for(var d,h=i.entries,f=!1,g=aT(e),b=aT(r),C=0;C<h.length;C++)(d=h[C]).key===g&&(f?n8(h,C--,1):(f=!0,d.value=b));f||y0(h,{key:g,value:b}),gN||(this.size=h.length),i.updateURL()},sort:function(){var e=qT(this);vot(e.entries,function(r,i){return r.key>i.key?1:-1}),e.updateURL()},forEach:function(e){for(var r,i=qT(this).entries,d=fot(e,arguments.length>1?arguments[1]:void 0),h=0;h<i.length;)d((r=i[h++]).value,r.key,this)},keys:function(){return new yU(this,"keys")},values:function(){return new yU(this,"values")},entries:function(){return new yU(this,"entries")}},{enumerable:!0}),KW(_C,bot,_C.entries,{}),KW(_C,"toString",function(){return qT(this).serialize()},{enumerable:!0}),gN&&uot(_C,"size",{get:function(){return qT(this).entries.length},configurable:!0,enumerable:!0}),lot(CD,_w),_U({global:!0,forced:!WW},{URLSearchParams:CD}),!WW&&vU(vN)){var xot=uR($W.has),Uot=uR($W.set),u8=function(e){if(zW(e)){var r,i=e.body;if(mot(i)===_w)return r=e.headers?new vN(e.headers):new vN,xot(r,"content-type")||Uot(r,"content-type","application/x-www-form-urlencoded;charset=UTF-8"),Eot(e,{body:YW(0,aT(i)),headers:YW(0,r)})}return e};if(vU(ZW)&&_U({global:!0,dontCallGetSet:!0,forced:!0},{fetch:function(e){return ZW(e,arguments.length>1?u8(arguments[1]):{})}}),vU(ID)){var SU=function(e){return HW(this,bU),new ID(e,arguments.length>1?u8(arguments[1]):{})};bU.constructor=SU,SU.prototype=bU,_U({global:!0,dontCallGetSet:!0,forced:!0},{Request:SU})}}var WT,Vot={URLSearchParams:CD,getState:qT},jot=bS.URLSearchParams,d8=vf,Fot=_e,Bot=g_,Got=A,TU=jP,qot=aN,Wot=v_,Kot=OR,Hot=UI,_A=Object.assign,l8=Object.defineProperty,zot=Fot([].concat),Yot=!_A||Got(function(){if(d8&&_A({b:1},_A(l8({},"a",{enumerable:!0,get:function(){l8(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var e={},r={},i=Symbol("assign detection"),d="abcdefghijklmnopqrst";return e[i]=7,d.split("").forEach(function(h){r[h]=h}),_A({},e)[i]!==7||TU(_A({},r)).join("")!==d})?function(e,r){for(var i=Kot(e),d=arguments.length,h=1,f=qot.f,g=Wot.f;d>h;)for(var b,C=Hot(arguments[h++]),P=f?zot(TU(C),f(C)):TU(C),x=P.length,H=0;x>H;)b=P[H++],d8&&!Bot(g,C,b)||(i[b]=C[b]);return i}:_A,Jot=oT,Xot=$6,Qot=vf,Zot=FT,$ot=Lb,RU=function(e,r,i){Qot?Zot.f(e,r,$ot(0,i)):e[r]=i},tst=f0,est=g_,nst=OR,rst=function(e,r,i,d){try{return d?r(Jot(i)[0],i[1]):r(i)}catch(h){Xot(e,"throw",h)}},ist=X6,ost=$P,sst=m0,h8=RU,ast=TM,cst=GP,p8=Array,rI=_e,IU=2147483647,ust=/[^\0-\u007E]/,f8=/[.\u3002\uFF0E\uFF61]/g,m8="Overflow: input needs wider integers to process",_8=RangeError,dst=rI(f8.exec),tO=Math.floor,wU=String.fromCharCode,E8=rI("".charCodeAt),g8=rI([].join),S0=rI([].push),lst=rI("".replace),hst=rI("".split),pst=rI("".toLowerCase),v8=function(e){return e+22+75*(e<26)},fst=function(e,r,i){var d=0;for(e=i?tO(e/700):e>>1,e+=tO(e/r);e>455;)e=tO(e/35),d+=36;return tO(d+36*e/(e+38))},mst=function(e){var r=[];e=function(Fi){for(var Di=[],Js=0,_l=Fi.length;Js<_l;){var _u=E8(Fi,Js++);if(_u>=55296&&_u<=56319&&Js<_l){var ga=E8(Fi,Js++);(64512&ga)==56320?S0(Di,((1023&_u)<<10)+(1023&ga)+65536):(S0(Di,_u),Js--)}else S0(Di,_u)}return Di}(e);var i,d,h=e.length,f=128,g=0,b=72;for(i=0;i<e.length;i++)(d=e[i])<128&&S0(r,wU(d));var C=r.length,P=C;for(C&&S0(r,"-");P<h;){var x=IU;for(i=0;i<e.length;i++)(d=e[i])>=f&&d<x&&(x=d);var H=P+1;if(x-f>tO((IU-g)/H))throw new _8(m8);for(g+=(x-f)*H,f=x,i=0;i<e.length;i++){if((d=e[i])<f&&++g>IU)throw new _8(m8);if(d===f){for(var $=g,_t=36;;){var _i=_t<=b?1:_t>=b+26?26:_t-b;if($<_i)break;var ue=$-_i,_r=36-_i;S0(r,wU(v8(_i+ue%_r))),$=tO(ue/_r),_t+=36}S0(r,wU(v8($))),b=fst(g,H,P===C),g=0,P++}}g++,f++}return g8(r,"")},_st=bE,CU=vf,Est=SD,AU=_c,b8=f0,KT=_e,AD=E0,HT=ZP,gst=LM,OU=DS,NU=Yot,eO=function(e){var r=nst(e),i=ost(this),d=arguments.length,h=d>1?arguments[1]:void 0,f=h!==void 0;f&&(h=tst(h,d>2?arguments[2]:void 0));var g,b,C,P,x,H,$=cst(r),_t=0;if(!$||this===p8&&ist($))for(g=sst(r),b=i?new this(g):p8(g);g>_t;_t++)H=f?h(r[_t],_t):r[_t],h8(b,_t,H);else for(b=i?new this:[],x=(P=ast(r,$)).next;!(C=est(x,P)).done;_t++)H=f?rst(P,h,[C.value,_t],!0):C.value,h8(b,_t,H);return b.length=_t,b},dR=g0,vst=dU.codeAt,bst=function(e){var r,i,d=[],h=hst(lst(pst(e),f8,"."),".");for(r=0;r<h.length;r++)i=h[r],S0(d,dst(ust,i)?"xn--"+mst(i):i);return g8(d,".")},ZR=hT,yst=QR,Sst=tI,y8=Vot,S8=$0,Tst=S8.set,OD=S8.getterFor("URL"),Rst=y8.URLSearchParams,Ist=y8.getState,bN=AU.URL,PU=AU.TypeError,ND=AU.parseInt,wst=Math.floor,T8=Math.pow,zT=KT("".charAt),lR=KT(/./.exec),yN=KT([].join),Cst=KT(1 .toString),Ast=KT([].pop),nO=KT([].push),DU=KT("".replace),Ost=KT([].shift),Nst=KT("".split),SN=KT("".slice),PD=KT("".toLowerCase),Pst=KT([].unshift),kU="Invalid scheme",iI="Invalid host",R8="Invalid port",I8=/[a-z]/i,Dst=/[\d+-.a-z]/i,LU=/\d/,kst=/^0x/i,Lst=/^[0-7]+$/,Mst=/^\d+$/,w8=/^[\da-f]+$/i,xst=/[\0\t\n\r #%/:<>?@[\\\]^|]/,Ust=/[\0\t\n\r #/:<>?@[\\\]^|]/,Vst=/^[\u0000-\u0020]+/,jst=/(^|[^\u0000-\u0020])[\u0000-\u0020]+$/,Fst=/[\t\n\r]/g,TN=function(e){var r,i,d,h;if(typeof e=="number"){for(r=[],i=0;i<4;i++)Pst(r,e%256),e=wst(e/256);return yN(r,".")}if(typeof e=="object"){for(r="",d=function(f){for(var g=null,b=1,C=null,P=0,x=0;x<8;x++)f[x]!==0?(P>b&&(g=C,b=P),C=null,P=0):(C===null&&(C=x),++P);return P>b?C:g}(e),i=0;i<8;i++)h&&e[i]===0||(h&&(h=!1),d===i?(r+=i?":":"::",h=!0):(r+=Cst(e[i],16),i<7&&(r+=":")));return"["+r+"]"}return e},DD={},C8=NU({},DD,{" ":1,'"':1,"<":1,">":1,"`":1}),A8=NU({},C8,{"#":1,"?":1,"{":1,"}":1}),MU=NU({},A8,{"/":1,":":1,";":1,"=":1,"@":1,"[":1,"\\":1,"]":1,"^":1,"|":1}),T0=function(e,r){var i=vst(e,0);return i>32&&i<127&&!OU(r,e)?e:encodeURIComponent(e)},LD={ftp:21,file:null,http:80,https:443,ws:80,wss:443},RN=function(e,r){var i;return e.length===2&&lR(I8,zT(e,0))&&((i=zT(e,1))===":"||!r&&i==="|")},O8=function(e){var r;return e.length>1&&RN(SN(e,0,2))&&(e.length===2||(r=zT(e,2))==="/"||r==="\\"||r==="?"||r==="#")},Bst=function(e){return e==="."||PD(e)==="%2e"},xU={},N8={},UU={},P8={},D8={},VU={},k8={},L8={},MD={},xD={},jU={},FU={},BU={},GU={},M8={},qU={},rO={},DR={},x8={},oI={},$R={},WU=function(e,r,i){var d,h,f,g=ZR(e);if(r){if(h=this.parse(g))throw new PU(h);this.searchParams=null}else{if(i!==void 0&&(d=new WU(i,!0)),h=this.parse(g,null,d))throw new PU(h);(f=Ist(new Rst)).bindURL(this),this.searchParams=f}};WU.prototype={type:"URL",parse:function(e,r,i){var d,h,f,g,b,C=this,P=r||xU,x=0,H="",$=!1,_t=!1,_i=!1;for(e=ZR(e),r||(C.scheme="",C.username="",C.password="",C.host=null,C.port=null,C.path=[],C.query=null,C.fragment=null,C.cannotBeABaseURL=!1,e=DU(e,Vst,""),e=DU(e,jst,"$1")),e=DU(e,Fst,""),d=eO(e);x<=d.length;){switch(h=d[x],P){case xU:if(!h||!lR(I8,h)){if(r)return kU;P=UU;continue}H+=PD(h),P=N8;break;case N8:if(h&&(lR(Dst,h)||h==="+"||h==="-"||h==="."))H+=PD(h);else{if(h!==":"){if(r)return kU;H="",P=UU,x=0;continue}if(r&&(C.isSpecial()!==OU(LD,H)||H==="file"&&(C.includesCredentials()||C.port!==null)||C.scheme==="file"&&!C.host))return;if(C.scheme=H,r)return void(C.isSpecial()&&LD[C.scheme]===C.port&&(C.port=null));H="",C.scheme==="file"?P=GU:C.isSpecial()&&i&&i.scheme===C.scheme?P=P8:C.isSpecial()?P=L8:d[x+1]==="/"?(P=D8,x++):(C.cannotBeABaseURL=!0,nO(C.path,""),P=x8)}break;case UU:if(!i||i.cannotBeABaseURL&&h!=="#")return kU;if(i.cannotBeABaseURL&&h==="#"){C.scheme=i.scheme,C.path=dR(i.path),C.query=i.query,C.fragment="",C.cannotBeABaseURL=!0,P=$R;break}P=i.scheme==="file"?GU:VU;continue;case P8:if(h!=="/"||d[x+1]!=="/"){P=VU;continue}P=MD,x++;break;case D8:if(h==="/"){P=xD;break}P=DR;continue;case VU:if(C.scheme=i.scheme,h===WT)C.username=i.username,C.password=i.password,C.host=i.host,C.port=i.port,C.path=dR(i.path),C.query=i.query;else if(h==="/"||h==="\\"&&C.isSpecial())P=k8;else if(h==="?")C.username=i.username,C.password=i.password,C.host=i.host,C.port=i.port,C.path=dR(i.path),C.query="",P=oI;else{if(h!=="#"){C.username=i.username,C.password=i.password,C.host=i.host,C.port=i.port,C.path=dR(i.path),C.path.length--,P=DR;continue}C.username=i.username,C.password=i.password,C.host=i.host,C.port=i.port,C.path=dR(i.path),C.query=i.query,C.fragment="",P=$R}break;case k8:if(!C.isSpecial()||h!=="/"&&h!=="\\"){if(h!=="/"){C.username=i.username,C.password=i.password,C.host=i.host,C.port=i.port,P=DR;continue}P=xD}else P=MD;break;case L8:if(P=MD,h!=="/"||zT(H,x+1)!=="/")continue;x++;break;case MD:if(h!=="/"&&h!=="\\"){P=xD;continue}break;case xD:if(h==="@"){$&&(H="%40"+H),$=!0,f=eO(H);for(var ue=0;ue<f.length;ue++){var _r=f[ue];if(_r!==":"||_i){var Fi=T0(_r,MU);_i?C.password+=Fi:C.username+=Fi}else _i=!0}H=""}else if(h===WT||h==="/"||h==="?"||h==="#"||h==="\\"&&C.isSpecial()){if($&&H==="")return"Invalid authority";x-=eO(H).length+1,H="",P=jU}else H+=h;break;case jU:case FU:if(r&&C.scheme==="file"){P=qU;continue}if(h!==":"||_t){if(h===WT||h==="/"||h==="?"||h==="#"||h==="\\"&&C.isSpecial()){if(C.isSpecial()&&H==="")return iI;if(r&&H===""&&(C.includesCredentials()||C.port!==null))return;if(g=C.parseHost(H))return g;if(H="",P=rO,r)return;continue}h==="["?_t=!0:h==="]"&&(_t=!1),H+=h}else{if(H==="")return iI;if(g=C.parseHost(H))return g;if(H="",P=BU,r===FU)return}break;case BU:if(!lR(LU,h)){if(h===WT||h==="/"||h==="?"||h==="#"||h==="\\"&&C.isSpecial()||r){if(H!==""){var Di=ND(H,10);if(Di>65535)return R8;C.port=C.isSpecial()&&Di===LD[C.scheme]?null:Di,H=""}if(r)return;P=rO;continue}return R8}H+=h;break;case GU:if(C.scheme="file",h==="/"||h==="\\")P=M8;else{if(!i||i.scheme!=="file"){P=DR;continue}switch(h){case WT:C.host=i.host,C.path=dR(i.path),C.query=i.query;break;case"?":C.host=i.host,C.path=dR(i.path),C.query="",P=oI;break;case"#":C.host=i.host,C.path=dR(i.path),C.query=i.query,C.fragment="",P=$R;break;default:O8(yN(dR(d,x),""))||(C.host=i.host,C.path=dR(i.path),C.shortenPath()),P=DR;continue}}break;case M8:if(h==="/"||h==="\\"){P=qU;break}i&&i.scheme==="file"&&!O8(yN(dR(d,x),""))&&(RN(i.path[0],!0)?nO(C.path,i.path[0]):C.host=i.host),P=DR;continue;case qU:if(h===WT||h==="/"||h==="\\"||h==="?"||h==="#"){if(!r&&RN(H))P=DR;else if(H===""){if(C.host="",r)return;P=rO}else{if(g=C.parseHost(H))return g;if(C.host==="localhost"&&(C.host=""),r)return;H="",P=rO}continue}H+=h;break;case rO:if(C.isSpecial()){if(P=DR,h!=="/"&&h!=="\\")continue}else if(r||h!=="?")if(r||h!=="#"){if(h!==WT&&(P=DR,h!=="/"))continue}else C.fragment="",P=$R;else C.query="",P=oI;break;case DR:if(h===WT||h==="/"||h==="\\"&&C.isSpecial()||!r&&(h==="?"||h==="#")){if((b=PD(b=H))===".."||b==="%2e."||b===".%2e"||b==="%2e%2e"?(C.shortenPath(),h==="/"||h==="\\"&&C.isSpecial()||nO(C.path,"")):Bst(H)?h==="/"||h==="\\"&&C.isSpecial()||nO(C.path,""):(C.scheme==="file"&&!C.path.length&&RN(H)&&(C.host&&(C.host=""),H=zT(H,0)+":"),nO(C.path,H)),H="",C.scheme==="file"&&(h===WT||h==="?"||h==="#"))for(;C.path.length>1&&C.path[0]==="";)Ost(C.path);h==="?"?(C.query="",P=oI):h==="#"&&(C.fragment="",P=$R)}else H+=T0(h,A8);break;case x8:h==="?"?(C.query="",P=oI):h==="#"?(C.fragment="",P=$R):h!==WT&&(C.path[0]+=T0(h,DD));break;case oI:r||h!=="#"?h!==WT&&(h==="'"&&C.isSpecial()?C.query+="%27":C.query+=h==="#"?"%23":T0(h,DD)):(C.fragment="",P=$R);break;case $R:h!==WT&&(C.fragment+=T0(h,C8))}x++}},parseHost:function(e){var r,i,d;if(zT(e,0)==="["){if(zT(e,e.length-1)!=="]"||(r=function(h){var f,g,b,C,P,x,H,$=[0,0,0,0,0,0,0,0],_t=0,_i=null,ue=0,_r=function(){return zT(h,ue)};if(_r()===":"){if(zT(h,1)!==":")return;ue+=2,_i=++_t}for(;_r();){if(_t===8)return;if(_r()!==":"){for(f=g=0;g<4&&lR(w8,_r());)f=16*f+ND(_r(),16),ue++,g++;if(_r()==="."){if(g===0||(ue-=g,_t>6))return;for(b=0;_r();){if(C=null,b>0){if(!(_r()==="."&&b<4))return;ue++}if(!lR(LU,_r()))return;for(;lR(LU,_r());){if(P=ND(_r(),10),C===null)C=P;else{if(C===0)return;C=10*C+P}if(C>255)return;ue++}$[_t]=256*$[_t]+C,++b!=2&&b!==4||_t++}if(b!==4)return;break}if(_r()===":"){if(ue++,!_r())return}else if(_r())return;$[_t++]=f}else{if(_i!==null)return;ue++,_i=++_t}}if(_i!==null)for(x=_t-_i,_t=7;_t!==0&&x>0;)H=$[_t],$[_t--]=$[_i+x-1],$[_i+--x]=H;else if(_t!==8)return;return $}(SN(e,1,-1)),!r))return iI;this.host=r}else if(this.isSpecial()){if(e=bst(e),lR(xst,e)||(r=function(h){var f,g,b,C,P,x,H,$=Nst(h,".");if($.length&&$[$.length-1]===""&&$.length--,(f=$.length)>4)return h;for(g=[],b=0;b<f;b++){if((C=$[b])==="")return h;if(P=10,C.length>1&&zT(C,0)==="0"&&(P=lR(kst,C)?16:8,C=SN(C,P===8?1:2)),C==="")x=0;else{if(!lR(P===10?Mst:P===8?Lst:w8,C))return h;x=ND(C,P)}nO(g,x)}for(b=0;b<f;b++)if(x=g[b],b===f-1){if(x>=T8(256,5-f))return null}else if(x>255)return null;for(H=Ast(g),b=0;b<g.length;b++)H+=g[b]*T8(256,3-b);return H}(e),r===null))return iI;this.host=r}else{if(lR(Ust,e))return iI;for(r="",i=eO(e),d=0;d<i.length;d++)r+=T0(i[d],DD);this.host=r}},cannotHaveUsernamePasswordPort:function(){return!this.host||this.cannotBeABaseURL||this.scheme==="file"},includesCredentials:function(){return this.username!==""||this.password!==""},isSpecial:function(){return OU(LD,this.scheme)},shortenPath:function(){var e=this.path,r=e.length;!r||this.scheme==="file"&&r===1&&RN(e[0],!0)||e.length--},serialize:function(){var e=this,r=e.scheme,i=e.username,d=e.password,h=e.host,f=e.port,g=e.path,b=e.query,C=e.fragment,P=r+":";return h!==null?(P+="//",e.includesCredentials()&&(P+=i+(d?":"+d:"")+"@"),P+=TN(h),f!==null&&(P+=":"+f)):r==="file"&&(P+="//"),P+=e.cannotBeABaseURL?g[0]:g.length?"/"+yN(g,"/"):"",b!==null&&(P+="?"+b),C!==null&&(P+="#"+C),P},setHref:function(e){var r=this.parse(e);if(r)throw new PU(r);this.searchParams.update()},getOrigin:function(){var e=this.scheme,r=this.port;if(e==="blob")try{return new iO(e.path[0]).origin}catch{return"null"}return e!=="file"&&this.isSpecial()?e+"://"+TN(this.host)+(r!==null?":"+r:""):"null"},getProtocol:function(){return this.scheme+":"},setProtocol:function(e){this.parse(ZR(e)+":",xU)},getUsername:function(){return this.username},setUsername:function(e){var r=eO(ZR(e));if(!this.cannotHaveUsernamePasswordPort()){this.username="";for(var i=0;i<r.length;i++)this.username+=T0(r[i],MU)}},getPassword:function(){return this.password},setPassword:function(e){var r=eO(ZR(e));if(!this.cannotHaveUsernamePasswordPort()){this.password="";for(var i=0;i<r.length;i++)this.password+=T0(r[i],MU)}},getHost:function(){var e=this.host,r=this.port;return e===null?"":r===null?TN(e):TN(e)+":"+r},setHost:function(e){this.cannotBeABaseURL||this.parse(e,jU)},getHostname:function(){var e=this.host;return e===null?"":TN(e)},setHostname:function(e){this.cannotBeABaseURL||this.parse(e,FU)},getPort:function(){var e=this.port;return e===null?"":ZR(e)},setPort:function(e){this.cannotHaveUsernamePasswordPort()||((e=ZR(e))===""?this.port=null:this.parse(e,BU))},getPathname:function(){var e=this.path;return this.cannotBeABaseURL?e[0]:e.length?"/"+yN(e,"/"):""},setPathname:function(e){this.cannotBeABaseURL||(this.path=[],this.parse(e,rO))},getSearch:function(){var e=this.query;return e?"?"+e:""},setSearch:function(e){(e=ZR(e))===""?this.query=null:(zT(e,0)==="?"&&(e=SN(e,1)),this.query="",this.parse(e,oI)),this.searchParams.update()},getSearchParams:function(){return this.searchParams.facade},getHash:function(){var e=this.fragment;return e?"#"+e:""},setHash:function(e){(e=ZR(e))!==""?(zT(e,0)==="#"&&(e=SN(e,1)),this.fragment="",this.parse(e,$R)):this.fragment=null},update:function(){this.query=this.searchParams.serialize()||null}};var iO=function(e){var r=gst(this,cT),i=Sst(arguments.length,1)>1?arguments[1]:void 0,d=Tst(r,new WU(e,!1,i));CU||(r.href=d.serialize(),r.origin=d.getOrigin(),r.protocol=d.getProtocol(),r.username=d.getUsername(),r.password=d.getPassword(),r.host=d.getHost(),r.hostname=d.getHostname(),r.port=d.getPort(),r.pathname=d.getPathname(),r.search=d.getSearch(),r.searchParams=d.getSearchParams(),r.hash=d.getHash())},cT=iO.prototype,YT=function(e,r){return{get:function(){return OD(this)[e]()},set:r&&function(i){return OD(this)[r](i)},configurable:!0,enumerable:!0}};if(CU&&(HT(cT,"href",YT("serialize","setHref")),HT(cT,"origin",YT("getOrigin")),HT(cT,"protocol",YT("getProtocol","setProtocol")),HT(cT,"username",YT("getUsername","setUsername")),HT(cT,"password",YT("getPassword","setPassword")),HT(cT,"host",YT("getHost","setHost")),HT(cT,"hostname",YT("getHostname","setHostname")),HT(cT,"port",YT("getPort","setPort")),HT(cT,"pathname",YT("getPathname","setPathname")),HT(cT,"search",YT("getSearch","setSearch")),HT(cT,"searchParams",YT("getSearchParams")),HT(cT,"hash",YT("getHash","setHash"))),AD(cT,"toJSON",function(){return OD(this).serialize()},{enumerable:!0}),AD(cT,"toString",function(){return OD(this).serialize()},{enumerable:!0}),bN){var U8=bN.createObjectURL,V8=bN.revokeObjectURL;U8&&AD(iO,"createObjectURL",b8(U8,bN)),V8&&AD(iO,"revokeObjectURL",b8(V8,bN))}yst(iO,"URL"),_st({global:!0,forced:!Est,sham:!CU},{URL:iO});var Gst=bE,j8=A,qst=tI,F8=hT,Wst=SD,KU=HS("URL"),Kst=Wst&&j8(function(){KU.canParse()}),Hst=j8(function(){return KU.canParse.length!==1});Gst({target:"URL",stat:!0,forced:!Kst||Hst},{canParse:function(e){var r=qst(arguments.length,1),i=F8(e),d=r<2||arguments[1]===void 0?void 0:F8(arguments[1]);try{return!!new KU(i,d)}catch{return!1}}});var zst=bE,Yst=tI,B8=hT,Jst=SD,Xst=HS("URL");zst({target:"URL",stat:!0,forced:!Jst},{parse:function(e){var r=Yst(arguments.length,1),i=B8(e),d=r<2||arguments[1]===void 0?void 0:B8(arguments[1]);try{return new Xst(i,d)}catch{return null}}});var UD=_(bS.URL);let G8=!0,q8=!0;function VD(e,r,i){const d=e.match(r);return d&&d.length>=i&&parseInt(d[i],10)}function sI(e,r,i){if(!e.RTCPeerConnection)return;const d=e.RTCPeerConnection.prototype,h=d.addEventListener;d.addEventListener=function(g,b){if(g!==r)return h.apply(this,arguments);const C=P=>{const x=i(P);x&&(b.handleEvent?b.handleEvent(x):b(x))};return this._eventMap=this._eventMap||{},this._eventMap[r]||(this._eventMap[r]=new Map),this._eventMap[r].set(b,C),h.apply(this,[g,C])};const f=d.removeEventListener;d.removeEventListener=function(g,b){if(g!==r||!this._eventMap||!this._eventMap[r])return f.apply(this,arguments);if(!this._eventMap[r].has(b))return f.apply(this,arguments);const C=this._eventMap[r].get(b);return this._eventMap[r].delete(b),this._eventMap[r].size===0&&delete this._eventMap[r],Object.keys(this._eventMap).length===0&&delete this._eventMap,f.apply(this,[g,C])},Object.defineProperty(d,"on"+r,{get(){return this["_on"+r]},set(g){this["_on"+r]&&(this.removeEventListener(r,this["_on"+r]),delete this["_on"+r]),g&&this.addEventListener(r,this["_on"+r]=g)},enumerable:!0,configurable:!0})}function Qst(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(G8=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Zst(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(q8=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function W8(){if(typeof window=="object"){if(G8)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function HU(e,r){q8&&console.warn(e+" is deprecated, please use "+r+" instead.")}function K8(e){return Object.prototype.toString.call(e)==="[object Object]"}function H8(e){var r;return K8(e)?GT(r=Object.keys(e)).call(r,function(i,d){const h=K8(e[d]),f=h?H8(e[d]):e[d],g=h&&!Object.keys(f).length;return f===void 0||g?i:Object.assign(i,{[d]:f})},{}):e}function zU(e,r,i){r&&!i.has(r.id)&&(i.set(r.id,r),Object.keys(r).forEach(d=>{d.endsWith("Id")?zU(e,e.get(r[d]),i):d.endsWith("Ids")&&r[d].forEach(h=>{zU(e,e.get(h),i)})}))}function z8(e,r,i){const d=i?"outbound-rtp":"inbound-rtp",h=new Map;if(r===null)return h;const f=[];return e.forEach(g=>{g.type==="track"&&g.trackIdentifier===r.id&&f.push(g)}),f.forEach(g=>{e.forEach(b=>{b.type===d&&b.trackId===g.id&&zU(e,b,h)})}),h}const Y8=W8;function J8(e,r){const i=e&&e.navigator;if(!i.mediaDevices)return;const d=function(g){if(typeof g!="object"||g.mandatory||g.optional)return g;const b={};return Object.keys(g).forEach(C=>{if(C==="require"||C==="advanced"||C==="mediaSource")return;const P=typeof g[C]=="object"?g[C]:{ideal:g[C]};P.exact!==void 0&&typeof P.exact=="number"&&(P.min=P.max=P.exact);const x=function(H,$){return H?H+$.charAt(0).toUpperCase()+$.slice(1):$==="deviceId"?"sourceId":$};if(P.ideal!==void 0){b.optional=b.optional||[];let H={};typeof P.ideal=="number"?(H[x("min",C)]=P.ideal,b.optional.push(H),H={},H[x("max",C)]=P.ideal,b.optional.push(H)):(H[x("",C)]=P.ideal,b.optional.push(H))}P.exact!==void 0&&typeof P.exact!="number"?(b.mandatory=b.mandatory||{},b.mandatory[x("",C)]=P.exact):["min","max"].forEach(H=>{P[H]!==void 0&&(b.mandatory=b.mandatory||{},b.mandatory[x(H,C)]=P[H])})}),g.advanced&&(b.optional=(b.optional||[]).concat(g.advanced)),b},h=function(g,b){if(r.version>=61)return b(g);if((g=JSON.parse(JSON.stringify(g)))&&typeof g.audio=="object"){const C=function(P,x,H){x in P&&!(H in P)&&(P[H]=P[x],delete P[x])};C((g=JSON.parse(JSON.stringify(g))).audio,"autoGainControl","googAutoGainControl"),C(g.audio,"noiseSuppression","googNoiseSuppression"),g.audio=d(g.audio)}if(g&&typeof g.video=="object"){let C=g.video.facingMode;C=C&&(typeof C=="object"?C:{ideal:C});const P=r.version<66;if(C&&(C.exact==="user"||C.exact==="environment"||C.ideal==="user"||C.ideal==="environment")&&(!i.mediaDevices.getSupportedConstraints||!i.mediaDevices.getSupportedConstraints().facingMode||P)){let x;if(delete g.video.facingMode,C.exact==="environment"||C.ideal==="environment"?x=["back","rear"]:C.exact!=="user"&&C.ideal!=="user"||(x=["front"]),x)return i.mediaDevices.enumerateDevices().then(H=>{H=H.filter(_t=>_t.kind==="videoinput");let $=H.find(_t=>x.some(_i=>{var ue;return E_(ue=_t.label.toLowerCase()).call(ue,_i)}));return!$&&H.length&&E_(x).call(x,"back")&&($=H[H.length-1]),$&&(g.video.deviceId=C.exact?{exact:$.deviceId}:{ideal:$.deviceId}),g.video=d(g.video),Y8("chrome: "+JSON.stringify(g)),b(g)})}g.video=d(g.video)}return Y8("chrome: "+JSON.stringify(g)),b(g)},f=function(g){return r.version>=64?g:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[g.name]||g.name,message:g.message,constraint:g.constraint||g.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(i.getUserMedia=(function(g,b,C){h(g,P=>{i.webkitGetUserMedia(P,b,x=>{C&&C(f(x))})})}).bind(i),i.mediaDevices.getUserMedia){const g=i.mediaDevices.getUserMedia.bind(i.mediaDevices);i.mediaDevices.getUserMedia=function(b){return h(b,C=>g(C).then(P=>{if(C.audio&&!P.getAudioTracks().length||C.video&&!P.getVideoTracks().length)throw P.getTracks().forEach(x=>{x.stop()}),new DOMException("","NotFoundError");return P},P=>T_.reject(f(P))))}}}function X8(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Q8(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(i){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=i)},enumerable:!0,configurable:!0});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=i=>{i.stream.addEventListener("addtrack",d=>{let h;h=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(g=>g.track&&g.track.id===d.track.id):{track:d.track};const f=new Event("track");f.track=d.track,f.receiver=h,f.transceiver={receiver:h},f.streams=[i.stream],this.dispatchEvent(f)}),i.stream.getTracks().forEach(d=>{let h;h=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(g=>g.track&&g.track.id===d.id):{track:d};const f=new Event("track");f.track=d,f.receiver=h,f.transceiver={receiver:h},f.streams=[i.stream],this.dispatchEvent(f)})},this.addEventListener("addstream",this._ontrackpoly)),r.apply(this,arguments)}}else sI(e,"track",r=>(r.transceiver||Object.defineProperty(r,"transceiver",{value:{receiver:r.receiver}}),r))}function Z8(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const r=function(h,f){return{track:f,get dtmf(){return this._dtmf===void 0&&(f.kind==="audio"?this._dtmf=h.createDTMFSender(f):this._dtmf=null),this._dtmf},_pc:h}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const h=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(g,b){let C=h.apply(this,arguments);return C||(C=r(this,g),this._senders.push(C)),C};const f=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(g){f.apply(this,arguments);const b=this._senders.indexOf(g);b!==-1&&this._senders.splice(b,1)}}const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(h){this._senders=this._senders||[],i.apply(this,[h]),h.getTracks().forEach(f=>{this._senders.push(r(this,f))})};const d=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(h){this._senders=this._senders||[],d.apply(this,[h]),h.getTracks().forEach(f=>{const g=this._senders.find(b=>b.track===f);g&&this._senders.splice(this._senders.indexOf(g),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const i=r.apply(this,[]);return i.forEach(d=>d._pc=this),i},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function $8(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[i,d,h]=arguments;if(arguments.length>0&&typeof i=="function")return r.apply(this,arguments);if(r.length===0&&(arguments.length===0||typeof i!="function"))return r.apply(this,[]);const f=function(b){const C={};return b.result().forEach(P=>{const x={id:P.id,timestamp:P.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[P.type]||P.type};P.names().forEach(H=>{x[H]=P.stat(H)}),C[x.id]=x}),C},g=function(b){return new Map(Object.keys(b).map(C=>[C,b[C]]))};if(arguments.length>=2){const b=function(C){d(g(f(C)))};return r.apply(this,[b,i])}return new T_((b,C)=>{r.apply(this,[function(P){b(g(f(P)))},C])}).then(d,h)}}function tK(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const i=e.RTCPeerConnection.prototype.getSenders;i&&(e.RTCPeerConnection.prototype.getSenders=function(){const h=i.apply(this,[]);return h.forEach(f=>f._pc=this),h});const d=e.RTCPeerConnection.prototype.addTrack;d&&(e.RTCPeerConnection.prototype.addTrack=function(){const h=d.apply(this,arguments);return h._pc=this,h}),e.RTCRtpSender.prototype.getStats=function(){const h=this;return this._pc.getStats().then(f=>z8(f,h.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const i=e.RTCPeerConnection.prototype.getReceivers;i&&(e.RTCPeerConnection.prototype.getReceivers=function(){const d=i.apply(this,[]);return d.forEach(h=>h._pc=this),d}),sI(e,"track",d=>(d.receiver._pc=d.srcElement,d)),e.RTCRtpReceiver.prototype.getStats=function(){const d=this;return this._pc.getStats().then(h=>z8(h,d.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const i=arguments[0];let d,h,f;return this.getSenders().forEach(g=>{g.track===i&&(d?f=!0:d=g)}),this.getReceivers().forEach(g=>(g.track===i&&(h?f=!0:h=g),g.track===i)),f||d&&h?T_.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):d?d.getStats():h?h.getStats():T_.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return r.apply(this,arguments)}}function eK(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(f=>this._shimmedLocalStreams[f][0])};const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(f,g){if(!g)return r.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const b=r.apply(this,arguments);return this._shimmedLocalStreams[g.id]?this._shimmedLocalStreams[g.id].indexOf(b)===-1&&this._shimmedLocalStreams[g.id].push(b):this._shimmedLocalStreams[g.id]=[g,b],b};const i=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(f){this._shimmedLocalStreams=this._shimmedLocalStreams||{},f.getTracks().forEach(C=>{if(this.getSenders().find(x=>x.track===C))throw new DOMException("Track already exists.","InvalidAccessError")});const g=this.getSenders();i.apply(this,arguments);const b=this.getSenders().filter(C=>g.indexOf(C)===-1);this._shimmedLocalStreams[f.id]=[f].concat(b)};const d=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(f){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[f.id],d.apply(this,arguments)};const h=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(f){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},f&&Object.keys(this._shimmedLocalStreams).forEach(g=>{const b=this._shimmedLocalStreams[g].indexOf(f);b!==-1&&this._shimmedLocalStreams[g].splice(b,1),this._shimmedLocalStreams[g].length===1&&delete this._shimmedLocalStreams[g]}),h.apply(this,arguments)}}function nK(e,r){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&r.version>=65)return eK(e);const i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const C=i.apply(this);return this._reverseStreams=this._reverseStreams||{},C.map(P=>this._reverseStreams[P.id])};const d=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(C){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},C.getTracks().forEach(P=>{if(this.getSenders().find(H=>H.track===P))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[C.id]){const P=new e.MediaStream(C.getTracks());this._streams[C.id]=P,this._reverseStreams[P.id]=C,C=P}d.apply(this,[C])};const h=e.RTCPeerConnection.prototype.removeStream;function f(C,P){let x=P.sdp;return Object.keys(C._reverseStreams||[]).forEach(H=>{const $=C._reverseStreams[H],_t=C._streams[$.id];x=x.replace(new RegExp(_t.id,"g"),$.id)}),new RTCSessionDescription({type:P.type,sdp:x})}e.RTCPeerConnection.prototype.removeStream=function(C){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},h.apply(this,[this._streams[C.id]||C]),delete this._reverseStreams[this._streams[C.id]?this._streams[C.id].id:C.id],delete this._streams[C.id]},e.RTCPeerConnection.prototype.addTrack=function(C,P){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const x=[].slice.call(arguments,1);if(x.length!==1||!x[0].getTracks().find(_t=>_t===C))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(_t=>_t.track===C))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const $=this._streams[P.id];if($)$.addTrack(C),T_.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const _t=new e.MediaStream([C]);this._streams[P.id]=_t,this._reverseStreams[_t.id]=P,this.addStream(_t)}return this.getSenders().find(_t=>_t.track===C)},["createOffer","createAnswer"].forEach(function(C){const P=e.RTCPeerConnection.prototype[C],x={[C](){const H=arguments;return arguments.length&&typeof arguments[0]=="function"?P.apply(this,[$=>{const _t=f(this,$);H[0].apply(null,[_t])},$=>{H[1]&&H[1].apply(null,$)},arguments[2]]):P.apply(this,arguments).then($=>f(this,$))}};e.RTCPeerConnection.prototype[C]=x[C]});const g=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=function(C,P){let x=P.sdp;return Object.keys(C._reverseStreams||[]).forEach(H=>{const $=C._reverseStreams[H],_t=C._streams[$.id];x=x.replace(new RegExp($.id,"g"),_t.id)}),new RTCSessionDescription({type:P.type,sdp:x})}(this,arguments[0]),g.apply(this,arguments)):g.apply(this,arguments)};const b=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const C=b.get.apply(this);return C.type===""?C:f(this,C)}}),e.RTCPeerConnection.prototype.removeTrack=function(C){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!C._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(C._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let P;this._streams=this._streams||{},Object.keys(this._streams).forEach(x=>{this._streams[x].getTracks().find(H=>C.track===H)&&(P=this._streams[x])}),P&&(P.getTracks().length===1?this.removeStream(this._reverseStreams[P.id]):P.removeTrack(C.track),this.dispatchEvent(new Event("negotiationneeded")))}}function YU(e,r){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(i){const d=e.RTCPeerConnection.prototype[i],h={[i](){return arguments[0]=new(i==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),d.apply(this,arguments)}};e.RTCPeerConnection.prototype[i]=h[i]})}function rK(e,r){sI(e,"negotiationneeded",i=>{const d=i.target;if(!(r.version<72||d.getConfiguration&&d.getConfiguration().sdpSemantics==="plan-b")||d.signalingState==="stable")return i})}var iK=Object.freeze({__proto__:null,fixNegotiationNeeded:rK,shimAddTrackRemoveTrack:nK,shimAddTrackRemoveTrackWithNative:eK,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof r=="function"?e.navigator.mediaDevices.getDisplayMedia=function(i){return r(i).then(d=>{const h=i.video&&i.video.width,f=i.video&&i.video.height,g=i.video&&i.video.frameRate;return i.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:d,maxFrameRate:g||3}},h&&(i.video.mandatory.maxWidth=h),f&&(i.video.mandatory.maxHeight=f),e.navigator.mediaDevices.getUserMedia(i)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))},shimGetSendersWithDtmf:Z8,shimGetStats:$8,shimGetUserMedia:J8,shimMediaStream:X8,shimOnTrack:Q8,shimPeerConnection:YU,shimSenderReceiverGetStats:tK});function oK(e,r){const i=e&&e.navigator,d=e&&e.MediaStreamTrack;if(i.getUserMedia=function(h,f,g){HU("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),i.mediaDevices.getUserMedia(h).then(f,g)},!(r.version>55&&"autoGainControl"in i.mediaDevices.getSupportedConstraints())){const h=function(g,b,C){b in g&&!(C in g)&&(g[C]=g[b],delete g[b])},f=i.mediaDevices.getUserMedia.bind(i.mediaDevices);if(i.mediaDevices.getUserMedia=function(g){return typeof g=="object"&&typeof g.audio=="object"&&(g=JSON.parse(JSON.stringify(g)),h(g.audio,"autoGainControl","mozAutoGainControl"),h(g.audio,"noiseSuppression","mozNoiseSuppression")),f(g)},d&&d.prototype.getSettings){const g=d.prototype.getSettings;d.prototype.getSettings=function(){const b=g.apply(this,arguments);return h(b,"mozAutoGainControl","autoGainControl"),h(b,"mozNoiseSuppression","noiseSuppression"),b}}if(d&&d.prototype.applyConstraints){const g=d.prototype.applyConstraints;d.prototype.applyConstraints=function(b){return this.kind==="audio"&&typeof b=="object"&&(b=JSON.parse(JSON.stringify(b)),h(b,"autoGainControl","mozAutoGainControl"),h(b,"noiseSuppression","mozNoiseSuppression")),g.apply(this,[b])}}}}function sK(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function JU(e,r){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),r.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(h){const f=e.RTCPeerConnection.prototype[h],g={[h](){return arguments[0]=new(h==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),f.apply(this,arguments)}};e.RTCPeerConnection.prototype[h]=g[h]});const i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},d=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[h,f,g]=arguments;return d.apply(this,[h||null]).then(b=>{if(r.version<53&&!f)try{b.forEach(C=>{C.type=i[C.type]||C.type})}catch(C){if(C.name!=="TypeError")throw C;b.forEach((P,x)=>{b.set(x,Object.assign({},P,{type:i[P.type]||P.type}))})}return b}).then(f,g)}}function aK(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const r=e.RTCPeerConnection.prototype.getSenders;r&&(e.RTCPeerConnection.prototype.getSenders=function(){const d=r.apply(this,[]);return d.forEach(h=>h._pc=this),d});const i=e.RTCPeerConnection.prototype.addTrack;i&&(e.RTCPeerConnection.prototype.addTrack=function(){const d=i.apply(this,arguments);return d._pc=this,d}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):T_.resolve(new Map)}}function cK(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const r=e.RTCPeerConnection.prototype.getReceivers;r&&(e.RTCPeerConnection.prototype.getReceivers=function(){const i=r.apply(this,[]);return i.forEach(d=>d._pc=this),i}),sI(e,"track",i=>(i.receiver._pc=i.srcElement,i)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function uK(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(r){HU("removeStream","removeTrack"),this.getSenders().forEach(i=>{var d;i.track&&E_(d=r.getTracks()).call(d,i.track)&&this.removeTrack(i)})})}function dK(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function lK(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.addTransceiver;r&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let i=arguments[1]&&arguments[1].sendEncodings;i===void 0&&(i=[]),i=[...i];const d=i.length>0;d&&i.forEach(f=>{if("rid"in f&&!/^[a-z0-9]{0,16}$/i.test(f.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in f&&!(parseFloat(f.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in f&&!(parseFloat(f.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const h=r.apply(this,arguments);if(d){const{sender:f}=h,g=f.getParameters();(!("encodings"in g)||g.encodings.length===1&&Object.keys(g.encodings[0]).length===0)&&(g.encodings=i,f.sendEncodings=i,this.setParametersPromises.push(f.setParameters(g).then(()=>{delete f.sendEncodings}).catch(()=>{delete f.sendEncodings})))}return h})}function hK(e){if(typeof e!="object"||!e.RTCRtpSender)return;const r=e.RTCRtpSender.prototype.getParameters;r&&(e.RTCRtpSender.prototype.getParameters=function(){const i=r.apply(this,arguments);return"encodings"in i||(i.encodings=[].concat(this.sendEncodings||[{}])),i})}function pK(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?T_.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}function fK(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?T_.all(this.setParametersPromises).then(()=>r.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):r.apply(this,arguments)}}var mK=Object.freeze({__proto__:null,shimAddTransceiver:lK,shimCreateAnswer:fK,shimCreateOffer:pK,shimGetDisplayMedia:function(e,r){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(i){if(!i||!i.video){const d=new DOMException("getDisplayMedia without video constraints is undefined");return d.name="NotFoundError",d.code=8,T_.reject(d)}return i.video===!0?i.video={mediaSource:r}:i.video.mediaSource=r,e.navigator.mediaDevices.getUserMedia(i)})},shimGetParameters:hK,shimGetUserMedia:oK,shimOnTrack:sK,shimPeerConnection:JU,shimRTCDataChannel:dK,shimReceiverGetStats:cK,shimRemoveStream:uK,shimSenderGetStats:aK});function _K(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const r=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(i){var d;this._localStreams||(this._localStreams=[]),E_(d=this._localStreams).call(d,i)||this._localStreams.push(i),i.getAudioTracks().forEach(h=>r.call(this,h,i)),i.getVideoTracks().forEach(h=>r.call(this,h,i))},e.RTCPeerConnection.prototype.addTrack=function(i){for(var d=arguments.length,h=new Array(d>1?d-1:0),f=1;f<d;f++)h[f-1]=arguments[f];return h&&h.forEach(g=>{var b;this._localStreams?E_(b=this._localStreams).call(b,g)||this._localStreams.push(g):this._localStreams=[g]}),r.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(r){this._localStreams||(this._localStreams=[]);const i=this._localStreams.indexOf(r);if(i===-1)return;this._localStreams.splice(i,1);const d=r.getTracks();this.getSenders().forEach(h=>{E_(d).call(d,h.track)&&this.removeTrack(h)})})}}function EK(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(i){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=i),this.addEventListener("track",this._onaddstreampoly=d=>{d.streams.forEach(h=>{var f;if(this._remoteStreams||(this._remoteStreams=[]),E_(f=this._remoteStreams).call(f,h))return;this._remoteStreams.push(h);const g=new Event("addstream");g.stream=h,this.dispatchEvent(g)})})}});const r=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const i=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(d){d.streams.forEach(h=>{if(i._remoteStreams||(i._remoteStreams=[]),i._remoteStreams.indexOf(h)>=0)return;i._remoteStreams.push(h);const f=new Event("addstream");f.stream=h,i.dispatchEvent(f)})}),r.apply(i,arguments)}}}function gK(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,i=r.createOffer,d=r.createAnswer,h=r.setLocalDescription,f=r.setRemoteDescription,g=r.addIceCandidate;r.createOffer=function(C,P){const x=arguments.length>=2?arguments[2]:arguments[0],H=i.apply(this,[x]);return P?(H.then(C,P),T_.resolve()):H},r.createAnswer=function(C,P){const x=arguments.length>=2?arguments[2]:arguments[0],H=d.apply(this,[x]);return P?(H.then(C,P),T_.resolve()):H};let b=function(C,P,x){const H=h.apply(this,[C]);return x?(H.then(P,x),T_.resolve()):H};r.setLocalDescription=b,b=function(C,P,x){const H=f.apply(this,[C]);return x?(H.then(P,x),T_.resolve()):H},r.setRemoteDescription=b,b=function(C,P,x){const H=g.apply(this,[C]);return x?(H.then(P,x),T_.resolve()):H},r.addIceCandidate=b}function vK(e){const r=e&&e.navigator;if(r.mediaDevices&&r.mediaDevices.getUserMedia){const i=r.mediaDevices,d=i.getUserMedia.bind(i);r.mediaDevices.getUserMedia=h=>d(bK(h))}!r.getUserMedia&&r.mediaDevices&&r.mediaDevices.getUserMedia&&(r.getUserMedia=(function(i,d,h){r.mediaDevices.getUserMedia(i).then(d,h)}).bind(r))}function bK(e){return e&&e.video!==void 0?Object.assign({},e,{video:H8(e.video)}):e}function yK(e){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection;e.RTCPeerConnection=function(i,d){if(i&&i.iceServers){const h=[];for(let f=0;f<i.iceServers.length;f++){let g=i.iceServers[f];!g.hasOwnProperty("urls")&&g.hasOwnProperty("url")?(HU("RTCIceServer.url","RTCIceServer.urls"),g=JSON.parse(JSON.stringify(g)),g.urls=g.url,delete g.url,h.push(g)):h.push(i.iceServers[f])}i.iceServers=h}return new r(i,d)},e.RTCPeerConnection.prototype=r.prototype,"generateCertificate"in r&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>r.generateCertificate})}function SK(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function TK(e){const r=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(i){if(i){i.offerToReceiveAudio!==void 0&&(i.offerToReceiveAudio=!!i.offerToReceiveAudio);const d=this.getTransceivers().find(f=>f.receiver.track.kind==="audio");i.offerToReceiveAudio===!1&&d?d.direction==="sendrecv"?d.setDirection?d.setDirection("sendonly"):d.direction="sendonly":d.direction==="recvonly"&&(d.setDirection?d.setDirection("inactive"):d.direction="inactive"):i.offerToReceiveAudio!==!0||d||this.addTransceiver("audio",{direction:"recvonly"}),i.offerToReceiveVideo!==void 0&&(i.offerToReceiveVideo=!!i.offerToReceiveVideo);const h=this.getTransceivers().find(f=>f.receiver.track.kind==="video");i.offerToReceiveVideo===!1&&h?h.direction==="sendrecv"?h.setDirection?h.setDirection("sendonly"):h.direction="sendonly":h.direction==="recvonly"&&(h.setDirection?h.setDirection("inactive"):h.direction="inactive"):i.offerToReceiveVideo!==!0||h||this.addTransceiver("video",{direction:"recvonly"})}return r.apply(this,arguments)}}function RK(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var IK=Object.freeze({__proto__:null,shimAudioContext:RK,shimCallbacksAPI:gK,shimConstraints:bK,shimCreateOfferLegacy:TK,shimGetUserMedia:vK,shimLocalStreamsAPI:_K,shimRTCIceServerUrls:yK,shimRemoteStreamsAPI:EK,shimTrackEventTransceiver:SK}),wK=`	
\v\f\r                　\u2028\u2029\uFEFF`,$st=hS,tat=hT,XU=wK,CK=_e("".replace),eat=RegExp("^["+XU+"]+"),nat=RegExp("(^|[^"+XU+"])["+XU+"]+$"),rat=function(e){return function(r){var i=tat($st(r));return 1&e&&(i=CK(i,eat,"")),2&e&&(i=CK(i,nat,"$1")),i}},iat={trim:rat(3)},oat=l5.PROPER,sat=A,AK=wK,aat=iat.trim;bE({target:"String",proto:!0,forced:function(e){return sat(function(){return!!AK[e]()||"​᠎"[e]()!=="​᠎"||oat&&AK[e].name!==e})}("trim")},{trim:function(){return aat(this)}});var cat=BT("String","trim"),uat=_n,dat=cat,QU=String.prototype,lat=function(e){var r=e.trim;return typeof e=="string"||e===QU||uat(QU,e)&&r===QU.trim?dat:r},xS=_(lat),OK={exports:{}};(function(e){const r={generateIdentifier:function(){return Math.random().toString(36).substring(2,12)}};r.localCName=r.generateIdentifier(),r.splitLines=function(i){return i.trim().split(`
`).map(d=>d.trim())},r.splitSections=function(i){return i.split(`
m=`).map((d,h)=>(h>0?"m="+d:d).trim()+`\r
`)},r.getDescription=function(i){const d=r.splitSections(i);return d&&d[0]},r.getMediaSections=function(i){const d=r.splitSections(i);return d.shift(),d},r.matchPrefix=function(i,d){return r.splitLines(i).filter(h=>h.indexOf(d)===0)},r.parseCandidate=function(i){let d;d=i.indexOf("a=candidate:")===0?i.substring(12).split(" "):i.substring(10).split(" ");const h={foundation:d[0],component:{1:"rtp",2:"rtcp"}[d[1]]||d[1],protocol:d[2].toLowerCase(),priority:parseInt(d[3],10),ip:d[4],address:d[4],port:parseInt(d[5],10),type:d[7]};for(let f=8;f<d.length;f+=2)switch(d[f]){case"raddr":h.relatedAddress=d[f+1];break;case"rport":h.relatedPort=parseInt(d[f+1],10);break;case"tcptype":h.tcpType=d[f+1];break;case"ufrag":h.ufrag=d[f+1],h.usernameFragment=d[f+1];break;default:h[d[f]]===void 0&&(h[d[f]]=d[f+1])}return h},r.writeCandidate=function(i){const d=[];d.push(i.foundation);const h=i.component;h==="rtp"?d.push(1):h==="rtcp"?d.push(2):d.push(h),d.push(i.protocol.toUpperCase()),d.push(i.priority),d.push(i.address||i.ip),d.push(i.port);const f=i.type;return d.push("typ"),d.push(f),f!=="host"&&i.relatedAddress&&i.relatedPort&&(d.push("raddr"),d.push(i.relatedAddress),d.push("rport"),d.push(i.relatedPort)),i.tcpType&&i.protocol.toLowerCase()==="tcp"&&(d.push("tcptype"),d.push(i.tcpType)),(i.usernameFragment||i.ufrag)&&(d.push("ufrag"),d.push(i.usernameFragment||i.ufrag)),"candidate:"+d.join(" ")},r.parseIceOptions=function(i){return i.substring(14).split(" ")},r.parseRtpMap=function(i){let d=i.substring(9).split(" ");const h={payloadType:parseInt(d.shift(),10)};return d=d[0].split("/"),h.name=d[0],h.clockRate=parseInt(d[1],10),h.channels=d.length===3?parseInt(d[2],10):1,h.numChannels=h.channels,h},r.writeRtpMap=function(i){let d=i.payloadType;i.preferredPayloadType!==void 0&&(d=i.preferredPayloadType);const h=i.channels||i.numChannels||1;return"a=rtpmap:"+d+" "+i.name+"/"+i.clockRate+(h!==1?"/"+h:"")+`\r
`},r.parseExtmap=function(i){const d=i.substring(9).split(" ");return{id:parseInt(d[0],10),direction:d[0].indexOf("/")>0?d[0].split("/")[1]:"sendrecv",uri:d[1],attributes:d.slice(2).join(" ")}},r.writeExtmap=function(i){return"a=extmap:"+(i.id||i.preferredId)+(i.direction&&i.direction!=="sendrecv"?"/"+i.direction:"")+" "+i.uri+(i.attributes?" "+i.attributes:"")+`\r
`},r.parseFmtp=function(i){const d={};let h;const f=i.substring(i.indexOf(" ")+1).split(";");for(let g=0;g<f.length;g++)h=f[g].trim().split("="),d[h[0].trim()]=h[1];return d},r.writeFmtp=function(i){let d="",h=i.payloadType;if(i.preferredPayloadType!==void 0&&(h=i.preferredPayloadType),i.parameters&&Object.keys(i.parameters).length){const f=[];Object.keys(i.parameters).forEach(g=>{i.parameters[g]!==void 0?f.push(g+"="+i.parameters[g]):f.push(g)}),d+="a=fmtp:"+h+" "+f.join(";")+`\r
`}return d},r.parseRtcpFb=function(i){const d=i.substring(i.indexOf(" ")+1).split(" ");return{type:d.shift(),parameter:d.join(" ")}},r.writeRtcpFb=function(i){let d="",h=i.payloadType;return i.preferredPayloadType!==void 0&&(h=i.preferredPayloadType),i.rtcpFeedback&&i.rtcpFeedback.length&&i.rtcpFeedback.forEach(f=>{d+="a=rtcp-fb:"+h+" "+f.type+(f.parameter&&f.parameter.length?" "+f.parameter:"")+`\r
`}),d},r.parseSsrcMedia=function(i){const d=i.indexOf(" "),h={ssrc:parseInt(i.substring(7,d),10)},f=i.indexOf(":",d);return f>-1?(h.attribute=i.substring(d+1,f),h.value=i.substring(f+1)):h.attribute=i.substring(d+1),h},r.parseSsrcGroup=function(i){const d=i.substring(13).split(" ");return{semantics:d.shift(),ssrcs:d.map(h=>parseInt(h,10))}},r.getMid=function(i){const d=r.matchPrefix(i,"a=mid:")[0];if(d)return d.substring(6)},r.parseFingerprint=function(i){const d=i.substring(14).split(" ");return{algorithm:d[0].toLowerCase(),value:d[1].toUpperCase()}},r.getDtlsParameters=function(i,d){return{role:"auto",fingerprints:r.matchPrefix(i+d,"a=fingerprint:").map(r.parseFingerprint)}},r.writeDtlsParameters=function(i,d){let h="a=setup:"+d+`\r
`;return i.fingerprints.forEach(f=>{h+="a=fingerprint:"+f.algorithm+" "+f.value+`\r
`}),h},r.parseCryptoLine=function(i){const d=i.substring(9).split(" ");return{tag:parseInt(d[0],10),cryptoSuite:d[1],keyParams:d[2],sessionParams:d.slice(3)}},r.writeCryptoLine=function(i){return"a=crypto:"+i.tag+" "+i.cryptoSuite+" "+(typeof i.keyParams=="object"?r.writeCryptoKeyParams(i.keyParams):i.keyParams)+(i.sessionParams?" "+i.sessionParams.join(" "):"")+`\r
`},r.parseCryptoKeyParams=function(i){if(i.indexOf("inline:")!==0)return null;const d=i.substring(7).split("|");return{keyMethod:"inline",keySalt:d[0],lifeTime:d[1],mkiValue:d[2]?d[2].split(":")[0]:void 0,mkiLength:d[2]?d[2].split(":")[1]:void 0}},r.writeCryptoKeyParams=function(i){return i.keyMethod+":"+i.keySalt+(i.lifeTime?"|"+i.lifeTime:"")+(i.mkiValue&&i.mkiLength?"|"+i.mkiValue+":"+i.mkiLength:"")},r.getCryptoParameters=function(i,d){return r.matchPrefix(i+d,"a=crypto:").map(r.parseCryptoLine)},r.getIceParameters=function(i,d){const h=r.matchPrefix(i+d,"a=ice-ufrag:")[0],f=r.matchPrefix(i+d,"a=ice-pwd:")[0];return h&&f?{usernameFragment:h.substring(12),password:f.substring(10)}:null},r.writeIceParameters=function(i){let d="a=ice-ufrag:"+i.usernameFragment+`\r
a=ice-pwd:`+i.password+`\r
`;return i.iceLite&&(d+=`a=ice-lite\r
`),d},r.parseRtpParameters=function(i){const d={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},h=r.splitLines(i)[0].split(" ");d.profile=h[2];for(let g=3;g<h.length;g++){const b=h[g],C=r.matchPrefix(i,"a=rtpmap:"+b+" ")[0];if(C){const P=r.parseRtpMap(C),x=r.matchPrefix(i,"a=fmtp:"+b+" ");switch(P.parameters=x.length?r.parseFmtp(x[0]):{},P.rtcpFeedback=r.matchPrefix(i,"a=rtcp-fb:"+b+" ").map(r.parseRtcpFb),d.codecs.push(P),P.name.toUpperCase()){case"RED":case"ULPFEC":d.fecMechanisms.push(P.name.toUpperCase())}}}r.matchPrefix(i,"a=extmap:").forEach(g=>{d.headerExtensions.push(r.parseExtmap(g))});const f=r.matchPrefix(i,"a=rtcp-fb:* ").map(r.parseRtcpFb);return d.codecs.forEach(g=>{f.forEach(b=>{g.rtcpFeedback.find(C=>C.type===b.type&&C.parameter===b.parameter)||g.rtcpFeedback.push(b)})}),d},r.writeRtpDescription=function(i,d){let h="";h+="m="+i+" ",h+=d.codecs.length>0?"9":"0",h+=" "+(d.profile||"UDP/TLS/RTP/SAVPF")+" ",h+=d.codecs.map(g=>g.preferredPayloadType!==void 0?g.preferredPayloadType:g.payloadType).join(" ")+`\r
`,h+=`c=IN IP4 0.0.0.0\r
`,h+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,d.codecs.forEach(g=>{h+=r.writeRtpMap(g),h+=r.writeFmtp(g),h+=r.writeRtcpFb(g)});let f=0;return d.codecs.forEach(g=>{g.maxptime>f&&(f=g.maxptime)}),f>0&&(h+="a=maxptime:"+f+`\r
`),d.headerExtensions&&d.headerExtensions.forEach(g=>{h+=r.writeExtmap(g)}),h},r.parseRtpEncodingParameters=function(i){const d=[],h=r.parseRtpParameters(i),f=h.fecMechanisms.indexOf("RED")!==-1,g=h.fecMechanisms.indexOf("ULPFEC")!==-1,b=r.matchPrefix(i,"a=ssrc:").map($=>r.parseSsrcMedia($)).filter($=>$.attribute==="cname"),C=b.length>0&&b[0].ssrc;let P;const x=r.matchPrefix(i,"a=ssrc-group:FID").map($=>$.substring(17).split(" ").map(_t=>parseInt(_t,10)));x.length>0&&x[0].length>1&&x[0][0]===C&&(P=x[0][1]),h.codecs.forEach($=>{if($.name.toUpperCase()==="RTX"&&$.parameters.apt){let _t={ssrc:C,codecPayloadType:parseInt($.parameters.apt,10)};C&&P&&(_t.rtx={ssrc:P}),d.push(_t),f&&(_t=JSON.parse(JSON.stringify(_t)),_t.fec={ssrc:C,mechanism:g?"red+ulpfec":"red"},d.push(_t))}}),d.length===0&&C&&d.push({ssrc:C});let H=r.matchPrefix(i,"b=");return H.length&&(H=H[0].indexOf("b=TIAS:")===0?parseInt(H[0].substring(7),10):H[0].indexOf("b=AS:")===0?1e3*parseInt(H[0].substring(5),10)*.95-16e3:void 0,d.forEach($=>{$.maxBitrate=H})),d},r.parseRtcpParameters=function(i){const d={},h=r.matchPrefix(i,"a=ssrc:").map(b=>r.parseSsrcMedia(b)).filter(b=>b.attribute==="cname")[0];h&&(d.cname=h.value,d.ssrc=h.ssrc);const f=r.matchPrefix(i,"a=rtcp-rsize");d.reducedSize=f.length>0,d.compound=f.length===0;const g=r.matchPrefix(i,"a=rtcp-mux");return d.mux=g.length>0,d},r.writeRtcpParameters=function(i){let d="";return i.reducedSize&&(d+=`a=rtcp-rsize\r
`),i.mux&&(d+=`a=rtcp-mux\r
`),i.ssrc!==void 0&&i.cname&&(d+="a=ssrc:"+i.ssrc+" cname:"+i.cname+`\r
`),d},r.parseMsid=function(i){let d;const h=r.matchPrefix(i,"a=msid:");if(h.length===1)return d=h[0].substring(7).split(" "),{stream:d[0],track:d[1]};const f=r.matchPrefix(i,"a=ssrc:").map(g=>r.parseSsrcMedia(g)).filter(g=>g.attribute==="msid");return f.length>0?(d=f[0].value.split(" "),{stream:d[0],track:d[1]}):void 0},r.parseSctpDescription=function(i){const d=r.parseMLine(i),h=r.matchPrefix(i,"a=max-message-size:");let f;h.length>0&&(f=parseInt(h[0].substring(19),10)),isNaN(f)&&(f=65536);const g=r.matchPrefix(i,"a=sctp-port:");if(g.length>0)return{port:parseInt(g[0].substring(12),10),protocol:d.fmt,maxMessageSize:f};const b=r.matchPrefix(i,"a=sctpmap:");if(b.length>0){const C=b[0].substring(10).split(" ");return{port:parseInt(C[0],10),protocol:C[1],maxMessageSize:f}}},r.writeSctpDescription=function(i,d){let h=[];return h=i.protocol!=="DTLS/SCTP"?["m="+i.kind+" 9 "+i.protocol+" "+d.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+d.port+`\r
`]:["m="+i.kind+" 9 "+i.protocol+" "+d.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+d.port+" "+d.protocol+` 65535\r
`],d.maxMessageSize!==void 0&&h.push("a=max-message-size:"+d.maxMessageSize+`\r
`),h.join("")},r.generateSessionId=function(){return Math.random().toString().substr(2,22)},r.writeSessionBoilerplate=function(i,d,h){let f;const g=d!==void 0?d:2;return f=i||r.generateSessionId(),`v=0\r
o=`+(h||"thisisadapterortc")+" "+f+" "+g+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},r.getDirection=function(i,d){const h=r.splitLines(i);for(let f=0;f<h.length;f++)switch(h[f]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return h[f].substring(2)}return d?r.getDirection(d):"sendrecv"},r.getKind=function(i){return r.splitLines(i)[0].split(" ")[0].substring(2)},r.isRejected=function(i){return i.split(" ",2)[1]==="0"},r.parseMLine=function(i){const d=r.splitLines(i)[0].substring(2).split(" ");return{kind:d[0],port:parseInt(d[1],10),protocol:d[2],fmt:d.slice(3).join(" ")}},r.parseOLine=function(i){const d=r.matchPrefix(i,"o=")[0].substring(2).split(" ");return{username:d[0],sessionId:d[1],sessionVersion:parseInt(d[2],10),netType:d[3],addressType:d[4],address:d[5]}},r.isValidSDP=function(i){if(typeof i!="string"||i.length===0)return!1;const d=r.splitLines(i);for(let h=0;h<d.length;h++)if(d[h].length<2||d[h].charAt(1)!=="=")return!1;return!0},e.exports=r})(OK);var NK=OK.exports,oO=_(NK),hat=l({__proto__:null,default:oO},[NK]);function FD(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const r=e.RTCIceCandidate;e.RTCIceCandidate=function(i){if(typeof i=="object"&&i.candidate&&i.candidate.indexOf("a=")===0&&((i=JSON.parse(JSON.stringify(i))).candidate=i.candidate.substr(2)),i.candidate&&i.candidate.length){const d=new r(i),h=oO.parseCandidate(i.candidate),f=Object.assign(d,h);return f.toJSON=function(){return{candidate:f.candidate,sdpMid:f.sdpMid,sdpMLineIndex:f.sdpMLineIndex,usernameFragment:f.usernameFragment}},f}return new r(i)},e.RTCIceCandidate.prototype=r.prototype,sI(e,"icecandidate",i=>(i.candidate&&Object.defineProperty(i,"candidate",{value:new e.RTCIceCandidate(i.candidate),writable:"false"}),i))}function ZU(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||sI(e,"icecandidate",r=>{if(r.candidate){const i=oO.parseCandidate(r.candidate.candidate);i.type==="relay"&&(r.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[i.priority>>24])}return r})}function BD(e,r){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const i=function(b){if(!b||!b.sdp)return!1;const C=oO.splitSections(b.sdp);return C.shift(),C.some(P=>{const x=oO.parseMLine(P);return x&&x.kind==="application"&&x.protocol.indexOf("SCTP")!==-1})},d=function(b){const C=b.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(C===null||C.length<2)return-1;const P=parseInt(C[1],10);return P!=P?-1:P},h=function(b){let C=65536;return r.browser==="firefox"&&(C=r.version<57?b===-1?16384:2147483637:r.version<60?r.version===57?65535:65536:2147483637),C},f=function(b,C){let P=65536;r.browser==="firefox"&&r.version===57&&(P=65535);const x=oO.matchPrefix(b.sdp,"a=max-message-size:");return x.length>0?P=parseInt(x[0].substr(19),10):r.browser==="firefox"&&C!==-1&&(P=2147483637),P},g=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,r.browser==="chrome"&&r.version>=76){const{sdpSemantics:b}=this.getConfiguration();b==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(i(arguments[0])){const b=d(arguments[0]),C=h(b),P=f(arguments[0],b);let x;x=C===0&&P===0?Number.POSITIVE_INFINITY:C===0||P===0?Math.max(C,P):Math.min(C,P);const H={};Object.defineProperty(H,"maxMessageSize",{get:()=>x}),this._sctp=H}return g.apply(this,arguments)}}function GD(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function r(d,h){const f=d.send;d.send=function(){const g=arguments[0],b=g.length||g.size||g.byteLength;if(d.readyState==="open"&&h.sctp&&b>h.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+h.sctp.maxMessageSize+" bytes)");return f.apply(d,arguments)}}const i=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const d=i.apply(this,arguments);return r(d,this),d},sI(e,"datachannel",d=>(r(d.channel,d.target),d))}function $U(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const r=e.RTCPeerConnection.prototype;Object.defineProperty(r,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(r,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(i){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),i&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=i)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(i=>{const d=r[i];r[i]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=h=>{const f=h.target;if(f._lastConnectionState!==f.connectionState){f._lastConnectionState=f.connectionState;const g=new Event("connectionstatechange",h);f.dispatchEvent(g)}return h},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),d.apply(this,arguments)}})}function tV(e,r){if(!e.RTCPeerConnection||r.browser==="chrome"&&r.version>=71||r.browser==="safari"&&r.version>=605)return;const i=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(d){if(d&&d.sdp&&d.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const h=d.sdp.split(`
`).filter(f=>xS(f).call(f)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&d instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:d.type,sdp:h}):d.sdp=h}return i.apply(this,arguments)}}function WD(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.addIceCandidate;i&&i.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(r.browser==="chrome"&&r.version<78||r.browser==="firefox"&&r.version<68||r.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?T_.resolve():i.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),T_.resolve())})}function KD(e,r){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const i=e.RTCPeerConnection.prototype.setLocalDescription;i&&i.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let d=arguments[0]||{};if(typeof d!="object"||d.type&&d.sdp)return i.apply(this,arguments);if(d={type:d.type,sdp:d.sdp},!d.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":d.type="offer";break;default:d.type="answer"}return d.sdp||d.type!=="offer"&&d.type!=="answer"?i.apply(this,[d]):(d.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(h=>i.apply(this,[h]))})}var pat=Object.freeze({__proto__:null,removeExtmapAllowMixed:tV,shimAddIceCandidateNullOrEmpty:WD,shimConnectionState:$U,shimMaxMessageSize:BD,shimParameterlessSetLocalDescription:KD,shimRTCIceCandidate:FD,shimRTCIceCandidateRelayProtocol:ZU,shimSendThrowTypeError:GD});(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const i=W8,d=function(f){const g={browser:null,version:null};if(f===void 0||!f.navigator)return g.browser="Not a browser.",g;const{navigator:b}=f;if(b.mozGetUserMedia)g.browser="firefox",g.version=VD(b.userAgent,/Firefox\/(\d+)\./,1);else if(b.webkitGetUserMedia||f.isSecureContext===!1&&f.webkitRTCPeerConnection)g.browser="chrome",g.version=VD(b.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!f.RTCPeerConnection||!b.userAgent.match(/AppleWebKit\/(\d+)\./))return g.browser="Not a supported browser.",g;g.browser="safari",g.version=VD(b.userAgent,/AppleWebKit\/(\d+)\./,1),g.supportsUnifiedPlan=f.RTCRtpTransceiver&&"currentDirection"in f.RTCRtpTransceiver.prototype}return g}(e),h={browserDetails:d,commonShim:pat,extractVersion:VD,disableLog:Qst,disableWarnings:Zst,sdp:hat};switch(d.browser){case"chrome":if(!iK||!YU||!r.shimChrome)return i("Chrome shim is not included in this adapter release."),h;if(d.version===null)return i("Chrome shim can not determine version, not shimming."),h;i("adapter.js shimming chrome."),h.browserShim=iK,WD(e,d),KD(e),J8(e,d),X8(e),YU(e,d),Q8(e),nK(e,d),Z8(e),$8(e),tK(e),rK(e,d),FD(e),ZU(e),$U(e),BD(e,d),GD(e),tV(e,d);break;case"firefox":if(!mK||!JU||!r.shimFirefox)return i("Firefox shim is not included in this adapter release."),h;i("adapter.js shimming firefox."),h.browserShim=mK,WD(e,d),KD(e),oK(e,d),JU(e,d),sK(e),uK(e),aK(e),cK(e),dK(e),lK(e),hK(e),pK(e),fK(e),FD(e),$U(e),BD(e,d),GD(e);break;case"safari":if(!IK||!r.shimSafari)return i("Safari shim is not included in this adapter release."),h;i("adapter.js shimming safari."),h.browserShim=IK,WD(e,d),KD(e),yK(e),TK(e),gK(e),_K(e),EK(e),SK(e),vK(e),RK(e),FD(e),ZU(e),BD(e,d),GD(e),tV(e,d);break;default:i("Unsupported browser!")}})({window:typeof window>"u"?void 0:window});var eV=_c;bE({global:!0,forced:eV.globalThis!==eV},{globalThis:eV});var PK=_(_c),nV={exports:{}};(function(e,r){(function(i,d){var h="function",f="undefined",g="object",b="string",C="major",P="model",x="name",H="type",$="vendor",_t="version",_i="architecture",ue="console",_r="mobile",Fi="tablet",Di="smarttv",Js="wearable",_l="embedded",_u="Amazon",ga="Apple",_m="ASUS",r_="BlackBerry",a_="Browser",p_="Chrome",Q_="Firefox",$_="Google",F_="Huawei",mE="LG",pE="Microsoft",PS="Motorola",s_="Opera",__="Samsung",N_="Sharp",c_="Sony",zt="Xiaomi",_a="Zebra",kc="Facebook",m_="Chromium OS",H_="Mac OS",PE=" Browser",rS=function(Ly){for(var iS={},xE=0;xE<Ly.length;xE++)iS[Ly[xE].toUpperCase()]=Ly[xE];return iS},UT=function(Ly,iS){return typeof Ly===b&&cR(iS).indexOf(cR(Ly))!==-1},cR=function(Ly){return Ly.toLowerCase()},AP=function(Ly,iS){if(typeof Ly===b)return Ly=Ly.replace(/^\s\s*/,""),typeof iS===f?Ly:Ly.substring(0,500)},LI=function(Ly,iS){for(var xE,iT,CR,_g,p0,aE,AR=0;AR<iS.length&&!p0;){var MI=iS[AR],JR=iS[AR+1];for(xE=iT=0;xE<MI.length&&!p0&&MI[xE];)if(p0=MI[xE++].exec(Ly))for(CR=0;CR<JR.length;CR++)aE=p0[++iT],typeof(_g=JR[CR])===g&&_g.length>0?_g.length===2?typeof _g[1]==h?this[_g[0]]=_g[1].call(this,aE):this[_g[0]]=_g[1]:_g.length===3?typeof _g[1]!==h||_g[1].exec&&_g[1].test?this[_g[0]]=aE?aE.replace(_g[1],_g[2]):d:this[_g[0]]=aE?_g[1].call(this,aE,_g[2]):d:_g.length===4&&(this[_g[0]]=aE?_g[3].call(this,aE.replace(_g[1],_g[2])):d):this[_g]=aE||d;AR+=2}},ZO=function(Ly,iS){for(var xE in iS)if(typeof iS[xE]===g&&iS[xE].length>0){for(var iT=0;iT<iS[xE].length;iT++)if(UT(iS[xE][iT],Ly))return xE==="?"?d:xE}else if(UT(iS[xE],Ly))return xE==="?"?d:xE;return iS.hasOwnProperty("*")?iS["*"]:Ly},W1={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},K1={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[_t,[x,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[_t,[x,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[x,_t],[/opios[\/ ]+([\w\.]+)/i],[_t,[x,s_+" Mini"]],[/\bop(?:rg)?x\/([\w\.]+)/i],[_t,[x,s_+" GX"]],[/\bopr\/([\w\.]+)/i],[_t,[x,s_]],[/\bb[ai]*d(?:uhd|[ub]*[aekoprswx]{5,6})[\/ ]?([\w\.]+)/i],[_t,[x,"Baidu"]],[/\b(?:mxbrowser|mxios|myie2)\/?([-\w\.]*)\b/i],[_t,[x,"Maxthon"]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer|sleipnir)[\/ ]?([\w\.]*)/i,/(avant|iemobile|slim(?:browser|boat|jet))[\/ ]?([\d\.]*)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|duckduckgo|klar|helio|(?=comodo_)?dragon)\/([-\w\.]+)/i,/(heytap|ovi|115)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[x,_t],[/quark(?:pc)?\/([-\w\.]+)/i],[_t,[x,"Quark"]],[/\bddg\/([\w\.]+)/i],[_t,[x,"DuckDuckGo"]],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[_t,[x,"UC"+a_]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i,/micromessenger\/([\w\.]+)/i],[_t,[x,"WeChat"]],[/konqueror\/([\w\.]+)/i],[_t,[x,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[_t,[x,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[_t,[x,"Yandex"]],[/slbrowser\/([\w\.]+)/i],[_t,[x,"Smart Lenovo "+a_]],[/(avast|avg)\/([\w\.]+)/i],[[x,/(.+)/,"$1 Secure "+a_],_t],[/\bfocus\/([\w\.]+)/i],[_t,[x,Q_+" Focus"]],[/\bopt\/([\w\.]+)/i],[_t,[x,s_+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[_t,[x,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[_t,[x,"Dolphin"]],[/coast\/([\w\.]+)/i],[_t,[x,s_+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[_t,[x,"MIUI"+PE]],[/fxios\/([\w\.-]+)/i],[_t,[x,Q_]],[/\bqihoobrowser\/?([\w\.]*)/i],[_t,[x,"360"]],[/\b(qq)\/([\w\.]+)/i],[[x,/(.+)/,"$1Browser"],_t],[/(oculus|sailfish|huawei|vivo|pico)browser\/([\w\.]+)/i],[[x,/(.+)/,"$1"+PE],_t],[/samsungbrowser\/([\w\.]+)/i],[_t,[x,__+" Internet"]],[/metasr[\/ ]?([\d\.]+)/i],[_t,[x,"Sogou Explorer"]],[/(sogou)mo\w+\/([\d\.]+)/i],[[x,"Sogou Mobile"],_t],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|2345(?=browser|chrome|explorer))\w*[\/ ]?v?([\w\.]+)/i],[x,_t],[/(lbbrowser|rekonq)/i,/\[(linkedin)app\]/i],[x],[/ome\/([\w\.]+) \w* ?(iron) saf/i,/ome\/([\w\.]+).+qihu (360)[es]e/i],[_t,x],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[x,kc],_t],[/(Klarna)\/([\w\.]+)/i,/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(alipay)client\/([\w\.]+)/i,/(twitter)(?:and| f.+e\/([\w\.]+))/i,/(chromium|instagram|snapchat)[\/ ]([-\w\.]+)/i],[x,_t],[/\bgsa\/([\w\.]+) .*safari\//i],[_t,[x,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[_t,[x,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[_t,[x,p_+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[x,p_+" WebView"],_t],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[_t,[x,"Android "+a_]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[x,_t],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[_t,[x,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[_t,x],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[x,[_t,ZO,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[x,_t],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[x,"Netscape"],_t],[/(wolvic|librewolf)\/([\w\.]+)/i],[x,_t],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[_t,[x,Q_+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i],[x,[_t,/_/g,"."]],[/(cobalt)\/([\w\.]+)/i],[x,[_t,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[_i,"amd64"]],[/(ia32(?=;))/i],[[_i,cR]],[/((?:i[346]|x)86)[;\)]/i],[[_i,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[_i,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[_i,"armhf"]],[/windows (ce|mobile); ppc;/i],[[_i,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[_i,/ower/,"",cR]],[/(sun4\w)[;\)]/i],[[_i,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[_i,cR]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[P,[$,__],[H,Fi]],[/\b((?:s[cgp]h|gt|sm)-(?![lr])\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]((?!sm-[lr])[-\w]+)/i,/sec-(sgh\w+)/i],[P,[$,__],[H,_r]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[P,[$,ga],[H,_r]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[P,[$,ga],[H,Fi]],[/(macintosh);/i],[P,[$,ga]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[P,[$,N_],[H,_r]],[/(?:honor)([-\w ]+)[;\)]/i],[P,[$,"Honor"],[H,_r]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[P,[$,F_],[H,Fi]],[/(?:huawei)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[P,[$,F_],[H,_r]],[/\b(poco[\w ]+|m2\d{3}j\d\d[a-z]{2})(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/oid[^\)]+; (m?[12][0-389][01]\w{3,6}[c-y])( bui|; wv|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite|pro)?)(?: bui|\))/i],[[P,/_/g," "],[$,zt],[H,_r]],[/oid[^\)]+; (2\d{4}(283|rpbf)[cgl])( bui|\))/i,/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[P,/_/g," "],[$,zt],[H,Fi]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[P,[$,"OPPO"],[H,_r]],[/\b(opd2\d{3}a?) bui/i],[P,[$,"OPPO"],[H,Fi]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[P,[$,"Vivo"],[H,_r]],[/\b(rmx[1-3]\d{3})(?: bui|;|\))/i],[P,[$,"Realme"],[H,_r]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[P,[$,PS],[H,_r]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[P,[$,PS],[H,Fi]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[P,[$,mE],[H,Fi]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[P,[$,mE],[H,_r]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[P,[$,"Lenovo"],[H,Fi]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[P,/_/g," "],[$,"Nokia"],[H,_r]],[/(pixel c)\b/i],[P,[$,$_],[H,Fi]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[P,[$,$_],[H,_r]],[/droid.+; (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[P,[$,c_],[H,_r]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[P,"Xperia Tablet"],[$,c_],[H,Fi]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[P,[$,"OnePlus"],[H,_r]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo(?!bc)\w\w)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[P,[$,_u],[H,Fi]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[P,/(.+)/g,"Fire Phone $1"],[$,_u],[H,_r]],[/(playbook);[-\w\),; ]+(rim)/i],[P,$,[H,Fi]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[P,[$,r_],[H,_r]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[P,[$,_m],[H,Fi]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[P,[$,_m],[H,_r]],[/(nexus 9)/i],[P,[$,"HTC"],[H,Fi]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[$,[P,/_/g," "],[H,_r]],[/droid [\w\.]+; ((?:8[14]9[16]|9(?:0(?:48|60|8[01])|1(?:3[27]|66)|2(?:6[69]|9[56])|466))[gqswx])\w*(\)| bui)/i],[P,[$,"TCL"],[H,Fi]],[/(itel) ((\w+))/i],[[$,cR],P,[H,ZO,{tablet:["p10001l","w7001"],"*":"mobile"}]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[P,[$,"Acer"],[H,Fi]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[P,[$,"Meizu"],[H,_r]],[/; ((?:power )?armor(?:[\w ]{0,8}))(?: bui|\))/i],[P,[$,"Ulefone"],[H,_r]],[/; (energy ?\w+)(?: bui|\))/i,/; energizer ([\w ]+)(?: bui|\))/i],[P,[$,"Energizer"],[H,_r]],[/; cat (b35);/i,/; (b15q?|s22 flip|s48c|s62 pro)(?: bui|\))/i],[P,[$,"Cat"],[H,_r]],[/((?:new )?andromax[\w- ]+)(?: bui|\))/i],[P,[$,"Smartfren"],[H,_r]],[/droid.+; (a(?:015|06[35]|142p?))/i],[P,[$,"Nothing"],[H,_r]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron|infinix|tecno|micromax|advan)[-_ ]?([-\w]*)/i,/; (imo) ((?!tab)[\w ]+?)(?: bui|\))/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[$,P,[H,_r]],[/(imo) (tab \w+)/i,/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[$,P,[H,Fi]],[/(surface duo)/i],[P,[$,pE],[H,Fi]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[P,[$,"Fairphone"],[H,_r]],[/(u304aa)/i],[P,[$,"AT&T"],[H,_r]],[/\bsie-(\w*)/i],[P,[$,"Siemens"],[H,_r]],[/\b(rct\w+) b/i],[P,[$,"RCA"],[H,Fi]],[/\b(venue[\d ]{2,7}) b/i],[P,[$,"Dell"],[H,Fi]],[/\b(q(?:mv|ta)\w+) b/i],[P,[$,"Verizon"],[H,Fi]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[P,[$,"Barnes & Noble"],[H,Fi]],[/\b(tm\d{3}\w+) b/i],[P,[$,"NuVision"],[H,Fi]],[/\b(k88) b/i],[P,[$,"ZTE"],[H,Fi]],[/\b(nx\d{3}j) b/i],[P,[$,"ZTE"],[H,_r]],[/\b(gen\d{3}) b.+49h/i],[P,[$,"Swiss"],[H,_r]],[/\b(zur\d{3}) b/i],[P,[$,"Swiss"],[H,Fi]],[/\b((zeki)?tb.*\b) b/i],[P,[$,"Zeki"],[H,Fi]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[$,"Dragon Touch"],P,[H,Fi]],[/\b(ns-?\w{0,9}) b/i],[P,[$,"Insignia"],[H,Fi]],[/\b((nxa|next)-?\w{0,9}) b/i],[P,[$,"NextBook"],[H,Fi]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[$,"Voice"],P,[H,_r]],[/\b(lvtel\-)?(v1[12]) b/i],[[$,"LvTel"],P,[H,_r]],[/\b(ph-1) /i],[P,[$,"Essential"],[H,_r]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[P,[$,"Envizen"],[H,Fi]],[/\b(trio[-\w\. ]+) b/i],[P,[$,"MachSpeed"],[H,Fi]],[/\btu_(1491) b/i],[P,[$,"Rotor"],[H,Fi]],[/(shield[\w ]+) b/i],[P,[$,"Nvidia"],[H,Fi]],[/(sprint) (\w+)/i],[$,P,[H,_r]],[/(kin\.[onetw]{3})/i],[[P,/\./g," "],[$,pE],[H,_r]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[P,[$,_a],[H,Fi]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[P,[$,_a],[H,_r]],[/smart-tv.+(samsung)/i],[$,[H,Di]],[/hbbtv.+maple;(\d+)/i],[[P,/^/,"SmartTV"],[$,__],[H,Di]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[$,mE],[H,Di]],[/(apple) ?tv/i],[$,[P,ga+" TV"],[H,Di]],[/crkey/i],[[P,p_+"cast"],[$,$_],[H,Di]],[/droid.+aft(\w+)( bui|\))/i],[P,[$,_u],[H,Di]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[P,[$,N_],[H,Di]],[/(bravia[\w ]+)( bui|\))/i],[P,[$,c_],[H,Di]],[/(mitv-\w{5}) bui/i],[P,[$,zt],[H,Di]],[/Hbbtv.*(technisat) (.*);/i],[$,P,[H,Di]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[$,AP],[P,AP],[H,Di]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[H,Di]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[$,P,[H,ue]],[/droid.+; (shield) bui/i],[P,[$,"Nvidia"],[H,ue]],[/(playstation [345portablevi]+)/i],[P,[$,c_],[H,ue]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[P,[$,pE],[H,ue]],[/\b(sm-[lr]\d\d[05][fnuw]?s?)\b/i],[P,[$,__],[H,Js]],[/((pebble))app/i],[$,P,[H,Js]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[P,[$,ga],[H,Js]],[/droid.+; (glass) \d/i],[P,[$,$_],[H,Js]],[/droid.+; (wt63?0{2,3})\)/i],[P,[$,_a],[H,Js]],[/droid.+; (glass) \d/i],[P,[$,$_],[H,Js]],[/(pico) (4|neo3(?: link|pro)?)/i],[$,P,[H,Js]],[/; (quest( \d| pro)?)/i],[P,[$,kc],[H,Js]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[$,[H,_l]],[/(aeobc)\b/i],[P,[$,_u],[H,_l]],[/droid .+?; ([^;]+?)(?: bui|; wv\)|\) applew).+? mobile safari/i],[P,[H,_r]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[P,[H,Fi]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[H,Fi]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[H,_r]],[/(android[-\w\. ]{0,9});.+buil/i],[P,[$,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[_t,[x,"EdgeHTML"]],[/(arkweb)\/([\w\.]+)/i],[x,_t],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[_t,[x,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna|servo)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[x,_t],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[_t,x]],os:[[/microsoft (windows) (vista|xp)/i],[x,_t],[/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i],[x,[_t,ZO,W1]],[/windows nt 6\.2; (arm)/i,/windows[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i,/(?:win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[_t,ZO,W1],[x,"Windows"]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/(?:ios;fbsv\/|iphone.+ios[\/ ])([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[_t,/_/g,"."],[x,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[x,H_],[_t,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[_t,x],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish|openharmony)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[x,_t],[/\(bb(10);/i],[_t,[x,r_]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[_t,[x,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[_t,[x,Q_+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[_t,[x,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[_t,[x,"watchOS"]],[/crkey\/([\d\.]+)/i],[_t,[x,p_+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[x,m_],_t],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[x,_t],[/(sunos) ?([\w\.\d]*)/i],[[x,"Solaris"],_t],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[x,_t]]},VT=function(Ly,iS){if(typeof Ly===g&&(iS=Ly,Ly=d),!(this instanceof VT))return new VT(Ly,iS).getResult();var xE=typeof i!==f&&i.navigator?i.navigator:d,iT=Ly||(xE&&xE.userAgent?xE.userAgent:""),CR=xE&&xE.userAgentData?xE.userAgentData:d,_g=iS?function(aE,AR){var MI={};for(var JR in aE)AR[JR]&&AR[JR].length%2==0?MI[JR]=AR[JR].concat(aE[JR]):MI[JR]=aE[JR];return MI}(K1,iS):K1,p0=xE&&xE.userAgent==iT;return this.getBrowser=function(){var aE={};return aE[x]=d,aE[_t]=d,LI.call(aE,iT,_g.browser),aE[C]=function(AR){return typeof AR===b?AR.replace(/[^\d\.]/g,"").split(".")[0]:d}(aE[_t]),p0&&xE&&xE.brave&&typeof xE.brave.isBrave==h&&(aE[x]="Brave"),aE},this.getCPU=function(){var aE={};return aE[_i]=d,LI.call(aE,iT,_g.cpu),aE},this.getDevice=function(){var aE={};return aE[$]=d,aE[P]=d,aE[H]=d,LI.call(aE,iT,_g.device),p0&&!aE[H]&&CR&&CR.mobile&&(aE[H]=_r),p0&&aE[P]=="Macintosh"&&xE&&typeof xE.standalone!==f&&xE.maxTouchPoints&&xE.maxTouchPoints>2&&(aE[P]="iPad",aE[H]=Fi),aE},this.getEngine=function(){var aE={};return aE[x]=d,aE[_t]=d,LI.call(aE,iT,_g.engine),aE},this.getOS=function(){var aE={};return aE[x]=d,aE[_t]=d,LI.call(aE,iT,_g.os),p0&&!aE[x]&&CR&&CR.platform&&CR.platform!="Unknown"&&(aE[x]=CR.platform.replace(/chrome os/i,m_).replace(/macos/i,H_)),aE},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return iT},this.setUA=function(aE){return iT=typeof aE===b&&aE.length>500?AP(aE,500):aE,this},this.setUA(iT),this};VT.VERSION="0.7.40",VT.BROWSER=rS([x,_t,C]),VT.CPU=rS([_i]),VT.DEVICE=rS([P,$,H,ue,_r,Di,Fi,Js,_l]),VT.ENGINE=VT.OS=rS([x,_t]),e.exports&&(r=e.exports=VT),r.UAParser=VT;var h0=typeof i!==f&&(i.jQuery||i.Zepto);if(h0&&!h0.ua){var H1=new VT;h0.ua=H1.getResult(),h0.ua.get=function(){return H1.getUA()},h0.ua.set=function(Ly){H1.setUA(Ly);var iS=H1.getResult();for(var xE in iS)h0.ua[xE]=iS[xE]}}})(typeof window=="object"?window:p)})(nV,nV.exports);var fat=_(nV.exports),DK=tD.clear;bE({global:!0,bind:!0,forced:_c.clearImmediate!==DK},{clearImmediate:DK});var kK=_c,mat=e_,_at=h_,Eat=hM,gat=XR,vat=g0,bat=tI,yat=kK.Function,Sat=/MSIE .\./.test(gat)||Eat==="BUN"&&function(){var e=kK.Bun.version.split(".");return e.length<3||e[0]==="0"&&(e[1]<3||e[1]==="3"&&e[2]==="0")}(),Tat=bE,LK=_c,MK=tD.set,Rat=function(e,r){var i=1;return Sat?function(d,h){var f=bat(arguments.length,1)>i,g=_at(d)?d:yat(d),b=f?vat(arguments,i):[],C=f?function(){mat(g,this,b)}:g;return e(C)}:e},xK=LK.setImmediate?Rat(MK):MK;Tat({global:!0,bind:!0,forced:LK.setImmediate!==xK},{setImmediate:xK});var UK=_(bS.setImmediate),Iat=_c,wat=X5,Cat=lT,Aat=tI,Oat=vf;bE({global:!0,dontCallGetSet:!0,forced:A(function(){return Oat&&Object.getOwnPropertyDescriptor(Iat,"queueMicrotask").value.length!==1})},{queueMicrotask:function(e){Aat(arguments.length,1),wat(Cat(e))}});var VK=_(bS.queueMicrotask);function jK(e,r){return function(){return e.apply(r,arguments)}}const{toString:Nat}=Object.prototype,{getPrototypeOf:rV}=Object,{iterator:HD,toStringTag:FK}=Symbol,zD=(iV=Object.create(null),e=>{const r=Nat.call(e);return iV[r]||(iV[r]=r.slice(8,-1).toLowerCase())});var iV;const hR=e=>(e=e.toLowerCase(),r=>zD(r)===e),YD=e=>r=>typeof r===e,{isArray:sO}=Array,IN=YD("undefined"),BK=hR("ArrayBuffer"),Pat=YD("string"),pT=YD("function"),GK=YD("number"),JD=e=>e!==null&&typeof e=="object",XD=e=>{if(zD(e)!=="object")return!1;const r=rV(e);return!(r!==null&&r!==Object.prototype&&Object.getPrototypeOf(r)!==null||FK in e||HD in e)},Dat=hR("Date"),kat=hR("File"),Lat=hR("Blob"),Mat=hR("FileList"),xat=hR("URLSearchParams"),[Uat,Vat,jat,Fat]=["ReadableStream","Request","Response","Headers"].map(hR);function wN(e,r){let i,d,{allOwnKeys:h=!1}=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{};if(e!=null)if(typeof e!="object"&&(e=[e]),sO(e))for(i=0,d=e.length;i<d;i++)r.call(null,e[i],i,e);else{const f=h?Object.getOwnPropertyNames(e):Object.keys(e),g=f.length;let b;for(i=0;i<g;i++)b=f[i],r.call(null,e[b],b,e)}}function qK(e,r){r=r.toLowerCase();const i=Object.keys(e);let d,h=i.length;for(;h-- >0;)if(d=i[h],r===d.toLowerCase())return d;return null}const aI=PK!==void 0?PK:typeof self<"u"?self:typeof window<"u"?window:globalThis,WK=e=>!IN(e)&&e!==aI,Bat=(oV=typeof Uint8Array<"u"&&rV(Uint8Array),e=>oV&&e instanceof oV);var oV;const Gat=hR("HTMLFormElement"),KK=(e=>{let{hasOwnProperty:r}=e;return(i,d)=>r.call(i,d)})(Object.prototype),qat=hR("RegExp"),HK=(e,r)=>{const i=Object.getOwnPropertyDescriptors(e),d={};wN(i,(h,f)=>{let g;(g=r(h,f,e))!==!1&&(d[f]=g||h)}),Object.defineProperties(e,d)},Wat=hR("AsyncFunction"),zK=(YK=typeof UK=="function",JK=pT(aI.postMessage),YK?UK:JK?(sV="axios@".concat(Math.random()),QD=[],aI.addEventListener("message",e=>{let{source:r,data:i}=e;r===aI&&i===sV&&QD.length&&QD.shift()()},!1),e=>{QD.push(e),aI.postMessage(sV,"*")}):e=>setTimeout(e));var YK,JK,sV,QD;const Kat=VK!==void 0?VK.bind(aI):typeof process<"u"&&process.nextTick||zK;var b_={isArray:sO,isArrayBuffer:BK,isBuffer:function(e){return e!==null&&!IN(e)&&e.constructor!==null&&!IN(e.constructor)&&pT(e.constructor.isBuffer)&&e.constructor.isBuffer(e)},isFormData:e=>{let r;return e&&(typeof FormData=="function"&&e instanceof FormData||pT(e.append)&&((r=zD(e))==="formdata"||r==="object"&&pT(e.toString)&&e.toString()==="[object FormData]"))},isArrayBufferView:function(e){let r;return r=typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&BK(e.buffer),r},isString:Pat,isNumber:GK,isBoolean:e=>e===!0||e===!1,isObject:JD,isPlainObject:XD,isReadableStream:Uat,isRequest:Vat,isResponse:jat,isHeaders:Fat,isUndefined:IN,isDate:Dat,isFile:kat,isBlob:Lat,isRegExp:qat,isFunction:pT,isStream:e=>JD(e)&&pT(e.pipe),isURLSearchParams:xat,isTypedArray:Bat,isFileList:Mat,forEach:wN,merge:function e(){const{caseless:r}=WK(this)&&this||{},i={},d=(h,f)=>{const g=r&&qK(i,f)||f;XD(i[g])&&XD(h)?i[g]=e(i[g],h):XD(h)?i[g]=e({},h):sO(h)?i[g]=h.slice():i[g]=h};for(let h=0,f=arguments.length;h<f;h++)arguments[h]&&wN(arguments[h],d);return i},extend:function(e,r,i){let{allOwnKeys:d}=arguments.length>3&&arguments[3]!==void 0?arguments[3]:{};return wN(r,(h,f)=>{i&&pT(h)?e[f]=jK(h,i):e[f]=h},{allOwnKeys:d}),e},trim:e=>xS(e)?xS(e).call(e):e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,""),stripBOM:e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),inherits:(e,r,i,d)=>{e.prototype=Object.create(r.prototype,d),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:r.prototype}),i&&Object.assign(e.prototype,i)},toFlatObject:(e,r,i,d)=>{let h,f,g;const b={};if(r=r||{},e==null)return r;do{for(h=Object.getOwnPropertyNames(e),f=h.length;f-- >0;)g=h[f],d&&!d(g,e,r)||b[g]||(r[g]=e[g],b[g]=!0);e=i!==!1&&rV(e)}while(e&&(!i||i(e,r))&&e!==Object.prototype);return r},kindOf:zD,kindOfTest:hR,endsWith:(e,r,i)=>{e=String(e),(i===void 0||i>e.length)&&(i=e.length),i-=r.length;const d=e.indexOf(r,i);return d!==-1&&d===i},toArray:e=>{if(!e)return null;if(sO(e))return e;let r=e.length;if(!GK(r))return null;const i=new Array(r);for(;r-- >0;)i[r]=e[r];return i},forEachEntry:(e,r)=>{const i=(e&&e[HD]).call(e);let d;for(;(d=i.next())&&!d.done;){const h=d.value;r.call(e,h[0],h[1])}},matchAll:(e,r)=>{let i;const d=[];for(;(i=e.exec(r))!==null;)d.push(i);return d},isHTMLForm:Gat,hasOwnProperty:KK,hasOwnProp:KK,reduceDescriptors:HK,freezeMethods:e=>{HK(e,(r,i)=>{if(pT(e)&&["arguments","caller","callee"].indexOf(i)!==-1)return!1;const d=e[i];pT(d)&&(r.enumerable=!1,"writable"in r?r.writable=!1:r.set||(r.set=()=>{throw Error("Can not rewrite read-only method '"+i+"'")}))})},toObjectSet:(e,r)=>{const i={},d=h=>{h.forEach(f=>{i[f]=!0})};return sO(e)?d(e):d(String(e).split(r)),i},toCamelCase:e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(r,i,d){return i.toUpperCase()+d}),noop:()=>{},toFiniteNumber:(e,r)=>e!=null&&Number.isFinite(e=+e)?e:r,findKey:qK,global:aI,isContextDefined:WK,isSpecCompliantForm:function(e){return!!(e&&pT(e.append)&&e[FK]==="FormData"&&e[HD])},toJSONObject:e=>{const r=new Array(10),i=(d,h)=>{if(JD(d)){if(r.indexOf(d)>=0)return;if(!("toJSON"in d)){r[h]=d;const f=sO(d)?[]:{};return wN(d,(g,b)=>{const C=i(g,h+1);!IN(C)&&(f[b]=C)}),r[h]=void 0,f}}return d};return i(e,0)},isAsyncFn:Wat,isThenable:e=>e&&(JD(e)||pT(e))&&pT(e.then)&&pT(e.catch),setImmediate:zK,asap:Kat,isIterable:e=>e!=null&&pT(e[HD])};function RE(e,r,i,d,h){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",r&&(this.code=r),i&&(this.config=i),d&&(this.request=d),h&&(this.response=h,this.status=h.status?h.status:null)}b_.inherits(RE,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:b_.toJSONObject(this.config),code:this.code,status:this.status}}});const XK=RE.prototype,QK={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{QK[e]={value:e}}),Object.defineProperties(RE,QK),Object.defineProperty(XK,"isAxiosError",{value:!0}),RE.from=(e,r,i,d,h,f)=>{const g=Object.create(XK);return b_.toFlatObject(e,g,function(b){return b!==Error.prototype},b=>b!=="isAxiosError"),RE.call(g,e.message,r,i,d,h),g.cause=e,g.name=e.name,f&&Object.assign(g,f),g};function aV(e){return b_.isPlainObject(e)||b_.isArray(e)}function ZK(e){return b_.endsWith(e,"[]")?e.slice(0,-2):e}function $K(e,r,i){return e?e.concat(r).map(function(d,h){return d=ZK(d),!i&&h?"["+d+"]":d}).join(i?".":""):r}const Hat=b_.toFlatObject(b_,{},null,function(e){return/^is[A-Z]/.test(e)});function ZD(e,r,i){if(!b_.isObject(e))throw new TypeError("target must be an object");r=r||new FormData;const d=(i=b_.toFlatObject(i,{metaTokens:!0,dots:!1,indexes:!1},!1,function($,_t){return!b_.isUndefined(_t[$])})).metaTokens,h=i.visitor||P,f=i.dots,g=i.indexes,b=(i.Blob||typeof Blob<"u"&&Blob)&&b_.isSpecCompliantForm(r);if(!b_.isFunction(h))throw new TypeError("visitor must be a function");function C($){if($===null)return"";if(b_.isDate($))return $.toISOString();if(!b&&b_.isBlob($))throw new RE("Blob is not supported. Use a Buffer instead.");return b_.isArrayBuffer($)||b_.isTypedArray($)?b&&typeof Blob=="function"?new Blob([$]):Buffer.from($):$}function P($,_t,_i){let ue=$;if($&&!_i&&typeof $=="object"){if(b_.endsWith(_t,"{}"))_t=d?_t:_t.slice(0,-2),$=JSON.stringify($);else if(b_.isArray($)&&function(_r){return b_.isArray(_r)&&!_r.some(aV)}($)||(b_.isFileList($)||b_.endsWith(_t,"[]"))&&(ue=b_.toArray($)))return _t=ZK(_t),ue.forEach(function(_r,Fi){!b_.isUndefined(_r)&&_r!==null&&r.append(g===!0?$K([_t],Fi,f):g===null?_t:_t+"[]",C(_r))}),!1}return!!aV($)||(r.append($K(_i,_t,f),C($)),!1)}const x=[],H=Object.assign(Hat,{defaultVisitor:P,convertValue:C,isVisitable:aV});if(!b_.isObject(e))throw new TypeError("data must be an object");return function $(_t,_i){if(!b_.isUndefined(_t)){if(x.indexOf(_t)!==-1)throw Error("Circular reference detected in "+_i.join("."));x.push(_t),b_.forEach(_t,function(ue,_r){(!(b_.isUndefined(ue)||ue===null)&&h.call(r,ue,b_.isString(_r)?xS(_r).call(_r):_r,_i,H))===!0&&$(ue,_i?_i.concat(_r):[_r])}),x.pop()}}(e),r}function tH(e){const r={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(i){return r[i]})}function cV(e,r){this._pairs=[],e&&ZD(e,this,r)}const eH=cV.prototype;function zat(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function nH(e,r,i){if(!r)return e;const d=i&&i.encode||zat;b_.isFunction(i)&&(i={serialize:i});const h=i&&i.serialize;let f;if(f=h?h(r,i):b_.isURLSearchParams(r)?r.toString():new cV(r,i).toString(d),f){const g=e.indexOf("#");g!==-1&&(e=e.slice(0,g)),e+=(e.indexOf("?")===-1?"?":"&")+f}return e}eH.append=function(e,r){this._pairs.push([e,r])},eH.toString=function(e){const r=e?function(i){return e.call(this,i,tH)}:tH;return this._pairs.map(function(i){return r(i[0])+"="+r(i[1])},"").join("&")};var rH=class{constructor(){this.handlers=[]}use(e,r,i){return this.handlers.push({fulfilled:e,rejected:r,synchronous:!!i&&i.synchronous,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){b_.forEach(this.handlers,function(r){r!==null&&e(r)})}},iH={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},oH={exports:{}},Yat=bE,Jat=vf,sH=FT.f;Yat({target:"Object",stat:!0,forced:Object.defineProperty!==sH,sham:!Jat},{defineProperty:sH});var aH=bS.Object,Xat=oH.exports=function(e,r,i){return aH.defineProperty(e,r,i)};aH.defineProperty.sham&&(Xat.sham=!0);var cH=_(oH.exports),Qat=TypeError,uH=sN,Zat=$P,$at=UE,tct=tS("species"),dH=Array,ect=function(e){var r;return uH(e)&&(r=e.constructor,(Zat(r)&&(r===dH||uH(r.prototype))||$at(r)&&(r=r[tct])===null)&&(r=void 0)),r===void 0?dH:r},lH=function(e,r){return new(ect(e))(r===0?0:r)},nct=A,rct=X0,ict=tS("species"),hH=function(e){return rct>=51||!nct(function(){var r=[];return(r.constructor={})[ict]=function(){return{foo:1}},r[e](Boolean).foo!==1})},oct=bE,sct=A,act=sN,cct=UE,uct=OR,dct=m0,pH=function(e){if(e>9007199254740991)throw Qat("Maximum allowed index exceeded");return e},fH=RU,lct=lH,hct=hH,pct=X0,mH=tS("isConcatSpreadable"),fct=pct>=51||!sct(function(){var e=[];return e[mH]=!1,e.concat()[0]!==e}),mct=function(e){if(!cct(e))return!1;var r=e[mH];return r!==void 0?!!r:act(e)};oct({target:"Array",proto:!0,forced:!fct||!hct("concat")},{concat:function(e){var r,i,d,h,f,g=uct(this),b=lct(g,0),C=0;for(r=-1,d=arguments.length;r<d;r++)if(mct(f=r===-1?g:arguments[r]))for(h=dct(f),pH(C+h),i=0;i<h;i++,C++)i in f&&fH(b,C,f[i]);else pH(C+1),fH(b,C++,f);return b.length=C,b}});var _H={},_ct=y_,Ect=z_,EH=UP.f,gct=g0,gH=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];_H.f=function(e){return gH&&_ct(e)==="Window"?function(r){try{return EH(r)}catch{return gct(gH)}}(e):EH(Ect(e))};var aO={},vct=tS;aO.f=vct;var vH=bS,bct=DS,yct=aO,Sct=FT.f,pS=function(e){var r=vH.Symbol||(vH.Symbol={});bct(r,e)||Sct(r,e,{value:yct.f(e)})},Tct=g_,Rct=HS,Ict=tS,wct=E0,bH=function(){var e=Rct("Symbol"),r=e&&e.prototype,i=r&&r.valueOf,d=Ict("toPrimitive");r&&!r[d]&&wct(r,d,function(h){return Tct(i,this)},{})},Cct=f0,Act=UI,Oct=OR,Nct=m0,Pct=lH,yH=_e([].push),Dct=function(e){var r=e===1,i=e===2,d=e===3,h=e===4,f=e===6,g=e===7,b=e===5||f;return function(C,P,x,H){for(var $,_t,_i=Oct(C),ue=Act(_i),_r=Nct(ue),Fi=Cct(P,x),Di=0,Js=H||Pct,_l=r?Js(C,_r):i||g?Js(C,0):void 0;_r>Di;Di++)if((b||Di in ue)&&(_t=Fi($=ue[Di],Di,_i),e))if(r)_l[Di]=_t;else if(_t)switch(e){case 3:return!0;case 5:return $;case 6:return Di;case 2:yH(_l,$)}else switch(e){case 4:return!1;case 7:yH(_l,$)}return f?-1:d||h?h:_l}},SH={forEach:Dct(0)},$D=bE,CN=_c,uV=g_,kct=_e,cO=vf,uO=VI,Lct=A,FS=DS,Mct=_n,dV=oT,_k=z_,lV=$1,xct=hT,hV=Lb,dO=cN,TH=jP,Uct=UP,RH=_H,Vct=aN,IH=I_,wH=FT,jct=vM,CH=v_,AH=E0,Fct=ZP,pV=FI,OH=VP,NH=Q1,Bct=tS,Gct=aO,qct=pS,Wct=bH,Kct=QR,PH=$0,tL=SH.forEach,fT=xP("hidden"),eL="Symbol",AN="prototype",Hct=PH.set,DH=PH.getterFor(eL),pR=Object[AN],cI=CN.Symbol,nL=cI&&cI[AN],zct=CN.RangeError,Yct=CN.TypeError,fV=CN.QObject,kH=IH.f,uI=wH.f,LH=RH.f,Jct=CH.f,MH=kct([].push),t0=pV("symbols"),ON=pV("op-symbols"),Xct=pV("wks"),mV=!fV||!fV[AN]||!fV[AN].findChild,xH=function(e,r,i){var d=kH(pR,r);d&&delete pR[r],uI(e,r,i),d&&e!==pR&&uI(pR,r,d)},_V=cO&&Lct(function(){return dO(uI({},"a",{get:function(){return uI(this,"a",{value:7}).a}})).a!==7})?xH:uI,EV=function(e,r){var i=t0[e]=dO(nL);return Hct(i,{type:eL,tag:e,description:r}),cO||(i.description=r),i},rL=function(e,r,i){e===pR&&rL(ON,r,i),dV(e);var d=lV(r);return dV(i),FS(t0,d)?(i.enumerable?(FS(e,fT)&&e[fT][d]&&(e[fT][d]=!1),i=dO(i,{enumerable:hV(0,!1)})):(FS(e,fT)||uI(e,fT,hV(1,dO(null))),e[fT][d]=!0),_V(e,d,i)):uI(e,d,i)},gV=function(e,r){dV(e);var i=_k(r),d=TH(i).concat(FH(i));return tL(d,function(h){cO&&!uV(UH,i,h)||rL(e,h,i[h])}),e},UH=function(e){var r=lV(e),i=uV(Jct,this,r);return!(this===pR&&FS(t0,r)&&!FS(ON,r))&&(!(i||!FS(this,r)||!FS(t0,r)||FS(this,fT)&&this[fT][r])||i)},VH=function(e,r){var i=_k(e),d=lV(r);if(i!==pR||!FS(t0,d)||FS(ON,d)){var h=kH(i,d);return!h||!FS(t0,d)||FS(i,fT)&&i[fT][d]||(h.enumerable=!0),h}},jH=function(e){var r=LH(_k(e)),i=[];return tL(r,function(d){FS(t0,d)||FS(OH,d)||MH(i,d)}),i},FH=function(e){var r=e===pR,i=LH(r?ON:_k(e)),d=[];return tL(i,function(h){!FS(t0,h)||r&&!FS(pR,h)||MH(d,t0[h])}),d};uO||(cI=function(){if(Mct(nL,this))throw new Yct("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?xct(arguments[0]):void 0,r=NH(e),i=function(d){var h=this===void 0?CN:this;h===pR&&uV(i,ON,d),FS(h,fT)&&FS(h[fT],r)&&(h[fT][r]=!1);var f=hV(1,d);try{_V(h,r,f)}catch(g){if(!(g instanceof zct))throw g;xH(h,r,f)}};return cO&&mV&&_V(pR,r,{configurable:!0,set:i}),EV(r,e)},AH(nL=cI[AN],"toString",function(){return DH(this).tag}),AH(cI,"withoutSetter",function(e){return EV(NH(e),e)}),CH.f=UH,wH.f=rL,jct.f=gV,IH.f=VH,Uct.f=RH.f=jH,Vct.f=FH,Gct.f=function(e){return EV(Bct(e),e)},cO&&Fct(nL,"description",{configurable:!0,get:function(){return DH(this).description}})),$D({global:!0,wrap:!0,forced:!uO,sham:!uO},{Symbol:cI}),tL(TH(Xct),function(e){qct(e)}),$D({target:eL,stat:!0,forced:!uO},{useSetter:function(){mV=!0},useSimple:function(){mV=!1}}),$D({target:"Object",stat:!0,forced:!uO,sham:!cO},{create:function(e,r){return r===void 0?dO(e):gV(dO(e),r)},defineProperty:rL,defineProperties:gV,getOwnPropertyDescriptor:VH}),$D({target:"Object",stat:!0,forced:!uO},{getOwnPropertyNames:jH}),Wct(),Kct(cI,eL),OH[fT]=!0;var BH=VI&&!!Symbol.for&&!!Symbol.keyFor,Qct=bE,Zct=HS,$ct=DS,tut=hT,GH=FI,eut=BH,vV=GH("string-to-symbol-registry"),nut=GH("symbol-to-string-registry");Qct({target:"Symbol",stat:!0,forced:!eut},{for:function(e){var r=tut(e);if($ct(vV,r))return vV[r];var i=Zct("Symbol")(r);return vV[r]=i,nut[i]=r,i}});var rut=bE,iut=DS,out=nN,sut=jI,aut=BH,qH=FI("symbol-to-string-registry");rut({target:"Symbol",stat:!0,forced:!aut},{keyFor:function(e){if(!out(e))throw new TypeError(sut(e)+" is not a symbol");if(iut(qH,e))return qH[e]}});var WH=sN,cut=h_,KH=y_,uut=hT,HH=_e([].push),dut=bE,zH=HS,YH=e_,lut=g_,NN=_e,JH=A,XH=h_,QH=nN,ZH=g0,hut=function(e){if(cut(e))return e;if(WH(e)){for(var r=e.length,i=[],d=0;d<r;d++){var h=e[d];typeof h=="string"?HH(i,h):typeof h!="number"&&KH(h)!=="Number"&&KH(h)!=="String"||HH(i,uut(h))}var f=i.length,g=!0;return function(b,C){if(g)return g=!1,C;if(WH(this))return C;for(var P=0;P<f;P++)if(i[P]===b)return C}}},put=VI,fut=String,R0=zH("JSON","stringify"),iL=NN(/./.exec),$H=NN("".charAt),mut=NN("".charCodeAt),_ut=NN("".replace),Eut=NN(1 .toString),gut=/[\uD800-\uDFFF]/g,_z=/^[\uD800-\uDBFF]$/,tY=/^[\uDC00-\uDFFF]$/,eY=!put||JH(function(){var e=zH("Symbol")("stringify detection");return R0([e])!=="[null]"||R0({a:e})!=="{}"||R0(Object(e))!=="{}"}),nY=JH(function(){return R0("\uDF06\uD834")!=='"\\udf06\\ud834"'||R0("\uDEAD")!=='"\\udead"'}),vut=function(e,r){var i=ZH(arguments),d=hut(r);if(XH(d)||e!==void 0&&!QH(e))return i[1]=function(h,f){if(XH(d)&&(f=lut(d,this,fut(h),f)),!QH(f))return f},YH(R0,null,i)},but=function(e,r,i){var d=$H(i,r-1),h=$H(i,r+1);return iL(_z,e)&&!iL(tY,h)||iL(tY,e)&&!iL(_z,d)?"\\u"+Eut(mut(e,0),16):e};R0&&dut({target:"JSON",stat:!0,forced:eY||nY},{stringify:function(e,r,i){var d=ZH(arguments),h=YH(eY?vut:R0,null,d);return nY&&typeof h=="string"?_ut(h,gut,but):h}});var rY=aN,yut=OR;bE({target:"Object",stat:!0,forced:!VI||A(function(){rY.f(1)})},{getOwnPropertySymbols:function(e){var r=rY.f;return r?r(yut(e)):[]}}),pS("asyncIterator"),pS("hasInstance"),pS("isConcatSpreadable"),pS("iterator"),pS("match"),pS("matchAll"),pS("replace"),pS("search"),pS("species"),pS("split");var Sut=bH;pS("toPrimitive"),Sut();var Tut=HS,Rut=QR;pS("toStringTag"),Rut(Tut("Symbol"),"Symbol"),pS("unscopables"),QR(_c.JSON,"JSON",!0);var Iut=bS.Symbol,wut=tS,Cut=FT.f,iY=wut("metadata"),oY=Function.prototype;oY[iY]===void 0&&Cut(oY,iY,{value:null}),pS("asyncDispose"),pS("dispose"),pS("metadata");var Aut=Iut,Out=_e,bV=HS("Symbol"),Nut=bV.keyFor,Put=Out(bV.prototype.valueOf),sY=bV.isRegisteredSymbol||function(e){try{return Nut(Put(e))!==void 0}catch{return!1}};bE({target:"Symbol",stat:!0},{isRegisteredSymbol:sY});for(var Dut=FI,aY=HS,kut=_e,Lut=nN,Mut=tS,oL=aY("Symbol"),cY=oL.isWellKnownSymbol,uY=aY("Object","getOwnPropertyNames"),xut=kut(oL.prototype.valueOf),dY=Dut("wks"),yV=0,lY=uY(oL),Uut=lY.length;yV<Uut;yV++)try{var hY=lY[yV];Lut(oL[hY])&&Mut(hY)}catch{}var pY=function(e){if(cY&&cY(e))return!0;try{for(var r=xut(e),i=0,d=uY(dY),h=d.length;i<h;i++)if(dY[d[i]]==r)return!0}catch{}return!1};bE({target:"Symbol",stat:!0,forced:!0},{isWellKnownSymbol:pY}),pS("customMatcher"),pS("observable"),bE({target:"Symbol",stat:!0},{isRegistered:sY}),bE({target:"Symbol",stat:!0,forced:!0},{isWellKnown:pY}),pS("matcher"),pS("metadataKey"),pS("patternMatch"),pS("replaceAll");var lO=_(Aut),fY=_(aO.f("iterator"));function PN(e){return PN=typeof lO=="function"&&typeof fY=="symbol"?function(r){return typeof r}:function(r){return r&&typeof lO=="function"&&r.constructor===lO&&r!==lO.prototype?"symbol":typeof r},PN(e)}var Vut=_(aO.f("toPrimitive"));function jut(e){var r=function(i,d){if(PN(i)!="object"||!i)return i;var h=i[Vut];if(h!==void 0){var f=h.call(i,d);if(PN(f)!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return(d==="string"?String:Number)(i)}(e,"string");return PN(r)=="symbol"?r:r+""}function Ei(e,r,i){return(r=jut(r))in e?cH(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}var mY=_(jot),Fut={isBrowser:!0,classes:{URLSearchParams:mY!==void 0?mY:cV,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]};const SV=typeof window<"u"&&typeof document<"u",TV=typeof navigator=="object"&&navigator||void 0,But=SV&&(!TV||["ReactNative","NativeScript","NS"].indexOf(TV.product)<0),Gut=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",qut=SV&&window.location.href||"http://localhost";function _Y(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function EY(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?_Y(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):_Y(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}var ZS=EY(EY({},Object.freeze({__proto__:null,hasBrowserEnv:SV,hasStandardBrowserEnv:But,hasStandardBrowserWebWorkerEnv:Gut,navigator:TV,origin:qut})),Fut),Wut=oT,Kut=g_,Hut=DS,zut=_n,Yut=function(){var e=Wut(this),r="";return e.hasIndices&&(r+="d"),e.global&&(r+="g"),e.ignoreCase&&(r+="i"),e.multiline&&(r+="m"),e.dotAll&&(r+="s"),e.unicode&&(r+="u"),e.unicodeSets&&(r+="v"),e.sticky&&(r+="y"),r},gY=RegExp.prototype,vY=function(e){var r=e.flags;return r!==void 0||"flags"in gY||Hut(e,"flags")||!zut(gY,e)?r:Kut(Yut,e)},Jut=dU.charAt,bY=g_,Xut=oT,Qut=h_,Zut=y_,$ut=/./.exec,tdt=TypeError,edt=bE,yY=g_,SY=i_,ndt=DM,sL=XP,TY=hS,RY=I6,DN=hT,rdt=oT,idt=UE,odt=y_,sdt=C6,IY=vY,adt=NP,cdt=A,udt=VM,ddt=function(e,r,i){return r+(i?Jut(e,r).length:1)},ldt=function(e,r){var i=e.exec;if(Qut(i)){var d=bY(i,e,r);return d!==null&&Xut(d),d}if(Zut(e)==="RegExp")return bY($ut,e,r);throw new tdt("RegExp#exec called on incompatible receiver")},wY=$0,hdt=tS("matchAll"),CY="RegExp String",AY=CY+" Iterator",pdt=wY.set,fdt=wY.getterFor(AY),mdt=TypeError,RV=SY("".indexOf),aL=SY("".matchAll),IV=!!aL&&!cdt(function(){aL("a",/./)}),_dt=ndt(function(e,r,i,d){pdt(this,{type:AY,regexp:e,string:r,global:i,unicode:d,done:!1})},CY,function(){var e=fdt(this);if(e.done)return sL(void 0,!0);var r=e.regexp,i=e.string,d=ldt(r,i);return d===null?(e.done=!0,sL(void 0,!0)):e.global?(DN(d[0])===""&&(r.lastIndex=ddt(i,RY(r.lastIndex),e.unicode)),sL(d,!1)):(e.done=!0,sL(d,!1))}),OY=function(e){var r,i,d,h=rdt(this),f=DN(e),g=udt(h,RegExp),b=DN(IY(h));return r=new g(g===RegExp?h.source:h,b),i=!!~RV(b,"g"),d=!!~RV(b,"u"),r.lastIndex=RY(h.lastIndex),new _dt(r,f,i,d)};edt({target:"String",proto:!0,forced:IV},{matchAll:function(e){var r,i,d,h,f=TY(this);if(idt(e)){if(sdt(e)&&(r=DN(TY(IY(e))),!~RV(r,"g")))throw new mdt("`.matchAll` does not allow non-global regexes");if(IV)return aL(f,e);if((d=adt(e,hdt))===void 0&&odt(e)==="RegExp"&&(d=OY),d)return yY(d,e,f)}else if(IV)return aL(f,e);return i=DN(f),h=new RegExp(e,"g"),yY(OY,h,i)}});var Edt=BT("String","matchAll"),gdt=_n,vdt=Edt,wV=String.prototype,bdt=function(e){var r=e.matchAll;return typeof e=="string"||e===wV||gdt(wV,e)&&r===wV.matchAll?vdt:r},ydt=_(bdt);function NY(e){function r(i,d,h,f){let g=i[f++];if(g==="__proto__")return!0;const b=Number.isFinite(+g),C=f>=i.length;return g=!g&&b_.isArray(h)?h.length:g,C?(b_.hasOwnProp(h,g)?h[g]=[h[g],d]:h[g]=d,!b):(h[g]&&b_.isObject(h[g])||(h[g]=[]),r(i,d,h[g],f)&&b_.isArray(h[g])&&(h[g]=function(P){const x={},H=Object.keys(P);let $;const _t=H.length;let _i;for($=0;$<_t;$++)_i=H[$],x[_i]=P[_i];return x}(h[g])),!b)}if(b_.isFormData(e)&&b_.isFunction(e.entries)){const i={};return b_.forEachEntry(e,(d,h)=>{r(function(f){return ydt(b_).call(b_,/\w+|\[(\w*)]/g,f).map(g=>g[0]==="[]"?"":g[1]||g[0])}(d),h,i,0)}),i}return null}const CV={transitional:iH,adapter:["xhr","http","fetch"],transformRequest:[function(e,r){const i=r.getContentType()||"",d=i.indexOf("application/json")>-1,h=b_.isObject(e);if(h&&b_.isHTMLForm(e)&&(e=new FormData(e)),b_.isFormData(e))return d?JSON.stringify(NY(e)):e;if(b_.isArrayBuffer(e)||b_.isBuffer(e)||b_.isStream(e)||b_.isFile(e)||b_.isBlob(e)||b_.isReadableStream(e))return e;if(b_.isArrayBufferView(e))return e.buffer;if(b_.isURLSearchParams(e))return r.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let f;if(h){if(i.indexOf("application/x-www-form-urlencoded")>-1)return function(g,b){return ZD(g,new ZS.classes.URLSearchParams,Object.assign({visitor:function(C,P,x,H){return ZS.isNode&&b_.isBuffer(C)?(this.append(P,C.toString("base64")),!1):H.defaultVisitor.apply(this,arguments)}},b))}(e,this.formSerializer).toString();if((f=b_.isFileList(e))||i.indexOf("multipart/form-data")>-1){const g=this.env&&this.env.FormData;return ZD(f?{"files[]":e}:e,g&&new g,this.formSerializer)}}return h||d?(r.setContentType("application/json",!1),function(g,b,C){if(b_.isString(g))try{return(b||JSON.parse)(g),xS(b_).call(b_,g)}catch(P){if(P.name!=="SyntaxError")throw P}return(C||JSON.stringify)(g)}(e)):e}],transformResponse:[function(e){const r=this.transitional||CV.transitional,i=r&&r.forcedJSONParsing,d=this.responseType==="json";if(b_.isResponse(e)||b_.isReadableStream(e))return e;if(e&&b_.isString(e)&&(i&&!this.responseType||d)){const h=!(r&&r.silentJSONParsing)&&d;try{return JSON.parse(e)}catch(f){if(h)throw f.name==="SyntaxError"?RE.from(f,RE.ERR_BAD_RESPONSE,this,null,this.response):f}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ZS.classes.FormData,Blob:ZS.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};b_.forEach(["delete","get","head","post","put","patch"],e=>{CV.headers[e]={}});var AV=CV;const Sdt=b_.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),PY=Symbol("internals");function kN(e){var r;return e&&xS(r=String(e)).call(r).toLowerCase()}function cL(e){return e===!1||e==null?e:b_.isArray(e)?e.map(cL):String(e)}function OV(e,r,i,d,h){return b_.isFunction(d)?d.call(this,r,i):(h&&(r=i),b_.isString(r)?b_.isString(d)?r.indexOf(d)!==-1:b_.isRegExp(d)?d.test(r):void 0:void 0)}class uL{constructor(r){r&&this.set(r)}set(r,i,d){const h=this;function f(C,P,x){const H=kN(P);if(!H)throw new Error("header name must be a non-empty string");const $=b_.findKey(h,H);(!$||h[$]===void 0||x===!0||x===void 0&&h[$]!==!1)&&(h[$||P]=cL(C))}const g=(C,P)=>b_.forEach(C,(x,H)=>f(x,H,P));if(b_.isPlainObject(r)||r instanceof this.constructor)g(r,i);else if(b_.isString(r)&&(r=xS(r).call(r))&&!/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(xS(b=r).call(b)))g((C=>{const P={};let x,H,$;return C&&C.split(`
`).forEach(function(_t){var _i,ue;$=_t.indexOf(":"),x=xS(_i=_t.substring(0,$)).call(_i).toLowerCase(),H=xS(ue=_t.substring($+1)).call(ue),!x||P[x]&&Sdt[x]||(x==="set-cookie"?P[x]?P[x].push(H):P[x]=[H]:P[x]=P[x]?P[x]+", "+H:H)}),P})(r),i);else if(b_.isObject(r)&&b_.isIterable(r)){let C,P,x={};for(const H of r){if(!b_.isArray(H))throw TypeError("Object iterator must return a key-value pair");x[P=H[0]]=(C=x[P])?b_.isArray(C)?[...C,H[1]]:[C,H[1]]:H[1]}g(x,i)}else r!=null&&f(i,r,d);var b;return this}get(r,i){if(r=kN(r)){const d=b_.findKey(this,r);if(d){const h=this[d];if(!i)return h;if(i===!0)return function(f){const g=Object.create(null),b=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let C;for(;C=b.exec(f);)g[C[1]]=C[2];return g}(h);if(b_.isFunction(i))return i.call(this,h,d);if(b_.isRegExp(i))return i.exec(h);throw new TypeError("parser must be boolean|regexp|function")}}}has(r,i){if(r=kN(r)){const d=b_.findKey(this,r);return!(!d||this[d]===void 0||i&&!OV(0,this[d],d,i))}return!1}delete(r,i){const d=this;let h=!1;function f(g){if(g=kN(g)){const b=b_.findKey(d,g);!b||i&&!OV(0,d[b],b,i)||(delete d[b],h=!0)}}return b_.isArray(r)?r.forEach(f):f(r),h}clear(r){const i=Object.keys(this);let d=i.length,h=!1;for(;d--;){const f=i[d];r&&!OV(0,this[f],f,r,!0)||(delete this[f],h=!0)}return h}normalize(r){const i=this,d={};return b_.forEach(this,(h,f)=>{var g;const b=b_.findKey(d,f);if(b)return i[b]=cL(h),void delete i[f];const C=r?function(P){return xS(P).call(P).toLowerCase().replace(/([a-z\d])(\w*)/g,(x,H,$)=>H.toUpperCase()+$)}(f):xS(g=String(f)).call(g);C!==f&&delete i[f],i[C]=cL(h),d[C]=!0}),this}concat(){for(var r=arguments.length,i=new Array(r),d=0;d<r;d++)i[d]=arguments[d];return this.constructor.concat(this,...i)}toJSON(r){const i=Object.create(null);return b_.forEach(this,(d,h)=>{d!=null&&d!==!1&&(i[h]=r&&b_.isArray(d)?d.join(", "):d)}),i}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(r=>{let[i,d]=r;return i+": "+d}).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(r){return r instanceof this?r:new this(r)}static concat(r){const i=new this(r);for(var d=arguments.length,h=new Array(d>1?d-1:0),f=1;f<d;f++)h[f-1]=arguments[f];return h.forEach(g=>i.set(g)),i}static accessor(r){const i=(this[PY]=this[PY]={accessors:{}}).accessors,d=this.prototype;function h(f){const g=kN(f);i[g]||(function(b,C){const P=b_.toCamelCase(" "+C);["get","set","has"].forEach(x=>{Object.defineProperty(b,x+P,{value:function(H,$,_t){return this[x].call(this,C,H,$,_t)},configurable:!0})})}(d,f),i[g]=!0)}return b_.isArray(r)?r.forEach(h):h(r),this}}uL.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),b_.reduceDescriptors(uL.prototype,(e,r)=>{let{value:i}=e,d=r[0].toUpperCase()+r.slice(1);return{get:()=>i,set(h){this[d]=h}}}),b_.freezeMethods(uL);var fR=uL;function NV(e,r){const i=this||AV,d=r||i,h=fR.from(d.headers);let f=d.data;return b_.forEach(e,function(g){f=g.call(i,f,h.normalize(),r?r.status:void 0)}),h.normalize(),f}function DY(e){return!(!e||!e.__CANCEL__)}function hO(e,r,i){RE.call(this,e??"canceled",RE.ERR_CANCELED,r,i),this.name="CanceledError"}function kY(e,r,i){const d=i.config.validateStatus;i.status&&d&&!d(i.status)?r(new RE("Request failed with status code "+i.status,[RE.ERR_BAD_REQUEST,RE.ERR_BAD_RESPONSE][Math.floor(i.status/100)-4],i.config,i.request,i)):e(i)}b_.inherits(hO,RE,{__CANCEL__:!0});const dL=function(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,d=0;const h=function(f,g){f=f||10;const b=new Array(f),C=new Array(f);let P,x=0,H=0;return g=g!==void 0?g:1e3,function($){const _t=Date.now(),_i=C[H];P||(P=_t),b[x]=$,C[x]=_t;let ue=H,_r=0;for(;ue!==x;)_r+=b[ue++],ue%=f;if(x=(x+1)%f,x===H&&(H=(H+1)%f),_t-P<g)return;const Fi=_i&&_t-_i;return Fi?Math.round(1e3*_r/Fi):void 0}}(50,250);return function(f,g){let b,C,P=0,x=1e3/g;const H=function($){P=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Date.now(),b=null,C&&(clearTimeout(C),C=null),f.apply(null,$)};return[function(){const $=Date.now(),_t=$-P;for(var _i=arguments.length,ue=new Array(_i),_r=0;_r<_i;_r++)ue[_r]=arguments[_r];_t>=x?H(ue,$):(b=ue,C||(C=setTimeout(()=>{C=null,H(b)},x-_t)))},()=>b&&H(b)]}(f=>{const g=f.loaded,b=f.lengthComputable?f.total:void 0,C=g-d,P=h(C);d=g,e({loaded:g,total:b,progress:b?g/b:void 0,bytes:C,rate:P||void 0,estimated:P&&b&&g<=b?(b-g)/P:void 0,event:f,lengthComputable:b!=null,[r?"download":"upload"]:!0})},i)},LY=(e,r)=>{const i=e!=null;return[d=>r[0]({lengthComputable:i,total:e,loaded:d}),r[1]]},MY=e=>function(){for(var r=arguments.length,i=new Array(r),d=0;d<r;d++)i[d]=arguments[d];return b_.asap(()=>e(...i))};var Tdt=ZS.hasStandardBrowserEnv?((e,r)=>i=>(i=new UD(i,ZS.origin),e.protocol===i.protocol&&e.host===i.host&&(r||e.port===i.port)))(new UD(ZS.origin),ZS.navigator&&/(msie|trident)/i.test(ZS.navigator.userAgent)):()=>!0,Rdt=ZS.hasStandardBrowserEnv?{write(e,r,i,d,h,f){const g=[e+"="+encodeURIComponent(r)];b_.isNumber(i)&&g.push("expires="+new Date(i).toGMTString()),b_.isString(d)&&g.push("path="+d),b_.isString(h)&&g.push("domain="+h),f===!0&&g.push("secure"),document.cookie=g.join("; ")},read(e){const r=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return r?decodeURIComponent(r[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read:()=>null,remove(){}};function xY(e,r,i){let d=!function(h){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(h)}(r);return e&&(d||i==0)?function(h,f){return f?h.replace(/\/?\/$/,"")+"/"+f.replace(/^\/+/,""):h}(e,r):r}function UY(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}const VY=e=>e instanceof fR?function(r){for(var i=1;i<arguments.length;i++){var d=arguments[i]!=null?arguments[i]:{};i%2?UY(Object(d),!0).forEach(function(h){Ei(r,h,d[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(d)):UY(Object(d)).forEach(function(h){Object.defineProperty(r,h,Object.getOwnPropertyDescriptor(d,h))})}return r}({},e):e;function dI(e,r){r=r||{};const i={};function d(P,x,H,$){return b_.isPlainObject(P)&&b_.isPlainObject(x)?b_.merge.call({caseless:$},P,x):b_.isPlainObject(x)?b_.merge({},x):b_.isArray(x)?x.slice():x}function h(P,x,H,$){return b_.isUndefined(x)?b_.isUndefined(P)?void 0:d(void 0,P,0,$):d(P,x,0,$)}function f(P,x){if(!b_.isUndefined(x))return d(void 0,x)}function g(P,x){return b_.isUndefined(x)?b_.isUndefined(P)?void 0:d(void 0,P):d(void 0,x)}function b(P,x,H){return H in r?d(P,x):H in e?d(void 0,P):void 0}const C={url:f,method:f,data:f,baseURL:g,transformRequest:g,transformResponse:g,paramsSerializer:g,timeout:g,timeoutMessage:g,withCredentials:g,withXSRFToken:g,adapter:g,responseType:g,xsrfCookieName:g,xsrfHeaderName:g,onUploadProgress:g,onDownloadProgress:g,decompress:g,maxContentLength:g,maxBodyLength:g,beforeRedirect:g,transport:g,httpAgent:g,httpsAgent:g,cancelToken:g,socketPath:g,responseEncoding:g,validateStatus:b,headers:(P,x,H)=>h(VY(P),VY(x),0,!0)};return b_.forEach(Object.keys(Object.assign({},e,r)),function(P){const x=C[P]||h,H=x(e[P],r[P],P);b_.isUndefined(H)&&x!==b||(i[P]=H)}),i}var jY=e=>{const r=dI({},e);let i,{data:d,withXSRFToken:h,xsrfHeaderName:f,xsrfCookieName:g,headers:b,auth:C}=r;if(r.headers=b=fR.from(b),r.url=nH(xY(r.baseURL,r.url,r.allowAbsoluteUrls),e.params,e.paramsSerializer),C&&b.set("Authorization","Basic "+btoa((C.username||"")+":"+(C.password?unescape(encodeURIComponent(C.password)):""))),b_.isFormData(d)){if(ZS.hasStandardBrowserEnv||ZS.hasStandardBrowserWebWorkerEnv)b.setContentType(void 0);else if((i=b.getContentType())!==!1){const[P,...x]=i?i.split(";").map(H=>xS(H).call(H)).filter(Boolean):[];b.setContentType([P||"multipart/form-data",...x].join("; "))}}if(ZS.hasStandardBrowserEnv&&(h&&b_.isFunction(h)&&(h=h(r)),h||h!==!1&&Tdt(r.url))){const P=f&&g&&Rdt.read(g);P&&b.set(f,P)}return r},Idt=typeof XMLHttpRequest<"u"&&function(e){return new T_(function(r,i){const d=jY(e);let h=d.data;const f=fR.from(d.headers).normalize();let g,b,C,P,x,{responseType:H,onUploadProgress:$,onDownloadProgress:_t}=d;function _i(){P&&P(),x&&x(),d.cancelToken&&d.cancelToken.unsubscribe(g),d.signal&&d.signal.removeEventListener("abort",g)}let ue=new XMLHttpRequest;function _r(){if(!ue)return;const Di=fR.from("getAllResponseHeaders"in ue&&ue.getAllResponseHeaders());kY(function(Js){r(Js),_i()},function(Js){i(Js),_i()},{data:H&&H!=="text"&&H!=="json"?ue.response:ue.responseText,status:ue.status,statusText:ue.statusText,headers:Di,config:e,request:ue}),ue=null}ue.open(d.method.toUpperCase(),d.url,!0),ue.timeout=d.timeout,"onloadend"in ue?ue.onloadend=_r:ue.onreadystatechange=function(){ue&&ue.readyState===4&&(ue.status!==0||ue.responseURL&&ue.responseURL.indexOf("file:")===0)&&setTimeout(_r)},ue.onabort=function(){ue&&(i(new RE("Request aborted",RE.ECONNABORTED,e,ue)),ue=null)},ue.onerror=function(){i(new RE("Network Error",RE.ERR_NETWORK,e,ue)),ue=null},ue.ontimeout=function(){let Di=d.timeout?"timeout of "+d.timeout+"ms exceeded":"timeout exceeded";const Js=d.transitional||iH;d.timeoutErrorMessage&&(Di=d.timeoutErrorMessage),i(new RE(Di,Js.clarifyTimeoutError?RE.ETIMEDOUT:RE.ECONNABORTED,e,ue)),ue=null},h===void 0&&f.setContentType(null),"setRequestHeader"in ue&&b_.forEach(f.toJSON(),function(Di,Js){ue.setRequestHeader(Js,Di)}),b_.isUndefined(d.withCredentials)||(ue.withCredentials=!!d.withCredentials),H&&H!=="json"&&(ue.responseType=d.responseType),_t&&([C,x]=dL(_t,!0),ue.addEventListener("progress",C)),$&&ue.upload&&([b,P]=dL($),ue.upload.addEventListener("progress",b),ue.upload.addEventListener("loadend",P)),(d.cancelToken||d.signal)&&(g=Di=>{ue&&(i(!Di||Di.type?new hO(null,e,ue):Di),ue.abort(),ue=null)},d.cancelToken&&d.cancelToken.subscribe(g),d.signal&&(d.signal.aborted?g():d.signal.addEventListener("abort",g)));const Fi=function(Di){const Js=/^([-+\w]{1,25})(:?\/\/|:)/.exec(Di);return Js&&Js[1]||""}(d.url);Fi&&ZS.protocols.indexOf(Fi)===-1?i(new RE("Unsupported protocol "+Fi+":",RE.ERR_BAD_REQUEST,e)):ue.send(h||null)})},wdt=(e,r)=>{const{length:i}=e=e?e.filter(Boolean):[];if(r||i){let d,h=new AbortController;const f=function(P){if(!d){d=!0,b();const x=P instanceof Error?P:this.reason;h.abort(x instanceof RE?x:new hO(x instanceof Error?x.message:x))}};let g=r&&setTimeout(()=>{g=null,f(new RE("timeout ".concat(r," of ms exceeded"),RE.ETIMEDOUT))},r);const b=()=>{e&&(g&&clearTimeout(g),g=null,e.forEach(P=>{P.unsubscribe?P.unsubscribe(f):P.removeEventListener("abort",f)}),e=null)};e.forEach(P=>P.addEventListener("abort",f));const{signal:C}=h;return C.unsubscribe=()=>b_.asap(b),C}},PV=_(CW),FY=aO.f("asyncIterator"),Cdt=_(FY);function DV(e,r){this.v=e,this.k=r}function CT(e){return function(){return new LN(e.apply(this,arguments))}}function LN(e){var r,i;function d(f,g){try{var b=e[f](g),C=b.value,P=C instanceof DV;PV.resolve(P?C.v:C).then(function(x){if(P){var H=f==="return"?"return":"next";if(!C.k||x.done)return d(H,x);x=e[H](x).value}h(b.done?"return":"normal",x)},function(x){d("throw",x)})}catch(x){h("throw",x)}}function h(f,g){switch(f){case"return":r.resolve({value:g,done:!0});break;case"throw":r.reject(g);break;default:r.resolve({value:g,done:!1})}(r=r.next)?d(r.key,r.arg):i=null}this._invoke=function(f,g){return new PV(function(b,C){var P={key:f,arg:g,resolve:b,reject:C,next:null};i?i=i.next=P:(r=i=P,d(f,g))})},typeof e.return!="function"&&(this.return=void 0)}function cE(e){return new DV(e,0)}function lL(e){var r={},i=!1;function d(h,f){return i=!0,f=new PV(function(g){g(e[h](f))}),{done:!1,value:new DV(f,1)}}return r[lO!==void 0&&fY||"@@iterator"]=function(){return this},r.next=function(h){return i?(i=!1,h):d("next",h)},typeof e.throw=="function"&&(r.throw=function(h){if(i)throw i=!1,h;return d("throw",h)}),typeof e.return=="function"&&(r.return=function(h){return i?(i=!1,h):d("return",h)}),r}LN.prototype[typeof lO=="function"&&Cdt||"@@asyncIterator"]=function(){return this},LN.prototype.next=function(e){return this._invoke("next",e)},LN.prototype.throw=function(e){return this._invoke("throw",e)},LN.prototype.return=function(e){return this._invoke("return",e)};var kV=_(FY);function LV(e){var r,i,d,h=2;for(typeof Symbol<"u"&&(i=kV,d=Symbol.iterator);h--;){if(i&&(r=e[i])!=null)return r.call(e);if(d&&(r=e[d])!=null)return new hL(r.call(e));i="@@asyncIterator",d="@@iterator"}throw new TypeError("Object is not async iterable")}function hL(e){function r(i){if(Object(i)!==i)return T_.reject(new TypeError(i+" is not an object."));var d=i.done;return T_.resolve(i.value).then(function(h){return{value:h,done:d}})}return hL=function(i){this.s=i,this.n=i.next},hL.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var d=this.s.return;return d===void 0?T_.resolve({value:i,done:!0}):r(d.apply(this.s,arguments))},throw:function(i){var d=this.s.return;return d===void 0?T_.reject(i):r(d.apply(this.s,arguments))}},new hL(e)}const Adt=function*(e,r){let i=e.byteLength;if(!r||i<r)return void(yield e);let d,h=0;for(;h<i;)d=h+r,yield e.slice(h,d),h=d},Odt=function(){var e=CT(function*(r,i){var d,h=!1,f=!1;try{for(var g,b=LV(Ndt(r));h=!(g=yield cE(b.next())).done;h=!1){const C=g.value;yield*lL(LV(Adt(C,i)))}}catch(C){f=!0,d=C}finally{try{h&&b.return!=null&&(yield cE(b.return()))}finally{if(f)throw d}}});return function(r,i){return e.apply(this,arguments)}}(),Ndt=function(){var e=CT(function*(r){if(r[kV])return void(yield*lL(LV(r)));const i=r.getReader();try{for(;;){const{done:d,value:h}=yield cE(i.read());if(d)break;yield h}}finally{yield cE(i.cancel())}});return function(r){return e.apply(this,arguments)}}(),BY=(e,r,i,d)=>{const h=Odt(e,r);let f,g=0,b=C=>{f||(f=!0,d&&d(C))};return new ReadableStream({async pull(C){try{const{done:P,value:x}=await h.next();if(P)return b(),void C.close();let H=x.byteLength;if(i){let $=g+=H;i($)}C.enqueue(new Uint8Array(x))}catch(P){throw b(P),P}},cancel:C=>(b(C),h.return())},{highWaterMark:2})};function GY(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function qY(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?GY(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):GY(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}const pL=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",WY=pL&&typeof ReadableStream=="function",Pdt=pL&&(typeof TextEncoder=="function"?(KY=new TextEncoder,e=>KY.encode(e)):async e=>new Uint8Array(await new Response(e).arrayBuffer()));var KY;const HY=function(e){try{for(var r=arguments.length,i=new Array(r>1?r-1:0),d=1;d<r;d++)i[d-1]=arguments[d];return!!e(...i)}catch{return!1}},Ddt=WY&&HY(()=>{let e=!1;const r=new Request(ZS.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!r}),MV=WY&&HY(()=>b_.isReadableStream(new Response("").body)),fL={stream:MV&&(e=>e.body)};var zY;pL&&(zY=new Response,["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!fL[e]&&(fL[e]=b_.isFunction(zY[e])?r=>r[e]():(r,i)=>{throw new RE("Response type '".concat(e,"' is not supported"),RE.ERR_NOT_SUPPORT,i)})}));const kdt=async(e,r)=>{const i=b_.toFiniteNumber(e.getContentLength());return i??(async d=>d==null?0:b_.isBlob(d)?d.size:b_.isSpecCompliantForm(d)?(await new Request(ZS.origin,{method:"POST",body:d}).arrayBuffer()).byteLength:b_.isArrayBufferView(d)||b_.isArrayBuffer(d)?d.byteLength:(b_.isURLSearchParams(d)&&(d+=""),b_.isString(d)?(await Pdt(d)).byteLength:void 0))(r)};var Ldt=pL&&(async e=>{let{url:r,method:i,data:d,signal:h,cancelToken:f,timeout:g,onDownloadProgress:b,onUploadProgress:C,responseType:P,headers:x,withCredentials:H="same-origin",fetchOptions:$}=jY(e);P=P?(P+"").toLowerCase():"text";let _t,_i=wdt([h,f&&f.toAbortSignal()],g);const ue=_i&&_i.unsubscribe&&(()=>{_i.unsubscribe()});let _r;try{if(C&&Ddt&&i!=="get"&&i!=="head"&&(_r=await kdt(x,d))!==0){let _u,ga=new Request(r,{method:"POST",body:d,duplex:"half"});if(b_.isFormData(d)&&(_u=ga.headers.get("content-type"))&&x.setContentType(_u),ga.body){const[_m,r_]=LY(_r,dL(MY(C)));d=BY(ga.body,65536,_m,r_)}}b_.isString(H)||(H=H?"include":"omit");const Fi="credentials"in Request.prototype;_t=new Request(r,qY(qY({},$),{},{signal:_i,method:i.toUpperCase(),headers:x.normalize().toJSON(),body:d,duplex:"half",credentials:Fi?H:void 0}));let Di=await fetch(_t);const Js=MV&&(P==="stream"||P==="response");if(MV&&(b||Js&&ue)){const _u={};["status","statusText","headers"].forEach(a_=>{_u[a_]=Di[a_]});const ga=b_.toFiniteNumber(Di.headers.get("content-length")),[_m,r_]=b&&LY(ga,dL(MY(b),!0))||[];Di=new Response(BY(Di.body,65536,_m,()=>{r_&&r_(),ue&&ue()}),_u)}P=P||"text";let _l=await fL[b_.findKey(fL,P)||"text"](Di,e);return!Js&&ue&&ue(),await new T_((_u,ga)=>{kY(_u,ga,{data:_l,headers:fR.from(Di.headers),status:Di.status,statusText:Di.statusText,config:e,request:_t})})}catch(Fi){throw ue&&ue(),Fi&&Fi.name==="TypeError"&&/Load failed|fetch/i.test(Fi.message)?Object.assign(new RE("Network Error",RE.ERR_NETWORK,e,_t),{cause:Fi.cause||Fi}):RE.from(Fi,Fi&&Fi.code,e,_t)}});const xV={http:null,xhr:Idt,fetch:Ldt};b_.forEach(xV,(e,r)=>{if(e){try{Object.defineProperty(e,"name",{value:r})}catch{}Object.defineProperty(e,"adapterName",{value:r})}});const YY=e=>"- ".concat(e),Mdt=e=>b_.isFunction(e)||e===null||e===!1;var JY={getAdapter:e=>{e=b_.isArray(e)?e:[e];const{length:r}=e;let i,d;const h={};for(let f=0;f<r;f++){let g;if(i=e[f],d=i,!Mdt(i)&&(d=xV[(g=String(i)).toLowerCase()],d===void 0))throw new RE("Unknown adapter '".concat(g,"'"));if(d)break;h[g||"#"+f]=d}if(!d){const f=Object.entries(h).map(g=>{let[b,C]=g;return"adapter ".concat(b," ")+(C===!1?"is not supported by the environment":"is not available in the build")});throw new RE("There is no suitable adapter to dispatch the request "+(r?f.length>1?`since :
`+f.map(YY).join(`
`):" "+YY(f[0]):"as no adapter specified"),"ERR_NOT_SUPPORT")}return d},adapters:xV};function UV(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new hO(null,e)}function XY(e){return UV(e),e.headers=fR.from(e.headers),e.data=NV.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),JY.getAdapter(e.adapter||AV.adapter)(e).then(function(r){return UV(e),r.data=NV.call(e,e.transformResponse,r),r.headers=fR.from(r.headers),r},function(r){return DY(r)||(UV(e),r&&r.response&&(r.response.data=NV.call(e,e.transformResponse,r.response),r.response.headers=fR.from(r.response.headers))),T_.reject(r)})}const QY="1.9.0",mL={};["object","boolean","number","function","string","symbol"].forEach((e,r)=>{mL[e]=function(i){return typeof i===e||"a"+(r<1?"n ":" ")+e}});const ZY={};mL.transitional=function(e,r,i){function d(h,f){return"[Axios v"+QY+"] Transitional option '"+h+"'"+f+(i?". "+i:"")}return(h,f,g)=>{if(e===!1)throw new RE(d(f," has been removed"+(r?" in "+r:"")),RE.ERR_DEPRECATED);return r&&!ZY[f]&&(ZY[f]=!0,console.warn(d(f," has been deprecated since v"+r+" and will be removed in the near future"))),!e||e(h,f,g)}},mL.spelling=function(e){return(r,i)=>(console.warn("".concat(i," is likely a misspelling of ").concat(e)),!0)};var _L={assertOptions:function(e,r,i){if(typeof e!="object")throw new RE("options must be an object",RE.ERR_BAD_OPTION_VALUE);const d=Object.keys(e);let h=d.length;for(;h-- >0;){const f=d[h],g=r[f];if(g){const b=e[f],C=b===void 0||g(b,f,e);if(C!==!0)throw new RE("option "+f+" must be "+C,RE.ERR_BAD_OPTION_VALUE)}else if(i!==!0)throw new RE("Unknown option "+f,RE.ERR_BAD_OPTION)}},validators:mL};const kR=_L.validators;let EL=class{constructor(e){this.defaults=e||{},this.interceptors={request:new rH,response:new rH}}async request(e,r){try{return await this._request(e,r)}catch(i){if(i instanceof Error){let d={};Error.captureStackTrace?Error.captureStackTrace(d):d=new Error;const h=d.stack?d.stack.replace(/^.+\n/,""):"";try{i.stack?h&&!String(i.stack).endsWith(h.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+h):i.stack=h}catch{}}throw i}}_request(e,r){typeof e=="string"?(r=r||{}).url=e:r=e||{},r=dI(this.defaults,r);const{transitional:i,paramsSerializer:d,headers:h}=r;i!==void 0&&_L.assertOptions(i,{silentJSONParsing:kR.transitional(kR.boolean),forcedJSONParsing:kR.transitional(kR.boolean),clarifyTimeoutError:kR.transitional(kR.boolean)},!1),d!=null&&(b_.isFunction(d)?r.paramsSerializer={serialize:d}:_L.assertOptions(d,{encode:kR.function,serialize:kR.function},!0)),r.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?r.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:r.allowAbsoluteUrls=!0),_L.assertOptions(r,{baseUrl:kR.spelling("baseURL"),withXsrfToken:kR.spelling("withXSRFToken")},!0),r.method=(r.method||this.defaults.method||"get").toLowerCase();let f=h&&b_.merge(h.common,h[r.method]);h&&b_.forEach(["delete","get","head","post","put","patch","common"],_t=>{delete h[_t]}),r.headers=fR.concat(f,h);const g=[];let b=!0;this.interceptors.request.forEach(function(_t){typeof _t.runWhen=="function"&&_t.runWhen(r)===!1||(b=b&&_t.synchronous,g.unshift(_t.fulfilled,_t.rejected))});const C=[];let P;this.interceptors.response.forEach(function(_t){C.push(_t.fulfilled,_t.rejected)});let x,H=0;if(!b){const _t=[XY.bind(this),void 0];for(_t.unshift.apply(_t,g),_t.push.apply(_t,C),x=_t.length,P=T_.resolve(r);H<x;)P=P.then(_t[H++],_t[H++]);return P}x=g.length;let $=r;for(H=0;H<x;){const _t=g[H++],_i=g[H++];try{$=_t($)}catch(ue){_i.call(this,ue);break}}try{P=XY.call(this,$)}catch(_t){return T_.reject(_t)}for(H=0,x=C.length;H<x;)P=P.then(C[H++],C[H++]);return P}getUri(e){return nH(xY((e=dI(this.defaults,e)).baseURL,e.url,e.allowAbsoluteUrls),e.params,e.paramsSerializer)}};b_.forEach(["delete","get","head","options"],function(e){EL.prototype[e]=function(r,i){return this.request(dI(i||{},{method:e,url:r,data:(i||{}).data}))}}),b_.forEach(["post","put","patch"],function(e){function r(i){return function(d,h,f){return this.request(dI(f||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:d,data:h}))}}EL.prototype[e]=r(),EL.prototype[e+"Form"]=r(!0)});var gL=EL;class VV{constructor(r){if(typeof r!="function")throw new TypeError("executor must be a function.");let i;this.promise=new T_(function(h){i=h});const d=this;this.promise.then(h=>{if(!d._listeners)return;let f=d._listeners.length;for(;f-- >0;)d._listeners[f](h);d._listeners=null}),this.promise.then=h=>{let f;const g=new T_(b=>{d.subscribe(b),f=b}).then(h);return g.cancel=function(){d.unsubscribe(f)},g},r(function(h,f,g){d.reason||(d.reason=new hO(h,f,g),i(d.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(r){this.reason?r(this.reason):this._listeners?this._listeners.push(r):this._listeners=[r]}unsubscribe(r){if(!this._listeners)return;const i=this._listeners.indexOf(r);i!==-1&&this._listeners.splice(i,1)}toAbortSignal(){const r=new AbortController,i=d=>{r.abort(d)};return this.subscribe(i),r.signal.unsubscribe=()=>this.unsubscribe(i),r.signal}static source(){let r;return{token:new VV(function(d){r=d}),cancel:r}}}var xdt=VV;const jV={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(jV).forEach(e=>{let[r,i]=e;jV[i]=r});var Udt=jV;const kS=function e(r){const i=new gL(r),d=jK(gL.prototype.request,i);return b_.extend(d,gL.prototype,i,{allOwnKeys:!0}),b_.extend(d,i,null,{allOwnKeys:!0}),d.create=function(h){return e(dI(r,h))},d}(AV);kS.Axios=gL,kS.CanceledError=hO,kS.CancelToken=xdt,kS.isCancel=DY,kS.VERSION=QY,kS.toFormData=ZD,kS.AxiosError=RE,kS.Cancel=kS.CanceledError,kS.all=function(e){return T_.all(e)},kS.spread=function(e){return function(r){return e.apply(null,r)}},kS.isAxiosError=function(e){return b_.isObject(e)&&e.isAxiosError===!0},kS.mergeConfig=dI,kS.AxiosHeaders=fR,kS.formToJSON=e=>NY(b_.isHTMLForm(e)?new FormData(e):e),kS.getAdapter=JY.getAdapter,kS.HttpStatusCode=Udt,kS.default=kS;var zS=kS;const Vdt=()=>{};function MN(){const e={promise:void 0,isResolved:!1,isRejected:!1,isFinished:!1,resolve:void 0,reject:void 0,cancel:Vdt};return e.promise=new T_((r,i)=>{e.resolve=d=>{e.isFinished||(e.isResolved=!0,e.isFinished=!0,r(d),e.value=d)},e.reject=d=>{e.isFinished||(e.isRejected=!0,e.isFinished=!0,i(d))}}),e}const vL=new Map,bL=new Map,LR=new Map;let aS=function(e){return e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.CHROMIUM_OS="Chromium OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot",e}({}),hE=function(e){return e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger",e}({});const $Y=new fat;let mR=$Y.getResult(),FV=null;function oE(e){if(!FV){mR=$Y.getResult();const r=function(b){if(b.engine.name==="Blink"&&b.browser.name!=="WeChat")return hE.CHROME;switch(b.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return hE.CHROME;case"Safari":case"Mobile Safari":return hE.SAFARI;case"Edge":return hE.EDGE;case"Firefox":return hE.FIREFOX;case"QQ":case"QQBrowser":return hE.QQ;case"Opera":return hE.OPERA;case"WeChat":return hE.WECHAT;default:return b.browser.name||""}}(mR),i=t4(mR),d=function(b){return b.os.name==="Windows"?b.os.version?b.os.name+" "+b.os.version:b.os.name:b.os.name||""}(mR),h=mR.os.version,f=t4(mR,!1),g=mR.device.type;if(!(r&&i&&d&&h))return{name:r,version:i,os:d,osVersion:h,browserVersion:f,deviceType:g};FV={name:r,version:i,os:d,osVersion:h,browserVersion:f,deviceType:g}}return FV}function t4(e){let r,i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];return r=e.engine.name==="Blink"?e.engine.version||"":e.browser.version||"",i?r.split(".")[0]:r}function yL(){return oE().os}function e4(){const e=oE();return"".concat(e.os," ").concat(e.osVersion)}function SL(){const e=oE();return!!(mR.engine.name==="WebKit"&&e.os===aS.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==hE.SAFARI||LS()&&e.name!==hE.SAFARI)}function e0(){return oE().name===hE.CHROME}function yS(){return oE().name===hE.SAFARI}function n4(){const e=oE();if(e.name!==hE.SAFARI||!e.browserVersion)return!1;const r=e.browserVersion.split(".");return Number(r[0])>15||Number(r[0])===15&&Number(r[1])>=4}function r4(){return oE().name===hE.EDGE}function KE(){return oE().name===hE.FIREFOX}function LS(){return oE().os===aS.IOS}function pO(e){const r=oE();return!(r.name!==hE.CHROME||!r.osVersion)&&Number(r.version)>=e}function i4(e){const r=oE();return!(r.name!==hE.CHROME||!r.osVersion)&&Number(r.version)<e}function BV(e,r,i){const d=oE();return!(d.name!==e||!d.osVersion)&&(i?Number(d.version)>=r&&Number(d.version)<=i:Number(d.version)===r)}function GV(e){const r=oE();return!(r.name!==hE.EDGE||!r.osVersion)&&Number(r.version)>=e}function qV(e){const r=oE();return!(r.name!==hE.FIREFOX||!r.osVersion)&&Number(r.version)>=e}function o4(e){const r=oE();return!(r.name!==hE.SAFARI||!r.osVersion)&&Number(r.version)>=e}function s4(e,r,i){const d=oE();if(d.os!==aS.IOS||!d.osVersion)return!1;const h=d.osVersion.split(".");return i?r&&Number(h[0])===e&&Number(h[1])>r||Number(h[0])>e:r?Number(h[0])===e&&Number(h[1])>=r||Number(h[0])>e:Number(h[0])>=e}function a4(e,r,i){const d=oE();if(d.os!==aS.IOS||!d.osVersion)return!1;const h=d.osVersion.split(".");return r&&Number(h[0])===e&&Number(h[1])<r||Number(h[0])<e}function WV(e,r,i){const d=oE();if(d.name!==hE.SAFARI||!d.osVersion||!d.browserVersion)return!1;const h=d.browserVersion.split(".");return i?r&&Number(h[0])===e&&Number(h[1])<r||Number(h[0])<e:r?Number(h[0])===e&&Number(h[1])<=r||Number(h[0])<e:Number(h[0])<=e}function KV(e){const r=oE();return!(r.name!==hE.OPERA||!r.osVersion)&&Number(r.version)>=e}function c4(){const e=oE();if(e.os!==aS.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])<14||Number(r[0])===14&&Number(r[1])<=6}function fO(){const e=oE();if(e.os!==aS.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15}function HV(){const e=oE();if(e.os!==aS.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===16}function u4(){const e=oE();if(e.os!==aS.IOS||!e.osVersion)return!1;const r=e.osVersion.split(".");return Number(r[0])===15&&Number(r[1])>=1}function JT(){return yS()&&navigator.maxTouchPoints>0}function d4(){return oE().name===hE.WECHAT}function l4(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function zV(){const e=yL();return function(){const{deviceType:r}=oE();return r==="mobile"||r==="tablet"}()||e===aS.ANDROID||e===aS.IOS||e===aS.HARMONY_OS}function n0(){const e=oE();return e.name!==hE.EDGE&&e.name!==hE.SAFARI&&!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function TL(){return yL()===aS.ANDROID}function xN(){const e=oE();return TL()&&(e.name===hE.CHROME||e.name===hE.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}function G_(e,r,i){return(r=function(d){var h=function(f,g){if(typeof f!="object"||!f)return f;var b=f[Symbol.toPrimitive];if(b!==void 0){var C=b.call(f,"string");if(typeof C!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(f)}(d);return typeof h=="symbol"?h:h+""}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function h4(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function f_(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?h4(Object(i),!0).forEach(function(d){G_(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):h4(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}let Gi=function(e){return e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.ADD_CANDIDATE_FAILED="ADD_CANDIDATE_FAILED",e.DATACHANNEL_FAILED="DATACHANNEL_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.EXTERNAL_SIGNAL_ABORT="EXTERNAL_SIGNAL_ABORT",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.CREATE_DATACHANNEL_ERROR="CREATE_DATACHANNEL_ERROR",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED",e.P2P_MESSAGE_FAILED="P2P_MESSAGE_FAILED",e}({}),n_=class extends Error{constructor(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",i=arguments.length>2?arguments[2]:void 0;super(r),G_(this,"code",void 0),G_(this,"message",void 0),G_(this,"data",void 0),G_(this,"name","AgoraRTCException"),this.code=e,this.message="AgoraRTCError ".concat(this.code,": ").concat(r),this.data=i}toString(){return this.data?"".concat(this.message,`
data: `).concat(JSON.stringify(this.data)):this.message}print(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error",r=arguments.length>1?arguments[1]:void 0;return e==="error"&&(r||console).error(this.toString()),e==="warning"&&(r||console).warn(this.toString()),this}throw(e){throw this.print("error",e),this}};function _R(e,r){if(typeof e!="boolean")throw new n_(Gi.INVALID_PARAMS,"Invalid ".concat(r,": The value is of the boolean type."))}function oS(e,r,i){if(!E_(i).call(i,e))throw new n_(Gi.INVALID_PARAMS,"".concat(r," can only be set as ").concat(JSON.stringify(i)))}function IE(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4;if(e<i||e>d||(!(arguments.length>4&&arguments[4]!==void 0)||arguments[4])&&!function(h){return typeof h=="number"&&h%1==0}(e))throw new n_(Gi.INVALID_PARAMS,"invalid ".concat(r,": the value range is [").concat(i,", ").concat(d,"]. integer only"))}function YV(e,r){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new n_(Gi.INVALID_PARAMS,"".concat(r," is not a valid ConstrainLong"));e.min!==void 0&&IE(e.min,"".concat(r,".min"),0,1/0),e.max!==void 0&&IE(e.max,"".concat(r,".max"),1,1/0),e.exact!==void 0&&IE(e.exact,"".concat(r,".exact"),1,1/0),e.ideal!==void 0&&IE(e.ideal,"".concat(r,".ideal"),1,1/0)}else IE(e,r,1,1/0)}function fS(e,r){let i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,h=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new n_(Gi.INVALID_PARAMS,"".concat(r||"param"," cannot be empty"));if(!p4(e,i,d,h))throw new n_(Gi.INVALID_PARAMS,"Invalid ".concat(r||"string param",": Length of the string: [").concat(i,",").concat(d,"].").concat(h?" ASCII characters only.":""))}function r0(e,r){if(!Array.isArray(e))throw new n_(Gi.INVALID_PARAMS,"".concat(r," should be an array"))}function HE(e){return e==null}function p4(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,d=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=i&&e.length>=r&&(!d||function(h){if(typeof h!="string")return!1;for(let f=0;f<h.length;f+=1){const g=h.charCodeAt(f);if(g<0||g>255)return!1}return!0}(e))}var UN=function(e){return e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE",e}(UN||{}),JV=function(e){return e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT",e}(JV||{});const f4=new class{constructor(){G_(this,"_clientSize",null),G_(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),G_(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),G_(this,"getStyle",e=>window.getComputedStyle(e,null)),G_(this,"checkCssVisibleProperty",e=>{var r;let i=!0;const d=this.getStyle(e),{display:h,visibility:f,opacity:g,filter:b}=d;return(h==="none"||E_(r=["hidden","collapse"]).call(r,f)||Number(g)<.1)&&(i=!1),!!i&&(b&&b.split(" ").filter(C=>{var P;const x=C.split("(")[0];return E_(P=["brightness","blur","opacity"]).call(P,x)}).map(C=>{const[P,x]=C.split(/\(|\)/);return[P,Number(x.match(/^[0-9\.]+/))]}).forEach(C=>{const[P,x]=C;switch(P){case"brightness":(x<.1||x>3)&&(i=!1);break;case"blur":x>3&&(i=!1);break;case"opacity":x<.1&&(i=!1)}}),i)}),G_(this,"checkPropertyUpToAllParentNodes",(e,r)=>{let i=!0,d=!0;const h=g=>r(g);let f=e;for(;f&&d;)h(f)||(i=!1,d=!1),f=f.parentElement,f||(d=!1);return i}),G_(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),G_(this,"getSizeAboutClient",e=>{const{width:r,height:i,left:d,right:h,top:f,bottom:g}=e.getBoundingClientRect(),b=this.getClientWidth(),C=this.getClientHeight();return{width:r,height:i,left:d,right:h,top:f,bottom:g,clientWidth:b,clientHeight:C,clientMin:Math.min(b,C)}}),G_(this,"checkActualSize",()=>{const{width:e,height:r,clientMin:i}=this._clientSize;return this.checkSizeIsVisible(e,r,i)}),G_(this,"elementFromPoint",(e,r)=>document.elementFromPoint?document.elementFromPoint(e,r):null),G_(this,"checkCoverForAPoint",(e,r,i)=>{const d=this.elementFromPoint(e,r);return d!==null&&d!==i}),G_(this,"getPointPositionList",()=>{const{width:e,height:r,left:i,top:d}=this._clientSize,h=e/6,f=r/6,g=[],b=10**6;for(let C=0;C<5;C++)for(let P=0;P<5;P++){const x=(i*b+(C===0?.1:C===4?(h*C*b-1e5)/b:h*C)*b)/b,H=(d*b+(P===0?.1:P===4?(f*P*b-1e5)/b:f*P)*b)/b;g.push({x,y:H})}return[...g]}),G_(this,"checkElementCover",e=>this.getPointPositionList().map(r=>this.checkCoverForAPoint(r.x,r.y,e)).filter(r=>!!r).length>6),G_(this,"checkSizeIsVisible",(e,r,i)=>(e>50||i/e<=10)&&(r>50||i/r<=10)),G_(this,"checkSizeOfPartInClient",()=>{const{left:e,right:r,top:i,bottom:d,clientHeight:h,clientWidth:f,clientMin:g}=this._clientSize;let b,C,P,x;if(e<0)b=0;else{if(!(e<f))return!1;b=e}if(r<0)return!1;if(C=r<f?r:f,i<0)P=0;else{if(!(i<h))return!1;P=i}if(d<0)return!1;x=d<h?d:h;const H=C-b,$=x-P;return this.checkSizeIsVisible(H,$,g)}),G_(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),G_(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(UN.COVERED);{const r=this.checkActualSize(),i=this.checkSizeOfPartInClient();return r&&!i?this.returnHiddenResult(UN.POSITION):r?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(UN.SIZE)}}return this.returnHiddenResult(UN.STYLE)}return this.returnHiddenResult(JV.UNMOUNTED)}return this.returnHiddenResult(JV.INVALID_HTML_ELEMENT)}),G_(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,r=>r.nodeName.toUpperCase()!=="HTML"?r.parentElement!==null:!!document.documentElement))}};function XV(e){return new TextEncoder().encode(e)}const m4=function(e,r){const i=new Uint8Array(e.byteLength+r.byteLength);return i.set(new Uint8Array(e),0),i.set(new Uint8Array(r),e.byteLength),i},QV=async e=>function(r,i){let d="";return new Uint8Array(r).forEach(h=>{d+=h.toString(i).padStart(2,"0")}),d}(await crypto.subtle.digest("SHA-256",XV(e)),16);class qE{constructor(){G_(this,"_events",{}),G_(this,"addListener",this.on)}getListeners(r){return this._events[r]?this._events[r].map(i=>i.listener):[]}on(r,i){this._events[r]||(this._events[r]=[]);const d=this._events[r];this._indexOfListener(d,i)===-1&&d.push({listener:i,once:!1})}once(r,i){this._events[r]||(this._events[r]=[]);const d=this._events[r];this._indexOfListener(d,i)===-1&&d.push({listener:i,once:!0})}off(r,i){if(!this._events[r])return;const d=this._events[r],h=this._indexOfListener(d,i);h!==-1&&d.splice(h,1),this._events[r].length===0&&delete this._events[r]}removeAllListeners(r){r?delete this._events[r]:this._events={}}emit(r){this._events[r]||(this._events[r]=[]);const i=this._events[r].map(g=>g);for(var d=arguments.length,h=new Array(d>1?d-1:0),f=1;f<d;f++)h[f-1]=arguments[f];for(let g=0;g<i.length;g+=1){const b=i[g];b.once&&this.off(r,b.listener),b.listener.apply(this,h||[])}}safeEmit(r){for(var i=arguments.length,d=new Array(i>1?i-1:0),h=1;h<i;h++)d[h-1]=arguments[h];[...this._events[r]||[]].forEach(f=>{f.once&&this.off(r,f.listener);try{f.listener.apply(this,d)}catch(g){console.error("safeEmit event:".concat(r," error ").concat(g==null?void 0:g.toString()))}})}_indexOfListener(r,i){let d=r.length;for(;d--;)if(r[d].listener===i)return d;return-1}}let VN=null;function _4(){if(VN)return VN;if(window.electron)return VN=window.electron;if(!window.require)return null;try{return VN=window.require("electron"),VN}catch{return null}}let QE=function(e){return e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.PRELOAD="PRELOAD",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.LOCAL_VIDEO_SEND_SEI_DATA="LocalVideoTrack.sendSeiData",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload",e.REPUB_AFTER_PC_CONNECTED="repubAfterPCConnected",e.PRELOAD_MEDIA_FAILED="preloadMediaFailed",e.MISMATCH_DTLS_PARAMETERS="mismatchDtlsParameters",e}({}),FE=function(e){return e.TRACER="tracer",e}({});function E4(e){return IE(e.timeout,"config.timeout",0,1e5),IE(e.timeoutFactor,"config.timeoutFactor",0,100,!1),IE(e.maxRetryCount,"config.maxRetryConfig",0,1/0),IE(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}let jdt=function(e){return e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY",e}({}),_E=function(e){return e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.FALLBACK="FALLBACK",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL",e.TOKEN_EXPIRE="TOKEN_EXPIRE",e}({});function jN(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(r=>{if(!r.urls)throw Error()})}catch{return!1}return!0}function g4(e){return fS(e.turnServerURL,"turnServerURL"),fS(e.username,"username"),fS(e.password,"password"),e.udpport&&IE(e.udpport,"udpport",1,99999,!0),e.forceturn&&_R(e.forceturn,"forceturn"),e.security&&_R(e.security,"security"),e.tcpport&&IE(e.tcpport,"tcpport",1,99999,!0),!0}function ZV(e){return e.level!==void 0&&oS(e.level,"level",[1,2,3]),e.delay!==void 0&&IE(e.delay,"delay",0,3e3,!0),!0}let nE=function(e){return e.PEERCONNECTION_STATE_CHANGE="peerconnection-state-change",e.AUDIO_METADATA="audio-metadata",e.AUDIO_PTS="audio-pts",e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change",e}({}),SS=function(e){return e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK",e.REGIONAL_DISTRIBUTION="REGIONAL_DISTRIBUTION",e}({}),uT=function(e){return e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({}),mO=function(e){return e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE",e}({});function TS(e,r){for(var i=arguments.length,d=new Array(i>2?i-2:0),h=2;h<i;h++)d[h-2]=arguments[h];return e.getListeners(r).length===0?T_.reject(new n_(Gi.UNEXPECTED_ERROR,"can not emit promise")):new T_((f,g)=>{e.emit(r,...d,f,g)})}function CE(e,r){if(e.getListeners(r).length===0)return T_.resolve();for(var i=arguments.length,d=new Array(i>2?i-2:0),h=2;h<i;h++)d[h-2]=arguments[h];return TS(e,r,...d)}function mT(e,r){if(e.getListeners(r).length===0)return null;for(var i=arguments.length,d=new Array(i>2?i-2:0),h=2;h<i;h++)d[h-2]=arguments[h];return FN(e,r,...d)}function FN(e,r){let i=null,d=null;for(var h=arguments.length,f=new Array(h>2?h-2:0),g=2;g<h;g++)f[g-2]=arguments[g];if(e.emit(r,...f,b=>{i=b},b=>{d=b}),d!==null)throw d;if(i===null)throw new n_(Gi.UNEXPECTED_ERROR,"handler is not sync");return i}const Fg=new class extends qE{set networkState(e){this.emit(mO.NETWORK_STATE_CHANGE,e,this._networkState),e===uT.ONLINE?this.emit(mO.ONLINE):e===uT.OFFLINE&&(this.onlineWaiter=new T_(r=>{this.once(mO.ONLINE,()=>{this.onlineWaiter=void 0,r(uT.ONLINE)})}),this.emit(mO.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}get isOnline(){return this._networkState===uT.ONLINE}constructor(){super(),G_(this,"_moduleName","network-indicator"),G_(this,"_networkState",uT.ONLINE),G_(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=uT.ONLINE}),window.addEventListener("offline",()=>{this.networkState=uT.OFFLINE})}};function RL(e,r){const i=e.indexOf(r);i!==-1&&e.splice(i,1)}function _O(e){const r=[];return e.forEach(i=>{r.indexOf(i)===-1&&r.push(i)}),r}function IL(e){T_!==void 0?T_.resolve().then(e):setTimeout(e,0)}function BE(e){return JSON.parse(JSON.stringify(e))}function lI(e){try{return BE(e)}catch{return e}}const v4={};function I0(e,r){v4[r]||(v4[r]=!0,e())}function hI(e){const r=window.atob(e),i=new Uint8Array(new ArrayBuffer(r.length));for(let d=0;d<r.length;d+=1)i[d]=r.charCodeAt(d);return i}function w0(e){let r="";for(let i=0;i<e.length;i+=1)r+=String.fromCharCode(e[i]);return window.btoa(r)}function b4(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:16,i=new TextEncoder().encode(e);if(i.length>r)i=i.slice(0,r);else if(i.length<r){const d=new Uint8Array(r);d.set(i),i=d}return i}function y4(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const d=GT(r).call(r,(g,b)=>g+b.length,0),h=new Uint8Array(new ArrayBuffer(d));let f=0;return r.forEach(g=>{h.set(g,f),f+=g.length}),h}function MR(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function S4(e){let r=0;return(/DingTalk/i.test(navigator.userAgent)||/AliApp/i.test(navigator.userAgent))&&e.realFormData&&(e=e.realFormData),e.forEach(i=>{r+=typeof i=="string"?MR(i):i.size}),r+138}function Fdt(e){const r=new n_(Gi.TIMEOUT,"timeout");return new T_((i,d)=>{window.setTimeout(()=>d(r),e)})}function mS(e){return new T_(r=>{window.setTimeout(r,e)})}function AE(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,r=arguments.length>1?arguments[1]:void 0;const i=Math.random().toString(16).substr(2,e).toLowerCase();return i.length===e?"".concat(r).concat(i):"".concat(r).concat(i)+AE(e-i.length,"")}function pI(){return AE(32,"").toUpperCase()}const wL=()=>{},T4=new class{constructor(){G_(this,"fnMap",new Map)}throttleByKey(e,r,i,d){for(var h=arguments.length,f=new Array(h>4?h-4:0),g=4;g<h;g++)f[g-4]=arguments[g];if(this.fnMap.has(r)){const b=this.fnMap.get(r);if(b.threshold!==i){b.fn(...b.args),clearTimeout(b.timer);const C=window.setTimeout(()=>{const P=this.fnMap.get(r);P&&P.fn(...P.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:C,args:f,skipFn:d})}else b.skipFn&&b.skipFn(...b.args),this.fnMap.set(r,f_(f_({},b),{},{fn:e,args:f,skipFn:d}))}else{const b=window.setTimeout(()=>{const C=this.fnMap.get(r);C&&C.fn(...C.args),this.fnMap.delete(r)},i);this.fnMap.set(r,{fn:e,threshold:i,timer:b,args:f,skipFn:d})}}},R4=T4.throttleByKey.bind(T4);function I4(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}function $V(e,r){if(!I4(e)||!I4(r)||Array.isArray(e)&&!Array.isArray(r)||!Array.isArray(e)&&Array.isArray(r))return r;if(Array.isArray(r)&&Array.isArray(e)){const i=[...e];for(let d=0;d<r.length;d++)i[d]=$V(e[d],r[d]);return i}{const i=f_({},e);for(const d in r)Object.prototype.hasOwnProperty.call(r,d)&&(Object.prototype.hasOwnProperty.call(e,d)?i[d]=$V(e[d],r[d]):i[d]=r[d]);return i}}function w4(e,r){let i=[0];if(i=new Array(r).fill(0),e===0)return i;let d=0;for(;e>0&&(i[d]=255&e,e>>=8,d++,d!==r););return i}function EO(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function _j(e){return GT(e).call(e,(r,i)=>r+i,0)}function C4(e){const r="0123456789abcdef";function i(Js){let _l,_u="";for(_l=0;_l<=3;_l++)_u+=r.charAt(Js>>8*_l+4&15)+r.charAt(Js>>8*_l&15);return _u}function d(Js,_l){const _u=(65535&Js)+(65535&_l);return(Js>>16)+(_l>>16)+(_u>>16)<<16|65535&_u}function h(Js,_l,_u,ga,_m,r_){return d(function(a_,p_){return a_<<p_|a_>>>32-p_}(d(d(_l,Js),d(ga,r_)),_m),_u)}function f(Js,_l,_u,ga,_m,r_,a_){return h(_l&_u|~_l&ga,Js,_l,_m,r_,a_)}function g(Js,_l,_u,ga,_m,r_,a_){return h(_l&ga|_u&~ga,Js,_l,_m,r_,a_)}function b(Js,_l,_u,ga,_m,r_,a_){return h(_l^_u^ga,Js,_l,_m,r_,a_)}function C(Js,_l,_u,ga,_m,r_,a_){return h(_u^(_l|~ga),Js,_l,_m,r_,a_)}const P=function(Js){let _l;const _u=1+(Js.length+8>>6),ga=new Array(16*_u);for(_l=0;_l<16*_u;_l++)ga[_l]=0;for(_l=0;_l<Js.length;_l++)ga[_l>>2]|=Js.charCodeAt(_l)<<_l%4*8;return ga[_l>>2]|=128<<_l%4*8,ga[16*_u-2]=8*Js.length,ga}(e);let x,H,$,_t,_i,ue=1732584193,_r=-271733879,Fi=-1732584194,Di=271733878;for(x=0;x<P.length;x+=16)H=ue,$=_r,_t=Fi,_i=Di,ue=f(ue,_r,Fi,Di,P[x+0],7,-680876936),Di=f(Di,ue,_r,Fi,P[x+1],12,-389564586),Fi=f(Fi,Di,ue,_r,P[x+2],17,606105819),_r=f(_r,Fi,Di,ue,P[x+3],22,-1044525330),ue=f(ue,_r,Fi,Di,P[x+4],7,-176418897),Di=f(Di,ue,_r,Fi,P[x+5],12,1200080426),Fi=f(Fi,Di,ue,_r,P[x+6],17,-1473231341),_r=f(_r,Fi,Di,ue,P[x+7],22,-45705983),ue=f(ue,_r,Fi,Di,P[x+8],7,1770035416),Di=f(Di,ue,_r,Fi,P[x+9],12,-1958414417),Fi=f(Fi,Di,ue,_r,P[x+10],17,-42063),_r=f(_r,Fi,Di,ue,P[x+11],22,-1990404162),ue=f(ue,_r,Fi,Di,P[x+12],7,1804603682),Di=f(Di,ue,_r,Fi,P[x+13],12,-40341101),Fi=f(Fi,Di,ue,_r,P[x+14],17,-1502002290),_r=f(_r,Fi,Di,ue,P[x+15],22,1236535329),ue=g(ue,_r,Fi,Di,P[x+1],5,-165796510),Di=g(Di,ue,_r,Fi,P[x+6],9,-1069501632),Fi=g(Fi,Di,ue,_r,P[x+11],14,643717713),_r=g(_r,Fi,Di,ue,P[x+0],20,-373897302),ue=g(ue,_r,Fi,Di,P[x+5],5,-701558691),Di=g(Di,ue,_r,Fi,P[x+10],9,38016083),Fi=g(Fi,Di,ue,_r,P[x+15],14,-660478335),_r=g(_r,Fi,Di,ue,P[x+4],20,-405537848),ue=g(ue,_r,Fi,Di,P[x+9],5,568446438),Di=g(Di,ue,_r,Fi,P[x+14],9,-1019803690),Fi=g(Fi,Di,ue,_r,P[x+3],14,-187363961),_r=g(_r,Fi,Di,ue,P[x+8],20,1163531501),ue=g(ue,_r,Fi,Di,P[x+13],5,-1444681467),Di=g(Di,ue,_r,Fi,P[x+2],9,-51403784),Fi=g(Fi,Di,ue,_r,P[x+7],14,1735328473),_r=g(_r,Fi,Di,ue,P[x+12],20,-1926607734),ue=b(ue,_r,Fi,Di,P[x+5],4,-378558),Di=b(Di,ue,_r,Fi,P[x+8],11,-2022574463),Fi=b(Fi,Di,ue,_r,P[x+11],16,1839030562),_r=b(_r,Fi,Di,ue,P[x+14],23,-35309556),ue=b(ue,_r,Fi,Di,P[x+1],4,-1530992060),Di=b(Di,ue,_r,Fi,P[x+4],11,1272893353),Fi=b(Fi,Di,ue,_r,P[x+7],16,-155497632),_r=b(_r,Fi,Di,ue,P[x+10],23,-1094730640),ue=b(ue,_r,Fi,Di,P[x+13],4,681279174),Di=b(Di,ue,_r,Fi,P[x+0],11,-358537222),Fi=b(Fi,Di,ue,_r,P[x+3],16,-722521979),_r=b(_r,Fi,Di,ue,P[x+6],23,76029189),ue=b(ue,_r,Fi,Di,P[x+9],4,-640364487),Di=b(Di,ue,_r,Fi,P[x+12],11,-421815835),Fi=b(Fi,Di,ue,_r,P[x+15],16,530742520),_r=b(_r,Fi,Di,ue,P[x+2],23,-995338651),ue=C(ue,_r,Fi,Di,P[x+0],6,-198630844),Di=C(Di,ue,_r,Fi,P[x+7],10,1126891415),Fi=C(Fi,Di,ue,_r,P[x+14],15,-1416354905),_r=C(_r,Fi,Di,ue,P[x+5],21,-57434055),ue=C(ue,_r,Fi,Di,P[x+12],6,1700485571),Di=C(Di,ue,_r,Fi,P[x+3],10,-1894986606),Fi=C(Fi,Di,ue,_r,P[x+10],15,-1051523),_r=C(_r,Fi,Di,ue,P[x+1],21,-2054922799),ue=C(ue,_r,Fi,Di,P[x+8],6,1873313359),Di=C(Di,ue,_r,Fi,P[x+15],10,-30611744),Fi=C(Fi,Di,ue,_r,P[x+6],15,-1560198380),_r=C(_r,Fi,Di,ue,P[x+13],21,1309151649),ue=C(ue,_r,Fi,Di,P[x+4],6,-145523070),Di=C(Di,ue,_r,Fi,P[x+11],10,-1120210379),Fi=C(Fi,Di,ue,_r,P[x+2],15,718787259),_r=C(_r,Fi,Di,ue,P[x+9],21,-343485551),ue=d(ue,H),_r=d(_r,$),Fi=d(Fi,_t),Di=d(Di,_i);return i(ue)+i(_r)+i(Fi)+i(Di)}let Bdt=1,A4=console,wS=class{static setLogger(e){A4=e}constructor(e,r){G_(this,"id",void 0),G_(this,"lockingPromise",T_.resolve()),G_(this,"locks",0),G_(this,"name",""),G_(this,"lockId",void 0),this.lockId=Bdt++,e&&(this.name=e),r&&(this.id=r),this.logger("created")}logger(e,r){const i=(this.id?"[".concat(this.id,"]"):"")+"[lock-".concat(this.name,"-").concat(this.lockId,"]"),d=e==="created"?"is ".concat(e,"."):"is ".concat(e,", current queue ").concat(this.locks,". ").concat(r??"");A4.debug("".concat(i," ").concat(d))}setId(e){this.id=e}get isLocked(){return this.locks>0}lock(e){let r;this.locks+=1,this.logger("locked",e);const i=new T_(h=>{r=()=>{this.locks-=1,this.logger("unlocked",e),h()}}),d=this.lockingPromise.then(()=>r);return this.lockingPromise=this.lockingPromise.then(()=>i),d}};function gO(e,r){return function(i,d,h){const f=h.value;if(typeof f!="function")throw new Error("Cannot use mutex on object property.");return h.value=async function(){const g=this[r];if(!g)throw new Error("mutex property key ".concat(r," doesn't exist on ").concat(e));const b=await g.lock("From ".concat(e,".").concat(d));try{for(var C=arguments.length,P=new Array(C),x=0;x<C;x++)P[x]=arguments[x];return await f.apply(this,P)}finally{b()}},h}}const Mb={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function $j(e,r){const i=Math.floor(r.timeout*Math.pow(r.timeoutFactor,e));return Math.min(r.maxRetryTimeout,i)}function ER(e,r,i,d){const h=Object.assign({},Mb,d);let f=h.timeout;const g=async()=>{await function(P){return new T_(x=>{window.setTimeout(x,P)})}(f),f*=h.timeoutFactor,f=Math.min(h.maxRetryTimeout,f)};let b=!1;const C=new T_(async(P,x)=>{r=r||(()=>!1),i=i||(()=>!0);for(let H=0;H<h.maxRetryCount;H+=1){if(b)return x(new n_(Gi.OPERATION_ABORTED));try{const $=await e();if(!r($,H)||H+1===h.maxRetryCount)return P($);await g()}catch($){if(!i($,H)||H+1===h.maxRetryCount)return x($);await g()}}});return C.cancel=()=>b=!0,C}let CL,O4=class{constructor(e){G_(this,"input",[]),G_(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}mean(){var e;return this.input.length===0?0:GT(e=this.input).call(e,(r,i)=>r+i)/this.input.length}},AL=0,tF=0;function eF(e,r,i,d){return new T_((h,f)=>{r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),AL+=MR(r.data)):i&&(r.data.size?AL+=r.data.size:r.data instanceof FormData?AL+=S4(r.data):AL+=MR(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,zS.request(r).then(g=>{typeof g.data=="string"?tF+=MR(g.data):g.data instanceof ArrayBuffer||g.data instanceof Uint8Array?tF+=g.data.byteLength:tF+=MR(JSON.stringify(g.data)),h(g.data)}).catch(g=>{zS.isCancel(g)?f(new n_(Gi.OPERATION_ABORTED,"cancel token canceled")):g.code==="ECONNABORTED"?f(new n_(Gi.NETWORK_TIMEOUT,g.message)):g.response?f(new n_(Gi.NETWORK_RESPONSE_ERROR,g.response.status)):f(new n_(Gi.NETWORK_ERROR,g.message))})})}async function Gdt(e,r){const i=new Blob([r.data],{type:"buffer"});return await eF(e,f_(f_({},r),{},{data:i,headers:{"Content-Type":"application/octet-stream"}}),!0)}const N4=()=>window.isSecureContext!==void 0;function XT(e){if(Array.isArray(e))return e.map(i=>i);if(!P4(e))return e;const r={};for(const i in e){const d=e[i];P4(d)||Array.isArray(d)?r[i]=XT(d):r[i]=d}return r}function P4(e){return!(typeof e!="object"||Array.isArray(e)||!e)}let nF=class{constructor(e){G_(this,"input",[]),G_(this,"size",void 0),this.size=e}add(e){this.input.push(e),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}};const xR={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},BN={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:xR,remoteCandidate:xR},updateInterval:0},D4={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0,framesDroppedCount:0,outputFrameRate:0,packetsDiscarded:0,framesAssembledFromMultiplePackets:0,totalProcessingDelay:0,avgDecodeMs:0,avgFramesAssembledFromMultiplePacketsMs:0,avgProcessingDelayMs:0,avgInterFrameDelayMs:0,totalAssemblyTime:0},k4={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0,qpSumPerFrame:0},L4={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,jitterMs:0},M4={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packetsDiscarded:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0,totalSamplesReceived:0,silentConcealedSamples:0,concealmentEvents:0,freezeMs80:0,freezeMs200:0,freezeSamples80:0,freezeSamples200:0};let rF=class{constructor(e,r){G_(this,"onFirstVideoReceived",void 0),G_(this,"onFirstVideoDecoded",void 0),G_(this,"onFirstAudioReceived",void 0),G_(this,"onFirstVideoDecodedTimeout",void 0),G_(this,"onFirstAudioDecoded",void 0),G_(this,"onSelectedLocalCandidateChanged",void 0),G_(this,"onSelectedRemoteCandidateChanged",void 0),G_(this,"videoIsReady",!1),G_(this,"videoIsReady2",{}),G_(this,"pc",void 0),G_(this,"options",void 0),G_(this,"intervalTimer",void 0),G_(this,"stats",XT(BN)),G_(this,"isFirstVideoReceived",{}),G_(this,"isFirstVideoDecoded",{}),G_(this,"isFirstAudioReceived",{}),G_(this,"isFirstAudioDecoded",{}),G_(this,"isFirstVideoDecodedTimeout",{}),G_(this,"lossRateWindowStats",[]),this.pc=e,this.options=r,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new T_(e=>{e({local:f_({},xR),remote:f_({},xR)})})}setVideoIsReady(e){this.videoIsReady=e}setVideoIsReady2(e,r){this.videoIsReady2[e]=r}getVideoIsReady(e){return this.videoIsReady2[e]||!1}setIsFirstAudioDecoded(e){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(e){this.lossRateWindowStats.push(e),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const r=this.lossRateWindowStats.length,i=["videoSend","audioSend","videoRecv","audioRecv"];let d=0,h=0,f=0,g=0;for(const b of i)e[b].forEach((C,P)=>{if(!this.lossRateWindowStats[r-1][b][P]||!this.lossRateWindowStats[0][b][P])return;const x=this.lossRateWindowStats[r-1][b][P].packets-this.lossRateWindowStats[0][b][P].packets,H=this.lossRateWindowStats[r-1][b][P].packetsLost-this.lossRateWindowStats[0][b][P].packetsLost;b==="videoSend"||b==="audioSend"?(d+=x,f+=H):(h+=x,g+=H),Number.isNaN(x)||Number.isNaN(x)?C.packetLostRate=0:C.packetLostRate=x<=0||H<=0?0:H/(x+H)});e.sendPacketLossRate=d<=0||f<=0?0:f/(d+f),e.recvPacketLossRate=h<=0||g<=0?0:g/(h+g)}},qdt=class extends rF{constructor(){super(...arguments),G_(this,"_stats",BN),G_(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const e=await this._getStats(),r=this.statsResponsesToObjects(e);this._stats=XT(BN);const i=r.filter(h=>h.type==="ssrc");this.processSSRCStats(i);const d=r.find(h=>h.type==="VideoBwe");d&&this.processBandwidthStats(d),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(e){this._stats.bitrate={actualEncoded:Number(e.googActualEncBitrate),targetEncoded:Number(e.googTargetEncBitrate),retransmit:Number(e.googRetransmitBitrate),transmit:Number(e.googTransmitBitrate)},this._stats.sendBandwidth=Number(e.googAvailableSendBandwidth)}processSSRCStats(e){e.forEach(r=>{var i;const d=E_(i=r.id).call(i,"send");switch("".concat(r.mediaType,"_").concat(d?"send":"recv")){case"video_send":{const h=XT(k4);h.codec=r.googCodecName,h.adaptionChangeReason="none",r.googCpuLimitedResolution&&(h.adaptionChangeReason="cpu"),r.googBandwidthLimitedResolution&&(h.adaptionChangeReason="bandwidth"),h.avgEncodeMs=Number(r.googAvgEncodeMs),h.inputFrame={width:Number(r.googFrameWidthInput)||Number(r.googFrameWidthSent),height:Number(r.googFrameHeightInput)||Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},h.sentFrame={width:Number(r.googFrameWidthSent),height:Number(r.googFrameHeightSent),frameRate:Number(r.googFrameRateInput)},h.firsCount=Number(r.googFirReceived),h.nacksCount=Number(r.googNacksReceived),h.plisCount=Number(r.googPlisReceived),h.frameCount=Number(r.framesEncoded),h.bytes=Number(r.bytesSent),h.packets=Number(r.packetsSent),h.packetsLost=Number(r.packetsLost),h.ssrc=Number(r.ssrc),h.rttMs=Number(r.googRtt||0),this._stats.videoSend.push(h),this._stats.rtt=h.rttMs;break}case"video_recv":{const h=XT(D4),f=this.lastDecodeVideoReceiverStats.get(Number(r.ssrc));if(h.codec=r.googCodecName,h.targetDelayMs=Number(r.googTargetDelayMs),h.renderDelayMs=Number(r.googRenderDelayMs),h.currentDelayMs=Number(r.googCurrentDelayMs),h.minPlayoutDelayMs=Number(r.googMinPlayoutDelayMs),h.decodeMs=Number(r.googDecodeMs),h.maxDecodeMs=Number(r.googMaxDecodeMs),h.receivedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateReceived)},h.decodedFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateDecoded)},h.decodeFrameRate=Number(r.googFrameRateDecoded),h.outputFrame={width:Number(r.googFrameWidthReceived),height:Number(r.googFrameHeightReceived),frameRate:Number(r.googFrameRateOutput)},h.jitterBufferMs=Number(r.googJitterBufferMs),h.firsCount=Number(r.googFirsSent),h.nacksCount=Number(r.googNacksSent),h.plisCount=Number(r.googPlisSent),h.framesDecodeCount=Number(r.framesDecoded),h.bytes=Number(r.bytesReceived),h.packets=Number(r.packetsReceived),h.packetsLost=Number(r.packetsLost),h.ssrc=Number(r.ssrc),h.packets>0&&!this.isFirstVideoReceived[h.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(h.ssrc),this.isFirstVideoReceived[h.ssrc]=!0),h.framesDecodeCount>0&&!this.isFirstVideoDecoded[h.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(h.ssrc,h.decodedFrame.width,h.decodedFrame.height),this.isFirstVideoDecoded[h.ssrc]=!0),f){const g=f.stats,b=Date.now()-f.lts;h.framesDecodeFreezeTime=g.framesDecodeFreezeTime,h.framesDecodeInterval=g.framesDecodeInterval,h.framesDecodeCount>g.framesDecodeCount&&this.isFirstVideoDecoded[h.ssrc]?(f.lts=Date.now(),h.framesDecodeInterval=b,h.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(r.ssrc,10))?h.framesDecodeFreezeTime+=h.framesDecodeInterval:this.setVideoIsReady2(parseInt(r.ssrc,10),!0))):h.framesDecodeCount<f.stats.framesDecodeCount&&(h.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(h.ssrc,{stats:f_({},h),lts:Date.now()}),this._stats.videoRecv.push(h);break}case"audio_recv":{const h=XT(M4);h.codec=r.googCodecName,h.outputLevel=Math.abs(Number(r.audioOutputLevel))/32767,h.decodingCNG=Number(r.googDecodingCNG),h.decodingCTN=Number(r.googDecodingCTN),h.decodingCTSG=Number(r.googDecodingCTSG),h.decodingNormal=Number(r.googDecodingNormal),h.decodingPLC=Number(r.googDecodingPLC),h.decodingPLCCNG=Number(r.googDecodingPLCCNG),h.expandRate=Number(r.googExpandRate),h.accelerateRate=Number(r.googAccelerateRate),h.preemptiveExpandRate=Number(r.googPreemptiveExpandRate),h.secondaryDecodedRate=Number(r.googSecondaryDecodedRate),h.speechExpandRate=Number(r.googSpeechExpandRate),h.preferredJitterBufferMs=Number(r.googPreferredJitterBufferMs),h.jitterBufferMs=Number(r.googJitterBufferMs),h.jitterMs=Number(r.googJitterReceived),h.bytes=Number(r.bytesReceived),h.packets=Number(r.packetsReceived),h.packetsLost=Number(r.packetsLost),h.ssrc=Number(r.ssrc),h.receivedFrames=Number(r.googDecodingCTN)||Number(r.packetsReceived),h.droppedFrames=Number(r.googDecodingPLC)+Number(r.googDecodingPLCCNG)||Number(r.packetsLost),h.receivedFrames>0&&!this.isFirstAudioReceived[h.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(h.ssrc),this.isFirstAudioReceived[h.ssrc]=!0),h.decodingNormal>0&&!this.isFirstAudioDecoded[h.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(h.ssrc),this.isFirstAudioDecoded[h.ssrc]=!0),this._stats.audioRecv.push(h);break}case"audio_send":{const h=XT(L4);h.codec=r.googCodecName,h.inputLevel=Math.abs(Number(r.audioInputLevel))/32767,h.aecReturnLoss=Number(r.googEchoCancellationReturnLoss||0),h.aecReturnLossEnhancement=Number(r.googEchoCancellationReturnLossEnhancement||0),h.residualEchoLikelihood=Number(r.googResidualEchoLikelihood||0),h.residualEchoLikelihoodRecentMax=Number(r.googResidualEchoLikelihoodRecentMax||0),h.bytes=Number(r.bytesSent),h.packets=Number(r.packetsSent),h.packetsLost=Number(r.packetsLost),h.ssrc=Number(r.ssrc),h.rttMs=Number(r.googRtt||0),this._stats.rtt=h.rttMs,this._stats.audioSend.push(h);break}}})}_getStats(){return new T_((e,r)=>{this.pc.getStats(e,r)})}statsResponsesToObjects(e){const r=[];return e.result().forEach(i=>{const d={id:i.id,timestamp:i.timestamp.valueOf().toString(),type:i.type};i.names().forEach(h=>{d[h]=i.stat(h)}),r.push(d)}),r}},GN=function(e){return e.BANDWIDTH="bandwidth",e.CPU="cpu",e.NONE="none",e.OTHER="other",e}({}),OL=function(e){return e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L1T3_KEY="L1T3_KEY",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY",e}({}),iF=function(e){return e[e.new=0]="new",e[e.connecting=1]="connecting",e[e.connected=2]="connected",e[e.disconnected=3]="disconnected",e[e.failed=4]="failed",e[e.closed=5]="closed",e}({}),_T=function(e){return e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver",e}({});var vO=function(e){return e[e.kNone=1]="kNone",e[e.kMillisecondsFromSeconds=1e3]="kMillisecondsFromSeconds",e[e.kBytesToBits=8]="kBytesToBits",e}(vO||{});function qN(e,r,i,d){let h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:vO.kNone;if(!r)return;const f=Number(r[i]);if(typeof f!="number")return;const g=Number(r[d]);if(typeof g!="number")return;if(!e)return g?f/g*h:void 0;const b=Number(e[i]);if(typeof b!="number")return;const C=Number(e[d]);if(typeof C!="number")return;const P=g-C;return P?(f-b)/P*h:void 0}let x4=class extends rF{constructor(){super(...arguments),G_(this,"_stats",BN),G_(this,"report",void 0),G_(this,"lastDecodeVideoReceiverStats",new Map),G_(this,"lastVideoFramesRecv",new Map),G_(this,"lastVideoFramesSent",new Map),G_(this,"lastVideoFramesDecode",new Map),G_(this,"lastVideoFramesOutput",new Map),G_(this,"lastVideoJBDelay",new Map),G_(this,"lastAudioJBDelay",new Map),G_(this,"mediaBytesSent",new Map),G_(this,"mediaBytesRetransmit",new Map),G_(this,"mediaBytesTargetEncode",new Map),G_(this,"lastDecodeAudioReceiverStats",new Map),G_(this,"lastAudioConcealment",new Map),G_(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=XT(BN),this.report.forEach(e=>{switch(e.type){case _T.OUTBOUND:case _T.INBOUND:{const r=e.mediaType||e.kind,i=!r&&"frameWidth"in e,d=!r&&!("frameWidth"in e);e.type===_T.OUTBOUND?r==="audio"||d?this.processAudioOutboundStats(e):(r==="video"||i)&&this.processVideoOutboundStats(e):e.type===_T.INBOUND&&(r==="audio"||d?this.processAudioInboundStats(e):(r==="video"||i)&&this.processVideoInboundStats(e));break}case _T.TRANSPORT:{const r=this.report.get(e.selectedCandidatePairId);r&&this.processCandidatePairStats(r);break}case _T.CANDIDATE_PAIR:e.selected&&this.processCandidatePairStats(e)}}),this.updateSendBitrate(),this._stats.updateInterval=Date.now()-this.stats.timestamp,this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const e=await this.pc.getStats(),r={local:f_({},xR),remote:f_({},xR)};return e.forEach(i=>{let d;if(i.type===_T.TRANSPORT&&(d=e.get(i.selectedCandidatePairId)),i.type===_T.CANDIDATE_PAIR&&i.selected&&(d=i),d){const h=(f,g)=>{f.type=g.type,f.id=g.id,g.address&&(f.address=g.address),g.candidateType&&(f.candidateType=g.candidateType),g.port&&(f.port=g.port),g.priority&&(f.priority=g.priority),g.protocol&&(f.protocol=g.protocol),g.relayProtocol&&(f.relayProtocol=g.relayProtocol)};if(d.localCandidateId){const f=e.get(d.localCandidateId);f&&h(r.local,f)}if(d.remoteCandidateId){const f=e.get(d.remoteCandidateId);f&&h(r.remote,f)}}}),r}processCandidatePairStats(e){if(this._stats.sendBandwidth=e.availableOutgoingBitrate||0,e.currentRoundTripTime&&(this._stats.rtt=1e3*e.currentRoundTripTime),this._stats.videoSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.audioSend.forEach(r=>{e.currentRoundTripTime&&(r.rttMs=1e3*e.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=e.id,e.localCandidateId){const r=this.report.get(e.localCandidateId);r&&this.processCandidateStats(r)}if(e.remoteCandidateId){const r=this.report.get(e.remoteCandidateId);r&&this.processCandidateStats(r)}}processCandidateStats(e){let r;e.type===_T.LOCAL_CANDIDATE&&(r=this._stats.selectedCandidatePair.localCandidate),e.type===_T.REMOTE_CANDIDATE&&(r=this._stats.selectedCandidatePair.remoteCandidate),r&&(r.type=e.type,r.id=e.id,e.address&&(r.address=e.address),e.candidateType&&(r.candidateType=e.candidateType),e.port&&(r.port=e.port),e.priority&&(r.priority=e.priority),e.protocol&&(r.protocol=e.protocol),e.relayProtocol&&(r.relayProtocol=e.relayProtocol),e.type===_T.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==r.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged(f_({},r),f_({},this.stats.selectedCandidatePair.localCandidate)),e.type===_T.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==r.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged(f_({},r),f_({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(e){let r=this._stats.audioRecv.find(d=>d.ssrc===e.ssrc);r||(r=XT(M4),this._stats.audioRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.packetsDiscarded=e.packetsDiscarded,r.bytes=e.bytesReceived,r.jitterMs=1e3*e.jitter,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived,r.totalProcessingDelay=e.totalProcessingDelay,r.jitterBufferEmittedCount=e.jitterBufferEmittedCount;const i=this.lastDecodeAudioReceiverStats.get(r.ssrc);r.avgProcessingDelayMs=qN(i,r,"totalProcessingDelay","jitterBufferEmittedCount",vO.kMillisecondsFromSeconds),this.processAudioTrackReceiverStats(e,e.trackId,r),this.calculateAudioFreeze(r,i,e),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),r.receivedFrames||(r.receivedFrames=e.packetsReceived),r.droppedFrames||(r.droppedFrames=e.packetsLost),r.receivedFrames>0&&!this.isFirstAudioReceived[r.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(r.ssrc),this.isFirstAudioReceived[r.ssrc]=!0),r.outputLevel&&r.outputLevel>0&&!this.isFirstAudioDecoded[r.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(r.ssrc),this.isFirstAudioDecoded[r.ssrc]=!0),typeof e.concealedSamples=="number"&&(r.concealedSamples=e.concealedSamples),this.lastDecodeAudioReceiverStats.set(r.ssrc,f_({},r))}calculateAudioFreeze(e,r,i){const d=this.lastAudioConcealment.get(e.ssrc);if(r!=null&&d!=null){const h=d.lts,f=i.timestamp,g=f-h;if(g<=0)return;const b=e.concealedSamples-r.concealedSamples-0,C=d.nonSilent+b,P=e.totalSamplesReceived-r.totalSamplesReceived;if(P<=0)return;const x=80*P/g,H=200*P/g,$=g/P;let _t=0;e.freezeSamples80=r.freezeSamples80,e.freezeMs80=r.freezeMs80,C>x&&(d.plc80>0?(e.freezeSamples80+=b,e.freezeMs80+=Math.round(b*$)):(e.freezeSamples80+=C,e.freezeMs80+=Math.round(C*$)),_t=d.plc80+1);let _i=0;e.freezeSamples200=r.freezeSamples200,e.freezeMs200=r.freezeMs200,C>H&&(d.plc200>0?(e.freezeSamples200+=b,e.freezeMs200+=Math.round(b*$)):(e.freezeSamples200+=C,e.freezeMs200+=Math.round(C*$)),_i=d.plc200+1),this.lastAudioConcealment.set(e.ssrc,{nonSilent:b,lts:f,plc80:_t,plc200:_i})}else e.freezeSamples80=0,e.freezeSamples200=0,e.freezeMs80=0,e.freezeMs200=0,this.lastAudioConcealment.set(e.ssrc,{nonSilent:0,lts:i.timestamp,plc80:0,plc200:0})}processVideoInboundStats(e){let r=this._stats.videoRecv.find(g=>g.ssrc===e.ssrc);r||(r=XT(D4),this._stats.videoRecv.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsReceived,r.packetsLost=e.packetsLost,r.bytes=e.bytesReceived,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.framesDecodeCount=e.framesDecoded,r.framesDroppedCount=e.framesDropped,r.totalInterFrameDelay=e.totalInterFrameDelay,r.totalSquaredInterFrameDelay=e.totalSquaredInterFrameDelay,r.totalFreezesDuration=e.totalFreezesDuration,r.totalProcessingDelay=e.totalProcessingDelay,r.packetsDiscarded=e.packetsDiscarded,r.framesAssembledFromMultiplePackets=e.framesAssembledFromMultiplePackets,r.totalAssemblyTime=e.totalAssemblyTime,r.keyFramesDecoded=e.keyFramesDecoded,r.retransmittedBytesReceived=e.retransmittedBytesReceived,r.retransmittedPacketsReceived=e.retransmittedPacketsReceived;const i=this.lastDecodeVideoReceiverStats.get(r.ssrc),d=this.lastVideoFramesDecode.get(r.ssrc),h=this.lastVideoFramesOutput.get(r.ssrc),f=Date.now();if(r.framesDecodeCount>0&&!this.isFirstVideoDecoded[r.ssrc]){const g=r.decodedFrame?r.decodedFrame.width:0,b=r.decodedFrame?r.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(r.ssrc,g,b),this.isFirstVideoDecoded[r.ssrc]=!0}if(i){const g=i.stats,b=f-i.lts;r.framesDecodeFreezeTime=g.framesDecodeFreezeTime,r.framesDecodeInterval=g.framesDecodeInterval,!this.isFirstVideoDecoded[r.ssrc]&&b>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[r.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(r.ssrc),this.isFirstVideoDecodedTimeout[r.ssrc]=!0),r.framesDecodeCount>g.framesDecodeCount&&this.isFirstVideoDecoded[r.ssrc]?(i.lts=Date.now(),r.framesDecodeInterval=b,r.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(e.ssrc))?r.framesDecodeFreezeTime+=r.framesDecodeInterval:this.setVideoIsReady2(parseInt(e.ssrc,10),!0))):r.framesDecodeCount<g.framesDecodeCount&&(r.framesDecodeInterval=0),e.framesDecoded&&e.qpSum&&(i.stats.framesDecodeCount>e.framesDecoded?r.qpSumPerFrame=e.qpSum/e.framesDecoded:r.qpSumPerFrame=(e.qpSum-i.qpSum)/(e.framesDecoded-i.stats.framesDecodeCount))}e.totalDecodeTime&&(r.decodeMs=1e3*e.totalDecodeTime,r.avgDecodeMs=qN(i==null?void 0:i.stats,r,"decodeMs","framesDecodeCount")),r.avgProcessingDelayMs=qN(i==null?void 0:i.stats,r,"totalProcessingDelay","framesDecodeCount",vO.kMillisecondsFromSeconds),r.avgFramesAssembledFromMultiplePacketsMs=qN(i==null?void 0:i.stats,r,"totalAssemblyTime","framesAssembledFromMultiplePackets",vO.kMillisecondsFromSeconds),r.avgInterFrameDelayMs=qN(i==null?void 0:i.stats,r,"totalInterFrameDelay","framesDecodeCount",vO.kMillisecondsFromSeconds),d&&f-d.lts>=800?(r.decodeFrameRate=Math.round((r.framesDecodeCount-d.count)/((f-d.lts)/1e3)),this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:f,rate:r.decodeFrameRate})):d?r.decodeFrameRate=d.rate:this.lastVideoFramesDecode.set(r.ssrc,{count:r.framesDecodeCount,lts:f,rate:0}),r.framesDroppedCount&&e.framesReceived&&(h&&f-h.lts>=800?(r.outputFrameRate=Math.round((e.framesReceived-r.framesDroppedCount-h.count)/((f-h.lts)/1e3)),this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:f,rate:Math.max(r.outputFrameRate,0)})):h?r.outputFrameRate=h.rate:this.lastVideoFramesOutput.set(r.ssrc,{count:e.framesReceived-r.framesDroppedCount,lts:f,rate:0})),this.processVideoTrackReceiverStats(e,e.trackId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.framerateMean&&(r.framesRateFirefox=e.framerateMean),r.packets>0&&!this.isFirstVideoReceived[r.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(r.ssrc),this.isFirstVideoReceived[r.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(r.ssrc,{stats:f_({},r),lts:i?i.lts:Date.now(),qpSum:e.qpSum})}processVideoOutboundStats(e){let r=this._stats.videoSend.find(d=>d.ssrc===e.ssrc);r||(r=XT(k4),this._stats.videoSend.push(r));const i=this.mediaBytesSent.get(e.ssrc);if(i)i.add(e.bytesSent);else{const d=new nF(10);d.add(e.bytesSent),this.mediaBytesSent.set(e.ssrc,d)}if(e.retransmittedBytesSent!==void 0){const d=this.mediaBytesRetransmit.get(e.ssrc);if(d)d.add(e.retransmittedBytesSent);else{const h=new nF(10);h.add(e.retransmittedBytesSent),this.mediaBytesRetransmit.set(e.ssrc,h)}}if(e.totalEncodedBytesTarget){const d=this.mediaBytesTargetEncode.get(e.ssrc);if(d)d.add(e.totalEncodedBytesTarget);else{const h=new nF(10);h.add(e.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(e.ssrc,h)}}if(r.ssrc=e.ssrc,r.bytes=e.bytesSent,r.packets=e.packetsSent,r.firsCount=e.firCount,r.nacksCount=e.nackCount,r.plisCount=e.pliCount,r.frameCount=e.framesEncoded,r.adaptionChangeReason=e.qualityLimitationReason,r.scalabilityMode=e.scalabilityMode,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,r.hugeFramesSent=e.hugeFramesSent,r.keyFramesEncoded=e.keyFramesEncoded,r.targetBitrate=e.targetBitrate,e.totalEncodeTime&&e.framesEncoded){const d=this.lastEncoderMs.get(e.ssrc);if(!d||d.lastFrameCount>e.framesEncoded)r.avgEncodeMs=1e3*e.totalEncodeTime/e.framesEncoded;else{const h=e.framesEncoded-d.lastFrameCount,f=e.totalEncodeTime-d.lastEncoderTime;r.avgEncodeMs=1e3*f/h}}if(e.framesEncoded&&e.qpSum){const d=this.lastEncoderMs.get(e.ssrc);!d||d.lastFrameCount>e.framesEncoded?r.qpSumPerFrame=e.qpSum/e.framesEncoded:r.qpSumPerFrame=(e.qpSum-d.lastQpSum)/(e.framesEncoded-d.lastFrameCount)}if(this.lastEncoderMs.set(e.ssrc,{lastFrameCount:e.framesEncoded,lastEncoderTime:e.totalEncodeTime,lastQpSum:e.qpSum,lts:Date.now()}),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),e.mediaSourceId&&this.processVideoMediaSource(e.mediaSourceId,r),this.processVideoTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const d=this.findRemoteStatsId(e.ssrc,_T.REMOTE_INBOUND);d&&this.processRemoteInboundStats(d,r)}}processAudioOutboundStats(e){let r=this._stats.audioSend.find(i=>i.ssrc===e.ssrc);if(r||(r=XT(L4),this._stats.audioSend.push(r)),r.ssrc=e.ssrc,r.packets=e.packetsSent,r.bytes=e.bytesSent,r.retransmittedBytesSent=e.retransmittedBytesSent,r.retransmittedPacketsSent=e.retransmittedPacketsSent,e.mediaSourceId&&this.processAudioMediaSource(e.mediaSourceId,r),e.codecId&&(r.codec=this.getCodecFromCodecStats(e.codecId)),this.processAudioTrackSenderStats(e,e.trackId,r),e.remoteId)this.processRemoteInboundStats(e.remoteId,r);else{const i=this.findRemoteStatsId(e.ssrc,_T.REMOTE_INBOUND);i&&this.processRemoteInboundStats(i,r)}}findRemoteStatsId(e,r){var i;const d=Array.from(sT(i=this.report).call(i)).find(h=>h.type===r&&h.ssrc===e);return d?d.id:null}processVideoMediaSource(e,r){const i=this.report.get(e);i&&i.width&&i.height&&i.framesPerSecond&&(r.inputFrame={width:i.width,height:i.height,frameRate:i.framesPerSecond})}processAudioMediaSource(e,r){const i=this.report.get(e);i&&(r.inputLevel=i.audioLevel)}processVideoTrackSenderStats(e,r,i){var d,h,f,g;const b=r?this.report.get(r):void 0,C=(d=b==null?void 0:b.framesSent)!==null&&d!==void 0?d:e.framesSent;if(typeof C!="number")return;let P=(h=b==null?void 0:b.frameWidth)!==null&&h!==void 0?h:e.frameWidth,x=(f=b==null?void 0:b.frameHeight)!==null&&f!==void 0?f:e.frameHeight,H=(g=b==null?void 0:b.framesPerSecond)!==null&&g!==void 0?g:e.framesPerSecond;if(typeof P=="number"&&typeof x=="number"||(P=0,x=0),H==null){const $=Date.now(),_t=this.lastVideoFramesSent.get(i.ssrc);_t&&$-_t.lts>=800?(H=Math.round((C-_t.count)/(($-_t.lts)/1e3)),this.lastVideoFramesSent.set(i.ssrc,{count:C,lts:$,rate:H})):_t?H=_t.rate:this.lastVideoFramesSent.set(i.ssrc,{count:C,lts:$,rate:0})}i.sentFrame={width:P,height:x,frameRate:Math.max(0,H)}}processVideoTrackReceiverStats(e,r,i){var d,h,f,g,b;const C=r?this.report.get(r):void 0,P=(d=C==null?void 0:C.framesReceived)!==null&&d!==void 0?d:e.framesReceived,x=(h=C==null?void 0:C.frameWidth)!==null&&h!==void 0?h:e.frameWidth,H=(f=C==null?void 0:C.frameHeight)!==null&&f!==void 0?f:e.frameHeight,$=(g=C==null?void 0:C.jitterBufferDelay)!==null&&g!==void 0?g:e.jitterBufferDelay,_t=(b=C==null?void 0:C.jitterBufferEmittedCount)!==null&&b!==void 0?b:e.jitterBufferEmittedCount;if(typeof P=="number"){const _i=this.lastVideoFramesRecv.get(i.ssrc),ue=Date.now();i.framesReceivedCount=P;let _r=0;_i&&ue-_i.lts>=800?(_r=Math.round((P-_i.count)/((ue-_i.lts)/1e3)),this.lastVideoFramesRecv.set(i.ssrc,{count:P,lts:ue,rate:_r})):_i?_r=_i.rate:this.lastVideoFramesRecv.set(i.ssrc,{count:P,lts:ue,rate:0}),i.receivedFrame={width:x||0,height:H||0,frameRate:_r||0},i.decodedFrame={width:x||0,height:H||0,frameRate:i.decodeFrameRate||0},i.outputFrame={width:x||0,height:H||0,frameRate:i.outputFrameRate||i.decodeFrameRate||0}}if($&&_t){const _i=this.lastVideoJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let ue=_i.jitterBufferMs;const _r=_t-_i.jitterBufferEmittedCount;_r>0&&(ue=1e3*($-_i.jitterBufferDelay)/_r),i.jitterBufferMs=ue,i.currentDelayMs=Math.round(ue),this.lastVideoJBDelay.set(i.ssrc,{jitterBufferDelay:$,jitterBufferEmittedCount:_t,jitterBufferMs:i.currentDelayMs})}}processAudioTrackSenderStats(e,r,i){var d,h,f,g;const b=r?this.report.get(r):void 0,C=(d=(h=b==null?void 0:b.echoReturnLoss)!==null&&h!==void 0?h:e.echoReturnLoss)!==null&&d!==void 0?d:0,P=(f=(g=b==null?void 0:b.echoReturnLossEnhancement)!==null&&g!==void 0?g:e.echoReturnLossEnhancement)!==null&&f!==void 0?f:0;i.aecReturnLoss=C,i.aecReturnLossEnhancement=P}processAudioTrackReceiverStats(e,r,i){var d,h,f,g,b,C,P,x,H;const $=r?this.report.get(r):void 0,_t=(d=$==null?void 0:$.removedSamplesForAcceleration)!==null&&d!==void 0?d:e.removedSamplesForAcceleration,_i=(h=$==null?void 0:$.totalSamplesReceived)!==null&&h!==void 0?h:e.totalSamplesReceived,ue=(f=$==null?void 0:$.jitterBufferDelay)!==null&&f!==void 0?f:e.jitterBufferDelay,_r=(g=$==null?void 0:$.jitterBufferEmittedCount)!==null&&g!==void 0?g:e.jitterBufferEmittedCount,Fi=(b=$==null?void 0:$.audioLevel)!==null&&b!==void 0?b:e==null?void 0:e.audioLevel,Di=(C=$==null?void 0:$.totalSamplesDuration)!==null&&C!==void 0?C:e==null?void 0:e.totalSamplesDuration,Js=(P=$==null?void 0:$.concealedSamples)!==null&&P!==void 0?P:e.concealedSamples,_l=(x=$==null?void 0:$.silentConcealedSamples)!==null&&x!==void 0?x:e.silentConcealedSamples,_u=(H=$==null?void 0:$.concealmentEvents)!==null&&H!==void 0?H:e.concealmentEvents;if(typeof _i=="number"&&(i.totalSamplesReceived=_i),typeof _l=="number"&&(i.silentConcealedSamples=_l),typeof _u=="number"&&(i.concealmentEvents=_u),typeof Js=="number"&&(i.concealedSamples=Js),_t&&_i&&(i.accelerateRate=_t/_i),ue&&_r){const _m=this.lastAudioJBDelay.get(i.ssrc)||{jitterBufferDelay:0,jitterBufferEmittedCount:0,jitterBufferMs:0};let r_=_m.jitterBufferMs;const a_=_r-_m.jitterBufferEmittedCount;a_>0&&(r_=1e3*(ue-_m.jitterBufferDelay)/a_),i.jitterBufferMs=Math.round(r_),this.lastAudioJBDelay.set(i.ssrc,{jitterBufferDelay:ue,jitterBufferEmittedCount:_r,jitterBufferMs:i.jitterBufferMs})}i.outputLevel=Fi;let ga=1920;Di&&_i&&(ga=_i/Di/50,i.receivedFrames=Math.round(_i/ga)),Js&&(i.droppedFrames=Math.round(Js/ga))}processRemoteInboundStats(e,r){const i=this.report.get(e);i&&(r.packetsLost=i.packetsLost,i.roundTripTime&&(r.rttMs=1e3*i.roundTripTime),i.jitter&&(r.jitterMs=1e3*i.jitter),i.timestamp&&(r.timestamp=i.timestamp))}getCodecFromCodecStats(e){const r=this.report.get(e);if(!r)return"";const i=r.mimeType.match(/\/(.*)$/);return i&&i[1]?i[1]:""}updateSendBitrate(){let e=0,r=null,i=null;this.mediaBytesSent.forEach(h=>{e+=h.diffMean()}),this.mediaBytesRetransmit.forEach(h=>{r=r===null?h.diffMean():r+h.diffMean()}),this.mediaBytesTargetEncode.forEach(h=>{i=i===null?h.diffMean():i+h.diffMean()});const d=r!==null?e-r:e;this._stats.bitrate={actualEncoded:8*d/(this.options.updateInterval/1e3),transmit:8*e/(this.options.updateInterval/1e3)},r!==null&&(this._stats.bitrate.retransmit=8*r/(this.options.updateInterval/1e3)),i!==null&&(this._stats.bitrate.targetEncoded=8*i/(this.options.updateInterval/1e3))}},Wdt=class extends rF{updateStats(){return T_.resolve()}};function oF(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,h=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const f=function(){const g=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return g&&g[0]?Number(g[0].split("/")[1]):null}();return f?f<76?new qdt(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:d,firstVideoDecodedTimeout:h}):new x4(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:d,firstVideoDecodedTimeout:h}):function(g){if(!window.RTCStatsReport)return!1;const b=g.getStats();return!!(b instanceof T_||function(C){return!!C&&(typeof C=="object"||typeof C=="function")&&typeof C.then=="function"}(b))}(e)?new x4(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:d,firstVideoDecodedTimeout:h}):new Wdt(e,{updateInterval:r,lossRateInterval:i,freezeRateLimit:d,firstVideoDecodedTimeout:h})}const U4="websdk_ng_install_id";function sF(){try{if(_s("INSTALL_ID"))return _s("INSTALL_ID");let e=window.localStorage.getItem(U4);return e||(e=pI(),window.localStorage.setItem(U4,e)),SE("INSTALL_ID",e),e}catch{return}}const AT=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const r=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-([0-9]+)/);if(r&&r[1]&&r[2]){const i=r[1],d=r[2];return"".concat(i,".").concat(d)}return"4.0.0.999"}("4.24.0"),aF=function(){try{return JSON.parse("true")===!0}catch{return!0}}();let fI=function(e){return e.Default="default",e.Auto="auto",e.Relay="relay",e.SdRtn="sd-rtn",e}({});const RS=function(){const e="us".concat("erna","me"),r="pa".concat("sswo","rd"),i=["t","s","t"];i.splice(1,0,"e");const d=i.join(""),h=[];for(let b=0;b<6;b++)h.push("1");const f=h.join(""),g={};return g[e]=d,g[r]=f,Object.assign(g,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=RS;const NL={ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,ENABLE_USER_LICENSE_CHECK:!0,DISABLE_FEC:void 0,ENABLE_NTP_REPORT:!1,ENABLE_INSTANT_VIDEO:!1,ENABLE_USER_AUTO_REBALANCE_CHECK:!0,ENABLE_LOSSBASED_BWE:!0,ENABLE_AUT_CC:!0,FORCE_ENABLE_AUT_CC:!1,ENABLE_CC_FALLBACK:void 0,SUBSCRIBE_TWCC:!0,PUBLISH_TWCC:!1,ENABLE_SVC_DEFAULT_CODECS:["H264","VP8","VP9","AV1"],SVC:[],ENABLE_FULL_LINK_AV_SYNC:!1,SVC_MODE:null,PRE_SUB_NUM:1,ENABLE_AUT_FEEDBACK:!0,SVC_EXTENDED:["VP9"]},cF={MIN_FRAME_RATE:1,MAX_FRAME_RATE:30,MAX_THRESHOLD_FRAMERATE:30,BITRATE_MIN_THRESHOLD:100,BITRATE_MAX_THRESHOLD:100,MAX_SCALE:5,BWE_SCALE_UP_THRESHOLD:.6,BWE_SCALE_DOWN_THRESHOLD:.6,PERF_SCALE_UP_THRESHOLD:.7,PERF_SCALE_DOWN_THRESHOLD:.6,MOTION_RESOLUTION_FACTOR:.8,MOTION_BITRATE_FACTOR:.6,DETAIL_FRAMERATE_FACTOR:.8,DETAIL_BITRATE_FACTOR:.6,BALANCE_RESOLUTION_FACTOR:.9,BALANCE_FRAMERATE_FACTOR:.9,BALANCE_BITRATE_FACTOR:.6,OVERUSE_TIMES_THRESHOLD:10,UNDERUSE_TIMES_THRESHOLD:40},uF="v4.24.0-0-gf2267710-dirty(7/31/2025, 7:00:42 PM)",dF={ENABLE_EVENT_REPORT:!0,UPLOAD_LOG:!1,ENABLE_AG_ADAPTATION:!0,FORCE_AG_HIGH_FRAMERATE:!1,FORCE_SUPPORT_AG_ADAPTATION:!1,ENCODER_CONFIG_LIMIT:{},CAMERA_CAPTURE_CONFIG:void 0,ENABLE_PRELOAD:!0,NEW_ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,RESTART_SEQUENCE:["udp_tcp_relay","relay"],FIRST_TCP_CANDIDATE:!1,FIRST_TCP_CANDIDATE_INTERVAL:1e3,TURN_DOMAIN:"edge.agora.io",USE_TURN_IP:!0,NEW_TURN_MODE:4,NEW_FORCE_TURN:!1,USE_NEW_RENDER_FREEZE_TIME:!1,ENCODE_EXCEPTION_TIMES:5,ENABLE_ENCODE_EXCEPTION:!0,ENCODE_EXCEPTION_VALIDATE_CODEC:["h264"],VIDEO_ENCODER_CONFIG_LIST:[{width:240,height:180},{width:320,height:240},{width:400,height:300},{width:480,height:360},{width:560,height:420},{width:640,height:480}],DELETE_NEQ_AFTER_USER_LEAVE:!0},VE=f_(f_(f_(f_({},dF),{},{PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:["CHINA","GLOBAL"],WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,NOT_REPORT_EVENT:[],PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,SHOW_REPORT_USER_INVOKER_LOG:!0,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],CONNECT_GATEWAY_WITHOUT_DOMAIN:!1,WORKER_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,CHECK_LOCAL_STATS_INTERVAL:250,PROFILE_SWITCH_INTERVAL:2e3,UNSUPPORTED_VIDEO_CODEC:[],ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_MAX_CONCURRENCY:6,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_GATEWAY_TRY_443PORT_DURATION:2e3,JOIN_GATEWAY_USE_443PORT_ONLY:!1,JOIN_GATEWAY_USE_DUAL_DOMAIN:!0,JOIN_GATEWAY_FALLBACK_PORT:443,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!1,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{excludedLinks:[]},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,FIRST_H264_PROFILE_LEVEL_ID:"42001f",FIRST_PACKETIZATION_MODE:"",X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,DISABLE_DUAL_STREAM_USE_ENCODING:!1,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,FINGERPRINT:null,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,ENABLE_AUDIO_TOPN:!1,ENABLE_AUDIO_METADATA:!1,ENABLE_AUDIO_PTS:!1,TOPN_SMOOTH_LEVEL:void 0,TOPN_NEW_SPEAKER_DELAY:void 0,TOPN_SWITCH_HOLD_MS:void 0,TOPN_AUDIO_GAIN:void 0,TOPN_SILENCE_THRESHOLD:250,AP_AREA:!0,ENABLE_ENCODED_TRANSFORM:!1,ENABLE_VIDEO_SEI:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,SHOW_GLOBAL_CLIENT_LIST:!1,DATASTREAM_MAX_RETRANSMITS:10,TCP_CANDIDATE_ONLY:!1,EXTERNAL_SIGNAL_REQUEST_TIMEOUT:3e3,SHOW_P2P_LOG:!1,MAX_P2P_TIMEOUT:3e4,P2P_TOKEN_INTERVAL:1e3,SHOW_DATASTREAM2_LOG:!1,RESTRICTION_SET_PLAYBACK_DEVICE:!0,USE_PURE_ENCRYPTION_MASTER_KEY:!1,ENABLE_AUDIO_RED:!1,OPUS_PTIME:void 0,AUDIO_DUPLICATE_NUM:void 0,ENABLE_ABSSENDTIME_AS_SENTTS:!0,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0},FILTER_VIDEO_CODEC:[],UNSUPPORTED_VIDEO_UPLINK_CODEC:[],UNSUPPORTED_VIDEO_DOWNLINK_CODEC:[],USE_NEW_NETWORK_CONFIG:!1,AUTO_RESET_AUDIO_ROUTE:!1,PLUGIN_INFO:[],OVERUSE_DETECTOR_PARAMS:cF,CUSTOM_ADAPTATION_DEFAULT_MODE:"",HIDE_NO_POSTER:!1,AP_CACHE_NUM:10,AP_UPDATE_INTERVAL:12e4,AP_CACHE_LIFETIME:12e4,MAX_PRELOAD_ASYNC_LENGTH:3,DISABLE_SCREEN_SHARE_REMB:!1},NL),{},{USE_CANDIDATE_FROM_AP_DETAIL:!1,AP_REQUEST_DETAIL:void 0,ENABLE_ROLE_SELECT_EDGE:!1,CLIENT_ROLE_OPTIONS:void 0,COMPATIBLE_SDP_EXTENSION:["gdpr_forbidden"],LIMIT_BITRATE:void 0,EXPERIMENTS:{},USE_PUB_RTX:!0,USE_SUB_RTX:!0,ENABLE_DATASTREAM_2:!1,USE_XR:!0,ENABLE_PREALLOC_PC:!1,ENABLE_PRE_SUB:!1,ENABLE_SVC:!1,ENABLE_PRE_RENDER:!1,FORCE_DISABLE_AUTO_SUB:!1,ENABLE_PRE_SUB_WITH_PRE_PC:!1,PRE_USE_LOCAL_CODECS:!0},{INSTALL_ID:""}),{},{K_MIN_RENDER_DELAY:66,USE_STANDARD_BITRATE_DEFAULT:!1,VIDEO_NEW_BITRATE_RATIO:void 0,VIDEO_STANDARD_BITRATE_VERSION:2,BASELINE_MORE_H264_BITRATE_RATIO:1.1});function SE(e,r,i){var d,h,f;E_(d=Object.keys(VE)).call(d,e)&&(!i&&E_(h=Object.keys(gR)).call(h,e)||(VE[e]=r,e!=="ENABLE_VIDEO_SEI"&&e!=="ENABLE_AUDIO_TOPN"&&e!=="ENABLE_AUDIO_METADATA"&&e!=="ENABLE_AUDIO_PTS"||r!==!0||(VE.ENABLE_ENCODED_TRANSFORM=!0),e==="USE_NEW_NETWORK_CONFIG"&&r&&(f=!!r,VE.USE_NEW_NETWORK_CONFIG=f,f&&(VE.WEBCS_DOMAIN=["webrtc2-2.ap.sd-rtn.com"],VE.WEBCS_DOMAIN_BACKUP_LIST=["webrtc2-4.ap.sd-rtn.com"],VE.CDS_AP=["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],VE.ACCOUNT_REGISTER=["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],VE.EVENT_REPORT_DOMAIN="web-2.statscollector.sd-rtn.com",VE.EVENT_REPORT_BACKUP_DOMAIN="statscollector-1.agora.io",VE.GATEWAY_DOMAINS=["edge.sd-rtn.com"])),e==="ENABLE_PRE_SUB"&&r&&(VE.ENABLE_INSTANT_VIDEO=!0,VE.ENABLE_PREALLOC_PC=!0),e==="ENABLE_SVC"&&r&&(VE.ENABLE_AUT_CC=!0),e==="NEW_FORCE_TURN"&&r&&(VE.NEW_TURN_MODE||(VE.NEW_TURN_MODE=4))))}function _s(e){return VE[e]}aF||(VE.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],VE.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],VE.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],VE.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],VE.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],VE.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],VE.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",VE.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",VE.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",VE.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",VE.AREAS=["NORTH_AMERICA","OVERSEA"]);let V4=function(e){return e[e.REALTIME=1]="REALTIME",e}({});const gR={};var W_=function(e){return e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_INT_UID="SET_INT_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.KEY_METRIC_PRELOAD_START="KEY_METRIC_PRELOAD_START",e.KEY_METRIC_PRELOAD_END="KEY_METRIC_PRELOAD_END",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_REQUEST_SUA_END="KEY_METRIC_REQUEST_SUA_END",e.KEY_METRIC_BEFORE_CONNECT="KEY_METRIC_BEFORE_CONNECT",e.KEY_METRIC_PEER_RECEIVER="KEY_METRIC_PEER_RECEIVER",e.KEY_METRIC_SIGNAL_CONNECTED="KEY_METRIC_SIGNAL_CONNECTED",e.KEY_METRIC_JOIN_REQ="KEY_METRIC_JOIN_REQ",e.KEY_METRIC_JOIN_REP="KEY_METRIC_JOIN_REP",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED="KEY_METRIC_FIRST_VIDEO_FRAME_DECODED",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.RESET_FIRST_VIDEO_FRAME_DECODED="RESET_FIRST_VIDEO_FRAME_DECODED",e.SET_USE_P2P="SET_USE_P2P",e.SET_TRANSPORT_TYPE="SET_TRANSPORT_TYPE",e}(W_||{});let WN=function(e){return e.h264="h264",e.h265="h265",e.vp8="vp8",e.vp9="vp9",e.av1="av1",e}({});(function(e){e.opus="opus",e.pcma="pcma",e.pcmu="pcmu",e.g722="g722"})({});const j4=128,Kdt=96,F4=1e3,bO=10;let Hdt=0;var B4=(()=>{var e={8:(d,h,f)=>{f.r(h),f.d(h,{Parser:()=>a_,Printer:()=>mE,parse:()=>__,print:()=>N_});const g=`
`,b="".concat("\r").concat(g),C=" ";let P;function x(c_){return c_>="0"&&c_<="9"}function H(c_){return c_>="!"&&c_<="~"}function $(c_){return H(c_)||c_>=""&&c_<="ÿ"}function _t(c_){return c_==="!"||c_>="#"&&c_<="'"||c_>="*"&&c_<="+"||c_>="-"&&c_<="."||c_>="0"&&c_<="9"||c_>="A"&&c_<="Z"||c_>="^"&&c_<="~"}function _i(c_){return c_>="1"&&c_<="9"}function ue(c_){return c_>="A"&&c_<="Z"||c_>="a"&&c_<="z"}function _r(c_){return c_==="d"||c_==="h"||c_==="m"||c_==="s"}function Fi(c_){return c_>""&&c_<"	"||c_>"\v"&&c_<"\f"||c_>""&&c_<"ÿ"}function Di(c_){return ue(c_)||x(c_)||c_==="+"||c_==="/"}function Js(c_){return x(c_)||ue(c_)||c_==="+"||c_==="/"||c_==="-"||c_==="_"}function _l(c_){return ue(c_)||x(c_)||c_==="+"||c_==="/"}function _u(c_,zt){var _a=Object.keys(c_);if(Object.getOwnPropertySymbols){var kc=Object.getOwnPropertySymbols(c_);zt&&(kc=kc.filter(function(m_){return Object.getOwnPropertyDescriptor(c_,m_).enumerable})),_a.push.apply(_a,kc)}return _a}function ga(c_){for(var zt=1;zt<arguments.length;zt++){var _a=arguments[zt]!=null?arguments[zt]:{};zt%2?_u(Object(_a),!0).forEach(function(kc){_m(c_,kc,_a[kc])}):Object.getOwnPropertyDescriptors?Object.defineProperties(c_,Object.getOwnPropertyDescriptors(_a)):_u(Object(_a)).forEach(function(kc){Object.defineProperty(c_,kc,Object.getOwnPropertyDescriptor(_a,kc))})}return c_}function _m(c_,zt,_a){return zt in c_?Object.defineProperty(c_,zt,{value:_a,enumerable:!0,configurable:!0,writable:!0}):c_[zt]=_a,c_}(function(c_){c_.VERSION="v",c_.ORIGIN="o",c_.SESSION_NAME="s",c_.INFORMATION="i",c_.URI="u",c_.EMAIL="e",c_.PHONE="p",c_.CONNECTION="c",c_.BANDWIDTH="b",c_.TIME="t",c_.REPEAT="r",c_.ZONE_ADJUSTMENTS="z",c_.KEY="k",c_.ATTRIBUTE="a",c_.MEDIA="m"})(P||(P={}));class r_{consumeText(zt,_a){let kc=_a;for(;kc<zt.length;){const m_=zt[kc];if(m_==="\0"||m_==="\r"||m_===g)break;kc+=1}if(kc-_a==0)throw new Error("Invalid text, at ".concat(zt));return kc}consumeUnicastAddress(zt,_a,kc){return this.consumeTill(zt,_a,C)}consumeOneOrMore(zt,_a,kc){let m_=_a;for(;kc(zt[m_]);)m_++;if(m_-_a==0)throw new Error("Invalid rule at ".concat(_a,"."));return m_}consumeSpace(zt,_a){if(zt[_a]===C)return _a+1;throw new Error("Invalid space at ".concat(_a,"."))}consumeIP4Address(zt,_a){let kc=_a;for(let m_=0;m_<4;m_++)if(kc=this.consumeDecimalUChar(zt,kc),m_!==3){if(zt[kc]!==".")throw new Error("Invalid IP4 address.");kc++}return kc}consumeDecimalUChar(zt,_a){let kc=_a;for(let H_=0;H_<3&&x(zt[kc]);H_++,kc++);if(kc-_a==0)throw new Error("Invalid decimal uchar.");const m_=parseInt(zt.slice(_a,kc));if(m_>=0&&m_<=255)return kc;throw new Error("Invalid decimal uchar")}consumeIP6Address(zt,_a){let kc=this.consumeHexpart(zt,_a);return zt[kc]===":"&&(kc+=1,kc=this.consumeIP4Address(zt,kc)),kc}consumeHexpart(zt,_a){let kc=_a;if(zt[kc]===":"&&zt[kc+1]===":"){kc+=2;try{kc=this.consumeHexseq(zt,kc)}catch{}return kc}if(kc=this.consumeHexseq(zt,kc),zt[kc]===":"&&zt[kc+1]===":"){kc+=2;try{kc=this.consumeHexseq(zt,kc)}catch{}return kc}return kc}consumeHexseq(zt,_a){let kc=_a;for(;kc=this.consumeHex4(zt,kc),zt[kc]===":"&&zt[kc+1]!==":";)kc+=1;return kc}consumeHex4(zt,_a){let kc=0;for(;kc<4;kc++)if(!((m_=zt[_a+kc])>="0"&&m_<="9"||m_>="a"&&m_<="f"||m_>="A"&&m_<="F")){if(kc===0)throw new Error("Invalid hex 4");break}var m_;return _a+kc}consumeFQDN(zt,_a){let kc=_a;for(;x(zt[kc])||ue(zt[kc])||zt[kc]==="-"||zt[kc]===".";)kc+=1;if(kc-_a<4)throw new Error("Invalid FQDN");return kc}consumeExtnAddr(zt,_a){return this.consumeOneOrMore(zt,_a,$)}consumeMulticastAddress(zt,_a,kc){switch(kc){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(zt,_a);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(zt,_a);default:try{return this.consumeFQDN(zt,_a)}catch{return this.consumeExtnAddr(zt,_a)}}}consumeIP6MulticastAddress(zt,_a){const kc=this.consumeHexpart(zt,_a);return zt[kc]==="/"?this.consumeInteger(zt,kc+1):kc}consumeIP4MulticastAddress(zt,_a){let kc=_a+3;const m_=zt.slice(_a,kc),H_=parseInt(m_);if(H_<224||H_>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let PE=0;PE<3;PE++){if(zt[kc]!==".")throw new Error("Invalid IP4 multicast address.");kc+=1,kc=this.consumeDecimalUChar(zt,kc)}return zt[kc]==="/"&&(kc+=1),kc=this.consumeTTL(zt,kc),zt[kc]==="/"&&(kc=this.consumeInteger(zt,kc)),kc}consumeInteger(zt,_a){if(!_i(zt[_a]))throw new Error("Invalid integer.");for(_a+=1;x(zt[_a]);)_a+=1;return _a}consumeTTL(zt,_a){if(zt[_a]==="0")return _a+1;if(!_i(zt[_a]))throw new Error("Invalid TTL.");_a+=1;for(let kc=0;kc<2&&x(zt[_a]);kc++)_a+=1;return _a}consumeToken(zt,_a){return this.consumeOneOrMore(zt,_a,_t)}consumeTime(zt,_a){let kc=_a;if(zt[kc]==="0")return kc+1;for(_i(zt[kc])&&(kc+=1);x(zt[kc]);)kc++;if(kc-_a<10)throw new Error("Invalid time");return kc}consumeAddress(zt,_a){return this.consumeTill(zt,_a,C)}consumeTypedTime(zt,_a){let kc=_a;return kc=this.consumeOneOrMore(zt,kc,x),_r(zt[kc])?kc+1:kc}consumeRepeatInterval(zt,_a){if(!_i(zt[_a]))throw new Error("Invalid repeat interval");for(_a+=1;x(zt[_a]);)_a+=1;return _r(zt[_a])&&(_a+=1),_a}consumePort(zt,_a){return this.consumeOneOrMore(zt,_a,x)}consume(zt,_a,kc){for(let m_=0;m_<kc.length;m_++){if(_a+m_>=zt.length)throw new Error("consume exceeding value length");if(zt[_a+m_]!==kc[m_])throw new Error("consume ".concat(kc," failed at ").concat(m_))}return _a+kc.length}consumeTill(zt,_a,kc){let m_=_a;for(;m_<zt.length&&(typeof kc!="string"||zt[m_]!==kc)&&(typeof kc!="function"||!kc(zt[m_]));)m_++;return m_}}class a_ extends r_{constructor(){super(),_m(this,"records",[]),_m(this,"currentLine",0)}parse(zt){const _a=this.probeEOL(zt);this.records=zt.split(_a).filter(h0=>!!xS(h0).call(h0)).map(this.parseLine),this.currentLine=0;const kc=this.parseVersion(),m_=this.parseOrigin(),H_=this.parseSessionName(),PE=this.parseInformation(),rS=this.parseUri(),UT=this.parseEmail(),cR=this.parsePhone(),AP=this.parseConnection(),LI=this.parseBandWidth(),ZO=this.parseTimeFields(),W1=this.parseKey(),K1=this.parseSessionAttribute(),VT=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:kc,origin:m_,sessionName:H_,information:PE,uri:rS,emails:UT,phones:cR,connection:AP,bandwidths:LI,timeFields:ZO,key:W1,attributes:K1,mediaDescriptions:VT}}getCurrentRecord(){const zt=this.records[this.currentLine];if(!zt)throw new Error("Record doesn't exit.");return zt}probeEOL(zt){for(let _a=0;_a<zt.length;_a++)if(zt[_a]===g)return zt[_a-1]==="\r"?b:g;throw new Error("Invalid newline character.")}parseLine(zt,_a){if(zt.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const kc=zt[0];if(zt[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:kc,value:zt.slice(2),line:_a,cur:0}}parseSessionAttribute(){const zt=new Q_;for(;this.currentLine<this.records.length;){const _a=this.getCurrentRecord();if(_a.type!==P.ATTRIBUTE)break;const kc={attField:this.extractOneOrMore(_a,m_=>_t(m_)&&m_!==":"),_cur:0};_a.value[_a.cur]===":"&&(_a.cur+=1,kc.attValue=this.extractOneOrMore(_a,Fi)),zt.parse(kc),this.currentLine++}return zt.digest()}parseMediaAttributes(zt){const _a=new $_(zt);for(;this.currentLine<this.records.length;){const kc=this.getCurrentRecord();if(kc.type!==P.ATTRIBUTE)break;const m_={attField:this.extractOneOrMore(kc,H_=>_t(H_)&&H_!==":"),_cur:0};kc.value[kc.cur]===":"&&(kc.cur+=1,m_.attValue=this.extractOneOrMore(kc,Fi)),_a.parse(m_),this.currentLine++}return _a.digest()}parseKey(){const zt=this.getCurrentRecord();if(zt.type===P.KEY){if(zt.value==="prompt"||zt.value==="clear:"||zt.value==="base64:"||zt.value==="uri:")return zt.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const zt=this.getCurrentRecord();if(zt.type===P.ZONE_ADJUSTMENTS){const _a=[];for(;;)try{const kc=this.extract(zt,this.consumeTime);this.consumeSpaceForRecord(zt);let m_=!1;zt.value[zt.cur]==="-"&&(m_=!0,zt.cur+=1);const H_=this.extract(zt,this.consumeTypedTime);_a.push({time:kc,typedTime:H_,back:m_})}catch{break}if(_a.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,_a}return[]}parseRepeat(){const zt=[];for(;;){const _a=this.getCurrentRecord();if(_a.type!==P.REPEAT)break;{const kc=this.extract(_a,this.consumeRepeatInterval),m_=this.parseTypedTime(_a);zt.push({repeatInterval:kc,typedTimes:m_}),this.currentLine++}}return zt}parseTypedTime(zt){const _a=[];for(;;)try{this.consumeSpaceForRecord(zt),_a.push(this.extract(zt,this.consumeTypedTime))}catch{break}if(_a.length===0)throw new Error("Invalid typed time.");return _a}parseTime(){const zt=this.getCurrentRecord(),_a=this.extract(zt,this.consumeTime);this.consumeSpaceForRecord(zt);const kc=this.extract(zt,this.consumeTime);return this.currentLine++,{startTime:_a,stopTime:kc}}parseBandWidth(){const zt=[];for(;this.currentLine<this.records.length;){const _a=this.getCurrentRecord();if(_a.type!==P.BANDWIDTH)break;{const kc=this.extractOneOrMore(_a,_t);if(_a.value[_a.cur]!==":")throw new Error("Invalid bandwidth field.");_a.cur++;const m_=this.extractOneOrMore(_a,x);zt.push({bwtype:kc,bandwidth:m_}),this.currentLine++}}return zt}parseVersion(){const zt=this.getCurrentRecord();if(zt.type!==P.VERSION)throw new Error("first sdp record must be version");const _a=zt.value.slice(0,this.consumeOneOrMore(zt.value,0,x));if(_a.length!==zt.value.length)throw new Error('invalid proto version, "v='.concat(zt.value,'"'));return this.currentLine++,_a}parseOrigin(){const zt=this.getCurrentRecord();if(zt.type!==P.ORIGIN)throw new Error("second line of sdp must be origin");const _a=this.extractOneOrMore(zt,$);this.consumeSpaceForRecord(zt);const kc=this.extractOneOrMore(zt,x);this.consumeSpaceForRecord(zt);const m_=this.extractOneOrMore(zt,x);this.consumeSpaceForRecord(zt);const H_=this.extractOneOrMore(zt,_t);this.consumeSpaceForRecord(zt);const PE=this.extractOneOrMore(zt,_t);this.consumeSpaceForRecord(zt);const rS=this.extract(zt,this.consumeUnicastAddress);return this.currentLine++,{username:_a,sessId:kc,sessVersion:m_,nettype:H_,addrtype:PE,unicastAddress:rS}}parseSessionName(){const zt=this.getCurrentRecord();if(zt.type===P.SESSION_NAME){const _a=this.extract(zt,this.consumeText);return this.currentLine++,_a}}parseInformation(){const zt=this.getCurrentRecord();if(zt.type!==P.INFORMATION)return;const _a=this.extract(zt,this.consumeText);return this.currentLine++,_a}parseUri(){const zt=this.getCurrentRecord();if(zt.type===P.URI)return this.currentLine++,zt.value}parseEmail(){const zt=[];for(;;){const _a=this.getCurrentRecord();if(_a.type!==P.EMAIL)break;zt.push(_a.value),this.currentLine++}return zt}parsePhone(){const zt=[];for(;;){const _a=this.getCurrentRecord();if(_a.type!==P.PHONE)break;zt.push(_a.value),this.currentLine++}return zt}parseConnection(){const zt=this.getCurrentRecord();if(zt.type===P.CONNECTION){const _a=this.extractOneOrMore(zt,_t);this.consumeSpaceForRecord(zt);const kc=this.extractOneOrMore(zt,_t);this.consumeSpaceForRecord(zt);const m_=this.extract(zt,this.consumeAddress);return this.currentLine++,{nettype:_a,addrtype:kc,address:m_}}}parseMedia(){const zt=this.getCurrentRecord(),_a=this.extract(zt,this.consumeToken);this.consumeSpaceForRecord(zt);let kc=this.extract(zt,this.consumePort);zt.value[zt.cur]==="/"&&(zt.cur+=1,kc+=this.extract(zt,this.consumeInteger)),this.consumeSpaceForRecord(zt);const m_=[];for(m_.push(this.extract(zt,this.consumeToken));zt.value[zt.cur]==="/";)zt.cur+=1,m_.push(this.extract(zt,this.consumeToken));if(m_.length===0)throw new Error("Invalid proto");const H_=this.parseFmt(zt);return this.currentLine++,{mediaType:_a,port:kc,protos:m_,fmts:H_}}parseTimeFields(){const zt=[];for(;this.getCurrentRecord().type===P.TIME;){const _a=this.parseTime(),kc=this.parseRepeat(),m_=this.parseZone();zt.push({time:_a,repeats:kc,zones:m_})}return zt}parseMediaDescription(){const zt=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===P.MEDIA;){const _a=this.parseMedia(),kc=this.parseInformation(),m_=this.parseConnections(),H_=this.parseBandWidth(),PE=this.parseKey(),rS=this.parseMediaAttributes(_a);zt.push({media:_a,information:kc,connections:m_,bandwidths:H_,key:PE,attributes:rS})}return zt}parseConnections(){const zt=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===P.CONNECTION;)zt.push(this.parseConnection());return zt}parseFmt(zt){const _a=[];for(;;)try{this.consumeSpaceForRecord(zt),_a.push(this.extract(zt,this.consumeToken))}catch{break}if(_a.length===0)throw new Error("Invalid fmts");return _a}extract(zt,_a){for(var kc=arguments.length,m_=new Array(kc>2?kc-2:0),H_=2;H_<kc;H_++)m_[H_-2]=arguments[H_];const PE=_a.call(this,zt.value,zt.cur,...m_),rS=zt.value.slice(zt.cur,PE);return zt.cur=PE,rS}extractOneOrMore(zt,_a){const kc=this.consumeOneOrMore(zt.value,zt.cur,_a),m_=zt.value.slice(zt.cur,kc);return zt.cur=kc,m_}consumeSpaceForRecord(zt){if(zt.value[zt.cur]!==C)throw new Error("Invalid space at ".concat(zt.cur,"."));zt.cur+=1}}class p_ extends r_{constructor(){super(...arguments),_m(this,"attributes",void 0),_m(this,"digested",!1)}extractOneOrMore(zt,_a,kc){const m_=this.consumeOneOrMore(zt.attValue,zt._cur,_a),H_=zt.attValue.slice(zt._cur,m_),[PE,rS]=kc||[];if(typeof PE=="number"&&H_.length<PE)throw new Error("error in length, should be more or equal than ".concat(PE," characters."));if(typeof rS=="number"&&H_.length>rS)throw new Error("error in length, should be less or equal than ".concat(rS," characters."));return zt._cur=m_,H_}consumeAttributeSpace(zt){if(zt.attValue[zt._cur]!==C)throw new Error("Invalid space at ".concat(zt._cur,"."));zt._cur+=1}extract(zt,_a){if(!zt.attValue)throw new Error("Nothing to extract from attValue.");for(var kc=arguments.length,m_=new Array(kc>2?kc-2:0),H_=2;H_<kc;H_++)m_[H_-2]=arguments[H_];const PE=_a.call(this,zt.attValue,zt._cur,...m_),rS=zt.attValue.slice(zt._cur,PE);return zt._cur=PE,rS}atEnd(zt){if(!zt.attValue)throw new Error;return zt._cur>=zt.attValue.length}peekChar(zt){if(!zt.attValue)throw new Error;return zt.attValue[zt._cur]}peek(zt,_a){if(!zt.attValue)throw new Error;for(let kc=0;kc<_a.length;kc++)if(_a[kc]!==zt.attValue[zt._cur+kc])return!1;return!0}parseIceUfrag(zt){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(zt,Di,[4,256])}parseIcePwd(zt){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(zt,Di,[22,256])}parseIceOptions(zt){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const _a=[];for(;!this.atEnd(zt);){_a.push(this.extractOneOrMore(zt,Di));try{this.consumeAttributeSpace(zt)}catch(kc){if(this.atEnd(zt))break;throw kc}}this.attributes.iceOptions=_a}parseFingerprint(zt){const _a=this.extract(zt,this.consumeToken);this.consumeAttributeSpace(zt);const kc=this.extract(zt,this.consumeTill);this.attributes.fingerprints.push({hashFunction:_a,fingerprint:kc})}parseExtmap(zt){const _a=this.extractOneOrMore(zt,x);let kc;this.peekChar(zt)==="/"&&(this.extract(zt,this.consume,"/"),kc=this.extract(zt,this.consumeToken)),this.consumeAttributeSpace(zt);const m_=this.extract(zt,this.consumeTill,C),H_=ga(ga({entry:parseInt(_a,10)},kc&&{direction:kc}),{},{extensionName:m_});this.peekChar(zt)===C&&(this.consumeAttributeSpace(zt),H_.extensionAttributes=this.extract(zt,this.consumeTill)),this.attributes.extmaps.push(H_)}parseSetup(zt){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const _a=this.extract(zt,this.consumeTill);if(_a!=="active"&&_a!=="passive"&&_a!=="actpass"&&_a!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=_a}}class Q_ extends p_{constructor(){super(...arguments),_m(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(zt){if(this.digested)throw new Error("already digested");try{switch(zt.attField){case"group":this.parseGroup(zt);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(zt);break;case"ice-pwd":this.parseIcePwd(zt);break;case"ice-options":this.parseIceOptions(zt);break;case"fingerprint":this.parseFingerprint(zt);break;case"setup":this.parseSetup(zt);break;case"tls-id":this.parseTlsId(zt);break;case"identity":this.parseIdentity(zt);break;case"extmap":this.parseExtmap(zt);break;case"msid-semantic":this.parseMsidSemantic(zt);break;default:zt.ignored=!0,this.attributes.unrecognized.push(zt)}}catch(_a){throw console.error("parsing session attribute ".concat(zt.attField,' error, "a=').concat(zt.attField,":").concat(zt.attValue,'"')),_a}if(!zt.ignored&&zt.attValue&&!this.atEnd(zt))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(zt){const _a=this.extract(zt,this.consumeToken),kc=[];for(;!this.atEnd(zt)&&this.peekChar(zt)===C;)this.consumeAttributeSpace(zt),kc.push(this.extract(zt,this.consumeToken));this.attributes.groups.push({semantic:_a,identificationTag:kc})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(zt){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(zt,Js)}parseIdentity(zt){const _a=this.extractOneOrMore(zt,_l),kc=[];for(;!this.atEnd(zt)&&this.peekChar(zt)===C;){this.consumeAttributeSpace(zt);const m_=this.extract(zt,this.consumeToken);this.extract(zt,this.consume,"=");const H_=this.extractOneOrMore(zt,PE=>PE!==C&&Fi(PE));kc.push({name:m_,value:H_})}this.attributes.identities.push({assertionValue:_a,extensions:kc})}parseMsidSemantic(zt){this.peekChar(zt)===C&&this.consumeAttributeSpace(zt);const _a={semantic:this.extract(zt,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(zt)}catch{break}if(this.peekChar(zt)==="*"){this.extract(zt,this.consume,"*"),_a.applyForAll=!0;break}{const kc=this.extract(zt,this.consumeTill,C);_a.identifierList.push(kc)}}this.attributes.msidSemantic=_a}}class $_ extends p_{constructor(zt){super(),_m(this,"attributes",void 0),zt.protos.indexOf("RTP")!==-1||zt.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(zt){if(this.digested)throw new Error("already digested");try{switch(zt.attField){case"extmap":this.parseExtmap(zt);break;case"setup":this.parseSetup(zt);break;case"ice-ufrag":this.parseIceUfrag(zt);break;case"ice-pwd":this.parseIcePwd(zt);break;case"ice-options":this.parseIceOptions(zt);break;case"candidate":this.parseCandidate(zt);break;case"remote-candidate":this.parseRemoteCandidate(zt);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(zt);break;case"rtpmap":this.parseRtpmap(zt);break;case"ptime":this.parsePtime(zt);break;case"maxptime":this.parseMaxPtime(zt);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(zt);break;case"ssrc":this.parseSSRC(zt);break;case"fmtp":this.parseFmtp(zt);break;case"rtcp-fb":this.parseRtcpFb(zt);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(zt);break;case"mid":this.parseMid(zt);break;case"msid":this.parseMsid(zt);break;case"imageattr":this.parseImageAttr(zt);break;case"rid":this.parseRid(zt);break;case"simulcast":this.parseSimulcast(zt);break;case"sctp-port":this.parseSctpPort(zt);break;case"max-message-size":this.parseMaxMessageSize(zt);break;case"ssrc-group":this.parseSSRCGroup(zt);break;default:zt.ignored=!0,this.attributes.unrecognized.push(zt)}}catch(_a){throw console.error("parsing media attribute ".concat(zt.attField,' error, "a=').concat(zt.attField,":").concat(zt.attValue,'"')),_a}if(!zt.ignored&&zt.attValue&&!this.atEnd(zt))throw new Error("attribute parsing error")}parseCandidate(zt){const _a=this.extractOneOrMore(zt,Di,[1,32]);this.consumeAttributeSpace(zt);const kc=this.extractOneOrMore(zt,x,[1,5]);this.consumeAttributeSpace(zt);const m_=this.extract(zt,this.consumeToken);this.consumeAttributeSpace(zt);const H_=this.extractOneOrMore(zt,x,[1,10]);this.consumeAttributeSpace(zt);const PE=this.extract(zt,this.consumeAddress);this.consumeAttributeSpace(zt);const rS=this.extract(zt,this.consumePort);this.consumeAttributeSpace(zt),this.extract(zt,this.consume,"typ"),this.consumeAttributeSpace(zt);const UT={foundation:_a,componentId:kc,transport:m_,priority:H_,connectionAddress:PE,port:rS,type:this.extract(zt,this.consumeToken),extension:{}};for(this.peek(zt," raddr")&&(this.extract(zt,this.consume," raddr"),this.consumeAttributeSpace(zt),UT.relAddr=this.extract(zt,this.consumeAddress)),this.peek(zt," rport")&&(this.extract(zt,this.consume," rport"),this.consumeAttributeSpace(zt),UT.relPort=this.extract(zt,this.consumePort));this.peekChar(zt)===C;){this.consumeAttributeSpace(zt);const cR=this.extract(zt,this.consumeToken);this.consumeAttributeSpace(zt),UT.extension[cR]=this.extractOneOrMore(zt,H)}this.attributes.candidates.push(UT)}parseRemoteCandidate(zt){const _a=[];for(;;){const kc=this.extractOneOrMore(zt,x,[1,5]);this.consumeAttributeSpace(zt);const m_=this.extract(zt,this.consumeAddress);this.consumeAttributeSpace(zt);const H_=this.extract(zt,this.consumePort);_a.push({componentId:kc,connectionAddress:m_,port:H_});try{this.consumeAttributeSpace(zt)}catch{break}}this.attributes.remoteCandidatesList.push(_a)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(zt){const _a=this.extract(zt,this.consumeToken);this.consumeAttributeSpace(zt);const kc=this.extract(zt,this.consumeTill,"/");this.extract(zt,this.consume,"/");const m_={encodingName:kc,clockRate:this.extractOneOrMore(zt,x)};this.atEnd(zt)||this.peekChar(zt)!=="/"||(this.extract(zt,this.consume,"/"),m_.encodingParameters=parseInt(this.extract(zt,this.consumeTill),10));const H_=this.attributes.payloads.find(PE=>PE.payloadType===parseInt(_a,10));H_?H_.rtpMap=m_:this.attributes.payloads.push({payloadType:parseInt(_a,10),rtpMap:m_,rtcpFeedbacks:[]})}parsePtime(zt){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(zt,this.consumeTill)}parseMaxPtime(zt){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(zt,this.consumeTill)}parseDirection(zt){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=zt.attField}parseSSRC(zt){const _a=this.extractOneOrMore(zt,x);this.consumeAttributeSpace(zt);const kc=this.extract(zt,this.consumeTill,":");let m_;this.peekChar(zt)===":"&&(this.extract(zt,this.consume,":"),m_=this.extract(zt,this.consumeTill));const H_=this.attributes.ssrcs.find(PE=>PE.ssrcId===parseInt(_a,10));H_?H_.attributes[kc]=m_:this.attributes.ssrcs.push({ssrcId:parseInt(_a,10),attributes:{[kc]:m_}})}parseFmtp(zt){const _a=this.extract(zt,this.consumeTill,C);this.consumeAttributeSpace(zt);const kc=this.extract(zt,this.consumeTill),m_={};kc.split(";").forEach(PE=>{let[rS,UT]=PE.split("=");rS=xS(rS).call(rS);const cR=typeof UT=="string"?xS(UT).call(UT):null;typeof rS=="string"&&rS.length>0&&(m_[rS]=cR)});const H_=this.attributes.payloads.find(PE=>PE.payloadType===parseInt(_a,10));H_?H_.fmtp={parameters:m_}:this.attributes.payloads.push({payloadType:parseInt(_a,10),rtcpFeedbacks:[],fmtp:{parameters:m_}})}parseFmtParameters(zt){const _a={},kc=this.extract(zt,this.consumeTill,"=");zt._cur++;const m_=this.extract(zt,this.consumeTill,";");for(_a[kc]=m_;zt.attValue[zt._cur]===";";){const H_=this.extract(zt,this.consumeTill,"=");zt._cur++;const PE=this.extract(zt,this.consumeTill,";");_a[H_]=PE}return _a}parseRtcpFb(zt){let _a="";_a=this.peekChar(zt)==="*"?this.extract(zt,this.consume,"*"):this.extract(zt,this.consumeTill,C),this.consumeAttributeSpace(zt);const kc=this.extract(zt,this.consumeTill,C);let m_;if(kc==="trr-int")m_={type:kc,interval:this.extract(zt,this.consumeTill)};else{const H_={type:kc};this.peekChar(zt)===C&&(this.consumeAttributeSpace(zt),H_.parameter=this.extract(zt,this.consumeToken),this.peekChar(zt)===C&&(H_.additional=this.extract(zt,this.consumeTill))),m_=H_}if(_a==="*")this.attributes.rtcpFeedbackWildcards.push(m_);else{const H_=this.attributes.payloads.find(PE=>PE.payloadType===parseInt(_a,10));H_?H_.rtcpFeedbacks.push(m_):this.attributes.payloads.push({payloadType:parseInt(_a,10),rtcpFeedbacks:[m_]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(zt){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const _a={port:this.extract(zt,this.consumePort)};this.peekChar(zt)===C&&(this.consumeAttributeSpace(zt),_a.netType=this.extractOneOrMore(zt,_t),this.consumeAttributeSpace(zt),_a.addressType=this.extractOneOrMore(zt,_t),this.consumeAttributeSpace(zt),_a.address=this.extract(zt,this.consumeAddress)),this.attributes.rtcp=_a}parseMsid(zt){const _a={id:this.extractOneOrMore(zt,_t,[1,64])};this.peekChar(zt)===C&&(this.consumeAttributeSpace(zt),_a.appdata=this.extractOneOrMore(zt,_t,[1,64])),this.attributes.msids.push(_a)}parseImageAttr(zt){this.attributes.imageattr.push(zt.attValue)}parseRid(zt){const _a=this.extractOneOrMore(zt,m_=>ue(m_)||x(m_)||m_==="_"||m_==="-");this.consumeAttributeSpace(zt);const kc={id:_a,direction:this.extract(zt,this.consumeToken),params:[]};if(this.peekChar(zt)===C){if(this.consumeAttributeSpace(zt),this.peek(zt,"pt=")){this.extract(zt,this.consume,"pt=");const m_=[];for(;;){const H_=this.extract(zt,this.consumeToken);m_.push(H_);try{this.extract(zt,this.consume,",")}catch{break}}kc.payloads=m_,this.peekChar(zt)===C&&this.extract(zt,this.consume,C)}for(;;){const m_=this.extract(zt,this.consumeToken);switch(m_){case"depend":{const H_={type:m_,rids:this.extract(zt,this.consume,"=").split(",")};kc.params.push(H_);break}default:{const H_={type:m_};this.peekChar(zt)==="="&&(this.extract(zt,this.consume,"="),H_.val=this.extract(zt,this.consumeTill,";")),kc.params.push(H_)}}try{this.extract(zt,this.consume,";")}catch{break}}}this.attributes.rids.push(kc)}parseSimulcast(zt){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=zt.attValue,this.extract(zt,this.consumeTill)}parseSctpPort(zt){this.attributes.sctpPort=this.extractOneOrMore(zt,x,[1,5])}parseMaxMessageSize(zt){this.attributes.maxMessageSize=this.extractOneOrMore(zt,x,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(zt){this.attributes.mid=this.extract(zt,this.consumeToken)}parseSSRCGroup(zt){const _a=this.extract(zt,this.consumeToken),kc=[];for(;;)try{this.consumeAttributeSpace(zt);const m_=this.extract(zt,this.consumeInteger);kc.push(parseInt(m_,10))}catch{break}this.attributes.ssrcGroups.push({semantic:_a,ssrcIds:kc})}}function F_(c_,zt,_a){return zt in c_?Object.defineProperty(c_,zt,{value:_a,enumerable:!0,configurable:!0,writable:!0}):c_[zt]=_a,c_}class mE{constructor(){F_(this,"eol",b)}print(zt,_a){let kc="";return _a&&(this.eol=_a),kc+=this.printVersion(zt.version),kc+=this.printOrigin(zt.origin),kc+=this.printSessionName(zt.sessionName),kc+=this.printInformation(zt.information),kc+=this.printUri(zt.uri),kc+=this.printEmail(zt.emails),kc+=this.printPhone(zt.phones),kc+=this.printConnection(zt.connection),kc+=this.printBandwidth(zt.bandwidths),kc+=this.printTimeFields(zt.timeFields),kc+=this.printKey(zt.key),kc+=this.printSessionAttributes(zt.attributes),kc+=this.printMediaDescription(zt.mediaDescriptions),kc}printVersion(zt){return"v=".concat(zt).concat(this.eol)}printOrigin(zt){return"o=".concat(zt.username," ").concat(zt.sessId," ").concat(zt.sessVersion," ").concat(zt.nettype," ").concat(zt.addrtype," ").concat(zt.unicastAddress).concat(this.eol)}printSessionName(zt){return zt?"s=".concat(zt).concat(this.eol):""}printInformation(zt){return zt?"i=".concat(zt).concat(this.eol):""}printUri(zt){return zt?"u=".concat(zt).concat(this.eol):""}printEmail(zt){let _a="";for(const kc of zt)_a+="e=".concat(kc).concat(this.eol);return _a}printPhone(zt){let _a="";for(const kc of zt)_a+="e=".concat(kc).concat(this.eol);return _a}printConnection(zt){return zt?"c=".concat(zt.nettype," ").concat(zt.addrtype," ").concat(zt.address).concat(this.eol):""}printBandwidth(zt){let _a="";for(const kc of zt)_a+="b=".concat(kc.bwtype,":").concat(kc.bandwidth).concat(this.eol);return _a}printTimeFields(zt){let _a="";for(const kc of zt){_a+="t=".concat(kc.time.startTime," ").concat(kc.time.startTime).concat(this.eol);for(const m_ of kc.repeats)_a+="r=".concat(m_.repeatInterval," ").concat(m_.typedTimes.join(" ")).concat(this.eol);kc.zoneAdjustments&&(_a+="z=",_a+="z=".concat(kc.zoneAdjustments.map(m_=>"".concat(m_.time," ").concat(m_.back?"-":""," ").concat(m_.typedTime)).join(" ")).concat(this.eol),_a+=this.eol)}return _a}printKey(zt){return zt?"k=".concat(zt).concat(this.eol):""}printAttributes(zt){let _a="";for(const kc of zt)_a+="a=".concat(kc.attField).concat(kc.attValue?":".concat(kc.attValue):"").concat(this.eol);return _a}printMediaDescription(zt){let _a="";for(const kc of zt)_a+=this.printMedia(kc.media),_a+=this.printInformation(kc.information),_a+=this.printConnections(kc.connections),_a+=this.printBandwidth(kc.bandwidths),_a+=this.printKey(kc.key),_a+=this.printMediaAttributes(kc);return _a}printConnections(zt){let _a="";for(const kc of zt)_a+=this.printConnection(kc);return _a}printMedia(zt){return"m=".concat(zt.mediaType," ").concat(zt.port," ").concat(zt.protos.join("/")," ").concat(zt.fmts.join(" ")).concat(this.eol)}printSessionAttributes(zt){return new PS(this.eol).print(zt)}printMediaAttributes(zt){return new s_(this.eol).print(zt)}}class pE{constructor(zt){F_(this,"eol",void 0),this.eol=zt}printIceUfrag(zt){return zt===void 0?"":"a=ice-ufrag:".concat(zt).concat(this.eol)}printIcePwd(zt){return zt===void 0?"":"a=ice-pwd:".concat(zt).concat(this.eol)}printIceOptions(zt){return zt===void 0?"":"a=ice-options:".concat(zt.join(C)).concat(this.eol)}printFingerprints(zt){return zt.length>0?zt.map(_a=>"a=fingerprint:".concat(_a.hashFunction).concat(C).concat(_a.fingerprint)).join(this.eol)+this.eol:""}printExtmap(zt){return zt.map(_a=>"a=extmap:".concat(_a.entry).concat(_a.direction?"/".concat(_a.direction):"").concat(C).concat(_a.extensionName).concat(_a.extensionAttributes?"".concat(C).concat(_a.extensionAttributes):"").concat(this.eol)).join("")}printSetup(zt){return zt===void 0?"":"a=setup:".concat(zt).concat(this.eol)}printUnrecognized(zt){return zt.map(_a=>"a=".concat(_a.attField).concat(_a.attValue?":".concat(_a.attValue):"").concat(this.eol)).join("")}}class PS extends pE{print(zt){let _a="";return _a+=this.printGroups(zt.groups),_a+=this.printMsidSemantic(zt.msidSemantic),_a+=this.printIceLite(zt.iceLite),_a+=this.printIceUfrag(zt.iceUfrag),_a+=this.printIcePwd(zt.icePwd),_a+=this.printIceOptions(zt.iceOptions),_a+=this.printFingerprints(zt.fingerprints),_a+=this.printSetup(zt.setup),_a+=this.printTlsId(zt.tlsId),_a+=this.printIdentity(zt.identities),_a+=this.printExtmap(zt.extmaps),_a+=this.printUnrecognized(zt.unrecognized),_a}printGroups(zt){let _a="";return zt.length>0&&(_a+=zt.map(kc=>"a=group:".concat(kc.semantic).concat(kc.identificationTag.map(m_=>"".concat(C).concat(m_)).join("")).concat(this.eol)).join("")),_a}printIceLite(zt){return zt===void 0?"":"a=ice-lite"+this.eol}printTlsId(zt){return zt?"a=tls-id:".concat(zt).concat(this.eol):""}printIdentity(zt){return zt.length===0?"":zt.map(_a=>"a=identity:".concat(_a.assertionValue).concat(_a.extensions.map(kc=>"".concat(C).concat(kc.name).concat(kc.value?"=".concat(kc.value):"")))).join(this.eol)+this.eol}printMsidSemantic(zt){if(!zt)return"";let _a="a=msid-semantic:".concat(zt.semantic);return zt.applyForAll?_a+="".concat(C,"*"):zt.identifierList.length>0&&(_a+=zt.identifierList.map(kc=>"".concat(C).concat(kc))),_a+this.eol}}class s_ extends pE{print(zt){const _a=zt.attributes;let kc="";return kc+=this.printRTCP(_a.rtcp),kc+=this.printIceUfrag(_a.iceUfrag),kc+=this.printIcePwd(_a.icePwd),kc+=this.printIceOptions(_a.iceOptions),kc+=this.printCandidates(_a.candidates),kc+=this.printRemoteCandidatesList(_a.remoteCandidatesList),kc+=this.printEndOfCandidates(_a.endOfCandidates),kc+=this.printFingerprints(_a.fingerprints),kc+=this.printSetup(_a.setup),kc+=this.printMid(_a.mid),kc+=this.printExtmap(_a.extmaps),kc+=this.printRTPRelated(_a),kc+=this.printPtime(_a.ptime),kc+=this.printMaxPtime(_a.maxPtime),kc+=this.printDirection(_a.direction),kc+=this.printSSRCGroups(_a.ssrcGroups),kc+=this.printSSRC(_a.ssrcs),kc+=this.printRTCPMux(_a.rtcpMux),kc+=this.printRTCPMuxOnly(_a.rtcpMuxOnly),kc+=this.printRTCPRsize(_a.rtcpRsize),kc+=this.printMSId(_a.msids),kc+=this.printImageattr(_a.imageattr),kc+=this.printRid(_a.rids),kc+=this.printSimulcast(_a.simulcast),kc+=this.printSCTPPort(_a.sctpPort),kc+=this.printMaxMessageSize(_a.maxMessageSize),kc+=this.printUnrecognized(_a.unrecognized),kc}printCandidates(zt){return zt.map(_a=>"a=candidate:".concat(_a.foundation).concat(C).concat(_a.componentId).concat(C).concat(_a.transport).concat(C).concat(_a.priority).concat(C).concat(_a.connectionAddress).concat(C).concat(_a.port).concat(C,"typ").concat(C).concat(_a.type).concat(_a.relAddr?"".concat(C,"raddr").concat(C).concat(_a.relAddr):"").concat(_a.relPort?"".concat(C,"rport").concat(C).concat(_a.relPort):"").concat(Object.keys(_a.extension).map(kc=>"".concat(C).concat(kc).concat(C).concat(_a.extension[kc])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(zt){return zt.map(_a=>"a=remote-candidates:".concat(_a.join(C)).concat(this.eol)).join("")}printEndOfCandidates(zt){return zt===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(zt){if(!zt.payloads)return"";const _a=zt.payloads;let kc="";kc+=zt.rtcpFeedbackWildcards.map(m_=>this.printRTCPFeedback("*",m_)).join("");for(const m_ of _a)kc+=this.printRtpMap(m_.payloadType,m_.rtpMap),kc+=this.printFmtp(m_.payloadType,m_.fmtp),kc+=m_.rtcpFeedbacks.map(H_=>this.printRTCPFeedback(m_.payloadType,H_)).join("");return kc}printFmtp(zt,_a){if(!_a)return"";const kc=Object.keys(_a.parameters);return kc.length===1&&_a.parameters[kc[0]]===null?"a=fmtp:".concat(zt).concat(C).concat(kc[0]).concat(this.eol):"a=fmtp:".concat(zt).concat(C).concat(Object.keys(_a.parameters).map(m_=>"".concat(m_,"=").concat(_a.parameters[m_])).join(";")).concat(this.eol)}printRtpMap(zt,_a){return _a?"a=rtpmap:".concat(zt).concat(C).concat(_a.encodingName,"/").concat(_a.clockRate).concat(_a.encodingParameters?"/".concat(_a.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(zt,_a){let kc="a=rtcp-fb:".concat(zt).concat(C),m_=_a;return m_.type==="trr-int"?kc+="ttr-int".concat(C).concat(m_.interval):(kc+="".concat(m_.type),m_.parameter&&(kc+="".concat(C).concat(m_.parameter),m_.additional&&(kc+="".concat(C).concat(m_.additional)))),kc+this.eol}printPtime(zt){return zt===void 0?"":"a=ptime:".concat(zt).concat(this.eol)}printMaxPtime(zt){return zt===void 0?"":"a=maxptime:".concat(zt).concat(this.eol)}printDirection(zt){return zt===void 0?"":"a=".concat(zt).concat(this.eol)}printSSRC(zt){return zt.map(_a=>Object.keys(_a.attributes).map(kc=>"a=ssrc:".concat(_a.ssrcId.toString(10)).concat(C).concat(kc).concat(_a.attributes[kc]?":".concat(_a.attributes[kc]):"").concat(this.eol)).join("")).join("")}printRTCPMux(zt){return zt===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(zt){return zt===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(zt){return zt===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(zt){if(zt===void 0)return"";let _a="a=rtcp:".concat(zt.port);return zt.netType&&(_a+="".concat(C).concat(zt.netType)),zt.addressType&&(_a+="".concat(C).concat(zt.addressType)),zt.address&&(_a+="".concat(C).concat(zt.address)),_a+this.eol}printMSId(zt){return zt.map(_a=>"a=msid:".concat(_a.id).concat(_a.appdata?"".concat(C).concat(_a.appdata):"").concat(this.eol)).join("")}printImageattr(zt){return zt.map(_a=>"a=imageattr:".concat(_a).concat(this.eol)).join("")}printRid(zt){return zt.map(_a=>{let kc="a=rid:".concat(_a.id).concat(C).concat(_a.direction);return _a.payloads&&(kc+="".concat(C,"pt=").concat(_a.payloads.join(","))),_a.params.length>0&&(kc+="".concat(C).concat(_a.params.map(m_=>m_.type==="depend"?"depend=".concat(m_.rids.join(",")):"".concat(m_.type,"=").concat(m_.val)).join(";"))),kc+this.eol}).join("")}printSimulcast(zt){return zt===void 0?"":"a=simulcast:".concat(zt).concat(this.eol)}printSCTPPort(zt){return zt===void 0?"":"a=sctp-port:".concat(zt).concat(this.eol)}printMaxMessageSize(zt){return zt===void 0?"":"a=max-message-size:".concat(zt).concat(this.eol)}printMid(zt){return zt===void 0?"":"a=mid:".concat(zt).concat(this.eol)}printSSRCGroups(zt){return zt.map(_a=>"a=ssrc-group:".concat(_a.semantic).concat(_a.ssrcIds.map(kc=>"".concat(C).concat(kc.toString(10))).join("")).concat(this.eol)).join("")}}function __(c_){return new a_().parse(c_)}function N_(c_,zt){return new mE().print(c_,zt)}}},r={};function i(d){if(r[d])return r[d].exports;var h=r[d]={exports:{}};return e[d](h,h.exports,i),h.exports}return i.d=(d,h)=>{for(var f in h)i.o(h,f)&&!i.o(d,f)&&Object.defineProperty(d,f,{enumerable:!0,get:h[f]})},i.o=(d,h)=>Object.prototype.hasOwnProperty.call(d,h),i.r=d=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(d,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(d,"__esModule",{value:!0})},i(8)})();function $S(e){return B4.parse(e)}function C0(e,r){return B4.print(e,r)}var zdt=BT("Array","keys"),Ydt=_0,Jdt=DS,Xdt=_n,Qdt=zdt,lF=Array.prototype,Zdt={DOMTokenList:!0,NodeList:!0},$dt=function(e){var r=e.keys;return e===lF||Xdt(lF,e)&&r===lF.keys||Jdt(Zdt,Ydt(e))?Qdt:r},tT=_($dt);function zE(e,r,i){return(r=function(d){var h=function(f,g){if(typeof f!="object"||!f)return f;var b=f[Symbol.toPrimitive];if(b!==void 0){var C=b.call(f,"string");if(typeof C!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(f)}(d);return typeof h=="symbol"?h:h+""}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function G4(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function J_(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?G4(Object(i),!0).forEach(function(d){zE(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):G4(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}const q4=new class extends qE{constructor(){super(...arguments),zE(this,"currentUploadLogID",0)}reportLogUploadError(e){const{errorRange:r}=e;r[r.length-1]&&r[r.length-1]>this.currentUploadLogID&&(this.currentUploadLogID=r[r.length-1],this.emit("REPORT_LOG_UPLOAD",e))}};class tlt{constructor(r){zE(this,"logger",void 0),zE(this,"prefixLists",[]),this.logger=r}debug(){for(var r=arguments.length,i=new Array(r),d=0;d<r;d++)i[d]=arguments[d];this.logger.debug(...this.prefixLists,...i)}info(){for(var r=arguments.length,i=new Array(r),d=0;d<r;d++)i[d]=arguments[d];this.logger.info(...this.prefixLists,...i)}warning(){for(var r=arguments.length,i=new Array(r),d=0;d<r;d++)i[d]=arguments[d];this.logger.warning(...this.prefixLists,...i)}error(){for(var r=arguments.length,i=new Array(r),d=0;d<r;d++)i[d]=arguments[d];this.logger.error(...this.prefixLists,...i)}prefix(r){return this.prefixLists.push(r),this}popPrefix(){return this.prefixLists.pop(),this}}function hF(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function W4(){const e=new Date,r=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return r?(r==null?void 0:r[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const OT={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},PL=Date.now(),KN=e=>{for(const r in OT)if(Object.prototype.hasOwnProperty.call(OT,r)&&OT[r]===e)return r;return"DEFAULT"},Wt=new class{constructor(){zE(this,"proxyServerURL",void 0),zE(this,"logLevel",OT.DEBUG),zE(this,"uploadState","collecting"),zE(this,"uploadLogWaitingList",[]),zE(this,"uploadLogUploadingList",[]),zE(this,"uploadErrorCount",0),zE(this,"currentLogID",0),zE(this,"url",void 0),zE(this,"extLog",(e,r)=>{this.appendLogToWaitingList(e,...r)})}debug(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const d=[OT.DEBUG].concat(r);this.log.apply(this,d)}info(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const d=[OT.INFO].concat(r);this.log.apply(this,d)}warning(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const d=[OT.WARNING].concat(r);this.log.apply(this,d)}warn(){this.warning(...arguments)}error(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const d=[OT.ERROR].concat(r);this.log.apply(this,d)}upload(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];const d=[OT.DEBUG].concat(r);this.uploadLog.apply(this,d)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){SE("UPLOAD_LOG",!0)}disableLogUpload(){SE("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new tlt(this).prefix(e)}log(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-PL<100)return void setTimeout(()=>{this.log(...r)},Date.now()-PL);const d=Math.max(0,Math.min(4,r[0]));if(r[0]=hF()+" Agora-SDK [".concat(KN(d),"]:"),this.appendLogToWaitingList(d,...r),d<this.logLevel)return;const h=hF()+" %cAgora-SDK [".concat(KN(d),"]:");let f=[];if(!_s("USE_NEW_LOG"))switch(d){case OT.DEBUG:f=[h,"color: #64B5F6;"].concat(r.slice(1)),console.log.apply(console,f);break;case OT.INFO:f=[h,"color: #1E88E5; font-weight: bold;"].concat(r.slice(1)),console.log.apply(console,f);break;case OT.WARNING:f=[h,"color: #FB8C00; font-weight: bold;"].concat(r.slice(1)),console.warn.apply(console,f);break;case OT.ERROR:f=[h,"color: #B00020; font-weight: bold;"].concat(r.slice(1)),console.error.apply(console,f)}}uploadLog(){for(var e=arguments.length,r=new Array(e),i=0;i<e;i++)r[i]=arguments[i];if(Date.now()-PL<100)return void setTimeout(()=>{this.uploadLog(...r)},Date.now()-PL);const d=Math.max(0,Math.min(4,r[0]));r[0]=hF()+" Agora-SDK [".concat(KN(d),"]:"),this.appendLogToWaitingList(d,...r)}appendLogToWaitingList(e){if(!_s("UPLOAD_LOG"))return;for(var r=arguments.length,i=new Array(r>1?r-1:0),d=1;d<r;d++)i[d-1]=arguments[d];Array.isArray(i[0])?i[0][0]=W4()+" Agora-SDK [".concat(KN(e),"]:"):i[0]=W4()+" Agora-SDK [".concat(KN(e),"]:");let h="";i.forEach(f=>{typeof f=="object"&&(f=JSON.stringify(f)),h+="".concat(f," ")}),this.uploadLogWaitingList.push({payload_str:h,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,r={sdk_version:AT,process_id:_s("PROCESS_ID"),payload:JSON.stringify(e)};return ER(async()=>{const i=await zS.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(_s("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(_s("LOG_UPLOAD_SERVER"),"/upload/v1")),r,{responseType:"text"});if(i.data!=="OK"){const d=new Error("unexpected upload log response");throw d.response=i,d}},()=>(this.uploadLogUploadingList=[],!1),i=>{const d={status:-1,message:i.message,errorRange:e.map(h=>h.log_item_id)};return i.response?(d.status=i.response.status,d.data=i.response.data,d.headers=i.response.headers):i.request&&(d.status=i.request.status),q4.reportLogUploadError(d),!0},{timeout:_s("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:_s("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,_s("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),_s("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),_s("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),_s("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}};var K4;function elt(e){return fS(e.reportId,"params.reportId",0,100,!1),fS(e.category,"params.category",0,100,!1),fS(e.event,"params.event",0,100,!1),fS(e.label,"params.label",0,100,!1),IE(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}(K4={}).FREE="free",K4.UPLOADING="uploading",function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}({});const nlt={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let sS=function(e){return e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.XLA_PEER_FIRST_VIDEO_FRAME="xla_peer_first_video_frame",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats",e.UPDATE_REMOTE_RTPCAPABILITIES="update_remote_rtpCapabilities",e.AB_TEST="ab_test",e}({}),jE=function(e){return e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.XLA_PEER_FIRST_VIDEO_FRAME="io.agora.pb.Wrtc.XLAPeerFirstVideoFrame",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats",e.UPDATE_REMOTE_RTPCAPABILITIES="io.agora.pb.Wrtc.UpdateRemoteRTPCapabilities",e.AB_TEST="io.agora.pb.Wrtc.ABTest",e}({});(function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"})({});let rlt=function(e){return e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED",e}({});function V_(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(r,i,d){const h=d.value;if(typeof h=="function"){const f=e.className||r.__className__||(r.constructor.name==="AgoraRTCClient"?"Client":r.constructor.name);d.value=function(){for(var g,b=arguments.length,C=new Array(b),P=0;P<b;P++)C[P]=arguments[P];let x=C;if(e.argsMap)try{x=e.argsMap(this,...C)}catch($){Wt.warning($),x=[]}try{JSON.stringify(x)}catch{Wt.warning("arguments for method ".concat(f,".").concat(String(i)," not serializable for apiInvoke.")),x=[]}const H=(e.report||k_).reportApiInvoke(this._sessionId||null,{id:this._clientId||((g=this.store)===null||g===void 0?void 0:g.clientId)||this._ID,name:"".concat(f,".").concat(String(i)),options:x,tag:FE.TRACER,reportResult:e.reportResult},e.throttleTime);try{const $=h.apply(this,C);return $ instanceof T_?$.then(_t=>(H.onSuccess(e.reportResult&&_t),_t)).catch(_t=>{throw H.onError(_t),_t}):(H.onSuccess(e.reportResult&&$),$)}catch($){throw H.onError($),$}}}return d}}const k_=new class{constructor(){zE(this,"baseInfoMap",new Map),zE(this,"proxyServer",void 0),zE(this,"eventUploadTimer",void 0),zE(this,"setSessionIdTimer",void 0),zE(this,"url",void 0),zE(this,"sids",new Set),zE(this,"backupUrl",void 0),zE(this,"_appId",void 0),zE(this,"_aid",0),zE(this,"keyEventUploadPendingItems",[]),zE(this,"normalEventUploadPendingItems",[]),zE(this,"apiInvokeUploadPendingItems",[]),zE(this,"apiInvokeCount",0),zE(this,"apiInvokeLoggedCount",0),zE(this,"ltsList",[]),zE(this,"lastSendNormalEventTime",Date.now()),zE(this,"customReportCounterTimer",void 0),zE(this,"customReportCount",0),zE(this,"extApiInvoke",async e=>{for(const r of e){const i=J_(J_({},r),{},{sid:null,invokeId:++this.apiInvokeCount,tag:FE.TRACER});this.sendApiInvoke(i)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),_s("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),_s("EVENT_REPORT_SEND_INTERVAL"))}getBaseInfoBySessionId(e){return this.baseInfoMap.get(e)}setAppId(e){this._appId=e,this._aid=parseInt(e.replace(/[a-fA-F0-9]{8}/g,r=>{let[i,d]=r;return i+d}),16)||0}reportApiInvoke(e,r,i){r.timeout=r.timeout||6e4,r.reportResult=r.reportResult===void 0||r.reportResult;const d=Date.now();this.apiInvokeCount+=1;const h=this.apiInvokeCount,f=!!_s("SHOW_REPORT_INVOKER_LOG"),g=!!_s("SHOW_REPORT_USER_INVOKER_LOG"),b=f||g&&r.id;b&&(this.apiInvokeLoggedCount+=1);const C=this.apiInvokeLoggedCount;function P(_t,_i){if(b){let ue="[apiInvoke-".concat(C,"]");if(r.id&&(ue+="[".concat(r.id,"]")),r.name&&(ue+="[".concat(r.name,"]"),r.name===QE.JOIN))return Wt.info("".concat(ue," ").concat(_t));Wt.info("".concat(ue," ").concat(_t),_t==="start"?r.options:_i||"")}}const x=()=>({tag:r.tag,invokeId:h,sid:e,name:r.name,apiInvokeTime:d,options:r.options,states:r.states||null});P("start");let H=!1;mS(r.timeout).then(()=>{H||(this.sendApiInvoke(J_(J_({},x()),{},{error:Gi.API_INVOKE_TIMEOUT,success:!1})),P("timeout"))});const $=new n_(Gi.UNEXPECTED_ERROR,"".concat(r.name,": this api invoke is end"));return{onSuccess:_t=>{const _i=()=>{if(H)throw $;return H=!0,this.sendApiInvoke(J_(J_({},x()),{},{success:!0},r.reportResult&&{result:_t})),P("onSuccess"),_t};return i?R4(_i,r.name+"Success",i,()=>H=!0):_i()},onError:_t=>{const _i=()=>{if(H)throw _t;H=!0,this.sendApiInvoke(J_(J_({},x()),{},{success:!1,error:_t})),P("onFailure",_t.toString())};return i?R4(_i,r.name+"Error",i,()=>H=!0):_i()}}}sessionInit(e,r){if(this.baseInfoMap.has(e))return;const i=Date.now(),d=this.createBaseInfo(e,i);d.cname=r.cname;const h=Object.assign({},{willUploadConsoleLog:_s("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:aF?"global":"oversea",areas:_s("AREAS")&&_s("AREAS").join(",")},r.extend),{stringUid:f,channelProfile:g,channelMode:b,isABTestSuccess:C,lsid:P,clientRole:x}=r,H=Date.now(),$=J_(J_({},d),{},{eventType:sS.SESSION_INIT,appid:r.appid,browser:navigator.userAgent,buildFormat:r.buildFormat,build:uF,lts:H,elapse:H-i,extend:JSON.stringify(h),mode:r.mode,process:_s("PROCESS_ID"),appType:_s("APP_TYPE"),success:!0,version:AT,stringUid:f,channelProfile:g,channelMode:b,isABTestSuccess:C,lsid:P,clientType:E_(_t=window.navigator.userAgent).call(_t,"AgoraWebView")?42:20,clientRole:x,serviceId:_s("PROCESS_ID"),extensionID:_s("PLUGIN_INFO").join(",")||""});var _t;this.send({type:jE.SESSION,data:$},!0)}joinChooseServer(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_({},d),{},{role:r.role,eventType:sS.JOIN_CHOOSE_SERVER,lts:h,eventElapse:r.elapse||h-r.lts,chooseServerAddr:r.csAddr,errorCode:r.ec,elapse:h-i.startTime,success:r.succ,chooseServerAddrList:JSON.stringify(r.serverList),uid:r.uid?parseInt(r.uid):null,cid:r.cid?parseInt(r.cid):null,chooseServerIp:r.csIp||"",opid:r.opid,unilbsServerIds:r.unilbsServerIds,extend:r.extend||void 0,isHttp3:r.isHttp3,corssRegionTagReq:r.corssRegionTagReq||void 0,corssRegionTagRes:r.corssRegionTagRes||void 0,resourceTimingInfo:r.resourceTimingInfo||void 0});this.send({type:jE.JOIN_CHOOSE_SERVER,data:f},!0)}reqUserAccount(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_({},d),{},{eventType:sS.REQ_USER_ACCOUNT,lts:h,success:r.success,serverAddress:r.serverAddr,stringUid:r.stringUid,uid:r.uid,errorCode:r.errorCode,elapse:r.elapse||h-i.startTime,eventElapse:h-r.lts,extend:JSON.stringify(r.extend)});this.send({type:jE.REQ_USER_ACCOUNT,data:f},!0)}joinGateway(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info;r.vid&&(d.vid=r.vid),d.uid=r.uid,d.cid=r.cid;const h=Date.now(),{firstSuccess:f,addr:g,isProxy:b}=r,C=h-i.startTime,P=J_(J_({},d),{},{eventType:sS.JOIN_GATEWAY,lts:h,gatewayAddr:r.addr,success:r.succ,errorCode:r.ec,errorMsg:r.errorMsg||"",elapse:C,eventElapse:h-r.lts,firstSuccess:f,signalChannel:r.signalChannel,preload:r.preload?1:0,installId:sF(),isABTestSuccess:r.isABTestSuccess?1:0}),x=P.success?1:0;if(r.succ&&(i.lastJoinSuccessTime=h),f)this.send({type:jE.JOIN_GATEWAY,data:P},!0);else{let H;if(g)if(b){const _t=g.match(/h=(\d{1,3}-){3}\d{1,3}/g),_i=g.match(/p=[0-9]{1,6}/g);H={isSuccess:x,gatewayIp:_t&&_t.length?_t[0].split("=")[1].replace(/-/g,"."):"",port:_i&&_i.length?_i[0].split("=")[1]:"",isProxy:b?1:0}}else{const _t=g.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),_i=g.match(/(:|p=)[0-9]{1,6}/g);H={isSuccess:x,gatewayIp:_t&&_t.length?_t[0].split("//")[1].replace(/-/g,"."):"",port:_i&&_i.length?_i[0].split(/:|p=/g)[1]:"",isProxy:b?1:0}}else H={isSuccess:x,gatewayIp:"",port:"",isProxy:b?1:0};delete P.success,delete P.eventType,delete P.firstSuccess,P.vid=Number(P.vid);const $=Object.assign({},P,H,{eventType:sS.REJOIN_GATEWAY});this.send({type:jE.RE_JOIN_GATEWAY,data:$},!0)}}joinChannelTimeout(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=Date.now(),h=J_(J_({},i.info),{},{lts:d,timeout:r,elapse:d-i.startTime});this.send({type:jE.JOIN_CHANNEL_TIMEOUT,data:h},!0)}publish(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_({},d),{},{eventType:sS.PUBLISH,lts:h,eventElapse:r.eventElapse,elapse:h-i.startTime,success:r.succ,errorCode:r.ec,videoName:r.videoName,audioName:r.audioName,screenName:r.screenName,screenshare:r.screenshare,audio:r.audio,video:r.video,p2pid:r.p2pid,publishRequestid:r.publishRequestid});this.send({type:jE.PUBLISH,data:f},!0)}subscribe(e,r,i){const d=this.baseInfoMap.get(e);if(!d)return;const h=d.info,f=Date.now(),g=J_(J_({},h),{},{eventType:sS.SUBSCRIBE,lts:f,eventElapse:r.eventElapse,elapse:f-d.startTime,success:r.succ,errorCode:r.ec,video:r.video,audio:r.audio,subscribeRequestid:r.subscribeRequestid,p2pid:r.p2pid,preSsrc:r.preSsrc?1:0},i&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof r.peerid=="string"?g.peerSuid=r.peerid:g.peer=r.peerid,this.send({type:jE.SUBSCRIBE,data:g},!0)}wsCompressorInit(e){var r;const i=[...tT(r=this.baseInfoMap).call(r)],d=i.length?i[0]:"UnableToGetSid",h=this.baseInfoMap.get(d);if(!h)return;const f=h.info,g=Date.now(),b=J_(J_({},f),{},{eventType:sS.WS_COMPRESSOR_INIT,lts:g,eventElapse:e.eventElapse,elapse:g-h.startTime,status:e.status?1:2});this.send({type:jE.WS_COMPRESSOR_INIT,data:b},!0)}firstXLAPeerFirstVideoFrame(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=r.peerPubStatusMs-(i.lastJoinSuccessTime||h),g=J_(J_({},d),{},{elapse:h-i.startTime,eventType:sS.XLA_PEER_FIRST_VIDEO_FRAME,lts:h,peer:r.peer,width:r.width,height:r.height,ssrc:r.ssrc,p2pid:r.p2pid,peerPublishDuration:r.peerPublishDuration,joinChannelSuccessElapse:f,peerPubStatusMs:r.peerPubStatusMs-r.joinChannelStart,availablePublish:r.peerPublishDuration>f?1:0,preloadStart:Math.max(r.preloadStart-r.joinChannelStart,0),preloadEnd:Math.max(r.preloadEnd-r.joinChannelStart,0),encrypt:Math.max(r.apStart-r.joinChannelStart,0),ap:Math.max(r.apEnd-r.joinChannelStart,0),sua:Math.max(r.suaEnd-r.joinChannelStart,0),beforeConnect:Math.max(r.beforeConnect-r.joinChannelStart,0),peerRecevier:Math.max(r.peerReceiver-r.joinChannelStart,0),ice:Math.max(r.ice-r.joinChannelStart,0),pc:Math.max(r.pc-r.joinChannelStart,0),signalConnected:Math.max(r.signalConnected-r.joinChannelStart,0),joinReq:Math.max(r.joinReq-r.joinChannelStart,0),joinRes:Math.max(r.joinRes-r.joinChannelStart,0),userJoinNotify:Math.max(r.userJoinNotify-r.joinChannelStart,0),videoSsrcNotify:Math.max(r.videoAddNotify-r.joinChannelStart,0),subscribeDelayMs:Math.max(r.subscribeStart-r.videoAddNotify,0),subscribeStart:Math.max(r.subscribeStart-r.joinChannelStart,0),subscribeEnd:Math.max(r.subscribeEnd-r.joinChannelStart,0),firstReceived:Math.max(r.firstReceived-r.joinChannelStart,0),firstDecoded:Math.max(r.firstDecoded-r.joinChannelStart,0),firstPreRender:Math.max(r.firstPreRender-r.joinChannelStart,0),firstRender:Math.max(r.firstRender-r.joinChannelStart,0),playDelayMs:Math.max(r.playStart-r.subscribeEnd,0),playStart:Math.max(r.playStart-r.joinChannelStart,0),playEnd:Math.max(r.playEnd-r.joinChannelStart,0),isPreSub:r.isPreSub?1:0,isPrePc:r.isPrePc?1:0,isPreInstantVideo:r.isPreInstantVideo?1:0});this.send({type:jE.XLA_PEER_FIRST_VIDEO_FRAME,data:g},!0)}firstRemoteVideoDecode(e,r,i,d){const h=this.baseInfoMap.get(e);if(!h)return;const f=h.info,g=Date.now(),b=J_(J_(J_({},f),d),{},{elapse:g-h.startTime,eventType:r,lts:g,firstDecodeFrame:Math.max((d.firstFrame||g)-h.startTime,0),apEnd:Math.max(d.apEnd-h.startTime,0),apStart:Math.max(d.apStart-h.startTime,0),joinGwEnd:Math.max(d.joinGwEnd-h.startTime,0),joinGwStart:Math.max(d.joinGwStart-h.startTime,0),pcEnd:Math.max(d.pcEnd-h.startTime,0),pcStart:Math.max(d.pcStart-h.startTime,0),subscriberEnd:Math.max(d.subscriberEnd-h.startTime,0),subscriberStart:Math.max(d.subscriberStart-h.startTime,0),videoAddNotify:Math.max(d.videoAddNotify-h.startTime,0)});this.send({type:i,data:b},!0)}firstRemoteFrame(e,r,i,d){const h=this.baseInfoMap.get(e);if(!h)return;const f=h.info,g=Date.now(),b=J_(J_(J_({},f),d),{},{elapse:g-h.startTime,eventType:r,lts:g});this.send({type:i,data:b},!0)}abTest(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_(J_({},d),r),{},{vid:d.vid===void 0?0:Number(d.vid),elapse:h-i.startTime,eventType:sS.AB_TEST,lts:h});this.send({type:jE.AB_TEST,data:f},!0)}pcStats(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_(J_({},d),r),{},{vid:d.vid===void 0?0:Number(d.vid),elapse:h-i.startTime,eventType:sS.PC_STATS,lts:h,preallocation:r.preallocation?1:0});this.send({type:jE.PC_STATS,data:f},!0)}updateRemoteRTPCapabilities(e,r){if(e){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_(J_({},d),r),{},{vid:d.vid===void 0?0:Number(d.vid),eventType:sS.UPDATE_REMOTE_RTPCAPABILITIES,lts:h});this.send({type:jE.UPDATE_REMOTE_RTPCAPABILITIES,data:f},!0)}}onGatewayStream(e,r,i,d){const h=this.baseInfoMap.get(e);if(!h)return;const f=h.info,g=Date.now(),b=J_(J_(J_({},f),d),{},{eventType:r,lts:g});this.send({type:i,data:b},!0)}streamSwitch(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_({},d),{},{eventType:sS.STREAM_SWITCH,lts:h,isDual:r.isdual,elapse:h-i.startTime,success:r.succ});this.send({type:jE.STREAM_SWITCH,data:f},!0)}requestProxyAppCenter(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_({},d),{},{eventType:sS.REQUEST_PROXY_APPCENTER,lts:h,eventElapse:h-r.lts,elapse:h-i.startTime,APAddr:r.APAddr,workerManagerList:r.workerManagerList,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:jE.REQUEST_PROXY_APPCENTER,data:f},!0)}requestProxyWorkerManager(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_({},d),{},{eventType:sS.REQUEST_PROXY_WORKER_MANAGER,lts:h,eventElapse:h-r.lts,elapse:h-i.startTime,workerManagerAddr:r.workerManagerAddr,response:r.response,errorCode:r.ec,success:r.succ});this.send({type:jE.REQUEST_PROXY_WORKER_MANAGER,data:f},!0)}setProxyServer(e){this.proxyServer=e,e?Wt.debug("reportProxyServerurl: ".concat(e)):Wt.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_({},d),{},{subscribeElapse:r.subscribeElapse,peer:r.peer,peerPublishDuration:Math.max(r.audioPublishDuration,r.videoPublishDuration),audiotag:r.audioPublishDuration>0?1:-1,videotag:r.videoPublishDuration>0?1:-1,lts:h,elapse:h-i.startTime,joinChannelSuccessElapse:h-(i.lastJoinSuccessTime||h),peerPublishDurationVideo:r.videoPublishDuration,peerPublishDurationAudio:r.audioPublishDuration});this.send({type:jE.PEER_PUBLISH_STATUS,data:f},!0)}workerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now();(function(f,g,b){const C=f[g];if(!C||typeof C!="string")return[f];f[g]="";const P=MR(JSON.stringify(f));let x=0;const H=[];let $=0;for(let _t=0;_t<C.length;_t++)$+=C.charCodeAt(_t)<=127?1:3,$<=b-P||(H[H.length]=f_(f_({},f),{},{[g]:C.substring(x,_t)}),x=_t,$=C.charCodeAt(_t)<=127?1:3);return x!==C.length-1&&(H[H.length]=f_(f_({},f),{},{[g]:C.substring(x)})),H})(J_(J_(J_({},d),r),{},{elapse:h-i.startTime,lts:h,productType:"WebRTC"}),"payload",1300).forEach(f=>this.send({type:jE.WORKER_EVENT,data:f},!0))}apworkerEvent(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_(J_({},d),r),{},{elapse:h-i.startTime,lts:h});this.send({type:jE.AP_WORKER_EVENT,data:f},!0)}joinWebProxyAP(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_(J_({},d),r),{},{elapse:h-i.startTime,lts:h,extend:r.extend||void 0});this.send({type:jE.JOIN_WEB_PROXY_AP,data:f},!0)}WebSocketQuit(e,r){const i=this.baseInfoMap.get(e);if(!i)return;const d=i.info,h=Date.now(),f=J_(J_(J_({},d),r),{},{elapse:h-i.startTime,lts:h});this.send({type:jE.WEBSOCKET_QUIT,data:f},!0)}async sendCustomReportMessage(e,r){if(this.customReportCount+=r.length,this.customReportCount>_s("CUSTOM_REPORT_LIMIT"))throw new n_(Gi.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const i=Date.now(),d=r.map(h=>({type:jE.USER_ANALYTICS,data:J_(J_({sid:e},h),{},{lts:i})}));try{_s("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(d):await this.postDataToStatsCollector(d)}catch(h){throw Wt.error("send custom report message failed",h.toString()),new n_(Gi.CUSTOM_REPORT_SEND_FAILED,h.message)}}sendApiInvoke(e){const r=_s("NOT_REPORT_EVENT");if(e.tag&&E_(r)&&E_(r).call(r,e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const i=this.baseInfoMap.get(e.sid);if(!i)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:d,uid:h,cid:f}=i.info;let g;if(e.lts=e.lts||Date.now(),e.error)if(e.error instanceof n_){const{code:C,message:P}=e.error;g=C||P||e.error.toString()}else g=e.error.toString();const b={invokeId:e.invokeId,sid:e.sid,cname:d,cid:f,uid:h,lts:e.lts,success:e.success,elapse:e.lts-i.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?g:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:jE.API_INVOKE,data:b},!1),!0}addSid(e){this.sids.add(e)}removeSid(e){this.sids.delete(e)}appendSessionId(){const e=this.apiInvokeUploadPendingItems;if(e.length===0)return;const r=Array.from(this.sids).find(i=>i!==null);r&&e.forEach(i=>{i&&(i.sid=r,this.sendApiInvoke(Object.assign({},i)))}),e.length=0}send(e,r){if(r)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>_s("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,r){const i=[],d=[];for(;e.length;){const f=e.shift();i.length<20?i.push(f):d.push(f)}e.push(...d);for(const f of[...i]){var h;this.ltsList.indexOf(f.data.lts)!==-1?(f.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(f.data.lts)):(this.ltsList.push(f.data.lts),nI(h=this.ltsList).call(h,(g,b)=>g-b))}return r||(this.lastSendNormalEventTime=Date.now()),_s("ENABLE_EVENT_REPORT")&&i.length&&(_s("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(i):this.postDataToStatsCollector(i)).catch((f=>g=>{_s("EVENT_REPORT_RETRY")&&(r?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(f):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(f),this.normalEventUploadPendingItems.length>_s("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-_s("NORMAL_EVENT_QUEUE_CAPACITY")),Wt.warning("report: drop normal events"))))})(i)),e}async postDataToStatsCollector2(e){Fg.networkState===uT.OFFLINE&&await T_.race([Fg.onlineWaiter,mS(2*Mb.maxRetryTimeout)]);const r=h=>{let f=new Uint8Array;return h.forEach(g=>{const b=XV(JSON.stringify(g.data)),C=new ArrayBuffer(5),P=(H=>{let $=0;return Object.entries(jE).forEach(_t=>{let[_i,ue]=_t;ue===H.type&&($=rlt[_i])}),$})(g),x=new DataView(C);x.setUint16(0,b.byteLength,!0),x.setUint8(2,255&P),x.setUint8(3,P>>>8&255),x.setUint8(4,P>>>16&255),f=m4(f,new Uint8Array(C)),f=m4(f,b)}),f},i="event";let d=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_s("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(i):"https://".concat(_s("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(i);for(let h=0;h<2;h+=1){h===1&&(d=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_s("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(i):"https://".concat(_s("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(i));try{await eF(d,{timeout:1e4,data:r(e),headers:J_(J_({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(f){if(h===1)throw f;continue}return}}async postDataToStatsCollector(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=(b=>{const C=b&&b.data.sid&&this.baseInfoMap.get(b.data.sid);return C&&C.info.vid&&+C.info.vid||0})(e[0]),d=i?void 0:this._aid,h={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(b=>JSON.stringify(b)),vid:i,aid:d};Fg.networkState===uT.OFFLINE&&await T_.race([Fg.onlineWaiter,mS(2*Mb.maxRetryTimeout)]);const f=r?"/events/proto-raws":"/events/messages";let g=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_s("EVENT_REPORT_DOMAIN"),"&p=").concat(_s("STATS_COLLECTOR_PORT"),"&d=").concat(f):"https://".concat(_s("EVENT_REPORT_DOMAIN"),":").concat(_s("STATS_COLLECTOR_PORT")).concat(f));for(let b=0;b<2;b+=1){b===1&&(g=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(_s("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(_s("STATS_COLLECTOR_PORT"),"&d=").concat(f):"https://".concat(_s("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(_s("STATS_COLLECTOR_PORT")).concat(f)));try{r?await Gdt(g,{timeout:1e4,data:h}):await eF(g,{timeout:1e4,data:h})}catch(C){if(b===1)throw C;continue}return}}createBaseInfo(e,r){const i=Object.assign({},nlt);return i.sid=e,this.baseInfoMap.set(e,{info:i,startTime:r}),i}reportResourceTiming(e,r){const i=performance.getEntriesByName(e),d=i[i.length-1];d&&this.reportApiInvoke(r,{name:"Client.resourceTiming",options:d,tag:FE.TRACER}).onSuccess()}};q4.on("REPORT_LOG_UPLOAD",e=>{e.networkState=Fg.networkState,k_.reportApiInvoke(null,{name:"logUploadError",options:e,tag:FE.TRACER}).onSuccess("logUploadError")});class t_ extends n_{constructor(r){super(r,arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",arguments.length>2?arguments[2]:void 0),zE(this,"name","AgoraRTCException")}print(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return super.print(r,Wt)}throw(){super.throw(Wt)}}const _S={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1,supportWebRTCInsertableStream:!1,supportRequestVideoFrameCallback:!1,supportWebCrypto:!1};function uE(){return _S}function H4(){return"setSinkId"in HTMLAudioElement.prototype&&(!_s("RESTRICTION_SET_PLAYBACK_DEVICE")||(e0()||r4())&&!zV())}function DL(){return!_S.supportUnifiedPlan||_s("CHROME_FORCE_PLAN_B")&&n0()}function pF(e){return!(KE()||i4(87)||DL()||!_s("ENABLE_PRE_SUB")&&(e==null||!e.autoSubscribe||_s("FORCE_DISABLE_AUTO_SUB")))}function z4(e){return!!_s("ENABLE_INSTANT_VIDEO")||!(e==null||!e.autoSubscribe||_s("FORCE_DISABLE_AUTO_SUB"))}let ES=function(e){return e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change",e}({});function yO(e,r,i){return{sampleRate:e,stereo:r,bitrate:i}}function dE(e,r,i,d,h){return{width:e,height:r,frameRate:i,bitrateMin:d,bitrateMax:h}}function QT(e,r,i,d,h){return{width:{max:e},height:{max:r},frameRate:i,bitrateMin:d,bitrateMax:h}}function fF(e,r){return{numSpatialLayers:e,numTemporalLayers:r}}const ilt={"90p":dE(160,90),"90p_1":dE(160,90),"120p":dE(160,120,15,30,65),"120p_1":dE(160,120,15,30,65),"120p_3":dE(120,120,15,30,50),"120p_4":dE(212,120),"180p":dE(320,180,15,30,140),"180p_1":dE(320,180,15,30,140),"180p_3":dE(180,180,15,30,100),"180p_4":dE(240,180,15,30,120),"240p":dE(320,240,15,40,200),"240p_1":dE(320,240,15,40,200),"240p_3":dE(240,240,15,40,140),"240p_4":dE(424,240,15,40,220),"360p":dE(640,360,15,80,400),"360p_1":dE(640,360,15,80,400),"360p_3":dE(360,360,15,80,260),"360p_4":dE(640,360,30,80,600),"360p_6":dE(360,360,30,80,400),"360p_7":dE(480,360,15,80,320),"360p_8":dE(480,360,30,80,490),"360p_9":dE(640,360,15,80,800),"360p_10":dE(640,360,24,80,800),"360p_11":dE(640,360,24,80,1e3),"480p":dE(640,480,15,100,500),"480p_1":dE(640,480,15,100,500),"480p_2":dE(640,480,30,100,1e3),"480p_3":dE(480,480,15,100,400),"480p_4":dE(640,480,30,100,750),"480p_6":dE(480,480,30,100,600),"480p_8":dE(848,480,15,100,610),"480p_9":dE(848,480,30,100,930),"480p_10":dE(640,480,10,100,400),"720p":dE(1280,720,15,120,1130),"720p_auto":dE(1280,720,30,900,3e3),"720p_1":dE(1280,720,15,120,1130),"720p_2":dE(1280,720,30,120,2e3),"720p_3":dE(1280,720,30,120,1710),"720p_5":dE(960,720,15,120,910),"720p_6":dE(960,720,30,120,1380),"1080p":dE(1920,1080,15,120,2080),"1080p_1":dE(1920,1080,15,120,2080),"1080p_2":dE(1920,1080,30,120,3e3),"1080p_3":dE(1920,1080,30,120,3150),"1080p_5":dE(1920,1080,60,120,4780),"1440p":dE(2560,1440,30,120,4850),"1440p_1":dE(2560,1440,30,120,4850),"1440p_2":dE(2560,1440,60,120,7350),"4k":dE(3840,2160,30,120,8910),"4k_1":dE(3840,2160,30,120,8910),"4k_3":dE(3840,2160,60,120,13500)},olt={"480p":QT(640,480,5),"480p_1":QT(640,480,5),"480p_2":QT(640,480,30),"480p_3":QT(640,480,15),"720p":QT(1280,720,5),"720p_auto":dE(1280,720,30,900,3e3),"720p_1":QT(1280,720,5),"720p_2":QT(1280,720,30),"720p_3":QT(1280,720,15),"1080p":QT(1920,1080,5),"1080p_1":QT(1920,1080,5),"1080p_2":QT(1920,1080,30),"1080p_3":QT(1920,1080,15)},slt={"1SL1TL":fF(1,1),"3SL3TL":fF(3,3),"2SL3TL":fF(2,3)};function ZT(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},ilt[e]):e}function mF(e){return typeof e=="string"?Object.assign({},olt[e]):e}function kL(e){return typeof e=="string"?Object.assign({},slt[e]):e}const alt={speech_low_quality:yO(16e3,!1),speech_standard:yO(32e3,!1,18),music_standard:yO(48e3,!1),standard_stereo:yO(48e3,!0,56),high_quality:yO(48e3,!1,128),high_quality_stereo:yO(48e3,!0,192)};function LL(e){return typeof e=="string"?Object.assign({},alt[e]):e}const SO=[];function Y4(e){return oS(e,"mediaSource",["screen","window","application"]),!0}let P_=function(e){return e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_REPLACE_MIXING_TRACK="@need_replace_mixing_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_RTC_STATS="@get_rtc_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_UPDATE_VIDEO_SEND_PARAMETERS="@need_update_video_send_parameters",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track",e}({}),wE=function(e){return e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream",e.SCREEN_LOW_TRACK="screen_low_track",e}({}),TO=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e}({}),clt=function(e){return e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.HIGH_STREAM_LAYER1=4]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=5]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=6]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=7]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=8]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=9]="HIGH_STREAM_LAYER6",e}({}),ult=function(e){return e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY",e[e.HIGH_STREAM_LAYER1=3]="HIGH_STREAM_LAYER1",e[e.HIGH_STREAM_LAYER2=4]="HIGH_STREAM_LAYER2",e[e.HIGH_STREAM_LAYER3=5]="HIGH_STREAM_LAYER3",e[e.HIGH_STREAM_LAYER4=6]="HIGH_STREAM_LAYER4",e[e.HIGH_STREAM_LAYER5=7]="HIGH_STREAM_LAYER5",e[e.HIGH_STREAM_LAYER6=8]="HIGH_STREAM_LAYER6",e}({}),mI=function(e){return e.TRANSCEIVER_UPDATED="transceiver-updated",e.SEI_TO_SEND="sei-to-send",e.SEI_RECEIVED="sei-received",e.TRACK_UPDATED="track-updated",e}({}),RO=function(e){return e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed",e}({}),NT=function(e){return e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.VIDEO_STATE_CHANGED="video-state-changed",e.PLAY_START="play-start",e.PLAY_END="play-end",e.FIRST_FRAME_RENDER="first-frame-render",e}({}),IO=function(e){return e.AUDIO="audio",e.VIDEO="video",e.DATA="data",e}({}),ET=function(e){return e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source",e}({});(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})({});const _F={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,currentPacketLossRate:0},EF={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendJitterMs:0,sendRttMs:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},J4={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receivePacketsDiscarded:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},dlt={uplinkNetworkQuality:0,downlinkNetworkQuality:0},X4={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let BS=function(e){return e.ON_TRACK="on_track",e.ON_NODE="on_node",e}({}),gT=function(e){return e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints",e}({}),HN=function(e){return e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND",e}({}),_I=function(e){return e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged",e}({}),CS=function(e){return e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata",e}({}),UR=function(e){return e[e.VideoStateStopped=0]="VideoStateStopped",e[e.VideoStateStarting=1]="VideoStateStarting",e[e.VideoStateDecoding=2]="VideoStateDecoding",e[e.VideoStateFrozen=3]="VideoStateFrozen",e}({});const gF={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};let ML=function(e){return e.OPEN="open",e.MESSAGE="message",e.CLOSE="close",e.CLOSING="closing",e.ERROR="error",e}({});function iE(e,r,i,d,h){var f,g,b={};return Object.keys(d).forEach(function(C){b[C]=d[C]}),b.enumerable=!!b.enumerable,b.configurable=!!b.configurable,("value"in b||b.initializer)&&(b.writable=!0),b=GT(f=x6(g=i.slice()).call(g)).call(f,function(C,P){return P(e,r,C)||C},b),h&&b.initializer!==void 0&&(b.value=b.initializer?b.initializer.call(h):void 0,b.initializer=void 0),b.initializer===void 0?(Object.defineProperty(e,r,b),null):b}function Qm(e,r,i){return(r=function(d){var h=function(f,g){if(typeof f!="object"||!f)return f;var b=f[Symbol.toPrimitive];if(b!==void 0){var C=b.call(f,"string");if(typeof C!="object")return C;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(f)}(d);return typeof h=="symbol"?h:h+""}(r))in e?Object.defineProperty(e,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[r]=i,e}function Q4(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function DE(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?Q4(Object(i),!0).forEach(function(d){Qm(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):Q4(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}class Z4 extends qE{set _mediaStreamTrack(r){r!==this.mediaStreamTrack&&(this.safeEmit(mI.TRACK_UPDATED,r),this.mediaStreamTrack=r)}get _mediaStreamTrack(){return this.mediaStreamTrack}constructor(r,i){super(),Qm(this,"trackMediaType",void 0),Qm(this,"_ID",void 0),Qm(this,"_rtpTransceiver",void 0),Qm(this,"_lowRtpTransceiver",void 0),Qm(this,"_hints",[]),Qm(this,"_isClosed",!1),Qm(this,"_originMediaStreamTrack",void 0),Qm(this,"mediaStreamTrack",void 0),Qm(this,"_external",{}),this._ID=i||AE(8,"track-"),this._originMediaStreamTrack=r,this.mediaStreamTrack=r,function(d){E_(SO).call(SO,d)||SO.push(d)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(r){return r||I0(()=>{var i;k_.reportApiInvoke(null,{name:QE.GET_MEDIA_STREAM_TRACK,options:[],tag:FE.TRACER}).onSuccess(((i=this._mediaStreamTrack)===null||i===void 0?void 0:i.label)||"")},this.mediaStreamTrack.id||this.getTrackId()),this._mediaStreamTrack}getRTCRtpTransceiver(r){return r===TO.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(r){const i=SO.indexOf(r);i!==-1&&SO.splice(i,1)}(this),this.emit(RO.CLOSED),this.removeAllListeners(mI.SEI_RECEIVED)}_updateRtpTransceiver(r,i){if(i===TO.LOW_STREAM){if(this._lowRtpTransceiver===r)return;this._lowRtpTransceiver=r}else{if(this._rtpTransceiver===r)return;this._rtpTransceiver=r}this.emit(mI.TRANSCEIVER_UPDATED,r,i)}}class wO extends Z4{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}constructor(r,i){super(r,i),Qm(this,"_enabled",!0),Qm(this,"_muted",!1),Qm(this,"_isExternalTrack",!1),Qm(this,"_isClosed",!1),Qm(this,"_enabledMutex",void 0),Qm(this,"processor",void 0),Qm(this,"_processorContext",void 0),Qm(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new wS("".concat(this.getTrackId())),r.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var r,i;return(r=(i=this._originMediaStreamTrack)===null||i===void 0?void 0:i.label)!==null&&r!==void 0?r:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,Wt.debug("[".concat(this.getTrackId(),"] close")),this.emit(P_.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(r,i){let d=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=d,r!==this._originMediaStreamTrack&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),i&&this._originMediaStreamTrack.stop()),r.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=r,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await CE(this,P_.NEED_REPLACE_TRACK,this),this.processor&&this._processorContext&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this._processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){Wt.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(RO.TRACK_ENDED)}stateCheck(r,i){if(Wt.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(r,": ").concat(i,"]")),_R(i,r),this._enabled&&this._muted&&r==="enabled"&&i===!1)throw new n_(Gi.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print("error",Wt);if(!this._enabled&&!this._muted&&r==="muted"&&i===!0)throw new n_(Gi.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print("error",Wt)}getProcessorStats(){return this._processorContext&&this._processorContext.gatherStats()||[]}getProcessorUsage(){return this._processorContext?this._processorContext.gatherUsage():T_.resolve([])}}const $4=window.AudioContext||window.webkitAudioContext;let vT=null;const TE=new class extends qE{constructor(){super(...arguments),Qm(this,"prevState",void 0),Qm(this,"curState",void 0),Qm(this,"currentTime",void 0),Qm(this,"currentTimeStuckAt",void 0),Qm(this,"interruptDetectorTrack",void 0),Qm(this,"onLocalAudioTrackMute",()=>{Wt.info("ios15-interruption-start"),this.emit(ES.IOS_15_16_INTERRUPTION_START)}),Qm(this,"onLocalAudioTrackUnmute",async()=>{Wt.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?Wt.info("ios15-interruption-end-canceled"):(vT&&await vT.suspend(),this.emit(ES.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){Wt.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){Wt.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function CO(){if(!vT){if(function(){if(!$4)return void Wt.error("your browser is not support web audio");Wt.info("create audio context");const e=DE({},_s("WEBAUDIO_INIT_OPTIONS"));Wt.debug("audio context init option:",JSON.stringify(e)),vT=new $4(e),TE.curState=vT.state,vT.onstatechange=()=>{TE.prevState=TE.curState,TE.curState=vT?vT.state:void 0;const{prevState:r,curState:i}=TE,d=i==="running",h=i==="interrupted",f=r==="running",g=r==="suspended",b=r==="interrupted",C=oE().osVersion;(LS()||JT())&&f&&h&&(Wt.info("ios".concat(C,"-interruption-start")),TE.emit(ES.IOS_INTERRUPTION_START)),(LS()||JT())&&(g||b)&&d&&(Wt.info("ios".concat(C,"-interruption-end")),TE.emit(ES.IOS_INTERRUPTION_END)),r!==i&&TE.emit(ES.STATE_CHANGE,i,r)},setInterval(()=>{var r;const i=(r=vT)===null||r===void 0?void 0:r.currentTime;TE.currentTime!==i?(TE.currentTimeStuckAt&&(Wt.debug("AudioContext current time resume at ".concat(i)),TE.currentTimeStuckAt=void 0),TE.currentTime=i):(i!==TE.currentTimeStuckAt&&(k_.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:i},tag:FE.TRACER}).onSuccess(),Wt.warning("AudioContext current time stuck at ".concat(i))),TE.currentTimeStuckAt=i)},5e3),async function(r){const i=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let d,h=!1,f=!1,g=!1;function b(ue){r.state==="running"?C(!1):LS()||JT()?r.state==="suspended"&&(C(!0),ue&&r.resume().then(P,P)):r.state!=="closed"&&(C(!0),ue&&r.resume().then(P,P))}function C(ue){if(h!==ue){h=ue;for(let _r=0,Fi=i;_r<Fi.length;_r+=1){const Di=Fi[_r];ue?window.addEventListener(Di,x,{capture:!0,passive:!0}):window.removeEventListener(Di,x,{capture:!0,passive:!0})}}}function P(){b(!1)}function x(){b(!0)}function H(ue){if(!g)if(d.paused)if(ue){let _r;$(!1),g=!0;try{_r=d.play(),_r?_r.then(_t,_t):(d.addEventListener("playing",_t),d.addEventListener("abort",_t),d.addEventListener("error",_t))}catch{_t()}}else $(!0);else $(!1)}function $(ue){if(f!==ue){f=ue;for(let _r=0,Fi=i;_r<Fi.length;_r++){const Di=Fi[_r];ue?window.addEventListener(Di,_i,{capture:!0,passive:!0}):window.removeEventListener(Di,_i,{capture:!0,passive:!0})}}}function _t(){d.removeEventListener("playing",_t),d.removeEventListener("abort",_t),d.removeEventListener("error",_t),g=!1,H(!1)}function _i(){H(!0)}if(LS()){const ue=r.createMediaStreamDestination(),_r=document.createElement("div");_r.innerHTML="<audio x-webkit-airplay='deny'></audio>",d=_r.children.item(0),d.controls=!1,d.disableRemotePlayback=!0,d.preload="auto",d.srcObject=ue.stream,H(!0)}TE.on(ES.STATE_CHANGE,function(){b(!0)}),b(!1)}(vT)}(),!vT)throw new n_(Gi.NOT_SUPPORTED,"can not create audio context");return vT}return vT}function EI(e){if(function(){if(vF!==null)return vF;const d=CO(),h=d.createBufferSource(),f=d.createGain(),g=d.createGain();h.connect(f),h.connect(g),h.disconnect(f);let b=!1;try{h.disconnect(f)}catch{b=!0}return h.disconnect(),vF=b,b}())return;const r=e.connect,i=e.disconnect;e.connect=(d,h,f)=>{var g;return e._inputNodes||(e._inputNodes=[]),E_(g=e._inputNodes).call(g,d)||(d instanceof AudioNode?(e._inputNodes.push(d),r.call(e,d,h,f)):r.call(e,d,h)),e},e.disconnect=(d,h,f)=>{i.call(e),d?RL(e._inputNodes,d):e._inputNodes=[];for(const g of e._inputNodes)r.call(e,g)}}let vF=null;function bF(e,r){let i=!1;const d=1/r;if(_s("DISABLE_WEBAUDIO")){const h=window.setInterval(()=>{i?window.clearInterval(h):e(performance.now()/1e3)},1e3*d)}else{const h=CO();let f=h.createGain();f.gain.value=0,f.connect(h.destination);const g=()=>{if(i)return void(f=null);const b=h.createOscillator();b.onended=g,b.connect(f),b.start(0),b.stop(h.currentTime+d),e(h.currentTime)};g()}return()=>{i=!0}}class t9{constructor(){Qm(this,"context",void 0),Qm(this,"analyserNode",void 0),Qm(this,"sourceNode",void 0),this.context=CO(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(r){if(r!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=r,r==null||r.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||LS()||JT()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const r=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(r);else{const d=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(d);for(let h=0;h<r.length;++h)r[h]=d[h]/128-1}const i=GT(r).call(r,(d,h)=>d+h*h,0)/r.length;return Math.max(10*Math.log10(i)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var r,i;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(i=this.sourceNode)===null||i===void 0||i.connect(this.analyserNode)}catch{Wt.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class e9 extends qE{get processSourceNode(){return this.sourceNode}set processedNode(r){var i;if(!this.isDestroyed&&this._processedNode!==r){try{var d;(d=this.sourceNode)===null||d===void 0||d.disconnect(this.outputNode)}catch{}(i=this._processedNode)===null||i===void 0||i.disconnect(),this._processedNode=r,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),Qm(this,"outputNode",void 0),Qm(this,"outputTrack",void 0),Qm(this,"isPlayed",!1),Qm(this,"sourceNode",void 0),Qm(this,"context",void 0),Qm(this,"audioBufferNode",void 0),Qm(this,"destNode",void 0),Qm(this,"audioOutputLevel",0),Qm(this,"volumeLevelAnalyser",void 0),Qm(this,"_processedNode",void 0),Qm(this,"playNode",void 0),Qm(this,"isDestroyed",!1),Qm(this,"onNoAudioInput",void 0),Qm(this,"isNoAudioInput",!1),Qm(this,"_noAudioInputCount",0),this.context=CO(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),EI(this.outputNode),this.volumeLevelAnalyser=new t9}startGetAudioBuffer(r){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(r),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=i=>{this.emit(ET.ON_AUDIO_BUFFER,function(d){for(let h=0;h<d.outputBuffer.numberOfChannels;h+=1){const f=d.outputBuffer.getChannelData(h);for(let g=0;g<f.length;g+=1)f[g]=0}return d.inputBuffer}(i))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!uE().webAudioMediaStreamDest)throw new n_(Gi.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(r){this.context.state!=="running"&&IL(()=>{TE.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=r||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(r>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;LS()||JT()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const i=this.volumeLevelAnalyser.getAnalyserNode();let d;i.getFloatTimeDomainData?(d=new Float32Array(i.fftSize),i.getFloatTimeDomainData(d)):(d=new Uint8Array(i.fftSize),i.getByteTimeDomainData(d));let h=!1;for(let f=0;f<d.length;f++)d[f]!==0&&(h=!0);return h?(this.isNoAudioInput=!1,!0):(await mS(200),await this.checkHasAudioInput(r?r+1:1)&&h)}getAudioVolume(){return this.outputNode.gain.value}setVolume(r){this.outputNode.gain.setValueAtTime(r,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var r,i;(r=this.processedNode)===null||r===void 0||r.disconnect(),(i=this.sourceNode)===null||i===void 0||i.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var r;this.processedNode?(r=this.processedNode)===null||r===void 0||r.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class n9 extends e9{get isFreeze(){return!1}constructor(r,i,d){var h;if(super(),Qm(this,"sourceNode",void 0),Qm(this,"track",void 0),Qm(this,"clonedTrack",void 0),Qm(this,"audioElement",void 0),Qm(this,"isCurrentTrackCloned",!1),Qm(this,"isRemoteTrack",!1),Qm(this,"originVolumeLevelAnalyser",void 0),Qm(this,"rebuildWebAudio",async()=>{if(Wt.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void Wt.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>Wt.info("resume success")),Wt.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const b=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?b.stop():this.isCurrentTrackCloned=!0;const C=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(C),EI(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const P=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(P,this.context.currentTime),EI(this.outputNode),this.emit(ET.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=C,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),r.kind!=="audio")throw new n_(Gi.UNEXPECTED_ERROR);this.track=r;const f=new MediaStream([this.track]);if(this.isRemoteTrack=!!i,this.sourceNode=this.context.createMediaStreamSource(f),EI(this.sourceNode),d){const b=d.clone();b.enabled=!0,this.clonedTrack=b,Wt.debug("create an unmuted track ".concat(b.id," from the original track ").concat(d.id," to get the volume"));const C=this.context.createMediaStreamSource(new MediaStream([b]));EI(C),this.originVolumeLevelAnalyser=new t9,this.originVolumeLevelAnalyser.updateSource(C)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=f;const g=oE();i&&g.os===aS.IOS&&Number((h=g.osVersion)===null||h===void 0?void 0:h.split(".")[0])<15&&(TE.on(ES.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(b=>{b||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(r){this.sourceNode.disconnect(),this.track=r,this.isCurrentTrackCloned=!1;const i=new MediaStream([r]);this.sourceNode=this.context.createMediaStreamSource(i),EI(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(ET.UPDATE_SOURCE),this.audioElement.srcObject=i}destroy(){var r;this.audioElement.srcObject=null,this.audioElement.remove(),TE.off("state-change",this.rebuildWebAudio),(r=this.originVolumeLevelAnalyser)===null||r===void 0||r.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(r){return this.context.createMediaStreamSource(new MediaStream([r]))}updateOriginTrack(r){const i=r.clone();i.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=i),Wt.debug("create an unmuted track ".concat(i.id," from the original track ").concat(r.id," to get the volume"));const d=this.context.createMediaStreamSource(new MediaStream([i]));EI(d),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(d)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function r9(e,r,i){const d=(f,g)=>f?typeof f!="number"?f.max||f.exact||f.ideal||f.min||g:f:g,h={audio:!!i&&{mandatory:{chromeMediaSource:"desktop"}},video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:d(r.height,1080),maxWidth:d(r.width,1920)}}};return r.frameRate&&typeof r.frameRate!="number"?(h.video.mandatory.maxFrameRate=r.frameRate.max,h.video.mandatory.minFrameRate=r.frameRate.min):typeof r.frameRate=="number"&&(h.video.mandatory.maxFrameRate=r.frameRate),await navigator.mediaDevices.getUserMedia(h)}async function llt(e,r){const i=await i9(e.mediaSource),{sourceId:d,audio:h}=await function(f){let g=arguments.length>1&&arguments[1]!==void 0&&arguments[1];return new T_((b,C)=>{const P=document.createElement("div");P.innerText="share screen",P.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const x=document.createElement("div");x.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const H=document.createElement("div");H.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",H.setAttribute("style","height: 12%;");const $=document.createElement("div");$.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const _t=document.createElement("div");_t.setAttribute("style","display: flex; justify-content: space-between; padding: 16px 0;");const _i=document.createElement("button");_i.innerHTML="cancel",_i.setAttribute("style","width: 85px;"),_i.onclick=()=>{document.body.removeChild(Fi);const Di=new Error("NotAllowedError");Di.name="NotAllowedError",C(Di)};let ue=g;const _r=document.createElement("div");if(g){const Di=document.createElement("input");Di.setAttribute("type","checkbox");const Js=document.createElement("span");Di.setAttribute("style","margin-right: 6px;"),Js.innerText="Share audio",Di.checked=ue,Di.onchange=()=>{ue=Di.checked},_r.appendChild(Di),_r.appendChild(Js)}_t.appendChild(_r),_t.appendChild(_i),x.appendChild(H),x.appendChild($),x.appendChild(_t);const Fi=document.createElement("div");Fi.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),Fi.appendChild(P),Fi.appendChild(x),document.body.appendChild(Fi),f.map(Di=>{if(Di.id){const Js=document.createElement("div");Js.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let _l=Di.thumbnail;try{const{width:_u}=_l.getSize();_u>1920&&(_l=_l.resize({width:1920}))}catch(_u){throw _u&&_u.message.startsWith("Illegal invocation")&&console.error("Operate thumbnail error, please try to set contextIsolation: false. (https://github.com/electron/electron/issues/34953)"),_u}Js.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+_l.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+Di.name.replace(/[\u00A0-\u9999<>\&]/g,function(_u){return"&#"+_u.charCodeAt(0)+";"})+"</span>",Js.onclick=()=>{document.body.removeChild(Fi),b({sourceId:Di.id,audio:ue})},$.appendChild(Js)}})})}(i,r);return await r9(d,e,h)}async function i9(e){let r=["window","screen"];e!=="application"&&e!=="window"||(r=["window"]),e==="screen"&&(r=["screen"]);const i=_4();if(!i)throw console.error("failed to fetch electron, please mount it to window"),new n_(Gi.ELECTRON_IS_NULL);let d=null;try{var h;d=((h=i.desktopCapturer)===null||h===void 0?void 0:h.getSources({types:r}))||i.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:r})}catch{d=null}d&&d.then||(d=new T_((f,g)=>{i.desktopCapturer.getSources({types:r},(b,C)=>{b?g(b):f(C)})}));try{return await d}catch(f){throw new n_(Gi.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,f.toString())}}const yF=new wS("safari");let o9=!1,s9=!1;async function bT(e,r){let i=0,d=null;for(;i<2;)try{d=await hlt(e,r,i>0);break}catch(h){if(h instanceof n_)throw Wt.error("[".concat(r,"] ").concat(h.toString())),h;const f=xL(h.name||h.code||h,h.message);if(f.code===Gi.MEDIA_OPTION_INVALID){Wt.debug("[".concat(r,"] detect media option invalid, retry")),i+=1,await mS(500);continue}throw Wt.error("[".concat(r,"] ").concat(f.toString())),f}if(!d)throw new n_(Gi.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return d}async function hlt(e,r,i){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new n_(Gi.NOT_SUPPORTED,"can not find getUserMedia");i&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const d=uE(),h=new MediaStream;if(e.audioSource&&h.addTrack(e.audioSource),e.videoSource&&h.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return Wt.debug("Using Video Source/ Audio Source"),h;if(e.screen)if(_4())e.screen.sourceId?AO(h,await r9(e.screen.sourceId,e.screen,!!e.screenAudio)):AO(h,await llt(e.screen,!!e.screenAudio));else if(e0()&&e.screen.extensionId&&e.screen.mandatory){if(!d.getStreamFromExtension)throw new n_(Gi.NOT_SUPPORTED,"This browser does not support screen sharing");Wt.debug("[".concat(r,'] Screen access on chrome stable, looking for extension"'));const $=await(g=e.screen.extensionId,b=r,new T_((_t,_i)=>{try{chrome.runtime.sendMessage(g,{getStream:!0},ue=>{if(!ue||!ue.streamId)return Wt.error("[".concat(b,"] No response from Chrome Plugin. Plugin not installed properly"),ue),void _i(new n_(Gi.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));_t(ue.streamId)})}catch(ue){Wt.error("[".concat(b,"] AgoraRTC screensharing plugin is not accessible(").concat(g,")"),ue.toString()),_i(new n_(Gi.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=$,AO(h,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(d.getDisplayMedia){var f;e.screen.mediaSource&&Y4(e.screen.mediaSource);const $={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(f=e.screen.displaySurface)!==null&&f!==void 0?f:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:_t,surfaceSwitching:_i,systemAudio:ue,preferCurrentTab:_r}=e.screen,Fi={selfBrowserSurface:_t,surfaceSwitching:_i,systemAudio:ue,preferCurrentTab:_r};!_t&&delete Fi.selfBrowserSurface,!_i&&delete Fi.surfaceSwitching,!ue&&delete Fi.systemAudio,!_r&&delete Fi.preferCurrentTab,Wt.debug("[".concat(r,"] getDisplayMedia:"),JSON.stringify({video:$,audio:e.screenAudio,controls:Fi})),AO(h,await navigator.mediaDevices.getDisplayMedia(DE({video:$,audio:e.screenAudio},Fi)))}else{if(!KE())throw Wt.error("[".concat(r,"] This browser does not support screenSharing")),new n_(Gi.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&Y4(e.screen.mediaSource);const $={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};Wt.debug("[".concat(r,"] getUserMedia: ").concat(JSON.stringify($))),AO(h,await navigator.mediaDevices.getUserMedia($))}}var g,b;if(!e.video&&!e.audio)return h;let C={video:e.video,audio:e.audio},P=_s("MEDIA_DEVICE_CONSTRAINTS");if(P)try{typeof P=="string"&&(P=JSON.parse(P)),C=$V(C,P)}catch{}Wt.debug("[".concat(r,"] GetUserMedia"),JSON.stringify(C)),oE();let x,H=null;(yS()||LS()||SL())&&(H=await yF.lock());try{x=await navigator.mediaDevices.getUserMedia(C)}catch($){throw H&&H(),$}return C.audio&&(o9=!0),C.video&&(s9=!0),AO(h,x),H&&H(),h}function xL(e,r){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new n_(Gi.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(r));case"NotFoundError":case"DevicesNotFoundError":return new n_(Gi.DEVICE_NOT_FOUND,"".concat(e,": ").concat(r));case"NotSupportedError":return new n_(Gi.NOT_SUPPORTED,"".concat(e,": ").concat(r));case"NotReadableError":return new n_(Gi.NOT_READABLE,"".concat(e,": ").concat(r));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new n_(Gi.PERMISSION_DENIED,"".concat(e,": ").concat(r));case"ConstraintNotSatisfiedError":return new n_(Gi.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(r));default:return Wt.error("getUserMedia unexpected error",e),new n_(Gi.UNEXPECTED_ERROR,"".concat(e,": ").concat(r))}}function AO(e,r){const i=e.getVideoTracks()[0],d=e.getAudioTracks()[0],h=r.getVideoTracks()[0],f=r.getAudioTracks()[0];f&&(d&&e.removeTrack(d),e.addTrack(f)),h&&(i&&e.removeTrack(i),e.addTrack(h))}const yT=new class extends qE{get state(){return this._state}set state(e){e!==this._state&&(this.emit(_I.STATE_CHANGE,e),this._state=e)}constructor(){super(),Qm(this,"_state",HN.IDLE),Qm(this,"isAccessMicrophonePermission",!1),Qm(this,"isAccessCameraPermission",!1),Qm(this,"lastAccessMicrophonePermission",!1),Qm(this,"lastAccessCameraPermission",!1),Qm(this,"checkdeviceMatched",!1),Qm(this,"deviceInfoMap",new Map),this.init().then(()=>{navigator.mediaDevices.addEventListener&&navigator.mediaDevices.addEventListener("devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(_s("ENUMERATE_DEVICES_INTERVAL")||(TL()||yL()===aS.HARMONY_OS)&&n0())&&this.updateDevicesInfo()},_s("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>Wt.error(e.toString()))}async enumerateDevices(e,r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new n_(Gi.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const d=await navigator.mediaDevices.enumerateDevices(),h=this.checkMediaDeviceInfoIsOk(d);let f=!this.isAccessMicrophonePermission&&e,g=!this.isAccessCameraPermission&&r;h.audio&&(f=!1),h.video&&(g=!1);let b=null,C=null,P=null;if(!i&&(f||g)){if(yF.isLocked&&(Wt.debug("[device manager] wait GUM lock"),(await yF.lock())(),Wt.debug("[device manager] GUM unlock")),o9&&(f=!1,this.isAccessMicrophonePermission=!0),s9&&(g=!1,this.isAccessCameraPermission=!0),Wt.debug("[device manager] check media device permissions",e,r,f,g),f&&g){try{P=await navigator.mediaDevices.getUserMedia({audio:!0,video:!0})}catch(x){const H=xL(x.name||x.code||x,x.message);if(H.code===Gi.PERMISSION_DENIED)throw H;Wt.warning("getUserMedia failed in getDevices",H)}this.isAccessCameraPermission=!0,this.isAccessMicrophonePermission=!0}else if(f){try{b=await navigator.mediaDevices.getUserMedia({audio:e})}catch(x){const H=xL(x.name||x.code||x,x.message);if(H.code===Gi.PERMISSION_DENIED)throw H;Wt.warning("getUserMedia failed in getDevices",H)}this.isAccessMicrophonePermission=!0}else if(g){try{C=await navigator.mediaDevices.getUserMedia({video:r})}catch(x){const H=xL(x.name||x.code||x,x.message);if(H.code===Gi.PERMISSION_DENIED)throw H;Wt.warning("getUserMedia failed in getDevices",H)}this.isAccessCameraPermission=!0}Wt.debug("[device manager] mic permission",e,"cam permission",r)}try{const x=await navigator.mediaDevices.enumerateDevices();return b&&b.getTracks().forEach(H=>H.stop()),C&&C.getTracks().forEach(H=>H.stop()),P&&P.getTracks().forEach(H=>H.stop()),b=null,C=null,P=null,x}catch(x){return b&&b.getTracks().forEach(H=>H.stop()),C&&C.getTracks().forEach(H=>H.stop()),P&&P.getTracks().forEach(H=>H.stop()),b=null,C=null,P=null,new n_(Gi.ENUMERATE_DEVICES_FAILED,x.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(r=>r.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(r=>r.kind==="audiooutput")}searchDeviceIdByName(e){let r=null;return this.deviceInfoMap.forEach(i=>{i.device.label===e&&(r=i.device.deviceId)}),r}async getDeviceById(e){const r=(await this.enumerateDevices(!0,!0,!0)).find(i=>i.deviceId===e);if(!r)throw new n_(Gi.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return r}async init(){this.state=HN.INITING;try{await this.updateDevicesInfo(),this.state=HN.INITEND}catch(e){throw Wt.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=HN.IDLE,(typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1")||new n_(Gi.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){const e=await this.enumerateDevices(!0,!0,!0),r=Date.now(),i=[];if(e[0]&&e[0].label&&this.checkdeviceMatched===!1){this.checkdeviceMatched=!0;const h=e.find(g=>g.kind==="audioinput"&&g.deviceId==="default"),f=e.find(g=>g.kind==="audiooutput"&&g.deviceId==="default");h&&f?f.groupId===h.groupId?Wt.debug("[device-check] default input ".concat(h.label," and output ").concat(f.label," is the same group")):Wt.debug("[device-check] default input ".concat(h.label," and output ").concat(f.label," is not the same group")):Wt.debug("[device-check] default input or output not found")}const d=this.checkMediaDeviceInfoIsOk(e);if(e.forEach(h=>{if(!h.deviceId)return;const f=this.deviceInfoMap.get("".concat(h.kind,"_").concat(h.deviceId));if((f?f.state:"INACTIVE")!=="ACTIVE"){const g={initAt:r,updateAt:r,device:h,state:"ACTIVE"};this.deviceInfoMap.set("".concat(h.kind,"_").concat(h.deviceId),g),i.push(g)}f&&(f.updateAt=r)}),this.deviceInfoMap.forEach((h,f)=>{h.state==="ACTIVE"&&h.updateAt!==r&&(h.state="INACTIVE",i.push(h))}),this.state!==HN.INITEND)return d.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),void(d.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0));i.forEach(h=>{switch(h.device.kind){case"audioinput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(_I.RECORDING_DEVICE_CHANGED,h);break;case"videoinput":this.lastAccessCameraPermission&&this.isAccessCameraPermission&&this.emit(_I.CAMERA_DEVICE_CHANGED,h);break;case"audiooutput":this.lastAccessMicrophonePermission&&this.isAccessMicrophonePermission&&this.emit(_I.PLAYOUT_DEVICE_CHANGED,h)}}),d.audio&&(this.lastAccessMicrophonePermission=!0,this.isAccessMicrophonePermission=!0),d.video&&(this.lastAccessCameraPermission=!0,this.isAccessCameraPermission=!0)}checkMediaDeviceInfoIsOk(e){const r=e.filter(h=>h.kind==="audioinput"),i=e.filter(h=>h.kind==="videoinput"),d={audio:!1,video:!1};for(const h of r)if(h.label&&h.deviceId){d.audio=!0;break}for(const h of i)if(h.label&&h.deviceId){d.video=!0;break}return d}};let SF=!1;const ST=new class extends qE{constructor(){super(...arguments),Qm(this,"onAutoplayFailed",void 0),Qm(this,"onAudioAutoplayFailed",void 0)}};function a9(){if(oE(),!SF){const e=r=>{r.preventDefault(),SF=!1,xN()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};SF=!0,xN()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),Wt.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),ST.onAutoplayFailed?ST.onAutoplayFailed():ST.onAudioAutoplayFailed?Wt.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):Wt.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),ST.emit("autoplay-failed")}}function c9(e,r,i,d){if(!e)return;const h=k_.getBaseInfoBySessionId(e);if(!h)return;const f=h.info,g=Date.now(),b=DE(DE({},f),{},{vid:f.vid===void 0?0:Number(f.vid),lts:g,elapse:g-h.startTime,cbRegistered:ST.onAutoplayFailed||ST.onAudioAutoplayFailed?1:-1,errorMsg:i,mediaType:r,trackId:d,extend:void 0});k_.send({type:jE.AUTOPLAY_FAILED,data:b},!0)}const plt=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],YS=new class{constructor(){Qm(this,"onAutoplayFailed",void 0),Qm(this,"elementMap",new Map),Qm(this,"elementStateMap",new Map),Qm(this,"elementsNeedToResume",[]),Qm(this,"sinkIdMap",new Map),Qm(this,"autoResumeAfterInterruption",e=>{Array.from(this.elementMap.entries()).forEach(r=>{let[i,d]=r;const h=this.elementStateMap.get(i),f=d.srcObject.getAudioTracks()[0],g=f&&f.readyState;if(Wt.debug("resume after interrupted, ele: ".concat(h," audio: ").concat(g," ").concat(e)),g==="live"){if(e)return d.pause(),void d.play();if(TE.curState==="running")return fO()?(d.pause(),void d.play()):void(h&&h==="paused"&&d.play())}})}),Qm(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[r,i]=e;const d=i.srcObject.getAudioTracks()[0];d&&d.readyState==="live"&&(Wt.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),i.pause(),i.play())})}),this.autoResumeAudioElement(),TE.on(ES.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),TE.on(ES.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),TE.on(ES.STATE_CHANGE,()=>{LS()&&TE.prevState==="suspended"&&TE.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,r){const i=this.elementMap.get(e);if(this.sinkIdMap.set(e,r),i)try{await i.setSinkId(r)}catch(d){throw new n_(Gi.PERMISSION_DENIED,"can not set sink id: "+d.toString())}}play(e,r,i,d){if(this.elementMap.has(r))return;const h=document.createElement("audio");h.autoplay=!0,h.srcObject=new MediaStream([e]),this.bindAudioElementEvents(r,h),this.elementMap.set(r,h),this.elementStateMap.set(r,CS.INIT),this.setVolume(r,i);const f=this.sinkIdMap.get(r);if(f)try{h.setSinkId(f).catch(b=>{Wt.warning("[".concat(r,"] set sink id failed"),b.toString())})}catch(b){Wt.warning("[".concat(r,"] set sink id failed"),b.toString())}const g=h.play();g&&g.then&&g.catch(b=>{d&&c9(d,"audio",b.message,r),Wt.warning("audio element play warning",b.toString()),this.elementMap.has(r)&&b.name==="NotAllowedError"&&(Wt.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(h),IL(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),a9()}))})}updateTrack(e,r){const i=this.elementMap.get(e);i&&(i.srcObject=new MediaStream([r]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,r){const i=this.elementMap.get(e);i&&(r=Math.max(0,Math.min(100,r)),i.volume=r/100)}stop(e){const r=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!r)return;const i=this.elementsNeedToResume.indexOf(r);this.elementsNeedToResume.splice(i,1),r.srcObject=null,r.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,r){plt.forEach(i=>{r.addEventListener(i,d=>{const h=this.elementStateMap.get(e),f=d.type==="pause"?"paused":d.type;if(Wt.debug("[".concat(e,"] audio-element-status change ").concat(h," => ").concat(f)),d.type==="error"){const g=r==null?void 0:r.error;g&&Wt.error("[".concat(e,"] media error, code: ").concat(g.code,", message: ").concat(g.message))}this.elementStateMap.set(e,f)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(r=>{r.play().then(i=>{Wt.debug("Auto resume audio element success")}).catch(i=>{Wt.warning("Auto resume audio element failed!",i)})}),this.elementsNeedToResume=[]};new T_(r=>{document.body?r():window.addEventListener("load",()=>r())}).then(()=>{xN()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function JE(){return function(e,r,i){const d=i.value;return typeof d=="function"&&(i.value=function(){this._isClosed&&new n_(Gi.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning",Wt);for(var h=arguments.length,f=new Array(h),g=0;g<h;g++)f[g]=arguments[g];const b=d.apply(this,f);return b instanceof T_?new T_((C,P)=>{b.then(C).catch(P)}):b}),i}}class u9 extends qE{constructor(r){super(),Qm(this,"name","VideoProcessorDestination"),Qm(this,"ID","0"),Qm(this,"_source",void 0),Qm(this,"videoContext",void 0),Qm(this,"inputTrack",void 0),this.videoContext=r}get kind(){return"video"}get enabled(){return!0}pipe(){throw new n_(Gi.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new n_(Gi.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(r){if(r.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);r.track&&r.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=r.track,this.emit(BS.ON_TRACK,r.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(BS.ON_TRACK,void 0)}}class d9 extends qE{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i){super(),Qm(this,"constraintsMap",new Map),Qm(this,"statsRegistry",[]),Qm(this,"usageRegistry",[]),Qm(this,"trackId",void 0),Qm(this,"direction",void 0),Qm(this,"_chained",!1),this.trackId=r,this.direction=i}async getConstraints(){return await TS(this,gT.REQUEST_CONSTRAINTS)}async requestApplyConstraints(r,i){var d;return Wt.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),CE(this,gT.REQUEST_UPDATE_CONSTRAINTS,Array.from(sT(d=this.constraintsMap).call(d)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return Wt.info("processor ".concat(r.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(r),CE(this,gT.REQUEST_UPDATE_CONSTRAINTS,Array.from(sT(i=this.constraintsMap).call(i)))}registerStats(r,i,d){this.statsRegistry.find(h=>h.processorID===r.ID&&h.processorName===r.name&&h.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:d})}unregisterStats(r,i){const d=this.statsRegistry.findIndex(h=>h.processorID===r.ID&&h.processorName===r.name&&h.type===i);d!==-1&&this.statsRegistry.splice(d,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:d,type:h,cb:f}of this.statsRegistry)try{const g=f();r.push({processorID:i,processorName:d,type:h,stats:g})}catch(g){Wt.error(new n_(Gi.UNEXPECTED_ERROR,g.message))}return r}registerUsage(r,i){this.usageRegistry.find(d=>d.processorID===r.ID&&d.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(d=>d.processorID===r.ID&&d.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let d=i();d instanceof T_&&(d=await d),r.push(DE(DE({},d),{},{direction:this.direction}))}catch(d){Wt.error("gather extension usage error",d)}return r}getDirection(){return this.direction}}class l9 extends qE{constructor(r){super(),Qm(this,"name","AudioProcessorDestination"),Qm(this,"ID","0"),Qm(this,"inputTrack",void 0),Qm(this,"inputNode",void 0),Qm(this,"audioProcessorContext",void 0),Qm(this,"_source",void 0),this.audioProcessorContext=r}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new n_(Gi.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new n_(Gi.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(BS.ON_TRACK,void 0),this.emit(BS.ON_NODE,void 0)}updateInput(r){if(r.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);r.track&&this.inputTrack!==r.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=r.track,this.emit(BS.ON_TRACK,this.inputTrack)),r.node&&this.inputNode!==r.node&&(this.audioProcessorContext.chained=!0,this.inputNode=r.node,this.emit(BS.ON_NODE,this.inputNode))}}class h9 extends qE{set chained(r){this._chained=r}get chained(){return this._chained}constructor(r,i,d){super(),Qm(this,"constraintsMap",new Map),Qm(this,"statsRegistry",[]),Qm(this,"audioContext",void 0),Qm(this,"trackId",void 0),Qm(this,"direction",void 0),Qm(this,"usageRegistry",[]),Qm(this,"_chained",!1),this.audioContext=r,this.trackId=i,this.direction=d}async getConstraints(){return TS(this,gT.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(r,i){var d;return Wt.info("processor ".concat(i.name," requestApplyConstraints for ").concat(this.trackId)),r&&this.constraintsMap.set(i,r),CE(this,gT.REQUEST_UPDATE_CONSTRAINTS,Array.from(sT(d=this.constraintsMap).call(d)))}async requestRevertConstraints(r){var i;if(this.constraintsMap.has(r))return this.constraintsMap.delete(r),CE(this,gT.REQUEST_UPDATE_CONSTRAINTS,Array.from(sT(i=this.constraintsMap).call(i)))}registerStats(r,i,d){this.statsRegistry.find(h=>h.processorID===r.ID&&h.processorName===r.name&&h.type===i)||this.statsRegistry.push({processorName:r.name,processorID:r.ID,type:i,cb:d})}unregisterStats(r,i){const d=this.statsRegistry.findIndex(h=>h.processorID===r.ID&&h.processorName===r.name&&h.type===i);d!==-1&&this.statsRegistry.splice(d,1)}gatherStats(){const r=[];for(const{processorID:i,processorName:d,type:h,cb:f}of this.statsRegistry)try{const g=f();r.push({processorID:i,processorName:d,type:h,stats:g})}catch(g){Wt.error(new n_(Gi.UNEXPECTED_ERROR,g.message))}return r}registerUsage(r,i){this.usageRegistry.find(d=>d.processorID===r.ID&&d.processorName===r.name)||this.usageRegistry.push({processorID:r.ID,processorName:r.name,cb:i})}unregisterUsage(r){const i=this.usageRegistry.findIndex(d=>d.processorID===r.ID&&d.processorName===r.name);i!==-1&&this.usageRegistry.splice(i,1)}async gatherUsage(){const r=[];if(!this.chained)return[];for(const{cb:i}of this.usageRegistry)try{let d=i();d instanceof T_&&(d=await d),r.push(DE(DE({},d),{},{direction:this.direction}))}catch(d){Wt.error("gather extension usage error",d)}return r}getDirection(){return this.direction}}class TF extends qE{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),Qm(this,"context",void 0),Qm(this,"processSourceNode",void 0),Qm(this,"outputTrack",void 0),Qm(this,"processedNode",void 0),Qm(this,"clonedTrack",void 0),Qm(this,"outputNode",void 0),this.outputNode=new flt}setVolume(){}createOutputTrack(){throw new n_(Gi.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class flt{disconnect(){}connect(){}}function p9(e){return new T_((r,i)=>{let d=!1;const h=document.createElement("video");h.setAttribute("autoplay",""),h.setAttribute("muted",""),h.muted=!0,h.autoplay=!0,h.setAttribute("playsinline",""),h.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(h);const f=LS()?"canplay":"playing";h.addEventListener(f,()=>{const g=h.videoWidth,b=h.videoHeight;!g&&KE()||(d=!0,h.srcObject=null,h.remove(),r([g,b]))}),h.srcObject=new MediaStream([e]),h.play().catch(wL),setTimeout(()=>{d||(h.srcObject=null,h.remove(),r([h.videoWidth,h.videoHeight]))},4e3)})}function UL(e){const r={};e.facingMode&&(r.facingMode=e.facingMode),e.cameraId&&(r.deviceId={exact:e.cameraId});const i=ZT(e.encoderConfig);return i.width!=null&&(r.width=i.width),i.height!=null&&(r.height=i.height),!l4()&&i.frameRate&&(r.frameRate=i.frameRate),r4()&&typeof r.frameRate=="object"&&(r.frameRate.max=60),KE()&&(r.frameRate={ideal:30,max:30}),r}function f9(e){const r={};return l4()||(e.AGC!==void 0&&(r.autoGainControl=e.AGC),e.AEC!==void 0&&(r.echoCancellation=e.AEC),e.ANS!==void 0&&(r.noiseSuppression=e.ANS,e0()&&e.ANS&&(r.googHighpassFilter=e.ANS))),r}function m9(e){const r=f9(e);if(e.encoderConfig){const i=LL(e.encoderConfig);r.channelCount=i.stereo?2:1,r.sampleRate=i.sampleRate,r.sampleSize=i.sampleSize}return e.microphoneId&&(r.deviceId={exact:e.microphoneId}),TL()&&(r.sampleRate=void 0),r}const mlt=e=>{const r=e._encoderConfig;if(!r)return;const{frameRate:i,width:d,height:h}=e.getMediaStreamTrackSettings();let{frameRate:f=i,width:g=d,height:b=h}=r;if(!f||!g||!b)return;g=EO(g),b=EO(b),f=EO(f);const{max:C,min:P}=function(_t,_i,ue){const _r=200*Math.pow(ue/15,.6)*Math.pow(_t*_i/640/360,.75);return{min:Math.floor(_r),max:Math.floor(4*_r)}}(g,b,f),{bitrateMax:x,bitrateMin:H}=r||{};x||Wt.debug("calculate bitrate: [w: ".concat(g,", h: ").concat(b,", fps: ").concat(f,"] => [brMax: ").concat(x,", brMin: ").concat(H,"]"));const{maxFramerate:$}=_s("ENCODER_CONFIG_LIMIT");return $&&typeof $=="number"&&(f=Math.min(f,$)),{frameRate:f,bitrateMax:x||C,bitrateMin:H||P,scaleResolutionDownBy:1,scale:0}},_9=async(e,r,i)=>await(async(d,h,f)=>{const g=function(P){const x=[];for(let H=0;H<P.length;H+=2)x.push(parseInt(P.slice(H,H+2),16));return Uint8Array.from(x)}(C4(""+h+f)).slice(0,16),b=g.slice(0,12),C=await window.crypto.subtle.importKey("raw",g,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:b},C,d))})(e.buffer,r,i),RF=e=>{const r=document.createElement("canvas");return r.width=2,r.height=2,new T_((i,d)=>{r.toBlob(async h=>{if(r.remove(),h){const f=await E9(h);i({buffer:f,width:r.width,height:r.height})}else d(new n_(Gi.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},E9=async e=>{const r=await e.arrayBuffer();return new Uint8Array(r)};var g9,v9,b9,y9,S9,T9,R9,I9,w9,C9,A9,O9,N9,P9,D9,k9,L9,M9,WE,x9,U9,V9,j9,F9,B9,VR,G9,q9,W9,K9,H9,z9,Y9,J9,X9,Q9,Z9,$9,t7,IS;let XE=(g9=V_({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),v9=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),b9=JE(),y9=gO("LocalAudioTrack","_enabledMutex"),S9=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),T9=JE(),R9=gO("LocalAudioTrack","_enabledMutex"),I9=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),w9=JE(),C9=JE(),A9=JE(),O9=V_({argsMap:e=>[e.getTrackId()]}),N9=JE(),P9=V_({argsMap:e=>[e.getTrackId()]}),D9=JE(),k9=V_({argsMap:e=>[e.getTrackId()]}),L9=V_({argsMap:(e,r)=>[e.getTrackId(),r.name]}),M9=V_({argsMap:e=>[e.getTrackId()]}),iE((WE=class extends wO{get _source(){return this.initWebAudio()}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext||(this._processorContext=this.initProcessor().processorContext),this._processorContext}get processorDestination(){return this._processorDestination||(this._processorDestination=this.initProcessor().processorDestination),this._processorDestination}get isPlaying(){return this._useAudioElement?YS.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,r,i,d){super(e,i),Qm(this,"trackMediaType",IO.AUDIO),Qm(this,"_encoderConfig",void 0),Qm(this,"_trackSource",void 0),Qm(this,"metadata",[]),Qm(this,"_enabled",!0),Qm(this,"_volume",100),Qm(this,"_useAudioElement",!0),Qm(this,"_bypassWebAudio",!1),Qm(this,"processor",void 0),Qm(this,"_processorContext",void 0),Qm(this,"_processorDestination",void 0),Qm(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=r,this._getOriginVolumeLevel=!!d,this._trackSource=new TF,_s("DISABLE_WEBAUDIO")&&(this._bypassWebAudio=!0),_s("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1),yS()&&!vT?setTimeout(()=>this.initWebAudio()):this.initWebAudio()}setVolume(e){IE(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&YS.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void Wt.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const r=this._source.createOutputTrack();this._mediaStreamTrack!==r&&(this._mediaStreamTrack=r,CE(this,P_.NEED_REPLACE_TRACK,this).then(()=>{Wt.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(i=>{Wt.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),i)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement||!H4())throw new n_(Gi.NOT_SUPPORTED,"your browser does not support setting the audio output device");await YS.setSinkID(this.getTrackId(),e)}async setEnabled(e,r,i){return this._setEnabled(e,r,i)}async _setEnabled(e,r,i){if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Wt.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{i||(this._enabled=!0),await CE(this,P_.NEED_ENABLE_TRACK,this),Wt.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(d){throw i||(this._enabled=!1),Wt.error("[".concat(this.getTrackId(),"] setEnabled to true error"),d.toString()),d}}else{this._originMediaStreamTrack.enabled=!1,i||(this._enabled=!1);try{await CE(this,P_.NEED_DISABLE_TRACK,this)}catch(d){throw i||(this._enabled=!0),Wt.error("[".concat(this.getTrackId(),"] setEnabled to false error"),d.toString()),d}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,Wt.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await CE(this,P_.NEED_MUTE_TRACK,this):await CE(this,P_.NEED_UNMUTE_TRACK,this))}getStats(){return I0(()=>{Wt.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),mT(this,P_.GET_STATS)||DE({},_F)}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ET.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(ET.ON_AUDIO_BUFFER),this._source.on(ET.ON_AUDIO_BUFFER,i=>e(i))}play(){Wt.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(Wt.debug("[".concat(this.getTrackId(),"] start audio playback in element")),YS.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){Wt.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?YS.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this._processorDestination&&this.unbindProcessorDestinationEvents(this._processorDestination),this._processorContext&&this.unbindProcessorContextEvents(this._processorContext),this.unpipe(),this._processorDestination&&this._processorDestination._source&&this._processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];Wt.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&YS.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,r){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),r&&this._originMediaStreamTrack.stop()),e.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this._processorContext&&this.processor.updateInput({track:e,context:this._processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await CE(this,P_.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return T_.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new n_(Gi.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new n_(Gi.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(e){e.on(BS.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(r),await CE(this,P_.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await CE(this,P_.NEED_REPLACE_TRACK,this))}),e.on(BS.ON_NODE,r=>{this._source.processedNode=r})}unbindProcessorDestinationEvents(e){e.removeAllListeners(BS.ON_TRACK),e.removeAllListeners(BS.ON_NODE)}bindProcessorContextEvents(e){e.on(gT.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}unbindProcessorContextEvents(e){e.removeAllListeners(gT.REQUEST_CONSTRAINTS)}initWebAudio(){return this._trackSource instanceof TF&&(this._trackSource=new n9(this._mediaStreamTrack,!1,this._getOriginVolumeLevel?this._mediaStreamTrack:void 0)),this._trackSource}initProcessor(){const e=new h9(this._source.context,this.getTrackId(),"local"),r=new l9(e);return this._processorContext=e,this._processorDestination=r,this.bindProcessorContextEvents(e),this.bindProcessorDestinationEvents(r),this._source.on(ET.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:e})}),this._useAudioElement&&(this._useAudioElement=!1,this.isPlaying&&(YS.stop(this.getTrackId()),this._source.play()),CE(this,P_.NEED_REPLACE_MIXING_TRACK,this).then(()=>{Wt.debug("[".concat(this.getTrackId(),"] replace from origin track to web audio track success"))}).catch(i=>{Wt.warning("[".concat(this.getTrackId(),"] replace from origin track to web audio track failed"),i)})),{processorContext:e,processorDestination:r}}}).prototype,"setVolume",[g9],Object.getOwnPropertyDescriptor(WE.prototype,"setVolume"),WE.prototype),iE(WE.prototype,"setPlaybackDevice",[v9,b9],Object.getOwnPropertyDescriptor(WE.prototype,"setPlaybackDevice"),WE.prototype),iE(WE.prototype,"setEnabled",[y9,S9,T9],Object.getOwnPropertyDescriptor(WE.prototype,"setEnabled"),WE.prototype),iE(WE.prototype,"setMuted",[R9,I9,w9],Object.getOwnPropertyDescriptor(WE.prototype,"setMuted"),WE.prototype),iE(WE.prototype,"getStats",[C9],Object.getOwnPropertyDescriptor(WE.prototype,"getStats"),WE.prototype),iE(WE.prototype,"setAudioFrameCallback",[A9],Object.getOwnPropertyDescriptor(WE.prototype,"setAudioFrameCallback"),WE.prototype),iE(WE.prototype,"play",[O9,N9],Object.getOwnPropertyDescriptor(WE.prototype,"play"),WE.prototype),iE(WE.prototype,"stop",[P9,D9],Object.getOwnPropertyDescriptor(WE.prototype,"stop"),WE.prototype),iE(WE.prototype,"close",[k9],Object.getOwnPropertyDescriptor(WE.prototype,"close"),WE.prototype),iE(WE.prototype,"pipe",[L9],Object.getOwnPropertyDescriptor(WE.prototype,"pipe"),WE.prototype),iE(WE.prototype,"unpipe",[M9],Object.getOwnPropertyDescriptor(WE.prototype,"unpipe"),WE.prototype),WE),zN=(x9=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),U9=JE(),V9=gO("MicrophoneAudioTrack","_enabledMutex"),j9=V_({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),F9=JE(),B9=V_({argsMap:e=>[e.getTrackId()]}),iE((VR=class extends XE{get __className__(){return"MicrophoneAudioTrack"}constructor(e,r,i,d){super(e,r.encoderConfig?LL(r.encoderConfig):{},d,_s("GET_VOLUME_OF_MUTED_AUDIO_TRACK")),Qm(this,"_config",void 0),Qm(this,"_deviceName","default"),Qm(this,"_constraints",void 0),Qm(this,"_originalConstraints",void 0),Qm(this,"_enabled",!0),this._config=r,this._constraints=i,this._originalConstraints=i,this._deviceName=e.label,typeof r.bypassWebAudio=="boolean"&&(this._bypassWebAudio=r.bypassWebAudio),(fO()||HV())&&TE.bindInterruptDetectorTrack(this)}async setDevice(e){if(Wt.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const r=await yT.getDeviceById(e),i={};i.audio=DE({},this._constraints),i.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let d=null;try{d=await bT(i,this.getTrackId())}catch(h){throw Wt.error("[".concat(this.getTrackId(),"] setDevice failed"),h.toString()),d=await bT({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),h}await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw Wt.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}else try{const r=await yT.getDeviceById(e);this._deviceName=r.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(r){throw Wt.error("[".concat(this.getTrackId(),"] setDevice error"),r.toString()),r}Wt.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,r,i){if(r)return Wt.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!i){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(Wt.info("[".concat(this.getTrackId(),"] start setEnabled"),e),_s("AUTO_RESET_AUDIO_ROUTE")&&(LS()||JT())){const g=navigator.audioSession;g&&(e||(g.type="playback"),g.type="auto")}if(!e){var d;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(d=this._source.clonedTrack)===null||d===void 0||d.stop(),i||(this._enabled=!1);try{await CE(this,P_.NEED_DISABLE_TRACK,this)}catch(g){throw Wt.error("[".concat(this.getTrackId(),"] setEnabled false failed"),g.toString()),g}return}const h=DE({},this._constraints),f=yT.searchDeviceIdByName(this._deviceName);f&&!h.deviceId&&(h.deviceId=f);try{i||(this._enabled=!0);const g=await bT({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(g.getAudioTracks()[0],!1),await CE(this,P_.NEED_ENABLE_TRACK,this)}catch(g){throw i||(this._enabled=!1),Wt.error("[".concat(this.getTrackId(),"] setEnabled true failed"),g.toString()),g}Wt.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(fO()||HV())&&TE.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((LS()||JT())&&this._enabled&&!this._isClosed&&TE.duringInterruption){const e=async()=>{TE.off(ES.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(Wt.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};TE.on(ES.IOS_INTERRUPTION_END,e)}else Wt.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(RO.TRACK_ENDED)}async renewMediaStreamTrack(e){const r=e||this._constraints,i=yT.searchDeviceIdByName(this._deviceName);if(i&&!r.deviceId&&(r.deviceId=i),this._constraints=r,this._enabled){this._originMediaStreamTrack.stop();const d=await bT({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!0)}}bindProcessorContextEvents(e){super.bindProcessorContextEvents(e),e.on(gT.REQUEST_UPDATE_CONSTRAINTS,async(r,i,d)=>{try{const h=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(h),i()}catch(h){d(h)}})}unbindProcessorContextEvents(e){super.unbindProcessorContextEvents(e),e.removeAllListeners(gT.REQUEST_UPDATE_CONSTRAINTS)}}).prototype,"setDevice",[x9,U9],Object.getOwnPropertyDescriptor(VR.prototype,"setDevice"),VR.prototype),iE(VR.prototype,"setEnabled",[V9,j9,F9],Object.getOwnPropertyDescriptor(VR.prototype,"setEnabled"),VR.prototype),iE(VR.prototype,"close",[B9],Object.getOwnPropertyDescriptor(VR.prototype,"close"),VR.prototype),VR),_lt=(G9=V_({argsMap:(e,r)=>[e.getTrackId(),r,e.duration]}),q9=JE(),W9=V_({argsMap:e=>[e.getTrackId()]}),K9=JE(),H9=V_({argsMap:e=>[e.getTrackId()]}),z9=JE(),Y9=V_({argsMap:e=>[e.getTrackId()]}),J9=JE(),X9=V_({argsMap:e=>[e.getTrackId()]}),Q9=JE(),Z9=V_({argsMap:e=>[e.getTrackId()]}),$9=V_({argsMap:e=>[e.getTrackId()]}),t7=JE(),iE((IS=class extends XE{get __className__(){return"BufferSourceAudioTrack"}constructor(e,r,i,d){super(r.createOutputTrack(),i,d),Qm(this,"source",void 0),Qm(this,"_bufferSource",void 0),this._useAudioElement=!1,this.source=e,this._bufferSource=r,this._bufferSource.on(ET.AUDIO_SOURCE_STATE_CHANGE,h=>{this.safeEmit(RO.SOURCE_STATE_CHANGE,h)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}close(){this.source=null,this._bufferSource.destroy(),super.close()}setAudioBufferPlaybackSpeed(e){IE(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[G9,q9],Object.getOwnPropertyDescriptor(IS.prototype,"startProcessAudioBuffer"),IS.prototype),iE(IS.prototype,"pauseProcessAudioBuffer",[W9,K9],Object.getOwnPropertyDescriptor(IS.prototype,"pauseProcessAudioBuffer"),IS.prototype),iE(IS.prototype,"seekAudioBuffer",[H9,z9],Object.getOwnPropertyDescriptor(IS.prototype,"seekAudioBuffer"),IS.prototype),iE(IS.prototype,"resumeProcessAudioBuffer",[Y9,J9],Object.getOwnPropertyDescriptor(IS.prototype,"resumeProcessAudioBuffer"),IS.prototype),iE(IS.prototype,"stopProcessAudioBuffer",[X9,Q9],Object.getOwnPropertyDescriptor(IS.prototype,"stopProcessAudioBuffer"),IS.prototype),iE(IS.prototype,"close",[Z9],Object.getOwnPropertyDescriptor(IS.prototype,"close"),IS.prototype),iE(IS.prototype,"setAudioBufferPlaybackSpeed",[$9,t7],Object.getOwnPropertyDescriptor(IS.prototype,"setAudioBufferPlaybackSpeed"),IS.prototype),IS);class eS extends XE{get __className__(){return"MixingAudioTrack"}get isActive(){for(const r of this.trackList)if(r._enabled&&!r._isClosed&&!r.muted)return!0;return!1}constructor(){const r=CO().createMediaStreamDestination();super(r.stream.getAudioTracks()[0],void 0,AE(8,"track-mix-")),Qm(this,"trackList",void 0),Qm(this,"destNode",void 0),this._useAudioElement=!1;try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=r,this.trackList=[]}hasAudioTrack(r){return this.trackList.indexOf(r)!==-1}addAudioTrack(r){this.trackList.indexOf(r)===-1?(Wt.debug("add ".concat(r.getTrackId()," to mixing track")),r._source.outputNode.connect(this.destNode),this.trackList.push(r),this.updateEncoderConfig()):Wt.debug("track ".concat(r.getTrackId()," is already added"))}removeAudioTrack(r){if(this.trackList.indexOf(r)!==-1){Wt.debug("remove ".concat(r.getTrackId()," from mixing track"));try{r._source.outputNode.disconnect(this.destNode)}catch{}RL(this.trackList,r),this.updateEncoderConfig()}}updateEncoderConfig(){const r={};this.trackList.forEach(i=>{i._encoderConfig&&((i._encoderConfig.bitrate||0)>(r.bitrate||0)&&(r.bitrate=i._encoderConfig.bitrate),(i._encoderConfig.sampleRate||0)>(r.sampleRate||0)&&(r.sampleRate=i._encoderConfig.sampleRate),(i._encoderConfig.sampleSize||0)>(r.sampleSize||0)&&(r.sampleSize=i._encoderConfig.sampleSize),i._encoderConfig.stereo&&(r.stereo=!0))}),this._encoderConfig=r}_updateRtpTransceiver(r){this._rtpTransceiver!==r&&(this._rtpTransceiver=r,this.trackList.forEach(i=>{i instanceof eS?i.emit(mI.TRANSCEIVER_UPDATED,r):i._updateRtpTransceiver(r)}))}}class Elt extends e9{set currentState(r){r!==this._currentState&&(this._currentState=r,this.safeEmit(ET.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),Qm(this,"audioBuffer",void 0),Qm(this,"sourceNode",void 0),Qm(this,"startPlayTime",0),Qm(this,"startPlayOffset",0),Qm(this,"pausePlayTime",0),Qm(this,"options",void 0),Qm(this,"currentLoopCount",0),Qm(this,"currentPlaybackSpeed",100),Qm(this,"_currentState","stopped"),this.audioBuffer=r,this.options=i,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer?this.audioBuffer.duration:0}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.audioBuffer?this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration:0}updateOptions(r){this.currentState==="stopped"?(this.options=r,this.startPlayOffset=this.options.startPlayTime||0):Wt.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(r){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=r,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=r))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}destroy(){this.audioBuffer=null,super.destroy()}setAudioBufferPlaybackSpeed(r){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=r/100),this.currentPlaybackSpeed=r}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const r=this.context.createBufferSource();return r.buffer=this.audioBuffer,r.loop=!!this.options.loop,r.connect(this.outputNode),r.playbackRate.value=this.currentPlaybackSpeed/100,r}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const e7=new Map;function n7(e,r){if(e.length===0||r.length===0)return 1/0;const i=_j(e),d=_j(r);return Math.floor(d/i)}class IF{get rendFrameRate(){const r=Math.max(1,n7(this._render_interframe_delays_sizes,this._render_interframe_delays));return Math.floor(1e3/r)}get videoElementStatus(){return this._isInPage?this._videoElementStatus:CS.DESTROYED}set videoElementStatus(r){r!==this._videoElementStatus&&(Wt.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(r)),this._videoElementStatus=r)}get videoState(){return this._videoState}set videoState(r){var i;r!==this._videoState&&(this._videoState=r,(i=this.onVideoStateChanged)===null||i===void 0||i.call(this,this.videoState))}constructor(r){Qm(this,"trackId",void 0),Qm(this,"config",void 0),Qm(this,"onFirstVideoFrameDecoded",void 0),Qm(this,"onFirstVideoFrameRender",void 0),Qm(this,"onVideoStateChanged",void 0),Qm(this,"freezeTimeCounterList",[]),Qm(this,"renderFreezeAccTime",0),Qm(this,"renderFreezeAccTime2",0),Qm(this,"isKeepLastFrame",!1),Qm(this,"isDestroyed",!1),Qm(this,"timeUpdatedCount",0),Qm(this,"freezeTime",0),Qm(this,"playbackTime",0),Qm(this,"lastTimeUpdatedTime",0),Qm(this,"autoplayFailed",!1),Qm(this,"videoTrack",void 0),Qm(this,"videoElement",void 0),Qm(this,"cacheVideoElement",void 0),Qm(this,"internal",!1),Qm(this,"_render_interframe_delays",[]),Qm(this,"_render_interframe_delays_sizes",[]),Qm(this,"_videoState",UR.VideoStateStopped),Qm(this,"videoElementCheckInterval",void 0),Qm(this,"videoElementFreezeTimeout",void 0),Qm(this,"_videoElementStatus",CS.NONE),Qm(this,"_isInPage",!0),Qm(this,"isGettingVideoDimensions",!1),Qm(this,"startGetVideoDimensions",()=>{const i=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return Wt.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(i,500)};!this.isGettingVideoDimensions&&i()}),Qm(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&TE.curState==="running"&&(Wt.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(e4())),u4()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),Qm(this,"handleVideoEvents",i=>{switch(i.type){case"play":case"playing":i.type==="play"&&Wt.debug("[".concat(this.trackId,"] video element status: play")),this.startGetVideoDimensions(),this.videoElementStatus=CS.PLAYING;break;case"loadeddata":if(this.videoState=UR.VideoStateStarting,this.onFirstVideoFrameRender&&this.onFirstVideoFrameRender(),this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=CS.CANPLAY;break;case"stalled":this.videoElementStatus=CS.STALLED;break;case"suspend":this.videoElementStatus=CS.SUSPEND;break;case"pause":this.videoElementStatus=CS.PAUSED,LS()||JT()||yS()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(Wt.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=CS.WAITING;break;case"abort":this.videoElementStatus=CS.ABORT;break;case"ended":this.videoElementStatus=CS.ENDED;break;case"emptied":this.videoElementStatus=CS.EMPTIED;break;case"error":{const d=this.videoElement.error;d&&(this.videoElementStatus=CS.ERROR,Wt.error("[".concat(this.trackId,"] media error: ").concat(d.message," (").concat(d.code,")")));break}case"timeupdate":{const d=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=d);const h=d-this.lastTimeUpdatedTime,f=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=d,jR.lastVisibleTime<jR.lastHiddenTime||f<jR.lastHiddenTime||f<jR.lastVisibleTime||this.isSkipCalcRenderFreezeTime())return;for(h>_s("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=h),this.playbackTime+=h;this.playbackTime>=6e3;){this.playbackTime-=6e3;const g=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(g),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),Qm(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(Wt.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(e4())),u4()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=r.trackId,this.config=r,r.element instanceof HTMLVideoElement?this.videoElement=r.element:this.videoElement=document.createElement("video"),TE.on(ES.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),TE.on(ES.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var r;return(r=this.videoElement.parentElement)!==null&&r!==void 0?r:void 0}updateConfig(r){this.config=r,this.trackId=r.trackId,r.element!==this.videoElement&&(this.destroy(),this.videoElement=r.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.initVideoElement())}play(r){const i=this.videoElement.play();i&&i.catch&&i.catch(h=>{r&&c9(r,"video",h.message,this.trackId),h.name==="NotAllowedError"?(Wt.warning("detected video element autoplay failed",h),this.autoplayFailed=!0,this.handleAutoPlayFailed()):Wt.warning("[".concat(this.trackId,"] play warning: "),h)});const d=oE();if((d.name==="Safari"&&Number(d.version)===15||fO())&&i&&i.then){const h=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};i.then(h).catch(h)}}getCurrentFrame(){const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const i=r.getContext("2d");if(!i)return Wt.error("create canvas context failed!"),new ImageData(2,2);i.drawImage(this.videoElement,0,0,r.width,r.height);const d=i.getImageData(0,0,r.width,r.height);return r.remove(),d}async getCurrentFrameToUint8Array(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const d=document.createElement("canvas");d.width=this.videoElement.videoWidth,d.height=this.videoElement.videoHeight;const h=d.getContext("2d");return h?(h.drawImage(this.videoElement,0,0,d.width,d.height),new T_((f,g)=>{d.toBlob(async b=>{if(d.remove(),b){const C=await E9(b);f({buffer:C,width:d.width,height:d.height})}else g(new n_(Gi.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},r,i<0?.1:i>1?1:i)})):await RF(r)}destroy(){this.isDestroyed=!0,TE.off(ES.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),TE.off(ES.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[],this.videoState=UR.VideoStateStopped}initVideoElement(){if(this.videoElementStatus=CS.INIT,!this.videoElementCheckInterval&&(r7.forEach(f=>{this.videoElement.addEventListener(f,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{this._isInPage=function(f){return f!==document.body&&document.body.contains(f)}(this.videoElement)},1e3),_s("ENABLE_VIDEO_FRAME_CALLBACK"))){var r,i;let f;const g=()=>{document.visibilityState==="visible"&&(document.removeEventListener("visibilitychange",g),this.videoElementFreezeTimeout=window.setTimeout(b,_s("VIDEO_FREEZE_DURATION")))},b=()=>{this.videoElementFreezeTimeout=void 0,this.videoState===UR.VideoStateDecoding&&(document.visibilityState==="visible"?this.videoState=UR.VideoStateFrozen:document.addEventListener("visibilitychange",g))},C=(P,x)=>{if(this.videoElementStatus===CS.PLAYING){if(f){const _t=x.presentationTime-f.presentationTime,_i=x.presentedFrames-f.presentedFrames;this._render_interframe_delays_sizes.push(_i),this._render_interframe_delays.push(_t);const ue=_j(this._render_interframe_delays_sizes),_r=ue-this._render_interframe_delays_sizes[0];if(ue>30&&_r>5&&(this._render_interframe_delays_sizes.shift(),this._render_interframe_delays.shift()),this.videoState===UR.VideoStateStarting&&(this.videoState=UR.VideoStateDecoding),this.videoState===UR.VideoStateDecoding&&this.onVideoStateChanged&&(this.videoElementFreezeTimeout&&window.clearTimeout(this.videoElementFreezeTimeout),this.videoElementFreezeTimeout=window.setTimeout(b,_s("VIDEO_FREEZE_DURATION"))),_t<_s("VIDEO_FREEZE_DURATION")&&this.videoState===UR.VideoStateFrozen&&(this.videoState=UR.VideoStateDecoding),_t>_s("VIDEO_FREEZE_DURATION")&&jR.lastVisibleTime>=jR.lastHiddenTime&&f.timestamp>jR.lastVisibleTime&&f.timestamp>jR.lastHiddenTime){const Fi=Math.min(66,n7(this._render_interframe_delays_sizes,this._render_interframe_delays)),Di=Math.max(0,_t-(_i-1)*Fi);this.renderFreezeAccTime2+=Di>Fi?Di:0,this.renderFreezeAccTime+=_t}}f=DE(DE({},x),{},{timestamp:P})}else this.isSkipCalcRenderFreezeTime()&&(f=DE(DE({},x),{},{timestamp:P}));var H,$;_s("ENABLE_VIDEO_FRAME_CALLBACK")&&((H=($=this.videoElement).requestVideoFrameCallback)===null||H===void 0||H.call($,C))};(r=(i=this.videoElement).requestVideoFrameCallback)===null||r===void 0||r.call(i,C)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),TL()&&!_s("HIDE_NO_POSTER")&&(this.videoElement.poster="noposter");const d=oE();d.name==="Safari"&&Number(d.version)===15||fO()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,KE()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,KE()&&this.videoElement.load());const h=this.videoElement.play();h!==void 0&&h.catch(f=>{Wt.debug("[".concat(this.trackId,"] playback interrupted"),f.toString())})}resetVideoElement(){r7.forEach(r=>{this.videoElement&&this.videoElement.removeEventListener(r,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=CS.NONE}isSkipCalcRenderFreezeTime(){return this.videoElementStatus===CS.DESTROYED||this.internal}handleAutoPlayFailed(){const r=i=>{i.preventDefault(),this.videoElement.play().then(()=>{Wt.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(d=>{Wt.error(d)}),this.autoplayFailed=!1,xN()?document.body.removeEventListener("click",r,!0):(document.body.removeEventListener("touchstart",r,!0),document.body.removeEventListener("mousedown",r,!0))};xN()?document.body.addEventListener("click",r,!0):(document.body.addEventListener("touchstart",r,!0),document.body.addEventListener("mousedown",r,!0)),a9()}}const r7=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class wF extends IF{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];super(r),Qm(this,"container",void 0),Qm(this,"slot",void 0),this.slot=r.element,this.internal=i,this.updateConfig(r)}updateConfig(r){this.config=r,this.trackId=r.trackId;const i=r.element;var d;!this.internal||this.slot?(i!==this.slot&&(this.destroy(),this.slot=i),this.createElements()):(this.slot=i,i&&this.container?(this.internal=!1,this.container.id="agora-video-player-".concat(this.trackId),this.videoElement.id="video_".concat(this.trackId),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",(d=this.slot)===null||d===void 0||d.appendChild(this.container)):this.createElements())}updateVideoTrack(r){this.videoTrack!==r&&(this.videoTrack=r,this.createElements())}play(r){var i;(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)&&super.play(r)}getCurrentFrame(){var r;return(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(r){var i;let d=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(i=this.container)!==null&&i!==void 0&&i.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(r,d):await RF(r)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{var r;this.container.remove(),(r=this.slot)===null||r===void 0||r.removeChild(this.container)}catch{}this.container=void 0}}createElements(){var r;this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",_s("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),(r=this.slot)===null||r===void 0||r.appendChild(this.container)}mountedVideoElement(){var r;!this.container||(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var r;if((r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var r;(r=this.container)!==null&&r!==void 0&&r.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}var i7,o7,s7,a7,c7,u7,d7,l7,h7,p7,f7,m7,_7,E7,g7,v7,b7,y7,S7,T7,R7,I7,w7,C7,A7,O7,N7,P7,tE,D7,k7,L7,M7,x7,U7,V7,j7,TT;let LE=(i7=V_({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),o7=JE(),s7=V_({argsMap:e=>[e.getTrackId()]}),a7=gO("LocalVideoTrack","_enabledMutex"),c7=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),u7=JE(),d7=gO("LocalVideoTrack","_enabledMutex"),l7=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),h7=JE(),p7=V_({argsMap:(e,r)=>[e.getTrackId(),r,e._saveEncodeBitrateRatio]}),f7=JE(),m7=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),_7=JE(),E7=JE(),g7=V_({argsMap:(e,r,i)=>[e.getTrackId(),r,i]}),v7=JE(),b7=JE(),y7=JE(),S7=V_({argsMap:e=>[e.getTrackId()]}),T7=JE(),R7=JE(),I7=JE(),w7=JE(),C7=JE(),A7=V_({argsMap:(e,r)=>[e.getTrackId(),r.name]}),O7=V_({argsMap:e=>[e.getTrackId()]}),N7=V_({argsMap:e=>[e.getTrackId()]}),P7=V_({argsMap:(e,r,i)=>[e.getTrackId(),r.label,i]}),tE=class oZ extends wO{get videoHeight(){if(yS()){const{height:r}=this._mediaStreamTrack.getSettings();return this._videoHeight=r,this._videoHeight}return this._videoHeight}get videoWidth(){if(yS()){const{width:r}=this._mediaStreamTrack.getSettings();return this._videoWidth=r,this._videoWidth}return this._videoWidth}get isPlaying(){return!(!this._player||this._player.videoElementStatus!==CS.PLAYING)}get processorDestination(){return this._processorDestination}get processorContext(){return this._processorContext}set processorContext(r){this._processorContext=r}get __className__(){return"LocalVideoTrack"}constructor(r,i,d,h,f,g){if(super(r,f),Qm(this,"trackMediaType",IO.VIDEO),Qm(this,"_player",void 0),Qm(this,"isUseScaleResolutionDownBy",!1),Qm(this,"_videoVisibleTimer",null),Qm(this,"_previousVideoVisibleStatus",void 0),Qm(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Qm(this,"_encoderConfig",void 0),Qm(this,"_scalabilityMode",{numSpatialLayers:1,numTemporalLayers:1}),Qm(this,"_optimizationMode",void 0),Qm(this,"_saveEncodeBitrateRatio",1),Qm(this,"_videoHeight",void 0),Qm(this,"_videoWidth",void 0),Qm(this,"_forceBitrateLimit",void 0),Qm(this,"_enabled",!0),Qm(this,"_processorDestination",void 0),Qm(this,"_processorContext",void 0),yS()){const{width:b,height:C}=r.getSettings();this._videoWidth=b,this._videoHeight=C}else this.updateMediaStreamTrackResolution();if(this._scalabilityMode=d,this._optimizationMode=h,this._hints=g||[],i&&this._hints.indexOf(wE.CUSTOM_TRACK)!==-1?this._encoderConfig=BE(i):this._encoderConfig=i,this._hints.indexOf(wE.SCREEN_TRACK)===-1)this.updateBitrateFromProfile();else if(BV(hE.CHROME,115)&&yL().indexOf("Windows")!==-1){const b=function(C,P){if("VideoFrame"in window&&"TransformStream"in window&&uE().supportWebRTCInsertableStream){const x=new MediaStreamTrackProcessor(C),H=new MediaStreamTrackGenerator({kind:"video"});let $,_t,_i=Date.now();const ue=()=>{_r&&(clearInterval(_r),_r=void 0),$&&($.close(),$=void 0),C.stop(),_t=void 0,H.removeEventListener("ended",ue)};let _r=window.setInterval(()=>{if(_t&&$&&Date.now()-_i>1e3)try{H.readyState==="live"?_t.enqueue($.clone()):ue()}catch{ue()}},1e3);const Fi=new TransformStream({transform:(Di,Js)=>{H.readyState==="live"?(_t=Js,_i=Date.now(),$===void 0?($=Di,Js.enqueue(Di.clone())):(Js.enqueue($),$=Di)):Di.close()}});return H.addEventListener("ended",ue),x.readable.pipeThrough(Fi).pipeTo(H.writable),H}}(r);b&&(Wt.info("local screen video track begin to inject frame"),this._mediaStreamTrack=b)}i&&this._hints.indexOf(wE.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(i),this._processorContext=new d9(this.getTrackId(),"local"),this._processorDestination=new u9(this.processorContext),this.bindProcessorDestinationEvents()}play(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof r=="string"){const h=document.getElementById(r);h?r=h:(Wt.warning("[".concat(this.getTrackId(),'] can not find "#').concat(r,'" element, use document.body')),r=document.body)}Wt.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(i));const d=DE(DE(DE({},this._getDefaultPlayerConfig()),i),{},{trackId:this.getTrackId(),element:r});this._player?this._player.updateConfig(d):(r instanceof HTMLVideoElement?this._player=new IF(d):this._player=new wF(d),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const h=this.getVideoElementVisibleStatus();this.safeEmit(RO.VIDEO_ELEMENT_VISIBLE_STATUS,h)}catch{}},_s("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Wt.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(Wt.info("[".concat(this.getTrackId(),"] start setEnabled"),r),!r){this._originMediaStreamTrack.enabled=!1;try{await CE(this,P_.NEED_DISABLE_TRACK,this)}catch(d){throw Wt.error("[".concat(this.getTrackId(),"] setEnabled to false error"),d.toString()),d}return i||(this._enabled=!1),void Wt.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await CE(this,P_.NEED_ENABLE_TRACK,this)}catch(d){throw Wt.error("[".concat(this.getTrackId(),"] setEnabled to true error"),d.toString()),d}Wt.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}async setMuted(r){r!==this._muted&&(this.stateCheck("muted",r),this._muted=r,this._originMediaStreamTrack.enabled=!r,Wt.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(r)),r?await CE(this,P_.NEED_MUTE_TRACK,this):await CE(this,P_.NEED_UNMUTE_TRACK,this))}async setSaveEncodeBitrateRatio(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:this._saveEncodeBitrateRatio;if(this._saveEncodeBitrateRatio!==1&&this._encoderConfig&&this._encoderConfig.bitrateMax&&this._encoderConfig.bitrateMin){this._encoderConfig.bitrateMin=Math.floor(this._encoderConfig.bitrateMin*r),this._encoderConfig.bitrateMax=Math.floor(this._encoderConfig.bitrateMax*r),Wt.debug("[".concat(this.getTrackId(),"] set save encode bitrate ratio, ").concat(r)),this._saveEncodeBitrateRatio=1;try{await CE(this,P_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(Wt)}}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new n_(Gi.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(r=ZT(r),_s("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),r.width||r.height||r.frameRate){const d=UL({encoderConfig:r});(yS()||LS()||JT())&&(d.deviceId=void 0),Wt.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(d));try{await this._originMediaStreamTrack.applyConstraints(d),this.updateMediaStreamTrackResolution()}catch(h){const f=new n_(Gi.UNEXPECTED_ERROR,h.toString());throw Wt.error("[".concat(this.getTrackId(),"] applyConstraints error"),f.toString()),f}}this._encoderConfig=r,this._hints.indexOf(wE.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await CE(this,P_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(d){return d.throw(Wt)}}getStats(){return I0(()=>{Wt.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),mT(this,P_.GET_STATS)||DE({},EF)}async setBeautyEffect(r){Wt.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(r,i):await RF(r)}async findClosestProfile(){const{width:r,height:i,frameRate:d}=this.getMediaStreamTrackSettings(),{width:h,height:f,frameRate:g}=this._encoderConfig||{},b=EO(this._videoWidth||r||h||0),C=EO(this._videoHeight||i||f||0),P=function(x,H,$){if(!Array.isArray(_s("VIDEO_ENCODER_CONFIG_LIST"))||_s("VIDEO_ENCODER_CONFIG_LIST").length===0)return!1;const _t=Math.min(x,H);return!(_t>=480)&&DE(DE({},_s("VIDEO_ENCODER_CONFIG_LIST").find(_i=>_i.height>_t)),{},{frameRate:$})}(b,C,EO(d||g||15));if(P)return Wt.debug("[".concat(this.getTrackId(),"] find closest profile, ").concat(b,"x").concat(C," => ").concat(JSON.stringify(P))),this.setEncoderConfiguration(P)}async setBitrateLimit(r){Wt.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(r))),r&&(this._forceBitrateLimit=r,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<r.max_bitrate?this._encoderConfig.bitrateMax:r.max_bitrate:this._encoderConfig.bitrateMax=r.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=r.min_bitrate))}async setOptimizationMode(r){if(r!=="motion"&&r!=="detail"&&r!=="balanced")return void Wt.error(Gi.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const i=this._optimizationMode;try{this._optimizationMode=r,await CE(this,P_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this)}catch(d){throw this._optimizationMode=i,Wt.error("[".concat(this.getTrackId(),"] set optimization mode failed"),d.toString()),d}Wt.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(r,")"))}setScalabiltyMode(r){if(r.numSpatialLayers===1&&r.numTemporalLayers!==1)return Wt.error(Gi.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabilityMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabilityMode=r,Wt.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(r,")"))}updateMediaStreamTrackResolution(){p9(this._originMediaStreamTrack).then(r=>{let[i,d]=r;this._videoHeight=d,this._videoWidth=i}).catch(wL)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}async setSenderConfiguration(r){if(!this._enabled)throw new n_(Gi.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");Wt.debug("[".concat(this.getTrackId(),"] setSenderConfiguration applyConstraints"),JSON.stringify(r)),r=ZT(r),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:r.bitrateMin),this._encoderConfig=r,this._hints.indexOf(wE.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await CE(this,P_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(i){return i.throw(Wt)}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:r,height:i,frameRate:d}=this.getMediaStreamTrackSettings();if(!r||!i||!d)return;const{bitrateMax:h,bitrateMin:f}=this._encoderConfig;if(f==null||h==null){const{max:g,min:b}=function(C,P,x,H,$){const _t=_s("BITRATE_ADAPTER_TYPE");if(_t==="DEFAULT_BITRATE")return{min:H,max:$};if($===void 0){const _i=Math.floor(200*Math.pow(x/15,.6)*Math.pow(C*P/640/360,.75));$=_t==="STANDARD_BITRATE"?4*_i:2*_i,H=H??_i}else H=H??Math.floor($/10);return{min:H,max:$}}(r,i,d,f,h);if(this._encoderConfig.bitrateMin=b,this._encoderConfig.bitrateMax=g,_s("VIDEO_STANDARD_BITRATE_VERSION")&&f==null&&h==null){const[C,P]=function(x,H,$){const _t=4*Math.floor(2e5*Math.pow($/15,.6)*Math.pow(x*H/230400,.75)),_i=x*H,ue=new Map([[19200,.9],[230400,.85],[518400,.75],[921600,.7],[2073600,.6],[3686400,.5]]),_r=new Map([[230400,.95],[518400,.9],[921600,.85],[2073600,.8]]);let Fi=sT(ue).call(ue).next().value,Di=1;if(ue.has(_i))Fi=ue.get(_i);else{var Js;const p_=nI(Js=Array.from(ue.entries())).call(Js,($_,F_)=>{let[mE]=$_,[pE]=F_;return mE-pE}),Q_=p_.find($_=>{let[F_]=$_;return F_>_i});if(Q_){const $_=p_.indexOf(Q_);if($_>0){const F_=p_[$_-1],mE=(_i-F_[0])/(Q_[0]-F_[0]);Fi=F_[1]+mE*(Q_[1]-F_[1])}else Fi=Q_[1]}else Fi=p_[p_.length-1][1]}if(_r.has(_i))Di=_r.get(_i);else{var _l;const p_=nI(_l=Array.from(_r.entries())).call(_l,($_,F_)=>{let[mE]=$_,[pE]=F_;return mE-pE}),Q_=p_.find($_=>{let[F_]=$_;return F_>_i});if(Q_){const $_=p_.indexOf(Q_);if($_>0){const F_=p_[$_-1],mE=(_i-F_[0])/(Q_[0]-F_[0]);Di=F_[1]+mE*(Q_[1]-F_[1])}else Di=Q_[1]}else Di=p_[p_.length-1][1]}const _u=_s("VIDEO_NEW_BITRATE_RATIO");_u&&_u>0&&(Fi=_u/100);const ga=Math.floor(_t*Fi),_m=Math.floor(65e4*Math.pow(x*H/230400,.5)*Math.pow($/15,.69));let r_=ga;const a_=_s("VIDEO_STANDARD_BITRATE_VERSION");return a_&&a_>0&&(a_===1?r_=_t:a_===2?r_=ga:a_===3&&(r_=_m)),[Math.floor(r_/1e3),Di]}(r,i,d);this._encoderConfig.bitrateMax=C,this._encoderConfig.bitrateMin=b?Math.min(b,C):C,this._saveEncodeBitrateRatio=P,Wt.debug("[".concat(this.getTrackId(),"] update new bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(d,"] => [brMax: ").concat(this._encoderConfig.bitrateMax,", brMin: ").concat(this._encoderConfig.bitrateMin,", save_bitrate_ratio: ").concat(this._saveEncodeBitrateRatio,"]"))}else Wt.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(r,", h: ").concat(i,", fps: ").concat(d,"] => [brMax: ").concat(g,", brMin: ").concat(b,"]")),this._saveEncodeBitrateRatio=1}}getVideoElementVisibleStatus(){try{var r,i;const d=this==null||(r=this._player)===null||r===void 0?void 0:r.getContainerElement(),h={track:this,element:this==null||(i=this._player)===null||i===void 0?void 0:i.getVideoElement(),slot:d==null?void 0:d.parentElement},{element:f,slot:g}=h;if(this.isPlaying&&f instanceof HTMLVideoElement&&g instanceof HTMLElement){const b=f4.checkOneElementVisible(f),C=Object.assign({},b);if(C.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=C.visible;const P=k_.reportApiInvoke(null,{tag:FE.TRACER,name:QE.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});C.visible?P.onSuccess("Video is visible"):P.onSuccess("Invisible because of ".concat(C.reason))}return C}return}catch(d){throw new n_(Gi.GET_VIDEO_ELEMENT_VISIBLE_ERROR,d.message)}}async renewMediaStreamTrack(r){}pipe(r){if(this.processor===r)return r;if(r._source)throw new n_(Gi.INVALID_OPERATION,"Processor ".concat(r.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=r,this.processor._source=this,r.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),r}unpipe(){if(!this.processor)return;const r=this.processor;this.processor._source=void 0,this.processor=void 0,r.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],d=this._encoderConfig;r&&(d=DE(DE({},d),ZT(r))),d=lI(d);const h=AE(8,"track-video-cloned-"),f=new oZ(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,d,lI(this._scalabilityMode),this._optimizationMode,h,lI(this._hints));return r&&d&&f.setEncoderConfiguration(d),Wt.debug("clone video track from ".concat(this.getTrackId()," to ").concat(h,", clone ").concat(i)),f}async replaceTrack(r,i){if(!(r instanceof MediaStreamTrack))throw new n_(Gi.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(r.kind!=="video")throw new n_(Gi.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(r,i,!0),this.updateMediaStreamTrackResolution()}sendSeiData(r){if(I0(()=>{k_.reportApiInvoke(null,{name:QE.LOCAL_VIDEO_SEND_SEI_DATA,options:[],tag:FE.TRACER}).onSuccess("")},this._mediaStreamTrack.id||this.getTrackId()),!_s("ENABLE_VIDEO_SEI")||!_s("ENABLE_ENCODED_TRANSFORM"))return void Wt.warning('To send/receive SEI, please call AgoraRTC.setParameter("ENABLE_VIDEO_SEI", true) before instantiate IAgoraRtcClient');if(r instanceof Uint8Array==0)return new n_(Gi.INVALID_PARAMS,"Invalid argument type, ILocalVideoTrack.sendSeiData() only accept Uint8Array argument.").throw();const i=this.getRTCRtpTransceiver();if(!i)return void Wt.warning("Video track is not published, SEI can not be send");const d=i.sender.getParameters();if(d.codecs.length===0)return;const h=d.codecs[0].mimeType.toLocaleLowerCase();h==="video/h264"||h==="video/h265"?this.safeEmit("sei-to-send",r):Wt.warning("SEI is not supported by ".concat(h))}bindProcessorDestinationEvents(){this.processorDestination.on(BS.ON_TRACK,async r=>{r?r!==this._mediaStreamTrack&&(this._mediaStreamTrack=r,this._updatePlayerSource(),await CE(this,P_.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await CE(this,P_.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(BS.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(gT.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(gT.REQUEST_CONSTRAINTS)}},iE(tE.prototype,"play",[i7,o7],Object.getOwnPropertyDescriptor(tE.prototype,"play"),tE.prototype),iE(tE.prototype,"stop",[s7],Object.getOwnPropertyDescriptor(tE.prototype,"stop"),tE.prototype),iE(tE.prototype,"setEnabled",[a7,c7,u7],Object.getOwnPropertyDescriptor(tE.prototype,"setEnabled"),tE.prototype),iE(tE.prototype,"setMuted",[d7,l7,h7],Object.getOwnPropertyDescriptor(tE.prototype,"setMuted"),tE.prototype),iE(tE.prototype,"setSaveEncodeBitrateRatio",[p7,f7],Object.getOwnPropertyDescriptor(tE.prototype,"setSaveEncodeBitrateRatio"),tE.prototype),iE(tE.prototype,"setEncoderConfiguration",[m7,_7],Object.getOwnPropertyDescriptor(tE.prototype,"setEncoderConfiguration"),tE.prototype),iE(tE.prototype,"getStats",[E7],Object.getOwnPropertyDescriptor(tE.prototype,"getStats"),tE.prototype),iE(tE.prototype,"setBeautyEffect",[g7,v7],Object.getOwnPropertyDescriptor(tE.prototype,"setBeautyEffect"),tE.prototype),iE(tE.prototype,"getCurrentFrameData",[b7],Object.getOwnPropertyDescriptor(tE.prototype,"getCurrentFrameData"),tE.prototype),iE(tE.prototype,"getCurrentFrameImage",[y7],Object.getOwnPropertyDescriptor(tE.prototype,"getCurrentFrameImage"),tE.prototype),iE(tE.prototype,"findClosestProfile",[S7,T7],Object.getOwnPropertyDescriptor(tE.prototype,"findClosestProfile"),tE.prototype),iE(tE.prototype,"setBitrateLimit",[R7],Object.getOwnPropertyDescriptor(tE.prototype,"setBitrateLimit"),tE.prototype),iE(tE.prototype,"setOptimizationMode",[I7],Object.getOwnPropertyDescriptor(tE.prototype,"setOptimizationMode"),tE.prototype),iE(tE.prototype,"setScalabiltyMode",[w7],Object.getOwnPropertyDescriptor(tE.prototype,"setScalabiltyMode"),tE.prototype),iE(tE.prototype,"updateMediaStreamTrackResolution",[C7],Object.getOwnPropertyDescriptor(tE.prototype,"updateMediaStreamTrackResolution"),tE.prototype),iE(tE.prototype,"pipe",[A7],Object.getOwnPropertyDescriptor(tE.prototype,"pipe"),tE.prototype),iE(tE.prototype,"unpipe",[O7],Object.getOwnPropertyDescriptor(tE.prototype,"unpipe"),tE.prototype),iE(tE.prototype,"close",[N7],Object.getOwnPropertyDescriptor(tE.prototype,"close"),tE.prototype),iE(tE.prototype,"replaceTrack",[P7],Object.getOwnPropertyDescriptor(tE.prototype,"replaceTrack"),tE.prototype),tE),VL=(D7=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),k7=JE(),L7=gO("CameraVideoTrack","_enabledMutex"),M7=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),x7=JE(),U7=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),V7=JE(),j7=V_({argsMap:e=>[e.getTrackId()]}),TT=class sZ extends LE{get __className__(){return"CameraVideoTrack"}constructor(r,i,d,h,f,g){super(r,ZT(i.encoderConfig),h,f,g),Qm(this,"_config",void 0),Qm(this,"_originalConstraints",void 0),Qm(this,"_constraints",void 0),Qm(this,"_enabled",!0),Qm(this,"_deviceName","default"),Qm(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(fO()||HV())&&!function(){const b=oE();if(b.os!==aS.IOS||!b.osVersion)return!1;const C=b.osVersion.split(".");return Number(C[0])===15&&Number(C[1])>=2}()&&d4()&&this._enabled&&!this._isClosed&&(Wt.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=i,this._originalConstraints=d,this._constraints=d,this._deviceName=r.label,this._encoderConfig=ZT(this._config.encoderConfig),TE.on(ES.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),TE.on(ES.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(r){return typeof r=="string"?this._setDeviceById(r):r.deviceId?this._setDeviceById(r.deviceId):r.facingMode?this._setDeviceByFacingModel(r.facingMode):void 0}async _setDeviceById(r){if(Wt.info("[".concat(this.getTrackId(),"] set device to ").concat(r)),this._enabled)try{const i=await yT.getDeviceById(r),d={};d.video=DE({},this._constraints),d.video.deviceId={exact:r},d.video.facingMode=void 0,this._originMediaStreamTrack.stop();let h=null;try{h=await bT(d,this.getTrackId())}catch(f){throw Wt.error("[".concat(this.getTrackId(),"] setDevice failed"),f.toString()),h=await bT({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),f}await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw Wt.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}else try{const i=await yT.getDeviceById(r);this._deviceName=i.label,this._config.cameraId=r,this._constraints.deviceId={exact:r}}catch(i){throw Wt.error("[".concat(this.getTrackId(),"] setDevice error"),i.toString()),i}Wt.info("[".concat(this.getTrackId(),"] setDevice success"))}async _setDeviceByFacingModel(r){Wt.info("[".concat(this.getTrackId(),"] set facingMode ").concat(r));const i={video:DE(DE({},this._constraints),{},{deviceId:void 0,facingMode:{exact:r}})};if(this._enabled){this._originMediaStreamTrack.stop();let d=null;try{d=await bT(i,this.getTrackId())}catch(h){throw Wt.error("[".concat(this.getTrackId(),"] setDeviceByFacingModel failed"),h.toString()),d=await bT({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),h}await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution()}this._deviceName="",this._config.facingMode=r,this._config.cameraId=void 0,this._constraints=DE({},i.video),Wt.info("[".concat(this.getTrackId(),"] setDeviceByFacingModel success"))}async setEnabled(r,i){if(!i){if(r===this._enabled)return;this.stateCheck("enabled",r)}if(Wt.info("[".concat(this.getTrackId(),"] start setEnabled"),r),r){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const d=await bT({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getVideoTracks()[0],!1)}await CE(this,P_.NEED_ENABLE_TRACK,this)}catch(d){throw Wt.error("[".concat(this.getTrackId(),"] setEnabled true error"),d.toString()),d}this.updateMediaStreamTrackResolution(),Wt.info("[".concat(this.getTrackId(),"] setEnabled to true success")),i||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),i||(this._enabled=!1);try{await CE(this,P_.NEED_DISABLE_TRACK,this)}catch(d){throw Wt.error("[".concat(this.getTrackId(),"] setEnabled to false error"),d.toString()),d}Wt.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(r,i){if(!this._enabled)throw new n_(Gi.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");r=ZT(r),_s("USE_STANDARD_BITRATE_DEFAULT")&&(delete r.bitrateMax,delete r.bitrateMin),this._forceBitrateLimit&&(r.bitrateMax=this._forceBitrateLimit.max_bitrate||r.bitrateMax,r.bitrateMin=this._forceBitrateLimit.min_bitrate||r.bitrateMin);const d=BE(this._config);d.encoderConfig=r;const h=UL(d);(yS()||LS()||JT())&&(h.deviceId=void 0),Wt.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(r),JSON.stringify(h));try{await this._originMediaStreamTrack.applyConstraints(h),this.updateMediaStreamTrackResolution()}catch(f){const g=new n_(Gi.UNEXPECTED_ERROR,f.toString());throw Wt.error("[".concat(this.getTrackId(),"] applyConstraints error"),g.toString()),g}this._config=d,this._constraints=h,this._originalConstraints=h,this._encoderConfig=r,this._hints.indexOf(wE.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await CE(this,P_.NEED_UPDATE_VIDEO_ENCODER,this)}catch(f){return f.throw(Wt)}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((LS()||JT())&&this._enabled&&!this._isClosed&&TE.duringInterruption){const r=async()=>{TE.off(ES.IOS_INTERRUPTION_END,r),this._enabled&&!this._isClosed&&(Wt.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};TE.on(ES.IOS_INTERRUPTION_END,r)}else Wt.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(RO.TRACK_ENDED)}async renewMediaStreamTrack(r){const i=r||this._constraints,d=yT.searchDeviceIdByName(this._deviceName);if(d&&!i.deviceId&&(i.deviceId={exact:d}),this._enabled){const h=await bT({video:i},this.getTrackId());this._constraints=i,await this._updateOriginMediaStreamTrack(h.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),TE.off(ES.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),TE.off(ES.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}clone(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1],d=this._encoderConfig;r&&(d=DE(DE({},d),ZT(r))),d=lI(d);const h=AE(8,"track-cam-cloned-"),f=new sZ(i?this._mediaStreamTrack.clone():this._mediaStreamTrack,lI(DE(DE({},this._config),{},{encoderConfig:d})),lI(this._constraints),lI(this._scalabilityMode),this._optimizationMode,h);return r&&d&&f.setEncoderConfiguration(d),Wt.debug("clone track from ".concat(this.getTrackId()," to ").concat(h,", clone ").concat(i)),f}bindProcessorContextEvents(){this.processorContext.on(gT.REQUEST_UPDATE_CONSTRAINTS,async(r,i,d)=>{try{const h=Object.assign({},this._originalConstraints,...r);await this.renewMediaStreamTrack(h),i()}catch(h){d(h)}}),this.processorContext.on(gT.REQUEST_CONSTRAINTS,async r=>{r(this._originMediaStreamTrack.getSettings())})}},iE(TT.prototype,"setDevice",[D7,k7],Object.getOwnPropertyDescriptor(TT.prototype,"setDevice"),TT.prototype),iE(TT.prototype,"setEnabled",[L7,M7,x7],Object.getOwnPropertyDescriptor(TT.prototype,"setEnabled"),TT.prototype),iE(TT.prototype,"setEncoderConfiguration",[U7,V7],Object.getOwnPropertyDescriptor(TT.prototype,"setEncoderConfiguration"),TT.prototype),iE(TT.prototype,"close",[j7],Object.getOwnPropertyDescriptor(TT.prototype,"close"),TT.prototype),TT);function CF(e,r,i,d){i.optimizationMode&&(d&&d.width&&d.height?(i.encoderConfig=DE(DE({},d),{},{bitrateMin:d.bitrateMin,bitrateMax:d.bitrateMax}),i.optimizationMode!=="motion"&&i.optimizationMode!=="detail"||(r.contentHint=i.optimizationMode,r.contentHint===i.optimizationMode?Wt.debug("[".concat(e,"] set content hint to"),i.optimizationMode):Wt.debug("[".concat(e,"] set content hint failed")))):Wt.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}var F7,B7,G7,q7,PT,W7,K7,H7,z7,Y7,J7,US;class X7 extends Z4{getUserId(){return this._userId}constructor(r,i,d,h){super(r,"track-".concat(r.kind,"-").concat(i,"-").concat(h.clientId,"_").concat(AE(5,""))),Qm(this,"_userId",void 0),Qm(this,"_uintId",void 0),Qm(this,"_isDestroyed",!1),Qm(this,"store",void 0),Qm(this,"processor",void 0),Qm(this,"processorContext",void 0),this._userId=i,this._uintId=d,this.store=h}_updateOriginMediaStreamTrack(r){this._originMediaStreamTrack=r,this._mediaStreamTrack=r,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,Wt.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let OO=(F7=V_({argsMap:(e,r,i)=>[e.getTrackId(),typeof r=="string"?r:r instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",i]}),B7=V_({argsMap:e=>[e.getTrackId()]}),G7=V_({argsMap:(e,r)=>[e.getTrackId(),r.name]}),q7=V_({argsMap:e=>[e.getTrackId()]}),iE((PT=class extends X7{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==CS.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,r,i,d,h){super(e,r,i,d),Qm(this,"_videoVisibleTimer",null),Qm(this,"_previousVideoVisibleStatus",void 0),Qm(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),Qm(this,"trackMediaType",IO.VIDEO),Qm(this,"_videoWidth",void 0),Qm(this,"_videoHeight",void 0),Qm(this,"_player",void 0),Qm(this,"_prePlayer",void 0),Qm(this,"processorDestination",void 0),Qm(this,"processorContext",void 0),this._prePlayer=h,this.updateMediaStreamTrackResolution(),this.processorContext=new d9(this.getTrackId(),"remote"),this.processorDestination=new u9(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return I0(()=>{Wt.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),mT(this,P_.GET_STATS)||DE({},X4)}play(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(this.safeEmit(NT.PLAY_START),typeof e=="string"){const d=document.getElementById(e);d?e=d:(Wt.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}Wt.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(r));const i=DE(DE({fit:"cover"},r),{},{trackId:this.getTrackId(),element:e});if(this._player)this._player.updateConfig(i);else{let d=!1,h=!1;e instanceof HTMLVideoElement?(this._player=new IF(i),this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0,h=!0)):this._prePlayer&&!this._prePlayer.isDestroyed?(this._player=this._prePlayer,this._prePlayer=void 0,d=this._player.videoState>0,this._player.updateConfig(i)):this._player=new wF(i),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(NT.FIRST_FRAME_DECODED),h&&this.safeEmit(NT.FIRST_FRAME_RENDER)},this._player.onVideoStateChanged=f=>{this.safeEmit(NT.VIDEO_STATE_CHANGED,f)},d&&(this._player.onFirstVideoFrameDecoded(),this._player.onVideoStateChanged(this._player.videoState))}this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const d=this.getVideoElementVisibleStatus();this.safeEmit(NT.VIDEO_ELEMENT_VISIBLE_STATUS,d)}catch{}},_s("CHECK_VIDEO_VISIBLE_INTERVAL")),this.safeEmit(NT.PLAY_END)}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,Wt.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){p9(this._originMediaStreamTrack).then(e=>{let[r,i]=e;this._videoHeight=i,this._videoWidth=r}).catch(wL)}_updatePlayerSource(){Wt.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,r;const i=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),d={track:this,element:this==null||(r=this._player)===null||r===void 0?void 0:r.getVideoElement(),slot:i==null?void 0:i.parentElement},{element:h,slot:f}=d;if(this.isPlaying&&h instanceof HTMLVideoElement&&f instanceof HTMLElement){const g=f4.checkOneElementVisible(h),b=Object.assign({},g);if(b.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=b.visible;const C=k_.reportApiInvoke(null,{tag:FE.TRACER,name:QE.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});b.visible?C.onSuccess("Video is visible"):C.onSuccess("Invisible because of ".concat(b.reason))}return b}return}catch(i){throw new n_(Gi.GET_VIDEO_ELEMENT_VISIBLE_ERROR,i.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new n_(Gi.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(BS.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(BS.ON_TRACK)}_destroy(){this._prePlayer&&(this._prePlayer.destroy(),this._prePlayer=void 0),super._destroy(),this.unbindProcessorDestinationEvents()}_onSei(e){this.emit(mI.SEI_RECEIVED,e)}}).prototype,"play",[F7],Object.getOwnPropertyDescriptor(PT.prototype,"play"),PT.prototype),iE(PT.prototype,"stop",[B7],Object.getOwnPropertyDescriptor(PT.prototype,"stop"),PT.prototype),iE(PT.prototype,"pipe",[G7],Object.getOwnPropertyDescriptor(PT.prototype,"pipe"),PT.prototype),iE(PT.prototype,"unpipe",[q7],Object.getOwnPropertyDescriptor(PT.prototype,"unpipe"),PT.prototype),PT),NO=(W7=V_({argsMap:(e,r)=>[e.getTrackId(),r],throttleTime:300}),K7=V_({argsMap:(e,r)=>[e.getTrackId(),r]}),H7=V_({argsMap:e=>[e.getTrackId()]}),z7=V_({argsMap:e=>[e.getTrackId()]}),Y7=V_({argsMap:(e,r)=>[e.getTrackId(),r.name]}),J7=V_({argsMap:e=>[e.getTrackId()]}),iE((US=class extends X7{get isPlaying(){return this._useAudioElement?YS.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,r,i,d){super(e,r,i,d),Qm(this,"trackMediaType",IO.AUDIO),Qm(this,"_source",void 0),Qm(this,"_useAudioElement",!0),Qm(this,"_volume",100),Qm(this,"processorContext",void 0),Qm(this,"processorDestination",void 0),Qm(this,"_played",!1),Qm(this,"_bypassWebAudio",!1),_s("DISABLE_WEBAUDIO")?(this._source=new TF,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new n9(e,!0),_s("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(ET.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(NT.FIRST_FRAME_DECODED)}),this.processorContext=new h9(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new l9(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(ET.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(ET.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(r),this._source.removeAllListeners(ET.ON_AUDIO_BUFFER),this._source.on(ET.ON_AUDIO_BUFFER,i=>e(i))}setVolume(e){this._volume=e,this._useAudioElement?YS.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement||!H4())throw new n_(Gi.NOT_SUPPORTED,"your browser does not support setting the audio output device");await YS.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return I0(()=>{Wt.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),mT(this,P_.GET_STATS)||DE({},J4)}play(){Wt.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(Wt.debug("[".concat(this.getTrackId(),"] use audio element to play")),YS.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){Wt.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?YS.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];Wt.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&YS.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new n_(Gi.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new n_(Gi.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new n_(Gi.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const r=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,r.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(BS.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(BS.ON_NODE,e=>{this._source.processedNode=e;const r=!e;this._useAudioElement!==r&&(this._played?(this.stop(),this._useAudioElement=r,this.play()):this._useAudioElement=r)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(BS.ON_TRACK),this.processorDestination.removeAllListeners(BS.ON_NODE)}}).prototype,"setVolume",[W7],Object.getOwnPropertyDescriptor(US.prototype,"setVolume"),US.prototype),iE(US.prototype,"setPlaybackDevice",[K7],Object.getOwnPropertyDescriptor(US.prototype,"setPlaybackDevice"),US.prototype),iE(US.prototype,"play",[H7],Object.getOwnPropertyDescriptor(US.prototype,"play"),US.prototype),iE(US.prototype,"stop",[z7],Object.getOwnPropertyDescriptor(US.prototype,"stop"),US.prototype),iE(US.prototype,"pipe",[Y7],Object.getOwnPropertyDescriptor(US.prototype,"pipe"),US.prototype),iE(US.prototype,"unpipe",[J7],Object.getOwnPropertyDescriptor(US.prototype,"unpipe"),US.prototype),US);const jR=new class extends qE{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),Qm(this,"_lastHiddenTime",0),Qm(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),Wt.debug("current web page is ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};class Q7 extends qE{constructor(r,i){super(),Qm(this,"trackMediaType",IO.DATA),Qm(this,"_version",1),Qm(this,"_type",3),Qm(this,"_config",void 0),Qm(this,"_originDataChannel",void 0),Qm(this,"_dataStreamPacketHeader",new ArrayBuffer(4)),Qm(this,"_dataStreamPacketHandler",{serialize:d=>d,deserialize:d=>d}),Qm(this,"_datachannelEventMap",new Map),this._config=r,i&&(this._originDataChannel=i,this._bandDataChannelEvents(i)),this._initPacketHeader()}useDataStream(r){this._dataStreamPacketHandler=r}get id(){return this._config.id}get ordered(){return this._config.ordered}get maxRetransmits(){return _s("DATASTREAM_MAX_RETRANSMITS")}get metadata(){return this._config.metadata}get readyState(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.readyState)!==null&&r!==void 0?r:"connecting"}get _originDataChannelId(){var r,i;return(r=(i=this._originDataChannel)===null||i===void 0?void 0:i.id)!==null&&r!==void 0?r:null}getChannelId(){return this.id}getConfig(){return this._config}_close(){this._originDataChannel&&(this._unbindDataChannelEvents(this._originDataChannel),this._originDataChannel=void 0)}async _waitTillOpen(){return new T_((r,i)=>{if(this._originDataChannel){this._originDataChannel.readyState==="open"&&r();const d=setTimeout(()=>{var h;i(new n_(Gi.DATACHANNEL_CONNECTION_TIMEOUT,"Cannot create datachannel, id: ".concat((h=this._originDataChannel)===null||h===void 0?void 0:h.id)))},1e4);this._originDataChannel.onopen=()=>{clearTimeout(d),this._originDataChannel&&this._bandDataChannelEvents(this._originDataChannel),r()},this._originDataChannel.onerror=()=>{throw clearTimeout(d),new n_(Gi.DATACHANNEL_CONNECTION_TIMEOUT)}}else i(new n_(Gi.DATACHANNEL_CONNECTION_TIMEOUT,"cannot find dataChannel"))})}_updateOriginDataChannel(r){this._originDataChannel=r,this._bandDataChannelEvents(r)}_initPacketHeader(){const r=new DataView(this._dataStreamPacketHeader);r.setUint16(0,this._version),r.setUint8(2,this._type),r.setUint8(3,this._config.id)}_bandDataChannelEvents(r){this._unbindDataChannelEvents(r),[ML.OPEN,ML.CLOSE,ML.ERROR].forEach(i=>{const d=()=>{this.emit(i)};this._datachannelEventMap.set(i,d),r.addEventListener(i,d)})}_unbindDataChannelEvents(r){Array.from(this._datachannelEventMap.entries()).forEach(i=>{let[d,h]=i;r.removeEventListener(d,h)}),this._datachannelEventMap.clear()}}class glt extends Q7{constructor(r){super(r),Qm(this,"_messageListener",void 0),this._messageListener=i=>{if(i.data.byteLength<this._dataStreamPacketHeader.byteLength)throw Error("invalid byteLength: the byte length must exceed "+this._dataStreamPacketHeader.byteLength);const d=i.data.slice(0,this._dataStreamPacketHeader.byteLength),h=new DataView(d).getUint8(3);if(h!==this.id)return void(_s("SHOW_DATASTREAM2_LOG")&&Wt.debug("invalid datachannel id: ".concat(h," !== ").concat(this.id)));let f=i.data.slice(this._dataStreamPacketHeader.byteLength);f=this._dataStreamPacketHandler.deserialize(f),this.emit(ML.MESSAGE,f)}}_updateOriginDataChannel(r){super._updateOriginDataChannel(r),this._bandRemoteDataChannelEvents()}_close(){this._originDataChannel&&(this._originDataChannel.removeEventListener("message",this._messageListener),super._close())}_bandRemoteDataChannelEvents(){this._originDataChannel&&this._originDataChannel.addEventListener("message",this._messageListener)}}class vlt extends Q7{send(r){if(this._originDataChannel){let i=r;i=this._dataStreamPacketHandler.serialize(r);const d=new Uint8Array(this._dataStreamPacketHeader.byteLength+i.byteLength);d.set(new Uint8Array(this._dataStreamPacketHeader),0),d.set(new Uint8Array(i),this._dataStreamPacketHeader.byteLength),this._originDataChannel.send(d.buffer)}}}function jL(){const e=new Blob([atob("Y29uc3QgdD0idmlkZW8vaDI2NCIsZT0idmlkZW8vaDI2NSI7ZnVuY3Rpb24gbih0LGUsbil7bGV0IGE9bmV3IFVpbnQ4QXJyYXkodCxlLG4pLHI9W10sbz0wO2Zvcig7ci5sZW5ndGg8bjspbyszPG4mJjA9PT1hW29dJiYwPT09YVtvKzFdJiYzPT09YVtvKzJdJiYoMD09PWFbbyszXXx8MT09PWFbbyszXXx8Mj09PWFbbyszXXx8Mz09PWFbbyszXSk/KHIucHVzaChhW29dLGFbbysxXSxhW28rM10pLG8rPTQpOihyLnB1c2goYVtvXSksbysrKTtyZXR1cm4gbmV3IFVpbnQ4QXJyYXkocil9ZnVuY3Rpb24gYShhLHIpe3N3aXRjaChyKXtjYXNlIHQ6cmV0dXJuIGZ1bmN0aW9uKHQpe2NvbnN0IGU9bmV3IERhdGFWaWV3KHQuZGF0YSk7bGV0IGE9MDtmb3IoO2ErNDx0LmRhdGEuYnl0ZUxlbmd0aDspe2lmKDA9PT1lLmdldFVpbnQ4KGErMCkmJjA9PT1lLmdldFVpbnQ4KGErMSkmJjA9PT1lLmdldFVpbnQ4KGErMikmJjE9PT1lLmdldFVpbnQ4KGErMykmJjY9PT1lLmdldFVpbnQ4KGErNCkpe2xldCByPWErNixvPTAsaT0wO2Zvcig7MjU1PT09KGk9ZS5nZXRVaW50OChyKyspKTspbys9MjU1O28rPWk7Y29uc3Qgcz1uKHQuZGF0YSxyLG8pO3JldHVybiBuZXcgVWludDhBcnJheShzKX1hKyt9cmV0dXJuIG51bGx9KGEpO2Nhc2UgZTpyZXR1cm4gZnVuY3Rpb24odCl7Y29uc3QgZT1uZXcgRGF0YVZpZXcodC5kYXRhKTtsZXQgYT0wO2Zvcig7YSs1PHQuZGF0YS5ieXRlTGVuZ3RoOyl7aWYoMD09PWUuZ2V0VWludDgoYSswKSYmMD09PWUuZ2V0VWludDgoYSsxKSYmMD09PWUuZ2V0VWludDgoYSsyKSYmMT09PWUuZ2V0VWludDgoYSszKSYmNzg9PT1lLmdldFVpbnQ4KGErNCkmJjE9PT1lLmdldFVpbnQ4KGErNSkmJjEwMT09PWUuZ2V0VWludDgoYSs2KSl7bGV0IHI9YSs3LG89MCxpPTA7Zm9yKDsyNTU9PT0oaT1lLmdldFVpbnQ4KHIrKykpOylvKz0yNTU7bys9aTtjb25zdCBzPW4odC5kYXRhLHIsbyk7cmV0dXJuIG5ldyBVaW50OEFycmF5KHMpfWErK31yZXR1cm4gbnVsbH0oYSk7ZGVmYXVsdDpyZXR1cm4gbnVsbH19ZnVuY3Rpb24gcih0KXtjb25zdCBlPXQubGVuZ3RoO2xldCBuPVtdLGE9MDtmb3IoO2E8ZTspYSsyPGUmJjA9PT10W2FdJiYwPT09dFthKzFdJiYoMD09PXRbYSsyXXx8MT09PXRbYSsyXXx8Mj09PXRbYSsyXXx8Mz09PXRbYSsyXSk/KG4ucHVzaCh0W2FdLHRbYSsxXSwzLHRbYSsyXSksYSs9Myk6KG4ucHVzaCh0W2FdKSxhKyspO3JldHVybiBuZXcgVWludDhBcnJheShuKX1mdW5jdGlvbiBvKG4sYSxvKXtzd2l0Y2gobyl7Y2FzZSB0OnJldHVybiBmdW5jdGlvbih0LGUpe2NvbnN0IG49cihlKSxhPW4ubGVuZ3RoLG89TWF0aC5mbG9vcihhLzI1NSksaT1hJTI1NSxzPW5ldyBVaW50OEFycmF5KDYrbysxK2ErdC5ieXRlTGVuZ3RoKTtzWzBdPTAsc1sxXT0wLHNbMl09MCxzWzNdPTEsc1s0XT02LHNbNV09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNitmXT0yNTUsZisrO3JldHVybiBzWzYrZl09aSxmKysscy5zZXQobiw2K2YpLHMuc2V0KG5ldyBVaW50OEFycmF5KHQpLDYrZithKSxzLmJ1ZmZlcn0obixhKTtjYXNlIGU6cmV0dXJuIGZ1bmN0aW9uKHQsZSl7Y29uc3Qgbj1yKGUpLGE9bi5sZW5ndGgsbz1NYXRoLmZsb29yKGEvMjU1KSxpPWElMjU1LHM9bmV3IFVpbnQ4QXJyYXkoNytvKzErYSsxK3QuYnl0ZUxlbmd0aCk7c1swXT0wLHNbMV09MCxzWzJdPTAsc1szXT0xLHNbNF09Nzgsc1s1XT0xLHNbNl09MTAxO2xldCBmPTA7Zm9yKDtmPG87KXNbNytmXT0yNTUsZisrO3JldHVybiBzWzcrZl09aSxmKysscy5zZXQobiw3K2YpLGYrPWEsc1s3K2ZdPTEyOCxmKysscy5zZXQobmV3IFVpbnQ4QXJyYXkodCksNytmKSxzLmJ1ZmZlcn0obixhKTtkZWZhdWx0OnJldHVybiBudWxsfX1mdW5jdGlvbiBpKG4pe2lmKG4ubGVuZ3RoPDUpcmV0dXJuIiI7bGV0IGE9LTE7Zm9yKGxldCB0PTA7dDxuLmxlbmd0aC0zO3QrKyl7aWYoMD09PW5bdF0mJjA9PT1uW3QrMV0mJjE9PT1uW3QrMl0pe2E9dDticmVha31pZih0PG4ubGVuZ3RoLTQmJjA9PT1uW3RdJiYwPT09blt0KzFdJiYwPT09blt0KzJdJiYxPT09blt0KzNdKXthPXQ7YnJlYWt9fWlmKC0xPT09YSlyZXR1cm4iIjtjb25zdCByPWErKDA9PT1uW2ErMl0/NDozKTtpZihyPj1uLmxlbmd0aClyZXR1cm4iIjtjb25zdCBvPW5bcl07aWYoMTI4Jm8pcmV0dXJuIiI7aWYoKG8+PjEmNjMpPj0zMilyZXR1cm4gZTtpZihyKzE8bi5sZW5ndGgpe2lmKDA9PSgyNDgmbltyKzFdKSlyZXR1cm4gZX1yZXR1cm4oMzEmbyk8PTMxP3Q6IiJ9Y29uc3Qgcz03MSxmPTEsbD0yLHU9MSxnPTI7dmFyIGM7ZnVuY3Rpb24gZCh0LGU9ITEpe2NvbnN0IG49dC5nZXRVaW50OCgwKTtpZihuIT09cylyZXR1cm47Y29uc3QgYT10LmdldFVpbnQxNigxKSxyPWYrbCthLG89bmV3IFVpbnQ4QXJyYXkodC5ieXRlTGVuZ3RoLXIpO28uc2V0KG5ldyBVaW50OEFycmF5KHQuYnVmZmVyLHIsdC5ieXRlTGVuZ3RoLXIpKTtjb25zdCBpPXttOm4sdGx2TGVuOmEsdGx2OltdLGZyYW1lOm99O2xldCBkPWYrbDtmb3IoO2Q8cjspe2NvbnN0IG49dC5nZXRVaW50OChkKSxhPXQuZ2V0VWludDE2KGQrdSkscj11K2c7aWYobj09PWMuQVVESU9fTEVWRUwpe2xldCBvPXQuZ2V0VWludDgoZCtyKTtmb3IobGV0IGU9MTtlPGE7ZSsrKW89bzw8OHx0LmdldFVpbnQ4KGQrcitlKTtpLnRsdi5wdXNoKHt0YWc6bixsZW5ndGg6YSx2YWx1ZTplPzEyN15vPj4xOjEyNyZvfSl9ZWxzZSBpZihuPT09Yy5NRVRBREFUQXx8bj09PWMuQVVESU9fNjRfQklUX1BUUyl7Y29uc3QgZT1uZXcgVWludDhBcnJheShhKTtmb3IobGV0IG49MDtuPGE7bisrKWVbbl09dC5nZXRVaW50OChkK3Irbik7aS50bHYucHVzaCh7dGFnOm4sbGVuZ3RoOmEsdmFsdWU6ZX0pfWQrPXIrYX1yZXR1cm4gaX0hZnVuY3Rpb24odCl7dFt0LkFVRElPX0xFVkVMPTFdPSJBVURJT19MRVZFTCIsdFt0Lk1FVEFEQVRBPTJdPSJNRVRBREFUQSIsdFt0LkFVRElPXzY0X0JJVF9QVFM9M109IkFVRElPXzY0X0JJVF9QVFMifShjfHwoYz17fSkpLHNlbGYub25ydGN0cmFuc2Zvcm09dD0+e2NvbnN0IGU9dC50cmFuc2Zvcm1lcjtsZXQgbj1bXSxyPVtdO2Uub3B0aW9ucy5wb3J0Lm9ubWVzc2FnZT10PT57dC5kYXRhLnNlaSYmbi5wdXNoKHQuZGF0YS5zZWkpLHQuZGF0YS5tZXRhZGF0YSYmci5wdXNoKHQuZGF0YS5tZXRhZGF0YSl9LHNlbGYucG9zdE1lc3NhZ2UoInN0YXJ0ZWQiKTtjb25zdCBoPWUucmVhZGFibGUuZ2V0UmVhZGVyKCksVT1lLndyaXRhYmxlLmdldFdyaXRlcigpOyJzZWktcngiPT09ZS5vcHRpb25zLm5hbWU/ZnVuY3Rpb24gdChlKXtoLnJlYWQoKS50aGVuKChuPT57aWYoIW4uZG9uZSl7aWYobi52YWx1ZSBpbnN0YW5jZW9mIFJUQ0VuY29kZWRWaWRlb0ZyYW1lKXtjb25zdCB0PWkobmV3IFVpbnQ4QXJyYXkobi52YWx1ZS5kYXRhKSkscj1hKG4udmFsdWUsdCk7ciYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3NlaTpyfSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6InNlaS10eCI9PT1lLm9wdGlvbnMubmFtZT9mdW5jdGlvbiB0KGUpe2gucmVhZCgpLnRoZW4oKGE9PntpZighYS5kb25lKXtpZihhLnZhbHVlIGluc3RhbmNlb2YgUlRDRW5jb2RlZFZpZGVvRnJhbWUpe2NvbnN0IHQ9aShuZXcgVWludDhBcnJheShhLnZhbHVlLmRhdGEpKSxlPW4uc2hpZnQoKTtpZihlKXtjb25zdCBuPW8oYS52YWx1ZS5kYXRhLGUsdCk7biYmKGEudmFsdWUuZGF0YT1uKX19VS53cml0ZShhLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSk6ImF1ZGlvLW1ldGFkYXRhLXJ4Ij09PWUub3B0aW9ucy5uYW1lP2Z1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1uZXcgRGF0YVZpZXcobi52YWx1ZS5kYXRhKSxhPXQuZ2V0VWludDgoMCk7bGV0IHI7aWYoMCE9KDEyOCZhKSYmNzEhPT1hKXtsZXQgZT1mdW5jdGlvbih0KXtpZih0LmJ5dGVMZW5ndGg8PTApcmV0dXJuW107Y29uc3QgZT1bXTtsZXQgbj0wO2Zvcig7bjx0LmJ5dGVMZW5ndGg7KXtjb25zdCBhPSgxMjgmdC5nZXRVaW50OChuKSk+Pjcscj0xMjcmdC5nZXRVaW50OChuKTtpZighKGEmJm4rNDw9dC5ieXRlTGVuZ3RoKSl7bisrO2JyZWFrfXtjb25zdCBhPXQuZ2V0VWludDMyKG4sITEpLG89KDE2Nzc2MTkyJmEpPj4xMCxpPTEwMjMmYTtlLnB1c2goe3B0OnIsdHNfb2Zmc2V0Om8sbGVuZ3RoOmksZGF0YTpuZXcgVWludDhBcnJheX0pLG4rPTR9fWxldCBhPXQuYnl0ZUxlbmd0aC1uO2Zvcihjb25zdCByIG9mIGUpe2lmKHIubGVuZ3RoPmEpcmV0dXJuIGNvbnNvbGUud2FybigiQnJva2VuIHJlZCBwYXlsb2FkIiksW107ci5sZW5ndGg+MCYmKHIuZGF0YT1uZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixyLmxlbmd0aCksbis9ci5sZW5ndGgsYS09ci5sZW5ndGgpfWlmKGE+MCl7Y29uc3Qgcj17cHQ6ZS5sZW5ndGg+MD9lW2UubGVuZ3RoLTFdLnB0OjAsdHNfb2Zmc2V0OjAsbGVuZ3RoOmEsZGF0YTpuZXcgVWludDhBcnJheSh0LmJ1ZmZlcix0LmJ5dGVPZmZzZXQrbixhKX07ZS5wdXNoKHIpfXJldHVybiBlfSh0KTtpZihlLmxlbmd0aD4wKXtjb25zdCB0PWZ1bmN0aW9uKHQpe2xldCBlPTA7Zm9yKGxldCBuPTA7bjx0Lmxlbmd0aDtuKyspZSs9bjx0Lmxlbmd0aC0xPzQ6MSxlKz10W25dLmxlbmd0aDtjb25zdCBuPW5ldyBVaW50OEFycmF5KGUpO2xldCBhPTA7Zm9yKGxldCBlPTA7ZTx0Lmxlbmd0aDtlKyspaWYoZTx0Lmxlbmd0aC0xKXtjb25zdCByPSgyMTQ3NDgzNjQ4fCgxMjcmdFtlXS5wdCk8PDI0fCgyNjIxNDMmdFtlXS50c19vZmZzZXQpPDwxMHwxMDIzJnRbZV0ubGVuZ3RoKT4+PjA7blthKytdPXI+PjI0JjI1NSxuW2ErK109cj4+MTYmMjU1LG5bYSsrXT1yPj44JjI1NSxuW2ErK109MjU1JnJ9ZWxzZSBuW2ErK109MTI3JnRbZV0ucHQ7Zm9yKGNvbnN0IGUgb2YgdCluLnNldChlLmRhdGEsYSksYSs9ZS5sZW5ndGg7cmV0dXJuIG59KGUubWFwKCh0PT57bGV0IGU9bmV3IFVpbnQ4QXJyYXkodC5sZW5ndGgpO2Uuc2V0KHQuZGF0YSk7Y29uc3Qgbj1kKG5ldyBEYXRhVmlldyhlLmJ1ZmZlcikpO3JldHVybiBuPy5mcmFtZSYmKHQuZGF0YT1uPy5mcmFtZSkscj1uLHR9KSkpO24udmFsdWUuZGF0YT10LmJ1ZmZlcn19ZWxzZSByPWQodCksciYmKG4udmFsdWUuZGF0YT1yLmZyYW1lLmJ1ZmZlcik7aWYocil7bGV0IHQ9ci50bHYuZmluZCgodD0+dC50YWc9PT1jLk1FVEFEQVRBKSk7aWYodCYmdC52YWx1ZSBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkmJmUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHttZXRhZGF0YTp0LnZhbHVlfSksdD1yLnRsdi5maW5kKCh0PT50LnRhZz09PWMuQVVESU9fNjRfQklUX1BUUykpLHQmJnQudmFsdWUgaW5zdGFuY2VvZiBVaW50OEFycmF5JiY4PT10LnZhbHVlLmxlbmd0aCl7Y29uc3Qgbj1uZXcgRGF0YVZpZXcodC52YWx1ZS5idWZmZXIpLmdldEJpZ1VpbnQ2NCgwLCEwKTt0JiZ0LnZhbHVlIGluc3RhbmNlb2YgVWludDhBcnJheSYmZS5vcHRpb25zLnBvcnQucG9zdE1lc3NhZ2Uoe3B0czpufSl9fX1VLndyaXRlKG4udmFsdWUpLGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHt0cmFuc2Zvcm1lZDohMH0pLHQoZSl9fSkpfShlKToiYXVkaW8tbWV0YWRhdGEtdHgiPT09ZS5vcHRpb25zLm5hbWUmJmZ1bmN0aW9uIHQoZSl7aC5yZWFkKCkudGhlbigobj0+e2lmKCFuLmRvbmUpe2lmKGUub3B0aW9ucy5wb3J0LnBvc3RNZXNzYWdlKHtnZXRNZXRhZGF0YTohMH0pLG4udmFsdWUgaW5zdGFuY2VvZiBSVENFbmNvZGVkQXVkaW9GcmFtZSl7Y29uc3QgdD1yLnNoaWZ0KCk7dCYmKG4udmFsdWUuZGF0YT1mdW5jdGlvbih0LGUsbil7Y29uc3QgYT1uLmJ5dGVMZW5ndGgscj1hK3UrZyxvPWYrbCtyLGk9bmV3IEFycmF5QnVmZmVyKHQuYnl0ZUxlbmd0aCtvKSxjPW5ldyBEYXRhVmlldyhpKTtjLnNldFVpbnQ4KDAscyksYy5zZXRVaW50MTYoMSxyKSxjLnNldFVpbnQ4KDMsZSksYy5zZXRVaW50MTYoNCxhKTtmb3IobGV0IHQ9MDt0PGE7dCsrKWMuc2V0VWludDgoNit0LG5bdF0pO2NvbnN0IGQ9bmV3IFVpbnQ4QXJyYXkoYy5idWZmZXIpO3JldHVybiBkLnNldChuZXcgVWludDhBcnJheSh0KSxvKSxkLmJ1ZmZlcn0obi52YWx1ZS5kYXRhLGMuQVVESU9fNjRfQklUX1BUUyx0KSl9VS53cml0ZShuLnZhbHVlKSxlLm9wdGlvbnMucG9ydC5wb3N0TWVzc2FnZSh7dHJhbnNmb3JtZWQ6ITB9KSx0KGUpfX0pKX0oZSl9LHNlbGYucG9zdE1lc3NhZ2UoInJlZ2lzdGVyZWQiKTsK")],{type:"text/javascript"});return setTimeout(()=>UD.revokeObjectURL(e),0),new Worker(UD.createObjectURL(e))}const Z7=71,AF=1,OF=2,NF=1,$7=2;var A0=function(e){return e[e.AUDIO_LEVEL=1]="AUDIO_LEVEL",e[e.METADATA=2]="METADATA",e[e.AUDIO_64_BIT_PTS=3]="AUDIO_64_BIT_PTS",e}(A0||{});function PF(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=e.getUint8(0);if(i!==Z7)return;const d=e.getUint16(1),h=AF+OF+d,f=new Uint8Array(e.byteLength-h);f.set(new Uint8Array(e.buffer,h,e.byteLength-h));const g={m:i,tlvLen:d,tlv:[],frame:f};let b=AF+OF;for(;b<h;){const C=e.getUint8(b),P=e.getUint16(b+NF),x=NF+$7;if(C===A0.AUDIO_LEVEL){let H=e.getUint8(b+x);for(let $=1;$<P;$++)H=H<<8|e.getUint8(b+x+$);g.tlv.push({tag:C,length:P,value:r?127^H>>1:127&H})}else if(C===A0.METADATA||C===A0.AUDIO_64_BIT_PTS){const H=new Uint8Array(P);for(let $=0;$<P;$++)H[$]=e.getUint8(b+x+$);g.tlv.push({tag:C,length:P,value:H})}b+=x+P}return g}const FL=new Map,BL=127,gI=1e-10,DF=139/13,GL=new Map;function kF(e,r,i){const d="".concat(e,"-").concat(r,"-").concat(i);let h=0;return GL.has(d)?h=GL.get(d):(h=Math.log(function(g,b){const C=g-b;b<C&&(b=C);let P=1;for(let x=g,H=1;x>b;x--,H++)P=P*x/H;return P}(r,e))+e*Math.log(.5)+(r-e)*Math.log(1-.5)-Math.log(i)+i*e,GL.set(d,h)),h<gI&&(h=gI),h}function tJ(e,r,i){const d=r.length,h=e.length/d;let f=!1;for(let g=0,b=0;g<d;g++){let C=0;for(let P=b+h;b<P;b++)e[b]>i&&C++;r[g]!==C&&(r[g]=C,f=!0)}return f}window.cache=GL;let blt=0;class eJ{constructor(r){Qm(this,"id",void 0),Qm(this,"immediates",[]),Qm(this,"lastNonSilence",-1),Qm(this,"immediateSpeechActivityScore",gI),Qm(this,"lastLevelChangedTime",Date.now()),Qm(this,"levels",[]),Qm(this,"longs",[]),Qm(this,"longSpeechActivityScore",gI),Qm(this,"mediums",[]),Qm(this,"mediumSpeechActivityScore",gI),Qm(this,"minLevel",0),Qm(this,"nextMinLevel",0),Qm(this,"nextMinLevelWindowLength",0),Qm(this,"energyScore",0),this.id=r||"".concat(blt++),this.immediates.length=50,this.mediums.length=10,this.longs.length=1,this.levels.length=this.immediates.length}computeImmediates(){const r=this.immediates,i=this.levels,d=this.minLevel+DF;let h=!1;for(let f=0;f<r.length;++f){let g=i[f];g<d&&(g=0);const b=Math.floor(g/DF);r[f]!==b&&(r[f]=b,h=!0)}return h}computeLongs(){return tJ(this.mediums,this.longs,4)}computeMediums(){return tJ(this.immediates,this.mediums,7)}evaluateImmediateSpeechActivityScore(){this.immediateSpeechActivityScore=kF(this.immediates[0],13,.78)}evaluateLongSpeechActivityScore(r){this.longSpeechActivityScore=kF(this.longs[0],10,47),this.longSpeechActivityScore>gI&&(this.lastNonSilence=r)}evaluateMediumSpeechActivityScore(){this.mediumSpeechActivityScore=kF(this.mediums[0],5,24)}evaluateSpeechActivityScores(r){this.computeImmediates()&&(this.evaluateImmediateSpeechActivityScore(),this.computeMediums()&&(this.evaluateMediumSpeechActivityScore(),this.computeLongs()&&this.evaluateLongSpeechActivityScore(r)))}getLastLevelChangedTime(){return this.lastLevelChangedTime}getLevels(){var r;return"[".concat(x6(r=[...this.levels]).call(r).join(),"]")}getSpeechActivityScore(r){switch(r){case 0:return this.immediateSpeechActivityScore;case 1:return this.mediumSpeechActivityScore;case 2:return this.longSpeechActivityScore;default:throw new Error("interval "+r)}}levelChanged(r,i){if(this.lastLevelChangedTime<=i){this.lastLevelChangedTime=i;let d=r;return r<0&&(d=0),r>BL&&(d=BL),this.levels.unshift(d),this.levels.length>this.immediates.length&&this.levels.pop(),this.updateMinLevel(d),d>=this.minLevel+DF?d:d/2}return-1}levelTimedOut(){this.levelChanged(0,this.lastLevelChangedTime)}updateMinLevel(r){if(r!==0){if(this.minLevel===0||this.minLevel>r)return this.minLevel=r,this.nextMinLevel=0,void(this.nextMinLevelWindowLength=0);if(this.nextMinLevel===0)return this.nextMinLevel=r,void(this.nextMinLevelWindowLength=1);if(this.nextMinLevel>r&&(this.nextMinLevel=r),this.nextMinLevelWindowLength++,this.nextMinLevelWindowLength>=750){let i=Math.sqrt(this.minLevel*this.nextMinLevel);i<0?i=0:i>BL&&(i=BL),this.minLevel=i,this.nextMinLevel=0,this.nextMinLevelWindowLength=0}}}}class ylt{constructor(r){Qm(this,"algorithm",void 0),this.algorithm=r}execute(){let r=!this.algorithm;if(!r)try{const i=this.algorithm.runInDecisionMaker(this);i<=0?r=!0:setTimeout(this.execute.bind(this),i)}catch{r=!0}r&&this.algorithm&&this.algorithm.decisionMakerExited(this)}}class LF{constructor(r,i,d){Qm(this,"isDominant",void 0),Qm(this,"energyRanking",void 0),Qm(this,"energyScore",void 0),this.isDominant=r,this.energyRanking=i,this.energyScore=d}}class Slt extends qE{constructor(r){super(),Qm(this,"dominantId",null),Qm(this,"lastDecisionTime",0),Qm(this,"lastLevelChangedTime",0),Qm(this,"lastLevelIdleTime",0),Qm(this,"relativeSpeechActivities",[]),Qm(this,"speakers",new Map),Qm(this,"enableSilence",!1),Qm(this,"timeoutToSilenceInterval",0),Qm(this,"decisionMaker",null),Qm(this,"loudest",[]),Qm(this,"numLoudestToTrack",3),Qm(this,"energyExpireTimeMs",250),Qm(this,"energyAlphaPct",50),this.timeoutToSilenceInterval=r,this.enableSilence=r>0,this.relativeSpeechActivities.length=3}setLoudestConfig(){let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:3,i=arguments.length>1?arguments[1]:void 0,d=arguments.length>2?arguments[2]:void 0;this.numLoudestToTrack=r,i!=null&&(this.energyExpireTimeMs=i),d!=null&&(this.energyAlphaPct=d),this.loudest.length>r&&this.loudest.splice(r)}getDominantSpeaker(){return this.dominantId}isAmongLoudest(r){return this.loudest.some(i=>i.id===r)}levelChanged(r,i){const d=Date.now(),h=this.getOrCreateSpeaker(r);this.lastLevelChangedTime<d&&(this.lastLevelChangedTime=d,this.maybeStartDecisionMaker());const f=h.levelChanged(i,d);return this.updateLoudestList(h,f,d)}runInDecisionMaker(r){return this.decisionMaker!==r||this.lastDecisionTime>0&&this.lastDecisionTime-this.lastLevelChangedTime>=15e3?-1:this._runInDecisionMaker()}decisionMakerExited(r){this.decisionMaker===r&&(this.decisionMaker=null)}destroy(){this.decisionMaker=null,this.loudest.length=0,this.speakers.clear(),this.removeAllListeners()}addSpeakers(r){r.forEach(i=>{this.speakers.has(i.id)||this.speakers.set(i.id,i)})}removeSpeakers(r){r.forEach(i=>{this.speakers.delete(i.id)})}getOrCreateSpeaker(r){let i=this.speakers.get(r);return i||(i=new eJ(r),this.speakers.set(r,i),this.maybeStartDecisionMaker()),i}updateLoudestList(r,i,d){const h=r.id===this.dominantId;if(i<0){let C=0;for(;C<this.loudest.length&&this.loudest[C]!==r;)++C;return new LF(h,C,r.energyScore)}if(r.energyScore=Math.floor((this.energyAlphaPct*i+(100-this.energyAlphaPct)*r.energyScore+50)/100),this.numLoudestToTrack===0)return new LF(h,0,r.energyScore);const f=d-this.energyExpireTimeMs;let g=0;for(;g<this.loudest.length;){const C=this.loudest[g];if(C.getLastLevelChangedTime()<f&&this.loudest.length>=this.numLoudestToTrack)this.loudest.splice(g,1);else if(C.id!==r.id)++g;else if(this.loudest.splice(g,1),this.loudest.length<this.numLoudestToTrack)break}let b=0;for(;b<this.loudest.length&&!(this.loudest[b].energyScore<r.energyScore);)++b;return b<this.numLoudestToTrack&&(this.loudest.splice(b,0,r),this.loudest.length>this.numLoudestToTrack&&this.loudest.splice(this.numLoudestToTrack,1)),new LF(h,b,r.energyScore)}maybeStartDecisionMaker(){!this.decisionMaker&&this.speakers.size>0&&(this.decisionMaker=new ylt(this),this.decisionMaker.execute())}makeDecision(r){let i=null,d=null;const h=this.speakers.size;let f=null;if(h===0)f=null;else if(h===1){var g;const b=sT(g=this.speakers).call(g).next().value;this.enableSilence&&b&&(f=b.id,b.evaluateSpeechActivityScores(r),r-b.lastNonSilence>this.timeoutToSilenceInterval&&(f=null))}else{let b=this.dominantId==null?null:this.speakers.get(this.dominantId);if(b==null){const x=this.speakers.entries().next();x.value&&(f=x.value[0],b=x.value[1])}else f=b.id;b!=null&&b.evaluateSpeechActivityScores(r);const C=this.relativeSpeechActivities;let P=2;for(const x of this.speakers.entries()){const[H,$]=x;if($===b)continue;$.evaluateSpeechActivityScores(r);for(let _r=0;_r<C.length;++_r){const Fi=b==null?gI:b.getSpeechActivityScore(_r);C[_r]=Math.log($.getSpeechActivityScore(_r)/Fi)}const _t=C[0],_i=C[1],ue=C[2];_t>3&&_i>2&&ue>0&&_i>P&&(P=_i,f=H)}this.enableSilence&&b!=null&&f===b.id&&r-b.lastNonSilence>this.timeoutToSilenceInterval&&(f=null)}f==null&&!this.enableSilence||f===this.dominantId||(i=this.dominantId,this.dominantId=f,d=this.dominantId),d==null&&!this.enableSilence||d===i||this.emit("ActiveSpeakerChanged",d)}_runInDecisionMaker(){const r=Date.now(),i=300-(r-this.lastLevelIdleTime);let d=0;i<=0?(this.lastLevelIdleTime!==0&&this.timeoutIdleLevels(r),this.lastLevelIdleTime=r):d=i;let h=300-(r-this.lastDecisionTime);return h<=0&&(this.lastDecisionTime=r,this.makeDecision(r),h=300-(Date.now()-r)),h>0&&d>h&&(d=h),d}timeoutIdleLevels(r){const i=[];for(const h of sT(d=this.speakers).call(d)){var d;const f=r-h.getLastLevelChangedTime();36e5<f&&(this.dominantId==null||h.id!==this.dominantId)?i.push(h.id):300<f&&h.levelTimedOut()}i.forEach(h=>this.speakers.delete(h))}}const PO=new Map;let vR=null,qL=null;const nJ=3;let vI=[];const bR=new Map,WL=new Map;class Tlt{get samples(){return this.actives+this.inactives}get activeRate(){return this.actives/this.samples}constructor(r,i){Qm(this,"id",void 0),Qm(this,"track",void 0),Qm(this,"score",0),Qm(this,"active",!0),Qm(this,"muted",!1),Qm(this,"timer",0),Qm(this,"actives",0),Qm(this,"inactives",0),this.id=r,this.track=i,this.setActive(bR.size<3)}autoCheckActive(){this.autoSetActive(),this.autoAdjustActive(),this.resetTimer(),this.actives=0,this.inactives=0}autoSetActive(){const r=this.active;this.active=this.activeRate>=.8;const{actives:i,inactives:d}=function(){const h=[],f=[];return Array.from(sT(bR).call(bR)).forEach(g=>{g.active?h.push(g):f.push(g)}),{actives:h,inactives:f}}();if(i.length>3){let h;i.forEach(f=>{(!h||h.score>f.score)&&(h=f)}),h&&h.setActive(!1)}if(i.length<3&&d.length>0){let h;d.forEach(f=>{(!h||h.score<f.score)&&f.id!==this.id&&(h=f)}),h&&r&&!this.active&&(h.samples>40&&h.activeRate-this.activeRate>.4?h.setActive(!0):this.active=!0)}this.setMuted(!this.active)}setActive(r){this.active=r,this.resetTimer(),this.setMuted(!r)}autoAdjustActive(){this.active?this.autoSwitchToInactive():this.autoSwitchToActive()}autoSwitchToActive(){const r=function(i){let d;return Array.from(sT(bR).call(bR)).forEach(h=>{!h.active||h.id===i||h.samples<40||(!d||h.score<d.score)&&(d=h)}),d}(this.id);r&&this.activeRate-r.activeRate>.4&&(r.setActive(!1),this.setActive(!0))}autoSwitchToInactive(){const r=function(i){let d;return Array.from(sT(bR).call(bR)).forEach(h=>{h.active||h.id===i||h.samples<40||(!d||h.score>d.score)&&(d=h)}),d}(this.id);r&&r.activeRate-this.activeRate>.4&&(r.setActive(!0),this.setActive(!1))}addSample(r){r?this.actives+=1:this.inactives+=1,this.samples>66.66666666666667&&this.autoCheckActive()}setMuted(r){this.track&&(this.track.enabled=!r,this.muted=r)}resetTimer(){this.clearTimer(),this.timer=window.setTimeout(()=>{if(this.samples!==0)return this.samples<50?this.resetTimer():void this.autoCheckActive()},1e3)}clearTimer(){this.timer&&(clearTimeout(this.timer),this.timer=0)}}let KL;function rJ(e){const r=bR.get(e);r&&(bR.delete(e),r.clearTimer())}const HL=new Map,Rlt=new Map,MF="video/h264",xF="video/h265";function iJ(e,r,i){let d=new Uint8Array(e,r,i),h=[],f=0;for(;h.length<i;)f+3<i&&d[f]===0&&d[f+1]===0&&d[f+2]===3&&(d[f+3]===0||d[f+3]===1||d[f+3]===2||d[f+3]===3)?(h.push(d[f],d[f+1],d[f+3]),f+=4):(h.push(d[f]),f++);return new Uint8Array(h)}function oJ(e){const r=e.length;let i=[],d=0;for(;d<r;)d+2<r&&e[d]===0&&e[d+1]===0&&(e[d+2]===0||e[d+2]===1||e[d+2]===2||e[d+2]===3)?(i.push(e[d],e[d+1],3,e[d+2]),d+=3):(i.push(e[d]),d++);return new Uint8Array(i)}function sJ(e){if(e.length<5)return"";let r=-1;for(let h=0;h<e.length-3;h++){if(e[h]===0&&e[h+1]===0&&e[h+2]===1){r=h;break}if(h<e.length-4&&e[h]===0&&e[h+1]===0&&e[h+2]===0&&e[h+3]===1){r=h;break}}if(r===-1)return"";const i=r+(e[r+2]===0?4:3);if(i>=e.length)return"";const d=e[i];return 128&d?"":(d>>1&63)>=32||i+1<e.length&&!(248&e[i+1])?xF:(31&d)<=31?MF:""}const zL=new Map,YN=new Map;(function(){const e=oE();_S.getDisplayMedia=!(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia),_S.getStreamFromExtension=e.name===hE.CHROME&&Number(e.version)>34,_S.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const r=new RTCPeerConnection;let i=!1;try{r.addTransceiver("audio"),i=!0}catch{}return r.close(),i}(),_S.supportMinBitrate=e.name===hE.CHROME||e.name===hE.EDGE,_S.supportSetRtpSenderParameters=function(){const r=oE();return!!(window.RTCRtpSender&&window.RTCRtpSender.prototype.setParameters&&window.RTCRtpSender.prototype.getParameters)&&(!!n0()||!(!yS()&&!SL())||r.name===hE.FIREFOX&&Number(r.version)>=64)}(),e.name===hE.SAFARI&&(Number(e.version)>=14?_S.supportDualStream=!0:_S.supportDualStream=!1),_S.webAudioMediaStreamDest=function(){const r=oE();return!(r.name===hE.SAFARI&&Number(r.version)<12)}(),_S.supportReplaceTrack=!!window.RTCRtpSender&&typeof RTCRtpSender.prototype.replaceTrack=="function",_S.supportWebGL=typeof WebGLRenderingContext<"u",_S.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,n0()||(_S.webAudioWithAEC=!0),_S.supportShareAudio=function(){const r=oE();return(r.os===aS.WIN_10||r.os===aS.WIN_81||r.os===aS.WIN_7||r.os===aS.LINUX||r.os===aS.MAC_OS||r.os===aS.CHROMIUM_OS)&&r.name===hE.CHROME&&Number(r.version)>=74}(),_S.supportDataChannel=!!(pO(76)||qV(68)||o4(14)),_S.supportPCSetConfiguration=function(){const r=window.RTCPeerConnection;return!KE()&&!!r&&r.prototype.setConfiguration instanceof Function}(),_S.supportWebRTCEncodedTransform=pO(87)||n4()||qV(117),_S.supportWebRTCInsertableStream=function(){const r=oE();return(r.name===hE.CHROME||r.name===hE.EDGE)&&Number(r.version)>=94&&"MediaStreamTrackGenerator"in window&&"MediaStreamTrackProcessor"in window}(),_S.supportRequestVideoFrameCallback="requestVideoFrameCallback"in HTMLVideoElement.prototype,_S.supportWebCrypto=typeof window<"u"&&window.crypto!==void 0&&window.crypto.subtle!==void 0,IL(()=>{_S.supportDualStreamEncoding=function(){const r=oE();return!!_s("DISABLE_WEBAUDIO")||r.name==="Safari"&&Number(r.version)>=14||!!(r.name==="Chrome"&&/Windows/i.test(r.os||"")&&Number(r.version)>=100&&_s("CHROME_DUAL_STREAM_USE_ENCODING"))}(),Wt.debug("browser ua: ",navigator.userAgent),Wt.info("browser info: ",e),Wt.info("browser compatibility: ",_S)})})();const Ilt=["CHINA","GLOBAL"],aJ=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],bI=[],DO=[];function yI(e,r){return!!r&&bI.some(i=>i.uid===e&&i.channelName===r)}function UF(){return DO.length>0}var wlt=SH.forEach,cJ=kP("forEach")?[].forEach:function(e){return wlt(this,e,arguments.length>1?arguments[1]:void 0)};bE({target:"Array",proto:!0,forced:[].forEach!==cJ},{forEach:cJ});var Clt=BT("Array","forEach"),Alt=_0,Olt=DS,Nlt=_n,Plt=Clt,VF=Array.prototype,Dlt={DOMTokenList:!0,NodeList:!0},klt=function(e){var r=e.forEach;return e===VF||Nlt(VF,e)&&r===VF.forEach||Olt(Dlt,Alt(e))?Plt:r},Llt=_(klt),Mlt=OR,uJ=jP;bE({target:"Object",stat:!0,forced:A(function(){uJ(1)})},{keys:function(e){return uJ(Mlt(e))}});var xlt=_(bS.Object.keys),Ult=_(k6),Vlt=_(M6),jlt=bE,dJ=sN,Flt=$P,Blt=UE,lJ=aM,Glt=m0,qlt=z_,Wlt=RU,Klt=tS,Hlt=g0,zlt=hH("slice"),Ylt=Klt("species"),jF=Array,Jlt=Math.max;jlt({target:"Array",proto:!0,forced:!zlt},{slice:function(e,r){var i,d,h,f=qlt(this),g=Glt(f),b=lJ(e,g),C=lJ(r===void 0?g:r,g);if(dJ(f)&&(i=f.constructor,(Flt(i)&&(i===jF||dJ(i.prototype))||Blt(i)&&(i=i[Ylt])===null)&&(i=void 0),i===jF||i===void 0))return Hlt(f,b,C);for(d=new(i===void 0?jF:i)(Jlt(C-b,0)),h=0;b<C;b++,h++)b in f&&Wlt(d,h,f[b]);return d.length=h,d}});var Xlt=BT("Array","slice"),Qlt=_n,Zlt=Xlt,FF=Array.prototype,$lt=function(e){var r=e.slice;return e===FF||Qlt(FF,e)&&r===FF.slice?Zlt:r},tht=_($lt);function D_(e,r,i,d,h){var f,g,b,C={};return Llt(f=xlt(d)).call(f,function(P){C[P]=d[P]}),C.enumerable=!!C.enumerable,C.configurable=!!C.configurable,("value"in C||C.initializer)&&(C.writable=!0),C=Ult(g=Vlt(b=tht(i).call(i)).call(b)).call(g,function(P,x){return x(e,r,P)||P},C),h&&C.initializer!==void 0&&(C.value=C.initializer?C.initializer.call(h):void 0,C.initializer=void 0),C.initializer===void 0?(cH(e,r,C),null):C}let YL=function(e){return e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR",e}({}),BF=function(e){return e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR",e}({}),$T=function(e){return e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND",e}({}),GS=function(e){return e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV",e}({}),x_=function(e){return e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.DATASTREAM2_NOT_AVAILABLE=27]="DATASTREAM2_NOT_AVAILABLE",e[e.K_AUTO_REBALANCE=28]="K_AUTO_REBALANCE",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY",e}({}),kE=function(e){return e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed",e}({}),B_=function(e){return e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.PRE_CONNECT_PC="pre_connect_pc",e.P2P_CONNECTION="p2p_connection",e.P2P_REMOTE_CANDIDATE_UPDATE="p2p_remote_candidate_update",e.P2P_SUBSCRIBE="p2p_subscribe",e.P2P_UNSUBSCRIBE="p2p_unsubscribe",e.P2P_EXCHANGE_SDP="p2p_exchange_sdp",e.P2P_ON_ADD_VIDEO_STREAM="p2p_on_add_video_stream",e.P2P_ON_ADD_AUDIO_STREAM="p2p_on_add_audio_stream",e.RECOVER_NOTIFICATION="recover_notification",e}({}),j_=function(e){return e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.PUBLISH_DATASTREAM="publish_datastream",e.UNPUBLISH="unpublish",e.UNPUBLISH_DATASTREAM="unpublish_datastream",e.SUBSCRIBE="subscribe",e.PRE_SUBSCRIBE="pre_subscribe",e.SUBSCRIBE_DATASTREAM="subscribe_datastream",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_DATASTREAM="unsubscribe_datastream",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter",e.SET_RTM2_FLAG="set_rtm2_flag",e.DOWNGRADE_CODEC="downgrade_codec",e}({}),JN=function(e){return e.WRTC_STATS="wrtc_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats",e}({}),rE=function(e){return e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ON_RTP_CAPABILITY_CHANGE="on_rtp_capability_change",e.ON_REMOTE_DATASTREAM_UPDATE="on_remote_datastream_update",e.ON_REMOTE_FULL_DATASTREAM_INFO="on_remote_full_datastream_info",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list",e}({}),qS=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({}),Y_=function(e){return e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire",e}({});function JL(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw Wt.error("Invalid Channel Name ".concat(e)),new t_(Gi.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function XL(e){if(r=e,!(typeof r=="number"&&Math.floor(r)===r&&0<=r&&r<=4294967295||p4(e,1,255)))throw new t_(Gi.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var r;typeof e=="string"&&Wt.warn("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}let i0=function(e){return e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e}({});const eht={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},GF={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function qF(e,r){fS(e.url,"".concat(r,".url"),1,1e3,!1),HE(e.x)||IE(e.x,"".concat(r,".x"),0,1e4),HE(e.y)||IE(e.y,"".concat(r,".y"),0,1e4),HE(e.width)||IE(e.width,"".concat(r,".width"),0,1e4),HE(e.height)||IE(e.height,"".concat(r,".height"),0,1e4),HE(e.zOrder)||IE(e.zOrder,"".concat(r,".zOrder"),0,255),HE(e.alpha)||IE(e.alpha,"".concat(r,".alpha"),0,1,!1)}const nht={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""};let O0=function(e){return e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address",e}({}),WF=function(e){return e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager",e}({}),nS=function(e){return e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN",e}({});function hJ(e){if(!e.channelName)throw new t_(Gi.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new t_(Gi.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&fS(e.token,"info.token",1,2047),XL(e.uid),JL(e.channelName),!0}let WS=function(e){return e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile",e}({}),o0=function(e){return e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE",e}({}),eT=function(e){return e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE",e}({}),kO=function(e){return e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED",e}({}),gE=function(e){return e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low",e}({}),uS=function(e){return e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.PRE_CONNECT_PC="pre-connect_pc",e.UPDATE_GATEWAY_CONFIG="update-gateway-config",e}({}),QL=function(e){return e.P2P_DISCONNECTED="P2P_DISCONNECTED",e.A_ROUND_WS_FAILED="A_ROUND_WS_FAILED",e.TIMEOUT="TIMEOUT",e.UNKNOWN_REASON="UNKNOWN_REASON",e}({}),cS=function(e){return e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data",e[e.DataStream0=256]="DataStream0",e[e.DataStream1=512]="DataStream1",e[e.DataStream2=1024]="DataStream2",e[e.DataStream3=2048]="DataStream3",e[e.DataStream4=4096]="DataStream4",e[e.DataStream5=8192]="DataStream5",e[e.DataStream6=16384]="DataStream6",e[e.DataStream7=32768]="DataStream7",e}({}),fE=function(e){return e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS",e}({});const pJ=[fE.AFRICA,fE.ASIA,fE.CHINA,fE.EUROPE,fE.GLOBAL,fE.INDIA,fE.JAPAN,fE.NORTH_AMERICA,fE.OCEANIA,fE.OVERSEA,fE.SOUTH_AMERICA];let AS=function(e){return e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL",e}({});const ZL={CHINA:{},ASIA:{CODE:AS.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:AS.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:AS.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:AS.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:AS.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:AS.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:AS.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:AS.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:AS.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:AS.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:AS.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:AS.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:AS.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};aF&&(ZL.CHINA={CODE:AS.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]});let XN=function(e){return e.UPDATE_BITRATE_LIMIT="update_bitrate_limit",e.UPDATE_CLIENT_ROLE_OPTIONS="update_client_role_options",e}({});function fJ(e){return!!e&&!(!e.uplink||!e.id)&&e.uplink.max_bitrate!==void 0&&e.uplink.min_bitrate!==void 0}class mJ extends qE{constructor(r,i){super(),Ei(this,"onICEConnectionStateChange",void 0),Ei(this,"onConnectionStateChange",void 0),Ei(this,"onDTLSTransportStateChange",void 0),Ei(this,"onDTLSTransportError",void 0),Ei(this,"onICETransportStateChange",void 0),Ei(this,"onFirstAudioReceived",void 0),Ei(this,"onFirstVideoReceived",void 0),Ei(this,"onFirstAudioDecoded",void 0),Ei(this,"onFirstVideoDecoded",void 0),Ei(this,"onFirstVideoRender",void 0),Ei(this,"onFirstVideoDecodedTimeout",void 0),Ei(this,"onSelectedLocalCandidateChanged",void 0),Ei(this,"onSelectedRemoteCandidateChanged",void 0),Ei(this,"onICECandidateError",void 0),Ei(this,"getLocalVideoStats",void 0)}}class _J extends mJ{constructor(r,i){super(r,i),Ei(this,"establishPromise",void 0)}}let A_=function(e){return e.VIDEO="video",e.AUDIO="audio",e}({}),OS=function(e){return e.UDP_RELAY="udp_relay",e.UDP_TCP_RELAY="udp_tcp_relay",e.TCP_RELAY="tcp_relay",e.RELAY="relay",e}({}),s0=function(e){return e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.UDP_TCP_RESTART=1]="UDP_TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.TCP_RESTART=3]="TCP_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED",e}({});const EJ=["disconnected","failed"];let l_=function(e){return e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack",e}({}),EE=function(e){return e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected",e}({}),L_=function(e){return e.AudioMetadata="audioMetadata",e.AudioPts="audioPts",e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestRePublishDataChannel="requestRePublishDataChannel",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.RequestUpload="requestUpload",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState",e.LocalCandidate="LocalCandidate",e.RequestP2PMuteLocal="requestP2PMuteLocal",e.RequestP2PUnPublish="RequestP2PUnPublish",e.RequestP2PUnmuteRemote="RequestP2PUnmuteRemote",e.RequestP2PMuteRemote="RequestP2PMuteRemote",e.RequestP2PRestartICE="RequestP2PRestartICE",e}({}),tR=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),eR=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),dS=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),gJ=function(e){return e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback",e.PRE_CONNECT_PC="transmitter:pre_connect_pc",e}({}),FR=function(e){return e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.AUDIO_CONTEXT_STATE_CHANGED="audio-context-state-changed",e.SECURITY_POLICY_VIOLATION="security-policy-violation",e}({}),DT=function(e){return e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED",e}({}),yR=function(e){return e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url",e}({}),LO=function(e){return e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED",e}({}),$E=function(e){return e.CALL="call",e.CANDIDATE="candidate",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.CONTROL="control",e.RESTART_ICE="restart_ice",e.ACK="ack",e.RESPONSE="response",e.JOIN="join",e.CHECK="check",e}({}),MO=function(e){return e.ABORT="abort",e}({}),N0=function(e){return e.MUTE_LOCAL_AUDIO="mute_local_audio",e.MUTE_LOCAL_VIDEO="mute_local_video",e.UNMUTE_LOCAL_AUDIO="unmute_local_audio",e.UNMUTE_LOCAL_VIDEO="unmute_local_video",e}({}),rht=function(e){return e.P2P_TOKEN_TIMEOUT="p2p_token_timeout",e.P2P_TOKEN_CHANGED="p2p_token_changed",e}({});const iht={[YL.ACCESS_POINT]:{[GS.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[GS.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[GS.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[GS.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[GS.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[GS.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_VOICE]:{desc:"no unilbs voice service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[GS.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[YL.UNILBS]:{[$T.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[$T.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[$T.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[$T.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[$T.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[$T.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[$T.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[$T.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[$T.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[$T.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[$T.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[$T.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[YL.STRING_UID_ALLOCATOR]:{[BF.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[BF.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[BF.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function xO(e){const r=iht[Math.floor(e/1e4)];if(!r)return{desc:"unknown error",retry:!1};const i=r[e%1e4];if(!i){if(Math.floor(e/1e4)===YL.ACCESS_POINT){const d=e%1e4;if(d.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(d.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unknown error",retry:!1}}return i}const oht={[x_.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[x_.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[x_.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[x_.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[x_.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[x_.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[x_.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[x_.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[x_.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[x_.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[x_.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[x_.DATASTREAM2_NOT_AVAILABLE]:{desc:"DATASTREAM2_NOT_AVAILABLE",action:"quit"},[x_.K_AUTO_REBALANCE]:{desc:"k_AUTO_REBALANCE",action:"recover"},[x_.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[x_.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[x_.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[x_.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[x_.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[x_.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[x_.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[x_.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[x_.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[x_.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[x_.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[x_.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[x_.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[x_.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[x_.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[x_.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[x_.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[x_.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[x_.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[x_.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[x_.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[x_.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[x_.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[x_.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[x_.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[x_.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[x_.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[x_.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[x_.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[x_.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[x_.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[x_.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[x_.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[x_.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[x_.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[x_.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[x_.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[x_.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[x_.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[x_.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[x_.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[x_.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[x_.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[x_.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[x_.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[x_.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[x_.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[x_.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[x_.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[x_.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[x_.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function QN(e){return oht[e]||{desc:"UNKNOWN_ERROR_".concat(e),action:"failed"}}function vJ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function KF(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?vJ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):vJ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}function HF(e,r){if(typeof e=="string")return e;const{proxy:i,host:d,port:h}=e;if(r){const f=_s("JOIN_GATEWAY_FALLBACK_PORT")||443;return f===443?"wss://".concat(d,"/ws/?p=").concat(Number(h)+150):"wss://".concat(d,":").concat(f,"/ws/?p=").concat(Number(h)+150)}return i?"wss://".concat(i,"/ws/?h=").concat(d,"&p=").concat(h):"wss://".concat(d,":").concat(h)}const sht=/wss:\/\/(.+)\/ws\/\?h=(.+)&p=([0-9]+)\/?/,aht=/wss:\/\/(.+)\/ws\/\?p=([0-9]+)\/?/,cht=/wss:\/\/(.+):([0-9]+)\/?/,uht=/wss:\/\/(.[^\/]+)\/?/;let dht=0;class lht{constructor(r,i){Ei(this,"id",0),Ei(this,"store",void 0),Ei(this,"recordIndex",void 0),Ei(this,"websockets",[]),Ei(this,"try443PortDuration",2e3),Ei(this,"forceCloseWSDuration",5e3),Ei(this,"try443PortTimeout",null),Ei(this,"forceCloseTimeout",null),Ei(this,"isTry443PortFailed",!1),Ei(this,"isNormalPortFailed",!1),Ei(this,"useDoubleDomain",!1),Ei(this,"useProxy",!1),Ei(this,"startTime",Date.now()),this.id=++dht,this.try443PortDuration=_s("JOIN_GATEWAY_TRY_443PORT_DURATION")||2e3,this.forceCloseWSDuration=r||5e3,this.store=i}closeAllWebsockets(){this.websockets.forEach(r=>{r.onopen=null,r.onclose=null,r.onmessage=null,r.close()}),this.websockets.length=0}clearTimeout(){this.forceCloseTimeout&&clearTimeout(this.forceCloseTimeout),this.try443PortTimeout&&clearTimeout(this.try443PortTimeout),this.forceCloseTimeout=null,this.try443PortTimeout=null}logger(){var r;const i=Date.now()-this.startTime;for(var d=arguments.length,h=new Array(d),f=0;f<d;f++)h[f]=arguments[f];Wt.debug("[choose-best-ws ".concat((r=this.store)===null||r===void 0?void 0:r.clientId," ").concat(this.id,"] ").concat(i,"ms:"),...h)}createWebSocket(r,i,d){this.logger("createWebSocket:",r,{isTry443Port:i,hasTimeoutDetection:d});const h=_s("GATEWAY_DOMAINS"),f=Date.now(),g=[],b=h.find($=>{var _t;return E_(_t=r.host).call(_t,$)});b||(this.useDoubleDomain=!1);const C=[];if(this.useDoubleDomain)h.forEach($=>{C.push(HF(KF(KF({},r),{},{host:r.host.replace(b,$)}),i))});else{const $=KF({},r);if(i&&b){const _t=h.find(_i=>_i!==b);_t&&($.host=$.host.replace(b,_t))}C.push(HF($,i))}try{C.forEach($=>{const _t=new WebSocket($);_t.binaryType="arraybuffer",g.push(_t),this.logger("ws is connecting:",_t.url)})}catch($){if(this.logger("ws create failed"),g.forEach(_t=>_t.close()),g.length=0,this.useDoubleDomain)return this.useDoubleDomain=!1,this.createWebSocket(r,i,d);if(!i&&Number(r.port)!==443)return this.createWebSocket(r,!0,d);throw new t_(Gi.WS_ERR,"init websocket failed! Error: ".concat($.toString()))}const P=MN();this.store&&this.store.recordJoinChannelService({urls:g.map($=>$.url),service:"gateway"},this.recordIndex),g.forEach($=>{$.onopen=()=>{this.logger("onopen: ws ".concat($.url," open cost ").concat(Date.now()-f,"ms")),this.websockets.forEach(_t=>{_t!==$&&(_t.onopen=null,_t.onclose=null,_t.onmessage=null,_t.close(),this.logger("close backup websocket: ".concat(_t.url)))}),this.websockets.length=0,P.resolve($)},$.onclose=_t=>{this.logger("onclose: ws ".concat($.url," closed cost ").concat(Date.now()-f,"ms state: ").concat($.readyState));const _i=g.every(ue=>ue.readyState===WebSocket.CLOSED||ue.readyState===WebSocket.CLOSING);this.logger("".concat(i?"443":"47xx"," websocket closed, all failed: ").concat(_i)),_i&&(i||this.isTry443PortFailed||this.useProxy)?(this.logger("onclose: all websocket is closed, ".concat(_t.reason)),P.reject({code:_t.code,reason:QL.A_ROUND_WS_FAILED})):!i&&_i&&!this.isNormalPortFailed&&this.try443PortTimeout&&(this.logger("all 47xx websocket is closed, try 443 port"),this.clearTimeout(),H()),i?this.isTry443PortFailed=_i:this.isNormalPortFailed=_i},$.onmessage=_t=>this.logger("".concat($.url," onmessage: ").concat(_t.data))}),this.websockets.push(...g);const x=()=>{this.websockets.forEach($=>$.readyState!==WebSocket.OPEN&&$.close())},H=()=>{if(P.isResolved)return x();oE().os===aS.MAC_OS&&KE()&&x(),this.createWebSocket(r,!0,!0).then($=>{P.resolve($)}).catch($=>{this.isNormalPortFailed&&P.reject($),this.logger("try 443 port to create ws failed")}),this.forceCloseTimeout=window.setTimeout(()=>{this.logger("5s timeout close un-opens, isWebsocket created: ",P.isResolved),this.forceCloseTimeout=null,x()},this.forceCloseWSDuration)};return d||(()=>{if(i||this.useProxy)return this.logger("add 5s timeout at ".concat(i?"try-443":"proxy"," condition")),this.forceCloseTimeout=window.setTimeout(()=>{this.forceCloseTimeout=null,x()},this.forceCloseWSDuration);this.try443PortTimeout=window.setTimeout(()=>{this.logger("2s timeout, isWebsocket created: ",P.isResolved),this.try443PortTimeout=null,H()},this.try443PortDuration)})(),P.promise}chooseBestWebsocket(r,i,d,h){return this.useDoubleDomain=!!i,typeof r=="string"&&(r=function(f){let g,b,C;return[,g,b,C]=f.match(sht)||[],g||([,b,C]=f.match(aht)||[]),b&&C||([,b,C]=f.match(cht)||[]),b&&C||([,b]=f.match(uht)||[]),b||Wt.warning("un-destructible url: ",f),{proxy:g,host:b,port:C||"443"}}(r)),this.recordIndex=h,this.useProxy=!!r.proxy,d&&this.useProxy&&(Wt.warn("cannot use 443 only when use proxy"),d=!1),this.createWebSocket(r,!!d,!1).finally(()=>this.clearTimeout())}}function bJ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}class yJ extends qE{get url(){return this.websocket&&this.websocket.url||this._websocketUrl}get reconnectMode(){return this._reconnectMode}set reconnectMode(r){var i;E_(i=["tryNext","recover"]).call(i,r)&&this.resetReconnectCount(r),this._reconnectMode=r}get state(){return this._state}set state(r){r!==this._state&&(this._state=r,this._state==="reconnecting"?this.emit(Y_.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Y_.CONNECTED):this._state==="closed"?this.emit(Y_.CLOSED):this._state==="failed"&&this.emit(Y_.FAILED))}resetReconnectCount(r){Wt.debug("websocket reset reconnect count, reason: "+r),this.reconnectCount=0}constructor(r,i){let d=arguments.length>2&&arguments[2]!==void 0&&arguments[2],h=arguments.length>3&&arguments[3]!==void 0&&arguments[3],f=arguments.length>4&&arguments[4]!==void 0&&arguments[4],g=arguments.length>5?arguments[5]:void 0;super(),Ei(this,"_websocketUrl",null),Ei(this,"connectionID",0),Ei(this,"currentURLIndex",0),Ei(this,"urls",[]),Ei(this,"_reconnectMode","tryNext"),Ei(this,"reconnectReason",void 0),Ei(this,"_initMutex",void 0),Ei(this,"name",void 0),Ei(this,"_state","closed"),Ei(this,"reconnectInterrupter",void 0),Ei(this,"websocket",void 0),Ei(this,"retryConfig",void 0),Ei(this,"reconnectCount",0),Ei(this,"forceCloseTimeout",5e3),Ei(this,"onlineReconnectListener",void 0),Ei(this,"useCompress",void 0),Ei(this,"tryDoubleDomain",!1),Ei(this,"use443PortOnly",!1),Ei(this,"wsInflateLength",0),Ei(this,"wsDeflateLength",0),Ei(this,"closeEstablishingWs",()=>{}),Ei(this,"store",void 0),Ei(this,"joinGatewayRecordIndex",void 0),this.store=g,this.name=r,this.retryConfig=function(H){for(var $=1;$<arguments.length;$++){var _t=arguments[$]!=null?arguments[$]:{};$%2?bJ(Object(_t),!0).forEach(function(_i){Ei(H,_i,_t[_i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(H,Object.getOwnPropertyDescriptors(_t)):bJ(Object(_t)).forEach(function(_i){Object.defineProperty(H,_i,Object.getOwnPropertyDescriptor(_t,_i))})}return H}({},i),this.useCompress=d,this.tryDoubleDomain=h,this.use443PortOnly=f,this._initMutex=new wS("websocket",g?g.clientId:void 0);const{timeout:b,timeoutFactor:C}=i,P=Math.max(300,Math.floor(3*b/5)),x=Math.max(1.2,Math.floor(8*C)/10);uT.ONLINE&&(this.retryConfig.timeout=P,this.retryConfig.timeoutFactor=x),Fg.on(mO.NETWORK_STATE_CHANGE,(H,$)=>{H!==$&&(this.resetReconnectCount("network state change: ".concat($," -> ").concat(H)),H===uT.ONLINE?(this.retryConfig.timeout=P,this.retryConfig.timeoutFactor=x):(this.retryConfig.timeout=b,this.retryConfig.timeoutFactor=C))})}getConnection(){return this.websocket||void 0}async init(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const d=await this._initMutex.lock();this._reconnectMode="tryNext",this.forceCloseTimeout=i,this.urls=r,this.state="connecting";try{var h;const f=MN(),g=this.urls[this.currentURLIndex];(h=this.store)===null||h===void 0||h.beforeConnect(),function(b){return!(DL()||_s("USE_NEW_TOKEN")||!_s("ENABLE_PREALLOC_PC")&&(b==null||!b.autoSubscribe||_s("FORCE_DISABLE_AUTO_SUB")))}(this.store)&&this.emit(gJ.PRE_CONNECT_PC),this.createWebSocketConnection(g).then(f.resolve).catch(f.reject),this.once(Y_.CLOSED,()=>{f.reject(new n_(Gi.WS_DISCONNECT))}),this.once(Y_.CONNECTED,f.resolve),await f.promise}catch{}finally{d()}}close(r,i){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const d=this.websocket;i?setTimeout(()=>d.close(),500):d.close(),this.websocket=void 0,this._websocketUrl=null}this.state=r?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(r,i){if(!this.websocket)return void Wt.warning("[".concat(this.name,"] can not reconnect, no websocket"));r!==void 0&&(this.reconnectMode=r),Wt.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinGatewayRecordIndex=="number"&&this.store&&this.store.recordJoinChannelService({status:"error",errors:[new Error(i)]},this.joinGatewayRecordIndex);const d=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),d&&d.bind(this.websocket)({code:9999,reason:i})}sendMessage(r){let i=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new n_(Gi.WS_ABORT,"websocket is not ready");try{i||(r=JSON.stringify(r)),this.websocket.send(r)}catch(d){throw new n_(Gi.WS_ERR,"send websocket message error"+d.toString())}}setWsInflateData(r){this.wsDeflateLength=this.wsDeflateLength+r.originLength,this.wsInflateLength=this.wsInflateLength+r.compressedLength}getWsInflateData(){const r=this.wsInflateLength,i=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:r,wsDeflateLength:i}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(r){var i;const d=MN();this.connectionID+=1,this.joinGatewayRecordIndex=void 0;const h=x=>{var H;(H=this.store)===null||H===void 0||H.signalChannelOpen(),Wt.debug("[".concat(this.name,"] websocket opened:"),x),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),d.resolve()},f=async x=>{var H;if(Wt.debug("[".concat(this.name,"] websocket close ").concat((H=this.websocket)===null||H===void 0?void 0:H.url,", code: ").concat(x.code,", reason: ").concat(x.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount>=this.retryConfig.maxRetryCount)d.reject(new n_(Gi.WS_DISCONNECT,"websocket close: ".concat(x.code))),this.close();else{this.state==="connected"&&(this.reconnectReason=x.reason,this.state="reconnecting");const $=mT(this,Y_.WILL_RECONNECT,this.reconnectMode,x.reason)||this.reconnectMode,_t=await this.reconnectWithAction($);if(this.state==="closed")return void Wt.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!_t)return d.reject(new n_(Gi.WS_DISCONNECT,"websocket reconnect failed: ".concat(x.code))),this.close(!0);d.resolve()}},g=x=>{this.emit(Y_.ON_MESSAGE,x)},b=x=>{Wt.warn("[".concat(this.connectionID,"] ws open error ").concat(x))};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),_s("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(r=_s("GATEWAY_WSS_ADDRESS")),Wt.debug("[".concat(this.name,"] start connect, url:"),r);const C=(i=this.store)===null||i===void 0?void 0:i.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});try{var P;this._websocketUrl=HF(r);const x=await this.chooseBestWebsocketConnection(r);this.websocket=x,h&&h(this.websocket.url),this.websocket.onclose=f,this.websocket.onmessage=g,this.websocket.onerror=b,(P=this.store)===null||P===void 0||P.recordJoinChannelService({endTs:Date.now(),status:"success"},C),this.joinGatewayRecordIndex=C}catch(x){const H=this.state==="closed",$=x instanceof n_,_t=$&&x.code===Gi.WS_ABORT,_i=$&&x.code===Gi.WS_ERR,ue=$?x.message:x&&(x.reason||x.toString());Wt.warning("[choose-best-ws] chooseBestWebsocket error: ".concat(ue)),this.store&&this.store.recordJoinChannelService({endTs:Date.now(),status:_t?"aborted":"error",errors:[x]},C),H||_i?(d.reject(H?new n_(Gi.WS_DISCONNECT,"websocket is closed: ".concat(ue)):new n_(Gi.WS_ERR,"init websocket failed: ".concat(ue))),_i&&Wt.error("[".concat(this.name,"] init websocket failed: ").concat(ue))):f&&f(x)}return d.promise}async reconnectWithAction(r){let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||this.urls.length===0||this.state==="closed")return!1;Wt.warning("[choose-best-ws] action: =>",r),this.onlineReconnectListener||Fg.isOnline||!Fg.onlineWaiter||(this.onlineReconnectListener=Fg.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let d=!0;if(this.reconnectInterrupter=()=>d=!1,i){const g=$j(this.reconnectCount,this.retryConfig);Wt.debug("[".concat(this.name,"] wait ").concat(g,"ms to reconnect websocket, mode: ").concat(r)),await T_.race([mS(g),this.onlineReconnectListener||new T_(()=>{})])}if(this._state==="closed"||!d)return!1;this.reconnectCount+=1;const h=async(g,b)=>{this.emit(Y_.RECONNECT_CREATE_CONNECTION,b),await this.createWebSocketConnection(g)};try{if(r==="retry")await h(this.urls[this.currentURLIndex],r);else if(r==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return this.reconnectWithAction("recover",!1);Wt.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex)),await h(this.urls[this.currentURLIndex],r)}else r==="recover"&&(Wt.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.urls=await TS(this,Y_.REQUEST_NEW_URLS),this.currentURLIndex=0,await h(this.urls[this.currentURLIndex],r))}catch(g){var f;Wt.error("[".concat(this.name,"] reconnect failed ").concat(g&&g.toString()));const b=g==null||(f=g.data)===null||f===void 0?void 0:f.desc;return Array.isArray(b)&&E_(b).call(b,"dynamic key expired")?(this.emit(Y_.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):this.reconnectWithAction(r,i)}return!0}}class zF extends yJ{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){const d=MN(),h=function(g,b){return new lht(g,b)}(this.forceCloseTimeout,this.store);this.closeEstablishingWs=()=>{Wt.debug("[choose-best-ws] close establishing websockets"),h.closeAllWebsockets(),d.reject(new n_(Gi.WS_ABORT,"choose best websocket aborted"))};const f=_s("GATEWAY_DOMAINS");return Wt.debug("[choose-best-ws] currentDomain: ",r,", domains: ",f,"total: ".concat(this.urls.length),"current: ".concat(this.currentURLIndex+1)),h.chooseBestWebsocket(r,this.tryDoubleDomain,this.use443PortOnly,i).then(d.resolve).catch(d.reject),d.promise.finally(()=>{this.closeEstablishingWs=void 0})}}class ZN extends yJ{constructor(r,i){super(r,i,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3&&arguments[3]!==void 0&&arguments[3],arguments.length>4&&arguments[4]!==void 0&&arguments[4],arguments.length>5?arguments[5]:void 0)}async chooseBestWebsocketConnection(r,i){return new T_((d,h)=>{let f=!1;const g=[];this.closeEstablishingWs=()=>{Wt.debug("[choose-best-ws] close establishing websockets"),g.forEach(_i=>{_i.onclose=null,_i.onopen=null,_i.onmessage=null,_i.close()}),h(new n_(Gi.WS_ABORT,"choose best websocket aborted"))};const b=_s("GATEWAY_DOMAINS");let C;const P=r.indexOf("?h="),x=b.find(_i=>P!==-1?E_(r).call(r,_i,P):E_(r).call(r,_i));Wt.debug("[choose-best-ws] currentDomain: ",x,", domains: ",b);let H=!this.tryDoubleDomain||!x;if(!H&&x){var $;const _i=Date.now();try{b.forEach(ue=>{const _r=P===-1?r.replace(x,ue):r.substr(0,P)+r.substr(P).replace(x,ue),Fi=new WebSocket(_r);Fi.binaryType="arraybuffer",g.push(Fi),Wt.debug("[choose-best-ws] ws is connecting:",Fi.url)})}catch{for(Wt.debug("[choose-best-ws] ws create failed, fallback to single url"),g.forEach(_r=>_r.close());g.length;)g.pop();H=!0}($=this.store)===null||$===void 0||$.recordJoinChannelService({urls:g.map(ue=>ue.url),service:"gateway"},i),g.forEach(ue=>{ue.onopen=()=>{if(f)return;const _r=Date.now()-_i;Wt.debug("[choose-best-ws] ws open cost ".concat(_r,"ms")),g.filter(Fi=>Fi!==ue).forEach(Fi=>{Wt.debug("[choose-best-ws]close backup websocket: ".concat(Fi.url)),Fi.close()}),f=!0,d(ue)},ue.onclose=_r=>{C=_r,!f&&(g.find(Fi=>!(Fi.readyState===WebSocket.CLOSED||Fi.readyState===WebSocket.CLOSING))||(Wt.debug("[choose-best-ws] all websocket is closed"),f=!0,h(C)))},ue.onmessage=_r=>{Wt.debug("[choose-best-ws]".concat(ue.url," onmessage: ").concat(_r.data))}}),mS(this.forceCloseTimeout).then(()=>{g.forEach(ue=>{ue.readyState!==WebSocket.OPEN&&ue.close()})})}if(H){var _t;let _i;Wt.debug("[choose-best-ws] use single url: ",r),(_t=this.store)===null||_t===void 0||_t.recordJoinChannelService({urls:[r],service:"gateway"},i);try{_i=new WebSocket(r),g.push(_i),_i.binaryType="arraybuffer"}catch(ue){const _r=new n_(Gi.WS_ERR,"init websocket failed! Error: ".concat(ue.toString()));return Wt.error("[".concat(this.name,"]").concat(_r)),void h(_r)}_i.onopen=()=>{d(_i)},_i.onclose=ue=>{h(ue)},_i.onmessage=ue=>{Wt.debug("[choose-best-ws]".concat(_i.url," onmessage: ").concat(ue.data))},mS(this.forceCloseTimeout).then(()=>{_i&&_i.readyState!==WebSocket.OPEN&&_i.close()})}}).then(d=>(this.closeEstablishingWs=void 0,d)).catch(d=>{throw this.closeEstablishingWs=void 0,d})}}class hht extends qE{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===kE.CONNECTED?this.emit(B_.WS_CONNECTED):r===kE.RECONNECTING?this.emit(B_.WS_RECONNECTING,this._websocketReconnectReason):r===kE.CLOSED&&this.emit(B_.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),Ei(this,"_disconnectedReason",void 0),Ei(this,"_websocketReconnectReason",void 0),Ei(this,"_connectionState",kE.CLOSED),Ei(this,"reconnectToken",void 0),Ei(this,"websocket",void 0),Ei(this,"openConnectionTime",void 0),Ei(this,"clientId",void 0),Ei(this,"lastMsgTime",Date.now()),Ei(this,"uploadCache",[]),Ei(this,"uploadCacheInterval",void 0),Ei(this,"rttRolling",new O4(5)),Ei(this,"pingpongTimer",void 0),Ei(this,"wsInflateDataTimer",void 0),Ei(this,"pingpongTimeoutCount",0),Ei(this,"ortc",void 0),Ei(this,"joinResponse",void 0),Ei(this,"multiIpOption",void 0),Ei(this,"initError",void 0),Ei(this,"spec",void 0),Ei(this,"store",void 0),Ei(this,"onWebsocketMessage",d=>{if(d.data instanceof ArrayBuffer)return void this.emit(B_.ON_BINARY_DATA,d.data);const h=JSON.parse(d.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(h,"_id")){const f="res-@".concat(h._id);this.emit(f,h._result,h._message)}else if(Object.prototype.hasOwnProperty.call(h,"_type")){if(this.emit(h._type,h._message),h._type===rE.ON_NOTIFICATION&&this.handleNotification(h._message),h._type===rE.ON_USER_BANNED)switch(h._message.error_code){case 14:this.close(_E.UID_BANNED);break;case 15:this.close(_E.IP_BANNED);break;case 16:this.close(_E.CHANNEL_BANNED)}if(h._type===rE.ON_USER_LICENSE_BANNED)switch(h._message.error_code){case x_.ERR_LICENSE_MISSING:this.close(_E.LICENSE_MISSING);break;case x_.ERR_LICENSE_EXPIRED:this.close(_E.LICENSE_EXPIRED);break;case x_.ERR_LICENSE_MINUTES_EXCEEDED:this.close(_E.LICENSE_MINUTES_EXCEEDED);break;case x_.ERR_LICENSE_PERIOD_INVALID:this.close(_E.LICENSE_PERIOD_INVALID);break;case x_.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(_E.LICENSE_MULTIPLE_SDK_SERVICE);break;case x_.ERR_LICENSE_ILLEGAL:this.close(_E.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new zF("gateway-".concat(this.clientId),this.spec.retryConfig,!0,_s("JOIN_GATEWAY_USE_DUAL_DOMAIN"),_s("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===kE.CONNECTED&&this.reconnect("retry",SS.OFFLINE)})}async request(r,i,d,h){const f=AE(6,""),g={_id:f,_type:r,_message:i},b=this.websocket.connectionID,C=()=>new T_((_i,ue)=>{if(this.connectionState===kE.CONNECTED)return _i();const _r=()=>{this.off(B_.WS_CLOSED,Fi),_i()},Fi=()=>{this.off(B_.WS_CONNECTED,_r),ue(new t_(Gi.WS_ABORT))};this.once(B_.WS_CONNECTED,_r),this.once(B_.WS_CLOSED,Fi),r!==j_.PUBLISH&&r!==j_.PUBLISH_DATASTREAM&&r!==j_.SUBSCRIBE&&r!==j_.SUBSCRIBE_DATASTREAM&&r!==j_.UNSUBSCRIBE&&r!==j_.UNSUBSCRIBE_DATASTREAM&&r!==j_.UNPUBLISH&&r!==j_.UNPUBLISH_DATASTREAM&&r!==j_.CONTROL&&r!==j_.RESTART_ICE||this.once(B_.DISCONNECT_P2P,()=>{ue(new t_(Gi.DISCONNECT_P2P))}),r!==j_.PUBLISH&&r!==j_.RESTART_ICE||this.once(B_.ABORT_P2P_EXECUTION,()=>{ue(new t_(Gi.DISCONNECT_P2P))})});if(this.connectionState!==kE.CONNECTING&&this.connectionState!==kE.RECONNECTING||r===j_.JOIN||r===j_.REJOIN||await C(),this.websocket.sendMessage(g,!0),h)return;const P=new T_((_i,ue)=>{let _r=!1;const Fi=(Js,_l)=>{_r=!0,_i({isSuccess:Js==="success",message:_l||{}}),this.off(B_.WS_CLOSED,Di),this.off(B_.WS_RECONNECTING,Di),this.emit(B_.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(f),Fi);const Di=()=>{ue(new t_(Gi.WS_ABORT,"type: ".concat(r))),this.off(B_.WS_CLOSED,Di),this.off(B_.WS_RECONNECTING,Di),this.off("res-@".concat(f),Fi)};this.once(B_.WS_CLOSED,Di),this.once(B_.WS_RECONNECTING,Di),mS(_s("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==b||_r||(Wt.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(B_.REQUEST_TIMEOUT,r,i))})});let x=null;try{x=await P}catch(_i){if(this.connectionState===kE.CLOSED||r===j_.LEAVE)throw new t_(Gi.WS_ABORT);return!this.spec.forceWaitGatewayResponse||d?_i.throw():r===j_.JOIN||r===j_.REJOIN?null:(await C(),await this.request(r,i))}if(x.isSuccess)return x.message;const H=Number(x.message.error_code||x.message.code),$=QN(H),_t=new t_(Gi.UNEXPECTED_RESPONSE,"".concat($.desc,": ").concat(x.message.error_str),{code:H,data:x.message,desc:$.desc});return $.action==="success"?x.message:(Wt.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(H,", message: ").concat($.desc,", action: ").concat($.action)),H===x_.ERR_TOO_MANY_BROADCASTERS?((r===j_.JOIN||r===j_.REJOIN)&&(this.initError=_t,this.close()),_t.throw()):$.action==="failed"?_t.throw():$.action==="quit"?(this.initError=_t,this.close(),_t.throw()):(H===x_.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=x.message.option,Wt.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",SS.MULTI_IP)):this.reconnect($.action,SS.SERVER_ERROR),r===j_.JOIN||r===j_.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new T_(d=>{const h=f=>{(!i||i(f))&&(this.off(r,h),d(f))};this.on(r,h)})}uploadWRTCStats(r){if(!this.store.sessionId)return void Wt.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(JN.WRTC_STATS,i)}upload(r,i){const d={_type:r,_message:i};try{this.websocket.sendMessage(d)}catch{const f=_s("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(d),this.uploadCache.length>f&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==kE.CONNECTED)return;const g=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(g._type,g._message)},_s("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const d={_type:r,_message:i};this.websocket.sendMessage(d)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new T_((i,d)=>{this.once(B_.WS_CONNECTED,()=>i(this.joinResponse)),this.once(B_.WS_CLOSED,h=>d(this.initError||new t_(Gi.WS_ABORT,h))),this.connectionState=kE.CONNECTING,this.websocket.init(r).catch(d),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=r||_E.LEAVE,this.connectionState=kE.CLOSED,Wt.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close()}async join(){if(!this.joinResponse){this.emit(B_.ABORT_P2P_EXECUTION),this.store.signalConnected();const r=await TS(this,B_.REQUEST_JOIN_INFO);this.store.joinReq();const i=await this.request(j_.JOIN,r);if(this.ortc=r==null?void 0:r.ortc,this.store.joinRep(),!i)return this.emit(B_.REPORT_JOIN_GATEWAY,QL.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(B_.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=kE.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new t_(Gi.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const r=FN(this,B_.REQUEST_REJOIN_INFO);r.token=this.reconnectToken;const i=await this.request(j_.REJOIN,r);return!!i&&(this.connectionState=kE.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),i.peers&&i.peers.forEach(d=>{this.emit(rE.ON_USER_ONLINE,{uid:d.uid}),d.audio&&this.emit(rE.ON_ADD_AUDIO_STREAM,{uid:d.uid,uint_id:d.uint_id,audio:!0,ssrcId:d.audio_ssrc}),d.video&&this.emit(rE.ON_ADD_VIDEO_STREAM,{uid:d.uid,uint_id:d.uint_id,video:!0,ssrcId:d.video_ssrc}),d.audio_mute?this.emit(rE.MUTE_AUDIO,{uid:d.uid}):this.emit(rE.UNMUTE_AUDIO,{uid:d.uid}),d.video_mute?this.emit(rE.MUTE_VIDEO,{uid:d.uid}):this.emit(rE.UNMUTE_VIDEO,{uid:d.uid}),d.audio_enable_local?this.emit(rE.ENABLE_LOCAL_AUDIO,{uid:d.uid}):this.emit(rE.DISABLE_LOCAL_AUDIO,{uid:d.uid}),d.video_enable_local?this.emit(rE.ENABLE_LOCAL_VIDEO,{uid:d.uid}):this.emit(rE.DISABLE_LOCAL_VIDEO,{uid:d.uid}),d.audio||d.video||this.emit(rE.ON_REMOVE_STREAM,{uid:d.uid,uint_id:d.uint_id})}),!0)}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){if(!this.ortc)return!1;const i={downgrade_codec:r,ortc:this.ortc};return!!await this.request(j_.DOWNGRADE_CODEC,i)}handleNotification(r){Wt.debug("[".concat(this.clientId,"] receive notification: "),r);const i=QN(r.code);if(r.code===28&&"detail"in r&&(Wt.info("[".concat(this.clientId,"] receive recover notification: "),r.detail),this.emit(B_.RECOVER_NOTIFICATION,r.detail)),i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(_E.UID_BANNED),void this.close()):void this.reconnect(i.action,SS.SERVER_ERROR);Wt.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=_s("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(Wt.warning("[".concat(this.clientId,"] PING-PONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>_s("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",SS.TIMEOUT):this.request(j_.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const d=Date.now()-i;this.rttRolling.add(d),_s("REPORT_STATS")&&this.send(j_.PING_BACK,{pingpongElapse:d})}).catch(d=>{})}handleWsInflateData(){const{wsInflateLength:r,wsDeflateLength:i}=this.websocket.getWsInflateData();r!==0&&i!==0&&this.upload(JN.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:i,ws_inflate_length:r})}handleWebsocketEvents(){this.websocket.on(Y_.RECONNECT_CREATE_CONNECTION,r=>{this.emit(B_.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Y_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Y_.CLOSED,()=>{this.connectionState=kE.CLOSED}),this.websocket.on(Y_.FAILED,()=>{this._disconnectedReason=_E.NETWORK_ERROR,this.connectionState=kE.CLOSED}),this.websocket.on(Y_.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===kE.CONNECTED?this.connectionState=kE.RECONNECTING:this.connectionState=kE.CONNECTING}),this.websocket.on(Y_.WILL_RECONNECT,(r,i,d)=>{const h=FN(this,B_.IS_P2P_DISCONNECTED),f=h||r!=="retry";h&&r==="retry"&&(Wt.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),r="tryNext",i=QL.P2P_DISCONNECTED),f&&(Wt.debug("".concat(this.clientId," will renewSession, reconnect mode: ").concat(r)),this.emit(B_.REPORT_JOIN_GATEWAY,i||QL.UNKNOWN_REASON,this.url||""),this.reconnectToken=void 0,this.emit(B_.DISCONNECT_P2P)),d(r)}),this.websocket.on(Y_.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(r=>{Wt.warning("[".concat(this.clientId,"] rejoin failed ").concat(r)),this.reconnect("tryNext",SS.SERVER_ERROR)}):this.join().catch(r=>{if(this.emit(B_.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof t_){if(r.code===Gi.UNEXPECTED_RESPONSE&&r.data.code===x_.ERR_NO_AUTHORIZED)return this.initError=new t_(Gi.TOKEN_EXPIRE,"dynamic key expired"),void this.close(_E.TOKEN_EXPIRE);Wt.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",SS.SERVER_ERROR):(this.initError=r,this.close())}})}),this.websocket.on(Y_.REQUEST_NEW_URLS,(r,i)=>{TS(this,B_.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Y_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(rE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(gJ.PRE_CONNECT_PC,()=>{this.emit(B_.PRE_CONNECT_PC)})}}let pht=function(e){return e.NATIVE_RTC="native_rtc",e.NATIVE_RTM="native_rtm",e.WEB_RTC="web_rtc",e.WEB_RTM="web_rtm",e}({}),_v=function(e){return e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK",e}({});function SJ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function $L(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?SJ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):SJ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}function P0(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(_s("TURN_DOMAIN")):(Wt.debug("Cannot recognized as ip address: ".concat(e,", use as host2")),e)}function t1(e){try{const r=_s("GATEWAY_DOMAINS").concat(_s("TURN_DOMAIN")).find(i=>E_(e).call(e,i));return r?e.split(".".concat(r))[0].replace(/-/g,"."):e}catch{return Wt.debug("serverUrlToIp error, fallback to url",e),e}}function YF(e,r){e.addresses||(e.addresses=[]);const i=function(b,C){if(_s("CONNECT_GATEWAY_WITHOUT_DOMAIN"))return b.map(H=>{let{ip:$,port:_t}=H;return{address:"".concat($,":").concat(_t)}});const P=_s("GATEWAY_DOMAINS");let x=P[1]&&E_(C).call(C,P[1])?1:0;return b.map(H=>{let{domain_prefix:$,port:_t,ip:_i}=H;if($)return{address:"".concat($,".").concat(P[x++%P.length],":").concat(_t)};const ue=/^[\.\:\d]+$/.test(_i),_r=ue?"".concat(_i.replace(/[^\d]/g,"-"),".").concat(P[x++%P.length],":").concat(_t):"".concat(_i,":").concat(_t);return ue||Wt.debug("Cannot recognized as ip address: ".concat(_i,", use as host3")),{ip:_i,port:_t,address:_r}})}(e.addresses,r),d=Array.isArray(e.detail)&&e.detail[18];if(d&&typeof d=="string"){const b=d.split(";");for(let C=0;C<b.length;C++){var h;const P=xS(h=b[C]).call(h);i[C]&&P&&(i[C].ip6=P)}}const f=e.detail&&e.detail.candidate;let g;if(f){const[b,C]=f.split(":");b&&C&&(g={port:Number(C),ip:b,address:"".concat(b,":").concat(C)})}return{gatewayAddrs:i,apGatewayAddress:g,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function dT(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function TJ(e){const r=e._encoderConfig;if(!r)return{};const i={resolution:r.width&&r.height?"".concat(dT(r.width),"x").concat(dT(r.height)):void 0,maxVideoBW:r.bitrateMax,minVideoBW:r.bitrateMin};return typeof r.frameRate=="number"?(i.maxFrameRate=r.frameRate,i.minFrameRate=r.frameRate):r.frameRate&&(i.maxFrameRate=r.frameRate.max||r.frameRate.ideal||r.frameRate.exact||r.frameRate.min,i.minFrameRate=r.frameRate.min||r.frameRate.ideal||r.frameRate.exact||r.frameRate.max),i}function RJ(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function $N(e,r){let i,d,h;switch(r){case _v.CHOOSE_SERVER:d=4096,h="choose server";break;case _v.CLOUD_PROXY:d=1048576,h="proxy";break;case _v.CLOUD_PROXY_5:d=4194304,h="proxy5";break;case _v.CLOUD_PROXY_FALLBACK:d=4194310,h="proxy fallback";break;default:throw new t_(Gi.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(f=>{f.buffer&&f.buffer.flag===d&&(i={code:f.buffer.code,addresses:(f.buffer.edges_services||[]).map(g=>$L($L({},g),{},{ticket:f.buffer.cert})),server_ts:e.enter_ts,uid:f.buffer.uid,cid:f.buffer.cid,cname:f.buffer.cname,detail:$L($L({},f.buffer.detail),e.detail),flag:f.buffer.flag,opid:e.opid,cert:f.buffer.cert})}),!i)throw new t_(Gi.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(h," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return i}async function IJ(e,r){return await T_.all(e.addresses.map(async i=>({address:P0(i.ip),tcpport:i.port,udpport:i.port,username:r&&_s("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?r.toString():RS.username,password:r&&_s("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await QV(r.toString()):RS.password})))}function JF(e,r){const i=r.getMediaStreamTrack(!0).getSettings(),d=r.videoHeight||i.height,h=r.videoWidth||i.width;return d&&h?Math.max(Math.min(d,h)/Math.min(dT(e.height),dT(e.width)),1):(Wt.warning("can't get ori-track's height, default scale down 4 times for low stream"),4)}function D0(e){let{candidateType:r,relayProtocol:i,type:d,address:h,port:f,protocol:g}=e;const b={candidateType:r,relayProtocol:i,protocol:g};if(d!=="local-candidate"){const C=h.split(".");C.length>=4&&(C[1]="*",C[2]="*"),b.address=C.join("."),b.port=f}return b}function SI(e){const r=e.split(":"),i=e.split(/[-.]/),d=E_(e).call(e,"-")?"-":".";let h=e;return r.length>1?i.length>1?(i[1]="**",h=i[0]+d+"**:"+r[r.length-1]):h=r.length>2?r[0]+d+"**:"+r[r.length-1]:"**:"+r[r.length-1]:i.length>1&&(h=i[0]+d+"**"),h}function e1(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:_s("SVC_MODE");if(_s("ENABLE_SVC"))return function(r){return r in OL}(e)?e:OL.L1T3}const wJ={[A_.VIDEO]:[{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"},{key:"video-orientation",extensionName:"urn:3gpp:video-orientation"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"playout-delay",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/playout-delay"},{key:"video-content-type",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-content-type"},{key:"color-space",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/color-space"},{key:"video-timing",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/video-timing"}],[A_.AUDIO]:[{key:"ssrc-audio-level",extensionName:"urn:ietf:params:rtp-hdrext:ssrc-audio-level"},{key:"draft-holmer-rmcat-transport-wide-cc-extensions-01",extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"},{key:"abs-send-time",extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}]};function n1(e,r,i){r.forEach(d=>{var h;const f=wJ[e].find(b=>{var C;let{key:P}=b;return E_(C=d.extensionName).call(C,P)});if(!f)return;const g=i.find(b=>{let{extensionName:C}=b;return E_(C).call(C,f.key)});g&&E_(h=g.extensionName).call(h,"gdpr_forbidden")&&(d.extensionName=g.extensionName)})}function UO(e,r){r.forEach(i=>{var d;const h=wJ[e].find(f=>{var g;let{key:b}=f;return E_(g=i.extensionName).call(g,b)});E_(d=i.extensionName).call(d,"gdpr_forbidden")&&h&&(i.extensionName=h.extensionName)})}function CJ(e){return e==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"||E_(e).call(e,"abs-send-time")}function r1(e){return e==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"||E_(e).call(e,"draft-holmer-rmcat-transport-wide-cc-extensions-01")}function AJ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function OJ(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?AJ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):AJ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}function tP(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},d=arguments.length>3?arguments[3]:void 0;const{filterRTX:h,filterVideoFec:f,filterAudioFec:g,filterAudioCodec:b,filterVideoCodec:C,unsupportedVideoUplinkCodec:P,unsupportedVideoDownlinkCodec:x}=r,{useXR:H}=i;let $=[],_t=[],_i=[],ue=[],_r=!1,Fi=!1;if($S(e).mediaDescriptions.forEach(Js=>{d&&d!==Js.attributes.direction||(Js.media.mediaType!=="video"||_r||(_t=Js.attributes.payloads,ue=Js.attributes.extmaps,_r=!0),Js.media.mediaType!=="audio"||Fi||($=Js.attributes.payloads,_i=Js.attributes.extmaps,Fi=!0))}),!ue||_t.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!_i||$.length===0)throw new Error("Cannot get audio capabilities from SDP.");if(_t.forEach(Js=>{var _l;(_l=Js.rtpMap)!==null&&_l!==void 0&&_l.clockRate&&(Js.rtpMap.clockRate=parseInt(Js.rtpMap.clockRate)),H&&Js.rtcpFeedbacks.push({type:"rrtr"})}),$.forEach(Js=>{var _l;(_l=Js.rtpMap)!==null&&_l!==void 0&&_l.clockRate&&(Js.rtpMap.clockRate=parseInt(Js.rtpMap.clockRate)),H&&Js.rtcpFeedbacks.push({type:"rrtr"})}),h&&($=$.filter(Js=>{var _l;return((_l=Js.rtpMap)===null||_l===void 0?void 0:_l.encodingName.toLowerCase())!=="rtx"}),_t=_t.filter(Js=>{var _l;return((_l=Js.rtpMap)===null||_l===void 0?void 0:_l.encodingName.toLowerCase())!=="rtx"})),f){const Js=_t.filter(ga=>{var _m;return/(red)|(ulpfec)|(flexfec)/i.test(((_m=ga.rtpMap)===null||_m===void 0?void 0:_m.encodingName)||"")}),_l=L0(Js,_t).map(ga=>ga.payloadType),_u=[...Js.map(ga=>ga.payloadType),..._l];_t=_t.filter(ga=>!E_(_u).call(_u,ga.payloadType))}if(g&&($=$.filter(Js=>{var _l;return!/(red)|(ulpfec)|(flexfec)/i.test(((_l=Js.rtpMap)===null||_l===void 0?void 0:_l.encodingName)||"")})),b&&(b==null?void 0:b.length)>0&&($=$.filter(Js=>{var _l;return E_(b).call(b,((_l=Js.rtpMap)===null||_l===void 0?void 0:_l.encodingName.toLowerCase())||"")})),C&&(C==null?void 0:C.length)>0){const Js=_t.filter(_l=>{var _u;return E_(C).call(C,((_u=_l.rtpMap)===null||_u===void 0?void 0:_u.encodingName.toLowerCase())||"")});_t=Js.concat(h?[]:L0(Js,_t))}const Di=_s("UNSUPPORTED_VIDEO_CODEC");if(Di&&Di.length>0){const Js=_t.filter(ga=>ga.rtpMap&&E_(Di).call(Di,ga.rtpMap.encodingName.toLowerCase())),_l=L0(Js,_t),_u=Js.concat(_l).map(ga=>ga.payloadType);_t=_t.filter(ga=>!E_(_u).call(_u,ga.payloadType)),Wt.debug("unsupportedVideoCodec: ".concat(Di,", toBeRemoved: ").concat(_u))}if(P&&P.length>0&&d==="sendonly"){const Js=_t.filter(ga=>ga.rtpMap&&E_(P).call(P,ga.rtpMap.encodingName.toLowerCase())),_l=L0(Js,_t),_u=Js.concat(_l).map(ga=>ga.payloadType);_t=_t.filter(ga=>!E_(_u).call(_u,ga.payloadType)),Wt.debug("unsupportedVideoUplinkCodec: ".concat(P,", toBeRemoved: ").concat(_u))}if(x&&x.length>0&&d==="recvonly"){const Js=_t.filter(ga=>ga.rtpMap&&E_(x).call(x,ga.rtpMap.encodingName.toLowerCase())),_l=L0(Js,_t),_u=Js.concat(_l).map(ga=>ga.payloadType);_t=_t.filter(ga=>!E_(_u).call(_u,ga.payloadType)),Wt.debug("unsupportedVideoDownlinkCodec: ".concat(x,", toBeRemoved: ").concat(_u))}return{audioCodecs:$,videoCodecs:_t,audioExtensions:_i,videoExtensions:ue}}function k0(e){const r=$S(e);let i,d;for(const h of r.mediaDescriptions){if(!i){const f=h.attributes.iceUfrag,g=h.attributes.icePwd;if(!f||!g)throw new Error("Cannot get iceUfrag or icePwd from SDP.");i={iceUfrag:f,icePwd:g}}if(!d){const f=h.attributes.fingerprints;f.length>0&&(d={fingerprints:f})}}if(!d&&r.attributes.fingerprints.length>0&&(d={fingerprints:r.attributes.fingerprints}),!d||!i)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:i,dtlsParameters:d}}function NJ(e,r){const i=[],d=e.attributes.ssrcGroups.filter(g=>g.semantic==="FID"),h=e.attributes.ssrcGroups.find(g=>g.semantic==="SIM"),f=e.attributes.ssrcs;if(h)h.ssrcIds.forEach(g=>{var b;const C=(b=d.find(P=>P.ssrcIds[0]===g))===null||b===void 0?void 0:b.ssrcIds[1];i.push({ssrcId:g,rtx:r?C:void 0})});else if(d.length>0){const g=d[0].ssrcIds[0],b=d[0].ssrcIds[1];i.push({ssrcId:g,rtx:r?b:void 0})}else{if(f.length===0)throw new Error("No ssrcs found on local media description.");i.push({ssrcId:f[0].ssrcId})}return i}function PJ(e,r,i){const{cname:d}=e;let h=[];r&&(h=DJ(r)),h.length===0&&(h=e.iceParameters.candidates.map(x=>({foundation:x.foundation,componentId:"1",transport:x.protocol,priority:x.priority.toString(),connectionAddress:x.ip,port:x.port.toString(),type:x.type,extension:{}})),Wt.debug("Using candidates from gateway."));const f={fingerprints:e.dtlsParameters.fingerprints.map(x=>({hashFunction:x.algorithm,fingerprint:x.fingerprint}))},g={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let b;switch(e.dtlsParameters.role){case"server":b="passive";break;case"client":b="active";break;case"auto":b="actpass"}const C=o1(e.rtpCapabilities),P=[];return Array.isArray(i)&&i.length>0&&i.forEach(x=>{P.push({kind:A_.VIDEO,ssrcMsg:[{ssrcId:x.v,rtx:x.v_rtx}],mslabel:"".concat(x.v,"_").concat(x.a)},{kind:A_.AUDIO,ssrcMsg:[{ssrcId:x.a}],mslabel:"".concat(x.v,"_").concat(x.a)})}),{dtlsParameters:f,iceParameters:g,candidates:h,rtpCapabilities:C,setup:b,cname:d,preSSRCs:P}}function DJ(e){let r=[];return e.ip&&typeof e.port=="number"&&(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip,port:e.port.toString(),type:"host",extension:{}}],Wt.debug("Using remote candidate from AP ".concat(SI(e.ip),":").concat(e.port)),e.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:e.ip6,port:e.port.toString(),type:"host",extension:{}}),Wt.debug("Using IPV6 remote candidate from AP ".concat(SI(e.ip6),":").concat(e.port)))),r}function eP(e,r,i){const d=[],h=[];return e.forEach(f=>{let{ssrcId:g,rtx:b}=f;const C=AE(8,"track-"),P={ssrcId:g,attributes:OJ({label:C,mslabel:i=i||AE(10,""),msid:"".concat(i," ").concat(C)},r&&{cname:r})};if(d.push(P),b!==void 0){const x={ssrcId:b,attributes:OJ({label:C,mslabel:i,msid:"".concat(i," ").concat(C)},r&&{cname:r})};d.push(x),h.push({semantic:"FID",ssrcIds:[g,b]})}}),e.length>1&&h.push({semantic:"SIM",ssrcIds:e.map(f=>{let{ssrcId:g}=f;return g})}),{ssrcs:d,ssrcGroups:h}}function VO(e,r){r instanceof XE&&e.attributes.payloads.forEach(i=>{var d;const h=(d=i.rtpMap)===null||d===void 0?void 0:d.encodingName.toLowerCase();if(!h||["opus","pcmu","pcma","g722"].indexOf(h)===-1)return;i.fmtp||(i.fmtp={parameters:{}}),h==="opus"&&typeof _s("OPUS_PTIME")=="number"?i.fmtp.parameters.ptime=_s("OPUS_PTIME"):i.fmtp.parameters.minptime="10",i.fmtp.parameters.useinbandfec="1";const f=r._encoderConfig;f&&(h!=="pcmu"&&h!=="pcma"&&h!=="g722"&&(f.bitrate&&!KE()&&(i.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*f.bitrate))),f.sampleRate&&(i.fmtp.parameters.maxplaybackrate="".concat(f.sampleRate),i.fmtp.parameters["sprop-maxcapturerate"]="".concat(f.sampleRate)),f.stereo&&(i.fmtp.parameters.stereo="1",i.fmtp.parameters["sprop-stereo"]="1")),r instanceof zN&&h==="opus"&&r._config.DTX&&(i.fmtp.parameters.usedtx="1"))})}function XF(e){const r=e.attributes.unrecognized.findIndex(i=>i.attField==="x-google-flag"&&i.attValue==="conference");r!==-1&&e.attributes.unrecognized.splice(r,1)}function QF(e,r){var i;if(!(r instanceof LE&&r._encoderConfig&&r._hints.indexOf(wE.SCREEN_TRACK)===-1))return;const d=r._encoderConfig;uE().supportMinBitrate&&d.bitrateMin&&e.attributes.payloads.forEach(h=>{var f,g;E_(f=["h264","h265","vp8","vp9","av1"]).call(f,((g=h.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())||"")&&(h.fmtp||(h.fmtp={parameters:{}}),h.fmtp.parameters["x-google-min-bitrate"]="".concat(d.bitrateMin))}),uE().supportMinBitrate&&!E_(i=r._hints).call(i,wE.LOW_STREAM)&&d.bitrateMax&&e.attributes.payloads.forEach(h=>{var f,g;E_(f=["h264","h265","vp8","vp9","av1"]).call(f,((g=h.rtpMap)===null||g===void 0?void 0:g.encodingName.toLowerCase())||"")&&(h.fmtp||(h.fmtp={parameters:{}}),h.fmtp.parameters["x-google-start-bitrate"]="".concat(_s("X_GOOGLE_START_BITRATE")||Math.floor(d.bitrateMax)))})}function kJ(e){if(e.media.mediaType!=="video")return;const r=oE();if(r.name!==hE.SAFARI&&r.os!==aS.IOS)return;const i=e.attributes.extmaps.findIndex(d=>/video-orientation/g.test(d.extensionName));i!==-1&&e.attributes.extmaps.splice(i,1)}function i1(e,r,i){if(!r)return;let d,h;if(e.media.mediaType==="video"?(d=i.videoExtensions,h=i.videoCodecs):(d=i.audioExtensions,h=i.audioCodecs),r.twcc===!0){const f=d.find(g=>r1(g.extensionName));if(f){const g=f.extensionName;e.attributes.extmaps.find(C=>r1(C.extensionName))||e.attributes.extmaps.push({entry:f.entry,extensionName:g}),function(C,P){return P.filter(x=>!!C.find(H=>H.payloadType===x.payloadType&&!!H.rtcpFeedbacks.find($=>$.type==="transport-cc")))}(h,e.attributes.payloads).forEach(C=>{C.rtcpFeedbacks.find(P=>P.type==="transport-cc")||C.rtcpFeedbacks.push({type:"transport-cc"})})}}else if(r.twcc===!1){const f=e.attributes.extmaps.findIndex(g=>r1(g.extensionName));f!==-1&&e.attributes.extmaps.splice(f,1),e.attributes.payloads.forEach(g=>{const b=g.rtcpFeedbacks.findIndex(C=>C.type==="transport-cc");b!==-1&&g.rtcpFeedbacks.splice(b,1)})}if(r.remb===!0){const f=d.find(g=>CJ(g.extensionName));if(f){const g=f.extensionName;e.attributes.extmaps.find(C=>C.extensionName===g)||e.attributes.extmaps.push({entry:f.entry,extensionName:g}),function(C,P){return P.filter(x=>!!C.find(H=>H.payloadType===x.payloadType&&!!H.rtcpFeedbacks.find($=>$.type==="goog-remb")))}(h,e.attributes.payloads).forEach(C=>{C.rtcpFeedbacks.find(P=>P.type==="goog-remb")||C.rtcpFeedbacks.push({type:"goog-remb"})})}}else if(r.remb===!1){const f=e.attributes.extmaps.findIndex(g=>CJ(g.extensionName));f!==-1&&e.attributes.extmaps.splice(f,1),e.attributes.payloads.forEach(g=>{const b=g.rtcpFeedbacks.findIndex(C=>C.type==="goog-remb");b!==-1&&g.rtcpFeedbacks.splice(b,1)})}}function LJ(e,r,i){if(KE()||e.media.mediaType!=="video"||!(r instanceof LE)||i!=="vp9"&&i!=="vp8"||i==="vp8"&&!_s("SIMULCAST")||i==="vp9"&&_s("ENABLE_SVC")||r._scalabilityMode===void 0||r._scalabilityMode.numSpatialLayers<=1)return;const d=i==="vp8"?2:r._scalabilityMode.numSpatialLayers,h=e.attributes.ssrcs[0],f=e.attributes.ssrcGroups.find(b=>b.semantic==="FID"&&b.ssrcIds[0]===h.ssrcId),g={semantic:"SIM",ssrcIds:[h.ssrcId]};for(let b=1;b<d;b++)e.attributes.ssrcs.push({ssrcId:h.ssrcId+b,attributes:BE(h.attributes)}),g.ssrcIds.push(h.ssrcId+b),f&&(e.attributes.ssrcs.push({ssrcId:f.ssrcIds[1]+b,attributes:BE(h.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[h.ssrcId+b,f.ssrcIds[1]+b]}));e.attributes.ssrcGroups.unshift(g)}async function MJ(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=new RTCPeerConnection;i.addTransceiver("video",{direction:"sendonly"}),i.addTransceiver("audio",{direction:"sendonly"}),i.addTransceiver("video",{direction:"recvonly"}),i.addTransceiver("audio",{direction:"recvonly"});const d=(await i.createOffer()).sdp,{send:h,recv:f,sendrecv:g}=function(){let b=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},P=arguments.length>2?arguments[2]:void 0;const x=tP(P,b,C,"sendonly"),H=tP(P,b,C,"recvonly"),$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nR(x,H,"videoExtensions",$,_t,_i),nR(x,H,"videoCodecs",$,_t,_i),nR(x,H,"audioExtensions",$,_t,_i),nR(x,H,"audioCodecs",$,_t,_i),_s("RAISE_H264_BASELINE_PRIORITY")){const ue=[],_r=[];if(_i.videoCodecs.forEach((Fi,Di)=>{var Js;if(((Js=Fi.rtpMap)===null||Js===void 0?void 0:Js.encodingName.toLocaleLowerCase())==="h264"){var _l,_u;const ga=_i.videoCodecs[Di+1],_m=ga&&FJ(Fi,ga),r_=(_l=Fi.fmtp)===null||_l===void 0?void 0:_l.parameters["profile-level-id"],a_=(_u=Fi.fmtp)===null||_u===void 0?void 0:_u.parameters["packetization-mode"];!r_||r_!==_s("FIRST_H264_PROFILE_LEVEL_ID")||_s("FIRST_PACKETIZATION_MODE")&&a_!==_s("FIRST_PACKETIZATION_MODE")?_m?_r.push([Fi,ga]):_r.push([Fi]):_m?ue.push([Fi,ga]):ue.push([Fi])}}),ue.length>0&&_r.length>0){Wt.debug("raising H264 baseline profile priority"),_i.videoCodecs.forEach((Di,Js)=>{var _l;if(((_l=Di.rtpMap)===null||_l===void 0?void 0:_l.encodingName.toLocaleLowerCase())==="h264"){const _u=FJ(Di,_i.videoCodecs[Js+1]),ga=ue.shift()||_r.shift()||[];ga.length>0&&(_u?_i.videoCodecs.splice(Js,2,...ga):_i.videoCodecs.splice(Js,1,...ga))}});const Fi=_t.videoCodecs.filter(Di=>{var Js,_l;return((Js=Di.rtpMap)===null||Js===void 0?void 0:Js.encodingName.toLocaleLowerCase())==="h264"&&((_l=Di.fmtp)===null||_l===void 0?void 0:_l.parameters["profile-level-id"])!==_s("FIRST_H264_PROFILE_LEVEL_ID")});if(Fi.length>0){const Di=L0(Fi,_t.videoCodecs).map(_l=>_l.payloadType),Js=[...Fi.map(_l=>_l.payloadType),...Di];_t.videoCodecs=_t.videoCodecs.filter(_l=>!E_(Js).call(Js,_l.payloadType))}_s("FILTER_SEND_H264_BASELINE")&&($.videoCodecs=$.videoCodecs.filter(Di=>{var Js,_l;return!(((Js=Di.rtpMap)===null||Js===void 0?void 0:Js.encodingName.toLocaleLowerCase())==="h264"&&((_l=Di.fmtp)===null||_l===void 0?void 0:_l.parameters["profile-level-id"])!==_s("FIRST_H264_PROFILE_LEVEL_ID"))}))}return{send:$,recv:_t,sendrecv:_i}}return{send:$,recv:_t,sendrecv:_i}}(e,r,d);try{i.close()}catch{}return{send:h,recv:f,sendrecv:g}}function xJ(){const e={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},r=tP(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"recvonly"),i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},d={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nR(e,r,"videoExtensions",i,d,h),nR(e,r,"videoCodecs",i,d,h),nR(e,r,"audioExtensions",i,d,h),nR(e,r,"audioCodecs",i,d,h),_s("RAISE_H264_BASELINE_PRIORITY")){const f=h.videoCodecs.findIndex(g=>g.rtpMap&&g.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&g.fmtp&&g.fmtp.parameters["profile-level-id"]==="42001f");if(f!==-1){const g=h.videoCodecs.findIndex(b=>b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(g<f){Wt.debug("raising H264 baseline profile priority");const b=h.videoCodecs[f];h.videoCodecs.splice(f,1),h.videoCodecs.splice(g,0,b)}g!==-1&&(d.videoCodecs=d.videoCodecs.filter(b=>!(b.rtpMap&&b.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&b.fmtp&&b.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:i,recv:d,sendrecv:h}}function nR(e,r,i,d,h,f){if(i==="videoExtensions"||i==="audioExtensions"){const g=[];return e[i].forEach(b=>{r[i].some((C,P)=>{if(b.entry===C.entry&&b.extensionName===C.extensionName)return g.push(P),!0})?f[i].push(b):d[i].push(b)}),void r[i].forEach((b,C)=>{g.indexOf(C)===-1&&h[i].push(b)})}if(i==="videoCodecs"||i==="audioCodecs"){const g=[];return e[i].forEach(b=>{r[i].some((C,P)=>{if(b.payloadType===C.payloadType&&JSON.stringify(b)===JSON.stringify(C))return g.push(P),!0})?f[i].push(b):d[i].push(b)}),void r[i].forEach((b,C)=>{g.indexOf(C)===-1&&h[i].push(b)})}}function o1(e){const{send:r,recv:i,sendrecv:d}=e;if(!d){if(!r||!i)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:r,recv:i}}let h,f;return r?(h={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},h.audioCodecs=[...r.audioCodecs,...d.audioCodecs],h.videoCodecs=[...r.videoCodecs,...d.videoCodecs],h.audioExtensions=[...r.audioExtensions,...d.audioExtensions],h.videoExtensions=[...r.videoExtensions,...d.videoExtensions]):h=d,i?(f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},f.audioCodecs=[...i.audioCodecs,...d.audioCodecs],f.videoCodecs=[...i.videoCodecs,...d.videoCodecs],f.audioExtensions=[...i.audioExtensions,...d.audioExtensions],f.videoExtensions=[...i.videoExtensions,...d.videoExtensions]):f=d,{send:h,recv:f}}function jO(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(r=>{var i;return((i=r.rtpMap)===null||i===void 0?void 0:i.encodingName.toLowerCase())==="opus"}).forEach(r=>{r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters.stereo="1",r.fmtp.parameters["sprop-stereo"]="1"})}function nP(e,r,i,d){let h=[];if(e===A_.VIDEO){if(_s("H264_PROFILE_LEVEL_ID")&&d==="h264"&&(h=r.videoCodecs.filter(f=>{var g;return E_(g=f.rtpMap&&f.rtpMap.encodingName.toLowerCase()||"").call(g,d)&&f&&f.fmtp&&f.fmtp.parameters["profile-level-id"]===_s("H264_PROFILE_LEVEL_ID")})),!Array.isArray(h)||h.length===0){let f=[];const g=[],b=[],C=[];if(i.videoCodecs.forEach(P=>{const x=P.rtpMap&&P.rtpMap.encodingName.toLowerCase()||"";E_(x).call(x,d)?f.push(P):E_(x).call(x,"vp9")?g.push(P):E_(x).call(x,"vp8")?b.push(P):E_(x).call(x,"h264")&&C.push(P)}),f.length===0){let P="";g.length!==0?(f=g,P="vp9"):b.length!==0?(f=b,P="vp8"):C.length!==0&&(f=C,P="h264"),Wt.warning("codec ".concat(d," not included in rtpCapabilities, fallback to default payloads: ").concat(P))}f.length!==0&&(h=r.videoCodecs.filter(P=>f.some(x=>x.payloadType===P.payloadType)))}if(h.length===0&&(Wt.warning("codec ".concat(d," not included in rtpCapabilities, fallback to default payloads: ").concat(r.videoCodecs[0].rtpMap&&r.videoCodecs[0].rtpMap.encodingName)),h=r.videoCodecs),_s("USE_PUB_RTX")||_s("USE_SUB_RTX")){const f=L0(h,r.videoCodecs);h=[...h,...f]}}else{h=r.audioCodecs.filter(g=>{var b;return E_(b=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"").call(b,d)});const f=r.audioCodecs.filter(g=>{var b;return E_(b=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"").call(b,"red")});h.length===0&&(Wt.warning("codec ".concat(d," not included in rtpCapabilities, fallback to opus")),h=r.audioCodecs.filter(g=>{var b;return E_(b=g.rtpMap&&g.rtpMap.encodingName.toLowerCase()||"").call(b,"opus")})),_s("ENABLE_AUDIO_RED")&&f.length!==0&&(h=[...f,...h])}return h}function L0(e,r){const i=e.map(d=>d.payloadType.toString());return r.filter(d=>d.rtpMap&&d.rtpMap.encodingName==="rtx"&&d.fmtp&&d.fmtp.parameters.apt&&E_(i).call(i,d.fmtp&&d.fmtp.parameters.apt))}async function M0(e,r,i){const d=r.toString(),h=VJ(d,"offer","remote","exchangeSDP");await e.setRemoteDescription({type:"offer",sdp:d});const f=await e.createAnswer();if(!f.sdp)throw new Error("cannot get answer sdp");let g=f.sdp;g=UJ(g,i||{}),h==null||h(g||""),await e.setLocalDescription({type:"answer",sdp:g})}function UJ(e,r,i){const d=$S(e),{useXR:h}=r;return d.mediaDescriptions.forEach(f=>{var g;f.attributes.mid&&(Array.isArray(i)&&!E_(i).call(i,f.attributes.mid)||(f.media.mediaType==="audio"&&jO(f),h&&E_(g=["audio","video"]).call(g,f.media.mediaType)&&f.attributes.payloads.forEach(b=>{b.rtcpFeedbacks.findIndex(C=>C.type==="rrtr")===-1&&b.rtcpFeedbacks.push({type:"rrtr"})})))}),C0(d)}function VJ(e,r,i,d){if(_s("SDP_LOGGING"))return Wt.upload("exchanging ".concat(i," ").concat(r," SDP during P2PConnection.").concat(d,`
`),e),r==="offer"?h=>{VJ(h,"answer",i==="local"?"remote":"local",d)}:void 0}function jJ(e){const r=_s("COMPATIBLE_SDP_EXTENSION");return!!(Array.isArray(r)&&r.length>0)&&r.some(i=>E_(e).call(e,i))}function FJ(e,r){try{var i;return((i=e.fmtp)===null||i===void 0?void 0:i.parameters.apt)===r.payloadType.toString()}catch{return!1}}function BJ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function RT(e,r){return typeof _s(e)===r?_s(e):void 0}function fht(){try{const e=_s("EXPERIMENTS")||{};return typeof e=="string"||Array.isArray(e)?{}:function(r){for(var i=1;i<arguments.length;i++){var d=arguments[i]!=null?arguments[i]:{};i%2?BJ(Object(d),!0).forEach(function(h){Ei(r,h,d[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(d)):BJ(Object(d)).forEach(function(h){Object.defineProperty(r,h,Object.getOwnPropertyDescriptor(d,h))})}return r}({},e)}catch(e){return Wt.debug("handle gateway attributes failed: ",e),{}}}const GJ={};function x0(e){(!(arguments.length>1&&arguments[1]!==void 0)||arguments[1])&&Wt.debug("install service ".concat(e.name)),GJ[e.name]=e}function a0(e){const r=GJ[e];if(!r)throw new n_(Gi.INVALID_OPERATION,"".concat(e," not found, please use AgoraRTC.use(").concat(e,"Service) to load it first"));return r}function qJ(e,r){return a0("DataStream").create(e,r)}function s1(){return a0("InterceptFrame").create()}function WJ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function MS(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?WJ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):WJ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}const ZF=new Map;class mht extends qE{get state(){return this._state}set state(r){if(r===this._state)return;const i=this._state;this._state=r,r==="DISCONNECTED"&&this._disconnectedReason?this.emit(uS.CONNECTION_STATE_CHANGE,r,i,this._disconnectedReason):this.emit(uS.CONNECTION_STATE_CHANGE,r,i)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(r){Wt.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(r)),this._joinGatewayStartTime=r}constructor(r,i){var d,h,f;super(),Ei(this,"store",void 0),Ei(this,"joinInfo",void 0),Ei(this,"key",void 0),Ei(this,"ntpOffset",0),Ei(this,"signal",void 0),Ei(this,"role",void 0),Ei(this,"isPreallocation",void 0),Ei(this,"isPreSub",void 0),Ei(this,"inChannelInfo",{joinAt:null,duration:0}),Ei(this,"spec",void 0),Ei(this,"_state","DISCONNECTED"),Ei(this,"_statsCollector",void 0),Ei(this,"_disconnectedReason",void 0),Ei(this,"isSignalRecover",!1),Ei(this,"hasChangeBGPAddress",!1),Ei(this,"trafficStatsInterval",void 0),Ei(this,"networkQualityInterval",void 0),Ei(this,"_joinGatewayStartTime",0),Ei(this,"_signalTimeout",!1),Ei(this,"_clientRoleOptions",void 0),Ei(this,"_isProactiveJoin",!1),this.store=r,this.spec=i,this.signal=this.store.useP2P?(d={spec:MS(MS({},i),{},{retryConfig:i.websocketRetryConfig}),store:r},(h=(f=a0("P2PChannel")).createSubmodule)===null||h===void 0?void 0:h.call(f,d)):new hht(MS(MS({},i),{},{retryConfig:i.websocketRetryConfig}),r),this._statsCollector=i.statsCollector,this.role=i.role||"audience",this._clientRoleOptions=i.clientRoleOptions,this.handleSignalEvents()}async join(r,i,d){this.store.joinGatewayStart(),r.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const h=Date.now();let f=ZF.get(r.cname);if(f||(f=new Map,ZF.set(r.cname,f)),this._isProactiveJoin=!0,f.has(r.uid)){const P=new t_(Gi.UID_CONFLICT);throw k_.joinGateway(r.sid,{lts:h,succ:!1,ec:P.code,addr:null,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!r.proxyServer,signalChannel:"0",preload:r.preload}),P}f.set(r.uid,!0),this.joinInfo=r,this.key=i;let g=0;this.joinGatewayStartTime=h;const b=r.proxyServer;try{Wt.debug("[".concat(this.store.clientId,"] use websocket join uid ").concat(g));const P=r.gatewayAddrs.map(x=>{let{address:H}=x;const[$,_t]=H.split(":"),_i={host:$,port:_t};return r.proxyServer&&(_i.proxy=r.proxyServer),_i});g=(await this.signal.init(P)).uid,Wt.debug("[".concat(this.store.clientId,"] websocket join uid ").concat(g," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(P){var C;throw Wt.error("[".concat(this.store.clientId,"] User join failed"),P.toString()),k_.joinGateway(r.sid,{lts:h,succ:!1,ec:((C=P.data)===null||C===void 0?void 0:C.desc)||P.code,errorMsg:P.message,addr:this.signal.url,uid:r.uid,cid:r.cid,firstSuccess:this._isProactiveJoin,isProxy:!!b,signalChannel:"0",preload:r.preload}),f.delete(r.uid),this.signal.close(),P}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),Wt.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(P=>{Wt.warning("[".concat(this.store.clientId,"] get traffic stats error"),P.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(uS.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(uS.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(uS.NETWORK_QUALITY,{uplinkNetworkQuality:RJ(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:RJ(this._statsCollector.trafficStats.B_dnq)}):this.emit(uS.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),g}async leave(){let r=arguments.length>0&&arguments[0]!==void 0&&arguments[0],i=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){i!==_E.FALLBACK&&(this.state="DISCONNECTING");try{r||this.signal.connectionState!==kE.CONNECTED||await function(d,h){return h===1/0?d:T_.race([d,Fdt(h)])}(this.signal.request(j_.LEAVE,void 0,!0),3e3)}catch(d){Wt.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),d)}this.signal.close(i),i!==_E.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(r,i,d){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const h={state:"offer",p2p_id:this.store.p2pId,ortc:i,mode:this.spec.mode,extend:_s("PUB_EXTEND"),twcc:!!_s("PUBLISH_TWCC"),rtx:!!_s("USE_PUB_RTX")};try{return(await this.signal.request(j_.PUBLISH,h,!0))._message}catch(f){if(d&&f.data&&f.data.code===x_.ERR_PUBLISH_REQUEST_INVALID)return Wt.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),f.toString()),await this.tryUnpubBeforeRepub(r,i),this.publish(r,i,!1);throw f}}async publishDataChannel(r,i,d){var h;if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const f={stream_id:i.streamId,ordered:i.ordered?1:0,max_retrans_times:(h=i.maxRetransmits)!==null&&h!==void 0?h:10,channel_id:i.channelId,metadata:i.metadata};try{await this.signal.request(j_.PUBLISH_DATASTREAM,f,!0)}catch(g){if(d&&g.data&&g.data.code===x_.ERR_PUBLISH_REQUEST_INVALID)return Wt.warning("[".concat(this.store.clientId,"] receive publish datachannels error code, retry"),g.toString()),await this.tryUnpubDataChannelBeforeRepub(r,i),this.publishDataChannel(r,i,!1);throw g}}async unpublish(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(j_.UNPUBLISH,{stream_id:i,ortc:r},!0)}catch(d){Wt.warning("[".concat(this.store.clientId,"] unpublish warning: "),d)}}async unpublishDataChannel(r){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await T_.all(r.map(i=>this.signal.request(j_.UNPUBLISH_DATASTREAM,{channel_id:i},!0)))}catch(i){Wt.warning("unpublish datachannels warning: ",i)}}async presubscribe(r,i,d){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not presubscribe when connection state is ".concat(this.state));const h={stream_id:r,stream_type:i,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!_s("SUBSCRIBE_TWCC"),rtx:!!_s("USE_SUB_RTX")||void 0,extend:_s("SUB_EXTEND"),svc:Array.isArray(_s("SVC"))&&_s("SVC").length!==0?_s("SVC"):void 0};try{return await this.signal.request(j_.PRE_SUBSCRIBE,h,!0)}catch(f){if(d&&f.data&&f.data.code===x_.ERR_SUBSCRIBE_REQUEST_INVALID)return Wt.warning("[".concat(this.store.clientId,"] pre-subscribe error, retry"),f.toString()),this.presubscribe(r,i,!1);throw f}}async subscribe(r,i,d){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const h={stream_id:r,stream_type:i.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!_s("SUBSCRIBE_TWCC"),rtx:!!_s("USE_SUB_RTX"),extend:_s("SUB_EXTEND"),ssrcId:i.ssrcId,svc:Array.isArray(_s("SVC"))&&_s("SVC").length!==0?_s("SVC"):void 0};try{return(await this.signal.request(j_.SUBSCRIBE,h,!0))._message}catch(f){if(d&&f.data&&f.data.code===x_.ERR_SUBSCRIBE_REQUEST_INVALID)return Wt.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),f.toString()),await this.tryUnsubBeforeResub(r,i),await this.subscribe(r,i,!1);throw f}}async subscribeDataChannel(r,i,d){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not subscribe datachannel when connection state is ".concat(this.state));const h={uid:r,stream_id:i.id,channel_id:i.datachannelId};try{return void await this.signal.request(j_.SUBSCRIBE_DATASTREAM,h,!0)}catch(f){if(d&&f.data&&f.data.code===x_.ERR_SUBSCRIBE_REQUEST_INVALID)return Wt.warning("[".concat(this.store.clientId,"] receiver subscribe datachannel error code, retry"),f.toString()),await this.tryUnsubDataChannelBeforeResub(r,i),await this.subscribeDataChannel(r,i,!1);throw f}}async subscribeAll(r,i){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const d={p2p_id:this.store.p2pId,users:r,dtx:!1,rtx:!!_s("USE_SUB_RTX"),twcc:!!_s("SUBSCRIBE_TWCC"),svc:Array.isArray(_s("SVC"))&&_s("SVC").length!==0?_s("SVC"):void 0};try{return await this.signal.request(j_.SUBSCRIBE_STREAMS,d,!0)}catch(h){if(i&&h.data&&h.data.code===x_.ERR_SUBSCRIBE_REQUEST_INVALID)return Wt.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),h.toString()),await this.tryMassUnsubBeforeResub(r),await this.subscribeAll(r,!1);throw h}}async setVideoProfile(r){const i=function(d){if(!(d.bitrateMax&&d.bitrateMin&&d.frameRate&&d.height&&d.width))return;let h=d.frameRate,f=d.width,g=d.height,b=!0;return typeof h!="number"&&(h=h.exact||h.ideal||h.max||h.min||0,h||(b=!1)),typeof f!="number"&&(f=f.exact||f.ideal||f.max||f.min||0,f||(b=!1)),typeof g!="number"&&(g=g.exact||g.ideal||g.max||g.min||0,h||(b=!1)),b?{stream_type:0,width:f,height:g,fps:h,start_bps:1e3*d.bitrateMax,min_bps:1e3*d.bitrateMin,target_bps:1e3*d.bitrateMax}:void 0}(r);if(i)return this.signal.request(j_.SET_VIDEO_PROFILE,i);Wt.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(r,i){try{await this.signal.request(j_.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:r,stream_id:i},!0)}catch(d){Wt.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),d)}}async unsubscribeDataChannel(r,i){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await T_.all(r.map(d=>this.signal.request(j_.UNSUBSCRIBE_DATASTREAM,{stream_id:d,uid:i},!0)))}catch(d){Wt.warning("unsubscribeDataChannel warning: ",d)}}async massUnsubscribe(r){try{await this.signal.request(j_.UNSUBSCRIBE_STREAMS,r,!0)}catch(i){Wt.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),i)}}async reconnectPC(r){const{iceParameters:i,dtlsParameters:d,rtpCapabilities:h}=r;return{gatewayEstablishParams:await this.signal.request(j_.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:i,dtlsParameters:d,rtpCapabilities:h}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(j_.GATEWAY_INFO)}async renewToken(r){await this.signal.request(j_.RENEW_TOKEN,r),this.key=r.token}updateClientRole(r,i){i&&(this._clientRoleOptions=Object.assign({},i)),_s("CLIENT_ROLE_OPTIONS")&&(Wt.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(_s("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," ")),this._clientRoleOptions=Object.assign({},_s("CLIENT_ROLE_OPTIONS"))),this.role=r}async setClientRole(r,i){if(i&&(this._clientRoleOptions=Object.assign({},i)),_s("CLIENT_ROLE_OPTIONS")&&(this._clientRoleOptions=Object.assign({},_s("CLIENT_ROLE_OPTIONS")),Wt.debug("[".concat(this.store.clientId,"] Set roleOptions for ").concat(JSON.stringify(_s("CLIENT_ROLE_OPTIONS"))," instead of ").concat(JSON.stringify(this._clientRoleOptions)," "))),this.state!=="CONNECTED")return void(this.role=r);let d,h=0;r==="audience"?this._clientRoleOptions&&this._clientRoleOptions.delay?(d=this._clientRoleOptions.delay,h=1):h=this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:h=0;const f=Object.assign({},i);delete f.delay,delete f.level,await this.signal.request(j_.SET_CLIENT_ROLE,MS(MS({role:r,level:h,delay:d},f),{},{client_ts:Date.now()})),this.role=r}async setRemoteVideoStreamType(r,i){await this.signal.request(j_.SWITCH_VIDEO_STREAM,{stream_id:r,stream_type:i})}async setDefaultRemoteVideoStreamType(r){await this.signal.request(j_.DEFAULT_VIDEO_STREAM,{stream_type:r})}async setStreamFallbackOption(r,i){await this.signal.request(j_.SET_FALLBACK_OPTION,{stream_id:r,fallback_type:i})}async pickSVCLayer(r,i){await this.signal.request(j_.PICK_SVC_LAYER,{stream_id:r,spatial_layer:i.spatialLayer,temporal_layer:i.temporalLayer})}async setRTM2Flag(r){await this.signal.request(j_.SET_RTM2_FLAG,{rtm2_flag:r})}async sendExtensionMessage(r,i,d){if(this.store.useP2P)return this.signal.sendExtensionMessage(r,i,d)}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),MS({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(j_.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const r=ZF.get(this.joinInfo.cname);r&&r.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const r=function(i){let d;return d=i.startsWith("dc")?i.match(/(dc\:\/\/)?([^:]+):(\d+)/):i.match(/(wss\:\/\/)?([^:]+):(\d+)/),d?{username:RS.username,password:RS.password,turnServerURL:d[2],tcpport:parseInt(d[3])+30,udpport:parseInt(d[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],r&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(MS(MS({},RS),{},{turnServerURL:r.turnServerURL,tcpport:r.tcpport,udpport:r.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const r=await this.signal.request(j_.TRAFFIC_STATS,void 0,!0);r.timestamp=Date.now(),r.ntp_offset!=null&&(this.ntpOffset=r.ntp_offset),r.peer_delay.forEach(i=>{const d=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(h=>h.peer_uid===i.peer_uid);d&&d.B_st!==i.B_st&&IL(()=>{this.emit(uS.STREAM_TYPE_CHANGE,i.peer_uid,i.B_st)})}),this._statsCollector.updateTrafficStats(r)}getJoinMessage(r){var i,d;if(!this.joinInfo||!this.key)throw new t_(Gi.UNEXPECTED_ERROR,"can not generate join message, no join info");const h=Object.assign({},this.joinInfo.apResponse);let f=_s("REPORT_APP_SCENARIO");if(typeof f!="string")try{f=JSON.stringify(f)}catch{f=void 0}var g;f&&f.length>128&&(f=void 0),this.store.hasStartJoinChannel=!0,this.store.isABTestSuccess||this.emit(uS.UPDATE_GATEWAY_CONFIG),g=this.store.clientId,E_(DO).call(DO,g)||DO.push(g);const b=pF(this.store),C=!((i=this.isPreallocation)===null||i===void 0||!i.call(this)),P=z4(this.store),x=fht(),H=pO(87)||n4()||qV(117),$=(function(){const _i=oE();if(_i.name!==hE.SAFARI||!_i.browserVersion)return!1;const ue=_i.browserVersion.split(".");return Number(ue[0])>18||Number(ue[0])===18&&Number(ue[1])>=4}()||s4(18,4,!1))&&WV(18,6,!0)&&this.spec.codec==="h264"&&_s("ENABLE_ABSSENDTIME_AS_SENTTS"),_t=MS({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:AT,browser:navigator.userAgent,process_id:_s("PROCESS_ID"),mode:this.store.useP2P?"p2p":this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:h,extend:_s("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:f,attributes:{userAttributes:MS(MS({enableEncodedTransform:(!!_s("ENABLE_AUDIO_METADATA")||!!_s("ENABLE_AUDIO_PTS"))&&H||!!_s("ENABLE_AUDIO_TOPN")&&BV(hE.CHROME,87,116)||void 0,enableAudioMetadata:!!_s("ENABLE_AUDIO_METADATA")&&H,enableAudioPts:!!_s("ENABLE_AUDIO_PTS")&&H,topnSmoothLevel:_s("TOPN_SMOOTH_LEVEL"),topnNewSpeakerDelay:_s("TOPN_NEW_SPEAKER_DELAY"),topnSwitchHoldMs:_s("TOPN_SWITCH_HOLD_MS"),topnAudioGain:_s("TOPN_AUDIO_GAIN"),enablePublishedUserList:_s("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:_s("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:RT("SUBSCRIBE_AUDIO_FILTER_TOPN","number"),enablePublishAudioFilter:RT("ENABLE_PUBLISH_AUDIO_FILTER","boolean"),enableUserLicenseCheck:RT("ENABLE_USER_LICENSE_CHECK","boolean"),enableRTX:_s("USE_PUB_RTX")===!0||_s("USE_SUB_RTX")===!0||void 0,disableFEC:_s("DISABLE_FEC"),enableNTPReport:!!_s("ENABLE_NTP_REPORT")||void 0,enableInstantVideo:P,enableFulllinkAvSync:!!_s("ENABLE_FULL_LINK_AV_SYNC")||void 0,enableDataStream2:RT("ENABLE_DATASTREAM_2","boolean"),enableAutFeedback:!!_s("FORCE_ENABLE_AUT_CC")||!DL()&&(!!_s("ENABLE_AUT_FEEDBACK")||void 0),rtm2Flag:typeof this.joinInfo.rtmFlag=="number"?this.joinInfo.rtmFlag:void 0,enableUserAutoRebalanceCheck:!!_s("ENABLE_USER_AUTO_REBALANCE_CHECK"),enableXR:RT("USE_XR","boolean"),enableLossbasedBwe:RT("ENABLE_LOSSBASED_BWE","boolean"),enableAutCC:!!_s("FORCE_ENABLE_AUT_CC")||!DL()&&(!!_s("ENABLE_AUT_CC")||void 0),enableCCFallback:RT("ENABLE_CC_FALLBACK","boolean"),enablePreallocPC:C,preSubNum:b?RT("PRE_SUB_NUM","number"):void 0,enablePubTWCC:RT("PUBLISH_TWCC","boolean"),enableSubTWCC:RT("SUBSCRIBE_TWCC","boolean"),enablePubRTX:RT("USE_PUB_RTX","boolean"),enableSubRTX:RT("USE_SUB_RTX","boolean"),enableSubSVC:_s("ENABLE_SVC")?_s("ENABLE_SVC_DEFAULT_CODECS"):Array.isArray(_s("SVC"))&&_s("SVC").length!==0?_s("SVC"):void 0,enableSvcExtended:_s("ENABLE_SVC")&&Array.isArray(_s("SVC_EXTENDED"))&&_s("SVC_EXTENDED").length!==0?_s("SVC_EXTENDED"):void 0},x),{},{audioDuplicate:RT("ENABLE_AUDIO_RED","boolean")?(d=RT("AUDIO_DUPLICATE_NUM","number"))!==null&&d!==void 0?d:2:void 0,senttsUsesAbsSendTime:!!$||void 0})},join_ts:this.joinGatewayStartTime},r);return this.joinInfo.stringUid&&(_t.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(_t.aes_mode=this.joinInfo.aesmode,_s("ENCRYPT_AES")?(_t.aes_secret=this.joinInfo.aespassword,_t.aes_encrypt=!0):_t.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(_t.aes_salt=this.joinInfo.aessalt)),h.addresses[this.signal.websocket.currentURLIndex]&&(_t.ap_response.ticket=h.addresses[this.signal.websocket.currentURLIndex].ticket,delete h.addresses),this.joinInfo.defaultVideoStream!==void 0&&(_t.default_video_stream=this.joinInfo.defaultVideoStream),_t}getRejoinMessage(){if(!this.joinInfo)throw new t_(Gi.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(B_.WS_RECONNECT_CREATE_CONNECTION,r=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(B_.WS_RECONNECTING,r=>{this.joinInfo&&k_.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:r||SS.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",k_.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode,stringUid:this.joinInfo.stringUid,channelProfile:this.spec.mode==="live"?1:0,channelMode:0,lsid:this.joinInfo.sid,clientRole:this.role==="audience"?2:1,buildFormat:1}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(B_.WS_CLOSED,r=>{let i;switch(r){case _E.LEAVE:i=SS.LEAVE;break;case _E.UID_BANNED:case _E.IP_BANNED:case _E.CHANNEL_BANNED:case _E.SERVER_ERROR:i=SS.SERVER_ERROR;break;case _E.FALLBACK:i=SS.FALLBACK;break;case _E.LICENSE_MISSING:case _E.LICENSE_EXPIRED:case _E.LICENSE_MINUTES_EXCEEDED:case _E.LICENSE_PERIOD_INVALID:case _E.LICENSE_MULTIPLE_SDK_SERVICE:case _E.LICENSE_ILLEGAL:case _E.TOKEN_EXPIRE:i=r;break;default:i=SS.NETWORK_ERROR}Wt.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(i||"undefined -> "+SS.NETWORK_ERROR)),this.joinInfo&&k_.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:r===_E.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:i}),this._disconnectedReason=r,r!==_E.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(B_.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo){if(this.role==="audience"){const r=_s("CLIENT_ROLE_OPTIONS")||this._clientRoleOptions;r&&(r.level||r.delay)&&(Wt.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(r.level,", delay: ").concat(r.delay)),this.setClientRole(this.role,r))}if(k_.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload,isABTestSuccess:this.store.isABTestSuccess}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1){const r=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!r)return void Wt.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(r));SE("EVENT_REPORT_DOMAIN",r[1]),SE("EVENT_REPORT_BACKUP_DOMAIN",r[1]),SE("LOG_UPLOAD_SERVER","".concat(r[1],":6444"))}}}),this.signal.on(rE.ON_UPLINK_STATS,r=>{this._statsCollector.updateUplinkStats(r)}),this.signal.on(B_.REQUEST_RECOVER,(r,i,d)=>{if(!this.joinInfo)return d(new t_(Gi.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));r&&(this.joinInfo.multiIP=r,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,TS(this,uS.REQUEST_NEW_GATEWAY_LIST).then(i).catch(d)}),this.signal.on(B_.REQUEST_JOIN_INFO,async(r,i,d)=>{var h,f,g;if(this.updateTurnConfigFromSignal(),this.store.useP2P)return void r(this.getJoinMessage({ortc:{}}));const b=BE((h=this.joinInfo)===null||h===void 0?void 0:h.turnServer);if(_s("NEW_TURN_MODE")&&b&&((f=this.joinInfo)===null||f===void 0?void 0:f.cloudProxyServer)==="disabled"){var C;let $=b.servers.map(ue=>"turnServerURL"in ue&&_s("USE_TURN_IP")?MS(MS({},ue),{},{turnServerURL:t1(ue.turnServerURL)}):ue),_t=(C=b.serversFromGateway)===null||C===void 0?void 0:C.map(ue=>_s("USE_TURN_IP")?MS(MS({},ue),{},{turnServerURL:t1(ue.turnServerURL)}):ue);const _i=this.signal.currentURLIndex;$.length>0&&($=[$[_i%$.length]],b.servers=$),Array.isArray(_t)&&_t.length>0&&(_t=[_t[0]],b.serversFromGateway=_t),Wt.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(_i))}const{iceParameters:P,dtlsParameters:x,rtpCapabilities:H}=await TS(this,uS.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:b,cloudProxyServer:(g=this.joinInfo)===null||g===void 0?void 0:g.cloudProxyServer});try{r(this.getJoinMessage({ortc:{iceParameters:P,dtlsParameters:x,rtpCapabilities:H,version:"2"}}))}catch($){i($)}}),this.signal.on(B_.REQUEST_REJOIN_INFO,r=>{r(this.getRejoinMessage())}),this.signal.on(B_.REPORT_JOIN_GATEWAY,(r,i)=>{if(!this.joinInfo)return;let d,h="";var f;r instanceof t_?(d=((f=r.data)===null||f===void 0?void 0:f.desc)||r.code,h=r.message):d=r,k_.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:d,errorMsg:h,addr:i,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,isProxy:!!this.joinInfo.proxyServer,signalChannel:"0",preload:this.joinInfo.preload})}),this.signal.on(B_.IS_P2P_DISCONNECTED,r=>{r(FN(this,uS.IS_P2P_DISCONNECTED))}),this.signal.on(B_.DISCONNECT_P2P,()=>{this.emit(uS.DISCONNECT_P2P)}),this.signal.on(B_.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(B_.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(B_.JOIN_RESPONSE,r=>{const i=this.getCurrentGatewayAddress();this.emit(uS.JOIN_RESPONSE,r,i)}),this.signal.on(B_.PRE_CONNECT_PC,async()=>{if(this.joinInfo){var r,i;this.updateTurnConfigFromSignal();const h=this.getCurrentGatewayAddress(),f=BE((r=this.joinInfo)===null||r===void 0?void 0:r.turnServer);if(_s("NEW_TURN_MODE")&&f&&((i=this.joinInfo)===null||i===void 0?void 0:i.cloudProxyServer)==="disabled"){var d;let b=f.servers.map(x=>"turnServerURL"in x&&_s("USE_TURN_IP")?MS(MS({},x),{},{turnServerURL:t1(x.turnServerURL)}):x),C=(d=f.serversFromGateway)===null||d===void 0?void 0:d.map(x=>_s("USE_TURN_IP")?MS(MS({},x),{},{turnServerURL:t1(x.turnServerURL)}):x);const P=this.signal.currentURLIndex;b.length>0&&(b=[b[P%b.length]],f.servers=b),Array.isArray(C)&&C.length>0&&(C=[C[0]],f.serversFromGateway=C),Wt.debug("[".concat(this.store.clientId,"] use single turn, use turn server index: ").concat(P,",in pre pc"))}const g=_s("FINGERPRINT")||this.joinInfo.apResponse.addresses[this.signal.currentURLIndex].fingerprint;if(h&&g){const b=DJ(h);this.emit(uS.PRE_CONNECT_PC,{candidates:b,fingerprint:g,turnServer:f})}}}),this.signal.on(B_.RECOVER_NOTIFICATION,r=>{this.joinInfo&&typeof _s("AP_REQUEST_DETAIL")=="string"&&(this.joinInfo.apRequestDetail="".concat(_s("AP_REQUEST_DETAIL"),";").concat(r))})}async tryUnsubBeforeResub(r,i){try{await this.signal.request(j_.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:r,ortc:[i]},!0)}catch(d){throw Wt.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),d),d}}async tryUnsubDataChannelBeforeResub(r,i){try{await this.signal.request(j_.UNSUBSCRIBE,{stream_id:i.id},!0)}catch(d){throw Wt.warning("unsubscribe datachannel warning",d),d}}async tryUnpubBeforeRepub(r,i){try{await this.signal.request(j_.UNPUBLISH,{stream_id:r,ortc:i},!0)}catch(d){throw Wt.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),d),d}}async tryUnpubDataChannelBeforeRepub(r,i){try{await this.signal.request(j_.UNPUBLISH_DATASTREAM,{channnel_id:i.channelId},!0)}catch(d){throw Wt.warning("unpublish datastream warning: ",d),d}}async tryMassUnsubBeforeResub(r){const i={users:r.map(d=>({stream_id:d.stream_id,stream_type:d.stream_type}))};try{await this.signal.request(j_.UNSUBSCRIBE_STREAMS,i,!0)}catch(d){throw Wt.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),d),d}}async muteLocal(r,i){const d={action:r.find(h=>h.stream_type===gE.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(j_.CONTROL,d,!0,!0)}catch(h){throw Wt.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),h),h}}async unmuteLocal(r,i){const d={action:r.find(h=>h.stream_type===gE.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:r,stream_id:i};try{await this.signal.request(j_.CONTROL,d,!0,!0)}catch(h){throw Wt.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),h),h}}async muteRemote(r,i){const d={action:r===A_.AUDIO?"mute_remote_audio":"mute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(j_.CONTROL,d,!0,!0)}catch(h){throw Wt.warning("[".concat(this.store.clientId,"] gateway muteRemote warning: "),h),h}}async unmuteRemote(r,i){const d={action:r===A_.AUDIO?"unmute_remote_audio":"unmute_remote_video",p2p_id:this.store.p2pId,stream_id:i};try{await this.signal.request(j_.CONTROL,d,!0,!0)}catch(h){throw Wt.warning("[".concat(this.store.clientId,"] gateway unmuteRemote warning: "),h),h}}uploadWRTCStats(r){this.signal.uploadWRTCStats(r)}upload(r,i){this.signal.upload(r,i)}getSignalRTT(){return this.signal.rtt}async restartICE(r){const i={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:r};try{return await this.signal.request(j_.RESTART_ICE,i,!0)}catch(d){throw Wt.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),d),d}}reconnect(r,i){this.state==="CONNECTED"&&this.signal.reconnect(r||void 0,i||SS.P2P_FAILED)}getCurrentGatewayAddress(){var r,i;if(!_s("GATEWAY_WSS_ADDRESS"))return _s("USE_CANDIDATE_FROM_AP_DETAIL")&&(r=this.joinInfo)!==null&&r!==void 0&&r.apGatewayAddress?(Wt.debug("[".concat(this.store.clientId,"] use candidate from ap detail, ").concat(JSON.stringify(this.joinInfo.apGatewayAddress))),this.joinInfo.apGatewayAddress):(i=this.joinInfo)!==null&&i!==void 0&&i.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(r){await this.signal.request(j_.SET_PARAMETER,{enablePublishAudioFilter:r})}downgradeCodec(r){this.signal.downgradeCodec(r)}}let a1=0,$F=0;function SR(e,r,i,d){return new T_((h,f)=>{r.timeout=r.timeout||_s("HTTP_CONNECT_TIMEOUT"),r.responseType=r.responseType||"json",r.data&&!i?(r.data=JSON.stringify(r.data),a1+=MR(r.data)):i&&(r.data.size?a1+=r.data.size:r.data instanceof FormData?a1+=S4(r.data):a1+=MR(JSON.stringify(r.data))),r.headers=r.headers||{},r.headers["Content-Type"]=r.headers["Content-Type"]||"application/json",r.method="POST",r.url=e,zS.request(r).then(g=>{typeof g.data=="string"?$F+=MR(g.data):g.data instanceof ArrayBuffer||g.data instanceof Uint8Array?$F+=g.data.byteLength:$F+=MR(JSON.stringify(g.data)),d&&h({data:g.data,headers:g.headers}),h(g.data)}).catch(g=>{zS.isCancel(g)?f(new t_(Gi.OPERATION_ABORTED,"cancel token canceled")):g.code==="ECONNABORTED"?f(new t_(Gi.NETWORK_TIMEOUT,g.message)):g.response?f(new t_(Gi.NETWORK_RESPONSE_ERROR,g.response.status)):f(new t_(Gi.NETWORK_ERROR,g.message))})})}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function r(s_){var __=0;return function(){return __<s_.length?{done:!1,value:s_[__++]}:{done:!0}}}var i=typeof Object.defineProperties=="function"?Object.defineProperty:function(s_,__,N_){return s_==Array.prototype||s_==Object.prototype||(s_[__]=N_.value),s_},d,h=function(s_){s_=[typeof globalThis=="object"&&globalThis,s_,typeof window=="object"&&window,typeof self=="object"&&self,typeof p=="object"&&p];for(var __=0;__<s_.length;++__){var N_=s_[__];if(N_&&N_.Math==Math)return N_}throw Error("Cannot find global object")}(this);function f(s_,__){if(__)t:{var N_=h;s_=s_.split(".");for(var c_=0;c_<s_.length-1;c_++){var zt=s_[c_];if(!(zt in N_))break t;N_=N_[zt]}(__=__(c_=N_[s_=s_[s_.length-1]]))!=c_&&__!=null&&i(N_,s_,{configurable:!0,writable:!0,value:__})}}function g(s_){return(s_={next:s_})[Symbol.iterator]=function(){return this},s_}function b(s_){var __=typeof Symbol<"u"&&Symbol.iterator&&s_[Symbol.iterator];return __?__.call(s_):{next:r(s_)}}if(f("Symbol",function(s_){function __(zt,_a){this.A=zt,i(this,"description",{configurable:!0,writable:!0,value:_a})}if(s_)return s_;__.prototype.toString=function(){return this.A};var N_="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",c_=0;return function zt(_a){if(this instanceof zt)throw new TypeError("Symbol is not a constructor");return new __(N_+(_a||"")+"_"+c_++,_a)}}),f("Symbol.iterator",function(s_){if(s_)return s_;s_=Symbol("Symbol.iterator");for(var __="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),N_=0;N_<__.length;N_++){var c_=h[__[N_]];typeof c_=="function"&&typeof c_.prototype[s_]!="function"&&i(c_.prototype,s_,{configurable:!0,writable:!0,value:function(){return g(r(this))}})}return s_}),typeof Object.setPrototypeOf=="function")d=Object.setPrototypeOf;else{var C;t:{var P={};try{P.__proto__={a:!0},C=P.a;break t}catch{}C=!1}d=C?function(s_,__){if(s_.__proto__=__,s_.__proto__!==__)throw new TypeError(s_+" is not extensible");return s_}:null}var x=d;function H(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function $(s_){if(s_.m)throw new TypeError("Generator is already running");s_.m=!0}function _t(s_,__){return s_.h=3,{value:__}}function _i(s_){this.g=new H,this.G=s_}function ue(s_,__,N_,c_){try{var zt=__.call(s_.g.j,N_);if(!(zt instanceof Object))throw new TypeError("Iterator result "+zt+" is not an object");if(!zt.done)return s_.g.m=!1,zt;var _a=zt.value}catch(kc){return s_.g.j=null,s_.g.s(kc),_r(s_)}return s_.g.j=null,c_.call(s_.g,_a),_r(s_)}function _r(s_){for(;s_.g.h;)try{var __=s_.G(s_.g);if(__)return s_.g.m=!1,{value:__.value,done:!1}}catch(N_){s_.g.v=void 0,s_.g.s(N_)}if(s_.g.m=!1,s_.g.l){if(__=s_.g.l,s_.g.l=null,__.F)throw __.D;return{value:__.return,done:!0}}return{value:void 0,done:!0}}function Fi(s_){this.next=function(__){return s_.o(__)},this.throw=function(__){return s_.s(__)},this.return=function(__){return function(N_,c_){$(N_.g);var zt=N_.g.j;return zt?ue(N_,"return"in zt?zt.return:function(_a){return{value:_a,done:!0}},c_,N_.g.return):(N_.g.return(c_),_r(N_))}(s_,__)},this[Symbol.iterator]=function(){return this}}function Di(s_,__){return __=new Fi(new _i(__)),x&&s_.prototype&&x(__,s_.prototype),__}if(H.prototype.o=function(s_){this.v=s_},H.prototype.s=function(s_){this.l={D:s_,F:!0},this.h=this.C||this.u},H.prototype.return=function(s_){this.l={return:s_},this.h=this.u},_i.prototype.o=function(s_){return $(this.g),this.g.j?ue(this,this.g.j.next,s_,this.g.o):(this.g.o(s_),_r(this))},_i.prototype.s=function(s_){return $(this.g),this.g.j?ue(this,this.g.j.throw,s_,this.g.o):(this.g.s(s_),_r(this))},f("Array.prototype.entries",function(s_){return s_||function(){return function(__,N_){__ instanceof String&&(__+="");var c_=0,zt=!1,_a={next:function(){if(!zt&&c_<__.length){var kc=c_++;return{value:N_(kc,__[kc]),done:!1}}return zt=!0,{done:!0,value:void 0}}};return _a[Symbol.iterator]=function(){return _a},_a}(this,function(__,N_){return[__,N_]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var Js=function(s_,__){for(var N_=0;N_<s_.length;N_++)__(s_[N_])},_l=function(s_){return s_.replace(/\r?\n|\r/g,`\r
`)},_u=function(s_,__,N_){return __ instanceof Blob?(N_=N_!==void 0?N_+"":typeof __.name=="string"?__.name:"blob",__.name===N_&&Object.prototype.toString.call(__)!=="[object Blob]"||(__=new File([__],N_)),[String(s_),__]):[String(s_),String(__)]},ga=function(s_,__){if(s_.length<__)throw new TypeError(__+" argument required, but only "+s_.length+" present.")},_m=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,r_=_m.FormData,a_=_m.XMLHttpRequest&&_m.XMLHttpRequest.prototype.send,p_=_m.Request&&_m.fetch,Q_=_m.navigator&&_m.navigator.sendBeacon,$_=_m.Element&&_m.Element.prototype,F_=_m.Symbol&&Symbol.toStringTag;F_&&(Blob.prototype[F_]||(Blob.prototype[F_]="Blob"),"File"in _m&&!File.prototype[F_]&&(File.prototype[F_]="File"));try{new File([],"")}catch{_m.File=function(__,N_,c_){return __=new Blob(__,c_||{}),Object.defineProperties(__,{name:{value:N_},lastModified:{value:+(c_&&c_.lastModified!==void 0?new Date(c_.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),F_&&Object.defineProperty(__,F_,{value:"File"}),__}}var mE=function(s_){return s_.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},pE=function(s_){this.i=[];var __=this;s_&&Js(s_.elements,function(N_){if(N_.name&&!N_.disabled&&N_.type!=="submit"&&N_.type!=="button"&&!N_.matches("form fieldset[disabled] *"))if(N_.type==="file"){var c_=N_.files&&N_.files.length?N_.files:[new File([],"",{type:"application/octet-stream"})];Js(c_,function(zt){__.append(N_.name,zt)})}else N_.type==="select-multiple"||N_.type==="select-one"?Js(N_.options,function(zt){!zt.disabled&&zt.selected&&__.append(N_.name,zt.value)}):N_.type==="checkbox"||N_.type==="radio"?N_.checked&&__.append(N_.name,N_.value):(c_=N_.type==="textarea"?_l(N_.value):N_.value,__.append(N_.name,c_))})};if((e=pE.prototype).append=function(s_,__,N_){ga(arguments,2),this.i.push(_u(s_,__,N_))},e.delete=function(s_){ga(arguments,1);var __=[];s_=String(s_),Js(this.i,function(N_){N_[0]!==s_&&__.push(N_)}),this.i=__},e.entries=function s_(){var __,N_=this;return Di(s_,function(c_){if(c_.h==1&&(__=0),c_.h!=3)return __<N_.i.length?c_=_t(c_,N_.i[__]):(c_.h=0,c_=void 0),c_;__++,c_.h=2})},e.forEach=function(s_,__){ga(arguments,1);for(var N_=b(this),c_=N_.next();!c_.done;c_=N_.next()){var zt=b(c_.value);c_=zt.next().value,zt=zt.next().value,s_.call(__,zt,c_,this)}},e.get=function(s_){ga(arguments,1);var __=this.i;s_=String(s_);for(var N_=0;N_<__.length;N_++)if(__[N_][0]===s_)return __[N_][1];return null},e.getAll=function(s_){ga(arguments,1);var __=[];return s_=String(s_),Js(this.i,function(N_){N_[0]===s_&&__.push(N_[1])}),__},e.has=function(s_){ga(arguments,1),s_=String(s_);for(var __=0;__<this.i.length;__++)if(this.i[__][0]===s_)return!0;return!1},e.keys=function s_(){var __,N_,c_,zt,_a=this;return Di(s_,function(kc){if(kc.h==1&&(__=b(_a),N_=__.next()),kc.h!=3)return N_.done?void(kc.h=0):(c_=N_.value,zt=b(c_),_t(kc,zt.next().value));N_=__.next(),kc.h=2})},e.set=function(s_,__,N_){ga(arguments,2),s_=String(s_);var c_=[],zt=_u(s_,__,N_),_a=!0;Js(this.i,function(kc){kc[0]===s_?_a&&(_a=!c_.push(zt)):c_.push(kc)}),_a&&c_.push(zt),this.i=c_},e.values=function s_(){var __,N_,c_,zt,_a=this;return Di(s_,function(kc){if(kc.h==1&&(__=b(_a),N_=__.next()),kc.h!=3)return N_.done?void(kc.h=0):(c_=N_.value,(zt=b(c_)).next(),_t(kc,zt.next().value));N_=__.next(),kc.h=2})},pE.prototype._asNative=function(){for(var s_=new r_,__=b(this),N_=__.next();!N_.done;N_=__.next()){var c_=b(N_.value);N_=c_.next().value,c_=c_.next().value,s_.append(N_,c_)}return s_},pE.prototype._blob=function(){var s_="----formdata-polyfill-"+Math.random(),__=[],N_="--"+s_+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(c_,zt){return typeof c_=="string"?__.push(N_+mE(_l(zt))+`"\r
\r
`+_l(c_)+`\r
`):__.push(N_+mE(_l(zt))+'"; filename="'+mE(c_.name)+`"\r
Content-Type: `+(c_.type||"application/octet-stream")+`\r
\r
`,c_,`\r
`)}),__.push("--"+s_+"--"),new Blob(__,{type:"multipart/form-data; boundary="+s_})},pE.prototype[Symbol.iterator]=function(){return this.entries()},pE.prototype.toString=function(){return"[object FormData]"},$_&&!$_.matches&&($_.matches=$_.matchesSelector||$_.mozMatchesSelector||$_.msMatchesSelector||$_.oMatchesSelector||$_.webkitMatchesSelector||function(s_){for(var __=(s_=(this.document||this.ownerDocument).querySelectorAll(s_)).length;0<=--__&&s_.item(__)!==this;);return-1<__}),F_&&(pE.prototype[F_]="FormData"),a_){var PS=_m.XMLHttpRequest.prototype.setRequestHeader;_m.XMLHttpRequest.prototype.setRequestHeader=function(s_,__){PS.call(this,s_,__),s_.toLowerCase()==="content-type"&&(this.B=!0)},_m.XMLHttpRequest.prototype.send=function(s_){s_ instanceof pE?(s_=s_._blob(),this.B||this.setRequestHeader("Content-Type",s_.type),a_.call(this,s_)):a_.call(this,s_)}}p_&&(_m.fetch=function(s_,__){return __&&__.body&&__.body instanceof pE&&(__.body=__.body._blob()),p_.call(this,s_,__)}),Q_&&(_m.navigator.sendBeacon=function(s_,__){return __ instanceof pE&&(__=__._asNative()),Q_.call(this,s_,__)}),_m.FormData=pE}})();const rP=()=>{const e=_s("AREAS");return e.length===0&&e.push(fE.GLOBAL),GT(e).call(e,(r,i,d)=>{const h=KJ(i);return h?d===0?h:"".concat(r,",").concat(h):r},"")},KJ=e=>e===fE.OVERSEA?"".concat(AS.ASIA,",").concat(AS.EUROPE,",").concat(AS.AFRICA,",").concat(AS.NORTH_AMERICA,",").concat(AS.SOUTH_AMERICA,",").concat(AS.OCEANIA):AS[e],_ht=e=>{const r={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(i=>{const d=ZL[i],h=Object.keys(d);h&&h.map(f=>{f!=="CODE"&&(r[f]=r[f].concat(d[f]))})}),r},c1={GLOBAL:{ASIA:[fE.CHINA,fE.JAPAN,fE.INDIA,fE.KOREA,fE.HKMC],EUROPE:[],NORTH_AMERICA:[fE.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},u1=Object.keys(c1[fE.GLOBAL]),_B=[fE.CHINA,fE.NORTH_AMERICA,fE.EUROPE,fE.ASIA,fE.JAPAN,fE.INDIA,fE.OCEANIA,fE.SOUTH_AMERICA,fE.AFRICA,fE.KOREA,fE.HKMC,fE.US],Eht=function(e,r){let i=[];if(E_(e).call(e,fE.GLOBAL)){const f=[fE.GLOBAL,fE.OVERSEA],g=Object.keys(ZL);if(r===fE.GLOBAL)throw new t_(Gi.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(r===fE.CHINA)i=[fE.OVERSEA];else if(h=r,E_(u1).call(u1,h)){const b=(d=r,c1[fE.GLOBAL][d]||[]),C=[...f,r,...b];i=g.filter(P=>!E_(C).call(C,P))}else if(function(b){let C=!1;return u1.forEach(P=>{var x;E_(x=c1[fE.GLOBAL][P]).call(x,b)&&(C=!0)}),C}(r)){const b=function(P){let x;return u1.forEach(H=>{var $;E_($=c1[fE.GLOBAL][H]).call($,P)&&(x=H)}),x}(r),C=[...f,b,r];i=g.filter(P=>!E_(C).call(C,P))}else i=e;i=function(b){const C=[];return _B.forEach(P=>{E_(b).call(b,P)&&C.push(P)}),C.concat(b.filter(P=>!E_(_B).call(_B,P)))}(i)}else i=e;var d,h;return i};function HJ(e){var r,i;if(!e&&E_(r=_s("AREAS")).call(r,fE.EXTENSIONS))return Wt.debug("update area from ap : reset"),void tG(Ilt,!0);if(!E_(i=_s("AREAS")).call(i,fE.GLOBAL)||!e)return;let d=ZL.EXTENSIONS;d&&(d={CODE:KJ(fE.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},Wt.debug("update area from ap success: ".concat(e,",config is "),d),SE("AREAS",[fE.EXTENSIONS],!0),Object.keys(d).map(h=>{h==="LOG_UPLOAD_SERVER"||h==="EVENT_REPORT_DOMAIN"||h==="EVENT_REPORT_BACKUP_DOMAIN"||h==="PROXY_SERVER_TYPE3"?SE(h,d[h][0]):SE(h,d[h])}))}function tG(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=k_.reportApiInvoke(null,{name:QE.SET_AREA,options:e,tag:FE.TRACER});try{let d=[];if(typeof e=="string"&&(d=[e]),Array.isArray(e)&&(e.forEach(f=>{if(!E_(pJ).call(pJ,f))throw new t_(Gi.INVALID_PARAMS,"invalid area code")}),d=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:f,excludedArea:g}=e;if(!f)throw new t_(Gi.INVALID_PARAMS,"area code is needed");let b=f;typeof f=="string"&&(b=[f]),d=g?Eht(b,g):b}if(!r){if(gR.AREAS){const f=new t_(Gi.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return i.onError(f),void Wt.warning("setArea is prohibited because of config-distribute")}if(E_(d).call(d,fE.GLOBAL)&&_s("AREAS")===fE.EXTENSIONS){const f=new t_(Gi.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return i.onError(f),void Wt.warning("setArea is prohibited because of ap extensions")}}SE("AREAS",d,r);const h=_ht(d);Object.keys(h).map(f=>{f==="LOG_UPLOAD_SERVER"||f==="EVENT_REPORT_DOMAIN"||f==="EVENT_REPORT_BACKUP_DOMAIN"||f==="PROXY_SERVER_TYPE3"?SE(f,h[f][0]):SE(f,h[f])}),Wt.debug("set area success:",d.join(","))}catch(d){throw i.onError(d),d}i.onSuccess()}function zJ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function BR(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?zJ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):zJ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}let eG=1;function ght(e,r,i,d,h){eG+=1;const f={sid:i.sid,command:"convergeAllocateEdge",uid:"666",appId:i.appId,ts:Math.floor(Date.now()/1e3),seq:eG,requestId:eG,version:AT,cname:i.cname},g={service_name:r,json_body:JSON.stringify(f)};let b,C,P=e[0];return ER(async()=>{b=Date.now();const x=await SR(P,{data:g,cancelToken:d,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(C=Date.now()-b,x.code!==0){const _t=new t_(Gi.UNEXPECTED_RESPONSE,"live streaming ap error, code"+x.code,{retry:!0,responseTime:C});throw Wt.error(_t.toString()),_t}const H=JSON.parse(x.json_body);if(H.code!==200){const _t=new t_(Gi.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(H.code,", reason: ").concat(H.reason),{code:H.code,responseTime:C});throw Wt.error(_t.toString()),_t}if(!H.servers||H.servers.length===0){const _t=new t_(Gi.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:H.code,responseTime:C});throw Wt.error(_t.toString()),_t}const $=function(_t,_i){return{addressList:_t.servers.map(ue=>"wss://".concat(ue.address.replace(/\./g,"-"),".").concat(_s("WORKER_DOMAIN"),":").concat(ue.wss,"?serviceName=").concat(encodeURIComponent(_i))),workerToken:_t.workerToken,vid:_t.vid}}(H,r);return _s("LIVE_STREAMING_ADDRESS")&&($.addressList=_s("LIVE_STREAMING_ADDRESS")instanceof Array?_s("LIVE_STREAMING_ADDRESS"):[_s("LIVE_STREAMING_ADDRESS")]),BR(BR({},$),{},{responseTime:C})},(x,H)=>(k_.apworkerEvent(i.sid,{success:!0,sc:200,serviceName:r,responseDetail:JSON.stringify(x.addressList),firstSuccess:H===0,responseTime:C,serverIp:e[H%e.length]}),!1),(x,H)=>(k_.apworkerEvent(i.sid,{success:!1,sc:x.data&&x.data.code||200,serviceName:r,responseTime:C,serverIp:e[H%e.length]}),!!(x.code!==Gi.OPERATION_ABORTED&&x.code!==Gi.UNEXPECTED_RESPONSE||x.data&&x.data.retry)&&(P=e[(H+1)%e.length],!0)),h)}let nG=1;function YJ(e,r,i,d){let{url:h,areaCode:f}=e;const{clientId:g,sid:b}=r,C=Date.now();let P;const x=r.role,[H,$]=iG(r,f,[_v.CHOOSE_SERVER]);let _t=Fg.networkState;return ER(async()=>{_t&&Fg.networkState===uT.OFFLINE&&Fg.onlineWaiter&&await T_.race([Fg.onlineWaiter,mS(d&&d.maxRetryTimeout||Mb.maxRetryTimeout)]),_t=Fg.networkState;const{data:_i,headers:ue}=await SR(h,{data:H,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);P=ue.http3==="1"?1:-1,k_.reportResourceTiming(h,b),XJ(_i,h,r,C,[_v.CHOOSE_SERVER],P);const _r=$N(_i,_v.CHOOSE_SERVER);return rG(_r),YF(_r,h)},_i=>(_i&&k_.joinChooseServer(b,{role:x,lts:C,succ:!0,csAddr:h,opid:$,serverList:_i.gatewayAddrs.map(ue=>ue.address),ec:null,cid:_i.cid.toString(),uid:_i.uid.toString(),csIp:_i.csIp,unilbsServerIds:[_v.CHOOSE_SERVER].toString(),isHttp3:P,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:_i.res.detail&&_i.res.detail[38]}),!1),_i=>_i.code!==Gi.OPERATION_ABORTED&&(_i.code===Gi.CAN_NOT_GET_GATEWAY_SERVER?_i.data.retry:(k_.joinChooseServer(b,{role:x,lts:C,succ:!1,csAddr:h,serverList:null,opid:$,ec:_i.code,csIp:_i.data&&_i.data.csIp,unilbsServerIds:[_v.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:_t}),isHttp3:P,corssRegionTagReq:r.apRequestDetail}),Wt.warning("[".concat(g||"sid-".concat(b.slice(0,6)),"] Choose server network error, retry"),_i),!0)),d)}function JJ(e,r,i,d){let h,{url:f,areaCode:g,serviceIds:b}=e;const C=Date.now(),P=r.role,[x,H]=iG(r,g,b);let $;return ER(async()=>{$&&Fg.networkState===uT.OFFLINE&&Fg.onlineWaiter&&await T_.race([Fg.onlineWaiter,mS(d&&d.maxRetryTimeout||Mb.maxRetryTimeout)]),$=Fg.networkState;const{data:_t,headers:_i}=await SR(f,{data:x,cancelToken:i,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);h=_i.http3==="1"?1:-1,k_.reportResourceTiming(f,r.sid),XJ(_t,f,r,C,b,h);const ue=$N(_t,_v.CHOOSE_SERVER),_r=$N(_t,r.cloudProxyServer==="proxy5"?_v.CLOUD_PROXY_5:r.cloudProxyServer==="proxy3"||r.cloudProxyServer==="proxy4"?_v.CLOUD_PROXY:_v.CLOUD_PROXY_FALLBACK),Fi=performance.getEntriesByName(f),Di=Fi[Fi.length-1];let Js;return Di&&(Js={name:Di.name,protocol:"nextHopProtocol"in Di?Di.nextHopProtocol:"",dnscost:"domainLookupEnd"in Di&&"domainLookupStart"in Di&&typeof Di.domainLookupEnd=="number"&&typeof Di.domainLookupStart=="number"?Di.domainLookupEnd-Di.domainLookupStart:-1,tcpTlsCost:"connectEnd"in Di&&"connectStart"in Di&&typeof Di.connectEnd=="number"&&typeof Di.connectStart=="number"?Di.connectEnd-Di.connectStart:-1,reqCost:"requestStart"in Di&&typeof Di.requestStart=="number"&&"responseEnd"in Di&&typeof Di.responseEnd=="number"?Di.responseEnd-Di.requestStart:-1,handleCost:"leave_ts"in _t&&"enter_ts"in _t&&typeof _t.leave_ts=="number"&&typeof _t.enter_ts=="number"?_t.leave_ts-_t.enter_ts:-1}),rG(ue),{gatewayInfo:YF(ue,f),proxyInfo:_r,url:f,resourceTimingInfo:Js}},_t=>(_t.gatewayInfo&&k_.joinChooseServer(r.sid,{role:P,lts:C,succ:!0,csAddr:f,serverList:_t.gatewayInfo.gatewayAddrs.map(_i=>_i.address),ec:null,opid:H,cid:_t.gatewayInfo.cid.toString(),uid:_t.gatewayInfo.uid.toString(),csIp:_t.gatewayInfo.csIp,unilbsServerIds:b.toString(),isHttp3:h,corssRegionTagReq:r.apRequestDetail,corssRegionTagRes:_t.gatewayInfo.res.detail&&_t.gatewayInfo.res.detail[38],resourceTimingInfo:_t.resourceTimingInfo?JSON.stringify(_t.resourceTimingInfo):void 0}),_t.proxyInfo&&k_.joinWebProxyAP(r.sid,{lts:C,sucess:1,apServerAddr:f,turnServerAddrList:_t.proxyInfo.addresses.map(_i=>_i.ip).join(","),errorCode:null,eventType:r.cloudProxyServer,unilbsServerIds:b.toString()}),!1),_t=>_t.code!==Gi.OPERATION_ABORTED&&(_t.code===Gi.CAN_NOT_GET_GATEWAY_SERVER?_t.data.retry:(k_.joinWebProxyAP(r.sid,{lts:C,sucess:0,apServerAddr:f,turnServerAddrList:null,errorCode:_t.code,eventType:r.cloudProxyServer,unilbsServerIds:b.toString(),extend:JSON.stringify({networkState:$})}),Wt.warning("[".concat(r.clientId,"] multi unilbs network error, retry"),_t),!0)),d)}const XJ=(e,r,i,d,h,f)=>{const{sid:g,clientId:b,cloudProxyServer:C}=i,P=[],x=H=>{H.flag===4096?k_.joinChooseServer(g,{role:i.role,lts:d,succ:!1,csAddr:r,opid:e.opid,serverList:null,ec:H.error.message,csIp:H.error.data&&H.error.data.csIp,unilbsServerIds:h.toString(),isHttp3:f,corssRegionTagReq:i.apRequestDetail}):H.flag!==1048576&&H.flag!==4194304&&H.flag!==4194310||k_.joinWebProxyAP(g,{lts:d,sucess:0,apServerAddr:r,turnServerAddrList:null,errorCode:H.error.code,eventType:C,unilbsServerIds:h.toString()})};if(e.response_body.forEach(H=>{const $=H.buffer.code;if(H.uri===23&&$===0&&!H.buffer.edges_services)if(H.buffer.flag===4194310)Wt.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),H.buffer.edges_services=[];else{const _t={error:new t_(Gi.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:H.buffer.flag};P.push(_t),x(_t)}if($!==0){const _t=xO($),_i={error:new t_(Gi.CAN_NOT_GET_GATEWAY_SERVER,_t.desc,{desc:_t.desc,retry:_t.retry,csIp:e.detail[502]}),flag:H.buffer.flag};H.buffer.flag===4194310?Wt.warning(_i.error.toString()):P.push(_i),x(_i)}}),P.length)throw Wt.warning("[".concat(b||"sid-".concat(g.slice(0,6)),"] multi unilbs ").concat(r," failed, ").concat(P.map(H=>"flag: ".concat(H.flag,", message: ").concat(H.error.message,", retry: ").concat(H.error.data.retry)).join(" | "))),new t_(Gi.CAN_NOT_GET_GATEWAY_SERVER,P.map(H=>"flag: ".concat(H.flag,", message: ").concat(H.error.message)).join(" | "),{retry:!!P.find(H=>H.error.data.retry),csIp:e.detail[502],desc:[...new Set(P.map(H=>{var $;return H==null||($=H.error)===null||$===void 0||($=$.data)===null||$===void 0?void 0:$.desc}).filter(H=>!!H))]})},rG=e=>{var r,i,d,h;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new t_(Gi.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(_s("AP_AREA")&&((d=e.detail)!==null&&d!==void 0&&d[23]&&typeof((h=e.detail)===null||h===void 0?void 0:h[23])=="string"?HJ(e.detail[23].toLowerCase()):HJ()),(r=e.detail)!==null&&r!==void 0&&r[19]&&typeof((i=e.detail)===null||i===void 0?void 0:i[19])=="string"){const g=e.detail[19],b=g==null?void 0:g.split(";");for(let C=0;C<b.length;C++){var f;const P=xS(f=b[C]).call(f);e.addresses[C]&&b&&(e.addresses[C].fingerprint=P)}}if(_s("GATEWAY_ADDRESS")&&_s("GATEWAY_ADDRESS").length>0){Wt.debug("assign gateway address to",_s("GATEWAY_ADDRESS"));const g=_s("GATEWAY_ADDRESS").map(b=>{var C,P;const x=(C=(P=e.addresses.find(H=>H.ip===b.ip&&H.port===b.port))===null||P===void 0?void 0:P.fingerprint)!==null&&C!==void 0?C:"";return{ip:b.ip,port:b.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:x}});e.addresses=g}},vht=(e,r)=>{if(e.response_body&&e.response_body.length){const i=e.response_body[0];if(i.buffer.code!==0){const d=xO(i.buffer.code);throw new t_(Gi.UPDATE_TICKET_FAILED,"[".concat(i.buffer.code,"]: ").concat(d.desc),{retry:d.retry})}return i.buffer.ticket}throw Wt.debug("update ticket request received ap response without response body:",r),new t_(Gi.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},iG=(e,r,i)=>{const d=Math.floor(Math.random()*1e12),h=e.role==="host"?"1":e.role==="audience"?"2":void 0,f={appid:e.appId,client_ts:Date.now(),opid:d,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:BR(BR(BR({6:e.stringUid,11:r,12:_s("USE_NEW_TOKEN")?"1":void 0},h?{17:h}:{}),{},{22:r},e.apRequestDetail?{33:e.apRequestDetail}:{}),e.apRTM?{26:"RTM2"}:{}),key:e.token,service_ids:i,uid:e.uid||0}}]};f.request_bodies.forEach(b=>{e.multiIP&&e.multiIP.gateway_ip&&(b.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const g=new FormData;return g.append("request",JSON.stringify(f)),[g,d]},bht=(e,r)=>{const i=Math.floor(Math.random()*1e12),d={appid:e.appId,client_ts:Date.now(),opid:i,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:r,uid:e.uid||0,edges_services:e.apResponse.addresses.map(f=>({ip:f.ip,port:f.port}))}}]},h=new FormData;return h.append("request",JSON.stringify(d)),[h,i]};let FO=0;function BO(e){return T_.all(e.map(r=>r.then(i=>{throw i},i=>i))).then(r=>{throw r},r=>r)}const iP=async e=>{let{fragementLength:r,referenceList:i,asyncMapHandler:d,allFailedhandler:h,promisesCollector:f}=e,g=0;const b=r;let C,P=0;const x=async()=>{const H=(()=>{const $=g*b,_t=$+b;return i.slice($,_t).map(d)})();f&&f.push(...H);try{C=await BO(H)}catch($){if(P+=b,g++,!(P>=i.length))return void await x();h($)}H.forEach($=>$.cancel())};return await x(),C},QJ=async e=>{let{referenceList:r,asyncMapHandler:i,closeFn:d}=e;const h=r.length;let f=0;const g=async()=>{const b=i(r.shift());try{return await b}catch(C){if(f++,f>=h||d!=null&&d(C))throw C;return g()}};return g()};async function yht(){if(typeof VideoDecoder>"u")return!0;let e;const r=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,85,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,149,160,133,4,144,43,122,168,159,120,159,205,39,82,131,57,52,87,187,68,23,248,134,204,226,97,17,49,183,55,236,219,249,221,98,208,215,190,59,179,167,213,47,1,246,150,14,194,245,159,83,35,64,103,218,38,21,82,3,135,21,185,84,248,134],i=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,148,62,134,140,92,172,141,77,35,94,181,164,65,169,65,156,154,43,221,162,11,252,67,102,113,48,136,137,219,62,43,113,239,23,126,250,186,252,10,138,218,25,193,244,74,68,194,209,107,23,52,206,199,78,72,98,103,151,71,96,62,51,210,158,72,231,158],d=[18,0,10,13,0,0,0,3,180,253,144,6,136,8,8,8,32,50,87,16,66,128,2,8,32,132,0,8,0,180,90,204,169,166,242,109,241,190,143,143,233,163,51,196,98,95,151,224,22,134,33,240,150,248,67,18,34,196,142,81,238,173,140,80,205,232,132,144,67,12,131,157,4,171,243,86,122,35,6,166,184,243,85,126,13,206,103,152,62,168,160,187,2,241,138,52,211,72,121,128,151,63,147,128,19,42],h=[18,0,50,138,1,48,192,64,253,248,65,17,67,192,32,0,16,0,0,0,0,0,0,0,195,12,48,144,64,32,0,209,75,61,9,204,25,115,79,226,115,63,63,208,70,210,220,153,126,241,237,37,107,195,153,1,99,112,230,189,209,169,130,10,11,22,167,215,159,205,197,7,183,162,26,48,254,141,134,103,32,16,235,45,1,15,18,119,169,110,206,251,51,115,202,60,148,1,46,39,109,25,28,86,168,15,77,211,239,2,58,43,146,26,230,184,81,48,140,226,226,250,222,146,171,133,164,13,188,180,64,122,142,146,32,208,238,170,193,35,53,44,225],f=[18,0,50,107,48,0,133,125,248,65,26,195,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,204,24,122,65,56,165,18,52,206,218,4,187,51,97,9,29,191,90,253,106,185,31,197,155,52,205,245,185,203,131,20,226,25,124,95,113,220,113,141,15,15,104,211,144,152,237,150,157,127,51,143,24,231,218,171,255,176,241,128,229,149,150,148,66,245,228,91,27,182,228,136,61,182,237,133,45,220,24,103,214,152],g=[18,0,50,122,48,1,9,253,248,65,26,67,64,62,32,31,16,0,0,0,0,0,1,4,16,64,144,64,32,0,198,182,231,242,220,235,163,140,12,36,36,166,46,132,210,4,71,23,218,132,27,30,17,45,244,79,31,243,195,136,100,169,76,88,142,85,204,217,121,168,29,163,198,17,251,223,73,12,212,244,139,123,151,179,75,216,96,208,136,40,229,42,59,149,10,116,228,85,99,93,221,108,255,140,248,20,30,167,122,109,206,164,108,197,110,251,23,243,133,160,63,13,207,177,12,128];return await new T_((C,P)=>{let x;(async function(){e&&e.state!=="closed"||await async function(){e=new VideoDecoder({output:$=>{$.close(),clearTimeout(x),C(!0)},error:$=>{clearTimeout(x),C(!1)}}),await e.configure({codec:"av01.0.05M.08",width:160,height:90})}();const H=[r,i,d,h,f,g];for(let $=0;$<H.length;$++){const _t=new EncodedVideoChunk({type:$==0?"key":"delta",timestamp:33333*$,duration:33333,data:new Uint8Array(H[$])});try{await e.decode(_t)}catch{return void C(!1)}}})(),x=setTimeout(()=>{C(!1)},5e3)})}async function oG(e,r,i,d){return{gatewayInfo:await async function(f,g,b,C){let P=null;const x=[],H=async()=>{const _t=_s("WEBCS_DOMAIN").slice(0,_s("AJAX_REQUEST_CONCURRENT")).map(_r=>({url:f.proxyServer?"https://".concat(f.proxyServer,"/ap/?url=").concat(_r+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_r,"/api/v2/transpond/webrtc?v=2"),areaCode:rP()})),_i=C.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:_t.map(_r=>_r.url)}),ue=await iP({fragementLength:_s("FRAGEMENT_LENGTH"),referenceList:_t,asyncMapHandler:_r=>(Wt.debug("[".concat(f.clientId,"] Connect to choose_server:"),_r.url),YJ(_r,f,g,b)),allFailedhandler:_r=>{throw C.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_r},_i),_r[0]},promisesCollector:x});return C.recordJoinChannelService({endTs:Date.now(),status:"success"},_i),ue},$=async()=>{if(await mS(1e3),P!==null)return P;const _t=_s("WEBCS_DOMAIN_BACKUP_LIST").map(_r=>({url:f.proxyServer?"https://".concat(f.proxyServer,"/ap/?url=").concat(_r+"/api/v2/transpond/webrtc?v=2"):"https://".concat(_r,"/api/v2/transpond/webrtc?v=2"),areaCode:rP()})),_i=C.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:_t.map(_r=>_r.url)}),ue=await iP({fragementLength:_s("FRAGEMENT_LENGTH"),referenceList:_t,asyncMapHandler:_r=>(Wt.debug("[".concat(f.clientId,"] Connect to backup choose_server:"),_r.url),YJ(_r,f,g,b)),allFailedhandler:_r=>{throw C.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_r},_i),_r[0]},promisesCollector:x});return C.recordJoinChannelService({endTs:Date.now(),status:"success"},_i),ue};try{return P=await BO([H(),$()]),x.length&&x.forEach(_t=>_t.cancel&&typeof _t.cancel=="function"&&_t.cancel()),P}catch(_t){throw _t[0]}}(e,r,i,d)}}async function ZJ(e,r,i,d,h){const f=e.cloudProxyServer;if(f==="disabled"){if(e.useLocalAccessPoint)return await oG(e,r,i,h);if(_s("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:$,proxyInfo:_t}=await eX(e,r,i,h);if(e.turnServer&&e.turnServer.mode!=="auto")return{gatewayInfo:$};const _i=_t.map(ue=>({turnServerURL:ue.address,tcpport:ue.tcpport||RS.tcpport,udpport:ue.udpport||RS.udpport,username:ue.username||RS.username,password:ue.password||RS.password,forceturn:!1,security:!0}));if(h.useP2P){var g;const ue=(g=e.uid)!==null&&g!==void 0?g:$.uid,_r="glb:".concat(ue.toString()),Fi=await QV(_r),Di=_t.map(Js=>({turnServerURL:Js.address,tcpport:Js.tcpport||RS.tcpport,udpport:Js.udpport||RS.udpport,username:_r,password:Fi,forceturn:!1,security:!0}));_i.push(...Di)}return e.turnServer={mode:"manual",servers:_i},{gatewayInfo:$}}return await oG(e,r,i,h)}const{proxyInfo:b,gatewayInfo:C}=await eX(e,r,i,h),P={gatewayInfo:C},x=b.map($=>({turnServerURL:$.address,tcpport:f==="proxy3"?void 0:$.tcpport?$.tcpport:RS.tcpport,udpport:f==="proxy4"?void 0:$.udpport?$.udpport:RS.udpport,username:$.username||RS.username,password:$.password||RS.password,forceturn:f!=="proxy4",security:f==="proxy5"}));if(h.useP2P){var H;const $=(H=e.uid)!==null&&H!==void 0?H:C.uid,_t="glb:".concat($.toString()),_i=await QV(_t),ue=b.map(_r=>({turnServerURL:_r.address,tcpport:f==="proxy3"?void 0:_r.tcpport||RS.tcpport,udpport:f==="proxy4"?void 0:_r.udpport||RS.udpport,username:_t,password:_i,forceturn:f!=="proxy4",security:f==="proxy5"}));x.push(...ue)}return e.turnServer={mode:"manual",servers:x},Wt.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(f)),P}async function $J(e,r,i,d,h){const f=_s("ACCOUNT_REGISTER").slice(0,_s("AJAX_REQUEST_CONCURRENT"));let g=[];g=r.proxyServer?f.map(C=>"https://".concat(r.proxyServer,"/ap/?url=").concat(C+"/api/v1")):f.map(C=>"https://".concat(C,"/api/v1"));const b=h==null?void 0:h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:g});try{const C=await async function(P,x,H,$,_t){const _i=Date.now(),ue={sid:H.sid,opid:10,appid:H.appId,string_uid:x};let _r=P[0];const Fi=await ER(()=>SR(_r+"".concat(_r.indexOf("?")===-1?"?":"&","action=stringuid"),{data:ue,cancelToken:$,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(Di,Js)=>{if(Di.code===0){if(Di.uid<=0||Di.uid>=Math.pow(2,32))throw Wt.error("Invalid Uint Uid ".concat(x," => ").concat(Di.uid),Di),k_.reqUserAccount(ue.sid,{lts:_i,success:!1,serverAddr:_r,stringUid:ue.string_uid,uid:Di.uid,errorCode:Gi.INVALID_UINT_UID_FROM_STRING_UID,extend:ue}),new t_(Gi.INVALID_UINT_UID_FROM_STRING_UID);return k_.reqUserAccount(ue.sid,{lts:_i,success:!0,serverAddr:_r,stringUid:ue.string_uid,uid:Di.uid,errorCode:null,extend:ue}),!1}const _l=xO(Di.code);return _l.retry&&(_r=P[(Js+1)%P.length]),k_.reqUserAccount(ue.sid,{lts:_i,success:!1,serverAddr:_r,stringUid:ue.string_uid,uid:Di.uid,errorCode:_l.desc,extend:ue}),_l.retry},(Di,Js)=>Di.code!==Gi.OPERATION_ABORTED&&(k_.reqUserAccount(ue.sid,{lts:_i,success:!1,serverAddr:_r,stringUid:ue.string_uid,uid:null,errorCode:Di.code,extend:ue}),_r=P[(Js+1)%P.length],!0),_t);if(Fi.code!==0){const Di=xO(Fi.code);throw new t_(Gi.UNEXPECTED_RESPONSE,Di.desc)}return Fi}(g,e,r,i,d);return h==null||h.recordJoinChannelService({status:"success",endTs:Date.now()},b),C.uid}catch(C){throw h==null||h.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[C]},b),C}}async function Sht(e,r,i){const d=_s("ACCOUNT_REGISTER");let h=[];h=r.proxyServer?d.map(f=>"https://".concat(r.proxyServer,"/ap/?url=").concat(f+"/api/v1")):d.map(f=>"https://".concat(f,"/api/v1"));try{return await QJ({referenceList:h,asyncMapHandler:g=>async function(b,C,P,x){const H=Date.now(),$={sid:P.sid,opid:10,appid:P.appId,string_uid:C};try{const _t=await SR(b+"".concat(b.indexOf("?")===-1?"?":"&","action=stringuid"),{data:$,cancelToken:x,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}});if(_t.code!==0){const _i=xO(_t.code);throw new t_(Gi.UNEXPECTED_RESPONSE,"preload sua error:".concat(_i.desc),_i)}if(_t.uid<=0||_t.uid>=Math.pow(2,32))throw new t_(Gi.INVALID_UINT_UID_FROM_STRING_UID);return{requestTime:H,url:b,req:$,uid:_t.uid,elapse:Date.now()-H}}catch(_t){throw _t}}(g,e,r,i),closeFn:g=>g.code===Gi.OPERATION_ABORTED||g.code===Gi.UNEXPECTED_RESPONSE&&!g.data.retry})}catch(f){throw f}}async function Tht(e,r,i){const d=_s("CDS_AP").slice(0,_s("AJAX_REQUEST_CONCURRENT")).map(C=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(C+"/api/v1"):"https://".concat(C,"/api/v1?action=config")),h=d.map(C=>function(P,x,H,$){const _t=oE(),_i={flag:64,cipher_method:0,features:BR(BR(BR(BR(BR({install_id:sF(),device:_t.name,system:_t.os,system_general:navigator.userAgent,vendor:x.appId,version:AT,cname:x.cname,session_id:x.sid,proxyServer:x.proxyServer,sdk_type:pht.WEB_RTC,browser_name:_t.name,browser_version:_t.version,user_agent:navigator.userAgent,channel_name:x.cname},x.stringUid&&{string_uid:x.stringUid}),x.uid&&{uid:x.uid+""}),_t.os&&{os_name:_t.os}),_t.osVersion&&{os_version:_t.osVersion}),{},{detail:""})};return ER(()=>SR(P,{data:_i,timeout:1e3,cancelToken:H,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,ue=>ue.code!==Gi.OPERATION_ABORTED,$)}(C,e,r,i));let f=null,g=null,b={};try{f=await BO(h)}catch(C){if(C.code===Gi.OPERATION_ABORTED)throw C;g=C}if(h.forEach(C=>C.cancel()),k_.reportApiInvoke(e.sid,{name:QE.REQUEST_CONFIG_DISTRIBUTE,options:{error:g,res:f}}).onSuccess(),f&&f.test_tags)try{b=function(C){if(!C.test_tags)return{};const P=C.test_tags,x=Object.keys(P),H={};return x.forEach($=>{var _t;const _i=xS(_t=$.slice(4)).call(_t),ue=JSON.parse(P[$]),_r=ue[1];H[_i]={tag:ue[0]||"",value:_r}}),H}(f)}catch{}return b}async function tX(e,r){const i=_s("WEBCS_DOMAIN").concat(_s("WEBCS_DOMAIN_BACKUP_LIST")).map(d=>({url:"https://".concat(d,"/api/v2/transpond/webrtc?v=2"),areaCode:rP(),serviceIds:[_v.CHOOSE_SERVER,_v.CLOUD_PROXY_FALLBACK]}));try{return await QJ({referenceList:i,asyncMapHandler:h=>async function(f,g,b){let C,{url:P,areaCode:x,serviceIds:H}=f;const $=Date.now(),[_t,_i]=iG(g,x,H);let ue=Fg.networkState;try{ue&&Fg.networkState===uT.OFFLINE&&Fg.onlineWaiter&&await T_.race([Fg.onlineWaiter,mS(Mb.maxRetryTimeout)]),ue=Fg.networkState;const{data:_r,headers:Fi}=await SR(P,{data:_t,cancelToken:b,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);C=Fi.http3==="1"?1:-1,(_u=>{const ga=[];if(_u.response_body.forEach(_m=>{const r_=_m.buffer.code;if(_m.uri===23&&r_===0&&!_m.buffer.edges_services)if(_m.buffer.flag===4194310)_m.buffer.edges_services=[];else{const a_={error:new t_(Gi.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:_u.detail[502]}),flag:_m.buffer.flag};ga.push(a_)}if(r_!==0){const a_=xO(r_),p_={error:new t_(Gi.CAN_NOT_GET_GATEWAY_SERVER,a_.desc,{desc:a_.desc,retry:a_.retry,csIp:_u.detail[502]}),flag:_m.buffer.flag};_m.buffer.flag===4194310?Wt.warning(p_.error.toString()):ga.push(p_)}}),ga.length)throw new t_(Gi.CAN_NOT_GET_GATEWAY_SERVER,ga.map(_m=>"flag: ".concat(_m.flag,", message: ").concat(_m.error.message)).join(" | "),{retry:!!ga.find(_m=>_m.error.data.retry),csIp:_u.detail[502],desc:[...new Set(ga.map(_m=>{var r_;return _m==null||(r_=_m.error)===null||r_===void 0||(r_=r_.data)===null||r_===void 0?void 0:r_.desc}).filter(_m=>!!_m))]})})(_r);const Js=$N(_r,_v.CHOOSE_SERVER),_l=$N(_r,_v.CLOUD_PROXY_FALLBACK);return rG(Js),{gatewayInfo:YF(Js,P),proxyInfo:_l,opid:_i,requestTime:$,url:P,isHttp3:C,elapse:Date.now()-$}}catch(_r){throw _r}}(h,e,r),closeFn:h=>h.code===Gi.OPERATION_ABORTED||h.code===Gi.CAN_NOT_GET_GATEWAY_SERVER&&!h.data.retry})}catch(d){throw d}}async function eX(e,r,i,d){const h=_s("PROXY_SERVER_TYPE3"),f=(_t,_i,ue)=>{let _r=ue||h;return Array.isArray(_r)&&(_r=_i%2==0&&h[1]||h[0]),"https://".concat(_r,"/ap/?url=").concat(_t)};let g=null;const b=[],C=async()=>{const _t=_s("WEBCS_DOMAIN").slice(0,_s("AJAX_REQUEST_CONCURRENT")).map((_r,Fi)=>{let Di;return Di=e.cloudProxyServer==="disabled"&&e.proxyServer?f("".concat(_r,"/api/v2/transpond/webrtc?v=2"),Fi,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(_r,"/api/v2/transpond/webrtc?v=2"):f("".concat(_r,"/api/v2/transpond/webrtc?v=2"),Fi),{url:Di,areaCode:rP(),serviceIds:[_v.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?_v.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?_v.CLOUD_PROXY:_v.CLOUD_PROXY_FALLBACK]}}),_i=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:_t.map(_r=>_r.url)}),ue=await iP({fragementLength:_s("FRAGEMENT_LENGTH"),referenceList:_t,asyncMapHandler:_r=>(Wt.debug("[".concat(e.clientId,"] Connect to choose_server:"),_r.url),JJ(_r,e,r,i)),allFailedhandler:_r=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_r},_i),_r[0]},promisesCollector:b});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},_i),ue},P=async()=>{if(await mS(1e3),g!==null)return g;const _t=_s("WEBCS_DOMAIN_BACKUP_LIST").map((_r,Fi)=>{let Di;return Di=e.cloudProxyServer==="disabled"&&e.proxyServer?f("".concat(_r,"/api/v2/transpond/webrtc?v=2"),Fi,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(_r,"/api/v2/transpond/webrtc?v=2"):f("".concat(_r,"/api/v2/transpond/webrtc?v=2"),Fi),{url:Di,areaCode:rP(),serviceIds:[_v.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?_v.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?_v.CLOUD_PROXY:_v.CLOUD_PROXY_FALLBACK]}}),_i=d.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:_t.map(_r=>_r.url)}),ue=await iP({fragementLength:_s("FRAGEMENT_LENGTH"),referenceList:_t,asyncMapHandler:_r=>(Wt.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),_r.url),JJ(_r,e,r,i)),allFailedhandler:_r=>{throw d.recordJoinChannelService({endTs:Date.now(),status:"error",errors:_r},_i),_r[0]},promisesCollector:b});return d.recordJoinChannelService({endTs:Date.now(),status:"success"},_i),ue};let x,H,$;try{({gatewayInfo:x,proxyInfo:H,url:$}=await BO([C(),P()]))}catch(_t){throw _t[0]}if(b.length&&b.forEach(_t=>_t.cancel&&typeof _t.cancel=="function"&&_t.cancel()),!x||!H)throw new t_(Gi.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=$,e.cloudProxyServer!=="disabled"&&Array.isArray(h)&&$){const _t=/^https?:\/\/(.+?)(\/.*)?$/.exec($)[1];E_(h).call(h,_t)&&(e.proxyServer=_t,Wt.setProxyServer(_t),k_.setProxyServer(_t))}return g={gatewayInfo:x,proxyInfo:await IJ(H,x.uid)},g}async function Rht(e,r,i){const d=_s("UAP_AP").slice(0,_s("AJAX_REQUEST_CONCURRENT")).map(f=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(f+"/api/v1?action=uap"):"https://".concat(f,"/api/v1?action=uap")),h=d.map(f=>function(g,b,C,P){const x={command:"convergeAllocateEdge",sid:b.sid,appId:b.appId,token:b.token,ts:Date.now(),version:AT,cname:b.cname,uid:b.uid.toString(),requestId:nG,seq:nG};nG+=1;const H={service_name:"tele_channel",json_body:JSON.stringify(x)};return ER(async()=>{const $=await SR(g,{data:H,cancelToken:C,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if($.code!==0){const _i=new t_(Gi.UNEXPECTED_RESPONSE,"cross channel ap error, code"+$.code,{retry:!0});throw Wt.error(_i.toString()),_i}const _t=JSON.parse($.json_body);if(_t.code!==200){const _i=new t_(Gi.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(_t.code,", reason: ").concat(_t.reason));throw Wt.error(_i.toString()),_i}if(!_t.servers||_t.servers.length===0){const _i=new t_(Gi.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw Wt.error(_i.toString()),_i}return{vid:_t.vid,workerToken:_t.workerToken,addressList:(_s("CHANNEL_MEDIA_RELAY_SERVERS")||_t.servers).map(_i=>"wss://".concat(_i.address.replace(/\./g,"-"),".").concat(_s("WORKER_DOMAIN"),":").concat(_i.wss))}},void 0,$=>!!($.code!==Gi.OPERATION_ABORTED&&$.code!==Gi.UNEXPECTED_RESPONSE||$.data&&$.data.retry),P)}(f,e,r,i));try{const f=await BO(h);return h.forEach(g=>g.cancel()),f}catch(f){throw f[0]}}async function Iht(e,r,i){let d=null;const h=[],f=async g=>{const b=_s(g?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(C=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(C+"/api/v2/transpond/webrtc?v=2"):"https://".concat(C,"/api/v2/transpond/webrtc?v=2"));return g&&(await mS(1e3),d!==null)?d:await iP({fragementLength:_s("FRAGEMENT_LENGTH"),referenceList:b,asyncMapHandler:C=>(Wt.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(g?"backup":""," choose_server:"),C),function(P,x,H,$){const[_t]=bht(x,[_v.CHOOSE_SERVER]);let _i=Fg.networkState;return ER(async()=>{_i&&Fg.networkState===uT.OFFLINE&&Fg.onlineWaiter&&await T_.race([Fg.onlineWaiter,mS($&&$.maxRetryTimeout||Mb.maxRetryTimeout)]),_i=Fg.networkState;const ue=await SR(P,{data:_t,cancelToken:H,headers:{"Content-Type":"multipart/form-data;"}},!0);return vht(ue,P)},()=>!1,ue=>ue.code!==Gi.OPERATION_ABORTED&&(ue.code===Gi.UPDATE_TICKET_FAILED?ue.data.retry:(Wt.warning("[".concat(x.clientId,"] update ticket network error, retry"),ue),!0)),$)}(C,e,r,i)),allFailedhandler:C=>{throw C[0]},promisesCollector:h})};try{return d=await BO([f(!1),f(!0)]),h.length&&h.forEach(g=>g.cancel&&typeof g.cancel=="function"&&g.cancel()),d}catch(g){throw g[0]}}function nX(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function sG(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?nX(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):nX(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}class wht extends qE{get isSuccess(){return!!this.configs}constructor(r,i){super(),Ei(this,"configs",void 0),Ei(this,"store",void 0),Ei(this,"joinInfo",void 0),Ei(this,"cancelToken",void 0),Ei(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),Ei(this,"interval",void 0),Ei(this,"mutex",void 0),Ei(this,"mutableParamsRead",!1),Ei(this,"configCache",{}),Ei(this,"limit_bitrate",void 0),this.mutex=new wS("config-distribute",r),this.store=i}startGetConfigDistribute(r,i){this.joinInfo=r,this.cancelToken=i,this.interval&&this.stopGetConfigDistribute(),_s("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},_s("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0,this.configs=void 0,this.limit_bitrate=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,k_.reportApiInvoke(null,{options:void 0,name:QE.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:FE.TRACER}).onSuccess(JSON.stringify(gR))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void Wt.debug("[config-distribute] get config distribute interrupted have no joininfo");let r;const i=await this.mutex.lock();try{r=await Tht(this.joinInfo,this.cancelToken,this.retryConfig),Wt.debug("[config-distribute] get config distribute",JSON.stringify(r));const d=function(h){var f;const g=nI(f=Object.keys(h).filter(P=>/^webrtc_ng_global_parameter/.test(P))).call(f);for(let P=0;P<g.length;P++)for(let x=g.length-1;x>P;x--){const H=g[x],$=h[H].value;if(typeof $.__priority=="number"){const _t=$.__priority,_i=g[x-1],ue=h[_i].value;if(typeof ue.__priority=="number"){if(!(_t>ue.__priority))continue;{const _r=H;g[x]=g[x-1],g[x-1]=_r}}else{const _r=H;g[x]=g[x-1],g[x-1]=_r}}}const b=Date.now();let C={};return g.forEach(P=>{const x=h[P].value.__expires;x&&x<=b||(C[P]=h[P])}),C}(r);this.cacheGlobalParameterConfig(d),this.store.hasStartJoinChannel||(this.store.isABTestSuccess=!0),this.configs=d}catch(d){const h=new t_(Gi.NETWORK_RESPONSE_ERROR,d);Wt.warning("[config-distribute] ".concat(h.toString()))}finally{i()}}getBitrateLimit(){return this.limit_bitrate||void 0}handleBitrateLimit(r){fJ(r)&&(this.limit_bitrate?this.limit_bitrate&&this.limit_bitrate.id!==r.id&&this.emit(XN.UPDATE_BITRATE_LIMIT,r):this.emit(XN.UPDATE_BITRATE_LIMIT,r))}getLowStreamConfigDistribute(){return this.limit_bitrate&&sG({},this.limit_bitrate.low_stream_uplink)}handleABTestConfigDistribute(r){try{const i={},d=Object.keys(r),h=[];d.forEach(f=>{const g=r[f].value;i[f]=g;const b=g.__id;if(b&&this.configCache[f]&&this.configCache[f].__id===b)return;const C=g.__type,P=r[f].value,x=r[f].tag;let H=0;C?C===V4.REALTIME&&(H=1):Object.keys(P).some($=>Object.prototype.hasOwnProperty.call(dF,$)||!UF()&&Object.prototype.hasOwnProperty.call(NL,$)?(H=1,!0):void 0),h.push({tag:x,isApplied:H,feature:f,params:JSON.stringify(g)})}),h.forEach(f=>{let{tag:g,feature:b,params:C,isApplied:P}=f;this.store.sessionId&&k_.abTest(this.store.sessionId,{intSucc:1,isApplied:P,tag:g,feature:b,params:C,cid:this.store.cid,uid:this.store.intUid})}),this.configCache=i}catch(i){Wt.debug("handleABTestConfigDistribute error",i)}}cacheGlobalParameterConfig(r){const i=function(h){const f={};return Object.keys(h).forEach(g=>{const b=h[g].value,C=b.__expires,P=b.__type;Object.keys(b).forEach(x=>{x==="__id"||x==="__type"||x==="__priority"||x==="__expires"||Object.prototype.hasOwnProperty.call(f,x)||(f[x]=sG(sG({value:b[x]},C&&{expires:C}),P&&{type:P}))})}),f}(r);try{var d;const h=(d=i.LIMIT_BITRATE)===null||d===void 0?void 0:d.value;delete i.LIMIT_BITRATE,h&&fJ(h)&&this.handleBitrateLimit(h),this.limit_bitrate=h,this.handleGlobalParameterConfig(i),this.handleABTestConfigDistribute(r),function(b){try{const C=Date.now();Object.keys(b).forEach(P=>{const{value:x,type:H,expires:$}=b[P];$&&$<=C||((H===V4.REALTIME||Object.prototype.hasOwnProperty.call(dF,P))&&(gR[P]=x,VE[P]=x,Wt.debug("Update realtime parameters from config distribute",P,x)),H||UF()||!Object.prototype.hasOwnProperty.call(NL,P)||(gR[P]=x,VE[P]=x,Wt.debug("Update gateway parameters from config distribute",P,x)))})}catch(C){Wt.error("Error update config immediately: ".concat(b),C.message)}}(i);const f=JSON.stringify(i),g=window.btoa(f);window.localStorage.setItem("websdk_ng_global_parameter",g),Wt.debug("Caching global parameters ".concat(f))}catch(h){Wt.error("Error caching global parameters:",h.message)}}handleGlobalParameterConfig(r){try{const i=Date.now();Object.keys(r).forEach(d=>{if(d==="CLIENT_ROLE_OPTIONS"&&Object.prototype.hasOwnProperty.call(VE,d)){const{value:h,expires:f}=r[d];if(f&&f<=i)return;(function(g,b){try{return typeof g=="object"&&typeof b=="object"&&JSON.stringify(g)===JSON.stringify(b)}catch{return!1}})(VE[d],h)||(gR[d]=h,VE[d]=h,this.emit(XN.UPDATE_CLIENT_ROLE_OPTIONS,h),Wt.debug("Updating client role options: ".concat(JSON.stringify(h))))}})}catch(i){Wt.error("Error handling global parameter config:",i.message)}}}class Cht extends qE{constructor(){super(...arguments),Ei(this,"resultStorage",new Map)}setLocalAudioStats(r,i,d){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",r,this.checkAudioInputLevel(d,i)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",r,this.checkSendAudioBitrate(d,i))}setLocalVideoStats(r,i,d){this.record("SEND_VIDEO_BITRATE_TOO_LOW",r,this.checkSendVideoBitrate(d,i)),this.record("FRAMERATE_INPUT_TOO_LOW",r,this.checkFramerateInput(d,i)),this.record("FRAMERATE_SENT_TOO_LOW",r,this.checkFramerateSent(d)),!i.muted&&this.record("VIDEO_ENCODE_FAILED",r,this.checResolutionSent(d))}setRemoteAudioStats(r,i){const d=r.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",d,this.checkAudioOutputLevel(i))}setRemoteVideoStats(r,i){const d=r.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",d,this.checkVideoDecode(i))}record(r,i,d){if(_s("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(r)||this.resultStorage.set(r,{result:[],isPrevNormal:!0});const h=this.resultStorage.get(r);if(!h)return;h.result.push(d);const f=r==="VIDEO_ENCODE_FAILED"?_s("ENCODE_EXCEPTION_TIMES"):5;if(h.result.length>=f){var g;const b=E_(g=h.result).call(g,!0);h.isPrevNormal&&!b&&this.emit("exception",aG[r],r,i),!h.isPrevNormal&&b&&this.emit("exception",aG[r]+2e3,r+"_RECOVER",i),h.isPrevNormal=b,h.result=[]}}checkAudioOutputLevel(r){return!(r.receiveBitrate>0&&r.receiveLevel===0)}checkAudioInputLevel(r,i){return i instanceof eS&&!i.isActive||!!i.muted||r.sendVolumeLevel!==0}checkFramerateInput(r,i){let d=null;i._encoderConfig&&i._encoderConfig.frameRate&&(d=dT(i._encoderConfig.frameRate));const h=r.captureFrameRate;return!d||!h||!(d>10&&h<5||d<10&&d>=5&&h<=1)}checkFramerateSent(r){return!(r.captureFrameRate&&r.sendFrameRate&&r.captureFrameRate>5&&r.sendFrameRate<=1)}checResolutionSent(r){var i;return!(!r.codecType||E_(i=_s("ENCODE_EXCEPTION_VALIDATE_CODEC")).call(i,r.codecType.toLocaleLowerCase()))||!r.captureFrameRate||r.sendFrameRate!==0||r.sendResolutionWidth!==0||r.sendResolutionHeight!==0}checkSendVideoBitrate(r,i){return!!i.muted||r.sendBitrate!==0}checkSendAudioBitrate(r,i){return i instanceof eS&&!i.isActive||!!i.muted||r.sendBitrate!==0}checkVideoDecode(r){return r.receiveBitrate===0||r.decodeFrameRate!==0}}const aG={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003,VIDEO_ENCODE_FAILED:2004},NS=new class{markSubscribeStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(r))}markPublishStart(e,r){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(r))}measureFromSubscribeStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(r));if(i.length>0){const d=i[i.length-1];return Math.round(performance.now()-d.startTime)}return 0}measureFromPublishStart(e,r){const i=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(r));if(i.length>0){const d=i[i.length-1];return Math.round(performance.now()-d.startTime)}return 0}};function rX(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function TI(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?rX(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rX(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}class oP{constructor(r){Ei(this,"store",void 0),Ei(this,"onStatsException",void 0),Ei(this,"onUploadPublishDuration",void 0),Ei(this,"onStatsChanged",void 0),Ei(this,"onVideoCodecChanged",void 0),Ei(this,"localStats",new Map),Ei(this,"remoteStats",new Map),Ei(this,"updateStatsInterval",void 0),Ei(this,"trafficStats",void 0),Ei(this,"trafficStatsPeerList",[]),Ei(this,"uplinkStats",void 0),Ei(this,"exceptionMonitor",void 0),Ei(this,"p2pChannel",void 0),Ei(this,"scalabilityMode",OL.L1T1),Ei(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=r,this.exceptionMonitor=new Cht,this.exceptionMonitor.on("exception",(i,d,h)=>{this.onStatsException&&this.onStatsException(i,d,h)})}startUpdateStats(){this.updateStatsInterval||(this.updateStatsInterval=window.setInterval(this.updateStats,1e3))}stopUpdateStats(){this.updateStatsInterval&&(window.clearInterval(this.updateStatsInterval),this.updateStatsInterval=void 0)}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(l_.LocalAudioTrack)||TI({},_F)}getLocalVideoTrackStats(){return this.localStats.get(l_.LocalVideoTrack)||TI({},EF)}getRemoteAudioTrackStats(r){const i=(f,g)=>{if(!this.trafficStats)return g;const b=this.trafficStats.peer_delay.find(C=>C.peer_uid===f);return b&&(g.publishDuration=b.B_ppad+(Date.now()-this.trafficStats.timestamp)),g},d={};if(r){var h;const f=(h=this.remoteStats.get(r))===null||h===void 0?void 0:h.audioStats;f&&(d[r]=i(r,f))}else Array.from(this.remoteStats.entries()).forEach(f=>{let[g,{audioStats:b}]=f;b&&(d[g]=i(g,b))});return d}getRemoteNetworkQualityStats(r){const i={};if(r){var d;const h=(d=this.remoteStats.get(r))===null||d===void 0?void 0:d.networkStats;h&&(i[r]=h)}else Array.from(this.remoteStats.entries()).forEach(h=>{let[f,{networkStats:g}]=h;g&&(i[f]=g)});return i}getRemoteVideoTrackStats(r){const i=(f,g)=>{if(!this.trafficStats)return g;const b=this.trafficStats.peer_delay.find(C=>C.peer_uid===f);return b&&(g.publishDuration=b.B_ppvd+(Date.now()-this.trafficStats.timestamp)),g},d={};if(r){var h;const f=(h=this.remoteStats.get(r))===null||h===void 0?void 0:h.videoStats;f&&(d[r]=i(r,f))}else Array.from(this.remoteStats.entries()).forEach(f=>{let[g,{videoStats:b}]=f;b&&(d[g]=i(g,b))});return d}getRTCStats(){let r=0,i=0,d=0,h=0;const f=this.localStats.get(l_.LocalAudioTrack);f&&(r+=f.sendBytes,i+=f.sendBitrate);const g=this.localStats.get(l_.LocalVideoTrack);g&&(r+=g.sendBytes,i+=g.sendBitrate);const b=this.localStats.get(l_.LocalVideoLowTrack);b&&(r+=b.sendBytes,i+=b.sendBitrate),this.remoteStats.forEach(P=>{let{audioStats:x,videoStats:H}=P;x&&(d+=x.receiveBytes,h+=x.receiveBitrate),H&&(d+=H.receiveBytes,h+=H.receiveBitrate)});let C=1;return this.trafficStats&&(C+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:C,SendBitrate:i,SendBytes:r,RecvBytes:d,RecvBitrate:h,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(r){this.localStats.set(r,void 0)}removeLocalStats(r){r?this.localStats.delete(r):this.localStats.clear()}addRemoteStats(r){this.remoteStats.set(r,{})}removeRemoteStats(r){r?this.remoteStats.delete(r):this.remoteStats.clear()}addP2PChannel(r){this.p2pChannel=r}updateTrafficStats(r){r.peer_delay=r.peer_delay.filter(i=>i.B_ppad!==void 0||i.B_ppvd!==void 0),r.peer_delay.filter(i=>this.trafficStatsPeerList.indexOf(i.peer_uid)===-1).forEach(i=>{var d;const h=(d=this.p2pChannel)===null||d===void 0?void 0:d.getRemoteMedia(i.peer_uid),f=h!=null&&h.videoSSRC?NS.measureFromSubscribeStart(this.store.clientId,h.videoSSRC):0,g=h!=null&&h.audioSSRC?NS.measureFromSubscribeStart(this.store.clientId,h.audioSSRC):0;i.B_ppad!==void 0&&i.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(i.peer_uid,i.B_ppad,i.B_ppvd,f>g?f:g),this.trafficStatsPeerList.push(i.peer_uid))}),this.trafficStats=r}updateUplinkStats(r){this.uplinkStats&&this.uplinkStats.B_fir!==r.B_fir&&Wt.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(r.B_fir)),this.uplinkStats=r}static isRemoteVideoFreeze(r,i,d){if(!r)return!1;const h=!!d&&i.framesDecodeFreezeTime>d.framesDecodeFreezeTime,f=!d||i.framesDecodeCount>d.framesDecodeCount;return h||!f}static isRemoteAudioFreeze(r){return!!r&&r._isFreeze()}isLocalVideoFreeze(r){return!(!r.inputFrame||!r.sentFrame)&&r.inputFrame.frameRate>5&&r.sentFrame.frameRate<3}updateLocalStats(r){Array.from(this.localStats.entries()).forEach(i=>{let[d,h]=i;switch(d){case l_.LocalVideoTrack:case l_.LocalVideoLowTrack:{const b=h,C=TI({},EF),P=r.getStats(),x=r.getLocalMedia(d);if(P){const H=P.videoSend.find($=>$.ssrc===(x==null?void 0:x.ssrcs[0].ssrcId));if(H){const $=r.getLocalVideoSize(),_t=r.getEncoderConfig(l_.LocalVideoTrack);var f;(H.codec==="H264"||H.codec==="H265"||H.codec==="VP8"||H.codec==="VP9"||H.codec==="AV1X"||H.codec==="AV1")&&(C.codecType=H.codec,(b==null?void 0:b.codecType)!==H.codec&&((f=this.onVideoCodecChanged)===null||f===void 0||f.call(this,H.codec.toLocaleLowerCase()))),C.sendBytes=H.bytes,C.sendBitrate=b?8*Math.max(0,C.sendBytes-b.sendBytes):0,H.inputFrame?(C.captureFrameRate=H.inputFrame.frameRate,C.captureResolutionHeight=H.inputFrame.height,C.captureResolutionWidth=H.inputFrame.width):$&&(C.captureResolutionWidth=$.width,C.captureResolutionHeight=$.height),H.sentFrame?(C.sendFrameRate=H.sentFrame.frameRate,C.sendResolutionHeight=H.sentFrame.height,C.sendResolutionWidth=H.sentFrame.width):$&&(C.sendResolutionWidth=$.width,C.sendResolutionHeight=$.height),H.avgEncodeMs&&(C.encodeDelay=H.avgEncodeMs),_t&&_t.bitrateMax?C.targetSendBitrate=1e3*_t.bitrateMax:H.targetBitrate&&(C.targetSendBitrate=H.targetBitrate),C.sendPackets=H.packets,C.sendPacketsLost=H.packetsLost,C.sendJitterMs=H.jitterMs,C.sendRttMs=H.rttMs,C.totalDuration=b?b.totalDuration+1:1,C.totalFreezeTime=b?b.totalFreezeTime:0,this.isLocalVideoFreeze(H)&&(C.totalFreezeTime+=1),H.scalabilityMode&&this.scalabilityMode!==H.scalabilityMode&&(Wt.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(H.scalabilityMode)),this.scalabilityMode=H.scalabilityMode)}this.trafficStats&&(C.currentPacketLossRate=(this.trafficStats.B_pvlr4||0)/100)}var g;this.localStats.set(d,C),((b==null?void 0:b.sendResolutionWidth)!==C.sendResolutionWidth||(b==null?void 0:b.sendResolutionHeight)!==C.sendResolutionHeight)&&((g=this.onStatsChanged)===null||g===void 0||g.call(this,"resolution",{width:C.sendResolutionWidth,height:C.sendResolutionHeight})),C&&x&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,x.track,C);break}case l_.LocalAudioTrack:{const b=h,C=TI({},_F),P=r.getStats(),x=r.getLocalMedia(d);if(P){const H=P.audioSend.find($=>$.ssrc===(x==null?void 0:x.ssrcs[0].ssrcId));if(H){if(H.codec!=="opus"&&H.codec!=="aac"&&H.codec!=="PCMU"&&H.codec!=="PCMA"&&H.codec!=="G722"||(C.codecType=H.codec),H.inputLevel)C.sendVolumeLevel=Math.round(32767*H.inputLevel);else{const $=r.getLocalAudioVolume();$&&(C.sendVolumeLevel=Math.round(32767*$))}C.sendBytes=H.bytes,C.sendPackets=H.packets,C.sendPacketsLost=H.packetsLost,C.sendJitterMs=H.jitterMs,C.sendRttMs=H.rttMs,C.sendBitrate=b?8*Math.max(0,C.sendBytes-b.sendBytes):0}}this.trafficStats&&(C.currentPacketLossRate=(this.trafficStats.B_palr4||0)/100),this.localStats.set(l_.LocalAudioTrack,C),C&&x&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,x.track,C);break}}})}updateRemoteStats(r){Array.from(this.remoteStats.entries()).forEach(i=>{var d,h;let[f,{videoStats:g,audioStats:b,videoPcStats:C}]=i;const P=b,x=g,H=C,$=TI({},J4),_t=TI({},X4),_i=TI({},dlt),{audioTrack:ue,videoTrack:_r,audioSSRC:Fi,videoSSRC:Di}=r.getRemoteMedia(f);let Js;Js=this.store.useP2P?r.getStats(!0):r.getStats();const _l=(d=Js)===null||d===void 0?void 0:d.audioRecv.find(r_=>r_.ssrc===Fi),_u=(h=Js)===null||h===void 0?void 0:h.videoRecv.find(r_=>r_.ssrc===Di),ga=this.trafficStats&&this.trafficStats.peer_delay.find(r_=>r_.peer_uid===f);if(_l&&(_l.codec!=="opus"&&_l.codec!=="aac"&&_l.codec!=="PCMU"&&_l.codec!=="PCMA"&&_l.codec!=="G722"||($.codecType=_l.codec),_l.outputLevel?$.receiveLevel=Math.round(32767*_l.outputLevel):ue&&($.receiveLevel=Math.round(32767*ue.getVolumeLevel())),$.receiveBytes=_l.bytes,$.receivePackets=_l.packets,$.receivePacketsLost=_l.packetsLost,$.receivePacketsDiscarded=_l.packetsDiscarded,$.packetLossRate=$.receivePacketsLost/($.receivePackets+$.receivePacketsLost),$.receiveBitrate=P?8*Math.max(0,$.receiveBytes-P.receiveBytes):0,$.totalDuration=P?P.totalDuration+1:1,$.totalFreezeTime=P?P.totalFreezeTime:0,$.freezeRate=$.totalFreezeTime/$.totalDuration,$.receiveDelay=_l.jitterBufferMs,$.totalDuration>10&&oP.isRemoteAudioFreeze(ue)&&($.totalFreezeTime+=1)),_u){var _m;_u.codec!=="H264"&&_u.codec!=="H265"&&_u.codec!=="VP8"&&_u.codec!=="VP9"&&_u.codec!=="AV1X"&&_u.codec!=="AV1"||(_t.codecType=_u.codec),_t.receiveBytes=_u.bytes,_t.receiveBitrate=x?8*Math.max(0,_t.receiveBytes-x.receiveBytes):0,_t.decodeFrameRate=_u.decodeFrameRate<0?0:_u.decodeFrameRate,_t.renderFrameRate=_u.decodeFrameRate<0?0:_u.decodeFrameRate,_u.outputFrame&&(_t.renderFrameRate=_u.outputFrame.frameRate),_u.receivedFrame?(_t.receiveFrameRate=_u.receivedFrame.frameRate,_t.receiveResolutionHeight=_u.receivedFrame.height,_t.receiveResolutionWidth=_u.receivedFrame.width):_r&&(_t.receiveResolutionHeight=_r._videoHeight||0,_t.receiveResolutionWidth=_r._videoWidth||0),_u.framesRateFirefox!==void 0&&(_t.receiveFrameRate=Math.round(_u.framesRateFirefox)),_t.receivePackets=_u.packets,_t.receivePacketsLost=_u.packetsLost,_t.packetLossRate=_t.receivePacketsLost/(_t.receivePackets+_t.receivePacketsLost);const r_=x?x.totalFreezeTime:0,a_=x?x.totalDuration:0;_t.totalDuration=x?x.totalDuration+1:1,_t.totalFreezeTime=(_m=_u.totalFreezesDuration)!==null&&_m!==void 0?_m:r_||0,_t.receiveDelay=_u.jitterBufferMs||0;const p_=!!Di&&r.getRemoteVideoIsReady(Di);_u.totalFreezesDuration===void 0&&_r&&p_&&oP.isRemoteVideoFreeze(_r,_u,H)&&(_t.totalFreezeTime+=1),_t.freezeRate=Math.max(0,Math.min((_t.totalFreezeTime-r_)/(_t.totalDuration-a_),1))}ga&&($.end2EndDelay=ga.B_ad,_t.end2EndDelay=ga.B_vd,$.transportDelay=ga.B_ed,_t.transportDelay=ga.B_ed,$.currentPacketLossRate=ga.B_ealr4/100,_t.currentPacketLossRate=ga.B_evlr4/100,_i.uplinkNetworkQuality=ga.B_punq?ga.B_punq:0,_i.downlinkNetworkQuality=ga.B_pdnq?ga.B_pdnq:0),this.remoteStats.set(f,{audioStats:$,videoStats:_t,videoPcStats:_u,networkStats:_i}),ue&&this.exceptionMonitor.setRemoteAudioStats(ue,$),_r&&this.exceptionMonitor.setRemoteVideoStats(_r,_t)})}}class iX{constructor(){Ei(this,"destChannelMediaInfos",new Map),Ei(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(r){hJ(r),this.srcChannelMediaInfo=r}addDestChannelInfo(r){hJ(r),this.destChannelMediaInfos.set(r.channelName,r)}removeDestChannelInfo(r){JL(r),this.destChannelMediaInfos.delete(r)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function oX(e){if(!(e instanceof iX))return new t_(Gi.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const r=e.getSrcChannelMediaInfo(),i=e.getDestChannelMediaInfo();if(!r)return new t_(Gi.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(i.size===0)return new t_(Gi.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class U0{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio||this._audio_pre_subscribed)return this._audioTrack}get videoTrack(){if(this.hasVideo||this._video_pre_subscribed)return this._videoTrack}get dataChannels(){return this._dataChannels}constructor(r,i){Ei(this,"uid",void 0),Ei(this,"_uintid",void 0),Ei(this,"_trust_in_room_",!0),Ei(this,"_trust_audio_enabled_state_",!0),Ei(this,"_trust_video_enabled_state_",!0),Ei(this,"_trust_audio_mute_state_",!0),Ei(this,"_trust_video_mute_state_",!0),Ei(this,"_audio_muted_",!1),Ei(this,"_video_muted_",!1),Ei(this,"_audio_enabled_",!0),Ei(this,"_video_enabled_",!0),Ei(this,"_audio_added_",!1),Ei(this,"_video_added_",!1),Ei(this,"_is_pre_created",!1),Ei(this,"_video_pre_subscribed",!1),Ei(this,"_audio_pre_subscribed",!1),Ei(this,"_trust_video_stream_added_state_",!0),Ei(this,"_trust_audio_stream_added_state_",!0),Ei(this,"_audioTrack",void 0),Ei(this,"_videoTrack",void 0),Ei(this,"_dataChannels",[]),Ei(this,"_audioSSRC",void 0),Ei(this,"_videoSSRC",void 0),Ei(this,"_audioOrtc",void 0),Ei(this,"_videoOrtc",void 0),Ei(this,"_cname",void 0),Ei(this,"_rtxSsrcId",void 0),Ei(this,"_videoMid",void 0),Ei(this,"_audioMid",void 0),this.uid=r,this._uintid=i}}function sX(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function cG(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?sX(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):sX(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}const d1="9",uG=2e4,l1=4e4;function aX(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function c0(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?aX(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):aX(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}var GO=function(e){return e[e.DOWN=0]="DOWN",e[e.UP=1]="UP",e}(GO||{});const h1=new Map;function cX(e,r,i,d){let{scale:h}=e;if(h===0&&d===GO.UP||h>=r.length-1&&d===GO.DOWN)return e;let f=c0(c0({},e),{},{scale:d===GO.DOWN?++h:--h});switch(i){case"maintain-framerate":f=c0(c0({},f),r[h].motion);break;case"maintain-resolution":f=c0(c0({},f),r[h].detail);break;case"balanced":f=c0(c0({},f),r[h].balanced)}return f}function uX(e,r){if(r){const i={overUse:0,underUse:0,adaptationList:dX(r)};h1.set(e,i)}else h1.delete(e)}function dX(e){const r=c0({},e),{bitrateMax:i,frameRate:d,scaleResolutionDownBy:h,bitrateMin:f}=r,{MIN_FRAME_RATE:g,MAX_THRESHOLD_FRAMERATE:b,MAX_SCALE:C,BITRATE_MIN_THRESHOLD:P,BITRATE_MAX_THRESHOLD:x,BWE_SCALE_UP_THRESHOLD:H,BWE_SCALE_DOWN_THRESHOLD:$,PERF_SCALE_DOWN_THRESHOLD:_t,PERF_SCALE_UP_THRESHOLD:_i,BALANCE_BITRATE_FACTOR:ue,BALANCE_FRAMERATE_FACTOR:_r,BALANCE_RESOLUTION_FACTOR:Fi,MOTION_RESOLUTION_FACTOR:Di,MOTION_BITRATE_FACTOR:Js,DETAIL_FRAMERATE_FACTOR:_l,DETAIL_BITRATE_FACTOR:_u}=cF,ga=Math.min(r.frameRate,b),_m=[{scale:0,threshold:{bwe_down:Math.round(Math.pow($,1)*i),bwe_up:i,fps_down:Math.round(Math.pow(_t,1)*ga),fps_up:d},balanced:{scaleResolutionDownBy:1,frameRate:d,bitrateMax:i,bitrateMin:f},motion:{scaleResolutionDownBy:1,frameRate:d,bitrateMax:i,bitrateMin:f},detail:{scaleResolutionDownBy:1,frameRate:d,bitrateMax:i,bitrateMin:f}}];for(let r_=1;r_<=C;r_++){const a_={bwe_up:Math.round(Math.pow(H,r_)*i),bwe_down:Math.round(Math.pow($,r_+1)*i),fps_up:Math.round(Math.pow(_i,r_)*ga),fps_down:Math.round(Math.pow(_t,r_+1)*ga)},p_={scaleResolutionDownBy:h/Math.pow(Fi,r_),frameRate:Math.max(Math.round(Math.pow(_r,r_)*d),g),bitrateMax:Math.max(Math.round(Math.pow(ue,r_)*i),x),bitrateMin:Math.max(Math.round(Math.pow(ue,r_)*f),P)},Q_={scaleResolutionDownBy:h/Math.pow(Di,r_),frameRate:d,bitrateMax:Math.max(Math.round(Math.pow(Js,r_)*i),x),bitrateMin:Math.max(Math.round(Math.pow(Js,r_)*f),P)},$_={scaleResolutionDownBy:1,frameRate:Math.max(Math.round(Math.pow(_l,r_)*d),g),bitrateMax:Math.max(Math.round(Math.pow(_u,r_)*i),x),bitrateMin:Math.max(Math.round(Math.pow(_u,r_)*f),P)};_m.push({scale:r_,threshold:a_,balanced:p_,motion:Q_,detail:$_})}return _m}function Aht(e,r,i,d,h,f){const g=h1.get(e)||{overUse:0,underUse:0,adaptationList:dX(h)},{adaptationList:b}=g;h1.set(e,g);const{OVERUSE_TIMES_THRESHOLD:C,UNDERUSE_TIMES_THRESHOLD:P}=cF,{scale:x}=d;let H,$;return typeof r=="number"&&r>0&&function(_t,_i,ue,_r){if(_i>=ue.length)return!1;let{threshold:{fps_down:Fi}}=ue[_i];return _s("FORCE_AG_HIGH_FRAMERATE")&&_r==="maintain-framerate"&&(Fi=ue[0].threshold.fps_down),_t<Fi}(r,x,b,f)&&(g.overUse++,$=GN.CPU,g.overUse>C)||typeof i=="number"&&i>0&&function(_t,_i,ue){if(_i>=ue.length)return!1;const{threshold:{bwe_down:_r}}=ue[_i];return _t<_r}(i,x,b)&&(g.overUse++,$=GN.BANDWIDTH,g.overUse>C)?(g.overUse=0,g.underUse=0,H=cX(d,b,f,GO.DOWN),[H,$]):(typeof r=="number"&&r>0&&typeof i=="number"&&i>0&&function(_t,_i,ue,_r){if(_i===0)return;let{threshold:{fps_up:Fi}}=ue[_i];return _s("FORCE_AG_HIGH_FRAMERATE")&&_r==="maintain-framerate"&&(Fi=ue[1].threshold.fps_up),_t>Fi}(r,x,b,f)&&function(_t,_i,ue){if(_i===0)return;const{threshold:{bwe_up:_r}}=ue[_i];return _t>_r}(i,x,b)&&(g.underUse++,g.underUse>P&&(g.overUse=0,g.underUse=0,H=cX(d,b,f,GO.UP),H.scale===0&&($=GN.NONE))),[H,$])}function lX(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function dG(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?lX(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):lX(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}const p1=new Map;function f1(e,r){const i=p1.get(e);if(i){const{timer:d}=i;window.clearTimeout(d),p1.delete(e)}r.qualityLimitationReason=GN.NONE,uX(e)}function Oht(e,r){var i;let d;switch(r){case l_.LocalAudioTrack:d=gE.Audio;break;case l_.LocalVideoTrack:d=E_(i=e._hints).call(i,wE.SCREEN_TRACK)?gE.Screen:gE.High;break;case l_.LocalVideoLowTrack:d=gE.Low}return d}function lG(e){const r=uE();if(e.some(i=>i._bypassWebAudio))throw new n_(Gi.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");if(!r.webAudioMediaStreamDest)throw new n_(Gi.NOT_SUPPORTED,"cannot publish multiple tracks because your browser does not support audio mixing")}function hG(e,r){lG(e);const i=new eS;return e.forEach(d=>i.addAudioTrack(d)),i}const Nht=!uE().supportUnifiedPlan||_s("CHROME_FORCE_PLAN_B")&&n0();function m1(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};var i;return Nht?(i={spec:r,store:e},a0("PlanBConnection").create(i)):new kT(r,e)}function pG(e){return e&&(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")}function hX(e){try{if(e.iceServers)return!1;if(e.turnServer&&e.turnServer.mode!=="off"){if(jN(e.turnServer.servers))return!1;if(_s("FORCE_TURN_TCP")||e.turnServer.servers.concat(e.turnServer.serversFromGateway||[]).some(r=>r.forceturn))return!0}return!1}catch{return!1}}var sE;function pX(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function TR(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?pX(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):pX(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}let kT=(sE=class xI extends _J{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.send.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return E_(i=Object.keys(WN)).call(i,r)}))]}constructor(r,i){super(r,i),Ei(this,"id",AE(5,"connection-")),Ei(this,"store",void 0),Ei(this,"peerConnection",void 0),Ei(this,"forceTurn",!1),Ei(this,"remoteSDP",void 0),Ei(this,"initialOffer",void 0),Ei(this,"transportEventReceiver",void 0),Ei(this,"statsFilter",void 0),Ei(this,"extension",{useXR:_s("USE_XR")}),Ei(this,"localCapabilities",void 0),Ei(this,"remoteCodecs",void 0),Ei(this,"localCandidateCount",0),Ei(this,"allCandidatesReceived",!1),Ei(this,"isPreallocation",!1),Ei(this,"preMediaMap",new Map),Ei(this,"dataStreamChannelMap",new Map),Ei(this,"establishPromise",void 0),Ei(this,"recoveredDataChannelIds",[]),Ei(this,"currentDataChannelId",1),Ei(this,"supportAV1RtpSpec",!1),Ei(this,"mutex",void 0),Ei(this,"qualityLimitationReason",GN.NONE),Ei(this,"isFirstConnected",!1),this.store=i,this.forceTurn=hX(r),this.mutex=new wS("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(xI.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.isFirstConnected=!1,this.statsFilter=oF(this.peerConnection,_s("STATS_UPDATE_INTERVAL"),void 0,KE()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,r.isPreallocation&&(this.isPreallocation=!0),this.establishPromise=this.establish()}getPreMedia(r){return this.preMediaMap.get(r)}isPreSub(){return this.preMediaMap.size>0}async updateRemoteRTPCapabilities(r,i){if(this.remoteCodecs=i,!this.remoteSDP)return void Wt.debug("[P2PConnection] cannot updateRemoteRTPCapabilities before remote SDP created, local codecs: ".concat(this.localCodecs,", codecs: ").concat(i));if(this.remoteSDP.updateRemoteCodec(r,i,this.store.codec)){const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(d);const f=this.remoteSDP.toString();h==null||h(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}else Wt.debug("[P2PConnection] updateRemoteRTPCapabilities no need to exchange SDP.")}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const d=await this.peerConnection.createOffer();if(!d.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const h=k0(d.sdp),f=await MJ({filterRTX:!_s("USE_PUB_RTX")&&!_s("USE_SUB_RTX"),filterVideoFec:_s("FILTER_VIDEO_FEC"),filterAudioFec:_s("FILTER_AUDIO_FEC"),filterVideoCodec:_s("FILTER_VIDEO_CODEC"),unsupportedVideoUplinkCodec:_s("UNSUPPORTED_VIDEO_UPLINK_CODEC"),unsupportedVideoDownlinkCodec:_s("UNSUPPORTED_VIDEO_DOWNLINK_CODEC")},this.extension);if(this.localCapabilities=o1(f),this.initialOffer=d,_s("ENABLE_SVC")&&this.store.codec=="av1"){const b=await async function(){try{const C=new RTCPeerConnection;C.addTransceiver("video",{direction:"sendonly",sendEncodings:[{scalabilityMode:OL.L1T3}]});const P=await C.createOffer();if(!P.sdp)return void C.close();const x=$S(P.sdp).mediaDescriptions[0];if(!x)return;const H=x.attributes.extmaps.find($=>$.extensionName==="https://aomediacodec.github.io/av1-rtp-spec/#dependency-descriptor-rtp-header-extension");return C.close(),H}catch{return}}();var r;b&&(this.supportAV1RtpSpec=!0,(r=f.send)===null||r===void 0||r.videoExtensions.push(b))}let g;return d.sdp&&jJ(d.sdp)&&(g=BE(f),(i=g).send&&(UO(A_.VIDEO,i.send.videoExtensions),UO(A_.AUDIO,i.send.audioExtensions)),i.recv&&(UO(A_.VIDEO,i.recv.videoExtensions),UO(A_.AUDIO,i.recv.audioExtensions)),i.sendrecv&&(UO(A_.VIDEO,i.sendrecv.videoExtensions),UO(A_.AUDIO,i.sendrecv.audioExtensions))),TR(TR({},h),{},{rtpCapabilities:g||f,offerSDP:d.sdp})}catch(d){throw new n_(Gi.GET_LOCAL_CONNECTION_PARAMS_FAILED,d.toString())}var i}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.initialOffer.sdp&&jJ(this.initialOffer.sdp)&&(i=r.rtpCapabilities,d=this.localCapabilities,i.send&&(n1(A_.VIDEO,i.send.videoExtensions,d.send.videoExtensions),n1(A_.AUDIO,i.send.audioExtensions,d.send.audioExtensions)),i.recv&&(n1(A_.VIDEO,i.recv.videoExtensions,d.recv.videoExtensions),n1(A_.AUDIO,i.recv.audioExtensions,d.recv.audioExtensions))),this.remoteSDP=new class{get localCapabilities(){return BE(this._localCapabilities)}get rtpCapabilities(){return BE(this._rtpCapabilities)}get candidates(){return BE(this._candidates)}get iceParameters(){return BE(this._iceParameters)}get dtlsParameters(){return BE(this._dtlsParameters)}constructor(C){let P=arguments.length>1&&arguments[1]!==void 0&&arguments[1],x=arguments.length>2&&arguments[2]!==void 0&&arguments[2];Ei(this,"sessionDesc",void 0),Ei(this,"_localCapabilities",void 0),Ei(this,"_rtpCapabilities",void 0),Ei(this,"_candidates",void 0),Ei(this,"_originCandidates",void 0),Ei(this,"_iceParameters",void 0),Ei(this,"_isUseExtmapAllowMixed",void 0),Ei(this,"_isUseLocalCodecs",void 0),Ei(this,"_dtlsParameters",void 0),Ei(this,"setup",void 0),Ei(this,"currentMidIndex",void 0),Ei(this,"cname",void 0),Ei(this,"useLocalCodecsMids",[]),Ei(this,"preloadSsrcs",[]),Ei(this,"firefoxSsrcMidMap",new Map),this._isUseExtmapAllowMixed=P,this._isUseLocalCodecs=x,C=BE(C);const{iceParameters:H,dtlsParameters:$,candidates:_t,rtpCapabilities:_i,setup:ue,localCapabilities:_r,cname:Fi}=C;this._rtpCapabilities=_i,this._candidates=_t,this._originCandidates=BE(_t),this._iceParameters=H,this._dtlsParameters=$,this._localCapabilities=_r,this.setup=ue,this.cname=Fi,[this.sessionDesc]=this.updateRemoteRTPCapabilities(_i),this.currentMidIndex=this.sessionDesc.mediaDescriptions.length-1}checkPreloadSsrcs(C){return C.length===this.preloadSsrcs.length&&C.every(P=>{var x;return E_(x=this.preloadSsrcs).call(x,P)})}preloadRemoteMedia(C){let P=0;const x=[],H=[];for(;C>0;){const $=[cG({ssrcId:l1+P},_s("USE_SUB_RTX")?{rtx:l1+P+1}:{})],_t="".concat(l1+P,"_").concat(uG+P),{ssrcs:_i,ssrcGroups:ue}=eP($,this.cname,_s("SYNC_GROUP")?_t:void 0),_r=this.preCreateOrRecycleSendMedia("video",_i,ue,void 0),Fi=[{ssrcId:uG+P}],Di="".concat(l1+P,"_").concat(uG+P),{ssrcs:Js,ssrcGroups:_l}=eP(Fi,this.cname,_s("SYNC_GROUP")?Di:void 0),_u=this.preCreateOrRecycleSendMedia("audio",Js,_l,void 0);C--,P+=2,x.push(_r,_u),H.push(_i[0].ssrcId,Js[0].ssrcId)}return this.useLocalCodecsMids.push(...x),this.preloadSsrcs=H,{mids:x,preSSRCs:H,isAvailable:!0}}preCreateOrRecycleSendMedia(C,P,x,H){const $=this.rtpCapabilities.send.videoCodecs,_t=this._isUseLocalCodecs||$.length===0?this.localCapabilities.recv:this.rtpCapabilities.send;Wt.debug("create or recycle send media without remote rtp capabilities, ssrcs ",P[0].ssrcId);const _i=C===A_.VIDEO?_t.videoCodecs:_t.audioCodecs,ue=C===A_.VIDEO?_t.videoExtensions:_t.audioExtensions;this.currentMidIndex+=1;const _r="".concat(this.currentMidIndex);let Fi={media:{mediaType:C,port:d1,protos:["UDP","TLS","RTP","SAVPF"],fmts:_i.map(Di=>Di.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:ue,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:x,rtcpFeedbackWildcards:[],payloads:_i,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(_r)}};return Fi=this.mungSendMediaDesc(Fi,H),this.sessionDesc.mediaDescriptions.push(Fi),this.updateBundleMids(),_r}toString(){return C0(this.sessionDesc)}send(C,P,x,H){const{ssrcs:$,ssrcGroups:_t}=eP(P,this.cname,_s("SYNC_GROUP")?x:void 0),_i=this.findPreloadMediaDesc($);if(_i){if(KE()&&this.firefoxSsrcMidMap.set($[0].ssrcId,_i.attributes.mid),H&&(H.twcc||H.remb)){const ue=this.sessionDesc.mediaDescriptions.indexOf(_i);return this.sessionDesc.mediaDescriptions[ue]=this.mungSendMediaDesc(_i,H),{mid:_i.attributes.mid,needExchangeSDP:!0}}return{mid:_i.attributes.mid,needExchangeSDP:!1}}{const ue=this.findAvailableMediaIndex(C,$);let _r;return ue===-1||ue===1&&(yS()||function(){const Fi=oE();return!(Fi.name!==hE.CHROME||!Fi.osVersion)&&Number(Fi.version)<=90}()||_s("ENABLE_ENCODED_TRANSFORM")&&e0())||ue===0&&!function(Fi){const Di=oE();return!(Di.name!==hE.FIREFOX||!Di.osVersion)&&Number(Di.version)===Fi}(138)&&_s("USE_SUB_RTX")||c4()?(_r=this.createOrRecycleSendMedia(C,$,_t,"sendonly",H),this.updateBundleMids()):(_r=BE(this.sessionDesc.mediaDescriptions[ue]),_r.attributes.direction="sendonly",_r.attributes.ssrcs=$,_r.attributes.ssrcGroups=_t,this.sessionDesc.mediaDescriptions[ue]=this.mungSendMediaDesc(_r,H)),KE()&&this.firefoxSsrcMidMap.set($[0].ssrcId,_r.attributes.mid),{mid:_r.attributes.mid,needExchangeSDP:!0}}}sendDataChannel(){const{mediaDesc:C,needExchangeSDP:P}=this.createOrRecycleDataChannel();return this.updateBundleMids(),{mid:C.attributes.mid,needExchangeSDP:P}}batchSend(C){const P=C.map($=>{let{kind:_t,ssrcMsg:_i,mslabel:ue}=$;return this.send(_t,_i,ue)}),x=[];let H=!1;return P.forEach($=>{let{mid:_t,needExchangeSDP:_i}=$;_i&&(H=!0),x.push(_t)}),{mids:x,needExchangeSDP:H}}stopSending(C){const P=this.sessionDesc.mediaDescriptions.filter(x=>x.attributes.mid&&C.indexOf(x.attributes.mid)!==-1);if(P.length!==C.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");P.forEach(x=>{x.attributes.mid==="0"||KE()||c4()?x.attributes.ssrcs=[]:(x.attributes.ssrcs=[],x.attributes.direction="inactive",x.media.port="0")}),this.updateBundleMids()}mute(C){const P=this.sessionDesc.mediaDescriptions.find(x=>x.attributes.mid===C);if(!P)throw new Error("mediaDescription not found with ".concat(C," in remote SDP when calling RemoteSDP.mute."));P.attributes.direction="inactive"}unmute(C){const P=this.sessionDesc.mediaDescriptions.find(x=>x.attributes.mid===C);if(!P)throw new Error("mediaDescription not found with ".concat(C," in remote SDP when calling RemoteSDP.unmute."));P.attributes.direction="sendonly"}muteRemote(C){const P=this.sessionDesc.mediaDescriptions.filter(x=>E_(C).call(C,x.attributes.mid||""));if(P.length!==C.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(x=>{x.attributes.direction="inactive"})}unmuteRemote(C){const P=this.sessionDesc.mediaDescriptions.filter(x=>E_(C).call(C,x.attributes.mid||""));if(P.length!==C.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");P.forEach(x=>{x.attributes.direction="recvonly"})}receive(C,P,x,H){C.forEach(($,_t)=>{this.createOrRecycleRecvMedia($,[],"recvonly",P,x,H[_t])}),this.updateBundleMids()}stopReceiving(C){const P=this.sessionDesc.mediaDescriptions.filter(x=>C.indexOf(x.attributes.mid)!==-1);if(P.length!==C.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");P.forEach(x=>{x.media.port="0",x.attributes.direction="inactive"}),this.updateBundleMids()}updateRemoteRTPCapabilities(C){const P=this.sessionDesc||$S((x=this._isUseExtmapAllowMixed,`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite`.concat(x?`
a=extmap-allow-mixed`:"",`
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`)));var x;this._rtpCapabilities=C;let H=!1;const $=this.rtpCapabilities.send,_t=this.localCapabilities.send,_i=this.localCapabilities.recv,ue=_i.videoCodecs,_r=_i.audioCodecs,Fi=_i.videoExtensions,Di=_i.audioExtensions;for(const ga of P.mediaDescriptions){var Js;if(ga.attributes.direction!=="sendonly"||typeof ga.attributes.mid!="string"||!E_(Js=this.useLocalCodecsMids).call(Js,ga.attributes.mid)){if(H=!0,ga.attributes.iceUfrag=this._iceParameters.iceUfrag,ga.attributes.icePwd=this._iceParameters.icePwd,ga.attributes.fingerprints=this._dtlsParameters.fingerprints,ga.attributes.candidates=this._candidates,ga.attributes.setup=this.setup,ga.media.mediaType==="application"&&(ga.attributes.sctpPort="5000"),ga.media.mediaType==="video")if(this._isUseLocalCodecs&&ga.attributes.direction==="sendonly"){var _l;ga.media.fmts=ue.map(r_=>r_.payloadType.toString(10)),ga.attributes.payloads=ue,ga.attributes.extmaps=Fi;const _m=ga.attributes.mid;typeof _m!="string"||E_(_l=this.useLocalCodecsMids).call(_l,_m)||this.useLocalCodecsMids.push(_m)}else if($.videoCodecs.length===0){const _m=_t.videoCodecs.filter(r_=>{var a_,p_;return(a_=r_.rtpMap)===null||a_===void 0?void 0:E_(p_=a_.encodingName.toLowerCase()).call(p_,"vp8")})||[_t.videoCodecs[0]];ga.media.fmts=_m.map(r_=>r_.payloadType.toString(10)),ga.attributes.payloads=_m,ga.attributes.extmaps=[]}else ga.media.fmts=$.videoCodecs.map(_m=>_m.payloadType.toString(10)),ga.attributes.payloads=$.videoCodecs,ga.attributes.extmaps=$.videoExtensions;if(ga.media.mediaType==="audio")if(this._isUseLocalCodecs&&ga.attributes.direction==="sendonly"){var _u;ga.media.fmts=_r.map(r_=>r_.payloadType.toString(10)),ga.attributes.payloads=_r,ga.attributes.extmaps=Di;const _m=ga.attributes.mid;typeof _m!="string"||E_(_u=this.useLocalCodecsMids).call(_u,_m)||this.useLocalCodecsMids.push(_m)}else if($.audioCodecs.length===0){const _m=_t.audioCodecs.filter(r_=>{var a_,p_;return(a_=r_.rtpMap)===null||a_===void 0?void 0:E_(p_=a_.encodingName.toLowerCase()).call(p_,"opus")})||[_t.audioCodecs[0]];ga.media.fmts=_m.map(r_=>r_.payloadType.toString(10)),ga.attributes.payloads=_m,ga.attributes.extmaps=[]}else ga.media.fmts=$.audioCodecs.map(_m=>_m.payloadType.toString(10)),ga.attributes.payloads=$.audioCodecs,ga.attributes.extmaps=$.audioExtensions,jO(ga)}}return this.sessionDesc=P,this.currentMidIndex=P.mediaDescriptions.length-1,[this.sessionDesc,H]}updateCandidates(C){const P=this._originCandidates.filter(H=>H.transport==="udp"),x=[];if(P.forEach(H=>{x.push(cG(cG({},H),{},{foundation:"tcpcandidate",priority:Number(H.priority)-1+"",transport:"tcp",port:Number(H.port)+90+""}))}),P.length!==0){switch(C){case OS.TCP_RELAY:this._candidates=x;break;case OS.UDP_TCP_RELAY:case OS.RELAY:this._candidates=[...P,...x];break;default:this._candidates=P}for(const H of this.sessionDesc.mediaDescriptions)H.attributes.candidates=this.candidates}}restartICE(C){C=BE(C),this._iceParameters=C,this.sessionDesc.mediaDescriptions.forEach(P=>{P.attributes.iceUfrag=C.iceUfrag,P.attributes.icePwd=C.icePwd})}predictReceivingMids(C){const P=[];for(let x=0;x<C;x++)P.push((this.currentMidIndex+x+1).toString(10));return P}findAvailableMediaIndex(C,P){return this.sessionDesc.mediaDescriptions.findIndex(x=>{const H=x.media.mediaType===C&&x.media.port!=="0"&&(x.attributes.direction==="sendonly"||x.attributes.direction==="sendrecv")&&x.attributes.ssrcs.length===0;if(KE()){if(H){const $=this.firefoxSsrcMidMap.get(P[0].ssrcId);return!($||x.attributes.mid!=="0"&&x.attributes.mid!=="1")||!(!$||$!==x.attributes.mid)}return!1}return H})}createOrRecycleDataChannel(){for(const x of this.sessionDesc.mediaDescriptions)if(x.media.mediaType==="application")return{mediaDesc:x,needExchangeSDP:!1};this.currentMidIndex+=1;const C="".concat(this.currentMidIndex),P={media:{mediaType:"application",port:d1,protos:["UDP","DTLS","SCTP"],fmts:["webrtc-datachannel"]},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:[],fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[],rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,mid:"".concat(C),sctpPort:"5000"}};return this.sessionDesc.mediaDescriptions.push(P),{mediaDesc:P,needExchangeSDP:!0}}createOrRecycleRecvMedia(C,P,x,H,$,_t){const _i=C._mediaStreamTrack.kind,ue=this.rtpCapabilities.recv,_r=nP(_i,ue,this.localCapabilities.send,_i===A_.VIDEO?H:$),Fi=_i===A_.VIDEO?ue.videoExtensions:ue.audioExtensions;this.currentMidIndex+=1;const Di="".concat(this.currentMidIndex);let Js={media:{mediaType:_i,port:d1,protos:["UDP","TLS","RTP","SAVPF"],fmts:_r.map(_u=>_u.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:Fi,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:_r,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:x,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Di)}};Js=this.mungRecvMediaDsec(Js,C,_t);const _l=this.findFirstClosedMedia(_i);if(_l){const _u=this.sessionDesc.mediaDescriptions.indexOf(_l);this.sessionDesc.mediaDescriptions[_u]=Js}else this.sessionDesc.mediaDescriptions.push(Js);return Js}updateRemoteDtlsParameters(C){const P=new Set(this._dtlsParameters.fingerprints.map($=>$.fingerprint)),x=new Set(C.map($=>$.fingerprint));let H=!1;P.size!==x.size&&(H=!0);for(const $ of P)x.has($)||(H=!0);return H}updateRemoteCodec(C,P,x){const H=[...new Set(this._rtpCapabilities.recv.videoCodecs.map(Js=>Js.rtpMap&&Js.rtpMap.encodingName.toLowerCase()||"").filter(Js=>{var _l;return E_(_l=Object.keys(WN)).call(_l,Js)}))],$=new Set(P);if(H.every(Js=>$.has(Js)))return Wt.debug("codecs has not changed, no need to updateRemoteCodec, codecs: ".concat(P)),!1;const _t=this._rtpCapabilities.recv.videoCodecs.filter(Js=>P.some(_l=>{var _u;return E_(_u=Js.rtpMap&&Js.rtpMap.encodingName.toLowerCase()||"").call(_u,_l)}));if(_t.length===0)return Wt.debug("updateRemoteCodec failed, because cannot find matched codec, remoteCapabilities codecs: ".concat(H," codecs: ").concat(P)),!1;const _i=[...new Set(_t.map(Js=>Js.rtpMap&&Js.rtpMap.encodingName.toLowerCase()||""))];let ue;if(Wt.debug("updateRemoteCodec, from ".concat(H," to ").concat(_i)),C.length===0)ue=this.sessionDesc.mediaDescriptions.filter(Js=>Js.media.mediaType==="video"&&Js.attributes.direction==="recvonly");else if(ue=this.sessionDesc.mediaDescriptions.filter(Js=>Js.attributes.mid&&Js.media.mediaType==="video"&&E_(C).call(C,Js.attributes.mid)&&Js.attributes.direction==="recvonly"),ue.length!==C.length)return Wt.debug("updateRemoteCodec failed, because cannot find mids, mids: ".concat(C,", codecs: ").concat(P)),!1;if(_s("USE_PUB_RTX")||_s("USE_SUB_RTX")){const Js=L0(_t,this.rtpCapabilities.recv.videoCodecs);_t.push(...Js)}this._rtpCapabilities.recv.videoCodecs=_t;const _r=this.localCapabilities.send,Fi=this.rtpCapabilities.recv,Di=nP(A_.VIDEO,Fi,_r,x);return ue.forEach(Js=>{const _l=Di.map(_u=>_u.payloadType.toString(10));Wt.debug("updateRemoteCodec mid: ".concat(Js.attributes.mid,", from"),Js.attributes.payloads,"to",Di),Js.attributes.payloads=Di,Js.media.fmts=_l}),!0}createOrRecycleSendMedia(C,P,x,H,$){const _t=this.rtpCapabilities.send.videoCodecs,_i=this._isUseLocalCodecs||_t.length===0?this.localCapabilities.recv:this.rtpCapabilities.send,ue=C===A_.VIDEO?_i.videoCodecs:_i.audioCodecs,_r=C===A_.VIDEO?_i.videoExtensions:_i.audioExtensions;this.currentMidIndex+=1;const Fi="".concat(this.currentMidIndex);let Di={media:{mediaType:C,port:d1,protos:["UDP","TLS","RTP","SAVPF"],fmts:ue.map(_l=>_l.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:_r,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:P,ssrcGroups:x,rtcpFeedbackWildcards:[],payloads:ue,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:H,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(Fi)}};Di=this.mungSendMediaDesc(Di,$);const Js=this.findFirstClosedMedia(C);if(Js){const _l=this.sessionDesc.mediaDescriptions.indexOf(Js);this.sessionDesc.mediaDescriptions[_l]=Di}else this.sessionDesc.mediaDescriptions.push(Di);return Di}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(C=>C.media.port!=="0").map(C=>C.attributes.mid)}mungRecvMediaDsec(C,P,x){const H=BE(C);return XF(H),VO(H,P),QF(H,P),kJ(H),i1(H,x,this.localCapabilities.send),H}mungSendMediaDesc(C,P){const x=BE(C);return i1(x,P,this.localCapabilities.recv),jO(x),x}updateRecvMedia(C,P){const x=this.sessionDesc.mediaDescriptions.findIndex(H=>H.attributes.mid===C);if(x!==-1){const H=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[x],P);this.sessionDesc.mediaDescriptions[x]=H}}bumpMid(C){this.currentMidIndex+=C}findFirstClosedMedia(C){return this.sessionDesc.mediaDescriptions.find(P=>KE()?P.media.port==="0"&&P.media.mediaType===C:P.media.port==="0")}findPreloadMediaDesc(C){return this.sessionDesc.mediaDescriptions.find(P=>{var x;return((x=P.attributes)===null||x===void 0||(x=x.ssrcs[0])===null||x===void 0?void 0:x.ssrcId)===C[0].ssrcId})}getSSRC(C){var P;return(P=this.sessionDesc.mediaDescriptions.find(x=>x.attributes.mid===C))===null||P===void 0?void 0:P.attributes.ssrcs}}(TR(TR({},r),{},{localCapabilities:this.localCapabilities}),this.supportAV1RtpSpec,!(!_s("ENABLE_PRE_SUB_WITH_PRE_PC")||!_s("PRE_USE_LOCAL_CODECS"))&&pF(this.store)),r.preallocation&&(this.isPreallocation=!0),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);const h=this.remoteSDP.toString(),f=UJ(this.initialOffer.sdp,this.extension),g=this.logSDPExchange(f||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),g==null||g(h),await this.peerConnection.setRemoteDescription({type:"answer",sdp:h});const b=this.peerConnection.getTransceivers()[0];if(b!=null&&b.receiver&&this.tryBindTransportEvents(b.receiver),pF(this.store))if(r.preallocation&&_s("ENABLE_PRE_SUB_WITH_PRE_PC")){const C=_s("PRE_SUB_NUM"),{mids:P,preSSRCs:x}=this.remoteSDP.preloadRemoteMedia(C);await M0(this.peerConnection,this.remoteSDP,this.extension),Wt.debug("[".concat(this.store.clientId,"] [P2PConnection] preload media, in pre pc,add preload ssrcs ").concat(x)),this.presetMedia(P,x)}else{const{preSSRCs:C=[]}=r,P=C.map(H=>H.ssrcMsg[0].ssrcId);if(C.length===0)return;const{mids:x}=this.remoteSDP.batchSend(C.map(H=>Object.assign({},H)));await M0(this.peerConnection,this.remoteSDP,this.extension),Wt.debug("[P2PConnection.connect] preload media, after join, add preload ssrcs ".concat(P)),this.presetMedia(x,P)}}catch(h){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(h.toString()))}var i,d}presetMedia(r,i){r.forEach((d,h)=>{this.peerConnection.getTransceivers().forEach(f=>{if(f.mid!=null&&d===f.mid&&f.receiver.track){const g=f.receiver.track;let b;g.kind==="video"&&_s("ENABLE_PRE_RENDER")&&(b=new wF({trackId:"track-".concat(g.kind,"-unknown-").concat(this.store.clientId,"_").concat(AE(5,""))},!0),b.updateVideoTrack(g),b.onFirstVideoFrameRender=()=>{var C;const P=this.preMediaMap.get(i[h]);P&&(P.firstVideoRender=Date.now()),(C=this.onFirstVideoRender)===null||C===void 0||C.call(this,i[h])},b.play(this.store.sessionId||void 0)),this.preMediaMap.set(i[h],{mid:d,track:g,player:b,transceiver:f})}}),this.store.peerReceiver()})}checkDtlsParameters(r){return!!this.remoteSDP&&r.length>0&&this.remoteSDP.updateRemoteDtlsParameters(r)}async updateRemoteConnect(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateRemoteConnect before remote SDP created");let i=!1;const{rtpCapabilities:d}=r;if([,i]=this.remoteSDP.updateRemoteRTPCapabilities(d),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0){const g=this.remoteSDP.updateRemoteCodec([],this.remoteCodecs,this.store.codec);i=i||g}const{preSSRCs:h=[]}=r,f=h.map(g=>g.ssrcMsg[0].ssrcId);if(!this.remoteSDP.checkPreloadSsrcs(f)){const g=[],b=[];if(Array.from(this.preMediaMap.entries()).every(C=>{let[P,{mid:x,player:H,track:$}]=C;return g.push(x),b.push(P),this.preMediaMap.delete(P),H&&H.destroy(),!0}),g.length>0&&(this.remoteSDP.stopSending(g),await M0(this.peerConnection,this.remoteSDP,this.extension),Wt.warn("[P2PConnection.updateRemoteConnect] preload media, failed, del preload ssrcs ".concat(b)),k_.reportApiInvoke(this.store.sessionId,{name:QE.PRELOAD_MEDIA_FAILED,options:[h,b],tag:FE.TRACER}).onSuccess()),h.length>0){const{mids:C}=this.remoteSDP.batchSend(h.map(P=>Object.assign({},P)));await M0(this.peerConnection,this.remoteSDP,this.extension),Wt.debug("[P2PConnection.updateRemoteConnect] preload media, after join, add preload ssrcs ".concat(f)),this.presetMedia(C,f)}}i?(await M0(this.peerConnection,this.remoteSDP,this.extension),Wt.debug("[P2PConnection] updateRemoteConnect by exchanging SDP.")):Wt.debug("[P2PConnection] updateRemoteConnect no need to exchange SDP, because no need to update remote codecs (use local codecs)")}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.updateRemoteConnect failed; ".concat(i.toString()))}}send(r,i,d){var h=this;return CT(function*(){const f=yield cE(h.mutex.lock("From P2PConnection.send"));try{if(!h.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const g=[],b=e1();r.forEach(_r=>{const Fi=h.peerConnection.addTransceiver(_r._mediaStreamTrack,TR({direction:"sendonly"},_r.trackMediaType==="video"&&h.supportAV1RtpSpec&&b?{sendEncodings:[{scalabilityMode:b}]}:{}));g.push(Fi),_r._updateRtpTransceiver(Fi)}),KE()&&_s("SIMULCAST")===!0&&(yield cE(h.applySimulcastForFirefox(g,r)));const C=yield cE(h.peerConnection.createOffer()),P=h.remoteSDP.predictReceivingMids(r.length),x=h.mungSendOfferSDP(C.sdp,r,P),H=$S(x),$=P.map(_r=>{const Fi=H.mediaDescriptions.find(Di=>Di.attributes.mid===_r);if(!Fi)throw new Error("Cannot extract ssrc from mediaDescription.");return NJ(Fi,_s("USE_PUB_RTX"))});let _t;try{_t=yield $}catch(_r){_t=[],h.remoteSDP.receive(r,i,d,_t);const Fi=h.remoteSDP.toString();throw yield cE(h.peerConnection.setLocalDescription({type:"offer",sdp:x})),yield cE(h.peerConnection.setRemoteDescription({type:"answer",sdp:Fi})),yield cE(h.stopSending(P,!0)),_r}h.remoteSDP.receive(r,i,d,_t);const _i=h.remoteSDP.toString(),ue=h.logSDPExchange(x,"offer","local","send");return yield cE(h.peerConnection.setLocalDescription({type:"offer",sdp:x})),yield cE(h.applySimulcastEncodings(g,r)),yield cE(h.applySendEncodings(g,r)),ue==null||ue(_i),yield cE(h.peerConnection.setRemoteDescription({type:"answer",sdp:_i})),g.map((_r,Fi)=>{const Di=P[Fi];return{localSSRC:$[Fi],id:Di,transceiver:_r}})}catch(g){throw g instanceof n_?g:new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(g.toString()))}finally{f()}})()}async createDataChannels(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.createDataChannels before remote SDP created");let d=this.dataStreamChannelMap.get(r);if(d&&d.readyState==="open")Wt.debug("[P2PConnection] Channels are already available and can be reused directly.");else{const f=this.currentDataChannelId<1023?this.currentDataChannelId++:this.recoveredDataChannelIds.shift();if(typeof f!="number")throw new Error("create DataChannel error, because cannot get dc id");d=this.peerConnection.createDataChannel("datastream-channel",{id:f,negotiated:!0,ordered:!1,maxRetransmits:_s("DATASTREAM_MAX_RETRANSMITS")}),d.binaryType="arraybuffer",this.dataStreamChannelMap.set(r,d)}i.forEach(f=>{f._updateOriginDataChannel(d)});const{needExchangeSDP:h}=this.remoteSDP.sendDataChannel();if(h){const f=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:f});const g=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(g),Wt.debug("[P2PConnection] createDataChannels by exchanging SDP.")}else Wt.debug("[P2PConnection] createDataChannels no need to exchange SDP.");return}catch(d){throw d instanceof n_?d:new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.createDataChannels failed; ".concat(d.toString()))}}async stopDataChannels(r){try{const i=this.dataStreamChannelMap.get(r);return i&&(i.id&&this.recoveredDataChannelIds.push(i.id),i.close()),void this.dataStreamChannelMap.delete(r)}catch(i){throw i instanceof n_?i:new n_(Gi.DATACHANNEL_FAILED,"P2PConnection.stopDataChannels failed; ".concat(i.toString()))}}async stopSending(r,i){const d=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const h=this.peerConnection.getTransceivers().filter(C=>r.indexOf(C.mid)!==-1);if(h.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");h.map(C=>{var P;f1(this.id+C.mid,this),C.direction="inactive",(P=C.stop)===null||P===void 0||P.call(C)});const f=await this.peerConnection.createOffer(),g=this.logSDPExchange(f.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(f),this.remoteSDP.stopReceiving(r);const b=this.remoteSDP.toString();g==null||g(b),await this.peerConnection.setRemoteDescription({type:"answer",sdp:b})}catch(h){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(h.toString()))}finally{d&&d()}}async receive(r,i,d,h){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:f,needExchangeSDP:g}=this.remoteSDP.send(r,i,d,h);g&&(await M0(this.peerConnection,this.remoteSDP,this.extension),Wt.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP.")));const b=this.peerConnection.getTransceivers().find(C=>C.mid===f);if(!b)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:b.receiver.track,id:f,transceiver:b}}catch(f){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(f.toString()))}}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:i,needExchangeSDP:d}=this.remoteSDP.batchSend(r);return d&&(await M0(this.peerConnection,this.remoteSDP,this.extension),Wt.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))),i.map(h=>{const f=this.peerConnection.getTransceivers().find(g=>g.mid===h);if(!f)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:f.receiver.track,id:h,transceiver:f}})}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");r.forEach(f=>{Array.from(this.preMediaMap.entries()).some(g=>{let[b,{mid:C,player:P}]=g;if(C===f)return this.preMediaMap.delete(b),P&&P.destroy(),!0})}),this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),d=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const h=await this.peerConnection.createAnswer();d==null||d(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.mute(r);const i=this.remoteSDP.toString(),d=this.logSDPExchange(i,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const h=await this.peerConnection.createAnswer();d==null||d(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(i.toString()))}}async unmuteRemote(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(r," before remote SDP created."));this.remoteSDP.unmute(r);const i=this.remoteSDP.toString(),d=this.logSDPExchange(i,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const h=await this.peerConnection.createAnswer();d==null||d(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(i.toString()))}}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(g=>g.mid&&r.indexOf(g.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(g=>{g.direction="inactive"});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(d),this.remoteSDP.muteRemote(r);const f=this.remoteSDP.toString();h==null||h(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(g=>g.mid&&r.indexOf(g.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async(g,b)=>{g.direction="sendonly"});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(d),this.remoteSDP.unmuteRemote(r),Array.isArray(this.remoteCodecs)&&this.remoteCodecs.length>0&&this.remoteSDP.updateRemoteCodec(r,this.remoteCodecs,this.store.codec);const f=this.remoteSDP.toString();h==null||h(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return CT(function*(){const d=yield cE(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const h=uE().supportPCSetConfiguration,f=_s("FORCE_TURN_TCP")||i.forceTurn;if(r===OS.RELAY&&!h)return;if(h&&!f){const H=r===OS.RELAY?"relay":"all",$=i.peerConnection.getConfiguration();$.iceTransportPolicy!==H&&(Wt.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat($.iceTransportPolicy,"] to [").concat(H,"]")),$.iceTransportPolicy=H,i.peerConnection.setConfiguration($))}i.remoteSDP.updateCandidates(r);const g=yield cE(i.peerConnection.createOffer({iceRestart:!0}));if(!g.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const b=k0(g.sdp),{remoteIceParameters:C}=yield b.iceParameters;i.remoteSDP.restartICE(C);const P=i.remoteSDP.toString(),x=i.logSDPExchange(g.sdp||"","offer","local","restartICE");i.store.descriptionStart(),yield cE(i.peerConnection.setLocalDescription(g)),x==null||x(P),yield cE(i.peerConnection.setRemoteDescription({type:"answer",sdp:P}))}catch(h){Wt.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),h)}finally{d()}})()}async extendCandidate(){if(!this.remoteSDP||this.isFirstConnected)return;const r=await this.mutex.lock("From P2PConnection.extendCandidate");try{this.remoteSDP.updateCandidates(OS.TCP_RELAY),await M0(this.peerConnection,this.remoteSDP,this.extension)}catch(i){Wt.warning("[".concat(this.store.clientId,"] extend candidate failed, abort operation"),i)}finally{r()}}close(){var r;this.peerConnection.getTransceivers().forEach(i=>{f1(this.id+i.mid,this)}),this.preMediaMap.forEach(i=>{let{player:d}=i;d&&d.destroy()}),this.preMediaMap.clear(),this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy(),this.dataStreamChannelMap.clear(),this.recoveredDataChannelIds=[],this.currentDataChannelId=1}getStats(){return TR(TR({},this.statsFilter.getStats()),{},{qualityLimitationReason:this.qualityLimitationReason})}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const d=await this.peerConnection.createOffer(),h=this.mungSendOfferSDP(d.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const f=this.remoteSDP.toString(),g=this.logSDPExchange(h,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),g==null||g(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(d){throw new n_(Gi.EXCHANGE_SDP_FAILED,d.toString())}}async updateSendParameters(r,i){const d=this.peerConnection.getTransceivers().filter(h=>h.mid===r);d.length===1&&(this.isVP8Simulcast(i)?KE()||await this.applySimulcastEncodings(d,[i]):await this.applySendEncodings(d,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const d=this.peerConnection.getTransceivers().find(h=>h.mid===i);d&&await d.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:d,remote:h}=i.getSelectedCandidatePair();return{local:TR(TR({},xR),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port}),remote:TR(TR({},xR),{},{candidateType:h.type,protocol:h.protocol,address:h.address,port:h.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.isFirstConnected=!0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidateerror=r=>{if(r&&(r.errorCode||r.errorText)){var i;const d="code: ".concat(r.errorCode,", message: ").concat(r.errorText),h=r.port?"local: ".concat(r.port):"",f=SI(r.url||"");Wt.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICECandidateError(").concat(d,"), url: ").concat(f||"",", host_candidate:").concat(h)),(i=this.onICECandidateError)===null||i===void 0||i.call(this,d)}},this.peerConnection.onicegatheringstatechange=r=>{r&&r.target&&"iceGatheringState"in r.target&&Wt.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] RTCPeerConnection.onicegatheringstatechange(").concat(r.target.iceGatheringState,")"))},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Wt.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Wt.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},_s("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[]},d=r.cloudProxyServer||"disabled";return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&(jN(r.turnServer.servers)?i.iceServers=r.turnServer.servers:_s("NEW_TURN_MODE")&&i.iceServers&&d==="disabled"?(_s("USE_TURN_SERVER_OF_GATEWAY")?r.turnServer.serversFromGateway&&i.iceServers.push(...xI.newTurnServerConfigToIceServers(r.turnServer.serversFromGateway)):i.iceServers.push(...xI.newTurnServerConfigToIceServers(r.turnServer.servers)),_s("NEW_FORCE_TURN")&&(i.iceTransportPolicy="relay")):r.turnServer.mode!=="off"&&(i.iceServers&&i.iceServers.push(...xI.turnServerConfigToIceServers(r.turnServer.servers)),_s("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...xI.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),_s("FORCE_TURN_TCP")?i.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(h=>{h.forceturn&&(i.iceTransportPolicy="relay")}))),_s("ENABLE_ENCODED_TRANSFORM")&&uE().supportWebRTCEncodedTransform&&(i.encodedInsertableStreams=!0),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(d=>{d.security?d.tcpport&&i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(P0(d.turnServerURL),":").concat(d.tcpport,"?transport=tcp")}):(d.udpport&&!_s("FORCE_TURN_TCP")&&i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.udpport,"?transport=udp")}),d.tcpport&&i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=tcp")}))}),i}static newTurnServerConfigToIceServers(r){const i=[];return r.forEach(d=>{const h=_s("NEW_TURN_MODE");h===1?i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":3478?transport=udp")}):h===2?i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":3478?transport=tcp")}):h===3?i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(P0(d.turnServerURL),":443?transport=tcp")}):h===4&&(i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":3478?transport=udp")}),i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":3478?transport=tcp")}),i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(P0(d.turnServerURL),":443?transport=tcp")}))}),i}tryBindTransportEvents(r){const i=r.transport;if(i){this.transportEventReceiver=r,i.onstatechange=()=>{var h;i!=null&&i.state&&((h=this.onDTLSTransportStateChange)===null||h===void 0||h.call(this,i.state))},i.onerror=h=>{var f;(f=this.onDTLSTransportError)===null||f===void 0||f.call(this,"error"in h?h.error:h)};const d=i.iceTransport;d&&(d.onstatechange=()=>{const h=i==null?void 0:i.iceTransport.state;var f;h&&((f=this.onICETransportStateChange)===null||f===void 0||f.call(this,h))},d.getSelectedCandidatePair&&(d.onselectedcandidatepairchange=()=>{if(d.getSelectedCandidatePair()){const{local:h,remote:f}=d.getSelectedCandidatePair()||{};if(h&&f){const g=h.address+":"+h.port,b=f.address+":"+f.port;Wt.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(SI(g)),", remote ").concat(JSON.stringify(SI(b))))}}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var d,h;if(i||(i=this.peerConnection.getSenders().find(_r=>_r.track===r._mediaStreamTrack)),!i)return Wt.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return Wt.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!uE().supportSetRtpSenderParameters)return Wt.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const f={},g={};switch(r._optimizationMode){case"motion":f.degradationPreference="maintain-framerate";break;case"detail":f.degradationPreference="maintain-resolution";break;case"balanced":f.degradationPreference="balanced"}const b=function(ue,_r){return ue.getTransceivers().find(Fi=>Fi.sender.track===_r||Fi.receiver.track===_r)}(this.peerConnection,r._mediaStreamTrack),C=mlt(r);if(function(ue){var _r;return!(!_s("ENABLE_AG_ADAPTATION")||!(ue instanceof VL||E_(_r=ue._hints).call(_r,wE.CUSTOM_TRACK))||!_s("FORCE_SUPPORT_AG_ADAPTATION")&&!(s4(14,0,!1)&&a4(17,4)||o4(14)&&WV(17,4,!0)))}(r)&&b&&i&&C&&this.getLocalVideoStats&&E_(d=["vp8","vp9"]).call(d,this.store.codec)){var P;const ue=f.degradationPreference||(E_(P=r._hints).call(P,wE.CUSTOM_TRACK)?_s("CUSTOM_ADAPTATION_DEFAULT_MODE"):"maintain-framerate");(function(_r,Fi,Di,Js,_l,_u){if(f1(_r,Di),_l(Fi),Js!=="balanced"&&Js!=="maintain-framerate"&&Js!=="maintain-resolution")return;let ga=-1;uX(_r,Fi);const _m=window.setInterval(()=>{const a_=p1.get(_r);if(!_s("ENABLE_AG_ADAPTATION")||!a_)return f1(_r,Di),void _l(Fi);const p_=_u();if(p_.sendPackets>0&&p_.OutgoingAvailableBandwidth>0){if(ga===-1)return void(ga=Date.now());if(Date.now()-ga<1e3)return;const Q_=p_.sendFrameRate,$_=p_.OutgoingAvailableBandwidth,[F_,mE]=Aht(_r,Q_,$_,a_.adaptationConfig,Fi,Js);mE&&(Di.qualityLimitationReason=mE),F_&&a_.adaptationConfig.scale!==F_.scale&&(Wt.debug("[".concat(_r,"] applyAdaptation: ").concat(Di.qualityLimitationReason,`
           sendFps `).concat(Q_,", bwe ").concat($_,", switch from ").concat(a_.adaptationConfig.scale," to ").concat(F_.scale," ")),a_.adaptationConfig=dG(dG({},a_.adaptationConfig),F_),_l(F_))}},_s("CHECK_LOCAL_STATS_INTERVAL")),r_=dG({},Fi);p1.set(_r,{timer:_m,adaptationConfig:r_,originConfig:Fi,adaptationFunc:_l}),Wt.debug("[".concat(_r,"] start adaptation, originConfig: ").concat(JSON.stringify(Fi),", degradationPreference: ").concat(Js))})(this.id+b.mid,C,this,ue,_r=>{i&&this.updateAdaptation(i,_r)},this.getLocalVideoStats.bind(this))}if(r._encoderConfig){var x;const{bitrateMax:ue,frameRate:_r,scaleResolutionDownBy:Fi}=r._encoderConfig;ue&&(g.maxBitrate=1e3*ue),(E_(x=r._hints).call(x,wE.LOW_STREAM)||r.isUseScaleResolutionDownBy)&&(_r&&(g.maxFramerate=dT(_r)),Fi&&Fi>=1&&(g.scaleResolutionDownBy=Fi))}const{maxFramerate:H}=_s("ENCODER_CONFIG_LIMIT");if(H&&typeof H=="number"&&(g.maxFramerate=g.maxFramerate?Math.min(g.maxFramerate,H):H),_s("DSCP_TYPE")&&n0()){var $;const ue=_s("DSCP_TYPE");E_($=["very-low","low","medium","high"]).call($,ue)&&(g.networkPriority=ue)}const _t=i.getParameters(),_i=(h=_t.encodings)===null||h===void 0?void 0:h[0];KE()&&!_i&&(f.encodings=[g]),_i&&Object.assign(_i,g),Object.assign(_t,f),Wt.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(_t.encodings))),await i.setParameters(_t),await async function(ue,_r,Fi){try{var Di;if(!uE().supportSetRtpSenderParameters||!function(_m){return _m==="vp9"||_m==="av1"}(ue)||!_s("ENABLE_SVC"))return;const Js={},_l={},_u=_r.getParameters(),ga=(Di=_u.encodings)===null||Di===void 0?void 0:Di[0];_l.scalabilityMode=e1(Fi),ga&&Object.assign(ga,_l),Object.assign(_u,Js),await _r.setParameters(_u),Wt.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode success: ".concat(JSON.stringify(_u.encodings)))}catch(Js){Wt.debug("[updateAdaptation] updateRtpSenderEncodings scalabilityMode failed",Js)}}(this.store.codec,i,_s("SVC_MODE"))}async updateAdaptation(r,i){var d,h;if(!r)return Wt.debug("[updateAdaptation] no rtpSender found");if(!uE().supportSetRtpSenderParameters)return Wt.debug("[updateAdaptation] Browser not support set rtp-sender parameters");const f={},{bitrateMax:g,frameRate:b,scaleResolutionDownBy:C}=i;g&&(f.maxBitrate=1e3*g),b&&(f.maxFramerate=dT(b)),C&&C>=1&&E_(d=["vp8","vp9"]).call(d,this.store.codec)&&(f.scaleResolutionDownBy=C);const P=r.getParameters(),x=(h=P.encodings)===null||h===void 0?void 0:h[0];x&&Object.assign(x,f),Object.assign(P,{});try{await r.setParameters(P),Wt.debug("[updateAdaptation] updateRtpSenderEncodings: ".concat(JSON.stringify(P.encodings)))}catch(H){!("transport"in r)||r.transport&&r.transport.state==="connected"?this.peerConnectionState!=="connected"?Wt.debug("[updateAdaptation] peerConnection not connected}"):Wt.debug("[updateAdaptation] updateRtpSenderEncodings failed",H):Wt.debug("[updateAdaptation] rtpSender transport not connected}")}}async applySendEncodings(r,i){try{if(!uE().supportSetRtpSenderParameters||r.length!==i.length)return;for(let d=0;d<r.length;d++){const h=r[d],f=i[d];f instanceof LE&&!this.isVP8Simulcast(f)&&await this.updateRtpSenderEncodings(f,h.sender)}}catch{Wt.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,d){const h=$S(r);return i.forEach((f,g)=>{const b=d[g],C=h.mediaDescriptions.find(P=>P.attributes.mid===b);C&&(VO(C,f),LJ(C,f,this.store.codec))}),C0(h)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,d)=>{var h;(h=this.onFirstVideoDecoded)===null||h===void 0||h.call(this,r,i,d)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var d;(d=this.onSelectedLocalCandidateChanged)===null||d===void 0||d.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var d;(d=this.onSelectedRemoteCandidateChanged)===null||d===void 0||d.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let C=0;C<r.length;C++){var d,h,f,g,b;const P=r[C],x=i[C];if(x instanceof LE&&!E_(d=x._hints).call(d,wE.LOW_STREAM)&&(h=x._encoderConfig)!==null&&h!==void 0&&h.bitrateMax&&((f=x._encoderConfig)===null||f===void 0?void 0:f.bitrateMax)>200&&(g=x._scalabilityMode)!==null&&g!==void 0&&g.numSpatialLayers&&((b=x._scalabilityMode)===null||b===void 0?void 0:b.numSpatialLayers)>1&&this.store.codec==="vp8"){const H={},$={high:1e3*(x._encoderConfig.bitrateMax-50),medium:5e4};H.encodings=[{rid:"m",active:!0,maxBitrate:$.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:$.high}];const _t=P.sender.getParameters();await P.sender.setParameters(Object.assign(_t,H))}}}async applySimulcastEncodings(r,i){if(!KE()&&r.length===i.length)for(let d=0;d<r.length;d++){const h=i[d];if(h instanceof LE&&this.isVP8Simulcast(h)){const f=r[d],g={},b={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:b.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:b.medium,scaleResolutionDownBy:4}];const C=f.sender.getParameters();await f.sender.setParameters(Object.assign(C,g))}}}isVP8Simulcast(r){var i,d,h,f,g;return!!(r instanceof LE&&_s("SIMULCAST")&&this.store.codec==="vp8"&&!E_(i=r._hints).call(i,wE.LOW_STREAM)&&(d=r._encoderConfig)!==null&&d!==void 0&&d.bitrateMax&&((h=r._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(f=r._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((g=r._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1)}logSDPExchange(r,i,d,h){if(_s("SDP_LOGGING"))return Wt.upload("[".concat(this.store.clientId,"] exchanging ").concat(d," ").concat(i," SDP during P2PConnection.").concat(h,`
`),r),i==="offer"?f=>{this.logSDPExchange(f,"answer",d==="local"?"remote":"local",h)}:void 0}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i&&i.length!==0?i[0].ssrcId:void 0}setConfiguration(r){if(uE().supportPCSetConfiguration){const i=xI.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}r.isPreallocation&&(this.isPreallocation=!0)}},D_(sE.prototype,"updateRemoteRTPCapabilities",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"updateRemoteRTPCapabilities"),sE.prototype),D_(sE.prototype,"connect",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"connect"),sE.prototype),D_(sE.prototype,"updateRemoteConnect",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"updateRemoteConnect"),sE.prototype),D_(sE.prototype,"createDataChannels",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"createDataChannels"),sE.prototype),D_(sE.prototype,"receive",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"receive"),sE.prototype),D_(sE.prototype,"batchReceive",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"batchReceive"),sE.prototype),D_(sE.prototype,"stopReceiving",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"stopReceiving"),sE.prototype),D_(sE.prototype,"muteRemote",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"muteRemote"),sE.prototype),D_(sE.prototype,"unmuteRemote",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"unmuteRemote"),sE.prototype),D_(sE.prototype,"muteLocal",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"muteLocal"),sE.prototype),D_(sE.prototype,"unmuteLocal",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"unmuteLocal"),sE.prototype),D_(sE.prototype,"close",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"close"),sE.prototype),D_(sE.prototype,"updateEncoderConfig",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"updateEncoderConfig"),sE.prototype),D_(sE.prototype,"updateSendParameters",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"updateSendParameters"),sE.prototype),D_(sE.prototype,"replaceTrack",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"replaceTrack"),sE.prototype),D_(sE.prototype,"updateAdaptation",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"updateAdaptation"),sE.prototype),D_(sE.prototype,"getRemoteSSRC",[JS],Object.getOwnPropertyDescriptor(sE.prototype,"getRemoteSSRC"),sE.prototype),sE);function JS(e,r,i){const d=e[r];if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const h=this.mutex,f=await h.lock("From P2PConnection.".concat(r));try{for(var g=arguments.length,b=new Array(g),C=0;C<g;C++)b[C]=arguments[C];return await d.apply(this,b)}finally{f()}},i}function fG(e,r){let i=document.createElement("video"),d=document.createElement("canvas");i.setAttribute("style","display:none"),d.setAttribute("style","display:none"),i.setAttribute("muted",""),i.muted=!0,i.setAttribute("autoplay",""),i.autoplay=!0,i.setAttribute("playsinline",""),d.width=dT(r.width),d.height=dT(r.height);const h=dT(r.framerate||15);document.body.append(i),document.body.append(d);let f=e._mediaStreamTrack;i.srcObject=new MediaStream([f]),i.play();const g=d.getContext("2d");if(!g)throw new t_(Gi.UNEXPECTED_ERROR,"can not get canvas context");const b=uE(),C=d.captureStream(b.supportRequestFrame?0:h).getVideoTracks()[0];C.canvas||(C.canvas=d),d.startCapture=()=>{if(!i)return d.stopCapture&&d.stopCapture();if(i.paused&&i.play(),i.videoHeight>2&&i.videoWidth>2){const x=i.videoWidth,H=i.videoHeight/x,$=d.width*H;Math.abs($-d.height)>=2&&(Wt.debug("adjust low stream resolution","".concat(d.width,"x").concat(d.height," -> ").concat(d.width,"x").concat($)),d.height=$)}g.drawImage(i,0,0,d.width,d.height),C.requestFrame&&C.requestFrame(),f!==e._mediaStreamTrack&&(f=e._mediaStreamTrack,i.srcObject=new MediaStream([f]))},d.stopCapture=bF(()=>d.startCapture&&d.startCapture(),h);const P=C.stop;return C.stop=()=>{P.call(C),i&&(i.remove(),i.srcObject=null,i=null),d&&(d.width=0,d.remove(),d.stopCapture&&d.stopCapture(),d.startCapture=void 0,d.stopCapture=void 0,d=null),Wt.debug("clean low stream renderer")},C}var fX=function(e){return e[e.Video_Send_Type=190]="Video_Send_Type",e}(fX||{}),RR=function(e){return e[e.Video_Send_Qp_Sum=2143]="Video_Send_Qp_Sum",e[e.Video_Send_Freeze=2082]="Video_Send_Freeze",e[e.Video_Recv_Qp_Sum=2144]="Video_Recv_Qp_Sum",e[e.Video_Recv_Freeze=2084]="Video_Recv_Freeze",e[e.Video_Render_Freeze_Time=2109]="Video_Render_Freeze_Time",e[e.Video_Render_Freeze_Time_Render=2147]="Video_Render_Freeze_Time_Render",e[e.Video_Render_Freeze_Time_Render2=2223]="Video_Render_Freeze_Time_Render2",e[e.Audio_Recv_Freeze=2083]="Audio_Recv_Freeze",e}(RR||{}),K_=function(e){return e[e.Video_Send_Retransmit=2062]="Video_Send_Retransmit",e[e.Video_Send_Target_Encoded=2064]="Video_Send_Target_Encoded",e[e.Video_Send_Actual_Encoded=2060]="Video_Send_Actual_Encoded",e[e.Video_Send_Transmit=2066]="Video_Send_Transmit",e[e.Video_Send_Bandwidth=2061]="Video_Send_Bandwidth",e[e.Video_Capture_Height=2033]="Video_Capture_Height",e[e.Video_Capture_Width=2035]="Video_Capture_Width",e[e.Video_Capture_Frame_Rate=2034]="Video_Capture_Frame_Rate",e[e.Video_Send_Low_Height=2073]="Video_Send_Low_Height",e[e.Video_Send_Low_Frame_Rate=2075]="Video_Send_Low_Frame_Rate",e[e.Video_Send_Low_Width=2077]="Video_Send_Low_Width",e[e.Video_Send_Low_Bitrate=2069]="Video_Send_Low_Bitrate",e[e.Video_Send_Low_Package_Lost=2070]="Video_Send_Low_Package_Lost",e[e.Video_Send_Low_Package_Rate=2071]="Video_Send_Low_Package_Rate",e[e.Video_Send_Frame_Rate=2002]="Video_Send_Frame_Rate",e[e.Video_Send_Width=2003]="Video_Send_Width",e[e.Video_Send_Height=2004]="Video_Send_Height",e[e.Video_Send_Disabled=2095]="Video_Send_Disabled",e[e.Video_Send_Adaptation=2032]="Video_Send_Adaptation",e[e.Video_Send_Player_Status=2128]="Video_Send_Player_Status",e[e.Video_Send_Nacks=2009]="Video_Send_Nacks",e[e.Video_Send_Plis=2010]="Video_Send_Plis",e[e.Video_Send_Firs=2011]="Video_Send_Firs",e[e.Video_Send_Avg_Encode=2007]="Video_Send_Avg_Encode",e[e.Video_Send_Huge_Frame_Sent=2174]="Video_Send_Huge_Frame_Sent",e[e.Video_Send_Bytes_Retransmit=2173]="Video_Send_Bytes_Retransmit",e[e.Video_Send_Packages_Retransmit=2172]="Video_Send_Packages_Retransmit",e[e.Video_Send_Key_Frames_Encoded=2207]="Video_Send_Key_Frames_Encoded",e[e.Video_Send_Bitrate=2012]="Video_Send_Bitrate",e[e.Video_Send_Package_Rate=2031]="Video_Send_Package_Rate",e[e.Video_Send_Package_Lost=2005]="Video_Send_Package_Lost",e[e.Audio_Capture_PCM_Level=2104]="Audio_Capture_PCM_Level",e[e.Audio_Send_Level=2038]="Audio_Send_Level",e[e.Audio_Send_Bitrate=2039]="Audio_Send_Bitrate",e[e.Audio_Send_Package_Rate=2040]="Audio_Send_Package_Rate",e[e.Audio_Send_AEC_Return_Loss=2041]="Audio_Send_AEC_Return_Loss",e[e.Audio_Send_AEC_Return_Loss_Enhancement=2042]="Audio_Send_AEC_Return_Loss_Enhancement",e[e.Audio_Send_Freeze=2081]="Audio_Send_Freeze",e[e.Audio_Send_Disabled=2096]="Audio_Send_Disabled",e[e.Audio_Send_Bytes_Retransmit=2179]="Audio_Send_Bytes_Retransmit",e[e.Audio_Send_Packages_Retransmit=2180]="Audio_Send_Packages_Retransmit",e[e.Video_Recv_Height=2019]="Video_Recv_Height",e[e.Video_Recv_Width=2018]="Video_Recv_Width",e[e.Video_Recv_Frame_Rate_Output=2155]="Video_Recv_Frame_Rate_Output",e[e.Video_Recv_Jitter_Buffer=2023]="Video_Recv_Jitter_Buffer",e[e.Video_Recv_Current_Delay=2024]="Video_Recv_Current_Delay",e[e.Video_Recv_Nacks=2026]="Video_Recv_Nacks",e[e.Video_Recv_Plis=2027]="Video_Recv_Plis",e[e.Video_Recv_Firs=2028]="Video_Recv_Firs",e[e.Video_Recv_Disabled=2101]="Video_Recv_Disabled",e[e.Video_Recv_Player_Status=2129]="Video_Recv_Player_Status",e[e.Video_Recv_I_Frame_Delay=2149]="Video_Recv_I_Frame_Delay",e[e.Video_Render_Frame_Rate_Render=2022]="Video_Render_Frame_Rate_Render",e[e.Video_Render_Freeze_Duration=2156]="Video_Render_Freeze_Duration",e[e.Audio_Render_Level=2043]="Audio_Render_Level",e[e.Audio_Render_Freeze_Time_80ms=2226]="Audio_Render_Freeze_Time_80ms",e[e.Audio_Render_Freeze_Time_200ms=2227]="Audio_Render_Freeze_Time_200ms",e[e.Audio_Render_Freeze_Samples_80ms=2228]="Audio_Render_Freeze_Samples_80ms",e[e.Audio_Render_Freeze_Samples_200ms=2229]="Audio_Render_Freeze_Samples_200ms",e[e.Audio_Recv_PCM_Level=2105]="Audio_Recv_PCM_Level",e[e.Audio_Recv_Disabled=2102]="Audio_Recv_Disabled",e[e.Audio_Recv_Jitter_Buffer=2054]="Audio_Recv_Jitter_Buffer",e[e.Audio_Recv_Current_Delay=2047]="Audio_Recv_Current_Delay",e[e.Audio_Recv_Player_Status=2130]="Audio_Recv_Player_Status",e[e.Audio_Recv_Bitrate=2044]="Audio_Recv_Bitrate",e[e.Audio_Recv_Concealed_Samples=2148]="Audio_Recv_Concealed_Samples",e[e.Audio_Recv_Total_Samples_Received=2224]="Audio_Recv_Total_Samples_Received",e}(K_||{}),gS=function(e){return e[e.Video_Render_Frame_Rate_Decode=2021]="Video_Render_Frame_Rate_Decode",e[e.Video_Recv_Frame_Rate=2020]="Video_Recv_Frame_Rate",e[e.Video_Recv_Frame_Dropped=2181]="Video_Recv_Frame_Dropped",e[e.Video_Recv_Bytes_Retransmit=2175]="Video_Recv_Bytes_Retransmit",e[e.Video_Recv_Packages_Retransmit=2176]="Video_Recv_Packages_Retransmit",e[e.Video_Recv_Packages_Discarded=2198]="Video_Recv_Packages_Discarded",e[e.Video_Recv_Avg_Decode=2200]="Video_Recv_Avg_Decode",e[e.Video_Recv_Avg_Processing_Delay=2202]="Video_Recv_Avg_Processing_Delay",e[e.Video_Recv_Avg_Assembly_Time=2203]="Video_Recv_Avg_Assembly_Time",e[e.Video_Recv_Avg_Inter_Frame_Delay=2204]="Video_Recv_Avg_Inter_Frame_Delay",e[e.Video_Recv_Key_Frames_Decoded=2206]="Video_Recv_Key_Frames_Decoded",e[e.Video_Recv_Package_Lost=2014]="Video_Recv_Package_Lost",e[e.Video_Recv_Bitrate=2029]="Video_Recv_Bitrate",e[e.Video_Recv_Package_Rate=2078]="Video_Recv_Package_Rate",e[e.Audio_Recv_Jitter=2055]="Audio_Recv_Jitter",e[e.Audio_Recv_Bytes_Retransmit=2178]="Audio_Recv_Bytes_Retransmit",e[e.Audio_Recv_Packages_Retransmit=2177]="Audio_Recv_Packages_Retransmit",e[e.Audio_Recv_Packages_Discarded=2199]="Audio_Recv_Packages_Discarded",e[e.Audio_Recv_Avg_Processing_Delay=2201]="Audio_Recv_Avg_Processing_Delay",e[e.Audio_Recv_Package_Rate=2046]="Audio_Recv_Package_Rate",e[e.Audio_Recv_Package_Lost=2045]="Audio_Recv_Package_Lost",e}(gS||{}),XS=function(e){return e[e.RTT=2006]="RTT",e[e.CONN_TYPE=801]="CONN_TYPE",e[e.STATS_UPDATE_INTERVAL=2205]="STATS_UPDATE_INTERVAL",e}(XS||{}),_1=function(e){return e[e.RTC_PEER_CONNECTION_STATE=2219]="RTC_PEER_CONNECTION_STATE",e}(_1||{});const RI=1e3,E1=6,sP=3,Pht=Math.max(E1,sP,60);function U_(e,r,i){i!=null&&Number.isFinite(i)&&(e[r]=Math.round(Math.max(0,i)))}function mX(e){const r={[XS.CONN_TYPE]:0,[XS.RTT]:e.rtt,[XS.STATS_UPDATE_INTERVAL]:e.updateInterval?Math.round(Math.max(0,e.updateInterval)):void 0};switch(e.selectedCandidatePair.localCandidate.candidateType){case"relay":{const i=e.selectedCandidatePair.localCandidate.relayProtocol;i==="udp"&&(r[XS.CONN_TYPE]=1),i==="tcp"&&(r[XS.CONN_TYPE]=3),i==="tls"&&(r[XS.CONN_TYPE]=4);break}case"srflx":r[XS.CONN_TYPE]=2;break;case"unknown":r[XS.CONN_TYPE]=5;break;default:r[XS.CONN_TYPE]=0}return r}function _X(e){let r=0;switch(e){case"none":r=0;break;case"cpu":r=1;break;case"bandwidth":r=2;break;case"other":r=3}return r}class EX extends qE{constructor(r){super(),Ei(this,"store",void 0),Ei(this,"uploadWRTCStatsTimer",void 0),Ei(this,"uploadOutboundDenoiserStatsTimer",void 0),Ei(this,"uploadExtStatsTimer",void 0),Ei(this,"uploadExtUsageStatsTimer",void 0),Ei(this,"uploadInboundExtStatsTimer",void 0),Ei(this,"requestStats",void 0),Ei(this,"requestTransportStats",void 0),Ei(this,"requestLocalMedia",void 0),Ei(this,"requestRemoteMedia",void 0),Ei(this,"requestAllTracks",void 0),Ei(this,"requestVideoIsReady",void 0),Ei(this,"requestUploadStats",void 0),Ei(this,"requestUpload",void 0),Ei(this,"uploadOutboundStarted",!1),Ei(this,"uploadInboundStarted",!1),Ei(this,"uploadTransportStarted",!1),Ei(this,"uploadBaseStatsStarted",!1),Ei(this,"uploadExtensionUsageStarted",!1),Ei(this,"lastRecvStats",void 0),Ei(this,"lastSendStats",void 0),Ei(this,"lastRefRecvStats",void 0),Ei(this,"lastRefSendStats",void 0),Ei(this,"lastNormalRecvStats",void 0),Ei(this,"lastNormalSendStats",void 0),Ei(this,"lastExtendStats",{}),Ei(this,"needUploadStats",{}),Ei(this,"needUploadRenderFreezeTime",!0),Ei(this,"lastUploadCompensateTime",-1),Ei(this,"uploadCompensateDeltaTime",0),this.store=r}uploadWRTCStats(r){if(!this.requestStats||!this.requestUploadStats)return;const i=r%sP==0,d=r%E1==0,h=r%60==0;let f,g;if(this.uploadTransportStarted&&(f=this.requestStats(),this.store.useP2P&&(g=this.requestStats(!0))),!f&&this.uploadOutboundStarted&&(f=this.requestStats()),!g&&this.uploadInboundStarted&&(g=this.requestStats(!0)),f||g){var b;const C={};if(this.uploadTransportStarted&&f){const x=this.getTransportStats(f,g,i);x&&(C.misc=[x])}if(this.uploadOutboundStarted&&f){const x=this.getOutboundStats(f,d?this.lastNormalSendStats:void 0,i?this.lastRefSendStats:void 0,this.lastSendStats,h);x&&(C.outbound=[x])}if(this.uploadInboundStarted&&g){this.uploadCompensateStats(r);const x=this.getInboundStats(g,d?this.lastNormalRecvStats:void 0,i?this.lastRefRecvStats:void 0,this.lastRecvStats);x&&(C.inbound=x)}const P=(b=this.requestTransportStats)===null||b===void 0?void 0:b.call(this).connectState;P&&(Array.isArray(C.misc)?C.misc[0]&&C.misc[0].addition&&(C.misc[0].addition[_1.RTC_PEER_CONNECTION_STATE]=iF[P]):C.misc=[{addition:{[_1.RTC_PEER_CONNECTION_STATE]:iF[P]}}]),this.needUploadStats.sendType&&(Array.isArray(C.outbound)&&C.outbound[0]&&C.outbound[0].high&&(C.outbound[0].high[fX.Video_Send_Type]=this.needUploadStats.sendType),this.needUploadStats.sendType=void 0),this.requestUploadStats(C)}this.lastRecvStats=g,this.lastSendStats=f,d&&(this.lastNormalRecvStats=g,this.lastNormalSendStats=f),i&&(this.lastRefRecvStats=g,this.lastRefSendStats=f)}startUploadWRTCStats(){if(this.uploadWRTCStatsTimer)return;this.uploadBaseStatsStarted=!0;let r=1;this.uploadWRTCStatsTimer=window.setInterval(()=>{if(!this.uploadTransportStarted&&!this.uploadInboundStarted&&!this.uploadOutboundStarted){if(this.uploadBaseStatsStarted){var i,d;const h=(i=this.requestTransportStats)===null||i===void 0?void 0:i.call(this);return void(h&&((d=this.requestUploadStats)===null||d===void 0||d.call(this,{misc:[{addition:{[_1.RTC_PEER_CONNECTION_STATE]:iF[h.connectState]}}]})))}return this.stopUploadWRTCStats()}this.uploadWRTCStats(r),++r===Pht+1&&(r=1)},RI)}uploadCompensateStats(r){if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const i=r%sP==0&&this.needUploadRenderFreezeTime;if(!this.uploadInboundStarted||!i)return;if(this.lastUploadCompensateTime===-1)return void(this.lastUploadCompensateTime=Date.now());const d=Math.max(-6e3,Date.now()-this.lastUploadCompensateTime-6e3);if(this.uploadCompensateDeltaTime+=d,this.lastUploadCompensateTime=Date.now(),this.uploadCompensateDeltaTime<6e3)return;const h=Math.min(Math.floor(this.uploadCompensateDeltaTime/6e3),10);this.uploadCompensateDeltaTime-=6e3*h;const f=this.requestStats(!0);new Array(h).fill(0).forEach(()=>{if(!this.requestStats||!this.requestUploadStats||!this.requestRemoteMedia)return;const g={};if(this.uploadInboundStarted&&f){const b=this.requestRemoteMedia()||[],C=[];b.forEach(P=>{let[x,H]=P;const $={peer:x.uid};if(x._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(x._videoSSRC)&&H.has(A_.VIDEO)&&x.videoTrack){const _t=function(_i,ue,_r){if(!ue.videoRecv.find(Di=>Di.ssrc===_i))return;const Fi={};if(_r&&_r._player){const Di=_r._player,{renderFreezeAccTime2:Js,videoElementStatus:_l}=Di;if(jR.visibility==="visible"&&_l===CS.PLAYING&&uE().supportRequestVideoFrameCallback){const _u=Math.min(6e3,Js);Di.renderFreezeAccTime2=Math.max(0,Js-_u),U_(Fi,RR.Video_Render_Freeze_Time_Render2,_u),_s("USE_NEW_RENDER_FREEZE_TIME")&&U_(Fi,RR.Video_Render_Freeze_Time_Render,_u)}}return Fi}(x._videoSSRC,f,x.videoTrack);_t&&($.video=_t)}$.video&&C.push($)}),C.length>0&&(g.inbound=C,this.requestUploadStats(g))}})}stopUploadWRTCStats(){window.clearInterval(this.uploadWRTCStatsTimer),this.uploadWRTCStatsTimer=void 0,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0}getTransportStats(r,i,d){if(!this.requestStats)return;if(!d)return r.rtt==null?void 0:{addition:{[XS.RTT]:r.rtt,[XS.CONN_TYPE]:void 0,[XS.STATS_UPDATE_INTERVAL]:r.updateInterval||void 0}};const h=mX(r);if(this.store.useP2P){if(i){const f=mX(i);h[XS.CONN_TYPE]+=f[XS.CONN_TYPE]<<3}h[XS.CONN_TYPE]+=110}else h[XS.CONN_TYPE]+=100;return{addition:h}}getOutboundStats(r,i,d,h,f){if(!this.requestUploadStats||!this.requestLocalMedia)return;const g=this.requestLocalMedia();if(!g||g.length===0)return;let b,C,P;return g.forEach(x=>{let[H,{track:$,ssrcs:_t}]=x;switch(H){case l_.LocalVideoLowTrack:case l_.LocalVideoTrack:if(H===l_.LocalVideoTrack){var _i;const ue=function(Js,_l,_u,ga,_m,r_){const a_=_l.videoSend.find(F_=>F_.ssrc===Js);if(!a_)return;const p_={},{sentFrame:Q_,inputFrame:$_}=a_;if(ga&&(U_(p_,RR.Video_Send_Qp_Sum,a_.qpSumPerFrame),$_&&Q_)){const F_=$_.frameRate,mE=Q_.frameRate;p_[RR.Video_Send_Freeze]=function(pE,PS){let s_=!0;return s_=!(pE<=5)&&(pE<=10?PS<3:pE<=20?PS<4:PS<5),s_}(F_,mE)?1:0}if(_m){switch(Q_&&(U_(p_,K_.Video_Send_Height,Q_.height),U_(p_,K_.Video_Send_Width,Q_.width),U_(p_,K_.Video_Send_Frame_Rate,Q_.frameRate)),p_[K_.Video_Send_Disabled]=_u._originMediaStreamTrack&&!_u._originMediaStreamTrack.enabled||_u._mediaStreamTrack&&!_u._mediaStreamTrack.enabled?1:0,a_.adaptionChangeReason){case"none":p_[K_.Video_Send_Adaptation]=0;break;case"cpu":p_[K_.Video_Send_Adaptation]=1;break;case"bandwidth":p_[K_.Video_Send_Adaptation]=2;break;case"other":p_[K_.Video_Send_Adaptation]=3}let F_=0;a_.adaptionChangeReason&&(F_+=_X(a_.adaptionChangeReason)),_l.qualityLimitationReason&&(F_+=_X(_l.qualityLimitationReason)<<3),p_[K_.Video_Send_Adaptation]=F_,p_[K_.Video_Send_Player_Status]=gF[_u._player?_u._player.videoElementStatus:"uninit"],U_(p_,K_.Video_Send_Nacks,a_.nacksCount),U_(p_,K_.Video_Send_Plis,a_.plisCount),U_(p_,K_.Video_Send_Firs,a_.firsCount),U_(p_,K_.Video_Send_Avg_Encode,a_.avgEncodeMs),U_(p_,K_.Video_Send_Huge_Frame_Sent,a_.hugeFramesSent),U_(p_,K_.Video_Send_Bytes_Retransmit,a_.retransmittedBytesSent),U_(p_,K_.Video_Send_Packages_Retransmit,a_.retransmittedPacketsSent),U_(p_,K_.Video_Send_Key_Frames_Encoded,a_.keyFramesEncoded);const mE=_m.videoSend.find(pE=>pE.ssrc===Js);if(mE){let pE=RI*sP;mE.timestamp&&a_.timestamp&&(pE=a_.timestamp-mE.timestamp),mE.packets!=null&&a_.packets!=null&&U_(p_,K_.Video_Send_Package_Rate,1e3*(a_.packets-mE.packets)/pE),a_.packetsLost!=null&&mE.packetsLost!=null&&U_(p_,K_.Video_Send_Package_Lost,a_.packetsLost-mE.packetsLost),mE.bytes!=null&&a_.bytes!=null&&U_(p_,K_.Video_Send_Bitrate,8*(a_.bytes-mE.bytes)/pE)}}return p_}(_t[0].ssrcId,r,$,i,d),_r=$.__className__==="CameraVideoTrack"?3:E_(_i=$._hints).call(_i,wE.SCREEN_TRACK)?7:10;(this.lastExtendStats.sendType!==_r||f)&&(this.needUploadStats={sendType:_r},this.lastExtendStats.sendType=_r);const Fi=$&&function(Js,_l,_u,ga){const _m=_l.videoSend.find(a_=>a_.ssrc===Js);if(!_m)return null;const r_={};if(ga){const a_=_m.inputFrame,p_=a_&&a_.height||_u.videoHeight||0,Q_=a_&&a_.width||_u.videoWidth||0,$_=a_&&a_.frameRate||0;U_(r_,K_.Video_Capture_Height,p_),U_(r_,K_.Video_Capture_Width,Q_),U_(r_,K_.Video_Capture_Frame_Rate,$_)}return r_}(_t[0].ssrcId,r,$,!!d),Di=function(Js,_l){const _u={};return _l&&(U_(_u,K_.Video_Send_Retransmit,Js.bitrate.retransmit),U_(_u,K_.Video_Send_Target_Encoded,Js.bitrate.targetEncoded),U_(_u,K_.Video_Send_Actual_Encoded,Js.bitrate.actualEncoded),U_(_u,K_.Video_Send_Transmit,Js.bitrate.transmit),U_(_u,K_.Video_Send_Bandwidth,Js.sendBandwidth)),_u}(r,!!d);C=Object.assign({},ue,Fi,Di)}else P=function(ue,_r,Fi,Di,Js){const _l=_r.videoSend.find(ga=>ga.ssrc===ue);if(!_l)return;const _u={};if(Di){const ga=_l.sentFrame;ga&&(U_(_u,K_.Video_Send_Low_Height,ga.height),U_(_u,K_.Video_Send_Low_Width,ga.width),U_(_u,K_.Video_Send_Low_Frame_Rate,ga.frameRate));const _m=Di.videoSend.find(r_=>r_.ssrc===ue);if(_m){let r_=RI*E1;_m.timestamp&&_l.timestamp&&(r_=_l.timestamp-_m.timestamp),_m.packets!=null&&_l.packets!=null&&U_(_u,K_.Video_Send_Low_Package_Rate,1e3*(_l.packets-_m.packets)/r_),_l.packetsLost!=null&&_m.packetsLost!=null&&U_(_u,K_.Video_Send_Low_Package_Lost,_l.packetsLost-_m.packetsLost),_m.bytes!=null&&_l.bytes!=null&&U_(_u,K_.Video_Send_Low_Bitrate,8*(_l.bytes-_m.bytes)/r_)}}return _u}(_t[0].ssrcId,r,0,d);break;case l_.LocalAudioTrack:b=$&&function(ue,_r,Fi,Di,Js,_l){const _u=_r.audioSend.find(_m=>_m.ssrc===ue);if(!_u)return;const ga={};if(Js){ga[K_.Audio_Send_Disabled]=Fi._originMediaStreamTrack&&!Fi._originMediaStreamTrack.enabled||Fi._mediaStreamTrack&&!Fi._mediaStreamTrack.enabled?1:0;const _m=100*Fi._source.getAccurateVolumeLevel(),r_=_u.inputLevel;if(r_!=null){const p_=Math.ceil(50*Math.log10(100*r_+1));U_(ga,K_.Audio_Send_Level,p_)}U_(ga,K_.Audio_Capture_PCM_Level,_m),U_(ga,K_.Audio_Send_AEC_Return_Loss,_u.aecReturnLoss),U_(ga,K_.Audio_Send_AEC_Return_Loss_Enhancement,_u.aecReturnLossEnhancement),U_(ga,K_.Audio_Send_Bytes_Retransmit,_u.retransmittedBytesSent),U_(ga,K_.Audio_Send_Packages_Retransmit,_u.retransmittedPacketsSent),ga[K_.Audio_Send_Freeze]=0;const a_=Js.audioSend.find(p_=>p_.ssrc===ue);if(a_){let p_=RI*E1;a_.timestamp&&_u.timestamp&&(p_=_u.timestamp-a_.timestamp),a_.bytes!=null&&_u.bytes!=null&&U_(ga,K_.Audio_Send_Bitrate,8*(_u.bytes-a_.bytes)/p_),a_.packets!=null&&_u.packets!=null&&U_(ga,K_.Audio_Send_Package_Rate,1e3*(_u.packets-a_.packets)/p_)}}return ga}(_t[0].ssrcId,r,$,0,d)}}),{high:C,low:P,audio:b}}getInboundStats(r,i,d,h){if(!this.requestRemoteMedia)return;const f=this.requestRemoteMedia()||[],g=[];return f.forEach(b=>{let[C,P]=b;const x={peer:C.uid};if(P.has(A_.VIDEO)&&C.videoTrack){const H=C._videoSSRC&&this.requestVideoIsReady&&this.requestVideoIsReady(C._videoSSRC)||!1,$=C.videoTrack?function(_t,_i,ue,_r,Fi,Di,Js,_l){const _u=_i.videoRecv.find(F_=>F_.ssrc===_t);if(!_u)return;const ga={},{receivedFrame:_m,outputFrame:r_,decodeFrameRate:a_}=_u;U_(ga,gS.Video_Render_Frame_Rate_Decode,a_),_u.framesRateFirefox&&U_(ga,gS.Video_Recv_Frame_Rate,_u.framesRateFirefox),_m&&U_(ga,gS.Video_Recv_Frame_Rate,_m.frameRate),U_(ga,gS.Video_Recv_Frame_Dropped,_u.framesDroppedCount),U_(ga,gS.Video_Recv_Bytes_Retransmit,_u.retransmittedBytesReceived),U_(ga,gS.Video_Recv_Packages_Retransmit,_u.retransmittedPacketsReceived),U_(ga,gS.Video_Recv_Packages_Discarded,_u.packetsDiscarded),U_(ga,gS.Video_Recv_Avg_Decode,_u.avgDecodeMs),U_(ga,gS.Video_Recv_Avg_Processing_Delay,_u.avgProcessingDelayMs),U_(ga,gS.Video_Recv_Avg_Assembly_Time,_u.avgFramesAssembledFromMultiplePacketsMs),U_(ga,gS.Video_Recv_Avg_Inter_Frame_Delay,_u.avgInterFrameDelayMs),U_(ga,gS.Video_Recv_Key_Frames_Decoded,_u.keyFramesDecoded);const p_=_l&&_l.videoRecv.find(F_=>F_.ssrc===_t);if(p_){const F_=_i.timestamp-_l.timestamp||RI;_u.packetsLost!=null&&p_.packetsLost!=null&&U_(ga,gS.Video_Recv_Package_Lost,_u.packetsLost-p_.packetsLost),p_.bytes!=null&&_u.bytes!=null&&U_(ga,gS.Video_Recv_Bitrate,8*(_u.bytes-p_.bytes)/F_),p_.packets!=null&&_u.packets!=null&&U_(ga,gS.Video_Recv_Package_Rate,1e3*(_u.packets-p_.packets)/F_)}const Q_=Di&&Di.videoRecv.find(F_=>F_.ssrc===_t);if(Q_&&(U_(ga,RR.Video_Recv_Qp_Sum,_u.qpSumPerFrame),ga[RR.Video_Recv_Freeze]=_r&&oP.isRemoteVideoFreeze(ue,_u,Q_)?1:0),Js){var $_;const F_=Js.videoRecv.find(pE=>pE.ssrc===_t);_m?(U_(ga,K_.Video_Recv_Height,_m.height),U_(ga,K_.Video_Recv_Width,_m.width)):ue&&(U_(ga,K_.Video_Recv_Height,ue._videoHeight||0),U_(ga,K_.Video_Recv_Width,ue._videoWidth||0)),r_&&U_(ga,K_.Video_Recv_Frame_Rate_Output,r_.frameRate);const mE=($_=ue._player)===null||$_===void 0?void 0:$_.rendFrameRate.toFixed(0);if(mE&&U_(ga,K_.Video_Render_Frame_Rate_Render,+mE),U_(ga,K_.Video_Recv_Jitter_Buffer,_u.jitterBufferMs),U_(ga,K_.Video_Recv_Current_Delay,_u.currentDelayMs),U_(ga,K_.Video_Recv_Firs,_u.firsCount),U_(ga,K_.Video_Recv_Nacks,_u.nacksCount),U_(ga,K_.Video_Recv_Plis,_u.plisCount),ue){ga[K_.Video_Recv_Disabled]=ue._originMediaStreamTrack.enabled&&ue._mediaStreamTrack.enabled?0:1;const pE=ue._player;if(pE){const{freezeTimeCounterList:PS,renderFreezeAccTime:s_,renderFreezeAccTime2:__,videoElementStatus:N_}=pE;if(PS&&PS.length>0&&U_(ga,RR.Video_Render_Freeze_Time,PS.splice(0,1)[0]),Fi&&jR.visibility==="visible"&&N_===CS.PLAYING&&uE().supportRequestVideoFrameCallback){const c_=Math.min(6e3,__);pE.renderFreezeAccTime2=Math.max(0,__-c_),U_(ga,RR.Video_Render_Freeze_Time_Render2,c_);const zt=Math.min(6e3,s_);pE.renderFreezeAccTime=Math.max(0,s_-zt),U_(ga,RR.Video_Render_Freeze_Time_Render,_s("USE_NEW_RENDER_FREEZE_TIME")?c_:zt)}if(typeof _u.totalFreezesDuration=="number"){const c_=F_&&F_.totalFreezesDuration?_u.totalFreezesDuration-F_.totalFreezesDuration:_u.totalFreezesDuration;U_(ga,K_.Video_Render_Freeze_Duration,1e3*c_)}}}if(ga[K_.Video_Recv_Player_Status]=gF[ue._player?ue._player.videoElementStatus:"uninit"],F_&&_u.totalInterFrameDelay!==void 0&&_u.totalSquaredInterFrameDelay!==void 0&&F_.totalInterFrameDelay!==void 0&&F_.totalSquaredInterFrameDelay!==void 0){const pE=_u.totalInterFrameDelay-F_.totalInterFrameDelay,PS=_u.totalSquaredInterFrameDelay-F_.totalSquaredInterFrameDelay,s_=_u.framesDecodeCount-F_.framesDecodeCount,__=pE/s_*1e3,N_=Math.round(1e3*Math.sqrt((PS-Math.pow(pE,2)/s_)/s_));!isNaN(N_)&&__+N_>Math.max(3*__,__+150)&&(ga[K_.Video_Recv_I_Frame_Delay]=N_)}}return ga}(C._videoSSRC,r,C.videoTrack,H===!0,this.needUploadRenderFreezeTime,i,d,h):void 0;$&&(x.video=$)}if(P.has(A_.AUDIO)&&C.audioTrack){const H=C.audioTrack?function($,_t,_i,ue,_r,Fi){const Di=_t.audioRecv.find(ga=>ga.ssrc===$);if(!Di)return;const Js={};U_(Js,gS.Audio_Recv_Jitter,Di.jitterMs),U_(Js,gS.Audio_Recv_Bytes_Retransmit,Di.retransmittedBytesReceived),U_(Js,gS.Audio_Recv_Packages_Retransmit,Di.retransmittedPacketsReceived),U_(Js,gS.Audio_Recv_Packages_Discarded,Di.packetsDiscarded),U_(Js,gS.Audio_Recv_Avg_Processing_Delay,Di.avgProcessingDelayMs);const _l=Fi&&Fi.audioRecv.find(ga=>ga.ssrc===$);if(_l){const ga=RI;Di.packets!=null&&_l.packets!=null&&U_(Js,gS.Audio_Recv_Package_Rate,1e3*(Di.packets-_l.packets)/ga),Di.packetsLost!=null&&_l.packetsLost!=null&&U_(Js,gS.Audio_Recv_Package_Lost,Di.packetsLost-_l.packetsLost)}if(ue){const{receivedFrames:ga,droppedFrames:_m}=Di;ga!=null&&_m!=null&&(Js[RR.Audio_Recv_Freeze]=(_u=ga)===0||100*_m/_u>20?1:0)}var _u;if(_r){const ga=100*_i._source.getAccurateVolumeLevel(),_m=Di.outputLevel;if(_m!=null){const a_=Math.ceil(50*Math.log10(100*_m+1));U_(Js,K_.Audio_Render_Level,a_)}U_(Js,K_.Audio_Recv_PCM_Level,ga),_i&&(Js[K_.Audio_Recv_Disabled]=_i._originMediaStreamTrack.enabled&&_i._mediaStreamTrack.enabled?0:1),U_(Js,K_.Audio_Recv_Jitter_Buffer,Di.jitterBufferMs),U_(Js,K_.Audio_Recv_Current_Delay,Di.jitterBufferMs),Js[K_.Audio_Recv_Player_Status]=gF[YS.getPlayerState(_i.getTrackId())];const r_=_r.audioRecv.find(a_=>a_.ssrc===$);if(r_){r_.bytes!=null&&Di.bytes!=null&&U_(Js,K_.Audio_Recv_Bitrate,8*(Di.bytes-r_.bytes)/(RI*sP));const a_=Di.concealedSamples-r_.concealedSamples;a_>0&&U_(Js,K_.Audio_Recv_Concealed_Samples,a_);const p_=Di.totalSamplesReceived-r_.totalSamplesReceived;p_>0&&U_(Js,K_.Audio_Recv_Total_Samples_Received,p_);const Q_=Di.freezeSamples80-r_.freezeSamples80;Q_>0&&U_(Js,K_.Audio_Render_Freeze_Samples_80ms,Q_);const $_=Di.freezeSamples200-r_.freezeSamples200;$_>0&&U_(Js,K_.Audio_Render_Freeze_Samples_200ms,$_);const F_=Di.freezeMs80-r_.freezeMs80;U_(Js,K_.Audio_Render_Freeze_Time_80ms,F_<0?0:F_);const mE=Di.freezeMs200-r_.freezeMs200;U_(Js,K_.Audio_Render_Freeze_Time_200ms,mE<0?0:mE)}}return Js}(C._audioSSRC,r,C.audioTrack,i,d,h):void 0;H&&(x.audio=H)}(x.video||x.audio)&&g.push(x)}),this.needUploadRenderFreezeTime=!this.needUploadRenderFreezeTime,g}startUploadTransportStats(){this.uploadTransportStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats()}stopUploadTransportStats(){this.uploadTransportStarted=!1}startUploadOutboundStats(){this.uploadOutboundStarted||(this.uploadOutboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=window.setInterval(()=>{if(!this.requestAllTracks||!this.requestUpload)return;const r=(this.requestAllTracks()||[]).find(i=>i instanceof zN);if(r&&r._external.getDenoiserStats){const i=r._external.getDenoiserStats();i&&this.requestUpload(JN.DENOISER_STATS,i)}},2e3),this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=window.setInterval(()=>{!this.requestAllTracks||!this.requestUpload||this.requestAllTracks().forEach(r=>{r.getProcessorStats().forEach(i=>{this.requestUpload&&this.requestUpload(i.type,i.stats)})})},2e3))}stopUploadOutboundStats(){this.uploadOutboundStarted&&(this.uploadOutboundStarted=!1,this.lastSendStats&&(this.lastSendStats.videoSend=[],this.lastSendStats.audioSend=[],this.lastSendStats=void 0),this.lastRefSendStats&&(this.lastRefSendStats.videoSend=[],this.lastRefSendStats.audioSend=[],this.lastRefSendStats=void 0),this.lastNormalSendStats&&(this.lastNormalSendStats.videoSend=[],this.lastNormalSendStats.audioSend=[],this.lastNormalSendStats=void 0),this.lastExtendStats={},this.needUploadStats={},this.uploadOutboundDenoiserStatsTimer&&window.clearInterval(this.uploadOutboundDenoiserStatsTimer),this.uploadOutboundDenoiserStatsTimer=void 0,this.uploadExtStatsTimer&&window.clearInterval(this.uploadExtStatsTimer),this.uploadExtStatsTimer=void 0)}startUploadInboundStats(){this.uploadInboundStarted||(this.uploadInboundStarted=!0,this.uploadWRTCStatsTimer||this.startUploadWRTCStats(),this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=window.setInterval(()=>{!this.requestUpload||!this.requestRemoteMedia||(this.requestRemoteMedia()||[]).forEach(r=>{let[i,d]=r;d.has(A_.VIDEO)&&i.videoTrack&&i.videoTrack.getProcessorStats().forEach(h=>{this.requestUpload&&this.requestUpload(h.type,h.stats)}),d.has(A_.AUDIO)&&i.audioTrack&&i.audioTrack.getProcessorStats().forEach(h=>{this.requestUpload&&this.requestUpload(h.type,h.stats)})})},2e3))}stopUploadInboundStats(){this.uploadInboundStarted&&(this.uploadInboundStarted=!1,this.lastRecvStats&&(this.lastRecvStats.videoRecv=[],this.lastRecvStats.audioRecv=[],this.lastRecvStats=void 0),this.lastRefRecvStats&&(this.lastRefRecvStats.videoRecv=[],this.lastRefRecvStats.audioRecv=[],this.lastRefRecvStats=void 0),this.lastNormalRecvStats&&(this.lastNormalRecvStats.videoRecv=[],this.lastNormalRecvStats.audioRecv=[],this.lastNormalRecvStats=void 0),this.lastUploadCompensateTime=-1,this.uploadCompensateDeltaTime=0,this.needUploadRenderFreezeTime=!0,this.uploadInboundExtStatsTimer&&window.clearInterval(this.uploadInboundExtStatsTimer),this.uploadInboundExtStatsTimer=void 0)}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer);const r=new Map;this.uploadExtUsageStatsTimer=window.setInterval(async()=>{const i=Date.now(),d={connectionInterval:_s("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:i};let h=[];const f=this.requestAllTracks&&this.requestAllTracks()||[];for(const P of f)!P.muted&&P.enabled&&(h=h.concat(await P.getProcessorUsage()));const g=this.requestRemoteMedia&&this.requestRemoteMedia()||[];for(const[P,x]of g)x.has(A_.VIDEO)&&P.videoTrack&&(h=h.concat(await P.videoTrack.getProcessorUsage())),x.has(A_.AUDIO)&&P.audioTrack&&(h=h.concat(await P.audioTrack.getProcessorUsage()));if(h.length===0)return;d.details=function(P,x){const H={};for(const{id:ue,value:_r,level:Fi,direction:Di}of P){var $;const Js=($=x.get(ue))!==null&&$!==void 0?$:0,_l=_r===2?Js+_s("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:Js;var _t,_i;x.set(ue,_l),H[ue]?(_r===2&&(H[ue].value=_r),Fi>H[ue].level&&(H[ue].level=Fi),Di==="remote"&&(H[ue].remoteUidCount+=1),H[ue].totalTs=(_t=x.get(ue))!==null&&_t!==void 0?_t:0):H[ue]={value:_r,level:Fi,remoteUidCount:Di==="local"?0:1,totalTs:(_i=x.get(ue))!==null&&_i!==void 0?_i:0}}return Object.keys(H).map(ue=>{const{level:_r,value:Fi,totalTs:Di}=H[ue];return{id:ue,level:_r,value:Fi,totalTs:Di}})}(h,r);const b=Date.now(),C=b>i?b:i+1;this.requestUpload&&this.requestUpload(JN.EXTENSION_USAGE_STATS,{usageStats:d,sendTs:C})},_s("EXTENSION_USAGE_UPLOAD_INTERVAL"))}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.uploadExtUsageStatsTimer&&window.clearInterval(this.uploadExtUsageStatsTimer),this.uploadExtUsageStatsTimer=void 0)}stopUploadBaseStats(){this.uploadBaseStatsStarted=!1}}const Dht=_s("ICE_RESTART_INTERVAL");let g1=new Map,qO=new Map,V0=[OS.UDP_TCP_RELAY,OS.TCP_RELAY,OS.RELAY],mG=_s("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&uE().supportPCSetConfiguration;function gX(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const i=g1.get(e.id);i&&(window.clearTimeout(i),g1.delete(e.id));const d=qO.get(e.id);r&&d&&d.index===V0.length-1&&(Wt.debug("[".concat(e.id,"] reset ICE restart policy")),qO.delete(e.id))}function vX(e,r,i){if(g1.size===0&&qO.size===0&&(Array.isArray(_s("RESTART_SEQUENCE"))&&_s("RESTART_SEQUENCE").length>0&&!function(b,C){if(b.length!==C.length)return!1;for(let P=0;P<b.length;P+=1){const x=b[P];if(b.filter(H=>H===x).length!==C.filter(H=>H===x).length)return!1}return!0}(V0,_s("RESTART_SEQUENCE"))&&(V0=_s("RESTART_SEQUENCE").filter(b=>{var C;if(E_(C=Object.values(OS)).call(C,b))return!0}),Wt.debug("use reconnection policy from config distribution, queues: ".concat(V0.join(" => ")))),mG=_s("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&uE().supportPCSetConfiguration),V0.length===0)return void i();let d,{index:h=0,type:f}=qO.get(e.id)||{};if(mG&&f===OS.RELAY)return void i();let g=f&&h>=V0.length-1;if(mG)f=OS.RELAY;else{if(g)return void i();f?(h++,f=V0[h]):(f=V0[0],h=0)}Wt.debug("[".concat(e.id,"] choose ICE restart policy: ").concat(f,", index: ").concat(h)),r(f),qO.set(e.id,{index:h,type:f}),d=window.setTimeout(()=>vX(e,r,i),Dht),g1.set(e.id,d)}var eE;function bX(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function GR(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?bX(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):bX(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}function yX(e){var r,i,d,h=2;for(typeof Symbol<"u"&&(i=kV,d=Symbol.iterator);h--;){if(i&&(r=e[i])!=null)return r.call(e);if(d&&(r=e[d])!=null)return new v1(r.call(e));i="@@asyncIterator",d="@@iterator"}throw new TypeError("Object is not async iterable")}function v1(e){function r(i){if(Object(i)!==i)return T_.reject(new TypeError(i+" is not an object."));var d=i.done;return T_.resolve(i.value).then(function(h){return{value:h,done:d}})}return v1=function(i){this.s=i,this.n=i.next},v1.prototype={s:null,n:null,next:function(){return r(this.n.apply(this.s,arguments))},return:function(i){var d=this.s.return;return d===void 0?T_.resolve({value:i,done:!0}):r(d.apply(this.s,arguments))},throw:function(i){var d=this.s.return;return d===void 0?T_.reject(i):r(d.apply(this.s,arguments))}},new v1(e)}let aP=(eE=class extends qE{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(L_.StateChange,r,this._state)}constructor(e,r){super(),Ei(this,"isPlanB",void 0),Ei(this,"store",void 0),Ei(this,"statsUploader",void 0),Ei(this,"connection",void 0),Ei(this,"localTrackMap",new Map),Ei(this,"remoteUserMap",new Map),Ei(this,"localDataChannels",[]),Ei(this,"remoteDataChannelMap",new Map),Ei(this,"pendingLocalTracks",[]),Ei(this,"pendingRemoteTracks",[]),Ei(this,"pendingLocalDataChannels",[]),Ei(this,"pendingRemoteDataChannels",[]),Ei(this,"statsCollector",void 0),Ei(this,"shouldForwardP2PCreation",void 0),Ei(this,"iceFailedCount",0),Ei(this,"dtlsFailedCount",0),Ei(this,"mutex",void 0),Ei(this,"_state",EE.Disconnected),Ei(this,"_pcStatsUploadType",_s("NEW_ICE_RESTART")?s0.FIRST_CONNECTION:s0.OLD_FIRST_CONNECTION),Ei(this,"_isStartRestartIce",!1),Ei(this,"_restartTimer",void 0),Ei(this,"_isTryConnecting",!1),Ei(this,"_iceError",null),Ei(this,"_forceTurn",!1),Ei(this,"_isWaitPcToRePub",!1),Ei(this,"handleMuteLocalTrack",async(i,d,h)=>{const f=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==EE.Connected)return void h(new n_(Gi.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const g=this.filterTobeMutedTracks(i);if(g.length===0)return void d();const b=g.find(P=>P[0]==="videoLowTrack");if(b){const P=b[1];this.store.enableInstantMuteRestore?(P.track._originMediaStreamTrack.enabled=!1,Wt.info("[".concat(this.store.clientId,"] P2PChannel muteLocalLowTrack without close sender because enableInstantMuteRestore is true"))):P.track._originMediaStreamTrack.stop()}this.store.enableInstantMuteRestore?Wt.info("[".concat(this.store.clientId,"] P2PChannel muteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.muteLocal(g.map(P=>{let[,{id:x}]=P;return x}));const C=this.createMuteMessage(g);await CE(this,L_.RequestMuteLocal,C),d()}catch(g){h(g)}finally{f()}}),Ei(this,"handleUnmuteLocalTrack",async(i,d,h)=>{const f=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==EE.Connected)return void h(new n_(Gi.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const g=this.filterTobeUnmutedTracks(i);if(g.length===0)return void d();const b=g.find(P=>P[0]==="videoLowTrack");if(b){const P=b[1];if(this.store.enableInstantMuteRestore)P.track._originMediaStreamTrack.enabled=!0,Wt.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalLowTrack without close sender because enableInstantMuteRestore is true"));else{if(P.track._originMediaStreamTrack.stop(),!_s("DISABLE_DUAL_STREAM_USE_ENCODING")&&uE().supportDualStreamEncoding){const x=i._mediaStreamTrack.clone();P.track._mediaStreamTrack=x,P.track._originMediaStreamTrack=x}else{const x=fG(i,FN(this,L_.RequestLowStreamParameter));P.track._mediaStreamTrack=x,P.track._originMediaStreamTrack=x}await new T_((x,H)=>{this.handleReplaceTrack(P.track,x,H,!0)})}}this.store.enableInstantMuteRestore?Wt.info("[".concat(this.store.clientId,"] P2PChannel unmuteLocalTrack without close sender because enableInstantMuteRestore is true")):await this.connection.unmuteLocal(g.map(P=>{let[,{id:x}]=P;return x}));const C=this.createUnmuteMessage(g);await CE(this,L_.RequestUnmuteLocal,C),d()}catch(g){h(g)}finally{f()}}),Ei(this,"handleUpdateVideoEncoder",async(i,d,h,f)=>{let g;f||(g=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoEncoder"));try{const C=this.localTrackMap.get(l_.LocalVideoTrack);if(!this.connection||!C||C.track!==i||this.state!==EE.Connected)return void d();const{id:P,track:x}=C;await this.connection.updateSendParameters(P,x),await this.connection.updateEncoderConfig(P,x),this.emit(L_.UpdateVideoEncoder,x),d()}catch(C){h(C)}finally{var b;(b=g)===null||b===void 0||b()}}),Ei(this,"handleUpdateVideoSendParameters",async(i,d,h)=>{const f=await this.mutex.lock("Locking from P2PChannel.handleUpdateVideoSendParameters");try{const g=this.localTrackMap.get(l_.LocalVideoTrack);if(!this.connection||!g||g.track!==i||this.state!==EE.Connected)return void d();const{id:b,track:C}=g;await this.connection.updateSendParameters(b,C),d()}catch(g){h(g)}finally{f()}}),Ei(this,"handleReplaceMixingTrack",async(i,d,h,f)=>{if(!this.connection||this.state!==EE.Connected)return void d();const g=hG([i]);let b;Wt.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(g.getTrackId(),"]")),typeof f=="boolean"&&f||(b=await this.mutex.lock("From P2PChannel.handleReplaceMixingTrack"));try{await this.replaceTrack(i,g),d()}catch(P){h(P)}finally{var C;(C=b)===null||C===void 0||C()}}),Ei(this,"handleReplaceTrack",async(i,d,h,f)=>{let g;Wt.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof f=="boolean"&&f||(g=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var b;const P=Array.from(this.localTrackMap.entries()).find(x=>{let[,{track:H}]=x;return i===H});if(!this.connection||!P||this.state!==EE.Connected)return void d();if(await((b=this.connection)===null||b===void 0?void 0:b.replaceTrack(i,P[1].id)),this.isPlanB){const x=P[1];x.id=i._mediaStreamTrack.id,this.localTrackMap.set(P[0],x)}if(P[0]===l_.LocalVideoTrack&&!_s("DISABLE_DUAL_STREAM_USE_ENCODING")&&uE().supportDualStreamEncoding){const x=this.localTrackMap.get(l_.LocalVideoLowTrack);if(x){const H=i._mediaStreamTrack.clone();x.track._originMediaStreamTrack.stop(),x.track._mediaStreamTrack=H,x.track._originMediaStreamTrack=H,await new T_(($,_t)=>{this.handleReplaceTrack(x.track,$,_t,!0)})}}d()}catch(P){h(P)}finally{var C;(C=g)===null||C===void 0||C()}}),Ei(this,"handleGetRTCStats",i=>{i(this.statsCollector.getRTCStats())}),Ei(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),Ei(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),Ei(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),Ei(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new EX(this.store),this.bindStatsUploaderEvents(),this.mutex=new wS("P2PChannel-mutex",this.store.clientId),this.isPlanB=!uE().supportUnifiedPlan||_s("CHROME_FORCE_PLAN_B")&&n0(),this.shouldForwardP2PCreation=_s("FORWARD_P2P_CREATION")&&uE().supportPCSetConfiguration&&zV(),this.shouldForwardP2PCreation&&(this.connection=m1(this.store),this.emit(L_.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,r){var i;this.state=EE.New,this._forceTurn=hX(e),Wt.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] forceTurn: ").concat(this._forceTurn));const d=this.shouldForwardP2PCreation&&((i=this.connection)===null||i===void 0?void 0:i.peerConnectionState)==="closed";if((!this.shouldForwardP2PCreation||d||r)&&((d||r)&&this.connection&&(Wt.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.resetConnection(this.connection)),this.connection=m1(this.store,e),this.emit(L_.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),!this.connection)throw new n_(Gi.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=_s("NEW_ICE_RESTART")?s0.FIRST_CONNECTION:s0.OLD_FIRST_CONNECTION,this._isTryConnecting=!0,this._isStartRestartIce=!1,this._iceError=null,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e){if(!this.connection)throw new n_(Gi.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");if(this.isPreallocation()&&this.state===EE.Connected){if(this.connection instanceof kT&&this.connection.checkDtlsParameters(e.dtlsParameters.fingerprints))return Wt.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] dtls parameters mismatch, try next.")),k_.reportApiInvoke(this.store.sessionId,{name:QE.MISMATCH_DTLS_PARAMETERS,options:[e.dtlsParameters.fingerprints],tag:FE.TRACER}).onSuccess(),void setTimeout(()=>{this.emit(L_.RequestReconnect)});await this.connection.updateRemoteConnect(e)}else this.store.peerConnectionStart(),await this.connection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=EE.Connected}updateRemoteRTPCapabilities(e){const r=Array.from(this.localTrackMap.entries()).filter(h=>{var f;let[g]=h;return E_(f=[l_.LocalVideoLowTrack,l_.LocalVideoTrack]).call(f,g)}),i=r.map(h=>{let[,{id:f}]=h;return f}),d=r.map(h=>{let[f]=h;return f});if(this.connection instanceof kT){if(k_.updateRemoteRTPCapabilities(this.store.sessionId,{trackTypes:JSON.stringify(d),localCodecs:JSON.stringify(this.connection.localCodecs),remoteCodecs:JSON.stringify(e)}),!E_(e).call(e,this.store.codec)){const h=["vp9","vp8","h264"].find(f=>E_(e).call(e,f));h&&(this.store.codec=h,Wt.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId," updateRemoteRTPCapabilities] default codec is not available, hence the fallback to ").concat(h,".")))}this.connection.updateRemoteRTPCapabilities(i,e)}}async getEstablishParams(){var e;if(this.connection instanceof kT&&this.connection.peerConnectionState!=="closed"&&E_(e=[EE.New,EE.Connected]).call(e,this.state))return this.connection.establishPromise}async publishDataChannel(e){if(!this.connection||this.state!==EE.Connected){if(this.state===EE.Disconnected)throw new n_(Gi.UNEXPECTED_ERROR,"PeerConnection already disconnected.");return e.forEach(i=>{var d;E_(d=this.pendingLocalDataChannels).call(d,i)||this.pendingLocalDataChannels.push(i)}),[]}const r=this.filterTobePublishedDataChannels(e);return r.length===0?[]:(r.forEach(i=>{const d=Date.now();this.store.publish(i.id.toString(),"datachannel",d)}),await this.connection.createDataChannels(this.store.uid,r),r.forEach(i=>{this.localDataChannels.push(i);const d=Date.now();this.store.publish(i.id+"","datachannel",void 0,d)}),e.map(i=>({streamId:i.id,ordered:i.ordered,maxRetransmits:i.maxRetransmits,metadata:i.metadata,channelId:i._originDataChannelId})))}publish(e,r,i){var d=this;return CT(function*(){const h=yield cE(d.mutex.lock("From P2PChannel.publish"));try{var f;const g=d.connection&&E_(f=["disconnected","failed"]).call(f,d.connection.peerConnectionState);if(!d.connection||d.state!==EE.Connected||g){if(d.state===EE.Disconnected)throw new n_(Gi.UNEXPECTED_ERROR,"PeerConnection already disconnected.");d.throwIfTrackTypeNotMatch(e);const C=e.filter(P=>d.pendingLocalTracks.indexOf(P)===-1);return d.pendingLocalTracks=d.pendingLocalTracks.concat(C),void(g&&(d._isWaitPcToRePub=!0))}d.store.pubId=d.store.pubId+1,NS.markPublishStart(d.store.clientId,d.store.pubId);const b=d.filterTobePublishedTracks(e,r,i);if(b.length===0)return void(yield cE(d.tryToUnmuteAudio(e)));yield*lL(yX(d.doPublish(d.connection,b)))}finally{h()}})()}doPublish(e,r){var i=this;return CT(function*(){r.forEach($=>{let{track:_t,type:_i}=$;const ue=Date.now();i.store.publish(_t.getTrackId(),_i===l_.LocalAudioTrack?"audio":"video",ue)}),i.bindLocalTrackEvents(r);const d=r.map($=>{let{track:_t}=$;return _t}),h=yield cE(e.send(d,i.store.codec,i.store.audioCodec)),f=(yield cE(h.next())).value,g=i.createGatewayPublishMessage(r,f);let b;try{b=yield g}catch($){throw h.throw($),($==null?void 0:$.code)===Gi.WS_ABORT&&r.forEach(_t=>{let{track:_i}=_t;i.pendingLocalTracks.indexOf(_i)===-1&&i.pendingLocalTracks.push(_i)}),i.unbindLocalTrackEvents(r),$}const C=i.mapPubResToRemoteConfig(g,b,d),P=(yield cE(h.next(C))).value;if(i.state===EE.Disconnected)throw new n_(Gi.UNEXPECTED_ERROR,"PeerConnection already disconnected.");_s("ENABLE_VIDEO_SEI");const x=_s("ENABLE_ENCODED_TRANSFORM"),H=_s("ENABLE_AUDIO_METADATA");d.forEach(async $=>{const _t=$.getRTCRtpTransceiver();if(!_t||!x)return;const{interceptLocalVideoFrame:_i,interceptLocalAudioFrame:ue}=s1();$.trackMediaType===A_.VIDEO?await _i(_t.sender,$):$.trackMediaType===A_.AUDIO&&await ue(_t.sender,{metadata:H?()=>{const _r=$.metadata.shift();return _r&&_r.value}:void 0})}),r.forEach($=>{let{type:_t}=$;i.statsCollector.addLocalStats(_t)}),i.assignLocalTracks(r,P),i.statsUploader.startUploadOutboundStats(),r.forEach($=>{let{track:_t,type:_i}=$;const ue=Date.now();i.store.publish(_t.getTrackId(),_i===l_.LocalAudioTrack?"audio":"video",void 0,ue)})})()}async updateVideoStreamParameter(e,r){const i=this.localTrackMap.get(r);if(!i||!this.connection)return;if(!(i.track instanceof LE))return Wt.warn("[updateVideoStreamParameter]: track is not an instance of LocalVideoTrack");const{track:d}=i,h=function(f,g){const b={};return f.height&&f.width&&(b.scaleResolutionDownBy=JF(f,g)),b.maxFramerate=f.framerate?dT(f.framerate):void 0,b.maxBitrate=f.bitrate?1e3*f.bitrate:void 0,b}(e,d);if(d._encoderConfig||(d._encoderConfig={}),r!==l_.LocalVideoLowTrack||!_s("DISABLE_DUAL_STREAM_USE_ENCODING")&&uE().supportDualStreamEncoding)h.scaleResolutionDownBy!=null&&(d._encoderConfig.scaleResolutionDownBy=h.scaleResolutionDownBy);else{const f=d._originMediaStreamTrack;if(!f.canvas)return Wt.warn("[".concat(d.getTrackId(),"] no canvas on track"));(function(g,b){const C=g.canvas;b.width&&(C.width=dT(b.width)),b.height&&(C.height=dT(b.height)),b.framerate&&(C.stopCapture&&C.stopCapture(),C.stopCapture=bF(()=>{!C.startCapture&&C.stopCapture&&C.stopCapture(),C.startCapture&&C.startCapture()},dT(b.framerate)))})(f,e)}h.maxBitrate!=null&&(d._encoderConfig.bitrateMax=h.maxBitrate/1e3),h.maxFramerate!=null&&(d._encoderConfig.frameRate&&typeof d._encoderConfig.frameRate=="object"?d._encoderConfig.frameRate.max=h.maxFramerate:d._encoderConfig.frameRate={max:h.maxFramerate}),Wt.debug("[".concat(d.getTrackId(),"] LowStreamEncoderConfig: , ").concat(JSON.stringify(d._encoderConfig))),await this.connection.updateRtpSenderEncodings(d)}publishLowStream(e){var r=this;return CT(function*(){if(!r.connection||r.state!==EE.Connected)return;const i=yield cE(r.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const h=r.localTrackMap.get(l_.LocalVideoTrack);if(!h)throw new n_(Gi.UNEXPECTED_ERROR,"Could not find high stream");if(r.localTrackMap.has(l_.LocalVideoLowTrack))throw new n_(Gi.UNEXPECTED_ERROR,"[".concat(r.store.clientId,"] Can't publish low stream when stream already publish"));const f=[{track:r.getLowVideoTrack(h.track,e),type:l_.LocalVideoLowTrack}];if(yield*lL(yX(r.doPublish(r.connection,f))),h.track.muted||!h.track.enabled){var d;const g=(d=r.localTrackMap.get(l_.LocalVideoLowTrack))===null||d===void 0?void 0:d.id;g!==void 0&&(yield cE(r.connection.muteLocal([g])))}}finally{i()}})()}async republish(){this.pendingLocalTracks.length>0&&(Wt.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await TS(this,L_.RequestRePublish,this.pendingLocalTracks),this.emit(L_.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[]),this.pendingLocalDataChannels.length>0&&(Wt.debug("Emit P2PChannelEvents.RequestRePublishDataChannel to republish datachannels."),await TS(this,L_.RequestRePublishDataChannel,this.pendingLocalDataChannels),this.pendingLocalDataChannels=[]),this._isWaitPcToRePub=!1}async reSubscribe(e){for(let r=this.pendingRemoteTracks.length-1;r>=0;r--){const{user:i,kind:d}=this.pendingRemoteTracks[r];(d!==A_.AUDIO||i._audio_added_&&i._audioSSRC)&&(d!==A_.VIDEO||i._video_added_&&i._videoSSRC)||this.pendingRemoteTracks.splice(r,1)}if(e)await TS(this,L_.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:r,kind:i}of this.pendingRemoteTracks)await this.subscribe(r,i,i===A_.VIDEO?r._videoSSRC:r._audioSSRC);this.pendingRemoteTracks.forEach(r=>{let{user:i}=r;this.emit(L_.MediaReconnectEnd,i.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==EE.Connected)return void e.forEach(d=>{const h=this.pendingLocalTracks.indexOf(d);h!==-1&&this.pendingLocalTracks.splice(h,1)});const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(d=>d[0]==="videoLowTrack");return i&&i[1].track.close(),this.doUnpublish(this.connection,r)}async unpublishDataChannel(e){if(!this.connection||this.state!==EE.Connected)return void e.forEach(i=>{const d=this.pendingLocalDataChannels.indexOf(i);d!==-1&&this.pendingLocalDataChannels.splice(d,1)});const r=this.filterTobeUnpublishedDataChannels(e);return r.length!==0?(r.forEach(i=>{const d=this.localDataChannels.indexOf(i);d!==-1&&this.localDataChannels.splice(d,1)}),this.localDataChannels.length===0&&await this.connection.stopDataChannels(this.store.uid),r.map(i=>i.id)):void 0}async unpublishLowStream(){if(!this.connection||this.state!==EE.Connected)return;const e=this.localTrackMap.get(l_.LocalVideoLowTrack);if(!e)return;e.track.close();const r=[[l_.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,r)}async doUnpublish(e,r){const i=this.createGatewayUnpublishMessage(r);return await e.stopSending(r.map(d=>{let[,{id:h}]=d;return h})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(d=>{let[h,{track:f}]=d;return{type:h,track:f}})),r.forEach(d=>{let[h]=d;this.statsCollector.removeLocalStats(h)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadOutboundStats(),i}async subscribeDataChannel(e,r){if(!this.connection||this.state!==EE.Connected)throw new n_(Gi.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");const i=r.filter(d=>{var h;return!((h=this.remoteDataChannelMap.get(e))!==null&&h!==void 0&&h.get(d.id))});if(i.length!==0)return await this.connection.createDataChannels(e.uid,i),i.forEach(d=>{var h;this.remoteDataChannelMap.has(e)?(h=this.remoteDataChannelMap.get(e))===null||h===void 0||h.set(d.id,d):this.remoteDataChannelMap.set(e,new Map([[d.id,d]]));const f=this.pendingRemoteDataChannels.findIndex(g=>{let{user:b,id:C}=g;return b.uid===e.uid&&C===d.id});f!==-1&&this.pendingRemoteDataChannels.splice(f,1)}),i.map(d=>d.id)}async subscribe(e,r,i,d,h){var f;if(!this.connection||this.state!==EE.Connected)throw new n_(Gi.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((f=this.remoteUserMap.get(e))!==null&&f!==void 0&&f.has(r))return;let g,b,C,P;const x=this.connection.getPreMedia(i);if(x)Wt.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] preSSRCMap has ssrcId: ").concat(i,", no need to send sub to gateway.")),C=x.transceiver,g=x.track,b=x.mid,P=x.player,x.firstVideoRender&&this.store.firstVideoFrameDecoded(e.uid,{firstPreRender:x.firstVideoRender});else if(h){const _t=h.find(ue=>{let{stream_type:_r}=ue;return _r===r});if(!_t)throw new n_(Gi.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(r," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(r,"."));const _i=await this.connection.receive(r,_t.ssrcs,String(e._uintid),_t.attributes);this.connection instanceof kT&&(C=_i.transceiver),g=_i.track,b=_i.id}else{const _t=await this.connection.receive(r,[{ssrcId:i,rtx:d}],String(e._uintid),void 0);this.connection instanceof kT&&(C=_t.transceiver),g=_t.track,b=_t.id}if(r===A_.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(g):(e._audioTrack=new NO(g,e.uid,e._uintid,this.store),Wt.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),C&&e._audioTrack._updateRtpTransceiver(C),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(g):(e._videoTrack=new OO(g,e.uid,e._uintid,this.store,P),Wt.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId())),e._videoTrack.once(NT.PLAY_START,()=>{this.store.firstVideoFrameDecoded(e.uid,{playStart:Date.now()})}),e._videoTrack.once(NT.PLAY_END,()=>{this.store.firstVideoFrameDecoded(e.uid,{playEnd:Date.now()}),this.reportVideoFirstFrameRender(e)}),P?e._videoTrack.once(NT.FIRST_FRAME_RENDER,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)}):e._videoTrack.once(NT.FIRST_FRAME_DECODED,()=>{this.store.firstVideoFrameDecoded(e.uid,{firstRender:Date.now()}),this.reportVideoFirstFrameRender(e)})),C&&e._videoTrack._updateRtpTransceiver(C),this.bindRemoteTrackEvents(e,e._videoTrack)),C&&_s("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:_t,interceptRemoteAudioFrame:_i}=s1();r==A_.VIDEO?await _t(C.receiver,{onSei:_s("ENABLE_VIDEO_SEI")&&(ue=>{var _r;return(_r=e._videoTrack)===null||_r===void 0?void 0:_r._onSei(ue)})}):r==A_.AUDIO&&await _i(C.receiver,{enableTopn:!!_s("ENABLE_AUDIO_TOPN"),enableMetadata:!!_s("ENABLE_AUDIO_METADATA"),enablePts:!!_s("ENABLE_AUDIO_PTS"),onMetadata:ue=>{this.safeEmit(L_.AudioMetadata,ue)},onPts:ue=>{this.safeEmit(L_.AudioPts,ue)}})}const H=this.remoteUserMap.get(e);H?H.set(r,b):this.remoteUserMap.set(e,new Map([[r,b]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats();const $=this.pendingRemoteTracks.findIndex(_t=>{let{user:_i,kind:ue}=_t;return _i.uid===e.uid&&r===ue});$!==-1&&(this.pendingRemoteTracks.splice($,1),this.emit(L_.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==EE.Connected)throw new n_(Gi.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(h=>{var f;let{user:g,mediaType:b}=h;return!((f=this.remoteUserMap.get(g))!==null&&f!==void 0&&f.has(b))});const r=[],i=new Map;e.forEach(h=>{if(!this.connection)return;const f=this.connection.getPreMedia(h.ssrcId);if(f){const{track:g,mid:b,transceiver:C,player:P}=f;i.set(h.ssrcId,{track:g,id:b,transceiver:C,player:P})}else r.push(h)});const d=await this.connection.batchReceive(r.map(h=>{let{user:f,mediaType:g,ssrcId:b,rtxSsrcId:C}=h;return{kind:g,ssrcMsg:[{ssrcId:b,rtx:C}],mslabel:String(f._uintid)}}));r.forEach((h,f)=>{i.set(h.ssrcId,d[f])});for(const{user:h,mediaType:f,ssrcId:g}of e){const b=i.get(g);if(!b)return void Wt.debug("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] cannot find ").concat(h.uid," subscribe data,").concat(f,", ").concat(g));const{track:C,id:P,transceiver:x,player:H}=b;if(x&&_s("ENABLE_ENCODED_TRANSFORM")){const{interceptRemoteVideoFrame:_i,interceptRemoteAudioFrame:ue}=s1();f==A_.VIDEO?await _i(x.receiver,{onSei:_s("ENABLE_VIDEO_SEI")&&(_r=>{var Fi;return(Fi=h._videoTrack)===null||Fi===void 0?void 0:Fi._onSei(_r)})}):f==A_.AUDIO&&await ue(x.receiver,{enableTopn:!!_s("ENABLE_AUDIO_TOPN"),enableMetadata:!!_s("ENABLE_AUDIO_METADATA"),enablePts:!!_s("ENABLE_AUDIO_PTS"),onMetadata:_r=>{this.safeEmit(L_.AudioMetadata,_r)},onPts:_r=>{this.safeEmit(L_.AudioPts,_r)}})}if(f===A_.AUDIO?(h._audioTrack?h._audioTrack._updateOriginMediaStreamTrack(C):(h._audioTrack=new NO(C,h.uid,h._uintid,this.store),Wt.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(h._audioTrack.getTrackId()))),x&&h._audioTrack._updateRtpTransceiver(x),this.bindRemoteTrackEvents(h,h._audioTrack)):(h._videoTrack?h._videoTrack._updateOriginMediaStreamTrack(C):(h._videoTrack=new OO(C,h.uid,h._uintid,this.store,H),Wt.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(h._videoTrack.getTrackId()))),x&&h._videoTrack._updateRtpTransceiver(x),this.bindRemoteTrackEvents(h,h._videoTrack)),_s("ENABLE_VIDEO_SEI")&&x){const{interceptRemoteVideoFrame:_i,interceptRemoteAudioFrame:ue}=s1();f==A_.VIDEO?await _i(x.receiver,{onSei:_r=>{var Fi;(Fi=h._videoTrack)===null||Fi===void 0||Fi._onSei(_r)}}):f==A_.AUDIO&&await ue(x.receiver)}const $=this.remoteUserMap.get(h);$?$.set(f,P):this.remoteUserMap.set(h,new Map([[f,P]])),this.statsCollector.addRemoteStats(h.uid),this.statsUploader.startUploadInboundStats();const _t=this.pendingRemoteTracks.findIndex(_i=>{let{user:ue,kind:_r}=_i;return ue.uid===h.uid&&f===_r});_t!==-1&&(this.pendingRemoteTracks.splice(_t,1),this.emit(L_.MediaReconnectEnd,h.uid))}}async unsubscribe(e,r,i){const d=this.pendingRemoteTracks.filter(g=>{let{user:b,kind:C}=g;return r!==void 0?b.uid===e.uid&&r===C:b.uid===e.uid});if(d.forEach(g=>{const b=this.pendingRemoteTracks.indexOf(g);this.pendingRemoteTracks.splice(b,1)}),this.connection&&this.state===EE.Connected||i||d.forEach(g=>{let{kind:b}=g;var C;if(b===A_.AUDIO)(C=e._audioTrack)===null||C===void 0||C._destroy(),e._audioTrack=void 0;else if(b===A_.VIDEO){var P;(P=e._videoTrack)===null||P===void 0||P._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==EE.Connected)return;const h=this.filterTobeUnSubscribedTracks(e,r);if(h.length===0)return;await this.connection.stopReceiving(h.map(g=>{let[,{id:b}]=g;return b}));const f=this.createUnsubscribeMessage(h);return this.withdrawRemoteTracks(h),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),h.forEach(g=>{let[b,{kind:C}]=g;var P,x;if(C===A_.VIDEO&&b._videoSSRC&&((P=this.connection)===null||P===void 0||P.setStatsRemoteVideoIsReady(b._videoSSRC,!1)),C===A_.VIDEO)this.unbindRemoteTrackEvents(b._videoTrack),i||((x=b._videoTrack)===null||x===void 0||x._destroy(),b._videoTrack=void 0);else if(C===A_.AUDIO){var H;this.unbindRemoteTrackEvents(b._audioTrack),!i&&((H=b._audioTrack)===null||H===void 0||H._destroy(),b._audioTrack=void 0)}}),f}async unsubscribeDataChannel(e,r){if(r.forEach(h=>{const f=this.pendingRemoteDataChannels.findIndex(g=>g.id===h.id);f!==-1&&this.pendingRemoteDataChannels.splice(f,1)}),!this.connection)return;const i=this.filterTobeUnSubscribedDataChannels(e,r);if(i.length===0)return;r.forEach(h=>{h._close()});const d=this.remoteDataChannelMap.get(e);return i.forEach(h=>{d&&d.delete(h.id)}),d&&d.size===0&&(this.remoteDataChannelMap.delete(e),await this.connection.stopDataChannels(e.uid)),i.map(h=>h.id)}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let r=[];for(const{user:h,mediaType:f}of e){const g=this.pendingRemoteTracks.filter(b=>{let{user:C,kind:P}=b;return f!==void 0?C.uid===h.uid&&f===P:C.uid===h.uid});g.forEach(b=>{const C=this.pendingRemoteTracks.indexOf(b);this.pendingRemoteTracks.splice(C,1)}),r=r.concat(g)}if(!this.connection||this.state!==EE.Connected)return void r.forEach(h=>{let{user:f,kind:g}=h;var b;if(g===A_.AUDIO)(b=f._audioTrack)===null||b===void 0||b._destroy(),f._audioTrack=void 0;else if(g===A_.VIDEO){var C;(C=f._videoTrack)===null||C===void 0||C._destroy(),f._videoTrack=void 0}});const i=GT(e).call(e,(h,f)=>{let{user:g,mediaType:b}=f;const C=this.filterTobeUnSubscribedTracks(g,b);return h.concat(C)},[]);if(i.length===0)return;await this.connection.stopReceiving(i.map(h=>{let[,{id:f}]=h;return f}));const d=this.createUnsubscribeAllMessage(i);return this.withdrawRemoteTracks(i),this.remoteUserMap.size===0&&this.statsUploader.stopUploadInboundStats(),i.forEach(h=>{let[f,{kind:g}]=h;var b,C;if(g===A_.VIDEO&&f._videoSSRC&&((b=this.connection)===null||b===void 0||b.setStatsRemoteVideoIsReady(f._videoSSRC,!1)),g===A_.VIDEO)this.unbindRemoteTrackEvents(f._videoTrack),(C=f._videoTrack)===null||C===void 0||C._destroy(),f._videoTrack=void 0;else if(g===A_.AUDIO){var P;this.unbindRemoteTrackEvents(f._audioTrack),(P=f._audioTrack)===null||P===void 0||P._destroy(),f._audioTrack=void 0}}),d}isPreSubScribe(e){return!this.connection||this.state!==EE.Connected?!1:!!this.connection.getPreMedia(e)}async muteRemote(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void Wt.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void Wt.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const d=r===A_.VIDEO?e._videoSSRC:e._audioSSRC;d!==void 0&&this.connection.setStatsRemoteVideoIsReady(d,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.connection)return;const i=this.remoteUserMap.get(e);if(!i)return void Wt.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||Wt.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}addAudioMetadata(e){const r=this.localTrackMap.get(l_.LocalAudioTrack),i=r&&r.track;i&&i.metadata.push(e)}getAllTracks(e){const r=this.localTrackMap.get(l_.LocalAudioTrack);if((r==null?void 0:r.track)instanceof eS){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(d=>{let[h]=d;return h!==l_.LocalAudioTrack}).filter(d=>{let[h]=d;return!(e&&h===l_.LocalVideoLowTrack)}).map(d=>{let[,{track:h}]=d;return h}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[d]=i;return!(e&&d===l_.LocalVideoLowTrack)}).map(i=>{let[,{track:d}]=i;return d})}getAllDataChannels(){return this.localDataChannels}reportPublishEvent(e,r,i,d,h){if(e){const g=this.localTrackMap.get(l_.LocalAudioTrack),b=d?this.localTrackMap.get(l_.LocalVideoLowTrack):this.localTrackMap.get(l_.LocalVideoTrack);k_.publish(this.store.sessionId,{eventElapse:NS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:g==null?void 0:g.track.getTrackLabel(),videoName:b==null?void 0:b.track.getTrackLabel(),screenshare:(b==null?void 0:b.track._hints.indexOf(wE.SCREEN_TRACK))!==-1,audio:!!g,video:!!b,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:h})}else{var f;i||(i=[]);const g=i.find(C=>C instanceof XE),b=d?(f=this.localTrackMap.get(l_.LocalVideoTrack))===null||f===void 0?void 0:f.track:i.find(C=>C instanceof LE);k_.publish(this.store.sessionId,{eventElapse:NS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:g==null?void 0:g.getTrackLabel(),videoName:b==null?void 0:b.getTrackLabel(),screenshare:(b==null?void 0:b._hints.indexOf(wE.SCREEN_TRACK))!==-1,audio:!!g,video:!!b,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:h})}}reportSubscribeEvent(e,r,i,d){const h=d===A_.VIDEO?i._videoSSRC:i._audioSSRC;h&&k_.subscribe(this.store.sessionId,{succ:e,ec:r,video:d===A_.VIDEO,audio:d===A_.AUDIO,peerid:i.uid,subscribeRequestid:h,p2pid:this.store.p2pId,eventElapse:NS.measureFromSubscribeStart(this.store.clientId,h),preSsrc:this.isPreSubScribe(h)})}reset(){Wt.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new wS("P2PChannel-mutex",this.store.clientId),this.connection&&(this.resetConnection(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=m1(this.store),this.emit(L_.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.statsUploader.stopUploadBaseStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(l_.LocalAudioTrack);if((e==null?void 0:e.track)instanceof eS){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.localDataChannels=[],this.remoteDataChannelMap.clear(),this.pendingLocalDataChannels=[],this.pendingRemoteDataChannels=[],this.state=EE.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.connection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(l_.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(l_.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof LE||r&&r.track instanceof XE?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(tT(r=this.remoteUserMap).call(r)).find(d=>d.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[d]=i;return{uid:d.uid,level:d.audioTrack?100*d.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(l_.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=nI(e).call(e,(i,d)=>i.level-d.level),e}async disconnectForReconnect(){this.connection&&(Wt.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=EE.Reconnecting,_s("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.resetConnection(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=m1(this.store),this.emit(L_.PeerConnectionStateChange,this.connection.peerConnectionState),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:d}]=e;switch(i){case l_.LocalVideoTrack:E_(r=d._hints).call(r,wE.LOW_STREAM)?d.close():this.pendingLocalTracks.push(d);break;case l_.LocalAudioTrack:d instanceof eS?this.pendingLocalTracks=this.pendingLocalTracks.concat(d.trackList):this.pendingLocalTracks.push(d);case l_.LocalVideoLowTrack:}}),this.emit(L_.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(tT(i).call(i)).forEach(d=>{this.setPendingRemoteMedia(r,d)}),this.emit(L_.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.localDataChannels.length!==0&&(this.localDataChannels.forEach(e=>{this.pendingLocalDataChannels.push(e)}),this.localDataChannels.length=0),this.remoteDataChannelMap.size!==0&&(Array.from(this.remoteDataChannelMap.entries()).forEach(e=>{let[r,i]=e;Array.from(tT(i).call(i)).forEach(d=>{this.setPendingRemoteDataChannel(r,d)})}),this.remoteDataChannelMap.clear()),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),Wt.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteDataChannel(e,r){for(const i of this.pendingRemoteDataChannels){const{user:d,id:h}=i;if((e instanceof U0?e.uid:e)===d.uid&&h===r)return!0}return!1}setPendingRemoteDataChannel(e,r){this.hasPendingRemoteDataChannel(e,r)||this.pendingRemoteDataChannels.push({user:e,id:r})}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:d,kind:h}=i;if((e instanceof U0?e.uid:e)===d.uid&&r===h)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}restartICE(e){var r=this;return CT(function*(){if(!r.connection||r.state!==EE.Connected)return;const i=yield cE(r.mutex.lock("From P2PChannel.restartICE"));let d;try{d=yield cE(r.connection.restartICE(e));const f=yield cE(d.next());if(f.done)return;const g=f.value,b=yield g;switch(pG(r.connection)&&r.reportPCStats(Date.now(),!1,r._pcStatsUploadType),e){case OS.UDP_TCP_RELAY:r._pcStatsUploadType=s0.UDP_TCP_RESTART;break;case OS.TCP_RELAY:r._pcStatsUploadType=s0.TCP_RESTART;break;case OS.RELAY:r._pcStatsUploadType=s0.RELAY_RESTART;break;default:r._pcStatsUploadType=s0.OLD_RESTART}r._isTryConnecting=!0,d.next(b)}catch(f){var h;(h=d)===null||h===void 0||h.throw(f)}finally{i()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),r=this.localTrackMap.get(l_.LocalVideoTrack),i=this.localTrackMap.get(l_.LocalAudioTrack),d=e.videoSend.find(_t=>_t.ssrc===(r==null?void 0:r.ssrcs[0].ssrcId)),h=e.audioSend.find(_t=>_t.ssrc===(i==null?void 0:i.ssrcs[0].ssrcId));if(!d||!h)return 1;const f=mT(this,L_.NeedSignalRTT),g=d?d.rttMs:void 0,b=h?h.rttMs:void 0,C=g&&b?(g+b)/2:g||b,P=(C&&f?(C+f)/2:C||f)||0,x=100*e.sendPacketLossRate*.7/50+.3*P/1500,H=x<.17?1:x<.36?2:x<.59?3:x<.1?4:5,$=r==null?void 0:r.track;if($&&$._encoderConfig&&$._hints.indexOf(wE.SCREEN_TRACK)===-1){const _t=$._encoderConfig.bitrateMax,_i=e.bitrate.actualEncoded;if(_t&&_i){const ue=(1e3*_t-_i)/(1e3*_t);return aJ[ue<.15?0:ue<.3?1:ue<.45?2:ue<.6?3:4][H]}}return H}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[d]=i;const h=d._audioSSRC,f=d._videoSSRC,g=e.audioRecv.find(_i=>_i.ssrc===h),b=e.videoRecv.find(_i=>_i.ssrc===f);if(!g&&!b)return void(r+=1);const C=mT(this,L_.NeedSignalRTT),P=e.rtt,x=(P&&C?(P+C)/2:P||C)||0,H=g?g.jitterMs:void 0,$=e.recvPacketLossRate;let _t=.7*$*100/50+.3*x/1500;H&&(_t=.6*$*100/50+.2*x/1500+.2*H/400),r+=_t<.1?1:_t<.17?2:_t<.36?3:_t<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new T_((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}async replaceTrack(e,r){var i;if(Wt.debug("[".concat(this.store.clientId,"] P2PChannel replaceTrack from [").concat(e.getTrackId(),"] to [").concat(r.getTrackId(),"]")),!this.connection||this.state!==EE.Connected)return;const d=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:g}]=f;return e===g});if(!d)return;const h=d[0];if(e!==r&&(this.unbindLocalTrackEvents([{track:e,type:h}]),this.bindLocalTrackEvents([{track:r,type:h}]),d[1].track=r),await((i=this.connection)===null||i===void 0?void 0:i.replaceTrack(r,d[1].id)),this.isPlanB){const f=d[1];f.id=r._mediaStreamTrack.id,this.localTrackMap.set(h,f)}if(h===l_.LocalVideoTrack&&!_s("DISABLE_DUAL_STREAM_USE_ENCODING")&&uE().supportDualStreamEncoding){const f=this.localTrackMap.get(l_.LocalVideoLowTrack);if(f){const g=e._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=g,f.track._originMediaStreamTrack=g,await new T_((b,C)=>{this.handleReplaceTrack(f.track,b,C,!0)})}}}filterTobePublishedTracks(e,r,i){const d=[],h=this.getAllTracks();e=_O(e=e.filter(C=>h.indexOf(C)===-1));let f,g=!1;const b=this.localTrackMap.get(l_.LocalAudioTrack);for(const C of e){if(C instanceof LE&&(this.localTrackMap.has(l_.LocalVideoTrack)||g?new n_(Gi.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(d.push({track:C,type:l_.LocalVideoTrack}),g=!0),r)){const P=this.getLowVideoTrack(C,i);d.push({track:P,type:l_.LocalVideoLowTrack})}if(C instanceof XE)if(b){const P=b.track;if(P instanceof eS)lG([C]),P.addAudioTrack(C),this.bindLocalAudioTrackEvents(C,!0);else{const x=hG([P,C]);Wt.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will replace audioTrack [").concat(x.getTrackId(),"]")),this.replaceTrack(P,x)}}else f instanceof eS?(lG([C]),f.addAudioTrack(C)):f||!C._useAudioElement&&uE().webAudioMediaStreamDest&&!C._bypassWebAudio?f=hG(f?[C,f]:[C]):f=C}return f&&(Wt.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection will send audioTrack [").concat(f.getTrackId(),"]")),d.push({track:f,type:l_.LocalAudioTrack})),d}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=_O(e=e.filter(d=>i.indexOf(d)!==-1));for(const d of e){if(d instanceof XE){const h=this.localTrackMap.get(l_.LocalAudioTrack);if(!h)continue;h.track instanceof eS?(h.track.removeAudioTrack(d),this.unbindLocalAudioTrackEvents(d),h.track.trackList.length===0&&(r.push([l_.LocalAudioTrack,h]),h.track.close())):r.push([l_.LocalAudioTrack,h])}if(d instanceof LE){const h=this.localTrackMap.get(l_.LocalVideoTrack);if(!h)continue;r.push([l_.LocalVideoTrack,h]);const f=this.localTrackMap.get(l_.LocalVideoLowTrack);f&&r.push([l_.LocalVideoLowTrack,f])}}return r}filterTobePublishedDataChannels(e){return e=(e=_O(e)).filter(r=>this.localDataChannels.findIndex(i=>i.id===r.id)===-1)}filterTobeUnpublishedDataChannels(e){return e=(e=(e=_O(e)).filter(r=>this.localDataChannels.indexOf(r)!==-1)).filter(r=>r._originDataChannel)}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:d}=r;switch(d){case l_.LocalVideoTrack:i.addListener(P_.GET_STATS,this.handleGetLocalVideoStats),i.addListener(P_.GET_RTC_STATS,this.handleGetRTCStats),i.addListener(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(P_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(P_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(P_.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case l_.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case l_.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof eS?e.trackList.forEach(i=>{i.addListener(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(P_.GET_STATS,this.handleGetLocalAudioStats),i.addListener(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(P_.GET_STATS,this.handleGetLocalAudioStats),e.addListener(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||(e.addListener(P_.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.addListener(P_.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack)))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:d}]=r;return{track:d,type:i}})),e.forEach(r=>{let{track:i,type:d}=r;switch(d){case l_.LocalVideoTrack:i.off(P_.GET_STATS,this.handleGetLocalVideoStats),i.off(P_.GET_RTC_STATS,this.handleGetRTCStats),i.off(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(P_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(P_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(P_.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case l_.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case l_.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof eS?e.trackList.forEach(r=>{r.off(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(P_.GET_STATS,this.handleGetLocalAudioStats),r.off(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(P_.GET_STATS,this.handleGetLocalAudioStats),e.off(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(P_.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(P_.NEED_REPLACE_MIXING_TRACK,this.handleReplaceMixingTrack),e.off(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof OO&&r.addListener(P_.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof NO&&r.addListener(P_.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(P_.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(A_.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(A_.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,d)=>{var h;let f,g,{track:b,type:C}=i;switch(C){case l_.LocalAudioTrack:f=gE.Audio,g={dtx:b instanceof zN&&b._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case l_.LocalVideoTrack:f=E_(h=b._hints).call(h,wE.SCREEN_TRACK)?gE.Screen:gE.High,g=GR(GR({},TJ(b)),{},{codec:this.store.codec,svc_mode:e1()});break;case l_.LocalVideoLowTrack:f=gE.Low,g=GR(GR({},TJ(b)),{},{codec:this.store.codec,svc_mode:e1()})}return{stream_type:f,attributes:g,ssrcs:r[d]}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let d,[h,{track:f,ssrcs:g,id:b}]=r;switch(h){case l_.LocalVideoTrack:d=E_(i=f._hints).call(i,wE.SCREEN_TRACK)?gE.Screen:gE.High;break;case l_.LocalAudioTrack:d=gE.Audio;break;case l_.LocalVideoLowTrack:d=gE.Low}return{stream_type:d,ssrcs:g,mid:b}})}assignLocalTracks(e,r){e.forEach((i,d)=>{let{track:h,type:f}=i;this.localTrackMap.set(f,{track:h,id:r[d].id,ssrcs:r[d].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{if(Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(r,")")),this.emit(L_.PeerConnectionStateChange,r),r==="connecting"&&e instanceof kT&&!KE()&&_s("FIRST_TCP_CANDIDATE")&&window.setTimeout(()=>{r==="connecting"&&e.extendCandidate()},_s("FIRST_TCP_CANDIDATE_INTERVAL")),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(this._restartTimer&&(window.clearTimeout(this._restartTimer),this._restartTimer=void 0),e instanceof kT&&gX(e,!0),this._isTryConnecting&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isTryConnecting=!1,this._isStartRestartIce=!1,this._pcStatsUploadType=s0.DISCONNECTED_OR_FAILED,mT(this,L_.QueryClientConnectionState)==="CONNECTED"&&this._isWaitPcToRePub)){const i=this.pendingLocalTracks.map(h=>h.getTrackId()),d=this.pendingLocalDataChannels.map(h=>"dc_".concat(h.id));k_.reportApiInvoke(this.store.sessionId,{name:QE.REPUB_AFTER_PC_CONNECTED,options:i.concat(d),tag:FE.TRACER}).onSuccess(),this.republish()}if(_s("NEW_ICE_RESTART")&&e instanceof kT&&!KE()&&!this._forceTurn){if(E_(EJ).call(EJ,r)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const i=h=>{pG(e)&&(Wt.debug("[".concat(this.store.clientId,"] [P2PChannel] try to restartICE, type is ").concat(h)),mT(this,L_.QueryClientConnectionState)==="CONNECTED"&&this.emit(L_.RequestRestartICE,h))},d=()=>{pG(e)&&(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),Wt.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(L_.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())};return void(this._restartTimer=window.setTimeout(()=>{vX(e,i,d)},800))}}else{if(r==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&_s("ICE_RESTART")&&mT(this,L_.QueryClientConnectionState)==="CONNECTED"&&this.emit(L_.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(Wt.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isTryConnecting=!1,setTimeout(()=>this.emit(L_.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);r==="failed"&&(Wt.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),setTimeout(()=>this.emit(L_.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),k_.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:FE.TRACER}).onSuccess(),this.emit(L_.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const d=Array.from(tT(i=this.remoteUserMap).call(i)).find(f=>f._audioSSRC===r);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),(h=d.audioTrack)===null||h===void 0||h.emit(NT.FIRST_FRAME_DECODED),k_.firstRemoteFrame(this.store.sessionId,sS.FIRST_AUDIO_DECODE,jE.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:NS.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const d=Array.from(tT(i=this.remoteUserMap).call(i)).find(h=>h._audioSSRC===r);d&&k_.firstRemoteFrame(this.store.sessionId,sS.FIRST_AUDIO_RECEIVED,jE.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:NS.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,d)=>{var h;const f=Array.from(tT(h=this.remoteUserMap).call(h)).find(g=>g._videoSSRC===r);f&&this.store.firstVideoFrameDecoded(f.uid,{firstDecoded:Date.now()}),this.reportVideoFirstFrameDecoded(r,i,d)},e.onFirstVideoRender=r=>{var i;const d=Array.from(tT(i=this.remoteUserMap).call(i)).find(h=>h._videoSSRC===r);d&&(this.store.firstVideoFrameDecoded(d.uid,{firstPreRender:Date.now()}),this.reportVideoFirstFrameRender(d))},e.onFirstVideoReceived=r=>{var i;const d=Array.from(tT(i=this.remoteUserMap).call(i)).find(h=>h._videoSSRC===r);d&&(this.store.firstVideoFrameDecoded(d.uid,{firstReceived:Date.now()}),k_.firstRemoteFrame(this.store.sessionId,sS.FIRST_VIDEO_RECEIVED,jE.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:NS.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onSelectedLocalCandidateChanged=(r,i)=>{const d=r.candidateType==="relay",h=i.candidateType==="relay";i.candidateType!=="unknown"&&d===h||this.emit(L_.ConnectionTypeChange,d),Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(D0(i))," -> ").concat(JSON.stringify(D0(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(D0(i))," -> ").concat(JSON.stringify(D0(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.getLocalVideoStats=()=>{const r=this.statsCollector.getLocalVideoTrackStats(),i=this.statsCollector.getRTCStats();return GR(GR({},r),i)},e.onICECandidateError=r=>{this._iceError=r}}resetConnection(e){e instanceof kT&&function(r){qO.delete(r.id),gX(r)}(e),e.close(),this.emit(L_.PeerConnectionStateChange,"closed"),function(r){r.onConnectionStateChange=void 0,r.onICEConnectionStateChange=void 0,r.onICETransportStateChange=void 0,r.onDTLSTransportStateChange=void 0,r.onDTLSTransportError=void 0,r.onFirstAudioDecoded=void 0,r.onFirstAudioReceived=void 0,r.onFirstVideoDecoded=void 0,r.onFirstVideoReceived=void 0,r.onSelectedLocalCandidateChanged=void 0,r.onSelectedRemoteCandidateChanged=void 0,r.onFirstVideoDecodedTimeout=void 0,r.getLocalVideoStats=void 0}(e),this._isWaitPcToRePub=!1}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get(l_.LocalAudioTrack);if(e instanceof XE&&(i==null?void 0:i.track)instanceof eS)return i.track.isActive||r.push([l_.LocalAudioTrack,i]),r;const d=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:f}]=h;return e===f});if(d&&(r.push(d),d[0]===l_.LocalVideoTrack)){const h=this.localTrackMap.get(l_.LocalVideoLowTrack);h&&r.push([l_.LocalVideoLowTrack,h])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get(l_.LocalAudioTrack);if(e instanceof XE&&(i==null?void 0:i.track)instanceof eS)return i.track.isActive&&r.push([l_.LocalAudioTrack,i]),r;const d=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:f}]=h;return e===f});if(d)if(d[0]===l_.LocalVideoTrack){r.push(d);const h=this.localTrackMap.get(l_.LocalVideoLowTrack);h&&r.push([l_.LocalVideoLowTrack,h])}else r.push(d);return r}createMuteMessage(e){return e.map(r=>{var i;let d,[h,{track:f,ssrcs:g,id:b}]=r;switch(h){case l_.LocalAudioTrack:d=gE.Audio;break;case l_.LocalVideoTrack:d=E_(i=f._hints).call(i,wE.SCREEN_TRACK)?gE.Screen:gE.High;break;case l_.LocalVideoLowTrack:d=gE.Low}return{stream_type:d,ssrcs:g,mid:b}})}createUnmuteMessage(e){return e.map(r=>{var i;let d,[h,{track:f,ssrcs:g,id:b}]=r;switch(h){case l_.LocalAudioTrack:d=gE.Audio;break;case l_.LocalVideoTrack:d=E_(i=f._hints).call(i,wE.SCREEN_TRACK)?gE.Screen:gE.High;break;case l_.LocalVideoLowTrack:d=gE.Low}return{stream_type:d,ssrcs:g,mid:b}})}filterTobeUnSubscribedTracks(e,r){const i=[],d=this.remoteUserMap.get(e);if(!d)return i;if(r){const h=d.get(r);if(!h)return i;i.push([e,{kind:r,id:h}])}else Array.from(d.entries()).forEach(h=>{let[f,g]=h;i.push([e,{kind:f,id:g}])});return i}filterTobeUnSubscribedDataChannels(e,r){const i=[];return r.forEach(d=>{var h;(h=this.remoteDataChannelMap.get(e))!==null&&h!==void 0&&h.has(d.id)&&i.push(d)}),i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[d,{kind:h,id:f}]=i;switch(h){case A_.VIDEO:return void(d._videoSSRC&&r.push({stream_type:A_.VIDEO,ssrcId:d._videoSSRC}));case A_.AUDIO:return void(d._audioSSRC&&r.push({stream_type:A_.AUDIO,ssrcId:d._audioSSRC}))}}),r}createUnsubscribeAllMessage(e){const r=new Map;return e.forEach(i=>{let[d,{kind:h}]=i;if(r.has(d)){let f=r.get(d);h===A_.VIDEO?f|=cS.Video:f|=cS.Audio,r.set(d,f)}else h===A_.VIDEO?r.set(d,cS.Video):r.set(d,cS.Audio)}),{users:Array.from(r.entries()).map(i=>{let[d,h]=i;return{stream_id:d.uid,stream_type:h}})}}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:d}]=r;const h=this.remoteUserMap.get(i);h&&(h.delete(d),Array.from(h.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(l_.LocalVideoTrack),i=this.localTrackMap.get(l_.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new T_((d,h)=>{this.handleUpdateVideoEncoder(r.track,d,h,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new T_((d,h)=>{this.handleUpdateVideoEncoder(i.track,d,h,!0)}))}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}isPreallocation(){return this.connection instanceof kT&&this.connection.isPreallocation}isPreSub(){return this.connection instanceof kT&&this.connection.isPreSub()}mapPubResToRemoteConfig(e,r,i){return e.map((d,h)=>{var f;let{stream_type:g}=d;const b=(f=r.find(C=>{let{stream_type:P}=C;return g===P}))===null||f===void 0?void 0:f.attributes;if(b&&_s("DISABLE_SCREEN_SHARE_REMB")){const C=i[h]._hints;(E_(C).call(C,wE.SCREEN_TRACK)||E_(C).call(C,wE.SCREEN_LOW_TRACK))&&(b.remb=!1,Wt.debug("disable remb for screen share, hints:",C))}return b})}async tryToUnmuteAudio(e){for(let i=0;i<e.length;i++)if(e[i]instanceof XE){var r;const d=this.filterTobeUnmutedTracks(e[i]);if(d.length===0)continue;await((r=this.connection)===null||r===void 0?void 0:r.unmuteLocal(d.map(f=>{let[,{id:g}]=f;return g})));const h=this.createUnmuteMessage(d);return void await CE(this,L_.RequestUnmuteLocal,h)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.connection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(L_.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(L_.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks(),this.statsUploader.requestTransportStats=()=>{var e;return{connectState:((e=this.connection)===null||e===void 0?void 0:e.peerConnectionState)||"closed"}}}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await mS($j(this.dtlsFailedCount,Mb)),this.emit(L_.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),r=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),r.length>0&&await TS(this,L_.RequestUnpublishForReconnectPC,r),this.disconnectForReconnect(),this.emit(L_.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(l_.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof LE)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof LE).length>1)throw new n_(Gi.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof XE).length>1&&(e.some(r=>r instanceof XE&&r._bypassWebAudio)||!uE().webAudioMediaStreamDest))throw new n_(Gi.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof LE&&this.pendingLocalTracks.some(i=>i instanceof LE))throw new n_(Gi.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof XE&&this.pendingLocalTracks.some(i=>i instanceof XE)&&(!uE().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof XE&&i._bypassWebAudio)))throw new n_(Gi.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){var i;const d=!_s("DISABLE_DUAL_STREAM_USE_ENCODING")&&uE().supportDualStreamEncoding,h=GR(GR({},{width:160,height:120,framerate:15,bitrate:50}),r);let f;f=d?e._mediaStreamTrack.clone():fG(e,h);const g=AE(8,"track-low-"),b=new LE(f,GR(GR({},d&&{scaleResolutionDownBy:JF(h,e)}),{},{frameRate:h.framerate,bitrateMax:h.bitrate,bitrateMin:h.bitrate}),void 0,void 0,g);return b.on(mI.TRANSCEIVER_UPDATED,C=>{e._updateRtpTransceiver(C,TO.LOW_STREAM)}),b._hints.push(wE.LOW_STREAM),E_(i=e._hints).call(i,wE.SCREEN_TRACK)&&b._hints.push(wE.SCREEN_LOW_TRACK),e.on("sei-to-send",C=>{b.emit("sei-to-send",C)}),e.addListener(P_.NEED_CLOSE,()=>{b.close()}),b}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,r,i){let d=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof kT){var h,f,g,b;const C=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:P,dtlsTransportState:x,peerConnectionState:H}=this.connection,{local:$,remote:_t}=await this.connection.getSelectedCandidatePair();k_.pcStats(this.store.sessionId,{startTime:C,eventElapse:e-C||0,iceconnectionsate:P,dtlsstate:x,connectionstate:H,intSucc:r?1:2,error:this._iceError||d||"",selectedLocalCandidateProtocol:(h=$==null?void 0:$.protocol)!==null&&h!==void 0?h:"",selectedLocalCandidateType:(f=$.candidateType)!==null&&f!==void 0?f:"",selectedLocalCandidateAddress:"".concat($.address,":").concat($.port),selectedRemoteCandidateProtocol:(g=_t.protocol)!==null&&g!==void 0?g:"",selectedRemoteCandidateType:(b=_t.candidateType)!==null&&b!==void 0?b:"",selectedRemoteCandidateAddress:"".concat(_t.address,":").concat(_t.port),restartCnt:i,preallocation:this.connection.isPreallocation}),this._iceError=null}}reportVideoFirstFrameRender(e){const r=this.store.keyMetrics,i=r.firstVideoFrameDecoded.find(x=>x.userId===e.uid);if(!i)return;const{isInternalUpload:d,isExternalUpload:h}=i;if(d&&h)return;const{subscribeEnd:f,firstPreRender:g,peerPublishDuration:b,peerPubStatusMs:C}=i;let{firstRender:P=0}=i;if(f&&(P||g)&&b&&C){i.isInternalUpload=!0;const{playEnd:x}=i;x&&(i.isExternalUpload=!0);const{firstPreRender:H=0}=i;P=H||P;const $=e.videoTrack,_t={peer:e._uintid,width:($==null?void 0:$._videoWidth)||0,height:($==null?void 0:$._videoHeight)||0,ssrc:e._videoSSRC||0,p2pid:this.store.p2pId,peerPublishDuration:b,peerPubStatusMs:C,joinChannelStart:r.joinStart||0,preloadStart:r.preloadStart||0,preloadEnd:r.preloadEnd||0,apStart:r.requestAPStart||0,apEnd:r.requestAPEnd||0,suaEnd:r.requestSUAEnd||0,beforeConnect:r.beforeConnect||0,peerReceiver:r.peerReceiver||0,ice:r.iceConnectionEnd||0,pc:r.peerConnectionEnd||0,signalConnected:r.signalConnected||0,joinReq:r.joinReq||0,joinRes:r.joinRep||0,userJoinNotify:i.userJoinNotify||0,videoAddNotify:i.videoAddNotify||0,subscribeStart:i.subscribeStart||0,subscribeEnd:i.subscribeEnd||0,firstReceived:i.firstReceived||0,firstDecoded:i.firstDecoded||0,firstPreRender:H||0,firstRender:x?Math.max(P,x):Math.max(P,f),playStart:i.playStart||0,playEnd:i.playEnd||0,isPreSub:!(!e._videoSSRC||!this.isPreSubScribe(e._videoSSRC)),isPrePc:this.isPreallocation(),isPreInstantVideo:z4(this.store)};k_.firstXLAPeerFirstVideoFrame(this.store.sessionId,_t)}}reportVideoFirstFrameDecoded(e,r,i,d){var h;const f=Array.from(tT(h=this.remoteUserMap).call(h)).find(g=>g._videoSSRC===e);if(f){d||this.store.subscribe(f.uid,"video",void 0,void 0,void 0,void 0,Date.now());const g=this.store.keyMetrics,b=g.subscribe.find(C=>C.userId===f.uid&&C.type==="video");k_.firstRemoteVideoDecode(this.store.sessionId,sS.FIRST_VIDEO_DECODE,jE.FIRST_VIDEO_DECODE,{peer:f._uintid,videowidth:r,videoheight:i,subscribeElapse:NS.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:g.requestAPEnd||0,apStart:g.requestAPStart||0,joinGwEnd:g.joinGatewayEnd||0,joinGwStart:g.joinGatewayStart||0,pcEnd:g.peerConnectionEnd||0,pcStart:g.peerConnectionStart||0,subscriberEnd:(b==null?void 0:b.subscribeEnd)||0,subscriberStart:(b==null?void 0:b.subscribeStart)||0,videoAddNotify:(b==null?void 0:b.streamAdded)||0,state:d?1:0,firstFrame:(b==null?void 0:b.firstFrame)||0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.connection)return!1;const d=this.remoteUserMap.get(e);if(!d)return!1;const h=d.get(r);if(!h)return!1;const f=await this.connection.getRemoteSSRC(h);return f!==void 0&&f!==i}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===l_.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,TO.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},D_(eE.prototype,"startP2PConnection",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"startP2PConnection"),eE.prototype),D_(eE.prototype,"connect",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"connect"),eE.prototype),D_(eE.prototype,"updateRemoteRTPCapabilities",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"updateRemoteRTPCapabilities"),eE.prototype),D_(eE.prototype,"publishDataChannel",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"publishDataChannel"),eE.prototype),D_(eE.prototype,"unpublish",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"unpublish"),eE.prototype),D_(eE.prototype,"unpublishDataChannel",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"unpublishDataChannel"),eE.prototype),D_(eE.prototype,"unpublishLowStream",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"unpublishLowStream"),eE.prototype),D_(eE.prototype,"subscribeDataChannel",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"subscribeDataChannel"),eE.prototype),D_(eE.prototype,"subscribe",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"subscribe"),eE.prototype),D_(eE.prototype,"massSubscribe",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"massSubscribe"),eE.prototype),D_(eE.prototype,"unsubscribe",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"unsubscribe"),eE.prototype),D_(eE.prototype,"unsubscribeDataChannel",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"unsubscribeDataChannel"),eE.prototype),D_(eE.prototype,"massUnsubscribe",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"massUnsubscribe"),eE.prototype),D_(eE.prototype,"muteRemote",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"muteRemote"),eE.prototype),D_(eE.prototype,"unmuteRemote",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"unmuteRemote"),eE.prototype),D_(eE.prototype,"hasRemoteMediaWithLock",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"hasRemoteMediaWithLock"),eE.prototype),D_(eE.prototype,"disconnectForReconnect",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"disconnectForReconnect"),eE.prototype),D_(eE.prototype,"updateBitrateLimit",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"updateBitrateLimit"),eE.prototype),D_(eE.prototype,"remoteMediaSsrcChanged",[VS],Object.getOwnPropertyDescriptor(eE.prototype,"remoteMediaSsrcChanged"),eE.prototype),eE);function VS(e,r,i){const d=e[r];if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const h=this.mutex,f=await h.lock("From P2PChannel.".concat(r));try{for(var g=arguments.length,b=new Array(g),C=0;C<g;C++)b[C]=arguments[C];return await d.apply(this,b)}finally{f()}},i}function SX(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function TX(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?SX(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):SX(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}const kht=Date.now(),Lht=20,_G=new Map,b1=new Map;async function RX(e){const r=_G.get(e),i=Array.isArray(r)&&r[r.length-1],d=b1.get(e);if(!i)return void(d.isSyncing=!1);const h={uid:i.uid,payload:i.payload};d.firstRecvTs===0&&(d.firstRecvTs=i.recvTs,d.firstSendTs=i.sendTs);const f=i.sendTs-d.firstSendTs,g=f-(Date.now()-d.firstRecvTs);g>0&&(d.firstRecvTs=Date.now()-f);let b=i.mediaDelay+g;b<=0?(r.pop(),IX(i.context,h),b=0):b=Math.min(b,Lht),setTimeout(()=>r.length&&RX(e),b)}function IX(e,r){e.safeEmit(nE.STREAM_MESSAGE,r.uid,r.payload),e.onStreamMessage&&e.onStreamMessage(r)}function Mht(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(!e.syncWithAudio)return IX(i,{uid:e.uid,payload:e.payload});const d="".concat(i.id,"-").concat(e.uid),h=_G.get(d)||[],f=h.findIndex(P=>e.sendTs>=P.sendTs),g=TX(TX({},e),{},{context:i,mediaDelay:r,recvTs:Date.now()});f===-1?h.push(g):h.splice(f,0,g),_G.set(d,h);let b=!1;var C;b1.has(d)?b=!((C=b1.get(d))===null||C===void 0||!C.isSyncing):b1.set(d,{isSyncing:b,firstRecvTs:0,firstSendTs:0}),b||RX(d)}const xht=oE().name;function wX(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function CX(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?wX(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):wX(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}const WO="websdk_ng_cache_parameter",Uht=_s("MAX_PRELOAD_ASYNC_LENGTH"),Vht=1e4,II=new Map,wI=[];let EG=null,gG=0,vG=0;const y1=new Map,jht=function(e,r){const i=[];let d=0;const h=async()=>{const f=i.shift();f&&await f(),i.length>0&&d<r?h():d--};return async function(){for(var f=arguments.length,g=new Array(f),b=0;b<f;b++)g[b]=arguments[b];return new T_(async(C,P)=>{i.push(async()=>{try{const x=await e(...g);C(x)}catch(x){P(x)}}),d<r&&(d++,h())})}}(AX,Uht),bG=zS.CancelToken.source();async function AX(e,r,i,d,h,f){try{if(!_s("ENABLE_PRELOAD"))return;if(!uE().supportWebCrypto)return void I0(()=>{Wt.warn("Your browser does not support preloading, this feature  be run in a secure environment")},"preload_webcrypto_not_supported");if(!i&&i!==null)throw new n_(Gi.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));i&&fS(i,"token",1,2047),fS(e,"appid",1,2047),JL(r),d&&XL(d);const g=pI();Wt.debug("preload channel ".concat(r,", uid is ").concat(d));const b={appId:e,cname:r,token:i||e,uid:typeof d!="string"?d:null,sid:g,proxyServer:h};let C,P;typeof d=="string"?(b.stringUid=d,[P,C]=await T_.all([Sht(d,{sid:g,appId:e},bG.token),tX(CX(CX({},b),{},{token:i||e,uid:0}),bG.token)]),b.uid=P.uid,C.gatewayInfo.uid=b.uid,C.gatewayInfo.res.uid=b.uid):(f&&(b.stringUid=f),C=await tX(b,bG.token));const x={sid:g,appId:e,cname:r,token:i||e,uid:b.stringUid||d,intUid:b.uid||C.gatewayInfo.uid,stringUid:b.stringUid,ts:Date.now(),sua:P,ap:C};await async function(H){let $;try{H.uid&&NX({appId:H.appId,cname:H.cname,token:H.token,uid:H.uid,stringUid:H.stringUid});const _t=LX(H),_i=await async function(_r,Fi){try{const Di=await window.crypto.subtle.importKey("raw",b4(Fi),"AES-GCM",!1,["encrypt"]),Js=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:new Uint8Array(1)},Di,hI(window.btoa(JSON.stringify(_r))));return w0(new Uint8Array(Js))}catch{return}}(H,H.token||H.appId);if(!_i)return;$=kX(WO);const ue=$?JSON.parse($):[];ue.push({[_t]:_i}),ue.length>_s("AP_CACHE_NUM")&&ue.shift(),S1(WO,JSON.stringify(ue))}catch(_t){Wt.warn("Error caching server parameters:",_t.message),S1(WO,"")}}(x),gG++}catch(g){throw vG++,function(b){EG||(EG=window.setTimeout(()=>{let P="";y1.forEach((x,H)=>{P+="".concat(H,": ").concat(x," ;")}),k_.reportApiInvoke(null,{name:QE.PRELOAD,options:{success:gG,failed:vG,err:P}}).onError(b),gG=0,vG=0,y1.clear(),EG=null},Vht));const C=y1.get(b.code)||0;y1.set(b.code,C+1)}(g),g}}async function OX(e){try{if(_s("AP_REQUEST_DETAIL")||_s("ENABLE_ROLE_SELECT_EDGE"))return;const r=NX(e);if(!r||e.cloudProxyServer!=="disabled")return;const i=await async function(d,h){try{const f=await window.crypto.subtle.importKey("raw",b4(h),"AES-GCM",!1,["decrypt"]),g=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:new Uint8Array(1)},f,hI(d));return JSON.parse(window.atob(w0(new Uint8Array(g))))}catch{return}}(r,e.token||e.appId);if(!i||!function(d,h){return d.cname===h.cname&&d.appId===h.appId&&d.token===h.token?h.stringUid?d.stringUid===h.stringUid:typeof h.uid=="number"?d.uid===h.uid:d.uid==h.uid:!1}(i,e))return;if(i&&Date.now()-i.ts<_s("AP_CACHE_LIFETIME"))return i}catch(r){Wt.warn("Error get preloadInfo",r.message)}}function NX(e){let r;try{if(r=kX(WO),!r)return;const i=JSON.parse(r),d=LX(e),h=function(g,b){for(let C=g.length-1;C>=0;C--)if(b(g[C]))return C;return-1}(i,g=>d in g);if(h===-1)return;const f=i.splice(h,1)[0];return S1(WO,JSON.stringify(i)),f[d]}catch(i){Wt.warn("Error delete preload info: ".concat(r),i.message),S1(WO,"")}}function yG(e){if(e){let r=II.get(e);r&&(window.clearTimeout(r),r=null,II.delete(e)),E_(wI).call(wI,e)||e.cloudProxyServer!=="disabled"||wI.push(e)}if(II.size<_s("AP_CACHE_NUM")&&wI.length>0){const r=wI.shift();II.set(r,window.setTimeout(async()=>{const{appId:i,cname:d,token:h,stringUid:f,uid:g,proxyServer:b}=r;try{await jht(i,d,h,g,b,f),II.has(r)&&yG(r)}catch(C){Wt.warn("update preload failed",C.message),PX(r)}},_s("AP_UPDATE_INTERVAL")))}}function PX(e){const r=wI.indexOf(e);r!==-1&&wI.splice(r,1);let i=II.get(e);i&&(window.clearTimeout(i),i=null,II.delete(e),yG())}function DX(e,r){const i=e.sua,d=e.ap;r&&i&&k_.reqUserAccount(e.sid,{lts:i.requestTime,elapse:i.elapse,success:!0,serverAddr:i.url,stringUid:r,uid:e.intUid,errorCode:null,extend:i.req}),k_.reportResourceTiming(e.ap.url,e.sid),k_.joinWebProxyAP(e.sid,{lts:d.requestTime,elapse:d.elapse,sucess:1,apServerAddr:d.url,turnServerAddrList:d.proxyInfo.addresses.map(h=>h.ip).join(","),eventType:"disabled",unilbsServerIds:[_v.CHOOSE_SERVER,_v.CLOUD_PROXY_FALLBACK].toString()}),k_.joinChooseServer(e.sid,{lts:d.requestTime,elapse:d.elapse,succ:!0,csAddr:d.url,opid:d.opid,serverList:d.gatewayInfo.gatewayAddrs.map(h=>h.address),ec:null,cid:d.gatewayInfo.cid.toString(),uid:d.gatewayInfo.uid.toString(),csIp:d.gatewayInfo.csIp,unilbsServerIds:[_v.CHOOSE_SERVER].toString(),isHttp3:d.isHttp3})}function kX(e){return window.atob(window.localStorage.getItem(e)||"")}function S1(e,r){window.localStorage.setItem(e,window.btoa(r))}function LX(e){let r="".concat(e.appId,"_").concat(e.cname);return typeof e.uid=="string"&&(r+="_s_".concat(e.uid)),typeof e.uid=="number"&&(r+="_".concat(e.uid)),e.token&&(r+="_".concat(e.token)),C4(r)}function Fht(e){let r=function(){const i=qht.pop();return i?(i.offset=i.limit=0,i):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(i,d){let h=i.appId;h!==void 0&&(_b(d,10),j0(d,h));let f=i.cid;f!==void 0&&(_b(d,16),_b(d,f));let g=i.cname;g!==void 0&&(_b(d,26),j0(d,g));let b=i.deviceId;b!==void 0&&(_b(d,34),j0(d,b));let C=i.elapse;C!==void 0&&(_b(d,40),F0(d,C));let P=i.fileSize;P!==void 0&&(_b(d,48),F0(d,KO(P)));let x=i.height;x!==void 0&&(_b(d,56),F0(d,KO(x)));let H=i.jpg;H!==void 0&&(_b(d,66),_b(d,H.length),xX(d,H));let $=i.networkType;$!==void 0&&(_b(d,72),F0(d,KO($)));let _t=i.osType;_t!==void 0&&(_b(d,80),F0(d,KO(_t)));let _i=i.requestId;_i!==void 0&&(_b(d,90),j0(d,_i));let ue=i.sdkVersion;ue!==void 0&&(_b(d,98),j0(d,ue));let _r=i.sequence;_r!==void 0&&(_b(d,104),F0(d,KO(_r)));let Fi=i.sid;Fi!==void 0&&(_b(d,114),j0(d,Fi));let Di=i.timestamp;Di!==void 0&&(_b(d,120),F0(d,Di));let Js=i.uid;Js!==void 0&&(_b(d,128),_b(d,Js));let _l=i.vid;_l!==void 0&&(_b(d,136),_b(d,_l));let _u=i.width;_u!==void 0&&(_b(d,144),F0(d,KO(_u)));let ga=i.service;ga!==void 0&&(_b(d,152),_b(d,ga));let _m=i.callbackData;_m!==void 0&&(_b(d,162),_b(d,_m.length),xX(d,_m));let r_=i.ticket;r_!==void 0&&(_b(d,170),j0(d,r_));let a_=i.vendorConfigs;a_!==void 0&&(_b(d,178),j0(d,a_))}(e,r),function(i){let d=i.bytes,h=i.limit;return d.length===h?d:d.subarray(0,h)}(r)}function Bht(e){return function(i){let d={};t:for(;!Wht(i);){let h=cP(i);switch(h>>>3){case 0:break t;case 1:d.code=cP(i);break;case 2:d.msg=UX(i,cP(i));break;case 3:d.requestId=UX(i,cP(i));break;case 4:d.timestamp=Kht(i,!1);break;default:Ght(i,7&h)}}return d}({bytes:r=e,offset:0,limit:r.length});var r}function Ght(e,r){switch(r){case 0:for(;128&rR(e););break;case 2:SG(e,cP(e));break;case 5:SG(e,4);break;case 1:SG(e,8);break;default:throw new Error("Unimplemented type: "+r)}}function KO(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let qht=[];function SG(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function Wht(e){return e.offset>=e.limit}function T1(e,r){let i=e.bytes,d=e.offset,h=e.limit,f=d+r;if(f>i.length){let g=new Uint8Array(2*f);g.set(i),e.bytes=g}return e.offset=f,f>h&&(e.limit=f),d}function MX(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function xX(e,r){let i=T1(e,r.length);e.bytes.set(r,i)}function UX(e,r){let i=MX(e,r),d=String.fromCharCode,h=e.bytes,f="�",g="";for(let b=0;b<r;b++){let C,P,x,H,$=h[b+i];128&$?(224&$)==192?b+1>=r?g+=f:(C=h[b+i+1],(192&C)!=128?g+=f:(H=(31&$)<<6|63&C,H<128?g+=f:(g+=d(H),b++))):(240&$)==224?b+2>=r?g+=f:(C=h[b+i+1],P=h[b+i+2],(49344&(C|P<<8))!=32896?g+=f:(H=(15&$)<<12|(63&C)<<6|63&P,H<2048||H>=55296&&H<=57343?g+=f:(g+=d(H),b+=2))):(248&$)==240?b+3>=r?g+=f:(C=h[b+i+1],P=h[b+i+2],x=h[b+i+3],(12632256&(C|P<<8|x<<16))!=8421504?g+=f:(H=(7&$)<<18|(63&C)<<12|(63&P)<<6|63&x,H<65536||H>1114111?g+=f:(H-=65536,g+=d(55296+(H>>10),56320+(1023&H)),b+=3))):g+=f:g+=d($)}return g}function j0(e,r){let i=r.length,d=0;for(let g=0;g<i;g++){let b=r.charCodeAt(g);b>=55296&&b<=56319&&g+1<i&&(b=(b<<10)+r.charCodeAt(++g)-56613888),d+=b<128?1:b<2048?2:b<65536?3:4}_b(e,d);let h=T1(e,d),f=e.bytes;for(let g=0;g<i;g++){let b=r.charCodeAt(g);b>=55296&&b<=56319&&g+1<i&&(b=(b<<10)+r.charCodeAt(++g)-56613888),b<128?f[h++]=b:(b<2048?f[h++]=b>>6&31|192:(b<65536?f[h++]=b>>12&15|224:(f[h++]=b>>18&7|240,f[h++]=b>>12&63|128),f[h++]=b>>6&63|128),f[h++]=63&b|128)}}function rR(e){return e.bytes[MX(e,1)]}function VX(e,r){let i=T1(e,1);e.bytes[i]=r}function cP(e){let r,i=0,d=0;do r=rR(e),i<32&&(d|=(127&r)<<i),i+=7;while(128&r);return d}function _b(e,r){for(r>>>=0;r>=128;)VX(e,127&r|128),r>>>=7;VX(e,r)}function Kht(e,r){let i,d=0,h=0,f=0;return i=rR(e),d=127&i,128&i&&(i=rR(e),d|=(127&i)<<7,128&i&&(i=rR(e),d|=(127&i)<<14,128&i&&(i=rR(e),d|=(127&i)<<21,128&i&&(i=rR(e),h=127&i,128&i&&(i=rR(e),h|=(127&i)<<7,128&i&&(i=rR(e),h|=(127&i)<<14,128&i&&(i=rR(e),h|=(127&i)<<21,128&i&&(i=rR(e),f=127&i,128&i&&(i=rR(e),f|=(127&i)<<7))))))))),{low:d|h<<28,high:h>>>4|f<<24,unsigned:r}}function F0(e,r){let i=r.low>>>0,d=(r.low>>>28|r.high<<4)>>>0,h=r.high>>>24,f=h===0?d===0?i<16384?i<128?1:2:i<1<<21?3:4:d<16384?d<128?5:6:d<1<<21?7:8:h<128?9:10,g=T1(e,f),b=e.bytes;switch(f){case 10:b[g+9]=h>>>7&1;case 9:b[g+8]=f!==9?128|h:127&h;case 8:b[g+7]=f!==8?d>>>21|128:d>>>21&127;case 7:b[g+6]=f!==7?d>>>14|128:d>>>14&127;case 6:b[g+5]=f!==6?d>>>7|128:d>>>7&127;case 5:b[g+4]=f!==5?128|d:127&d;case 4:b[g+3]=f!==4?i>>>21|128:i>>>21&127;case 3:b[g+2]=f!==3?i>>>14|128:i>>>14&127;case 2:b[g+1]=f!==2?i>>>7|128:i>>>7&127;case 1:b[g]=f!==1?128|i:127&i}}const jX={},FX={},R1=4294967296,Hht=R1*R1,BX=Hht/2;qX(0,!0);const GX=qX(0),zht=uP(0,-2147483648,!1),Yht=uP(-1,2147483647,!1);function qX(e,r){let i,d,h;return r?(h=0<=(e>>>=0)&&e<256)&&(d=FX[e],d)?d:(i=uP(e,0,!0),h&&(FX[e]=i),i):(h=-128<=(e|=0)&&e<128)&&(d=jX[e],d)?d:(i=uP(e,e<0?-1:0,!1),h&&(jX[e]=i),i)}function uP(e,r,i){return{low:0|e,high:0|r,unsigned:!!i}}function WX(e,r){if(isNaN(e))return GX;{if(e<=-BX)return zht;if(e+1>=BX)return Yht}return e<0?GX:uP(e%R1|0,e/R1|0,r)}function KX(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}class TG extends qE{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(yR.CONNECTION_STATE_CHANGE,r,i)}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(r){var i;super(),Ei(this,"name","AgoraRTCImageModeration"),Ei(this,"_connectionState",DT.CONNECTING),Ei(this,"_sequence",0),Ei(this,"_moderationStartTime",void 0),Ei(this,"_workerConnection",void 0),Ei(this,"_workerMessageLengthLimit",void 0),Ei(this,"_qualityRatio",void 0),Ei(this,"_connectInfo",void 0),Ei(this,"_cancelTokenSource",zS.CancelToken.source()),Ei(this,"_retryConfig",void 0),Ei(this,"_moderationInterval",void 0),Ei(this,"_moderationTimer",null),Ei(this,"_moderationMode",1),Ei(this,"_quality",1),Ei(this,"_qualityTimer",null),Ei(this,"_ticket",void 0),Ei(this,"_moderationIntervalMinimum",void 0),Ei(this,"_uploadFailedNum",0),Ei(this,"_uploadNum",0),Ei(this,"_uploadTimer",null),Ei(this,"_extraInfo",void 0),Ei(this,"_vendor",""),Ei(this,"_encoder",new TextEncoder),Ei(this,"_moderationId",void 0),Ei(this,"inspectImage",()=>{if(this.connectionState!==DT.CONNECTED)throw new t_(Gi.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===DT.CONNECTED?this.requestToInspectImage():Wt.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=AE(5,"image-moderation-"),this._workerMessageLengthLimit=_s("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=_s("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),this._qualityRatio=_s("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new ZN("worker-"+this._moderationId,Mb),this.on(yR.STATE_CHANGE,(d,h)=>{Wt.debug("[".concat(this._moderationId,"] Moderation operation :").concat(LO[d]," ").concat(h||""))}),this.handleWorkerEvents()}async init(r,i){this.emit(yR.STATE_CHANGE,LO.CONNECT_AP),this._connectInfo=r;const d=this._cancelTokenSource.token;return this._retryConfig=i,new T_((h,f)=>{this.on(yR.CONNECTION_STATE_CHANGE,(g,b)=>{g===DT.CONNECTED&&h()}),this.requestAP(r,d,i).then(g=>{this.connectWorker(g)}).catch(g=>{f(g)})})}updateConfig(r){var i;this._moderationInterval=(i=r.interval)!==null&&i!==void 0?i:1e3,r.extraInfo&&(this._extraInfo=this._encoder.encode(r.extraInfo)),r.vendor&&(this._vendor=r.vendor),Wt.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(r))),this.connectionState===DT.CONNECTED&&this.inspectImage()}async requestAP(r,i,d){const h=_s("WEBCS_DOMAIN").map(C=>"https://".concat(C,"/api/v1")),f=await function(C,P,x,H){let{appId:$,areaCode:_t,cname:_i,sid:ue,token:_r,uid:Fi}=P;FO++;const Di="moderation_plugin",Js={service_name:Di,json_body:JSON.stringify({appId:$,areaCode:_t,cname:_i,command:"allocateEdge",requestId:FO,seq:FO,sid:ue,appToken:_r,ts:Date.now(),uid:Fi+""})};let _l,_u,ga=C[0];return ER(async()=>{_l=Date.now();const _m=await SR(ga,{data:Js,cancelToken:x,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_u=Date.now()-_l,_m.code!==0){const p_=new t_(Gi.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+_m.code,{retry:!0,responseTime:_u});throw Wt.error(p_.toString()),p_}const r_=JSON.parse(_m.json_body);if(r_.code!==200){const p_=new t_(Gi.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(r_.code,", reason: ").concat(r_.reason),{code:r_.code,responseTime:_u});throw Wt.error(p_.toString()),p_}if(!r_.servers||!Array.isArray(r_.servers)||r_.servers.length===0){const p_=new t_(Gi.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:r_.code,responseTime:_u});throw Wt.error(p_.toString()),p_}if(!r_.servers.some(p_=>!!p_.wss)){const p_=new t_(Gi.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:r_.code,responseTime:_u});throw Wt.error(p_.toString()),p_}const a_=_s("IMAGE_MODERATION_WORKER_HOST");return{addressList:r_.servers.map(p_=>{let{address:Q_,wss:$_}=p_;if(Q_&&$_)return"wss://".concat(Q_.replace(/\./g,"-"),".").concat(a_,":").concat($_,"/moderation")}).filter(p_=>!!p_),workerToken:r_.workerToken,vid:r_.vid,ticket:r_.appTicket,responseTime:_u}},(_m,r_)=>(k_.apworkerEvent(ue,{success:!0,sc:200,serviceName:Di,responseDetail:JSON.stringify(_m.addressList),firstSuccess:r_===0,responseTime:_u,serverIp:C[r_%C.length]}),!1),(_m,r_)=>(k_.apworkerEvent(ue,{success:!1,sc:_m.data&&_m.data.code||200,serviceName:Di,responseTime:_u,serverIp:C[r_%C.length]}),!!(_m.code!==Gi.OPERATION_ABORTED&&_m.code!==Gi.UNEXPECTED_RESPONSE||_m.data&&_m.data.retry)&&(ga=C[(r_+1)%C.length],!0)),H)}(h,r,i,d);this.emit(yR.STATE_CHANGE,LO.AP_CONNECTED);const{addressList:g,ticket:b}=f;return this._ticket=b,g}async connectWorker(r){this.emit(yR.STATE_CHANGE,LO.CONNECT_WORKER),await this._workerConnection.init(r,1e4)}handleWorkerEvents(){this._workerConnection.on(Y_.CONNECTED,async()=>{this.emit(yR.STATE_CHANGE,LO.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=DT.CONNECTED}),this._workerConnection.on(Y_.CLOSED,()=>{this.connectionState=DT.CLOSED}),this._workerConnection.on(Y_.FAILED,()=>{this.connectionState=DT.CLOSED}),this._workerConnection.on(Y_.RECONNECTING,()=>{this.connectionState=this.connectionState===DT.CONNECTED?DT.RECONNECTING:DT.CONNECTING}),this._workerConnection.on(Y_.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const i=Bht(new Uint8Array(r.data));_s("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Wt.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(i)),this._uploadNum++,i.code===void 0||i.code===0||(this._uploadFailedNum++,Wt.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(i.code,", msg is ").concat(i.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{k_.reportApiInvoke(this._connectInfo.sid||null,{name:QE.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,i.code],tag:FE.TRACER}).onError(new t_(Gi.IMAGE_MODERATION_UPLOAD_FAILED,i.msg)),this._uploadTimer=null},_s("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else Wt.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Y_.WILL_RECONNECT,(r,i,d)=>{r==="recover"&&d(r),d("tryNext")}),this._workerConnection.on(Y_.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}static intToLong(r){return{low:r|=0,high:r>>31,unsigned:r>=0}}async requestToInspectImage(){const r=mT(this,yR.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void(_s("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Wt.debug("Only the track being played can be inspected"));this._sequence++;const d=await this.generateRequestData(r,i);this._workerConnection.sendMessage(d,!0,!0)}else _s("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&Wt.debug("Only the track being published can be inspected")}async generateRequestData(r,i){let{appId:d,cname:h,cid:f,vid:g,sid:b,uid:C}=i;const P=Date.now(),x=await r.getCurrentFrameImage("image/jpeg",this.quality),H=await _9(x,d,h),$=this._sequence+"-"+f+"-"+C+"-"+P+"-"+AE(12,""),_t={appId:d,cid:f,cname:h,deviceId:"",elapse:TG.intToLong(Number(P-this._moderationStartTime)),fileSize:x.buffer.byteLength,height:x.height,width:x.width,jpg:H,networkType:6,osType:7,requestId:$,sdkVersion:"4.24.0",sequence:this._sequence,sid:b,timestamp:WX(P),uid:C,vid:g,service:this._moderationMode,ticket:this._ticket,callbackData:this._extraInfo,vendorConfigs:this._vendor};this._extraInfo===void 0&&delete _t.callbackData;const _i=Fht(_t);if(_i.byteLength<this._workerMessageLengthLimit){if(_s("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const ue=function(_r){for(var Fi=1;Fi<arguments.length;Fi++){var Di=arguments[Fi]!=null?arguments[Fi]:{};Fi%2?KX(Object(Di),!0).forEach(function(Js){Ei(_r,Js,Di[Js])}):Object.getOwnPropertyDescriptors?Object.defineProperties(_r,Object.getOwnPropertyDescriptors(Di)):KX(Object(Di)).forEach(function(Js){Object.defineProperty(_r,Js,Object.getOwnPropertyDescriptor(Di,Js))})}return _r}({},_t);delete ue.jpg,Wt.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(ue))}return _i}{const ue=this.quality*this._qualityRatio;return this.quality=ue,await this.generateRequestData(r,{appId:d,cname:h,cid:f,vid:g,sid:b,uid:C})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=zS.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=DT.CLOSED,this.emit(yR.STATE_CHANGE,LO.CLOSED)}}function HX(e){if(IE(e.interval,"interval",1e3,1/0),e&&e.extraInfo&&e.extraInfo.length>1024)throw new t_(Gi.INVALID_PARAMS,"config.extraInfo length cannot exceed 1024 bytes");if(e&&e.vendor&&e.vendor.length>1024)throw new t_(Gi.INVALID_PARAMS,"config.vendor length cannot exceed 1024 bytes")}const Jht={name:"ImageModeration",create:function(e){let{config:r}=e;return HX(r),new TG(r)}};var zX,YX,JX,XX,QX,ZX,$X,t3,e3,n3,r3,i3,o3,s3,a3,c3,u3,d3,l3,h3,p3,f3,m3,_3,E3,g3,v3,b3,y3,S3,T3,R3,I3,w3,C3,A3,O3,N3,P3,D3,k3,C_;function L3(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function iR(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?L3(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):L3(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}wS.setLogger(Wt);let Xht=(zX=V_(),YX=V_({argsMap:(e,r)=>{if(!Array.isArray(r)){if(!(r instanceof wO))return[r];r=[r]}return r.map(i=>i?Object(i).toString():"null")}}),JX=V_({argsMap:(e,r)=>(r||(r=[]),Array.isArray(r)||r.trackMediaType!==IO.DATA?(Array.isArray(r)||(r=[r]),r.map(i=>i.getTrackId())):[r.getChannelId()])}),XX=V_({argsMap:(e,r,i,d)=>[typeof r=="object"?r.uid:r,i,d]}),QX=V_({argsMap:(e,r,i)=>[r,i]}),ZX=V_({argsMap:(e,r)=>r.map(i=>{let{user:d,mediaType:h}=i;return[d==null?void 0:d.uid,h]})}),$X=V_({argsMap:(e,r,i,d)=>[typeof r=="object"?r.uid:r,i,d]}),t3=V_({argsMap:(e,r)=>r.map(i=>{let{user:d,mediaType:h}=i;return{uid:d==null?void 0:d.uid,mediaType:h}})}),e3=V_(),n3=V_(),r3=V_(),i3=V_(),o3=V_(),s3=V_(),a3=V_(),c3=V_(),u3=V_(),d3=V_(),l3=V_(),h3=V_(),p3=V_(),f3=V_(),m3=V_(),_3=V_({argsMap:(e,r)=>[r]}),E3=V_(),g3=V_(),v3=V_(),b3=V_(),y3=V_(),S3=V_(),T3=V_(),R3=V_(),I3=V_({argsMap:(e,r)=>(Array.isArray(r)||(r=[r]),[JSON.stringify(r)])}),w3=V_(),C3=V_(),A3=V_(),O3=V_(),N3=V_(),P3=V_(),D3=V_({reportResult:!0}),k3=V_(),C_=class extends qE{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get localDataChannels(){return this._p2pChannel.getAllDataChannels()}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e,r){let i;if(super(),Ei(this,"store",void 0),Ei(this,"_uid",void 0),Ei(this,"_channelName",void 0),Ei(this,"_uintUid",void 0),Ei(this,"_users",[]),Ei(this,"_config",void 0),Ei(this,"_clientId",void 0),Ei(this,"_appId",void 0),Ei(this,"_sessionId",null),Ei(this,"_key",void 0),Ei(this,"_rtmConfig",{}),Ei(this,"_joinInfo",void 0),Ei(this,"_gateway",void 0),Ei(this,"_statsCollector",void 0),Ei(this,"_configDistribute",void 0),Ei(this,"_leaveMutex",void 0),Ei(this,"_publishMutex",void 0),Ei(this,"_renewTokenMutex",void 0),Ei(this,"_subscribeMutex",void 0),Ei(this,"_encryptionMode","none"),Ei(this,"_encryptionSecret",null),Ei(this,"_encryptionSalt",null),Ei(this,"_encryptDataStream",!1),Ei(this,"_encryptDataStreamKey",null),Ei(this,"_encryptDataStreamIv",null),Ei(this,"_proxyServer",void 0),Ei(this,"_turnServer",{servers:[],mode:"auto"}),Ei(this,"_cloudProxyServerMode","disabled"),Ei(this,"_isDualStreamEnabled",!1),Ei(this,"_defaultStreamFallbackType",void 0),Ei(this,"_lowStreamParameter",void 0),Ei(this,"_streamFallbackTypeCacheMap",new Map),Ei(this,"_remoteStreamTypeCacheMap",new Map),Ei(this,"_axiosCancelSource",zS.CancelToken.source()),Ei(this,"_audioVolumeIndicationInterval",void 0),Ei(this,"_networkQualityInterval",void 0),Ei(this,"_userOfflineTimeout",void 0),Ei(this,"_streamRemovedTimeout",void 0),Ei(this,"_liveTranscodeStreamingClient",void 0),Ei(this,"_liveRawStreamingClient",void 0),Ei(this,"_channelMediaRelayClient",void 0),Ei(this,"_networkQualitySensitivity","normal"),Ei(this,"_p2pChannel",void 0),Ei(this,"_useLocalAccessPoint",!1),Ei(this,"_setLocalAPVersion",void 0),Ei(this,"_joinAndNotLeaveYet",!1),Ei(this,"_numberOfJoinCount",0),Ei(this,"_joinResponse",null),Ei(this,"_remoteDefaultVideoStreamType",void 0),Ei(this,"_inspect",void 0),Ei(this,"_moderation",void 0),Ei(this,"_license",void 0),Ei(this,"_pendingPublishedUsers",[]),Ei(this,"ntpAlignErrorCount",0),Ei(this,"remoteInboundOffset",0),Ei(this,"_peerConnectionState",void 0),Ei(this,"_handleLocalTrackEnable",(h,f,g)=>{this.publish(h,!1).then(f).catch(g)}),Ei(this,"_handleLocalTrackDisable",(h,f,g)=>{this.unpublish(h).then(f).catch(g)}),Ei(this,"_handleUserOnline",h=>{if(_s("BLOCK_LOCAL_CLIENT")&&yI(h.uid,this.channelName))return void Wt.debug("[".concat(h.uid,"] will be ignored in local"));this.isStringUID&&typeof h.uid!="string"&&Wt.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const f=this._users.find(g=>g.uid===h.uid);if(f)f._trust_in_room_=!0,f._is_pre_created&&(f._is_pre_created=!1,this.safeEmit(nE.USER_JOINED,f));else{const g=new U0(h.uid,h.uint_id||h.uid);this._users.push(g),Wt.debug("[".concat(this._clientId,"] user online"),h.uid),this.store.firstVideoFrameDecoded(g.uid,{userJoinNotify:Date.now()}),this.safeEmit(nE.USER_JOINED,g)}}),Ei(this,"_handleUserOffline",h=>{if(_s("BLOCK_LOCAL_CLIENT")&&yI(h.uid,this.channelName))return;const f=this._users.find(g=>g.uid===h.uid);f&&(this._handleRemoveStream(h),this._handleRemoveDataChannels(h),f._audio_pre_subscribed||f._video_pre_subscribed?f._is_pre_created=!0:RL(this._users,f),this._remoteStreamTypeCacheMap.delete(f.uid),this._streamFallbackTypeCacheMap.delete(f.uid),Wt.debug("[".concat(this._clientId,"] user offline"),h.uid,"reason:",h.reason),this.safeEmit(nE.USER_LEAVED,f,h.reason))}),Ei(this,"_handleAddAudioOrVideoStream",(h,f,g,b,C,P,x,H)=>{if(_s("BLOCK_LOCAL_CLIENT")&&yI(f,this.channelName))return;const $=this._users.find(_i=>_i.uid===f);if(!$)return void Wt.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Wt.debug("[".concat(this._clientId,"] stream added with uid ").concat(f,", type ").concat(h)),this.store.subscribe($.uid,h,void 0,void 0,void 0,Date.now()),h==="video"&&this.store.firstVideoFrameDecoded($.uid,{videoAddNotify:Date.now()});const _t=h==="audio"?$.hasAudio:$.hasVideo;if($._uintid||($._uintid=P||f),h==="audio"?$._trust_audio_stream_added_state_=!0:$._trust_video_stream_added_state_=!0,h==="audio"?($._audio_added_=!0,g!==void 0&&($._audioSSRC=g),b!==void 0&&($._cname=b),x&&($._audioOrtc=x)):($._video_added_=!0,g!==void 0&&($._videoSSRC=g),b!==void 0&&($._cname=b),H!==void 0&&($._rtxSsrcId=H),x&&($._videoOrtc=x)),(h==="audio"?$.hasAudio:$.hasVideo)&&!_t&&(Wt.info("[".concat(this._clientId,"] remote user ").concat($.uid," published ").concat(h)),this.safeEmit(nE.USER_PUBLISHED,$,h)),h==="video"?k_.onGatewayStream(this._sessionId,sS.ON_ADD_VIDEO_STREAM,jE.ON_ADD_VIDEO_STREAM,{peer:P||f,ssrc:$._videoSSRC}):k_.onGatewayStream(this._sessionId,sS.ON_ADD_AUDIO_STREAM,jE.ON_ADD_AUDIO_STREAM,{peer:P||f,ssrc:$._audioSSRC}),this._p2pChannel.remoteMediaSsrcChanged($,h,g).then(_i=>{if(_i&&(Wt.debug("[".concat(this._clientId,"] resubscribe ").concat(h," for user ").concat($.uid," after rejoin because SSRC id changed.")),this._p2pChannel instanceof aP))return this._p2pChannel.unsubscribe($,h,!0).then(()=>this._subscribe($,h,!0).catch(ue=>{Wt.error("[".concat(this._clientId,"] resubscribe error"),ue.toString())}))}),this._p2pChannel.hasPendingRemoteMedia($,h)&&(Wt.debug("[".concat(this._clientId,"] resubscribe ").concat(h," for user ").concat($.uid," after reconnect.")),this._subscribe($,h,!0).catch(_i=>{Wt.error("[".concat(this._clientId,"] resubscribe error"),_i.toString())})),h==="video"&&!yS()&&!LS()){const _i=this._getEncodingName(C);(_i==null?void 0:_i.toLocaleLowerCase())==WN.av1&&yht().then(ue=>{ue||this._gateway.downgradeCodec(_i)})}}),Ei(this,"_handleRemoveStream",h=>{if(_s("BLOCK_LOCAL_CLIENT")&&yI(h.uid,this.channelName))return;const f=this._users.find(b=>b.uid===h.uid);if(!f)return void Wt.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));Wt.debug("[".concat(this._clientId,"] stream removed with uid ").concat(h.uid));let g=()=>{};f.hasAudio&&f.hasVideo?g=()=>{Wt.info("[".concat(this._clientId,"] remote user ").concat(f.uid," unpublished audio track")),this.safeEmit(nE.USER_UNPUBLISHED,f,"audio"),Wt.info("[".concat(this._clientId,"] remote user ").concat(f.uid," unpublished video track")),this.safeEmit(nE.USER_UNPUBLISHED,f,"video")}:f.hasVideo?g=()=>{Wt.info("[".concat(this._clientId,"] remote user ").concat(f.uid," unpublished video track")),this.safeEmit(nE.USER_UNPUBLISHED,f,"video")}:f.hasAudio&&(g=()=>{Wt.info("[".concat(this._clientId,"] remote user ").concat(f.uid," unpublished audio track")),this.safeEmit(nE.USER_UNPUBLISHED,f,"audio")}),f._video_pre_subscribed||f._audio_pre_subscribed||(f._trust_audio_stream_added_state_=!0,f._trust_video_stream_added_state_=!0,f._audio_added_=!1,f._video_added_=!1,this._p2pChannel instanceof aP&&this._p2pChannel.unsubscribe(f).then(b=>{if(b)return this._gateway.unsubscribe(b,f.uid)}),f._audioSSRC=void 0,f._videoSSRC=void 0,f._audioOrtc=void 0,f._videoOrtc=void 0,f._rtxSsrcId=void 0),k_.onGatewayStream(this._sessionId,sS.ON_REMOVE_STREAM,jE.ON_REMOVE_STREAM,{peer:h.uint_id||h.uid}),g()}),Ei(this,"_handleSetStreamLocalEnable",(h,f,g)=>{if(_s("BLOCK_LOCAL_CLIENT")&&yI(f,this.channelName))return;const b=this._users.find(x=>x.uid===f);if(!b)return void Wt.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));Wt.debug("[".concat(this._clientId,"] local ").concat(h," ").concat(g?"enabled":"disabled"," with uid ").concat(f));const C=h==="audio"?b.hasAudio:b.hasVideo;if(h==="audio"){b._trust_audio_enabled_state_=!0;const x=b._audio_enabled_;if(b._audio_enabled_=g,b._audio_enabled_===x)return;{const H=b._audio_enabled_?"enable-local-audio":"disable-local-audio";Wt.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(f,", msg: ").concat(H)),this.safeEmit(nE.USER_INFO_UPDATED,f,H)}}else{b._trust_video_enabled_state_=!0;const x=b._video_enabled_;if(b._video_enabled_=g,b._video_enabled_===x)return;{const H=b._video_enabled_?"enable-local-video":"disable-local-video";Wt.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(f,", msg: ").concat(H)),this.safeEmit(nE.USER_INFO_UPDATED,f,H)}}const P=h==="audio"?b.hasAudio:b.hasVideo;return C!==P?!C&&P?(Wt.info("[".concat(this._clientId,"] remote user ").concat(f," published ").concat(h)),void this.safeEmit(nE.USER_PUBLISHED,b,h)):(h==="video"&&b._videoTrack&&b._videoTrack._destroy(),h==="audio"&&b._audioTrack,this._p2pChannel.muteRemote(b,h),Wt.info("[".concat(this._clientId,"] remote user ").concat(f," unpublished ").concat(h)),void this.safeEmit(nE.USER_UNPUBLISHED,b,h)):void 0}),Ei(this,"_handleMuteStream",(h,f,g)=>{if(_s("BLOCK_LOCAL_CLIENT")&&yI(h,this.channelName))return;Wt.debug("[".concat(this._clientId,"] receive mute message"),h,f,g);const b=this._users.find(x=>x.uid===h);if(!b)return void Wt.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(h));const C=f==="audio"?b.hasAudio:b.hasVideo;if(f==="audio"){b._trust_audio_mute_state_=!0;const x=b._audio_muted_;if(b._audio_muted_=g,b._audio_muted_===x)return;{const H=b._audio_muted_?"mute-audio":"unmute-audio";Wt.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(h,", msg: ").concat(H)),this.safeEmit(nE.USER_INFO_UPDATED,h,H)}}else{b._trust_video_mute_state_=!0;const x=b._video_muted_;if(b._video_muted_=g,b._video_muted_===x)return;{const H=b._video_muted_?"mute-video":"unmute-video";Wt.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(h,", msg: ").concat(H)),this.safeEmit(nE.USER_INFO_UPDATED,h,H)}}const P=f==="audio"?b.hasAudio:b.hasVideo;if(C!==P){if(!C&&P)return(f==="audio"?b._audioSSRC:b._videoSSRC)?(Wt.info("[".concat(this._clientId,"] remote user ").concat(h," published ").concat(f)),void this.safeEmit(nE.USER_PUBLISHED,b,f)):void Wt.warning("[".concat(this._clientId,"] remote user ").concat(h," receive ").concat(f," unmute message  before add stream message, ").concat(f," SSRC doesn't exist yet."));f==="video"&&b._videoTrack&&!b._video_pre_subscribed&&b._videoTrack._destroy(),f==="audio"&&b._audioTrack,this._p2pChannel.muteRemote(b,f),Wt.info("[".concat(this._clientId,"] remote user ").concat(h," unpublished ").concat(f)),this.safeEmit(nE.USER_UNPUBLISHED,b,f)}}),Ei(this,"_handleP2PLost",async h=>{Wt.debug("[".concat(this._clientId,"] receive p2p lost"),h),parseInt(h.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():Wt.warning("[".concat(this._clientId,"] P2PLost stream not found"),h)}),Ei(this,"_handleTokenWillExpire",()=>{Wt.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(nE.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),Ei(this,"_handleBeforeUnload",h=>{h.type==="beforeunload"&&h.returnValue!==void 0&&h.returnValue!==""||(this.leave(),Wt.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),Ei(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(nE.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const h={downlinkNetworkQuality:0,uplinkNetworkQuality:0};h.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),h.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(nE.NETWORK_QUALITY,h)}),Ei(this,"_handleP2PAddAudioOrVideoStream",(h,f,g,b)=>{const C=this._users.find(x=>x.uid===f);if(!C)return void Wt.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));Wt.debug("[".concat(this._clientId,"] stream added with uid ").concat(f,", type ").concat(h)),this.store.subscribe(C.uid,h,void 0,void 0,void 0,Date.now());const P=h==="audio"?C.hasAudio:C.hasVideo;h==="audio"?C._trust_audio_stream_added_state_=!0:C._trust_video_stream_added_state_=!0,h==="audio"?(C._audio_added_=!0,g!==void 0&&(C._audioSSRC=g),b!==void 0&&(C._audioMid=b)):(C._video_added_=!0,g!==void 0&&(C._videoSSRC=g),b!==void 0&&(C._videoMid=b)),(h==="audio"?C.hasAudio:C.hasVideo)&&!P&&(Wt.info("[".concat(this._clientId,"] remote user ").concat(C.uid," published ").concat(h)),this.safeEmit(nE.USER_PUBLISHED,C,h)),this._p2pChannel.hasPendingRemoteMedia(C,h)&&(Wt.debug("[".concat(this._clientId,"] resubscribe ").concat(h," for user ").concat(C.uid," after reconnect.")),this._subscribe(C,h,!0).catch(x=>{Wt.error("[".concat(this._clientId,"] resubscribe error"),x.toString())}))}),this._config=e,this._clientId=r||AE(5,"client-"),this.store=new class{constructor(h,f,g,b){G_(this,"state",void 0),this.state={codec:h,audioCodec:f,mode:g,clientId:b,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,keyMetrics:{publish:[],subscribe:[],firstVideoFrameDecoded:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useP2P:!1,p2pTransport:fI.Default,hasStartJoinChannel:!1,isABTestSuccess:!1,autoSubscribe:!1,enableInstantMuteRestore:!1}}dispatch(h){this.state=function(f,g){switch(g.type){case W_.SET_SESSION_ID:return f_(f_({},f),{},{sessionId:g.sessionId});case W_.SET_P2P_ID:return f_(f_({},f),{},{p2pId:g.p2pId});case W_.SET_UID:return f_(f_({},f),{},{uid:g.uid});case W_.SET_INT_UID:return f_(f_({},f),{},{intUid:g.intUid});case W_.SET_PUB_ID:return f_(f_({},f),{},{pubId:g.pubId});case W_.KEY_METRIC_CLIENT_CREATED:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{clientCreated:g.metric})});case W_.KEY_METRIC_JOIN_START:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{joinStart:g.metric})});case W_.KEY_METRIC_PRELOAD_START:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{preloadStart:g.metric})});case W_.KEY_METRIC_PRELOAD_END:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{preloadEnd:g.metric})});case W_.KEY_METRIC_JOIN_END:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{joinEnd:g.metric})});case W_.KEY_METRIC_REQUEST_AP_START:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{requestAPStart:g.metric})});case W_.KEY_METRIC_REQUEST_AP_END:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{requestAPEnd:g.metric})});case W_.KEY_METRIC_REQUEST_SUA_END:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{requestSUAEnd:g.metric})});case W_.KEY_METRIC_BEFORE_CONNECT:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{beforeConnect:g.metric})});case W_.KEY_METRIC_PEER_RECEIVER:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{peerReceiver:g.metric})});case W_.KEY_METRIC_SIGNAL_CONNECTED:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{signalConnected:g.metric})});case W_.KEY_METRIC_JOIN_REQ:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{joinReq:g.metric})});case W_.KEY_METRIC_JOIN_REP:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{joinRep:g.metric})});case W_.KEY_METRIC_JOIN_GATEWAY_START:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{joinGatewayStart:g.metric})});case W_.KEY_METRIC_JOIN_GATEWAY_END:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{joinGatewayEnd:g.metric})});case W_.KEY_METRIC_PEER_CONNECTION_START:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{peerConnectionStart:g.metric})});case W_.KEY_METRIC_PEER_CONNECTION_END:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{peerConnectionEnd:g.metric})});case W_.KEY_METRIC_DESCRIPTION_START:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{descriptionStart:g.metric})});case W_.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{signalChannelOpen:g.metric})});case W_.KEY_METRIC_ICE_CONNECTION_END:return f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{iceConnectionEnd:g.metric})});case W_.KEY_METRIC_PUBLISH:{const b=f.keyMetrics.publish,C=b.findIndex(P=>P.trackId===g.metric.trackId);return C!==-1?(b[C]=f_(f_({},b[C]),g.metric),f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{publish:[...b]})})):f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{publish:[...f.keyMetrics.publish,g.metric]})})}case W_.KEY_METRIC_SUBSCRIBE:{const b=f.keyMetrics.subscribe,C=b.findIndex(P=>P.userId===g.metric.userId&&P.type===g.metric.type);return C!==-1?(b[C]=f_(f_({},b[C]),g.metric),f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{subscribe:[...b]})})):f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{subscribe:[...f.keyMetrics.subscribe,g.metric]})})}case W_.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED:{const b=f.keyMetrics.firstVideoFrameDecoded,C=b.findIndex(P=>P.userId===g.metric.userId);return C!==-1?(b[C]=f_(f_({},b[C]),g.metric),f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{firstVideoFrameDecoded:[...b]})})):f_(f_({},f),{},{keyMetrics:f_(f_({},f.keyMetrics),{},{firstVideoFrameDecoded:[...f.keyMetrics.firstVideoFrameDecoded,g.metric]})})}case W_.RESET_FIRST_VIDEO_FRAME_DECODED:return f.keyMetrics.firstVideoFrameDecoded=[],f;case W_.SET_CLOUD_PROXY_SERVER_MODE:return f.cloudProxyServerMode=g.mode,f;case W_.RECORD_JOIN_CHANNEL_SERVICE:return typeof g.index!="number"?f.joinChannelServiceRecords=[...f.joinChannelServiceRecords,g.record]:(f.joinChannelServiceRecords[g.index]=f_(f_({},f.joinChannelServiceRecords[g.index]),g.record),f.joinChannelServiceRecords=[...f.joinChannelServiceRecords]),f;case W_.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return f.joinChannelServiceRecords=[],f;case W_.RESET_KEY_METRICS:return f.keyMetrics={publish:[],subscribe:[],firstVideoFrameDecoded:[]},f;case W_.SET_USE_P2P:return f_(f_({},f),{},{useP2P:g.val});case W_.SET_TRANSPORT_TYPE:return f_(f_({},f),{},{p2pTransport:g.val});default:return f}}(this.state,h)}set autoSubscribe(h){this.state.autoSubscribe=h}get autoSubscribe(){return this.state.autoSubscribe}set enableInstantMuteRestore(h){this.state.enableInstantMuteRestore=h}get enableInstantMuteRestore(){return this.state.enableInstantMuteRestore}set sessionId(h){this.dispatch({type:W_.SET_SESSION_ID,sessionId:h})}get sessionId(){return this.state.sessionId}set cid(h){this.state.cid=h}get cid(){return this.state.cid}set codec(h){this.state.codec=h}get codec(){return this.state.codec}get mode(){return this.state.mode}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(h){this.dispatch({type:W_.SET_P2P_ID,p2pId:h})}get p2pId(){return this.state.p2pId}set dcId(h){this.dispatch({type:W_.SET_DC_ID,dcId:h})}get dcId(){return this.state.dcId}set uid(h){this.dispatch({type:W_.SET_UID,uid:h})}get uid(){return this.state.uid}set intUid(h){this.dispatch({type:W_.SET_INT_UID,intUid:h})}get intUid(){return this.state.intUid}set pubId(h){this.dispatch({type:W_.SET_PUB_ID,pubId:h})}get pubId(){return this.state.pubId}set cloudProxyServerMode(h){this.dispatch({type:W_.SET_CLOUD_PROXY_SERVER_MODE,mode:h})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useP2P(h){this.dispatch({type:W_.SET_USE_P2P,val:h})}get useP2P(){return this.state.useP2P}set p2pTransport(h){this.dispatch({type:W_.SET_TRANSPORT_TYPE,val:h})}get p2pTransport(){return this.state.p2pTransport}set hasStartJoinChannel(h){this.state.hasStartJoinChannel=h}get hasStartJoinChannel(){return this.state.hasStartJoinChannel}set isABTestSuccess(h){this.state.isABTestSuccess=h}get isABTestSuccess(){return this.state.isABTestSuccess}clientCreated(){this.dispatch({type:W_.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:W_.KEY_METRIC_JOIN_START,metric:Date.now()})}preloadStart(){this.dispatch({type:W_.KEY_METRIC_PRELOAD_START,metric:Date.now()})}preloadEnd(){this.dispatch({type:W_.KEY_METRIC_PRELOAD_END,metric:Date.now()})}joinEnd(){this.dispatch({type:W_.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:W_.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:W_.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}requestSUAEnd(){this.dispatch({type:W_.KEY_METRIC_REQUEST_SUA_END,metric:Date.now()})}beforeConnect(){this.dispatch({type:W_.KEY_METRIC_BEFORE_CONNECT,metric:Date.now()})}peerReceiver(){this.dispatch({type:W_.KEY_METRIC_PEER_RECEIVER,metric:Date.now()})}signalConnected(){this.dispatch({type:W_.KEY_METRIC_SIGNAL_CONNECTED,metric:Date.now()})}joinReq(){this.dispatch({type:W_.KEY_METRIC_JOIN_REQ,metric:Date.now()})}joinRep(){this.dispatch({type:W_.KEY_METRIC_JOIN_REP,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:W_.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:W_.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:W_.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:W_.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}firstVideoFrameDecoded(h,f){this.dispatch({type:W_.KEY_METRIC_FIRST_VIDEO_FRAME_DECODED,metric:f_({userId:h},f)})}descriptionStart(){this.dispatch({type:W_.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:W_.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:W_.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(h,f,g,b){this.dispatch({type:W_.KEY_METRIC_PUBLISH,metric:f_(f_({trackId:h,type:f},g&&{publishStart:g}),b&&{publishEnd:b})})}subscribe(h,f,g,b,C,P,x){this.dispatch({type:W_.KEY_METRIC_SUBSCRIBE,metric:f_(f_(f_(f_(f_({userId:h,type:f},g&&{subscribeStart:g}),b&&{subscribeEnd:b}),C&&{firstFrame:C}),P&&{streamAdded:P}),x&&{firstDecoded:x})})}massSubscribe(h,f,g,b){h.forEach(C=>{this.dispatch({type:W_.KEY_METRIC_SUBSCRIBE,metric:f_(f_(f_({userId:C.userId,type:C.type},f&&{subscribeStart:f}),g&&{subscribeEnd:g}),b&&{firstFrame:b})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(h,f){h.service==="gateway"&&Array.isArray(h.urls)&&(h.urls=h.urls.map(g=>g.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof f!="number"?(this.dispatch({type:W_.RECORD_JOIN_CHANNEL_SERVICE,record:f_(f_({},h),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(f<0||f>=this.state.joinChannelServiceRecords.length||this.dispatch({type:W_.RECORD_JOIN_CHANNEL_SERVICE,record:h,index:f}),f)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:W_.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:W_.RESET_KEY_METRICS})}resetFirstVideoFrameDecoded(){this.dispatch({type:W_.RESET_FIRST_VIDEO_FRAME_DECODED})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}}(e.codec,e.audioCodec,e.mode,this._clientId),this._leaveMutex=new wS("client-leave",this._clientId),this._publishMutex=new wS("client-publish",this._clientId),this._renewTokenMutex=new wS("client-renewtoken",this._clientId),this._subscribeMutex=new wS("client-subscribe",this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),Wt.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(AT," build: ").concat(uF,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{ZV(e.clientRoleOptions),i=Object.assign({},e.clientRoleOptions)}catch(h){Wt.warning("[".concat(this._clientId,"] ").concat(h.toString()))}var d;this._statsCollector=new oP(this.store),this._statsCollector.onStatsException=(h,f,g)=>{Wt.warn("[".concat(this._clientId,"] receive exception msg, code: ").concat(h,", msg: ").concat(f,", uid: ").concat(g)),h===aG.VIDEO_ENCODE_FAILED&&this.localTracks.forEach(b=>{b instanceof VL&&_s("ENABLE_ENCODE_EXCEPTION")&&b.findClosestProfile()}),this.safeEmit(nE.EXCEPTION,{code:h,msg:f,uid:g})},this._statsCollector.onUploadPublishDuration=(h,f,g,b)=>{const C=this._users.find(P=>P.uid===h);C&&(this.store.keyMetrics&&(this.store.firstVideoFrameDecoded(C._uintid,{peerPublishDuration:g,peerPubStatusMs:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(C)),k_.peerPublishStatus(this._sessionId,{subscribeElapse:b,audioPublishDuration:f,videoPublishDuration:g,peer:C._uintid}))},this._statsCollector.onVideoCodecChanged=h=>{if(_s("VIDEO_STANDARD_BITRATE_VERSION")&&(h==="av1"||h==="h265"||h==="h264")){const f=this.localTracks.find(g=>g instanceof LE);f&&f._saveEncodeBitrateRatio!==1&&f.setSaveEncodeBitrateRatio(h==="h264"?_s("BASELINE_MORE_H264_BITRATE_RATIO"):void 0)}},this.store.useP2P=e.mode==="p2p",this._gateway=new mht(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||Mb,httpRetryConfig:e.httpRetryConfig||Mb,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:i}),this._configDistribute=new wht(this._clientId,this.store),this.store.useP2P?(this._p2pChannel=(d={store:this.store,statsCollector:this._statsCollector},a0("P2PChannel").create(d)),this._handleP2PEvents()):this._p2pChannel=new aP(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async joinMeta(e,r,i,d,h){let f=!(arguments.length>5&&arguments[5]!==void 0)||arguments[5],g=arguments.length>6&&arguments[6]!==void 0&&arguments[6];SE("JOIN_GATEWAY_USE_443PORT_ONLY",f),SE("JOIN_GATEWAY_USE_DUAL_DOMAIN",g);const b=this._gateway.signal.websocket;return b instanceof zF&&(b.use443PortOnly=f,b.tryDoubleDomain=g),async function(C,P,x){vL.get(C)||vL.set(C,[]),bL.get(C)||bL.set(C,P),LR.get(C)||LR.set(C,0);const H=vL.get(C),$=bL.get(C);if(!H||!$)throw new Error("concurrent: deferQueue or maxConcurrency is null");if(LR.get(C)===$){const Fi=MN();H.push(Fi),await Fi.promise}LR.set(C,LR.get(C)+1);for(var _t=arguments.length,_i=new Array(_t>3?_t-3:0),ue=3;ue<_t;ue++)_i[ue-3]=arguments[ue];const _r=await x(..._i);return LR.set(C,LR.get(C)-1),LR.get(C)===$-1&&H.length>0&&(H[0].resolve(),H.shift()),LR.get(C)===0&&(vL.set(C,[]),bL.set(C,0),LR.set(C,0)),_r}("client.join",_s("JOIN_MAX_CONCURRENCY"),this.join.bind(this),e,r,i,d,h)}async join(e,r,i,d,h){const f=++this._numberOfJoinCount;this.store.joinStart(),d&&(this.store.uid=d);const g=(CL||CL||(CL=(window.location.protocol.split(":")[0]||"").toUpperCase(),CL))==="HTTPS",b=N4()?window.isSecureContext:"Browser Not Support";(!N4()&&!g||!window.isSecureContext)&&Wt.warning("The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser");let C;k_.setAppId(e);try{if(!i&&i!==null)throw new t_(Gi.INVALID_PARAMS,"Invalid token: ".concat(i,". If you don not use token, set it to null"));if(i&&fS(i,"token",1,2047),fS(e,"appid",1,2047),JL(r),d&&XL(d),h)if(typeof h=="string")fS(h,"optionalInfo",1,256),C=h;else{if(typeof h!="object")throw new t_(Gi.INVALID_PARAMS,"Invalid options: options is not a string or object");{const{autoSubscribe:_r,enableInstantMuteRestore:Fi}=h;_r&&(_R(_r,"autoSubscribe"),Wt.info("[".concat(this._clientId,"] join: autoSubscribe: ").concat(_r)),this.store.autoSubscribe=_r),Fi&&(_R(Fi,"enableInstantMuteRestore"),Wt.info("[".concat(this._clientId,"] join: enableInstantMuteRestore: ").concat(Fi)),this.store.enableInstantMuteRestore=Fi)}}}catch(_r){throw k_.reportApiInvoke(pI(),{name:QE.JOIN,options:[e,r,i,d],states:{isHttps:g,isSecureContext:b},tag:FE.TRACER}).onError(_r),_r}if(this._leaveMutex.isLocked&&(Wt.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),Wt.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const _r=new t_(Gi.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw k_.reportApiInvoke(pI(),{name:QE.JOIN,options:[e,r,i,d],states:{isHttps:g,isSecureContext:b},tag:FE.TRACER}).onError(_r),_r}this._gateway.state="CONNECTING",this.store.preloadStart();const P=await OX({appId:e,cname:r,uid:d,stringUid:typeof d=="string"?d:void 0,token:i||e,cloudProxyServer:this._cloudProxyServerMode});if(this.store.preloadEnd(),!this._joinAndNotLeaveYet)throw new t_(Gi.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));const x=(P==null?void 0:P.sid)||pI();Wt.info("[".concat(this._clientId,"] start join channel ").concat(r,", join number: ").concat(f)),this._sessionId||(this._sessionId=x,this.store.sessionId=this._sessionId);const H=k_.reportApiInvoke(x,{id:this._clientId,name:QE.JOIN,options:[e,r,i,d],states:{isHttps:g,isSecureContext:b},tag:FE.TRACER}),$=iR(iR(iR({},this._rtmConfig),{},{role:this.role,clientId:this._clientId,appId:e,sid:this._sessionId,cname:r,uid:typeof d!="string"?d:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:i||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:C,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint,preload:!!P},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType}),{},{apRequestDetail:_s("AP_REQUEST_DETAIL")||void 0});if(this._useLocalAccessPoint&&($.setLocalAPVersion=this._setLocalAPVersion),typeof d=="string"&&($.stringUid=d,this._uintUid?($.uid=this._uintUid,this._uintUid=void 0):$.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if($.aesmode=this._encryptionMode,$.aespassword=await(async _r=>{const Fi=function(_u){const ga=window.atob(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),_m=new Uint8Array(new ArrayBuffer(ga.length));for(let r_=0;r_<ga.length;r_+=1)_m[r_]=ga.charCodeAt(r_);return _m}(),Di=await window.crypto.subtle.importKey("spki",Fi,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),Js=XV(_r),_l=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},Di,Js);return function(_u){let ga="";for(let _m=0;_m<_u.length;_m+=1)ga+=String.fromCharCode(_u[_m]);return window.btoa(ga)}(new Uint8Array(_l))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new t_(Gi.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&($.aessalt=this._encryptionSalt)}if(this._encryptDataStream&&(this._encryptionMode==="aes-128-gcm2"||this._encryptionMode==="aes-256-gcm2"))if(this._encryptionSalt&&this._encryptionSecret)if(window.crypto.subtle){const _r=new TextEncoder,Fi=_s("USE_PURE_ENCRYPTION_MASTER_KEY")?_r.encode($.appId+this._encryptionSecret+this._encryptionSecret):_r.encode($.appId+$.cname+this._encryptionSecret);this._encryptDataStreamIv=await async function(Di,Js,_l){const _u=await window.crypto.subtle.importKey("raw",Js,"PBKDF2",!1,["deriveBits","deriveKey"]),ga=Di==="aes-128-gcm2"?128:256,_m=await window.crypto.subtle.deriveBits({name:"PBKDF2",iterations:F4,hash:"SHA-256",salt:_l},_u,ga+Kdt);return new Uint8Array(_m).subarray(ga/8)}(this._encryptionMode,Fi,hI(this._encryptionSalt)),this._encryptDataStreamKey=await async function(Di,Js,_l){const _u=await window.crypto.subtle.importKey("raw",Js,"PBKDF2",!1,["deriveBits","deriveKey"]),ga=Di==="aes-128-gcm2"?128:256;return await window.crypto.subtle.deriveKey({name:"PBKDF2",iterations:F4,hash:"SHA-256",salt:_l},_u,{name:"AES-GCM",length:ga},!0,["encrypt","decrypt"])}(this._encryptionMode,Fi,hI(this._encryptionSalt))}else b?Wt.warning("[".concat(this._clientId,"] encrypt datastream must be running in a secure context, fallback to plain data stream")):Wt.warning("[".concat(this._clientId,"] current browser do not support WebCrypto ,fallback to plain data stream")),this._encryptDataStream=!1;else this._encryptDataStream=!1,Wt.debug("[".concat(this._clientId,"] no salt / secret, cannot support encrypt data stream, fallback to plain data stream"));this._startSession(this._sessionId,{channel:r,appId:e,stringUid:$.stringUid});const _t=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&_t===this._sessionId&&k_.joinChannelTimeout(this._sessionId,5)},5e3);try{var _i;let _r;const Fi=$.cloudProxyServer;if(E_(_i=["proxy3","proxy4","proxy5"]).call(_i,Fi)){const ga=_s("PROXY_SERVER_TYPE3");Array.isArray(ga)?$.proxyServer=ga[0]:$.proxyServer=ga}if(k_.setProxyServer($.proxyServer),Wt.setProxyServer($.proxyServer),this.store.requestAPStart(),P){if(Wt.debug("[".concat(this._clientId,"] get serverInfo Success from Preload Cache ").concat($.stringUid?", ".concat($.stringUid," => ").concat(P.intUid):""," ")),$.stringUid&&!$.uid&&($.uid=P.intUid),_r={gatewayInfo:P.ap.gatewayInfo},_s("JOIN_WITH_FALLBACK_MEDIA_PROXY")&&$.turnServer.mode==="auto")if(P.ap.proxyInfo.addresses.length===0)Wt.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers");else{const ga=(await IJ(P.ap.proxyInfo,P.ap.gatewayInfo.uid)).map(_m=>({turnServerURL:_m.address,tcpport:_m.tcpport||RS.tcpport,udpport:_m.udpport||RS.udpport,username:_m.username||RS.username,password:_m.password||RS.password,forceturn:!1,security:!0}));$.turnServer={mode:"manual",servers:ga}}DX(P,$.stringUid)}else{if($.stringUid&&!$.uid){let ga;[ga,_r]=await T_.all([$J($.stringUid,$,this._axiosCancelSource.token,this._config.httpRetryConfig||Mb,this.store).finally(()=>{this.store.requestSUAEnd()}),ZJ($,this._axiosCancelSource.token,this._config.httpRetryConfig||Mb,!0,this.store).finally(()=>{this.store.requestAPEnd()})]),Wt.debug("[".concat(this._clientId,"] getUserAccount Success ").concat($.stringUid," => ").concat(ga)),$.uid=ga,_r.gatewayInfo.uid=ga,_r.gatewayInfo.res.uid=ga}else _r=await ZJ($,this._axiosCancelSource.token,this._config.httpRetryConfig||Mb,!0,this.store);if(!this._joinAndNotLeaveYet)throw new t_(Gi.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"))}this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute($,this._axiosCancelSource.token),this._configDistribute.on(XN.UPDATE_BITRATE_LIMIT,ga=>{this._p2pChannel.updateBitrateLimit(ga)}),this._configDistribute.on(XN.UPDATE_CLIENT_ROLE_OPTIONS,ga=>{this._setClientRoleOptions(ga)})},0),this._key=i||e;const Di=_r.gatewayInfo,Js=$.uid?$.uid:Di.uid;this._joinInfo=iR(iR({},$),{},{cid:Di.cid,uid:Js,vid:Di.vid,apResponse:Di.res,apGatewayAddress:Di.apGatewayAddress,uni_lbs_ip:Di.uni_lbs_ip,gatewayAddrs:Di.gatewayAddrs}),this.store.intUid=Js,this.store.cid=Di.cid;const _l=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new t_(Gi.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));H.onSuccess(_l),this._appId=e,this._channelName=$.cname,this._uid=_l,this.store.uid=_l,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(yS()?"beforeunload":"pagehide",this._handleBeforeUnload),this._statsCollector.startUpdateStats()},0);const _u=$.stringUid?"string uid: ".concat($.stringUid,",uid: ").concat($.uid):"uid: ".concat(this._uid);return Wt.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(r,",").concat(_u)),setTimeout(()=>{Wt.startUpload()},5e3),this.store.joinEnd(),ue=this,E_(bI).call(bI,ue)||bI.push(ue),this._cloudProxyServerMode==="disabled"&&uE().supportWebCrypto&&_s("ENABLE_PRELOAD")&&yG(this._joinInfo),_l}catch(_r){const Fi=Array.isArray(_r)?_r[0]:_r;throw Fi&&Fi.code===Gi.OPERATION_ABORTED?Wt.warning("[".concat(this._clientId,"] join number: ").concat(f,", Joining channel failed, rollback"),Fi):Wt.error("[".concat(this._clientId,"] join number: ").concat(f,", Joining channel failed, rollback"),Fi),Fi.code!==Gi.OPERATION_ABORTED&&this._numberOfJoinCount===f&&(this._gateway.state="DISCONNECTED",this._reset()),H.onError(Fi),Fi}var ue}_joinGateway(){if(!this._joinInfo||!this._key)throw new t_(Gi.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!_s("JOIN_WITH_FALLBACK_SIGNAL_PROXY")))}async leave(){Wt.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(yS()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(r){const i=bI.indexOf(r);i!==-1&&bI.splice(i,1)}(this),this._statsCollector.stopUpdateStats();const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return Wt.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED",_E.LEAVE),Wt.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let r=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!Array.isArray(e)){if(!(e instanceof wO))return this._publishDataChannel(e);e=[e]}if(e.length===0)throw new t_(Gi.INVALID_PARAMS,"param list is empty");const i=e;if(this._gateway.role==="audience")throw new t_(Gi.INVALID_OPERATION,"audience can not publish stream");for(const h of i){if(!(h instanceof wO))throw new t_(Gi.INVALID_PARAMS,"parameter is not local track");if(!h._enabled&&r)throw new t_(Gi.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(h.getTrackId()))}Wt.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(i.map(h=>"".concat(h.getTrackId()," "))));const d=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),r&&i.forEach(h=>{const f=this._configDistribute.getBitrateLimit();h instanceof LE&&f&&h.setBitrateLimit(f.uplink)});try{await this._publishHighStream(i),Wt.info("[".concat(this._clientId,"] Publish success, id ").concat(i.map(h=>"".concat(h.getTrackId()," "))))}catch(h){throw Wt.error("[".concat(this._clientId,"] publish error"),h.toString()),h}finally{d()}}async _publishDataChannel(e){if(e==null)throw new t_(Gi.INVALID_PARAMS,"parameter is not local track or datachannel config, config is ".concat(JSON.stringify(e)));IE(e.id,"id",0,65535,!0),_R(e.ordered,"ordered"),fS(e.metadata,"metadata",0,512),Wt.info("[".concat(this._clientId,"] Publishing datachannels, id ").concat(e.id));const r=await this._publishMutex.lock();try{if(this._p2pChannel.getAllDataChannels().findIndex(h=>h.id===e.id)!==-1)throw new t_(Gi.INVALID_PARAMS,"Invalid id: ".concat(e.id,". If you want to republish the datachannel, unpublish first"));if(!this._joinInfo||this._uid===void 0)throw new t_(Gi.INVALID_OPERATION,"Can't publish datachannel, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not publish datachannel in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&_s("FORCE_TURN")&&!_s("TURN_ENABLE_TCP")&&!_s("TURN_ENABLE_UDP"))throw new t_(Gi.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");const i=function(h){return qJ(h,!1)}(e),d=await this._p2pChannel.publishDataChannel([i]);if(d.length>0){if(typeof i._originDataChannelId!="number")throw Wt.error("[".concat(this._clientId,"] can not publish with mediaType datachannel, cannot get RTCDatachannel id")),new t_(Gi.CREATE_DATACHANNEL_ERROR);try{await T_.all(d.map(h=>this._uid&&this._gateway.publishDataChannel(this._uid,h,!0))),await i._waitTillOpen()}catch(h){if(h.code!==Gi.DISCONNECT_P2P)throw h}}return Wt.info("[".concat(this._clientId,"] Publish dataChannels success, id ").concat(i.id)),i}catch(i){throw Wt.error("[".concat(this._clientId,"] publish datachannels error"),i.toString()),i}finally{r()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new t_(Gi.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");let r=[];if(e)if(Array.isArray(e))r=e;else{if(!(e instanceof wO))return this._unpublishDataChannel([e]);r=[e]}else this.store.useP2P||await this._unpublishDataChannel(),r=this._p2pChannel.getAllTracks(!0);Wt.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(r.map(d=>"".concat(d.getTrackId()," "))," "));const i=await this._publishMutex.lock();try{if(this.store.useP2P){const d=await this._p2pChannel.unpublish(r);d&&await this._gateway.sendExtensionMessage($E.UNPUBLISH,{unpubMsg:d},!0)}else{const d=await this._p2pChannel.unpublish(r);d&&await this._gateway.unpublish(d,this._uid),Wt.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(r.map(h=>"".concat(h.getTrackId()))))}}catch(d){throw Wt.error("[".concat(this._clientId,"] unpublish error"),d.toString()),d}finally{i&&i()}}async _unpublishDataChannel(e){e!==void 0&&e.length!==0||(e=this._p2pChannel.getAllDataChannels()),Wt.info("[".concat(this._clientId,"] Unpublish datachannels, datachannels ").concat(e.map(i=>"".concat(i.id," "))," "));const r=await this._publishMutex.lock();try{const i=await this._p2pChannel.unpublishDataChannel(e);i&&await this._gateway.unpublishDataChannel(i),Wt.info("[".concat(this._clientId,"] Unpublish dataChannel success,dataChannel ").concat(e.map(d=>"".concat(d.id))))}catch(i){throw Wt.error("[".concat(this._clientId,"] unpublish dataChannel error"),i.toString()),i}finally{r&&r()}}async subscribe(e,r,i){if(!(e instanceof U0)){const d=this.remoteUsers.find(h=>h.uid===e);if(!d)throw new t_(Gi.INVALID_REMOTE_USER,"user is not in the channel");e=d}return r==="datachannel"?this._subscribeDataChannel(e,i):this._subscribe(e,r)}async presubscribe(e,r){if(oS(r,"mediaType",["audio","video"]),this.store.useP2P)throw new t_(Gi.INVALID_OPERATION,"can't presub at p2p mode");if(!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"can't presub when not join");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can't presub in ".concat(this.connectionState," state"));const i=r===A_.AUDIO,d=r===A_.VIDEO,h=await this._subscribeMutex.lock();try{const{ssrcId:f,ortc:g,rtxSsrcId:b,cname:C,uint_id:P}=await this._gateway.presubscribe(e,r,!0);if(f==null)throw new t_(Gi.UNEXPECTED_RESPONSE,"no ssrc id");let x=this._users.find($=>$.uid===e);x||(x=new U0(e,P||e),x._is_pre_created=!0,this._users.push(x)),C&&(x._cname=C),x._uintid||(x._uintid=P||e),i&&(x._audioSSRC=f,x._audio_pre_subscribed=!0,g&&(x._audioOrtc=g)),d&&(x._videoSSRC=f,x._video_pre_subscribed=!0,g&&(x._videoOrtc=g),b!=null&&(x._rtxSsrcId=b)),Wt.info("[".concat(this._clientId,"] presub succeed ssrc: ").concat(f)),await this._p2pChannel.subscribe(x,r,f,b,g);const H=i?x._audioTrack:x._videoTrack;if(!H)throw new t_(Gi.UNEXPECTED_ERROR,"can not find remote track in user");return i&&(x._trust_audio_stream_added_state_=!0,x._audio_added_=!0),d&&(x._trust_video_stream_added_state_=!0,x._video_added_=!0),H}catch(f){throw Wt.error("[".concat(this._clientId,"] presub user ").concat(e," error"),f),f}finally{h()}}async _subscribeDataChannel(e,r){var i;if(IE(r,"channelId",0,65535,!0),!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"Can't subscribe datachannel, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"Can't subscribe datachannel in ".concat(this.connectionState," state"));if(!this._users.find(b=>b===e))throw Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),new t_(Gi.INVALID_REMOTE_USER,"user is not in the channel");if(!e.hasAudio&&!e.hasVideo&&e._dataChannels.length===0)throw Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),new t_(Gi.INVALID_REMOTE_USER,"user is not published");const h=(i=e._dataChannels)===null||i===void 0?void 0:i.find(b=>b.id===r);if(!h)throw Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, remote datachannel is not published")),new t_(Gi.REMOTE_USER_IS_NOT_PUBLISHED);const f=await this._subscribeMutex.lock();Wt.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: datachannel"));try{const b=await this._p2pChannel.subscribeDataChannel(e,[h]);if(b&&E_(b).call(b,h.id))try{var g;if(typeof h._originDataChannelId!="number")throw Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType datachannel, cannot get RTCDatachannel")),new t_(Gi.CREATE_DATACHANNEL_ERROR);const C={id:h.id,datachannelId:h._originDataChannelId,ordered:h.ordered,maxRetransmits:h.maxRetransmits,metadata:(g=h.metadata)!==null&&g!==void 0?g:""};await this._gateway.subscribeDataChannel(e.uid,C,!0),await h._waitTillOpen()}catch(C){if((C==null?void 0:C.code)!==Gi.WS_ABORT)throw await this._p2pChannel.unsubscribeDataChannel(e,[h]),C;await this._p2pChannel.unsubscribeDataChannel(e,[h]),this._p2pChannel.setPendingRemoteDataChannel(e,h.id)}return Wt.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: datachannel")),h}finally{f()}}async _p2pSubscribe(e,r,i){if(oS(r,"mediaType",["audio","video"]),!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(f=>f===e)){const f=new t_(Gi.INVALID_REMOTE_USER,"user is not in the channel");throw Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),f}if(!e.hasAudio&&!e.hasVideo){const f=new t_(Gi.INVALID_REMOTE_USER,"user is not published");throw Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),f}if(!i&&(r==="audio"&&!e.hasAudio||r==="video"&&!e.hasVideo)){const f=new t_(Gi.REMOTE_USER_IS_NOT_PUBLISHED);throw Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),f}const h=await this._subscribeMutex.lock();Wt.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const g=r==="audio"?e._audioSSRC:e._videoSSRC,b=r==="audio"?e._audioMid:e._videoMid;this.store.subscribe(e.uid,r,Date.now()),this.store.useP2P&&await this._p2pChannel.subscribe(e,r,g,b)}catch(g){throw g}Wt.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(g=>{Wt.warning("[".concat(this._clientId,"] auto set fallback failed"),g)});const f=r==="audio"?e._audioTrack:e._videoTrack;if(!f)throw new t_(Gi.UNEXPECTED_ERROR,"can not find remote track in user object");return f}catch(f){throw Wt.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),f),f}finally{h()}}async _subscribe(e,r,i){if(this.store.useP2P)return this._p2pSubscribe(e,r);if(oS(r,"mediaType",["audio","video"]),!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(P=>P===e)){const P=new t_(Gi.INVALID_REMOTE_USER,"user is not in the channel");throw Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),P}if(!e.hasAudio&&!e.hasVideo){const P=new t_(Gi.INVALID_REMOTE_USER,"user is not published");throw Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),P}if(!(i||(r!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(r!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const P=new t_(Gi.REMOTE_USER_IS_NOT_PUBLISHED);throw Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(r,", remote track is not published")),P}let h=r==="audio"?e._audioSSRC:e._videoSSRC,f=r==="audio"?e._audioOrtc:e._videoOrtc,g=r==="video"?e._rtxSsrcId:void 0,b={stream_type:r==="audio"?A_.AUDIO:A_.VIDEO,ssrcId:h};r==="video"&&this.store.firstVideoFrameDecoded(e.uid,{subscribeStart:Date.now()});const C=await this._subscribeMutex.lock();Wt.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(r));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,r))await this._p2pChannel.unmuteRemote(e,r);else try{const x=r==="audio"?e._audioSSRC:e._videoSSRC;x!==void 0&&x!==h&&(h=x,f=r==="audio"?e._audioOrtc:e._videoOrtc,g=r==="video"?e._rtxSsrcId:void 0,b={stream_type:r==="audio"?A_.AUDIO:A_.VIDEO,ssrcId:h}),NS.markSubscribeStart(this.store.clientId,h),this.store.subscribe(e.uid,r,Date.now()),await this._p2pChannel.subscribe(e,r,h,g,f);try{this._p2pChannel.isPreSubScribe(h)||await this._gateway.subscribe(e.uid,b,!0)}catch(H){if((H==null?void 0:H.code)!==Gi.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,r),H;await this._p2pChannel.unsubscribe(e,r,!0),this._p2pChannel.setPendingRemoteMedia(e,r)}this.store.subscribe(e.uid,r,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,r)}catch(x){throw this._p2pChannel.reportSubscribeEvent(!1,x==null?void 0:x.code,e,r),x}Wt.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(r)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(x=>{Wt.warning("[".concat(this._clientId,"] auto set fallback failed"),x)});const P=r==="audio"?e._audioTrack:e._videoTrack;if(!P)throw new t_(Gi.UNEXPECTED_ERROR,"can not find remote track in user object");return r==="video"&&(this.store.firstVideoFrameDecoded(e.uid,{subscribeEnd:Date.now()}),this._p2pChannel.reportVideoFirstFrameRender(e)),P}catch(P){throw Wt.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),P),P}finally{C()}}async massSubscribe(e){if(r0(e,"subscribeList"),!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const r=Date.now(),i=new Map,d=await this._subscribeMutex.lock();Wt.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(b=>{let{user:C,mediaType:P}=b;return"user: ".concat(C==null?void 0:C.uid,", mediaType: ").concat(P)}).join("; ")));const h=(e=[...e]).map(b=>{let{user:C,mediaType:P}=b;return{user:C,mediaType:P}}),f=await this._p2pChannel.globalLock();try{var g;for(let C=e.length-1;C>=0;C--){const P=e[C],{user:x,mediaType:H}=P;if(oS(H,"mediaType",["audio","video"]),!x){const ue=new t_(Gi.INVALID_PARAMS,"user property does not exist in subscribeList item");throw Wt.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),ue}if(!this._users.find(ue=>ue===x)){const ue=new t_(Gi.INVALID_REMOTE_USER,"user is not in the channel");Wt.error("[".concat(this._clientId,"] can not massSubscribe ").concat(x.uid,", this user is not in the channel")),h[C].error=ue,e.splice(C,1);continue}if(H==="audio"&&(!x.hasAudio||x._audioSSRC===void 0)||H==="video"&&(!x.hasVideo||x._videoSSRC===void 0)){const ue=new t_(Gi.REMOTE_USER_IS_NOT_PUBLISHED);Wt.error("[".concat(this._clientId,"] can not subscribe ").concat(x.uid," with mediaType ").concat(H,", remote user is not published")),h[C].error=ue,e.splice(C,1);continue}const _t=cS.Video|cS.LwoVideo,_i=i.get(x);if(_i){if(H==="video"?_i&_t:_i&cS.Audio){e.splice(C,1),Wt.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(x.uid,", mediaType:").concat(H," twice"));continue}i.set(x,_i|(H==="video"?_t:cS.Audio))}else i.set(x,H==="video"?_t:cS.Audio)}for(let C=e.length-1;C>=0;C--){const P=e[C],{user:x,mediaType:H}=P,$=cS.Video|cS.LwoVideo;if(this._p2pChannel.hasRemoteMedia(x,H)){await this._p2pChannel.unmuteRemoteNoLock(x,H);const _t=i.get(x);i.set(x,H==="video"?_t^$:_t^cS.Audio),e.splice(C,1)}}this.store.massSubscribe(e.map(C=>({userId:C.user.uid,type:C.mediaType})),r);let b=GT(g=Array.from(i.entries())).call(g,(C,P)=>{let[x,H]=P;if(H===0)return C;const $={stream_id:x.uid,stream_type:H};return H&cS.Audio&&($.audio_ssrc=x._audioSSRC),H&cS.Video&&($.video_ssrc=x._videoSSRC),C.push($),C},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(P=>{let{user:x,mediaType:H}=P;return{user:x,mediaType:H,ssrcId:H===A_.VIDEO?x._videoSSRC:x._audioSSRC,rtxSsrcId:H===A_.VIDEO?x._rtxSsrcId:void 0}}));const C=new Map;if(b=b.filter(P=>P.video_ssrc&&!this._p2pChannel.isPreSubScribe(P.video_ssrc)||P.audio_ssrc&&!this._p2pChannel.isPreSubScribe(P.audio_ssrc)||!P.video_ssrc&&!P.audio_ssrc),b.length>0){const P=await this._gateway.subscribeAll(b,!0);((P==null?void 0:P.users)||[]).forEach(x=>{let{stream_id:H,video_error_code:$,audio_error_code:_t,error_code:_i}=x;($||_t||_i)&&C.set(H,{video_error_code:$,audio_error_code:_t,error_code:_i})})}if(Array.from(C.entries()).length>0){const P=[];Array.from(C.entries()).forEach(x=>{let[H,$]=x;const _t=this.remoteUsers.find(_i=>_i.uid===H);if(_t){let _i;$.error_code||$.video_error_code&&$.audio_error_code?_i=void 0:$.video_error_code?_i=A_.VIDEO:$.audio_error_code&&(_i=A_.AUDIO),P.push({user:_t,mediaType:_i})}}),P.length>0&&await this._p2pChannel.massUnsubscribeNoLock(P)}for(const P of h){const x=C.get(P.user.uid);if(x){const H=x.error_code||P.mediaType==="audio"&&x.audio_error_code||P.mediaType==="video"&&x.video_error_code;if(H){const $=QN(H);Wt.error("user:".concat(P.user.uid," mediaType:").concat(P.mediaType," has massSubscribe error ").concat($.desc)),P.error=new t_(Gi.SUBSCRIBE_FAILED,"code ".concat(H,": ").concat($.desc))}}P.error||(P.mediaType==="video"?P.track=P.user.videoTrack:P.track=P.user.audioTrack)}return this.store.massSubscribe(h.filter(P=>!P.error).map(P=>({userId:P.user.uid,type:P.mediaType})),void 0,Date.now()),h.forEach(P=>{var x;k_.subscribe(this.store.sessionId,{succ:!!P.error,ec:((x=P.error)===null||x===void 0?void 0:x.code)||null,video:P.mediaType===A_.VIDEO,audio:P.mediaType===A_.AUDIO,peerid:P.user.uid,subscribeRequestid:P.mediaType===A_.VIDEO?P.user._videoSSRC:P.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-r),preSsrc:this._p2pChannel.isPreSubScribe(P.user._videoSSRC)},!0)}),Wt.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(P=>{let{user:x,mediaType:H}=P;return"user: ".concat(x==null?void 0:x.uid,", mediaType: ").concat(H)}).join("; "))),h}catch(C){throw await this._p2pChannel.massUnsubscribeNoLock(e),C}}finally{f(),d()}}async unsubscribe(e,r,i){if(!(e instanceof U0)){const f=this.remoteUsers.find(g=>g.uid===e);if(!f)throw new t_(Gi.INVALID_REMOTE_USER,"user is not in the channel");e=f}if(r||this.store.useP2P){if(r==="datachannel")return this._unsubscribeDataChannel(e,i)}else await this._unsubscribeDataChannel(e,i);if(r&&oS(r,"mediaType",["audio","video"]),!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(f=>f===e)){const f=new t_(Gi.INVALID_REMOTE_USER,"user is not in the channel");throw Wt.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),f}Wt.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(r));const h=await this._subscribeMutex.lock();try{if(this.store.useP2P)await this._p2pChannel.unsubscribe(e,r);else{const f=await this._p2pChannel.unsubscribe(e,r);f&&await this._gateway.unsubscribe(f,e.uid),r&&r!=="audio"||(e._audio_pre_subscribed=!1),r&&r!=="video"||(e._video_pre_subscribed=!1),e._is_pre_created&&RL(this._users,e),Wt.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(r))}}catch(f){if(f.code===Gi.DISCONNECT_P2P)return void Wt.warning("disconnecting p2p, abort unsubscribe request.");throw Wt.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),f.toString()),f}finally{h()}}async _unsubscribeDataChannel(e,r){if(r&&IE(r,"id",0,65535,!0),!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"Can't unsubscribe datachannel, haven't joined yet!");if(!this._users.find(h=>h===e)){const h=new t_(Gi.INVALID_REMOTE_USER,"user is not in the channel");throw Wt.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),h}let d;if(typeof r=="number"){const h=e._dataChannels.find(f=>f.id===r);h&&(d=[h])}else d=e._dataChannels;if(d===void 0){const h=new t_(Gi.REMOTE_USER_IS_NOT_PUBLISHED);throw Wt.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid," with channelId ").concat(r,", remote datachannel is not published")),h}Wt.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(d.map(h=>h.id)));try{const h=await this._p2pChannel.unsubscribeDataChannel(e,d);h&&await this._gateway.unsubscribeDataChannel(h,e.uid),Wt.info("[".concat(this._clientId,"] unsubscribe datachannel success uid: ").concat(e.uid,", mediaType: datachannel, ids: ").concat(h))}catch(h){if(h.code===Gi.DISCONNECT_P2P)return void Wt.warning("disconnecting p2p, abort unsubscribe request.");throw Wt.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),h.toString()),h}}async massUnsubscribe(e){if(r0(e,"unsubscribeList"),!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");Wt.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(i=>{let{user:d,mediaType:h}=i;return"user: ".concat(d==null?void 0:d.uid,", mediaType: ").concat(h,";")}).join())),e=[...e];const r=new Map;for(let i=e.length-1;i>=0;i--){const{user:d,mediaType:h}=e[i];if(!d){const b=new t_(Gi.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw Wt.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),b}if(oS(h,"mediaType",["video","audio",void 0]),!this._users.find(b=>b===d)){Wt.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(d.uid,", user is not in the channel")),e.splice(i,1);continue}const g=cS.Video|cS.LwoVideo;if(r.has(d)){const b=r.get(d);let C;switch(h){case"video":C=b&g;break;case"audio":C=b&cS.Audio;break;default:C=b&(cS.Audio|g)}if(C){Wt.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(d.uid,",mediaType:").concat(h," twice.")),e.splice(i,1);continue}h?h==="audio"?r.set(d,b|cS.Audio):h==="video"&&r.set(d,b|g):r.set(d,b|cS.Audio|g)}else h?h==="audio"?r.set(d,cS.Audio):h==="video"&&r.set(d,g):r.set(d,cS.Audio|g)}try{const i=await this._p2pChannel.massUnsubscribe(e);i&&await this._gateway.massUnsubscribe(i),Wt.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(d=>{let{user:h,mediaType:f}=d;return"user: ".concat(h==null?void 0:h.uid,", mediaType: ").concat(f,";")}).join()))}catch(i){if(i.code===Gi.DISCONNECT_P2P)return void Wt.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw Wt.error("[".concat(this._clientId,"] massUnsubscribe error"),i.toString()),i}}async setLowStreamParameter(e){(function(i){if(!i)throw new n_(Gi.INVALID_PARAMS);HE(i.width)||YV(i.width,"streamParameter.width"),HE(i.height)||YV(i.height,"streamParameter.height"),HE(i.framerate)||YV(i.framerate,"streamParameter.framerate"),HE(i.bitrate)||IE(i.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&Wt.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),Wt.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const r=this._configDistribute.getLowStreamConfigDistribute();if(r&&r.bitrate&&e.bitrate&&r.bitrate<e.bitrate&&(e.bitrate=r.bitrate),this._lowStreamParameter=e,this._isDualStreamEnabled)return this._p2pChannel.updateVideoStreamParameter(e,l_.LocalVideoLowTrack)}async enableDualStream(){if(!uE().supportDualStream)throw k_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new t_(Gi.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new t_(Gi.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw k_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,k_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),Wt.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(l_.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw k_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,k_.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),Wt.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,r){if(function(d){oS(d,"role",["audience","host"])}(e),r&&ZV(r),this.mode==="rtc"||this.mode==="p2p")throw Wt.warning("[".concat(this._clientId,"]").concat(this.mode," mode can not use setClientRole")),new t_(Gi.INVALID_OPERATION,"".concat(this.mode," mode can not use setClientRole"));if(r&&r.level&&e==="host")throw new t_(Gi.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new t_(Gi.INVALID_OPERATION,"can not set client role to audience when publishing stream");const i=this._config.role;this._joinInfo&&(this._joinInfo.role=e),e!==i&&_s("ENABLE_ROLE_SELECT_EDGE")?(this._gateway.updateClientRole(e,r),this._config.role=e,this._gateway.reconnect("recover",SS.REGIONAL_DISTRIBUTION)):(await this._gateway.setClientRole(e,r),this._config.role=e),Wt.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(r&&r.level))}async _setClientRoleOptions(e){if(this.mode==="rtc"||this.mode==="p2p"||this._config.role!=="audience"||this._p2pChannel.hasLocalMedia())return;let r=!1;try{e&&ZV(e),await this._gateway.setClientRole(this._config.role,e),r=!0}catch{}finally{Wt.info("[".concat(this._clientId,"] set client role options ").concat(r?"succeed":"failed",", options is ").concat(e))}}getRemoteInboundOffset(){var e;const r=(e=this._p2pChannel.getStats())===null||e===void 0?void 0:e.audioSend[0];if(!r||!r.timestamp)return 0;const i=r.timestamp-Date.now();return Math.abs(i)>1e3+r.rttMs+100?this.ntpAlignErrorCount+=1:this.ntpAlignErrorCount=0,this.ntpAlignErrorCount>=3?i:0}getNtpWallTimeInMs(){return document.visibilityState==="visible"&&(this.remoteInboundOffset=this.getRemoteInboundOffset()),this.remoteInboundOffset+Date.now()+this._gateway.ntpOffset}setProxyServer(e,r){if(fS(e,"proxyServer"),!r){if(this.connectionState!=="DISCONNECTED")throw new t_(Gi.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new t_(Gi.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,k_.setProxyServer(this._proxyServer),Wt.setProxyServer(this._proxyServer),Wt.info("[".concat(this._clientId,"] Set proxy server ").concat(r?"by initialize call":""," success."))}setTurnServer(e,r){if(Array.isArray(e)||(e=[e]),!r){if(this.connectionState!=="DISCONNECTED")throw new t_(Gi.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new t_(Gi.INVALID_OPERATION,"You have already set the proxy")}if(jN(e))return this._turnServer={servers:e,mode:"original-manual"},void Wt.info("[".concat(this._clientId,"] Set original turnserver ").concat(r?"by initialize call":""," success: ").concat(e.map(i=>i.urls).join(","),"."));e.forEach(i=>g4(i)),this._turnServer={servers:e,mode:"manual"},Wt.info("[".concat(this._clientId,"] Set turnserver ").concat(r?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new t_(Gi.INVALID_OPERATION,"you should set license before join channel");if(fS(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new t_(Gi.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,Wt.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new t_(Gi.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new t_(Gi.INVALID_OPERATION,"You have already set the proxy");const r=[3,4,5];let i;switch(e===void 0&&(e=3),e){case 1:case 2:throw new t_(Gi.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:i="proxy3";break;case 4:i="proxy4";break;case 5:i="proxy5";break;default:throw new t_(Gi.INVALID_PARAMS,"proxy server mode must be ".concat(r.join("|")))}this._cloudProxyServerMode=i,this.store.cloudProxyServerMode=i,Wt.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new t_(Gi.INVALID_OPERATION,"Stop proxy server after leave channel");k_.setProxyServer(),Wt.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",Wt.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new t_(Gi.INVALID_PARAMS,"accessPoints is required.");r0(e.accessPoints.serverList,"accessPoints.serverList"),fS(e.accessPoints.domain,"accessPoints.domain");const r=($,_t)=>{IE($,_t,0,65535,!0)};let i=443;if(e.accessPoints.port&&(r(e.accessPoints.port,"accessPoints.port"),i=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new t_(Gi.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");_s("CLOSE_AFB_FOR_LOCAL_AP")&&(SE("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),SE("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const d=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,h=e.accessPoints.domain,f=e.accessPoints.serverList.map($=>d.test($)?"".concat($.replace(/\./g,"-"),".").concat(h):$),g=f.map($=>"".concat($,":").concat(i));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,SE("WEBCS_DOMAIN",g),SE("WEBCS_DOMAIN_BACKUP_LIST",g),SE("GATEWAY_DOMAINS",[h]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(r0(e.report.hostname,"report.hostname"),SE("EVENT_REPORT_DOMAIN",e.report.hostname[0]),SE("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(SE("EVENT_REPORT_DOMAIN",f[0]),SE("EVENT_REPORT_BACKUP_DOMAIN",f[1]||f[0]));let b=6443;e.report&&e.report.port&&(r(e.report.port,"report.port"),b=e.report.port),SE("STATS_COLLECTOR_PORT",b),e.report?SE("ENABLE_EVENT_REPORT",!0):SE("ENABLE_EVENT_REPORT",!1);let C="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(r0(e.log.hostname,"log.hostname"),C=e.log.hostname[0]):C=f[0];let P=6444;e.log&&e.log.port&&(r(e.log.port,"log.port"),P=e.log.port),SE("LOG_UPLOAD_SERVER","".concat(C,":").concat(P));let x=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(r0(e.cds.hostname,"cds.hostname"),x=e.cds.hostname):x=f;let H=443;e.cds&&e.cds.port&&(r(e.cds.port,"cds.port"),H=e.cds.port),SE("CDS_AP",x.map($=>"".concat($,":").concat(H))),e.cds?SE("ENABLE_CONFIG_DISTRIBUTE",!0):SE("ENABLE_CONFIG_DISTRIBUTE",!1),Wt.info("set local access point v2 success")}setLocalAccessPoints(e,r){if(r0(e,"serverList"),fS(r,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new t_(Gi.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const i=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(d=>i.test(d)?"".concat(d.replace(/\./g,"-"),".").concat(r):d),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,SE("WEBCS_DOMAIN",e),SE("WEBCS_DOMAIN_BACKUP_LIST",e),SE("GATEWAY_DOMAINS",[r]),SE("EVENT_REPORT_DOMAIN",e[0]),SE("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),SE("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),Wt.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(oS(e,"streamType",[0,1,4,5,6,7,8,9]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(r){throw Wt.error("[".concat(this._clientId,"] set default remote video stream type error"),r.toString()),r}else Wt.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,r){oS(r,"streamType",[0,1,4,5,6,7,8,9]);try{await this._gateway.setRemoteVideoStreamType(e,r),setTimeout(()=>{const i=this._users.find(d=>d.uid===e);i&&i.videoTrack&&i.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(i){throw Wt.error("[".concat(this._clientId,"] set remote video stream type error"),i.toString()),i}Wt.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(r)),this._remoteStreamTypeCacheMap.set(e,r)}async setStreamFallbackOption(e,r){oS(r,"fallbackType",[0,1,2,3,4,5,6,7,8]);try{await this._gateway.setStreamFallbackOption(e,r)}catch(i){throw Wt.error("[".concat(this._clientId,"] set stream fallback option"),i.toString()),i}Wt.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(r)),this._streamFallbackTypeCacheMap.set(e,r)}setEncryptionConfig(e,r,i,d){(function(f){oS(f,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])})(e),fS(r,"secret");const h=["aes-128-gcm2","aes-256-gcm2"];if(E_(h).call(h,e)){if(!i||!(i instanceof Uint8Array&&i.length===32))throw new t_(Gi.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(i)throw new t_(Gi.INVALID_PARAMS,"current encrypt mode does not need salt");if(d){if(_R(d,"encryptDataStream"),!E_(h).call(h,e))throw new t_(Gi.INVALID_PARAMS,"current encrypt mode does not support data stream");this._encryptDataStream=!0}new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(r)||Wt.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=r,i&&(this._encryptionSalt=w0(i))}async renewToken(e){if(fS(e,"token",1,2047),!this._key||!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"renewToken should not be called before user join");const r=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const i=await this._renewTokenMutex.lock();try{if(_s("USE_NEW_TOKEN")){Wt.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const d=await Iht(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Mb);Wt.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:d})}else Wt.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});Wt.debug("[".concat(this._clientId,"] renewToken success"))}catch(d){throw this._key=r,this._joinInfo.token=r,Wt.error("[".concat(this._clientId,"] renewToken failed"),d.toString()),d}finally{i()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?Wt.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(nE.VOLUME_INDICATOR,e)},_s("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),r=this._gateway.getInChannelInfo();return e.Duration=Math.round(r.duration/1e3),e}async startLiveStreaming(e,r){if(!r){if(this.codec!=="h264")throw new t_(Gi.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new t_(Gi.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new t_(Gi.LIVE_STREAMING_TASK_CONFLICT);const i=r?i0.TRANSCODE:i0.RAW;return this._createLiveStreamingClient(i).startLiveStreamingTask(e,i)}setLiveTranscoding(e){return this._createLiveStreamingClient(i0.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const r=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(i=>i&&i.hasUrl(e));if(!r.length)throw new t_(Gi.INVALID_PARAMS,"can not find live streaming url to stop");await T_.all(r.map(i=>i&&i.stopLiveStreamingTask(e)))}async startChannelMediaRelay(e){oX(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){oX(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendAudioMetadata(e){this._p2pChannel instanceof aP&&this._p2pChannel.addAudioMetadata(e)}async sendStreamMessage(e){var r;let i=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"can not send data stream, not joined");if((typeof e=="string"||e instanceof Uint8Array)&&(e={payload:e}),typeof e.payload=="string"){const h=new TextEncoder;e.payload=h.encode(e.payload)}let d=!1;if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&E_(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)&&(d=!0,e.payload=await async function(h,f,g){var b;const C=GT(b=Array.from(g)).call(b,(ue,_r)=>ue+_r,0),P={serverTs:0,seq:Hdt++,length:g.length,checkSum:C},x=new Uint8Array(w4(C,2)),H=new ArrayBuffer(bO),$=new DataView(H);$.setUint32(0,P.serverTs),$.setUint16(4,P.seq),$.setUint16(6,P.length),$.setUint16(8,P.checkSum);const _t=16-g.length%16;g=y4(g,new Uint8Array(_t));const _i=await window.crypto.subtle.encrypt({name:"AES-GCM",iv:h,tagLength:j4,additionalData:x},f,g);return y4(new Uint8Array(H),new Uint8Array(_i))}(this._encryptDataStreamIv,this._encryptDataStreamKey,e.payload)),new Blob([e.payload]).size>1024)throw new t_(Gi.INVALID_PARAMS,d?"encrypted stream message out of range.":"stream message out of range.");return this._gateway.signal.request(j_.DATA_STREAM,{payload:w0(e.payload),syncWithAudio:e.syncWithAudio,sendTs:Date.now()-kht},!i)}sendMetadata(e){if(!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new t_(Gi.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(j_.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:w0(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(elt),!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"can not send custom report, not joined");await k_.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){const e=this._statsCollector.getRemoteNetworkQualityStats();if(_s("DELETE_NEQ_AFTER_USER_LEAVE")){const r=this._users.map(i=>i.uid+"");Object.keys(e).forEach(i=>{E_(r).call(r,i)||delete e[i]})}return e}async pickSVCLayer(e,r){oS(r.spatialLayer,"spatialLayer",[0,1,2,3]),oS(r.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,r)}catch(i){throw Wt.error("[".concat(this._clientId,"] pick SVC layer failed"),i.toString()),i}}async setRTMConfig(e){const{apRTM:r=!1,rtmFlag:i}=e;if(_R(r,"apRTM"),IE(i,"rtmFlag",0),this._rtmConfig.apRTM=r,this._rtmConfig.rtmFlag=i,Wt.debug("[".concat(this._clientId,"] setRTMconfig ").concat(JSON.stringify(e)," in ").concat(this.connectionState," state")),(this.connectionState==="CONNECTED"||this.connectionState==="RECONNECTING")&&this._joinInfo)return this._joinInfo.apRTM=r,this._joinInfo.rtmFlag=i,this._gateway.setRTM2Flag(i)}_reset(){if(Wt.debug("[".concat(this._clientId,"] reset client")),function(e){const r=DO.indexOf(e);r!==-1&&DO.splice(r,1)}(this._clientId),this.store.hasStartJoinChannel=!1,this.store.isABTestSuccess=!1,this.store.autoSubscribe=!1,this._axiosCancelSource.cancel(),this._axiosCancelSource=zS.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo&&PX(this._joinInfo),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId&&k_.removeSid(this._sessionId),this._sessionId=null,this.store.sessionId=null,this.store.resetFirstVideoFrameDecoded(),this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._encryptDataStreamKey=null,this._encryptDataStreamIv=null,this._pendingPublishedUsers=[],this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy(),e._dataChannels&&(e._dataChannels.forEach(r=>r._close()),e._dataChannels.length=0)}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new wS("client-publish",this._clientId),this._subscribeMutex=new wS("client-subscribe",this._clientId),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,r){var i;const d=e||pI();e?Wt.debug("[".concat(this._clientId,"] new Session ").concat(d)):Wt.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(d));const h=e?"":this._sessionId||"";this._sessionId=d,this.store.sessionId=d,k_.addSid(d);const f={lts:new Date().getTime(),mode:this.mode,buildFormat:1,stringUid:(r==null?void 0:r.stringUid)||((i=this._joinInfo)===null||i===void 0?void 0:i.stringUid),channelProfile:this.mode==="live"?1:0,channelMode:0,isABTestSuccess:Number(this._configDistribute.isSuccess),lsid:h,clientRole:this.role==="audience"?2:1};k_.sessionInit(this._sessionId,iR({cname:r.channel,appid:r.appId},f)),this._joinInfo&&(this._joinInfo.sid=d),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=d)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new t_(Gi.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&_s("FORCE_TURN")&&!_s("TURN_ENABLE_TCP")&&!_s("TURN_ENABLE_UDP"))throw new t_(Gi.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");Wt.debug("[".concat(this._clientId,"] publish high stream"));try{const i=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter);if(this.store.useP2P){const d=(await i.next()).value;if(d){try{await this._gateway.sendExtensionMessage($E.PUBLISH,d,!0)}catch(h){throw i.throw(h),h}await i.next()}this._p2pChannel.reportPublishEvent(!0,null)}else{const d=(await i.next()).value;if(d){var r;let h;try{h=await this._gateway.publish(this._uid,d,!0)}catch(f){if(f.code!==Gi.DISCONNECT_P2P)throw i.throw(f),f}await i.next(((r=h)===null||r===void 0?void 0:r.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const h of e)h instanceof LE&&h._encoderConfig&&this._gateway.setVideoProfile(h._encoderConfig).catch(f=>{Wt.debug("[".concat(this._clientId,"] stop setVideoProfile, because websocket is closed"))}),!h.muted&&h.enabled||await this._p2pChannel.muteLocalTrack(h)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,e),(i==null?void 0:i.code)===Gi.WS_ABORT)return;throw i}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new t_(Gi.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new t_(Gi.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));Wt.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const i=await this._p2pChannel.publishLowStream(this._lowStreamParameter),d=(await i.next()).value;if(d){var r;let h;try{h=await this._gateway.publish(this._uid,d,!0)}catch(f){if(f.code!==Gi.DISCONNECT_P2P)throw i.throw(f),f}i.next(((r=h)===null||r===void 0?void 0:r.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(i){if(this._p2pChannel.reportPublishEvent(!1,i==null?void 0:i.code,void 0,!0),(i==null?void 0:i.code)===Gi.WS_ABORT)return;throw i}}_createLiveStreamingClient(e){const r=()=>{if(!this._joinInfo||!this._appId)return new t_(Gi.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const i=(d={joinInfo:this._joinInfo,appId:this._appId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig},a0("LiveStreaming").create(d));var d;return i.onLiveStreamError=(h,f)=>{k_.reportApiInvoke(this._sessionId,{name:QE.ON_LIVE_STREAM_ERROR,options:[h,f],tag:FE.TRACER}).onSuccess(),this.safeEmit(nE.LIVE_STREAMING_ERROR,h,f)},i.onLiveStreamWarning=(h,f)=>{k_.reportApiInvoke(this._sessionId,{name:QE.ON_LIVE_STREAM_WARNING,options:[h,f],tag:FE.TRACER}).onSuccess(),this.safeEmit(nE.LIVE_STREAMING_WARNING,h,f)},i.on(WF.REQUEST_WORKER_MANAGER_LIST,(h,f,g)=>{if(!this._joinInfo)return g(new t_(Gi.INVALID_OPERATION,"can not find join info to get worker manager"));(async function(b,C,P,x){const H=_s("UAP_AP").slice(0,_s("AJAX_REQUEST_CONCURRENT")).map($=>C.proxyServer?"https://".concat(C.proxyServer,"/ap/?url=").concat($+"/api/v1?action=uap"):"https://".concat($,"/api/v1?action=uap"));return await ght(H,b,C,P,x)})(h,this._joinInfo,this._axiosCancelSource.token,Mb).then(f).catch(g)}),i};return e===i0.RAW?(this._liveRawStreamingClient=this._liveRawStreamingClient||r(),this._liveRawStreamingClient):(this._liveTranscodeStreamingClient=this._liveTranscodeStreamingClient||r(),this._liveTranscodeStreamingClient)}_createChannelMediaRelayClient(){if(!this._joinInfo)return new t_(Gi.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:r,sendResolutionHeight:i}=this.getLocalVideoStats(),d=(e={joinInfo:this._joinInfo,clientId:this._clientId,websocketRetryConfig:this._config.websocketRetryConfig,httpRetryConfig:this._config.httpRetryConfig,resolution:{width:r,height:i}},a0("ChannelMediaRelay").create(e));d.on("state",h=>{h===eT.RELAY_STATE_FAILURE&&d&&d.dispose(),this.safeEmit(nE.CHANNEL_MEDIA_RELAY_STATE,h)}),d.on("event",h=>{this.safeEmit(nE.CHANNEL_MEDIA_RELAY_EVENT,h)}),this._channelMediaRelayClient=d,this._statsCollector.onStatsChanged=(h,f)=>{var g;h==="resolution"&&((g=this._channelMediaRelayClient)===null||g===void 0||g.setVideoProfile(f))}}var e;return this._channelMediaRelayClient}_handleUpdateDataChannel(e,r){const{added:i,deleted:d}=e,h=[];if(r){const f=[];this._users.forEach(g=>{g._dataChannels.forEach(b=>{i.every(C=>C.uid!==g._uintid||C.stream_id!==b.id)&&f.push({uid:g._uintid,stream_id:b.id,ordered:b.ordered,max_retrans_times:b.maxRetransmits,metadata:b.metadata})})}),f.length>0&&this._handleUpdateDataChannel({added:[],deleted:f})}Array.isArray(i)&&i.length>0&&i.forEach(f=>{const{uid:g,stream_id:b,ordered:C,max_retrans_times:P,metadata:x}=f,H=this._users.find($=>$._uintid===g);if(!H)return void Wt.error("[".concat(this._clientId,"] can not find target user!(on_add_data_channel)"));if(Wt.debug("[".concat(this._clientId,"] data_channel added with uid ").concat(g)),E_(h).call(h,H)||h.push(H),H._uintid||(H._uintid=g),H._dataChannels.findIndex($=>$.id===f.stream_id)===-1){const $={id:b,ordered:!!C,maxRetransmits:P,metadata:x},_t=function(_i){return qJ(_i,!0)}($);H._dataChannels.push(_t),Wt.info("[".concat(this._clientId,"] remote user ").concat(H.uid," published datachannel")),r||this.safeEmit(nE.USER_PUBLISHED,H,"datachannel",$)}this._p2pChannel.hasPendingRemoteDataChannel(H,f.stream_id)&&(Wt.debug("[".concat(this._clientId,"] resubscribe datachannel for user ").concat(H.uid," after reconnect.")),this._subscribeDataChannel(H,f.stream_id).catch($=>{Wt.error("[".concat(this._clientId,"] resubscribe datachannel error"),$.toString())}))}),r&&(this.safeEmit(nE.PUBLISHED_USER_LIST,this._pendingPublishedUsers),this._pendingPublishedUsers=[]),Array.isArray(d)&&d.length>0&&d.forEach(f=>{const{uid:g,stream_id:b}=f,C=this._users.find(x=>x._uintid===g);if(!C)return void Wt.error("[".concat(this._clientId,"] can not find target user!(on_delete_data_channel)"));const P=C._dataChannels.find(x=>x.id===f.stream_id);P&&(Wt.debug("[".concat(this._clientId,"] data_stream delete with uid ").concat(g)),this._p2pChannel.unsubscribeDataChannel(C,[P]).then(x=>{if(C._dataChannels=C._dataChannels.filter(H=>H!==P),x)return this._gateway.unsubscribeDataChannel(x,C.uid)}),Wt.info("[".concat(this._clientId,"] remote user ").concat(g," unpublished datachannel ,id:").concat(P.id)),this.safeEmit(nE.USER_UNPUBLISHED,C,"datachannel",P._config))})}_getEncodingName(e){var r;if(!this._joinResponse)return;const i=(r=this._joinResponse.ortc.rtpCapabilities.sendrecv)===null||r===void 0?void 0:r.videoCodecs;if(i)for(const h of i){var d;if(h.payloadType===e)return h==null||(d=h.rtpMap)===null||d===void 0?void 0:d.encodingName}}_handleRemoveDataChannels(e){const r=this._users.find(i=>i.uid===e.uid);if(r){if(r._dataChannels!==void 0&&r._dataChannels.length>0){Wt.debug("[".concat(this._clientId,"] datachannel removed with uid ").concat(e.uid));const i=()=>{Wt.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished datachannel")),r._dataChannels.forEach(d=>{this.safeEmit(nE.USER_UNPUBLISHED,r,"datachannel",d._config)})};this._p2pChannel.unsubscribeDataChannel(r,r._dataChannels).then(d=>{if(d)return this._gateway.unsubscribeDataChannel(d,r.uid)}),i()}}else Wt.warning("[".concat(this._clientId,"] can not find target user!(on_remove_datachannel)"))}_handleGatewayEvents(){this._gateway.on(uS.UPDATE_GATEWAY_CONFIG,()=>{(function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void Wt.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();Object.keys(r).forEach(d=>{const{value:h,type:f,expires:g}=r[d];g&&g<=i||f||UF()||!Object.prototype.hasOwnProperty.call(NL,d)||(gR[d]=h,VE[d]=h,Wt.debug("Update gateway parameters from config distribute",d,h))})}catch(r){Wt.error("Error update config from local cache",r.message)}})()}),this._gateway.on(uS.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(uS.CONNECTION_STATE_CHANGE,(e,r,i)=>{var d;if(i===_E.FALLBACK)return;const h=()=>{this.safeEmit(nE.CONNECTION_STATE_CHANGE,e,r,i)};if(k_.reportApiInvoke(this._sessionId||((d=this._gateway.joinInfo)===null||d===void 0?void 0:d.sid)||null,{name:QE.CONNECTION_STATE_CHANGE,options:[e,r,i],tag:FE.TRACER}).onSuccess(JSON.stringify({cur:e,prev:r,reason:i})),Wt.info("[".concat(this._clientId,"] signal connection state change: ").concat(r," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void h();if(e==="RECONNECTING")this._users.forEach(g=>{g._trust_in_room_=!1,g._trust_audio_enabled_state_=!1,g._trust_video_enabled_state_=!1,g._trust_audio_mute_state_=!1,g._trust_video_mute_state_=!1,g._trust_audio_stream_added_state_=!1,g._trust_video_stream_added_state_=!1,g._is_pre_created||(g._audio_pre_subscribed||(g._audioSSRC=void 0,g._audioOrtc=void 0),g._video_pre_subscribed||(g._videoSSRC=void 0,g._videoOrtc=void 0,g._rtxSsrcId=void 0),g._cname=void 0)}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var f;this._streamFallbackTypeCacheMap.forEach((g,b)=>{this._gateway.setStreamFallbackOption(b,g).catch(C=>{Wt.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),C)})}),this._remoteStreamTypeCacheMap.forEach((g,b)=>{this._gateway.setRemoteVideoStreamType(b,g).catch(C=>{Wt.warning("[".concat(this._clientId,"] auto set remote stream type failed"),C)})}),this._remoteDefaultVideoStreamType!==void 0&&((f=this._joinInfo)===null||f===void 0?void 0:f.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{Wt.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(g=>{Wt.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(g))}),this.store.useP2P||(this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(g=>!g._trust_in_room_).forEach(g=>{Wt.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(g.uid)),this._handleUserOffline({uid:g.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(g=>{g._trust_audio_mute_state_||(Wt.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(g.uid)),this._handleMuteStream(g.uid,A_.AUDIO,!1)),g._trust_video_mute_state_||(Wt.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(g.uid)),this._handleMuteStream(g.uid,A_.VIDEO,!1)),g._trust_audio_enabled_state_||(Wt.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(g.uid)),this._handleSetStreamLocalEnable("audio",g.uid,!0)),g._trust_video_enabled_state_||(Wt.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(g.uid)),this._handleSetStreamLocalEnable("video",g.uid,!0)),g._trust_video_stream_added_state_||(Wt.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(g.uid)),this._handleResetAddStream(g,"video")),g._trust_audio_stream_added_state_||(Wt.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(g.uid)),this._handleResetAddStream(g,"audio")),g._video_added_||g._audio_added_||(Wt.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(g.uid)),this._handleRemoveStream({uid:g.uid,uint_id:g._uintid}))}))},1e3))}h()}),this._gateway.on(uS.REQUEST_NEW_GATEWAY_LIST,async(e,r)=>{if(!this._joinInfo)return r(new t_(Gi.UNEXPECTED_ERROR,"can not recover, no join info"));try{let i;const d=await OX(iR(iR({},this._joinInfo),{},{uid:this._joinInfo.uid,stringUid:void 0}));d?(i=d.ap,DX(d),this._joinInfo.preload=!0):(i=await oG(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||Mb,this.store),this._joinInfo.preload=!1),this._joinInfo&&(this._joinInfo.apResponse=i.gatewayInfo.res,this._joinInfo.gatewayAddrs=i.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=i.gatewayInfo.uni_lbs_ip);const h=[];i.gatewayInfo.gatewayAddrs.forEach(f=>{let{address:g}=f;const[b,C]=g.split(":");this._joinInfo&&this._joinInfo.proxyServer?h.push({proxy:this._joinInfo.proxyServer,host:b,port:C}):h.push({host:b,port:C})}),e(h)}catch(i){r(i)}}),this._gateway.on(uS.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(nE.NETWORK_QUALITY,e)}),this._gateway.on(uS.STREAM_TYPE_CHANGE,(e,r)=>{this.safeEmit(nE.STREAM_TYPE_CHANGED,e,r),k_.reportApiInvoke(this._sessionId,{name:QE.STREAM_TYPE_CHANGE,options:[e,r],tag:FE.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:r}))}),this._gateway.isPreSub=()=>"isPreSub"in this._p2pChannel&&this._p2pChannel.isPreSub(),this._gateway.isPreallocation=()=>"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation(),this._gateway.on(uS.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(uS.REQUEST_P2P_CONNECTION_PARAMS,async(e,r,i)=>{try{let d=await this._p2pChannel.getEstablishParams();d&&"isPreallocation"in this._p2pChannel&&this._p2pChannel.isPreallocation()||(d=await this._p2pChannel.startP2PConnection(e)),r(d)}catch(d){i(d)}}),this._gateway.on(uS.JOIN_RESPONSE,(e,r)=>{if(this.store.useP2P)return;let i;this._joinResponse=e,e.attributes?i=e.attributes.userAttributes.preSubSsrcs:Wt.debug("no attributes in joinResponse");const d=PJ(e.ortc,r,i);this._p2pChannel.connect(d)}),this._gateway.on(uS.PRE_CONNECT_PC,async e=>{const{candidates:r,fingerprint:i,turnServer:d}=e;if(this._joinInfo&&r.length>0&&!this._p2pChannel.isPlanB){const{cert:f,cid:g}=this._joinInfo.apResponse,b="".concat(g,"_").concat(f);if(b.length<4||b.length>256)return;await this._p2pChannel.startP2PConnection({turnServer:d,cloudProxyServer:this._joinInfo.cloudProxyServer,isPreallocation:!0});try{var h;await this._p2pChannel.connect({iceParameters:{iceUfrag:"".concat(g,"_").concat(f),icePwd:"".concat(g,"_").concat(f)},dtlsParameters:{fingerprints:[{hashFunction:"sha-256",fingerprint:(h=_s("FINGERPRINT"))!==null&&h!==void 0?h:i}]},candidates:r,rtpCapabilities:{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},setup:"active",cname:"o/i14u9pJrxRKAsu",preallocation:!0})}catch(C){C.code&&C.code===Gi.EXCHANGE_SDP_FAILED&&await this._p2pChannel.startP2PConnection({turnServer:d,cloudProxyServer:this._joinInfo.cloudProxyServer},!0)}}})}_handleGatewaySignalEvents(){this._gateway.signal.on(rE.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(rE.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(rE.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc)),this._gateway.signal.on(rE.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.pt,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(rE.ON_REMOTE_DATASTREAM_UPDATE,e=>{this._handleUpdateDataChannel(e)}),this._gateway.signal.on(rE.ON_REMOTE_FULL_DATASTREAM_INFO,e=>{this._handleUpdateDataChannel({added:e.datastreams||[],deleted:[]},!0)}),this._gateway.signal.on(rE.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(rE.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(rE.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,A_.AUDIO,!0)),this._gateway.signal.on(rE.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,A_.AUDIO,!1)),this._gateway.signal.on(rE.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,A_.VIDEO,!0)),this._gateway.signal.on(rE.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,A_.VIDEO,!1)),this._gateway.signal.on(rE.RECEIVE_METADATA,e=>{const r=hI(e.metadata);this.safeEmit(nE.RECEIVE_METADATA,e.uid,r)}),this._gateway.signal.on(rE.ON_DATA_STREAM,async e=>{var r;if(!e)return;let i=hI(e.payload);if(this._encryptDataStream&&this._encryptDataStreamIv&&this._encryptDataStreamKey&&window.crypto.subtle&&E_(r=["aes-128-gcm2","aes-256-gcm2"]).call(r,this._encryptionMode)){if(e.payload.length<bO)throw new t_(Gi.UNEXPECTED_RESPONSE,"payload length ".concat(e.payload.length," is less than header length ").concat(bO));i=await async function(f,g,b){const C=b.subarray(0,bO),P=C.slice(8,bO),x=(P[0]<<8)+P[1],H=(C[6]<<8)+C[7],$=await window.crypto.subtle.decrypt({name:"AES-GCM",iv:f,tagLength:j4,additionalData:new Uint8Array(w4(x,2))},g,b.subarray(bO));return new Uint8Array($).subarray(0,H)}(this._encryptDataStreamIv,this._encryptDataStreamKey,i)}let d=0;if(e.ordered||e.syncWithAudio){const h=this._p2pChannel.getStats(),f=this.remoteUsers.find(b=>b.uid===e.uid),g=h==null?void 0:h.audioRecv.find(b=>b.ssrc===(f==null?void 0:f._audioSSRC));d=g==null?void 0:g.jitterBufferMs}(d==null||Number.isNaN(d))&&(d=0),Mht(iR(iR({},e),{},{payload:i}),d,{id:this._clientId,onStreamMessage:typeof this.onStreamMessage=="function"?this.onStreamMessage.bind(this):void 0,safeEmit:this.safeEmit.bind(this)})}),this._gateway.signal.on(rE.ON_CRYPT_ERROR,()=>{I0(()=>{Wt.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(nE.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(rE.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(rE.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{Wt.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0,_E.TOKEN_EXPIRE),this.safeEmit(nE.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(rE.ON_STREAM_FALLBACK_UPDATE,e=>{Wt.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(nE.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(rE.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),Wt.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(rE.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(rE.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(B_.REQUEST_TIMEOUT,(e,r)=>{if(this._joinInfo)switch(e){case j_.PUBLISH:{if(!r)return;const h=r.ortc;if(h){var i,d;const f=h.some(C=>{let{stream_type:P}=C;return P===gE.Audio}),g=h.some(C=>{let{stream_type:P}=C;return P!==gE.Audio}),b=h.some(C=>{let{stream_type:P}=C;return P===gE.Screen||P===gE.ScreenLow});r.state==="offer"&&k_.publish(this._joinInfo.sid,{eventElapse:NS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:Gi.TIMEOUT,audio:f,video:g,p2pid:r.p2p_id,publishRequestid:this.store.pubId,screenshare:b,audioName:f?(i=h.find(C=>{let{stream_type:P}=C;return P===gE.Audio}))===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId.toString():void 0,videoName:g?(d=h.find(C=>{let{stream_type:P}=C;return P!==gE.Audio}))===null||d===void 0||(d=d.ssrcs[0])===null||d===void 0?void 0:d.ssrcId.toString():void 0})}break}case j_.SUBSCRIBE:r&&k_.subscribe(this._joinInfo.sid,{succ:!1,ec:Gi.TIMEOUT,audio:r.stream_type===A_.AUDIO,video:r.stream_type===A_.VIDEO,peerid:r.stream_id,subscribeRequestid:r.ssrcId,p2pid:this.store.p2pId,eventElapse:NS.measureFromSubscribeStart(this.store.clientId,r.ssrcId),preSsrc:this._p2pChannel.isPreSubScribe(r.ssrcId)})}}),this._gateway.signal.on(rE.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(rE.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;_s("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(d=>!yI(d.string_id||d.stream_id,this.channelName)));const r=[],i=[];for(const d of e.users){let h=this._users.find(x=>x._uintid===d.stream_id);h?h._trust_in_room_=!0:(h=new U0(d.string_id||d.stream_id,d.stream_id),this._users.push(h),this.store.firstVideoFrameDecoded(h.uid,{userJoinNotify:Date.now()}),this.getListeners(nE.PUBLISHED_USER_LIST).length===0&&(Wt.debug("[".concat(this._clientId,"] user online"),d.stream_id),this.safeEmit(nE.USER_JOINED,h)));const f=cS.Audio&d.stream_type,g=(cS.Video|cS.LwoVideo)&d.stream_type,b=(65280&d.stream_type)!=0,C=f&&h.hasAudio,P=g&&h.hasVideo;g&&(h._trust_video_stream_added_state_=!0,h._video_added_=!0,h._videoSSRC=d.video_ssrc,h._rtxSsrcId=d.video_rtx),f&&(h._trust_audio_stream_added_state_=!0,h._audio_added_=!0,h._audioSSRC=d.audio_ssrc),f&&!C&&this.getListeners(nE.PUBLISHED_USER_LIST).length===0&&(Wt.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published audio")),this.safeEmit(nE.USER_PUBLISHED,h,"audio")),g&&!P&&this.getListeners(nE.PUBLISHED_USER_LIST).length===0&&(Wt.info("[".concat(this._clientId,"] remote user ").concat(h.uid," published video")),this.safeEmit(nE.USER_PUBLISHED,h,"video")),(f&&!C||g&&!P||b)&&r.push(h),g&&this._p2pChannel.hasPendingRemoteMedia(h,"video")&&i.push({user:h,mediaType:"video"}),f&&this._p2pChannel.hasPendingRemoteMedia(h,"audio")&&i.push({user:h,mediaType:"audio"})}i.length>0&&(Wt.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(i.map(d=>"user: ".concat(d.user.uid,", mediaType: ").concat(d.mediaType)).join("; ")," ")),this.massSubscribe(i).catch(d=>{Wt.error("[".concat(this._clientId,"] mass resubscribe error"),d.toString())})),this.getListeners(nE.PUBLISHED_USER_LIST).length>0?_s("ENABLE_DATASTREAM_2")?this._pendingPublishedUsers=r:(Wt.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(r.map(d=>d.uid).join(", "))),this.safeEmit(nE.PUBLISHED_USER_LIST,r)):Wt.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(r.map(d=>d.uid).join(", ")))}),this._gateway.signal.on(rE.ON_RTP_CAPABILITY_CHANGE,e=>{const{video_codec:r}=e;this._p2pChannel instanceof aP&&this._p2pChannel.updateRemoteRTPCapabilities(r.map(i=>i.toLowerCase()).filter(i=>{var d;return E_(d=Object.keys(WN)).call(d,i)}))})}_handleP2PEvents(){this._gateway.signal.on(rE.ON_USER_OFFLINE,()=>{this._p2pChannel.disconnectForReconnect()}),this._gateway.signal.on($E.PUBLISH,(e,r,i)=>{const{uid:d}=e;e.forEach(h=>{const{kind:f,ssrcs:g,mid:b,isMuted:C}=h;this._handleP2PAddAudioOrVideoStream(f,d,g[0].ssrcId,b);const P=this._users.find(x=>x.uid===d);return P&&this.store.useP2P?this._p2pChannel.mockSubscribe(P,f,g[0].ssrcId,b).then(()=>{r()}).catch(i):r(),this._handleMuteStream(d,f,!!C)})}),this._gateway.signal.on($E.CALL,async(e,r,i)=>{if(this.store.useP2P)try{var d;r(await this._p2pChannel.startP2P({turnServer:(d=this._joinInfo)===null||d===void 0?void 0:d.turnServer},e))}catch(h){i(h)}}),this._gateway.signal.on(B_.P2P_CONNECTION,async e=>{this.store.useP2P&&(await this._p2pChannel).p2pConnect(e)}),this._gateway.signal.on($E.UNPUBLISH,async(e,r,i)=>{if(this.store.useP2P){const{unpubMsg:d,uid:h}=e,f=this._users.find(g=>g.uid===h);if(!f)return Wt.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(h)),void r();try{d.forEach(async g=>{let{stream_type:b}=g;const C=b===gE.Audio?A_.AUDIO:A_.VIDEO;await this._p2pChannel.unsubscribe(f,C),this._handleMuteStream(h,C,!0)}),r()}catch(g){i(g)}}}),this._gateway.signal.on($E.CONTROL,async(e,r)=>{const{action:i}=e;switch(i){case N0.MUTE_LOCAL_VIDEO:this._handleMuteStream(r,A_.VIDEO,!0);break;case N0.MUTE_LOCAL_AUDIO:this._handleMuteStream(r,A_.AUDIO,!0);break;case N0.UNMUTE_LOCAL_VIDEO:this._handleP2PAddAudioOrVideoStream("video",r),this._handleMuteStream(r,A_.VIDEO,!1);break;case N0.UNMUTE_LOCAL_AUDIO:this._handleP2PAddAudioOrVideoStream("audio",r),this._handleMuteStream(r,A_.AUDIO,!1)}}),this._gateway.signal.on($E.RESTART_ICE,async(e,r,i)=>{if(this.store.useP2P)try{const{direction:d,iceParameter:h}=e;d!==qS.SEND_ONLY||h?r(await this._p2pChannel.restartICE(d,h)):(this._p2pChannel.handleDisconnect(d),r())}catch(d){i(d)}}),this._gateway.signal.on($E.CANDIDATE,e=>{if(this.store.useP2P){const{candidate:r,direction:i}=e;this._p2pChannel.addRemoteCandidate(r,i)}}),this._p2pChannel.on(L_.RequestP2PRestartICE,async(e,r,i)=>{try{const{direction:d}=e;r(await this._gateway.sendExtensionMessage($E.RESTART_ICE,e,d===qS.SEND_ONLY))}catch(d){i(d)}}),this._p2pChannel.on(L_.LocalCandidate,e=>{this._gateway.sendExtensionMessage($E.CANDIDATE,JSON.stringify(e),!0)}),this._p2pChannel.on(L_.RequestP2PMuteLocal,async(e,r,i)=>{try{await this._gateway.sendExtensionMessage($E.CONTROL,e,!0),r()}catch(d){i(d)}}),this._p2pChannel.on(L_.RequestP2PUnmuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(d){d.code===Gi.DISCONNECT_P2P?r():i(d)}else r()}),this._p2pChannel.on(L_.RequestP2PMuteRemote,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteRemote(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(d){d.code===Gi.DISCONNECT_P2P?r():i(d)}else r()}),this._p2pChannel.on(L_.StateChange,(e,r)=>{r===EE.Connected&&this._p2pChannel.republish()})}_handleP2PChannelEvents(){this._p2pChannel.on(L_.PeerConnectionStateChange,e=>{const r=this._peerConnectionState;e!==r&&(this.safeEmit(nE.PEERCONNECTION_STATE_CHANGE,e,r),this._peerConnectionState=e)}),this._p2pChannel.on(L_.RequestMuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(d){d.code===Gi.DISCONNECT_P2P?r():i(d)}else r()}),this._p2pChannel.on(L_.RequestUnmuteLocal,async(e,r,i)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),r()}catch(d){d.code===Gi.DISCONNECT_P2P?r():i(d)}else r()}),this._p2pChannel.on(L_.RequestRePublish,(e,r,i)=>{this.publish(e,!1).then(r).catch(i)}),this._p2pChannel.on(L_.RequestRePublishDataChannel,(e,r,i)=>{T_.all(e.map(async d=>{const h=await this._p2pChannel.publishDataChannel([d]);try{h.forEach(f=>{this._uid&&this._gateway.publishDataChannel(this._uid,f,!0)})}catch(f){if(f.code!==Gi.DISCONNECT_P2P)throw f}})).then(r).catch(i)}),this._p2pChannel.on(L_.RequestReSubscribe,async(e,r,i)=>{try{for(const{user:d,kind:h}of e)h===A_.VIDEO?await this.subscribe(d,"video"):await this.subscribe(d,"audio");r()}catch(d){i(d)}}),this._p2pChannel.on(L_.RequestUpload,(e,r)=>{this._gateway.upload(e,r)}),this._p2pChannel.on(L_.RequestUploadStats,e=>{this._gateway.uploadWRTCStats(e)}),this._p2pChannel.on(L_.MediaReconnectStart,e=>{this.safeEmit(nE.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(L_.MediaReconnectEnd,e=>{this.safeEmit(nE.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(L_.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(L_.RequestRestartICE,async e=>{if(this.store.useP2P)return;const r=await this._p2pChannel.restartICE(e),i=await r.next();if(i.done)return;const d=i.value;let h;try{h=await this._gateway.restartICE({iceParameters:d})}catch(g){return void r.throw(g)}const{iceParameters:f}=function(g){const b=g.iceParameters;return{iceParameters:{iceUfrag:b.iceUfrag,icePwd:b.icePwd}}}(h);await r.next({remoteIceParameters:f})}),this._p2pChannel.on(L_.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(L_.RequestReconnectPC,async()=>{var e;const{iceParameters:r,dtlsParameters:i,rtpCapabilities:d}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:h,gatewayAddress:f}=await this._gateway.reconnectPC({iceParameters:r,dtlsParameters:i,rtpCapabilities:d}),g=PJ(h,f);await this._p2pChannel.connect(g),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(L_.RequestUnpublishForReconnectPC,async(e,r,i)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),r()):i()}),this._p2pChannel.on(L_.P2PLost,()=>{this.safeEmit(nE.P2P_LOST,this.store.uid)}),this._p2pChannel.on(L_.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(L_.ConnectionTypeChange,e=>{this.safeEmit(nE.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(L_.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(L_.QueryClientConnectionState,e=>{e(this.connectionState)}),this._p2pChannel.on(L_.AudioMetadata,e=>{this.safeEmit(nE.AUDIO_METADATA,e)}),this._p2pChannel.on(L_.AudioPts,e=>{this.safeEmit(nE.AUDIO_PTS,Number(e))})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(!this._joinInfo||this.connectionState!=="CONNECTED")throw new t_(Gi.INVALID_OPERATION,"[".concat(this._clientId,"] can not create content inspect, please join channel first"));if(this._inspect)throw new t_(Gi.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));try{const i=(r={config:e},a0("ContentInspect").create(r));this._inspect=i,this.handleVideoInspectEvents(i);const{appId:d,cname:h,sid:f,token:g,uid:b,cid:C,vid:P}=this._joinInfo;await i.init({appId:d,areaCode:"",cname:h,sid:f,token:g,uid:b,cid:C,vid:P?Number(P):0},Mb)}catch(i){throw Array.isArray(i)?i[0]:i}var r}handleVideoInspectEvents(e){e.on(dS.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(nE.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,r,i),i===tR.CONNECTED){if(this.connectionState!=="CONNECTED")return void this.safeEmit(nE.CONTENT_INSPECT_ERROR,new t_(Gi.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(dS.INSPECT_RESULT,(r,i)=>{var d;if((i==null?void 0:i.code)===Gi.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return Wt.debug("Stop inspect content because that has left channel"),this==null||(d=this._inspect)===null||d===void 0||d.close(),void(this._inspect=void 0);this.safeEmit(nE.CONTENT_INSPECT_RESULT,r,i)}),e.on(dS.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}async disableContentInspect(){if(!this._inspect)throw new t_(Gi.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,r){if(_R(e,"enabled"),e){if(!r)throw new t_(Gi.INVALID_PARAMS,"config is required");if(HX(r),!this._joinInfo)throw new t_(Gi.INVALID_OPERATION,"can not create image moderation, please join channel first");try{if(this._moderation)this._moderation.updateConfig(r);else{const d=(i={config:r},a0("ImageModeration").create(i));this._moderation=d,this.handleImageModerationEvents(d);const{appId:h,cname:f,sid:g,token:b,uid:C,cid:P,vid:x}=this._joinInfo;await d.init({appId:h,areaCode:"",cname:f,sid:g,token:b,uid:C,cid:P,vid:x?Number(x):0},Mb)}}catch(d){throw Array.isArray(d)?d[0]:d}}else{var i;if(!this._moderation)throw new t_(Gi.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(d){throw Array.isArray(d)?d[0]:d}}}handleImageModerationEvents(e){e.on(yR.CONNECTION_STATE_CHANGE,(r,i)=>{if(this.safeEmit(nE.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,r,i),r===DT.CONNECTED){if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new t_(Gi.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(yR.CLIENT_LOCAL_VIDEO_TRACK,r=>{r(this.localTracks.filter(i=>i.trackMediaType==="video")[0])})}setP2PTransport(e){if(function(r){oS(r,"transport",["default","auto","relay","sd-rtn"])}(e),this.mode!=="p2p")throw new t_(Gi.INVALID_OPERATION,"only p2p mode can set p2pTransport");this.store.p2pTransport=e,Wt.info("[".concat(this._clientId,"] set client p2pTransport to ").concat(e))}getJoinChannelServiceRecords(){return Wt.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){_R(e,"enabled"),SE("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,r){switch(r){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}},D_(C_.prototype,"leave",[zX],Object.getOwnPropertyDescriptor(C_.prototype,"leave"),C_.prototype),D_(C_.prototype,"publish",[YX],Object.getOwnPropertyDescriptor(C_.prototype,"publish"),C_.prototype),D_(C_.prototype,"unpublish",[JX],Object.getOwnPropertyDescriptor(C_.prototype,"unpublish"),C_.prototype),D_(C_.prototype,"subscribe",[XX],Object.getOwnPropertyDescriptor(C_.prototype,"subscribe"),C_.prototype),D_(C_.prototype,"presubscribe",[QX],Object.getOwnPropertyDescriptor(C_.prototype,"presubscribe"),C_.prototype),D_(C_.prototype,"massSubscribe",[ZX],Object.getOwnPropertyDescriptor(C_.prototype,"massSubscribe"),C_.prototype),D_(C_.prototype,"unsubscribe",[$X],Object.getOwnPropertyDescriptor(C_.prototype,"unsubscribe"),C_.prototype),D_(C_.prototype,"massUnsubscribe",[t3],Object.getOwnPropertyDescriptor(C_.prototype,"massUnsubscribe"),C_.prototype),D_(C_.prototype,"setLowStreamParameter",[e3],Object.getOwnPropertyDescriptor(C_.prototype,"setLowStreamParameter"),C_.prototype),D_(C_.prototype,"enableDualStream",[n3],Object.getOwnPropertyDescriptor(C_.prototype,"enableDualStream"),C_.prototype),D_(C_.prototype,"disableDualStream",[r3],Object.getOwnPropertyDescriptor(C_.prototype,"disableDualStream"),C_.prototype),D_(C_.prototype,"setClientRole",[i3],Object.getOwnPropertyDescriptor(C_.prototype,"setClientRole"),C_.prototype),D_(C_.prototype,"_setClientRoleOptions",[o3],Object.getOwnPropertyDescriptor(C_.prototype,"_setClientRoleOptions"),C_.prototype),D_(C_.prototype,"setProxyServer",[s3],Object.getOwnPropertyDescriptor(C_.prototype,"setProxyServer"),C_.prototype),D_(C_.prototype,"setTurnServer",[a3],Object.getOwnPropertyDescriptor(C_.prototype,"setTurnServer"),C_.prototype),D_(C_.prototype,"setLicense",[c3],Object.getOwnPropertyDescriptor(C_.prototype,"setLicense"),C_.prototype),D_(C_.prototype,"startProxyServer",[u3],Object.getOwnPropertyDescriptor(C_.prototype,"startProxyServer"),C_.prototype),D_(C_.prototype,"stopProxyServer",[d3],Object.getOwnPropertyDescriptor(C_.prototype,"stopProxyServer"),C_.prototype),D_(C_.prototype,"setLocalAccessPointsV2",[l3],Object.getOwnPropertyDescriptor(C_.prototype,"setLocalAccessPointsV2"),C_.prototype),D_(C_.prototype,"setLocalAccessPoints",[h3],Object.getOwnPropertyDescriptor(C_.prototype,"setLocalAccessPoints"),C_.prototype),D_(C_.prototype,"setRemoteDefaultVideoStreamType",[p3],Object.getOwnPropertyDescriptor(C_.prototype,"setRemoteDefaultVideoStreamType"),C_.prototype),D_(C_.prototype,"setRemoteVideoStreamType",[f3],Object.getOwnPropertyDescriptor(C_.prototype,"setRemoteVideoStreamType"),C_.prototype),D_(C_.prototype,"setStreamFallbackOption",[m3],Object.getOwnPropertyDescriptor(C_.prototype,"setStreamFallbackOption"),C_.prototype),D_(C_.prototype,"setEncryptionConfig",[_3],Object.getOwnPropertyDescriptor(C_.prototype,"setEncryptionConfig"),C_.prototype),D_(C_.prototype,"renewToken",[E3],Object.getOwnPropertyDescriptor(C_.prototype,"renewToken"),C_.prototype),D_(C_.prototype,"enableAudioVolumeIndicator",[g3],Object.getOwnPropertyDescriptor(C_.prototype,"enableAudioVolumeIndicator"),C_.prototype),D_(C_.prototype,"startLiveStreaming",[v3],Object.getOwnPropertyDescriptor(C_.prototype,"startLiveStreaming"),C_.prototype),D_(C_.prototype,"setLiveTranscoding",[b3],Object.getOwnPropertyDescriptor(C_.prototype,"setLiveTranscoding"),C_.prototype),D_(C_.prototype,"stopLiveStreaming",[y3],Object.getOwnPropertyDescriptor(C_.prototype,"stopLiveStreaming"),C_.prototype),D_(C_.prototype,"startChannelMediaRelay",[S3],Object.getOwnPropertyDescriptor(C_.prototype,"startChannelMediaRelay"),C_.prototype),D_(C_.prototype,"updateChannelMediaRelay",[T3],Object.getOwnPropertyDescriptor(C_.prototype,"updateChannelMediaRelay"),C_.prototype),D_(C_.prototype,"stopChannelMediaRelay",[R3],Object.getOwnPropertyDescriptor(C_.prototype,"stopChannelMediaRelay"),C_.prototype),D_(C_.prototype,"sendCustomReportMessage",[I3],Object.getOwnPropertyDescriptor(C_.prototype,"sendCustomReportMessage"),C_.prototype),D_(C_.prototype,"pickSVCLayer",[w3],Object.getOwnPropertyDescriptor(C_.prototype,"pickSVCLayer"),C_.prototype),D_(C_.prototype,"setRTMConfig",[C3],Object.getOwnPropertyDescriptor(C_.prototype,"setRTMConfig"),C_.prototype),D_(C_.prototype,"enableContentInspect",[A3],Object.getOwnPropertyDescriptor(C_.prototype,"enableContentInspect"),C_.prototype),D_(C_.prototype,"disableContentInspect",[O3],Object.getOwnPropertyDescriptor(C_.prototype,"disableContentInspect"),C_.prototype),D_(C_.prototype,"setImageModeration",[N3],Object.getOwnPropertyDescriptor(C_.prototype,"setImageModeration"),C_.prototype),D_(C_.prototype,"setP2PTransport",[P3],Object.getOwnPropertyDescriptor(C_.prototype,"setP2PTransport"),C_.prototype),D_(C_.prototype,"getJoinChannelServiceRecords",[D3],Object.getOwnPropertyDescriptor(C_.prototype,"getJoinChannelServiceRecords"),C_.prototype),D_(C_.prototype,"setPublishAudioFilterEnabled",[k3],Object.getOwnPropertyDescriptor(C_.prototype,"setPublishAudioFilterEnabled"),C_.prototype),C_);class dP{constructor(r,i){Ei(this,"id",0),Ei(this,"element",void 0),Ei(this,"peerPair",void 0),Ei(this,"context",void 0),Ei(this,"audioPlayerElement",void 0),Ei(this,"audioTrack",void 0),dP.count+=1,this.id=dP.count,this.element=r,this.context=i}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=r=>{const i=document.createElement("audio");i.srcObject=new MediaStream([r.track]),i.play(),this.audioPlayerElement=i}}async switchSdp(){if(!this.peerPair)return;const r=async(d,h)=>{const f=h==="offer"?await d.createOffer():await d.createAnswer();return await d.setLocalDescription(f),d.iceGatheringState==="complete"?d.localDescription:new T_(g=>{d.onicegatheringstatechange=()=>{d.iceGatheringState==="complete"&&g(d.localDescription)}})},i=async(d,h)=>await d.setRemoteDescription(h);try{const d=await r(this.peerPair[0],"offer");await i(this.peerPair[1],d);const h=await r(this.peerPair[1],"answer");await i(this.peerPair[0],h)}catch(d){throw new t_(Gi.LOCAL_AEC_ERROR,d.toString()).print()}}async getTracksFromMediaElement(r){if(this.audioTrack)return this.audioTrack;let i;try{r instanceof HTMLVideoElement&&(r.captureStream?r.captureStream():r.mozCaptureStream()),i=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(r).connect(i)}catch(h){throw new t_(Gi.LOCAL_AEC_ERROR,h.toString()).print()}if(!i)throw new t_(Gi.LOCAL_AEC_ERROR,"no dest node when local aec").print();const d=i.stream.getAudioTracks()[0];return this.audioTrack=d,d}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const r=this.element,i=await this.getTracksFromMediaElement(r);this.peerPair&&this.peerPair[0].addTrack(i),await this.switchSdp()}close(){Wt.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(r=>{r.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var M3,I1;Ei(dP,"count",0);const Qht=window.AudioContext||window.webkitAudioContext,Zht=new(M3=V_({report:k_}),D_((I1=class{constructor(){Ei(this,"units",[]),Ei(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return Wt.debug("the system does not need to process local aec"),-1;this.context||(this.context=new Qht);let r=this.units.find(i=>i&&i.getElement()===e);return r||(r=new dP(e,this.context),this.units.push(r)),r.startEchoCancellation(),Wt.debug("start processing local audio echo cancellation, id is",r.id),r.id}_doesEnvironmentNeedAEC(){return oE().name!==hE.SAFARI}}).prototype,"processExternalMediaAEC",[M3],Object.getOwnPropertyDescriptor(I1.prototype,"processExternalMediaAEC"),I1.prototype),I1);function x3(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function U3(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?x3(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):x3(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}const RG=window||document;function V3(e){let r=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!RG)return;const i=_y._cspEventHandlerPointer;if(i&&r)return void console.error(i,r);const d=h=>{if(!(h&&h.blockedURI&&(_y.onSecurityPolicyViolation||_y.getListeners(FR.SECURITY_POLICY_VIOLATION).length>0)))return;const f=h.blockedURI;_s("CSP_DETECTED_HOSTNAME_LIST").some(g=>E_(f).call(f,g))&&(_y.onSecurityPolicyViolation&&typeof _y.onSecurityPolicyViolation=="function"&&_y.onSecurityPolicyViolation(h),_y.getListeners(FR.SECURITY_POLICY_VIOLATION).length>0&&_y.safeEmit(FR.SECURITY_POLICY_VIOLATION,h))};i&&RG.removeEventListener("securitypolicyviolation",i),(r||e&&typeof e=="function"||_y.getListeners(FR.SECURITY_POLICY_VIOLATION).length>0)&&RG.addEventListener("securitypolicyviolation",d),_y._cspEventHandlerPointer=d}var $ht=_n,tpt=vY,j3=RegExp.prototype,ept=function(e){return e===j3||$ht(j3,e)?tpt(e):e.flags},jS=_(ept);function HO(e){let r=e.length;for(;--r>=0;)e[r]=0}const IG=256,F3=286,lP=30,hP=15,wG=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),w1=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),npt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),B3=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),u0=new Array(576);HO(u0);const pP=new Array(60);HO(pP);const fP=new Array(512);HO(fP);const mP=new Array(256);HO(mP);const CG=new Array(29);HO(CG);const C1=new Array(lP);function AG(e,r,i,d,h){this.static_tree=e,this.extra_bits=r,this.extra_base=i,this.elems=d,this.max_length=h,this.has_stree=e&&e.length}let G3,q3,W3;function OG(e,r){this.dyn_tree=e,this.max_code=0,this.stat_desc=r}HO(C1);const K3=e=>e<256?fP[e]:fP[256+(e>>>7)],_P=(e,r)=>{e.pending_buf[e.pending++]=255&r,e.pending_buf[e.pending++]=r>>>8&255},IT=(e,r,i)=>{e.bi_valid>16-i?(e.bi_buf|=r<<e.bi_valid&65535,_P(e,e.bi_buf),e.bi_buf=r>>16-e.bi_valid,e.bi_valid+=i-16):(e.bi_buf|=r<<e.bi_valid&65535,e.bi_valid+=i)},qR=(e,r,i)=>{IT(e,i[2*r],i[2*r+1])},H3=(e,r)=>{let i=0;do i|=1&e,e>>>=1,i<<=1;while(--r>0);return i>>>1},z3=(e,r,i)=>{const d=new Array(16);let h,f,g=0;for(h=1;h<=hP;h++)g=g+i[h-1]<<1,d[h]=g;for(f=0;f<=r;f++){let b=e[2*f+1];b!==0&&(e[2*f]=H3(d[b]++,b))}},Y3=e=>{let r;for(r=0;r<F3;r++)e.dyn_ltree[2*r]=0;for(r=0;r<lP;r++)e.dyn_dtree[2*r]=0;for(r=0;r<19;r++)e.bl_tree[2*r]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},J3=e=>{e.bi_valid>8?_P(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},X3=(e,r,i,d)=>{const h=2*r,f=2*i;return e[h]<e[f]||e[h]===e[f]&&d[r]<=d[i]},NG=(e,r,i)=>{const d=e.heap[i];let h=i<<1;for(;h<=e.heap_len&&(h<e.heap_len&&X3(r,e.heap[h+1],e.heap[h],e.depth)&&h++,!X3(r,d,e.heap[h],e.depth));)e.heap[i]=e.heap[h],i=h,h<<=1;e.heap[i]=d},Q3=(e,r,i)=>{let d,h,f,g,b=0;if(e.sym_next!==0)do d=255&e.pending_buf[e.sym_buf+b++],d+=(255&e.pending_buf[e.sym_buf+b++])<<8,h=e.pending_buf[e.sym_buf+b++],d===0?qR(e,h,r):(f=mP[h],qR(e,f+IG+1,r),g=wG[f],g!==0&&(h-=CG[f],IT(e,h,g)),d--,f=K3(d),qR(e,f,i),g=w1[f],g!==0&&(d-=C1[f],IT(e,d,g)));while(b<e.sym_next);qR(e,256,r)},PG=(e,r)=>{const i=r.dyn_tree,d=r.stat_desc.static_tree,h=r.stat_desc.has_stree,f=r.stat_desc.elems;let g,b,C,P=-1;for(e.heap_len=0,e.heap_max=573,g=0;g<f;g++)i[2*g]!==0?(e.heap[++e.heap_len]=P=g,e.depth[g]=0):i[2*g+1]=0;for(;e.heap_len<2;)C=e.heap[++e.heap_len]=P<2?++P:0,i[2*C]=1,e.depth[C]=0,e.opt_len--,h&&(e.static_len-=d[2*C+1]);for(r.max_code=P,g=e.heap_len>>1;g>=1;g--)NG(e,i,g);C=f;do g=e.heap[1],e.heap[1]=e.heap[e.heap_len--],NG(e,i,1),b=e.heap[1],e.heap[--e.heap_max]=g,e.heap[--e.heap_max]=b,i[2*C]=i[2*g]+i[2*b],e.depth[C]=(e.depth[g]>=e.depth[b]?e.depth[g]:e.depth[b])+1,i[2*g+1]=i[2*b+1]=C,e.heap[1]=C++,NG(e,i,1);while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((x,H)=>{const $=H.dyn_tree,_t=H.max_code,_i=H.stat_desc.static_tree,ue=H.stat_desc.has_stree,_r=H.stat_desc.extra_bits,Fi=H.stat_desc.extra_base,Di=H.stat_desc.max_length;let Js,_l,_u,ga,_m,r_,a_=0;for(ga=0;ga<=hP;ga++)x.bl_count[ga]=0;for($[2*x.heap[x.heap_max]+1]=0,Js=x.heap_max+1;Js<573;Js++)_l=x.heap[Js],ga=$[2*$[2*_l+1]+1]+1,ga>Di&&(ga=Di,a_++),$[2*_l+1]=ga,_l>_t||(x.bl_count[ga]++,_m=0,_l>=Fi&&(_m=_r[_l-Fi]),r_=$[2*_l],x.opt_len+=r_*(ga+_m),ue&&(x.static_len+=r_*(_i[2*_l+1]+_m)));if(a_!==0){do{for(ga=Di-1;x.bl_count[ga]===0;)ga--;x.bl_count[ga]--,x.bl_count[ga+1]+=2,x.bl_count[Di]--,a_-=2}while(a_>0);for(ga=Di;ga!==0;ga--)for(_l=x.bl_count[ga];_l!==0;)_u=x.heap[--Js],_u>_t||($[2*_u+1]!==ga&&(x.opt_len+=(ga-$[2*_u+1])*$[2*_u],$[2*_u+1]=ga),_l--)}})(e,r),z3(i,P,e.bl_count)},Z3=(e,r,i)=>{let d,h,f=-1,g=r[1],b=0,C=7,P=4;for(g===0&&(C=138,P=3),r[2*(i+1)+1]=65535,d=0;d<=i;d++)h=g,g=r[2*(d+1)+1],++b<C&&h===g||(b<P?e.bl_tree[2*h]+=b:h!==0?(h!==f&&e.bl_tree[2*h]++,e.bl_tree[32]++):b<=10?e.bl_tree[34]++:e.bl_tree[36]++,b=0,f=h,g===0?(C=138,P=3):h===g?(C=6,P=3):(C=7,P=4))},$3=(e,r,i)=>{let d,h,f=-1,g=r[1],b=0,C=7,P=4;for(g===0&&(C=138,P=3),d=0;d<=i;d++)if(h=g,g=r[2*(d+1)+1],!(++b<C&&h===g)){if(b<P)do qR(e,h,e.bl_tree);while(--b!=0);else h!==0?(h!==f&&(qR(e,h,e.bl_tree),b--),qR(e,16,e.bl_tree),IT(e,b-3,2)):b<=10?(qR(e,17,e.bl_tree),IT(e,b-3,3)):(qR(e,18,e.bl_tree),IT(e,b-11,7));b=0,f=h,g===0?(C=138,P=3):h===g?(C=6,P=3):(C=7,P=4)}};let tQ=!1;const eQ=(e,r,i,d)=>{IT(e,0+(d?1:0),3),J3(e),_P(e,i),_P(e,~i),i&&e.pending_buf.set(e.window.subarray(r,r+i),e.pending),e.pending+=i};var rpt=e=>{tQ||((()=>{let r,i,d,h,f;const g=new Array(16);for(d=0,h=0;h<28;h++)for(CG[h]=d,r=0;r<1<<wG[h];r++)mP[d++]=h;for(mP[d-1]=h,f=0,h=0;h<16;h++)for(C1[h]=f,r=0;r<1<<w1[h];r++)fP[f++]=h;for(f>>=7;h<lP;h++)for(C1[h]=f<<7,r=0;r<1<<w1[h]-7;r++)fP[256+f++]=h;for(i=0;i<=hP;i++)g[i]=0;for(r=0;r<=143;)u0[2*r+1]=8,r++,g[8]++;for(;r<=255;)u0[2*r+1]=9,r++,g[9]++;for(;r<=279;)u0[2*r+1]=7,r++,g[7]++;for(;r<=287;)u0[2*r+1]=8,r++,g[8]++;for(z3(u0,287,g),r=0;r<lP;r++)pP[2*r+1]=5,pP[2*r]=H3(r,5);G3=new AG(u0,wG,257,F3,hP),q3=new AG(pP,w1,0,lP,hP),W3=new AG(new Array(0),npt,0,19,7)})(),tQ=!0),e.l_desc=new OG(e.dyn_ltree,G3),e.d_desc=new OG(e.dyn_dtree,q3),e.bl_desc=new OG(e.bl_tree,W3),e.bi_buf=0,e.bi_valid=0,Y3(e)},ipt=(e,r,i,d)=>{let h,f,g=0;e.level>0?(e.strm.data_type===2&&(e.strm.data_type=(b=>{let C,P=4093624447;for(C=0;C<=31;C++,P>>>=1)if(1&P&&b.dyn_ltree[2*C]!==0)return 0;if(b.dyn_ltree[18]!==0||b.dyn_ltree[20]!==0||b.dyn_ltree[26]!==0)return 1;for(C=32;C<IG;C++)if(b.dyn_ltree[2*C]!==0)return 1;return 0})(e)),PG(e,e.l_desc),PG(e,e.d_desc),g=(b=>{let C;for(Z3(b,b.dyn_ltree,b.l_desc.max_code),Z3(b,b.dyn_dtree,b.d_desc.max_code),PG(b,b.bl_desc),C=18;C>=3&&b.bl_tree[2*B3[C]+1]===0;C--);return b.opt_len+=3*(C+1)+5+5+4,C})(e),h=e.opt_len+3+7>>>3,f=e.static_len+3+7>>>3,f<=h&&(h=f)):h=f=i+5,i+4<=h&&r!==-1?eQ(e,r,i,d):e.strategy===4||f===h?(IT(e,2+(d?1:0),3),Q3(e,u0,pP)):(IT(e,4+(d?1:0),3),((b,C,P,x)=>{let H;for(IT(b,C-257,5),IT(b,P-1,5),IT(b,x-4,4),H=0;H<x;H++)IT(b,b.bl_tree[2*B3[H]+1],3);$3(b,b.dyn_ltree,C-1),$3(b,b.dyn_dtree,P-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,g+1),Q3(e,e.dyn_ltree,e.dyn_dtree)),Y3(e),d&&J3(e)},opt=(e,r,i)=>(e.pending_buf[e.sym_buf+e.sym_next++]=r,e.pending_buf[e.sym_buf+e.sym_next++]=r>>8,e.pending_buf[e.sym_buf+e.sym_next++]=i,r===0?e.dyn_ltree[2*i]++:(e.matches++,r--,e.dyn_ltree[2*(mP[i]+IG+1)]++,e.dyn_dtree[2*K3(r)]++),e.sym_next===e.sym_end),spt=e=>{IT(e,2,3),qR(e,256,u0),(r=>{r.bi_valid===16?(_P(r,r.bi_buf),r.bi_buf=0,r.bi_valid=0):r.bi_valid>=8&&(r.pending_buf[r.pending++]=255&r.bi_buf,r.bi_buf>>=8,r.bi_valid-=8)})(e)},apt={_tr_init:rpt,_tr_stored_block:eQ,_tr_flush_block:ipt,_tr_tally:opt,_tr_align:spt},EP=(e,r,i,d)=>{let h=65535&e|0,f=e>>>16&65535|0,g=0;for(;i!==0;){g=i>2e3?2e3:i,i-=g;do h=h+r[d++]|0,f=f+h|0;while(--g);h%=65521,f%=65521}return h|f<<16|0};const cpt=new Uint32Array((()=>{let e,r=[];for(var i=0;i<256;i++){e=i;for(var d=0;d<8;d++)e=1&e?3988292384^e>>>1:e>>>1;r[i]=e}return r})());var KS=(e,r,i,d)=>{const h=cpt,f=d+i;e^=-1;for(let g=d;g<f;g++)e=e>>>8^h[255&(e^r[g])];return-1^e},CI={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},A1={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:upt,_tr_stored_block:DG,_tr_flush_block:dpt,_tr_tally:B0,_tr_align:lpt}=apt,{Z_NO_FLUSH:G0,Z_PARTIAL_FLUSH:hpt,Z_FULL_FLUSH:ppt,Z_FINISH:oR,Z_BLOCK:nQ,Z_OK:QS,Z_STREAM_END:rQ,Z_STREAM_ERROR:WR,Z_DATA_ERROR:fpt,Z_BUF_ERROR:kG,Z_DEFAULT_COMPRESSION:mpt,Z_FILTERED:_pt,Z_HUFFMAN_ONLY:O1,Z_RLE:Ept,Z_FIXED:gpt,Z_DEFAULT_STRATEGY:vpt,Z_UNKNOWN:bpt,Z_DEFLATED:N1}=A1,LG=286,ypt=30,Spt=19,Tpt=2*LG+1,Rpt=15,AI=258,KR=262,zO=42,OI=113,gP=666,NI=(e,r)=>(e.msg=CI[r],r),iQ=e=>2*e-(e>4?9:0),q0=e=>{let r=e.length;for(;--r>=0;)e[r]=0},Ipt=e=>{let r,i,d,h=e.w_size;r=e.hash_size,d=r;do i=e.head[--d],e.head[d]=i>=h?i-h:0;while(--r);r=h,d=r;do i=e.prev[--d],e.prev[d]=i>=h?i-h:0;while(--r)};let W0=(e,r,i)=>(r<<e.hash_shift^i)&e.hash_mask;const LT=e=>{const r=e.state;let i=r.pending;i>e.avail_out&&(i=e.avail_out),i!==0&&(e.output.set(r.pending_buf.subarray(r.pending_out,r.pending_out+i),e.next_out),e.next_out+=i,r.pending_out+=i,e.total_out+=i,e.avail_out-=i,r.pending-=i,r.pending===0&&(r.pending_out=0))},MT=(e,r)=>{dpt(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,r),e.block_start=e.strstart,LT(e.strm)},ZE=(e,r)=>{e.pending_buf[e.pending++]=r},vP=(e,r)=>{e.pending_buf[e.pending++]=r>>>8&255,e.pending_buf[e.pending++]=255&r},MG=(e,r,i,d)=>{let h=e.avail_in;return h>d&&(h=d),h===0?0:(e.avail_in-=h,r.set(e.input.subarray(e.next_in,e.next_in+h),i),e.state.wrap===1?e.adler=EP(e.adler,r,h,i):e.state.wrap===2&&(e.adler=KS(e.adler,r,h,i)),e.next_in+=h,e.total_in+=h,h)},oQ=(e,r)=>{let i,d,h=e.max_chain_length,f=e.strstart,g=e.prev_length,b=e.nice_match;const C=e.strstart>e.w_size-KR?e.strstart-(e.w_size-KR):0,P=e.window,x=e.w_mask,H=e.prev,$=e.strstart+AI;let _t=P[f+g-1],_i=P[f+g];e.prev_length>=e.good_match&&(h>>=2),b>e.lookahead&&(b=e.lookahead);do if(i=r,P[i+g]===_i&&P[i+g-1]===_t&&P[i]===P[f]&&P[++i]===P[f+1]){f+=2,i++;do;while(P[++f]===P[++i]&&P[++f]===P[++i]&&P[++f]===P[++i]&&P[++f]===P[++i]&&P[++f]===P[++i]&&P[++f]===P[++i]&&P[++f]===P[++i]&&P[++f]===P[++i]&&f<$);if(d=AI-($-f),f=$-AI,d>g){if(e.match_start=r,g=d,d>=b)break;_t=P[f+g-1],_i=P[f+g]}}while((r=H[r&x])>C&&--h!=0);return g<=e.lookahead?g:e.lookahead},YO=e=>{const r=e.w_size;let i,d,h;do{if(d=e.window_size-e.lookahead-e.strstart,e.strstart>=r+(r-KR)&&(e.window.set(e.window.subarray(r,r+r-d),0),e.match_start-=r,e.strstart-=r,e.block_start-=r,e.insert>e.strstart&&(e.insert=e.strstart),Ipt(e),d+=r),e.strm.avail_in===0)break;if(i=MG(e.strm,e.window,e.strstart+e.lookahead,d),e.lookahead+=i,e.lookahead+e.insert>=3)for(h=e.strstart-e.insert,e.ins_h=e.window[h],e.ins_h=W0(e,e.ins_h,e.window[h+1]);e.insert&&(e.ins_h=W0(e,e.ins_h,e.window[h+3-1]),e.prev[h&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=h,h++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<KR&&e.strm.avail_in!==0)},sQ=(e,r)=>{let i,d,h,f=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,g=0,b=e.strm.avail_in;do{if(i=65535,h=e.bi_valid+42>>3,e.strm.avail_out<h||(h=e.strm.avail_out-h,d=e.strstart-e.block_start,i>d+e.strm.avail_in&&(i=d+e.strm.avail_in),i>h&&(i=h),i<f&&(i===0&&r!==oR||r===G0||i!==d+e.strm.avail_in)))break;g=r===oR&&i===d+e.strm.avail_in?1:0,DG(e,0,0,g),e.pending_buf[e.pending-4]=i,e.pending_buf[e.pending-3]=i>>8,e.pending_buf[e.pending-2]=~i,e.pending_buf[e.pending-1]=~i>>8,LT(e.strm),d&&(d>i&&(d=i),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+d),e.strm.next_out),e.strm.next_out+=d,e.strm.avail_out-=d,e.strm.total_out+=d,e.block_start+=d,i-=d),i&&(MG(e.strm,e.strm.output,e.strm.next_out,i),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i)}while(g===0);return b-=e.strm.avail_in,b&&(b>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=b&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-b,e.strm.next_in),e.strstart),e.strstart+=b,e.insert+=b>e.w_size-e.insert?e.w_size-e.insert:b),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),g?4:r!==G0&&r!==oR&&e.strm.avail_in===0&&e.strstart===e.block_start?2:(h=e.window_size-e.strstart,e.strm.avail_in>h&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,h+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),h>e.strm.avail_in&&(h=e.strm.avail_in),h&&(MG(e.strm,e.window,e.strstart,h),e.strstart+=h,e.insert+=h>e.w_size-e.insert?e.w_size-e.insert:h),e.high_water<e.strstart&&(e.high_water=e.strstart),h=e.bi_valid+42>>3,h=e.pending_buf_size-h>65535?65535:e.pending_buf_size-h,f=h>e.w_size?e.w_size:h,d=e.strstart-e.block_start,(d>=f||(d||r===oR)&&r!==G0&&e.strm.avail_in===0&&d<=h)&&(i=d>h?h:d,g=r===oR&&e.strm.avail_in===0&&i===d?1:0,DG(e,e.block_start,i,g),e.block_start+=i,LT(e.strm)),g?3:1)},xG=(e,r)=>{let i,d;for(;;){if(e.lookahead<KR){if(YO(e),e.lookahead<KR&&r===G0)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=W0(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),i!==0&&e.strstart-i<=e.w_size-KR&&(e.match_length=oQ(e,i)),e.match_length>=3)if(d=B0(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do e.strstart++,e.ins_h=W0(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart;while(--e.match_length!=0);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=W0(e,e.ins_h,e.window[e.strstart+1]);else d=B0(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(d&&(MT(e,!1),e.strm.avail_out===0))return 1}return e.insert=e.strstart<2?e.strstart:2,r===oR?(MT(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(MT(e,!1),e.strm.avail_out===0)?1:2},JO=(e,r)=>{let i,d,h;for(;;){if(e.lookahead<KR){if(YO(e),e.lookahead<KR&&r===G0)return 1;if(e.lookahead===0)break}if(i=0,e.lookahead>=3&&(e.ins_h=W0(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,i!==0&&e.prev_length<e.max_lazy_match&&e.strstart-i<=e.w_size-KR&&(e.match_length=oQ(e,i),e.match_length<=5&&(e.strategy===_pt||e.match_length===3&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){h=e.strstart+e.lookahead-3,d=B0(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do++e.strstart<=h&&(e.ins_h=W0(e,e.ins_h,e.window[e.strstart+3-1]),i=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart);while(--e.prev_length!=0);if(e.match_available=0,e.match_length=2,e.strstart++,d&&(MT(e,!1),e.strm.avail_out===0))return 1}else if(e.match_available){if(d=B0(e,0,e.window[e.strstart-1]),d&&MT(e,!1),e.strstart++,e.lookahead--,e.strm.avail_out===0)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(d=B0(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,r===oR?(MT(e,!0),e.strm.avail_out===0?3:4):e.sym_next&&(MT(e,!1),e.strm.avail_out===0)?1:2};function HR(e,r,i,d,h){this.good_length=e,this.max_lazy=r,this.nice_length=i,this.max_chain=d,this.func=h}const bP=[new HR(0,0,0,0,sQ),new HR(4,4,8,4,xG),new HR(4,5,16,8,xG),new HR(4,6,32,32,xG),new HR(4,4,16,16,JO),new HR(8,16,32,32,JO),new HR(8,16,128,128,JO),new HR(8,32,128,256,JO),new HR(32,128,258,1024,JO),new HR(32,258,258,4096,JO)];function wpt(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=N1,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(2*Tpt),this.dyn_dtree=new Uint16Array(2*(2*ypt+1)),this.bl_tree=new Uint16Array(2*(2*Spt+1)),q0(this.dyn_ltree),q0(this.dyn_dtree),q0(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(Rpt+1),this.heap=new Uint16Array(2*LG+1),q0(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(2*LG+1),q0(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const yP=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.status!==zO&&r.status!==57&&r.status!==69&&r.status!==73&&r.status!==91&&r.status!==103&&r.status!==OI&&r.status!==gP?1:0},aQ=e=>{if(yP(e))return NI(e,WR);e.total_in=e.total_out=0,e.data_type=bpt;const r=e.state;return r.pending=0,r.pending_out=0,r.wrap<0&&(r.wrap=-r.wrap),r.status=r.wrap===2?57:r.wrap?zO:OI,e.adler=r.wrap===2?0:1,r.last_flush=-2,upt(r),QS},cQ=e=>{const r=aQ(e);return r===QS&&(i=>{i.window_size=2*i.w_size,q0(i.head),i.max_lazy_match=bP[i.level].max_lazy,i.good_match=bP[i.level].good_length,i.nice_match=bP[i.level].nice_length,i.max_chain_length=bP[i.level].max_chain,i.strstart=0,i.block_start=0,i.lookahead=0,i.insert=0,i.match_length=i.prev_length=2,i.match_available=0,i.ins_h=0})(e.state),r},uQ=(e,r,i,d,h,f)=>{if(!e)return WR;let g=1;if(r===mpt&&(r=6),d<0?(g=0,d=-d):d>15&&(g=2,d-=16),h<1||h>9||i!==N1||d<8||d>15||r<0||r>9||f<0||f>gpt||d===8&&g!==1)return NI(e,WR);d===8&&(d=9);const b=new wpt;return e.state=b,b.strm=e,b.status=zO,b.wrap=g,b.gzhead=null,b.w_bits=d,b.w_size=1<<b.w_bits,b.w_mask=b.w_size-1,b.hash_bits=h+7,b.hash_size=1<<b.hash_bits,b.hash_mask=b.hash_size-1,b.hash_shift=~~((b.hash_bits+3-1)/3),b.window=new Uint8Array(2*b.w_size),b.head=new Uint16Array(b.hash_size),b.prev=new Uint16Array(b.w_size),b.lit_bufsize=1<<h+6,b.pending_buf_size=4*b.lit_bufsize,b.pending_buf=new Uint8Array(b.pending_buf_size),b.sym_buf=b.lit_bufsize,b.sym_end=3*(b.lit_bufsize-1),b.level=r,b.strategy=f,b.method=i,cQ(e)};var Cpt=(e,r)=>{if(yP(e)||r>nQ||r<0)return e?NI(e,WR):WR;const i=e.state;if(!e.output||e.avail_in!==0&&!e.input||i.status===gP&&r!==oR)return NI(e,e.avail_out===0?kG:WR);const d=i.last_flush;if(i.last_flush=r,i.pending!==0){if(LT(e),e.avail_out===0)return i.last_flush=-1,QS}else if(e.avail_in===0&&iQ(r)<=iQ(d)&&r!==oR)return NI(e,kG);if(i.status===gP&&e.avail_in!==0)return NI(e,kG);if(i.status===zO&&i.wrap===0&&(i.status=OI),i.status===zO){let h=N1+(i.w_bits-8<<4)<<8,f=-1;if(f=i.strategy>=O1||i.level<2?0:i.level<6?1:i.level===6?2:3,h|=f<<6,i.strstart!==0&&(h|=32),h+=31-h%31,vP(i,h),i.strstart!==0&&(vP(i,e.adler>>>16),vP(i,65535&e.adler)),e.adler=1,i.status=OI,LT(e),i.pending!==0)return i.last_flush=-1,QS}if(i.status===57){if(e.adler=0,ZE(i,31),ZE(i,139),ZE(i,8),i.gzhead)ZE(i,(i.gzhead.text?1:0)+(i.gzhead.hcrc?2:0)+(i.gzhead.extra?4:0)+(i.gzhead.name?8:0)+(i.gzhead.comment?16:0)),ZE(i,255&i.gzhead.time),ZE(i,i.gzhead.time>>8&255),ZE(i,i.gzhead.time>>16&255),ZE(i,i.gzhead.time>>24&255),ZE(i,i.level===9?2:i.strategy>=O1||i.level<2?4:0),ZE(i,255&i.gzhead.os),i.gzhead.extra&&i.gzhead.extra.length&&(ZE(i,255&i.gzhead.extra.length),ZE(i,i.gzhead.extra.length>>8&255)),i.gzhead.hcrc&&(e.adler=KS(e.adler,i.pending_buf,i.pending,0)),i.gzindex=0,i.status=69;else if(ZE(i,0),ZE(i,0),ZE(i,0),ZE(i,0),ZE(i,0),ZE(i,i.level===9?2:i.strategy>=O1||i.level<2?4:0),ZE(i,3),i.status=OI,LT(e),i.pending!==0)return i.last_flush=-1,QS}if(i.status===69){if(i.gzhead.extra){let h=i.pending,f=(65535&i.gzhead.extra.length)-i.gzindex;for(;i.pending+f>i.pending_buf_size;){let b=i.pending_buf_size-i.pending;if(i.pending_buf.set(i.gzhead.extra.subarray(i.gzindex,i.gzindex+b),i.pending),i.pending=i.pending_buf_size,i.gzhead.hcrc&&i.pending>h&&(e.adler=KS(e.adler,i.pending_buf,i.pending-h,h)),i.gzindex+=b,LT(e),i.pending!==0)return i.last_flush=-1,QS;h=0,f-=b}let g=new Uint8Array(i.gzhead.extra);i.pending_buf.set(g.subarray(i.gzindex,i.gzindex+f),i.pending),i.pending+=f,i.gzhead.hcrc&&i.pending>h&&(e.adler=KS(e.adler,i.pending_buf,i.pending-h,h)),i.gzindex=0}i.status=73}if(i.status===73){if(i.gzhead.name){let h,f=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>f&&(e.adler=KS(e.adler,i.pending_buf,i.pending-f,f)),LT(e),i.pending!==0)return i.last_flush=-1,QS;f=0}h=i.gzindex<i.gzhead.name.length?255&i.gzhead.name.charCodeAt(i.gzindex++):0,ZE(i,h)}while(h!==0);i.gzhead.hcrc&&i.pending>f&&(e.adler=KS(e.adler,i.pending_buf,i.pending-f,f)),i.gzindex=0}i.status=91}if(i.status===91){if(i.gzhead.comment){let h,f=i.pending;do{if(i.pending===i.pending_buf_size){if(i.gzhead.hcrc&&i.pending>f&&(e.adler=KS(e.adler,i.pending_buf,i.pending-f,f)),LT(e),i.pending!==0)return i.last_flush=-1,QS;f=0}h=i.gzindex<i.gzhead.comment.length?255&i.gzhead.comment.charCodeAt(i.gzindex++):0,ZE(i,h)}while(h!==0);i.gzhead.hcrc&&i.pending>f&&(e.adler=KS(e.adler,i.pending_buf,i.pending-f,f))}i.status=103}if(i.status===103){if(i.gzhead.hcrc){if(i.pending+2>i.pending_buf_size&&(LT(e),i.pending!==0))return i.last_flush=-1,QS;ZE(i,255&e.adler),ZE(i,e.adler>>8&255),e.adler=0}if(i.status=OI,LT(e),i.pending!==0)return i.last_flush=-1,QS}if(e.avail_in!==0||i.lookahead!==0||r!==G0&&i.status!==gP){let h=i.level===0?sQ(i,r):i.strategy===O1?((f,g)=>{let b;for(;;){if(f.lookahead===0&&(YO(f),f.lookahead===0)){if(g===G0)return 1;break}if(f.match_length=0,b=B0(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++,b&&(MT(f,!1),f.strm.avail_out===0))return 1}return f.insert=0,g===oR?(MT(f,!0),f.strm.avail_out===0?3:4):f.sym_next&&(MT(f,!1),f.strm.avail_out===0)?1:2})(i,r):i.strategy===Ept?((f,g)=>{let b,C,P,x;const H=f.window;for(;;){if(f.lookahead<=AI){if(YO(f),f.lookahead<=AI&&g===G0)return 1;if(f.lookahead===0)break}if(f.match_length=0,f.lookahead>=3&&f.strstart>0&&(P=f.strstart-1,C=H[P],C===H[++P]&&C===H[++P]&&C===H[++P])){x=f.strstart+AI;do;while(C===H[++P]&&C===H[++P]&&C===H[++P]&&C===H[++P]&&C===H[++P]&&C===H[++P]&&C===H[++P]&&C===H[++P]&&P<x);f.match_length=AI-(x-P),f.match_length>f.lookahead&&(f.match_length=f.lookahead)}if(f.match_length>=3?(b=B0(f,1,f.match_length-3),f.lookahead-=f.match_length,f.strstart+=f.match_length,f.match_length=0):(b=B0(f,0,f.window[f.strstart]),f.lookahead--,f.strstart++),b&&(MT(f,!1),f.strm.avail_out===0))return 1}return f.insert=0,g===oR?(MT(f,!0),f.strm.avail_out===0?3:4):f.sym_next&&(MT(f,!1),f.strm.avail_out===0)?1:2})(i,r):bP[i.level].func(i,r);if(h!==3&&h!==4||(i.status=gP),h===1||h===3)return e.avail_out===0&&(i.last_flush=-1),QS;if(h===2&&(r===hpt?lpt(i):r!==nQ&&(DG(i,0,0,!1),r===ppt&&(q0(i.head),i.lookahead===0&&(i.strstart=0,i.block_start=0,i.insert=0))),LT(e),e.avail_out===0))return i.last_flush=-1,QS}return r!==oR?QS:i.wrap<=0?rQ:(i.wrap===2?(ZE(i,255&e.adler),ZE(i,e.adler>>8&255),ZE(i,e.adler>>16&255),ZE(i,e.adler>>24&255),ZE(i,255&e.total_in),ZE(i,e.total_in>>8&255),ZE(i,e.total_in>>16&255),ZE(i,e.total_in>>24&255)):(vP(i,e.adler>>>16),vP(i,65535&e.adler)),LT(e),i.wrap>0&&(i.wrap=-i.wrap),i.pending!==0?QS:rQ)},Apt=(e,r)=>{let i=r.length;if(yP(e))return WR;const d=e.state,h=d.wrap;if(h===2||h===1&&d.status!==zO||d.lookahead)return WR;if(h===1&&(e.adler=EP(e.adler,r,i,0)),d.wrap=0,i>=d.w_size){h===0&&(q0(d.head),d.strstart=0,d.block_start=0,d.insert=0);let C=new Uint8Array(d.w_size);C.set(r.subarray(i-d.w_size,i),0),r=C,i=d.w_size}const f=e.avail_in,g=e.next_in,b=e.input;for(e.avail_in=i,e.next_in=0,e.input=r,YO(d);d.lookahead>=3;){let C=d.strstart,P=d.lookahead-2;do d.ins_h=W0(d,d.ins_h,d.window[C+3-1]),d.prev[C&d.w_mask]=d.head[d.ins_h],d.head[d.ins_h]=C,C++;while(--P);d.strstart=C,d.lookahead=2,YO(d)}return d.strstart+=d.lookahead,d.block_start=d.strstart,d.insert=d.lookahead,d.lookahead=0,d.match_length=d.prev_length=2,d.match_available=0,e.next_in=g,e.input=b,e.avail_in=f,d.wrap=h,QS},SP={deflateInit:(e,r)=>uQ(e,r,N1,15,8,vpt),deflateInit2:uQ,deflateReset:cQ,deflateResetKeep:aQ,deflateSetHeader:(e,r)=>yP(e)||e.state.wrap!==2?WR:(e.state.gzhead=r,QS),deflate:Cpt,deflateEnd:e=>{if(yP(e))return WR;const r=e.state.status;return e.state=null,r===OI?NI(e,fpt):QS},deflateSetDictionary:Apt,deflateInfo:"pako deflate (from Nodeca project)"};const Opt=(e,r)=>Object.prototype.hasOwnProperty.call(e,r);var P1={assign:function(e){const r=Array.prototype.slice.call(arguments,1);for(;r.length;){const i=r.shift();if(i){if(typeof i!="object")throw new TypeError(i+"must be non-object");for(const d in i)Opt(i,d)&&(e[d]=i[d])}}return e},flattenChunks:e=>{let r=0;for(let d=0,h=e.length;d<h;d++)r+=e[d].length;const i=new Uint8Array(r);for(let d=0,h=0,f=e.length;d<f;d++){let g=e[d];i.set(g,h),h+=g.length}return i}};let dQ=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{dQ=!1}const TP=new Uint8Array(256);for(let e=0;e<256;e++)TP[e]=e>=252?6:e>=248?5:e>=240?4:e>=224?3:e>=192?2:1;TP[254]=TP[254]=1;var RP={string2buf:e=>{if(typeof TextEncoder=="function"&&TextEncoder.prototype.encode)return new TextEncoder().encode(e);let r,i,d,h,f,g=e.length,b=0;for(h=0;h<g;h++)i=e.charCodeAt(h),(64512&i)==55296&&h+1<g&&(d=e.charCodeAt(h+1),(64512&d)==56320&&(i=65536+(i-55296<<10)+(d-56320),h++)),b+=i<128?1:i<2048?2:i<65536?3:4;for(r=new Uint8Array(b),f=0,h=0;f<b;h++)i=e.charCodeAt(h),(64512&i)==55296&&h+1<g&&(d=e.charCodeAt(h+1),(64512&d)==56320&&(i=65536+(i-55296<<10)+(d-56320),h++)),i<128?r[f++]=i:i<2048?(r[f++]=192|i>>>6,r[f++]=128|63&i):i<65536?(r[f++]=224|i>>>12,r[f++]=128|i>>>6&63,r[f++]=128|63&i):(r[f++]=240|i>>>18,r[f++]=128|i>>>12&63,r[f++]=128|i>>>6&63,r[f++]=128|63&i);return r},buf2string:(e,r)=>{const i=r||e.length;if(typeof TextDecoder=="function"&&TextDecoder.prototype.decode)return new TextDecoder().decode(e.subarray(0,r));let d,h;const f=new Array(2*i);for(h=0,d=0;d<i;){let g=e[d++];if(g<128){f[h++]=g;continue}let b=TP[g];if(b>4)f[h++]=65533,d+=b-1;else{for(g&=b===2?31:b===3?15:7;b>1&&d<i;)g=g<<6|63&e[d++],b--;b>1?f[h++]=65533:g<65536?f[h++]=g:(g-=65536,f[h++]=55296|g>>10&1023,f[h++]=56320|1023&g)}}return((g,b)=>{if(b<65534&&g.subarray&&dQ)return String.fromCharCode.apply(null,g.length===b?g:g.subarray(0,b));let C="";for(let P=0;P<b;P++)C+=String.fromCharCode(g[P]);return C})(f,h)},utf8border:(e,r)=>{(r=r||e.length)>e.length&&(r=e.length);let i=r-1;for(;i>=0&&(192&e[i])==128;)i--;return i<0||i===0?r:i+TP[e[i]]>r?i:r}},lQ=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const hQ=Object.prototype.toString,{Z_NO_FLUSH:Npt,Z_SYNC_FLUSH:Ppt,Z_FULL_FLUSH:Dpt,Z_FINISH:kpt,Z_OK:D1,Z_STREAM_END:Lpt,Z_DEFAULT_COMPRESSION:Mpt,Z_DEFAULT_STRATEGY:xpt,Z_DEFLATED:Upt}=A1;function k1(e){this.options=P1.assign({level:Mpt,method:Upt,chunkSize:16384,windowBits:15,memLevel:8,strategy:xpt},e||{});let r=this.options;r.raw&&r.windowBits>0?r.windowBits=-r.windowBits:r.gzip&&r.windowBits>0&&r.windowBits<16&&(r.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lQ,this.strm.avail_out=0;let i=SP.deflateInit2(this.strm,r.level,r.method,r.windowBits,r.memLevel,r.strategy);if(i!==D1)throw new Error(CI[i]);if(r.header&&SP.deflateSetHeader(this.strm,r.header),r.dictionary){let d;if(d=typeof r.dictionary=="string"?RP.string2buf(r.dictionary):hQ.call(r.dictionary)==="[object ArrayBuffer]"?new Uint8Array(r.dictionary):r.dictionary,i=SP.deflateSetDictionary(this.strm,d),i!==D1)throw new Error(CI[i]);this._dict_set=!0}}function Vpt(e,r){const i=new k1(r);if(i.push(e,!0),i.err)throw i.msg||CI[i.err];return i.result}k1.prototype.push=function(e,r){const i=this.strm,d=this.options.chunkSize;let h,f;if(this.ended)return!1;for(f=r===~~r?r:r===!0?kpt:Npt,typeof e=="string"?i.input=RP.string2buf(e):hQ.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;)if(i.avail_out===0&&(i.output=new Uint8Array(d),i.next_out=0,i.avail_out=d),(f===Ppt||f===Dpt)&&i.avail_out<=6)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else{if(h=SP.deflate(i,f),h===Lpt)return i.next_out>0&&this.onData(i.output.subarray(0,i.next_out)),h=SP.deflateEnd(this.strm),this.onEnd(h),this.ended=!0,h===D1;if(i.avail_out!==0){if(f>0&&i.next_out>0)this.onData(i.output.subarray(0,i.next_out)),i.avail_out=0;else if(i.avail_in===0)break}else this.onData(i.output)}return!0},k1.prototype.onData=function(e){this.chunks.push(e)},k1.prototype.onEnd=function(e){e===D1&&(this.result=P1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var jpt={deflate:Vpt};const L1=16209;var Fpt=function(e,r){let i,d,h,f,g,b,C,P,x,H,$,_t,_i,ue,_r,Fi,Di,Js,_l,_u,ga,_m,r_,a_;const p_=e.state;i=e.next_in,r_=e.input,d=i+(e.avail_in-5),h=e.next_out,a_=e.output,f=h-(r-e.avail_out),g=h+(e.avail_out-257),b=p_.dmax,C=p_.wsize,P=p_.whave,x=p_.wnext,H=p_.window,$=p_.hold,_t=p_.bits,_i=p_.lencode,ue=p_.distcode,_r=(1<<p_.lenbits)-1,Fi=(1<<p_.distbits)-1;t:do{_t<15&&($+=r_[i++]<<_t,_t+=8,$+=r_[i++]<<_t,_t+=8),Di=_i[$&_r];e:for(;;){if(Js=Di>>>24,$>>>=Js,_t-=Js,Js=Di>>>16&255,Js===0)a_[h++]=65535&Di;else{if(!(16&Js)){if(!(64&Js)){Di=_i[(65535&Di)+($&(1<<Js)-1)];continue e}if(32&Js){p_.mode=16191;break t}e.msg="invalid literal/length code",p_.mode=L1;break t}_l=65535&Di,Js&=15,Js&&(_t<Js&&($+=r_[i++]<<_t,_t+=8),_l+=$&(1<<Js)-1,$>>>=Js,_t-=Js),_t<15&&($+=r_[i++]<<_t,_t+=8,$+=r_[i++]<<_t,_t+=8),Di=ue[$&Fi];n:for(;;){if(Js=Di>>>24,$>>>=Js,_t-=Js,Js=Di>>>16&255,!(16&Js)){if(!(64&Js)){Di=ue[(65535&Di)+($&(1<<Js)-1)];continue n}e.msg="invalid distance code",p_.mode=L1;break t}if(_u=65535&Di,Js&=15,_t<Js&&($+=r_[i++]<<_t,_t+=8,_t<Js&&($+=r_[i++]<<_t,_t+=8)),_u+=$&(1<<Js)-1,_u>b){e.msg="invalid distance too far back",p_.mode=L1;break t}if($>>>=Js,_t-=Js,Js=h-f,_u>Js){if(Js=_u-Js,Js>P&&p_.sane){e.msg="invalid distance too far back",p_.mode=L1;break t}if(ga=0,_m=H,x===0){if(ga+=C-Js,Js<_l){_l-=Js;do a_[h++]=H[ga++];while(--Js);ga=h-_u,_m=a_}}else if(x<Js){if(ga+=C+x-Js,Js-=x,Js<_l){_l-=Js;do a_[h++]=H[ga++];while(--Js);if(ga=0,x<_l){Js=x,_l-=Js;do a_[h++]=H[ga++];while(--Js);ga=h-_u,_m=a_}}}else if(ga+=x-Js,Js<_l){_l-=Js;do a_[h++]=H[ga++];while(--Js);ga=h-_u,_m=a_}for(;_l>2;)a_[h++]=_m[ga++],a_[h++]=_m[ga++],a_[h++]=_m[ga++],_l-=3;_l&&(a_[h++]=_m[ga++],_l>1&&(a_[h++]=_m[ga++]))}else{ga=h-_u;do a_[h++]=a_[ga++],a_[h++]=a_[ga++],a_[h++]=a_[ga++],_l-=3;while(_l>2);_l&&(a_[h++]=a_[ga++],_l>1&&(a_[h++]=a_[ga++]))}break}}break}}while(i<d&&h<g);_l=_t>>3,i-=_l,_t-=_l<<3,$&=(1<<_t)-1,e.next_in=i,e.next_out=h,e.avail_in=i<d?d-i+5:5-(i-d),e.avail_out=h<g?g-h+257:257-(h-g),p_.hold=$,p_.bits=_t};const M1=15,Bpt=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),Gpt=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),qpt=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Wpt=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var IP=(e,r,i,d,h,f,g,b)=>{const C=b.bits;let P,x,H,$,_t,_i,ue=0,_r=0,Fi=0,Di=0,Js=0,_l=0,_u=0,ga=0,_m=0,r_=0,a_=null;const p_=new Uint16Array(16),Q_=new Uint16Array(16);let $_,F_,mE,pE=null;for(ue=0;ue<=M1;ue++)p_[ue]=0;for(_r=0;_r<d;_r++)p_[r[i+_r]]++;for(Js=C,Di=M1;Di>=1&&p_[Di]===0;Di--);if(Js>Di&&(Js=Di),Di===0)return h[f++]=20971520,h[f++]=20971520,b.bits=1,0;for(Fi=1;Fi<Di&&p_[Fi]===0;Fi++);for(Js<Fi&&(Js=Fi),ga=1,ue=1;ue<=M1;ue++)if(ga<<=1,ga-=p_[ue],ga<0)return-1;if(ga>0&&(e===0||Di!==1))return-1;for(Q_[1]=0,ue=1;ue<M1;ue++)Q_[ue+1]=Q_[ue]+p_[ue];for(_r=0;_r<d;_r++)r[i+_r]!==0&&(g[Q_[r[i+_r]]++]=_r);if(e===0?(a_=pE=g,_i=20):e===1?(a_=Bpt,pE=Gpt,_i=257):(a_=qpt,pE=Wpt,_i=0),r_=0,_r=0,ue=Fi,_t=f,_l=Js,_u=0,H=-1,_m=1<<Js,$=_m-1,e===1&&_m>852||e===2&&_m>592)return 1;for(;;){$_=ue-_u,g[_r]+1<_i?(F_=0,mE=g[_r]):g[_r]>=_i?(F_=pE[g[_r]-_i],mE=a_[g[_r]-_i]):(F_=96,mE=0),P=1<<ue-_u,x=1<<_l,Fi=x;do x-=P,h[_t+(r_>>_u)+x]=$_<<24|F_<<16|mE|0;while(x!==0);for(P=1<<ue-1;r_&P;)P>>=1;if(P!==0?(r_&=P-1,r_+=P):r_=0,_r++,--p_[ue]==0){if(ue===Di)break;ue=r[i+g[_r]]}if(ue>Js&&(r_&$)!==H){for(_u===0&&(_u=Js),_t+=Fi,_l=ue-_u,ga=1<<_l;_l+_u<Di&&(ga-=p_[_l+_u],!(ga<=0));)_l++,ga<<=1;if(_m+=1<<_l,e===1&&_m>852||e===2&&_m>592)return 1;H=r_&$,h[H]=Js<<24|_l<<16|_t-f|0}}return r_!==0&&(h[_t+r_]=ue-_u<<24|64<<16|0),b.bits=Js,0};const{Z_FINISH:pQ,Z_BLOCK:Kpt,Z_TREES:x1,Z_OK:PI,Z_STREAM_END:Hpt,Z_NEED_DICT:zpt,Z_STREAM_ERROR:sR,Z_DATA_ERROR:fQ,Z_MEM_ERROR:mQ,Z_BUF_ERROR:Ypt,Z_DEFLATED:_Q}=A1,U1=16180,V1=16190,d0=16191,UG=16192,VG=16194,j1=16199,F1=16200,jG=16206,lS=16209,EQ=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Jpt(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const DI=e=>{if(!e)return 1;const r=e.state;return!r||r.strm!==e||r.mode<U1||r.mode>16211?1:0},gQ=e=>{if(DI(e))return sR;const r=e.state;return e.total_in=e.total_out=r.total=0,e.msg="",r.wrap&&(e.adler=1&r.wrap),r.mode=U1,r.last=0,r.havedict=0,r.flags=-1,r.dmax=32768,r.head=null,r.hold=0,r.bits=0,r.lencode=r.lendyn=new Int32Array(852),r.distcode=r.distdyn=new Int32Array(592),r.sane=1,r.back=-1,PI},vQ=e=>{if(DI(e))return sR;const r=e.state;return r.wsize=0,r.whave=0,r.wnext=0,gQ(e)},bQ=(e,r)=>{let i;if(DI(e))return sR;const d=e.state;return r<0?(i=0,r=-r):(i=5+(r>>4),r<48&&(r&=15)),r&&(r<8||r>15)?sR:(d.window!==null&&d.wbits!==r&&(d.window=null),d.wrap=i,d.wbits=r,vQ(e))},yQ=(e,r)=>{if(!e)return sR;const i=new Jpt;e.state=i,i.strm=e,i.window=null,i.mode=U1;const d=bQ(e,r);return d!==PI&&(e.state=null),d};let FG,BG,SQ=!0;const Xpt=e=>{if(SQ){FG=new Int32Array(512),BG=new Int32Array(32);let r=0;for(;r<144;)e.lens[r++]=8;for(;r<256;)e.lens[r++]=9;for(;r<280;)e.lens[r++]=7;for(;r<288;)e.lens[r++]=8;for(IP(1,e.lens,0,288,FG,0,e.work,{bits:9}),r=0;r<32;)e.lens[r++]=5;IP(2,e.lens,0,32,BG,0,e.work,{bits:5}),SQ=!1}e.lencode=FG,e.lenbits=9,e.distcode=BG,e.distbits=5},TQ=(e,r,i,d)=>{let h;const f=e.state;return f.window===null&&(f.wsize=1<<f.wbits,f.wnext=0,f.whave=0,f.window=new Uint8Array(f.wsize)),d>=f.wsize?(f.window.set(r.subarray(i-f.wsize,i),0),f.wnext=0,f.whave=f.wsize):(h=f.wsize-f.wnext,h>d&&(h=d),f.window.set(r.subarray(i-d,i-d+h),f.wnext),(d-=h)?(f.window.set(r.subarray(i-d,i),0),f.wnext=d,f.whave=f.wsize):(f.wnext+=h,f.wnext===f.wsize&&(f.wnext=0),f.whave<f.wsize&&(f.whave+=h))),0};var Qpt=(e,r)=>{let i,d,h,f,g,b,C,P,x,H,$,_t,_i,ue,_r,Fi,Di,Js,_l,_u,ga,_m,r_=0;const a_=new Uint8Array(4);let p_,Q_;const $_=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(DI(e)||!e.output||!e.input&&e.avail_in!==0)return sR;i=e.state,i.mode===d0&&(i.mode=UG),g=e.next_out,h=e.output,C=e.avail_out,f=e.next_in,d=e.input,b=e.avail_in,P=i.hold,x=i.bits,H=b,$=C,_m=PI;t:for(;;)switch(i.mode){case U1:if(i.wrap===0){i.mode=UG;break}for(;x<16;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}if(2&i.wrap&&P===35615){i.wbits===0&&(i.wbits=15),i.check=0,a_[0]=255&P,a_[1]=P>>>8&255,i.check=KS(i.check,a_,2,0),P=0,x=0,i.mode=16181;break}if(i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&P)<<8)+(P>>8))%31){e.msg="incorrect header check",i.mode=lS;break}if((15&P)!==_Q){e.msg="unknown compression method",i.mode=lS;break}if(P>>>=4,x-=4,ga=8+(15&P),i.wbits===0&&(i.wbits=ga),ga>15||ga>i.wbits){e.msg="invalid window size",i.mode=lS;break}i.dmax=1<<i.wbits,i.flags=0,e.adler=i.check=1,i.mode=512&P?16189:d0,P=0,x=0;break;case 16181:for(;x<16;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}if(i.flags=P,(255&jS(i))!==_Q){e.msg="unknown compression method",i.mode=lS;break}if(57344&jS(i)){e.msg="unknown header flags set",i.mode=lS;break}i.head&&(i.head.text=P>>8&1),512&jS(i)&&4&i.wrap&&(a_[0]=255&P,a_[1]=P>>>8&255,i.check=KS(i.check,a_,2,0)),P=0,x=0,i.mode=16182;case 16182:for(;x<32;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}i.head&&(i.head.time=P),512&jS(i)&&4&i.wrap&&(a_[0]=255&P,a_[1]=P>>>8&255,a_[2]=P>>>16&255,a_[3]=P>>>24&255,i.check=KS(i.check,a_,4,0)),P=0,x=0,i.mode=16183;case 16183:for(;x<16;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}i.head&&(i.head.xflags=255&P,i.head.os=P>>8),512&jS(i)&&4&i.wrap&&(a_[0]=255&P,a_[1]=P>>>8&255,i.check=KS(i.check,a_,2,0)),P=0,x=0,i.mode=16184;case 16184:if(1024&jS(i)){for(;x<16;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}i.length=P,i.head&&(i.head.extra_len=P),512&jS(i)&&4&i.wrap&&(a_[0]=255&P,a_[1]=P>>>8&255,i.check=KS(i.check,a_,2,0)),P=0,x=0}else i.head&&(i.head.extra=null);i.mode=16185;case 16185:if(1024&jS(i)&&(_t=i.length,_t>b&&(_t=b),_t&&(i.head&&(ga=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Uint8Array(i.head.extra_len)),i.head.extra.set(d.subarray(f,f+_t),ga)),512&jS(i)&&4&i.wrap&&(i.check=KS(i.check,d,_t,f)),b-=_t,f+=_t,i.length-=_t),i.length))break t;i.length=0,i.mode=16186;case 16186:if(2048&jS(i)){if(b===0)break t;_t=0;do ga=d[f+_t++],i.head&&ga&&i.length<65536&&(i.head.name+=String.fromCharCode(ga));while(ga&&_t<b);if(512&jS(i)&&4&i.wrap&&(i.check=KS(i.check,d,_t,f)),b-=_t,f+=_t,ga)break t}else i.head&&(i.head.name=null);i.length=0,i.mode=16187;case 16187:if(4096&jS(i)){if(b===0)break t;_t=0;do ga=d[f+_t++],i.head&&ga&&i.length<65536&&(i.head.comment+=String.fromCharCode(ga));while(ga&&_t<b);if(512&jS(i)&&4&i.wrap&&(i.check=KS(i.check,d,_t,f)),b-=_t,f+=_t,ga)break t}else i.head&&(i.head.comment=null);i.mode=16188;case 16188:if(512&jS(i)){for(;x<16;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}if(4&i.wrap&&P!==(65535&i.check)){e.msg="header crc mismatch",i.mode=lS;break}P=0,x=0}i.head&&(i.head.hcrc=jS(i)>>9&1,i.head.done=!0),e.adler=i.check=0,i.mode=d0;break;case 16189:for(;x<32;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}e.adler=i.check=EQ(P),P=0,x=0,i.mode=V1;case V1:if(i.havedict===0)return e.next_out=g,e.avail_out=C,e.next_in=f,e.avail_in=b,i.hold=P,i.bits=x,zpt;e.adler=i.check=1,i.mode=d0;case d0:if(r===Kpt||r===x1)break t;case UG:if(i.last){P>>>=7&x,x-=7&x,i.mode=jG;break}for(;x<3;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}switch(i.last=1&P,P>>>=1,x-=1,3&P){case 0:i.mode=16193;break;case 1:if(Xpt(i),i.mode=j1,r===x1){P>>>=2,x-=2;break t}break;case 2:i.mode=16196;break;case 3:e.msg="invalid block type",i.mode=lS}P>>>=2,x-=2;break;case 16193:for(P>>>=7&x,x-=7&x;x<32;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}if((65535&P)!=(P>>>16^65535)){e.msg="invalid stored block lengths",i.mode=lS;break}if(i.length=65535&P,P=0,x=0,i.mode=VG,r===x1)break t;case VG:i.mode=16195;case 16195:if(_t=i.length,_t){if(_t>b&&(_t=b),_t>C&&(_t=C),_t===0)break t;h.set(d.subarray(f,f+_t),g),b-=_t,f+=_t,C-=_t,g+=_t,i.length-=_t;break}i.mode=d0;break;case 16196:for(;x<14;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}if(i.nlen=257+(31&P),P>>>=5,x-=5,i.ndist=1+(31&P),P>>>=5,x-=5,i.ncode=4+(15&P),P>>>=4,x-=4,i.nlen>286||i.ndist>30){e.msg="too many length or distance symbols",i.mode=lS;break}i.have=0,i.mode=16197;case 16197:for(;i.have<i.ncode;){for(;x<3;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}i.lens[$_[i.have++]]=7&P,P>>>=3,x-=3}for(;i.have<19;)i.lens[$_[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,p_={bits:i.lenbits},_m=IP(0,i.lens,0,19,i.lencode,0,i.work,p_),i.lenbits=p_.bits,_m){e.msg="invalid code lengths set",i.mode=lS;break}i.have=0,i.mode=16198;case 16198:for(;i.have<i.nlen+i.ndist;){for(;r_=i.lencode[P&(1<<i.lenbits)-1],_r=r_>>>24,Fi=r_>>>16&255,Di=65535&r_,!(_r<=x);){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}if(Di<16)P>>>=_r,x-=_r,i.lens[i.have++]=Di;else{if(Di===16){for(Q_=_r+2;x<Q_;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}if(P>>>=_r,x-=_r,i.have===0){e.msg="invalid bit length repeat",i.mode=lS;break}ga=i.lens[i.have-1],_t=3+(3&P),P>>>=2,x-=2}else if(Di===17){for(Q_=_r+3;x<Q_;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}P>>>=_r,x-=_r,ga=0,_t=3+(7&P),P>>>=3,x-=3}else{for(Q_=_r+7;x<Q_;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}P>>>=_r,x-=_r,ga=0,_t=11+(127&P),P>>>=7,x-=7}if(i.have+_t>i.nlen+i.ndist){e.msg="invalid bit length repeat",i.mode=lS;break}for(;_t--;)i.lens[i.have++]=ga}}if(i.mode===lS)break;if(i.lens[256]===0){e.msg="invalid code -- missing end-of-block",i.mode=lS;break}if(i.lenbits=9,p_={bits:i.lenbits},_m=IP(1,i.lens,0,i.nlen,i.lencode,0,i.work,p_),i.lenbits=p_.bits,_m){e.msg="invalid literal/lengths set",i.mode=lS;break}if(i.distbits=6,i.distcode=i.distdyn,p_={bits:i.distbits},_m=IP(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,p_),i.distbits=p_.bits,_m){e.msg="invalid distances set",i.mode=lS;break}if(i.mode=j1,r===x1)break t;case j1:i.mode=F1;case F1:if(b>=6&&C>=258){e.next_out=g,e.avail_out=C,e.next_in=f,e.avail_in=b,i.hold=P,i.bits=x,Fpt(e,$),g=e.next_out,h=e.output,C=e.avail_out,f=e.next_in,d=e.input,b=e.avail_in,P=i.hold,x=i.bits,i.mode===d0&&(i.back=-1);break}for(i.back=0;r_=i.lencode[P&(1<<i.lenbits)-1],_r=r_>>>24,Fi=r_>>>16&255,Di=65535&r_,!(_r<=x);){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}if(Fi&&!(240&Fi)){for(Js=_r,_l=Fi,_u=Di;r_=i.lencode[_u+((P&(1<<Js+_l)-1)>>Js)],_r=r_>>>24,Fi=r_>>>16&255,Di=65535&r_,!(Js+_r<=x);){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}P>>>=Js,x-=Js,i.back+=Js}if(P>>>=_r,x-=_r,i.back+=_r,i.length=Di,Fi===0){i.mode=16205;break}if(32&Fi){i.back=-1,i.mode=d0;break}if(64&Fi){e.msg="invalid literal/length code",i.mode=lS;break}i.extra=15&Fi,i.mode=16201;case 16201:if(i.extra){for(Q_=i.extra;x<Q_;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}i.length+=P&(1<<i.extra)-1,P>>>=i.extra,x-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=16202;case 16202:for(;r_=i.distcode[P&(1<<i.distbits)-1],_r=r_>>>24,Fi=r_>>>16&255,Di=65535&r_,!(_r<=x);){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}if(!(240&Fi)){for(Js=_r,_l=Fi,_u=Di;r_=i.distcode[_u+((P&(1<<Js+_l)-1)>>Js)],_r=r_>>>24,Fi=r_>>>16&255,Di=65535&r_,!(Js+_r<=x);){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}P>>>=Js,x-=Js,i.back+=Js}if(P>>>=_r,x-=_r,i.back+=_r,64&Fi){e.msg="invalid distance code",i.mode=lS;break}i.offset=Di,i.extra=15&Fi,i.mode=16203;case 16203:if(i.extra){for(Q_=i.extra;x<Q_;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}i.offset+=P&(1<<i.extra)-1,P>>>=i.extra,x-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){e.msg="invalid distance too far back",i.mode=lS;break}i.mode=16204;case 16204:if(C===0)break t;if(_t=$-C,i.offset>_t){if(_t=i.offset-_t,_t>i.whave&&i.sane){e.msg="invalid distance too far back",i.mode=lS;break}_t>i.wnext?(_t-=i.wnext,_i=i.wsize-_t):_i=i.wnext-_t,_t>i.length&&(_t=i.length),ue=i.window}else ue=h,_i=g-i.offset,_t=i.length;_t>C&&(_t=C),C-=_t,i.length-=_t;do h[g++]=ue[_i++];while(--_t);i.length===0&&(i.mode=F1);break;case 16205:if(C===0)break t;h[g++]=i.length,C--,i.mode=F1;break;case jG:if(i.wrap){for(;x<32;){if(b===0)break t;b--,P|=d[f++]<<x,x+=8}if($-=C,e.total_out+=$,i.total+=$,4&i.wrap&&$&&(e.adler=i.check=jS(i)?KS(i.check,h,$,g-$):EP(i.check,h,$,g-$)),$=C,4&i.wrap&&(jS(i)?P:EQ(P))!==i.check){e.msg="incorrect data check",i.mode=lS;break}P=0,x=0}i.mode=16207;case 16207:if(i.wrap&&jS(i)){for(;x<32;){if(b===0)break t;b--,P+=d[f++]<<x,x+=8}if(4&i.wrap&&P!==(4294967295&i.total)){e.msg="incorrect length check",i.mode=lS;break}P=0,x=0}i.mode=16208;case 16208:_m=Hpt;break t;case lS:_m=fQ;break t;case 16210:return mQ;default:return sR}return e.next_out=g,e.avail_out=C,e.next_in=f,e.avail_in=b,i.hold=P,i.bits=x,(i.wsize||$!==e.avail_out&&i.mode<lS&&(i.mode<jG||r!==pQ))&&TQ(e,e.output,e.next_out,$-e.avail_out),H-=e.avail_in,$-=e.avail_out,e.total_in+=H,e.total_out+=$,i.total+=$,4&i.wrap&&$&&(e.adler=i.check=jS(i)?KS(i.check,h,$,e.next_out-$):EP(i.check,h,$,e.next_out-$)),e.data_type=i.bits+(i.last?64:0)+(i.mode===d0?128:0)+(i.mode===j1||i.mode===VG?256:0),(H===0&&$===0||r===pQ)&&_m===PI&&(_m=Ypt),_m},l0={inflateReset:vQ,inflateReset2:bQ,inflateResetKeep:gQ,inflateInit:e=>yQ(e,15),inflateInit2:yQ,inflate:Qpt,inflateEnd:e=>{if(DI(e))return sR;let r=e.state;return r.window&&(r.window=null),e.state=null,PI},inflateGetHeader:(e,r)=>{if(DI(e))return sR;const i=e.state;return 2&i.wrap?(i.head=r,r.done=!1,PI):sR},inflateSetDictionary:(e,r)=>{const i=r.length;let d,h,f;return DI(e)?sR:(d=e.state,d.wrap!==0&&d.mode!==V1?sR:d.mode===V1&&(h=1,h=EP(h,r,i,0),h!==d.check)?fQ:(f=TQ(e,r,i,i),f?(d.mode=16210,mQ):(d.havedict=1,PI)))},inflateInfo:"pako inflate (from Nodeca project)"},Zpt=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const RQ=Object.prototype.toString,{Z_NO_FLUSH:$pt,Z_FINISH:tft,Z_OK:wP,Z_STREAM_END:GG,Z_NEED_DICT:qG,Z_STREAM_ERROR:eft,Z_DATA_ERROR:IQ,Z_MEM_ERROR:nft}=A1;function B1(e){this.options=P1.assign({chunkSize:65536,windowBits:15,to:""},e||{});const r=this.options;r.raw&&r.windowBits>=0&&r.windowBits<16&&(r.windowBits=-r.windowBits,r.windowBits===0&&(r.windowBits=-15)),!(r.windowBits>=0&&r.windowBits<16)||e&&e.windowBits||(r.windowBits+=32),r.windowBits>15&&r.windowBits<48&&!(15&r.windowBits)&&(r.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new lQ,this.strm.avail_out=0;let i=l0.inflateInit2(this.strm,r.windowBits);if(i!==wP)throw new Error(CI[i]);if(this.header=new Zpt,l0.inflateGetHeader(this.strm,this.header),r.dictionary&&(typeof r.dictionary=="string"?r.dictionary=RP.string2buf(r.dictionary):RQ.call(r.dictionary)==="[object ArrayBuffer]"&&(r.dictionary=new Uint8Array(r.dictionary)),r.raw&&(i=l0.inflateSetDictionary(this.strm,r.dictionary),i!==wP)))throw new Error(CI[i])}function rft(e,r){const i=new B1(r);if(i.push(e),i.err)throw i.msg||CI[i.err];return i.result}B1.prototype.push=function(e,r){const i=this.strm,d=this.options.chunkSize,h=this.options.dictionary;let f,g,b;if(this.ended)return!1;for(g=r===~~r?r:r===!0?tft:$pt,RQ.call(e)==="[object ArrayBuffer]"?i.input=new Uint8Array(e):i.input=e,i.next_in=0,i.avail_in=i.input.length;;){for(i.avail_out===0&&(i.output=new Uint8Array(d),i.next_out=0,i.avail_out=d),f=l0.inflate(i,g),f===qG&&h&&(f=l0.inflateSetDictionary(i,h),f===wP?f=l0.inflate(i,g):f===IQ&&(f=qG));i.avail_in>0&&f===GG&&i.state.wrap>0&&e[i.next_in]!==0;)l0.inflateReset(i),f=l0.inflate(i,g);switch(f){case eft:case IQ:case qG:case nft:return this.onEnd(f),this.ended=!0,!1}if(b=i.avail_out,i.next_out&&(i.avail_out===0||f===GG))if(this.options.to==="string"){let C=RP.utf8border(i.output,i.next_out),P=i.next_out-C,x=RP.buf2string(i.output,C);i.next_out=P,i.avail_out=d-P,P&&i.output.set(i.output.subarray(C,C+P),0),this.onData(x)}else this.onData(i.output.length===i.next_out?i.output:i.output.subarray(0,i.next_out));if(f!==wP||b!==0){if(f===GG)return f=l0.inflateEnd(this.strm),this.onEnd(f),this.ended=!0,!0;if(i.avail_in===0)break}}return!0},B1.prototype.onData=function(e){this.chunks.push(e)},B1.prototype.onEnd=function(e){e===wP&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=P1.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var ift={inflate:rft};const{deflate:oft}=jpt,{inflate:sft}=ift;var aft=oft,cft=sft,wQ=function(e){return e[e.ONE_BYTE=0]="ONE_BYTE",e[e.TWO_BYTE=1]="TWO_BYTE",e}(wQ||{});class uft{constructor(){Ei(this,"_sequence",0),Ei(this,"_startTime",Date.now()),Ei(this,"isUseOneByte",!0)}get startTime(){const r=Date.now()-this._startTime;return r<Math.pow(2,16)?r:(this._startTime+=Math.pow(2,16),this.startTime)}get sequence(){return this._sequence<Math.pow(2,32)?this._sequence++:(this._sequence-=Math.pow(2,32),this.sequence)}serialize(r){const i={commonPacketHeader:{length:0,reserved:0,extension:0,sequence:this.sequence},commonStreamHeader:this.startTime,extension:void 0,payload:r};if(r.byteLength>128){const b=new Uint8Array(4);b.set([1,0,0,0]);const C={id:0,length:4,data:b.buffer},P={profile:this.isUseOneByte?0:1,length:this.isUseOneByte?5:6,datas:[C]};i.commonPacketHeader.extension=1,i.extension=P,i.payload=this.compress(r),i.commonPacketHeader.length=8+(i.extension.length+2)+i.payload.byteLength}else i.commonPacketHeader.length=8+i.payload.byteLength;_s("SHOW_DATASTREAM2_LOG")&&Wt.debug("send data header: ".concat(JSON.stringify(i.commonPacketHeader)));const d=new ArrayBuffer(i.commonPacketHeader.length),h=new Uint8Array(d),f=new DataView(d);let g=0;if(f.setUint16(g,i.commonPacketHeader.extension<<15|i.commonPacketHeader.reserved<<14|i.commonPacketHeader.length,!0),g+=2,f.setUint32(g,i.commonPacketHeader.sequence,!0),g+=4,f.setUint16(g,i.commonStreamHeader,!0),g+=2,i.extension){const b=this.serializeExtension(i.extension);h.set(new Uint8Array(b),g),g+=b.byteLength}if(h.set(new Uint8Array(i.payload),g),g+=i.payload.byteLength,g!==i.commonPacketHeader.length)throw Error("serialize error!");return d}deserialize(r){if(r.byteLength<4)return new ArrayBuffer(0);const i=new DataView(r);let d=0;const h=i.getUint16(d,!0);d+=2;const f={length:16383&h,reserved:(16384&h)>>14,extension:(32768&h)>>15,sequence:i.getUint16(d+2,!0)<<16|i.getUint16(d,!0)};let g,b;if(d+=4,_s("SHOW_DATASTREAM2_LOG")&&Wt.debug("receive data header: ".concat(JSON.stringify(f))),i.getUint16(d,!0),d+=2,f.extension){b=this.deserializeExtension(r.slice(d)),d+=2+b.length,g=r.slice(d);let C=!1;if(b.datas.length>0){const P=b.datas.find(x=>x.id===0);P&&(C=(1&new DataView(P.data).getUint32(0,!0))==1)}g=C?this.decompress(g):g}else g=r.slice(8);return g}serializeExtension(r){const{profile:i,length:d,datas:h}=r,f=new ArrayBuffer(d+2),g=new Uint8Array(f),b=new DataView(f);let C=0;if(b.setUint8(C++,i),b.setUint8(C++,d),h.forEach(P=>{i?(b.setUint8(C++,P.id),b.setUint8(C++,P.length),g.set(new Uint8Array(P.data),C),C+=P.data.byteLength):(b.setUint8(C++,P.id|P.length<<4),g.set(new Uint8Array(P.data),C),C+=P.data.byteLength)}),C!==d+2)throw Error("serialize extension error, is ".concat(C,"!==").concat(d+2));return f}deserializeExtension(r){const i=new DataView(r);let d=0;const h=i.getUint8(d);d++;const f=i.getUint8(d);d++;const g=h===wQ.TWO_BYTE,b=[],C=new DataView(r,2);let P=0;for(;P<f;){let x=0,H=0,$=new ArrayBuffer(0);g?(x=C.getUint8(P),P++,H=C.getUint8(P),P++):(x=15&C.getUint8(P),H=C.getUint8(P)>>4,P++),H>0&&($=C.buffer.slice(P+2,P+2+H),P+=$.byteLength),b.push({id:x,length:H,data:$})}if(P!==f)throw Error("parse error");return{profile:h,length:f,datas:b}}decompress(r){return cft(new Uint8Array(r))}compress(r){return aft(new Uint8Array(r))}}const dft={name:"DataStream",create:(e,r)=>{const i=r?new glt(e):new vlt(e);return i.useDataStream(new uft),i}};class lft extends qE{constructor(r,i,d){super(),Ei(this,"ws",void 0),Ei(this,"requestId",1),Ei(this,"heartBeatTimer",void 0),Ei(this,"joinInfo",void 0),Ei(this,"clientId",void 0),Ei(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),Ei(this,"onClose",h=>{this.emit("close"),this.dispose()}),Ei(this,"onMessage",h=>{const f=JSON.parse(h.data);if(!f||f.command!=="serverResponse"||!f.requestId)return f&&f.command==="serverStatus"&&f.serverStatus&&f.serverStatus.command?(this.emit("status",f.serverStatus),void this.emit(f.serverStatus.command,f.serverStatus)):void 0;this.emit("req_".concat(f.requestId),f)}),this.joinInfo=r,this.clientId=i,this.ws=new ZN("cross-channel-".concat(this.clientId),d),this.ws.on(Y_.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Y_.CONNECTED,this.onOpen),this.ws.on(Y_.ON_MESSAGE,this.onMessage),this.ws.on(Y_.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(r){const i=this.requestId++;return r.requestId=i,r.seq=i,this.ws.sendMessage(r),i}waitStatus(r){return new T_((i,d)=>{const h=window.setTimeout(()=>{d(new t_(Gi.TIMEOUT,"wait status timeout, status: ".concat(r)))},5e3);this.once(r,f=>{window.clearTimeout(h),f.state&&f.state!==0?d(new t_(Gi.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(r))):i(void 0)}),this.once("dispose",()=>{window.clearTimeout(h),d(new t_(Gi.WS_ABORT))})})}async request(r){if(this.ws.state==="closed")throw new t_(Gi.WS_DISCONNECT);const i=()=>new T_((g,b)=>{this.ws.once(Y_.CLOSED,()=>b(new t_(Gi.WS_ABORT))),this.ws.once(Y_.CONNECTED,g)});this.ws.state!=="connected"&&await i();const d=this.sendMessage(r),h=new T_((g,b)=>{const C=()=>{b(new t_(Gi.WS_ABORT))};this.ws.once(Y_.RECONNECTING,C),this.ws.once(Y_.CLOSED,C),this.once("req_".concat(d),g),mS(3e3).then(()=>{this.removeAllListeners("req_".concat(d)),this.ws.off(Y_.RECONNECTING,C),this.ws.off(Y_.CLOSED,C),b(new t_(Gi.TIMEOUT,"cross channel ws request timeout"))})}),f=await h;if(!f||f.code!==200)throw new t_(Gi.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(f)));return f}async connect(r){this.ws.removeAllListeners(Y_.REQUEST_NEW_URLS),this.ws.on(Y_.REQUEST_NEW_URLS,i=>{i(r)}),await this.ws.init(r)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(r){const i=this.requestId++;return r.requestId=i,this.ws.sendMessage(r),i}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class hft extends qE{set state(r){r!==this._state&&(r!==eT.RELAY_STATE_FAILURE&&(this.errorCode=kO.RELAY_OK),this.emit("state",r,this.errorCode),this._state=r)}get state(){return this._state}constructor(r,i,d,h,f){super(),Ei(this,"joinInfo",void 0),Ei(this,"sid",void 0),Ei(this,"clientId",void 0),Ei(this,"cancelToken",zS.CancelToken.source()),Ei(this,"workerToken",void 0),Ei(this,"requestId",0),Ei(this,"signal",void 0),Ei(this,"prevChannelMediaConfig",void 0),Ei(this,"httpRetryConfig",void 0),Ei(this,"_resolution",void 0),Ei(this,"_state",eT.RELAY_STATE_IDLE),Ei(this,"errorCode",kO.RELAY_OK),Ei(this,"onStatus",g=>{Wt.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(g))),g&&g.command&&(g.command==="onAudioPacketReceived"&&this.emit("event",o0.PACKET_RECEIVED_AUDIO_FROM_SRC),g.command==="onVideoPacketReceived"&&this.emit("event",o0.PACKET_RECEIVED_VIDEO_FROM_SRC),g.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=kO.SRC_TOKEN_EXPIRED,this.state=eT.RELAY_STATE_FAILURE),g.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=kO.DEST_TOKEN_EXPIRED,this.state=eT.RELAY_STATE_FAILURE))}),Ei(this,"onReconnect",async()=>{Wt.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",o0.NETWORK_DISCONNECTED),this.state=eT.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(g=>{this.state!==eT.RELAY_STATE_IDLE&&(Wt.error("auto restart channel media relay failed",g.toString()),this.errorCode=kO.SERVER_CONNECTION_LOST,this.state=eT.RELAY_STATE_FAILURE)})}),this.joinInfo=r,this.clientId=i,this.sid=pI(),this.signal=new lft(this.joinInfo,this.clientId,d),this.httpRetryConfig=h,this._resolution=f}async startChannelMediaRelay(r){if(this.state!==eT.RELAY_STATE_IDLE)throw new t_(Gi.INVALID_OPERATION);this.state=eT.RELAY_STATE_CONNECTING,await this.connect(),Wt.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(r)}catch(i){throw i.data&&i.data.serverResponse&&i.data.serverResponse.command==="SetSourceChannel"?new t_(Gi.CROSS_CHANNEL_FAILED_JOIN_SRC):i.data&&i.data.serverResponse&&i.serverResponse.command==="SetDestChannelStatus"?new t_(Gi.CROSS_CHANNEL_FAILED_JOIN_DEST):i.data&&i.data.serverResponse&&i.serverResponse.command==="StartPacketTransfer"?new t_(Gi.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):i}this.prevChannelMediaConfig=r}async updateChannelMediaRelay(r){if(this.state!==eT.RELAY_STATE_RUNNING)throw new t_(Gi.INVALID_OPERATION);await this.sendUpdateMessage(r),this.prevChannelMediaConfig=r}async setVideoProfile(r){if(this._resolution=r,this.state!==eT.RELAY_STATE_RUNNING)throw new t_(Gi.INVALID_OPERATION);const i=this.genMessage(WS.SetVideoProfile);await this.signal.request(i),Wt.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),Wt.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=eT.RELAY_STATE_IDLE,this.dispose()}dispose(){Wt.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=zS.CancelToken.source(),this.state=eT.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const r=await Rht(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=r.workerToken,await this.signal.connect(r.addressList),this.emit("event",o0.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(r){const i=this.genMessage(WS.StopPacketTransfer);await this.signal.request(i),await this.signal.waitStatus("Normal Quit"),Wt.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const d=this.genMessage(WS.SetSdkProfile,r);await this.signal.request(d),Wt.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const h=this.genMessage(WS.SetSourceChannel,r);await this.signal.request(h),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",o0.PACKET_JOINED_SRC_CHANNEL),Wt.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const f=this.genMessage(WS.SetSourceUserId,r);await this.signal.request(f),Wt.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const g=this.genMessage(WS.SetDestChannel,r);await this.signal.request(g),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",o0.PACKET_JOINED_DEST_CHANNEL),Wt.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const b=this.genMessage(WS.StartPacketTransfer,r);await this.signal.request(b),this.emit("event",o0.PACKET_SENT_TO_DEST_CHANNEL),this.state=eT.RELAY_STATE_RUNNING,Wt.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(r){const i=this.genMessage(WS.UpdateDestChannel,r);await this.signal.request(i),this.emit("event",o0.PACKET_UPDATE_DEST_CHANNEL),Wt.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const r=this.genMessage(WS.StopPacketTransfer);await this.signal.request(r),Wt.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(r,i){const d=[],h=[],f=[];this.requestId+=1;const g={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:AT,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};g.sdkVersion==="4.24.0"&&(g.sdkVersion="0.0.1");let b=null,C=null;switch(r){case WS.SetSdkProfile:return g.clientRequest={command:"SetSdkProfile",type:"multi_channel"},g;case WS.SetSourceChannel:if(C=i&&i.getSrcChannelMediaInfo(),!C)throw new t_(Gi.UNEXPECTED_ERROR,"can not find source config");return g.clientRequest={command:"SetSourceChannel",uid:"0",channelName:C.channelName,token:C.token||this.joinInfo.appId},g;case WS.SetSourceUserId:if(C=i&&i.getSrcChannelMediaInfo(),!C)throw new t_(Gi.UNEXPECTED_ERROR,"can not find source config");return g.clientRequest={command:"SetSourceUserId",uid:C.uid+""},g;case WS.SetDestChannel:if(b=i&&i.getDestChannelMediaInfo(),!b)throw new t_(Gi.UNEXPECTED_ERROR,"can not find dest config");return b.forEach(P=>{d.push(P.channelName),h.push(P.uid+""),f.push(P.token||this.joinInfo.appId)}),g.clientRequest={command:"SetDestChannel",channelName:d,uid:h,token:f},g;case WS.StartPacketTransfer:return g.clientRequest={command:"StartPacketTransfer"},g;case WS.Reconnect:return g.clientRequest={command:"Reconnect"},g;case WS.StopPacketTransfer:return g.clientRequest={command:"StopPacketTransfer"},g;case WS.UpdateDestChannel:if(b=i&&i.getDestChannelMediaInfo(),!b)throw new t_(Gi.UNEXPECTED_ERROR,"can not find dest config");return b.forEach(P=>{d.push(P.channelName),h.push(P.uid+""),f.push(P.token||this.joinInfo.appId)}),g.clientRequest={command:"UpdateDestChannel",channelName:d,uid:h,token:f},g;case WS.SetVideoProfile:g.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return g}}const pft={name:"ChannelMediaRelay",create:function(e){return new hft(e.joinInfo,e.clientId,e.websocketRetryConfig||Mb,e.httpRetryConfig||Mb,e.resolution)}};function CQ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function CP(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?CQ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):CQ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}class fft extends qE{constructor(r,i,d,h){super(),Ei(this,"spec",void 0),Ei(this,"token",void 0),Ei(this,"websocket",void 0),Ei(this,"pingpongTimer",void 0),Ei(this,"reconnectMode","retry"),Ei(this,"serviceMode",void 0),Ei(this,"reqId",0),Ei(this,"commandReqId",0),Ei(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),Ei(this,"handleWebSocketMessage",f=>{if(!f.data)return;const g=JSON.parse(f.data);g.requestId?this.emit("@".concat(g.requestId,"-").concat(g.sid),g):(k_.workerEvent(this.spec.sid,{actionType:"status",serverCode:g.code,workerType:this.serviceMode===i0.TRANSCODE?1:2}),this.emit(O0.PUBLISH_STREAM_STATUS,g))}),this.spec=i,this.token=r,this.serviceMode=h,this.websocket=new ZN("live-streaming",d),this.websocket.on(Y_.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Y_.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Y_.REQUEST_NEW_URLS,(f,g)=>{TS(this,O0.REQUEST_NEW_ADDRESS).then(f).catch(g)}),this.websocket.on(Y_.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(r){return this.websocket.init(r)}async request(r,i,d,h){this.reqId+=1,r==="request"&&(this.commandReqId+=1);const f=this.commandReqId,g=this.reqId;if(!g||!this.websocket)throw new t_(Gi.UNEXPECTED_ERROR);const b=CP({command:r,sdkVersion:AT==="4.24.0"?"0.0.1":AT,seq:g,requestId:g,allocate:d,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},i);if(this.websocket.state==="closed")throw new t_(Gi.WS_DISCONNECT);const C=()=>new T_(($,_t)=>{this.websocket.once(Y_.CLOSED,()=>_t(new t_(Gi.WS_ABORT))),this.websocket.once(Y_.CONNECTED,$)});this.websocket.state!=="connected"&&await C(),b.clientRequest&&(b.clientRequest.workerToken=this.token);const P=new T_(($,_t)=>{const _i=()=>{_t(new t_(Gi.WS_ABORT))};this.websocket.once(Y_.RECONNECTING,_i),this.websocket.once(Y_.CLOSED,_i),this.once("@".concat(g,"-").concat(this.spec.sid),ue=>{$(ue)})});h&&k_.workerEvent(this.spec.sid,CP(CP({},h),{},{requestId:f,actionType:"request",payload:JSON.stringify(i.clientRequest),serverCode:0,code:0}));const x=Date.now();this.websocket.sendMessage(b);let H=null;try{H=await P}catch($){if(this.websocket.state==="closed")throw $;return await C(),await this.request(r,i,d)}return h&&k_.workerEvent(this.spec.sid,CP(CP({},h),{},{requestId:f,actionType:"response",payload:JSON.stringify(H.serverResponse),serverCode:H.code,success:H.code===200,responseTime:Date.now()-x})),H.code!==200&&this.handleResponseError(H),H}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const r=AT==="4.24.0"?"0.0.1":AT;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:r,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(r){switch(r.code){case nS.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void Wt.warning("live stream response already exists stream");case nS.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case nS.LIVE_STREAM_RESPONSE_BAD_STREAM:case nS.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new t_(Gi.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:r.code}).throw();case nS.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(r.serverResponse.command==="UnpublishStream")return;throw new t_(Gi.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case nS.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new t_(Gi.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:r.code}).throw();case nS.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const i=new t_(Gi.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(O0.WARNING,i,r.serverResponse.url)}case nS.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const i=new t_(Gi.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(O0.WARNING,i,r.serverResponse.url)}case nS.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new t_(Gi.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case nS.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new t_(Gi.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:r.code}).throw();case nS.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const i=new t_(Gi.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(O0.WARNING,i,r.serverResponse.url)}case nS.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new t_(Gi.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code}).throw();case nS.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new t_(Gi.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case nS.LIVE_STREAM_RESPONSE_WORKER_LOST:case nS.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(r.serverResponse.command==="UnpublishStream")return;throw new t_(Gi.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case nS.ERROR_FAIL_SEND_MESSAGE:if(r.serverResponse.command==="UnpublishStream")return;if(r.serverResponse.command==="UpdateTranscoding"||r.serverResponse.command==="ControlStream")return new t_(Gi.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:r.code}).throw();throw new t_(Gi.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case nS.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case nS.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case nS.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case nS.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new t_(Gi.LIVE_STREAMING_CDN_ERROR,"",{code:r.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(wL)},6e3)}}function AQ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function nT(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?AQ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):AQ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}class mft extends qE{constructor(r){let i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Mb,d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Mb;super(),Ei(this,"onLiveStreamWarning",void 0),Ei(this,"onLiveStreamError",void 0),Ei(this,"spec",void 0),Ei(this,"retryTimeout",1e4),Ei(this,"connection",void 0),Ei(this,"httpRetryConfig",void 0),Ei(this,"wsRetryConfig",void 0),Ei(this,"streamingTasks",new Map),Ei(this,"isStartingStreamingTask",!1),Ei(this,"taskMutex",new wS("live-streaming")),Ei(this,"cancelToken",zS.CancelToken.source()),Ei(this,"transcodingConfig",void 0),Ei(this,"uapResponse",void 0),Ei(this,"lastTaskId",1),Ei(this,"statusError",new Map),this.spec=r,this.httpRetryConfig=d,this.wsRetryConfig=i}async setTranscodingConfig(r){const i=nT(nT({},nht),r);i.videoCodecProfile!==66&&i.videoCodecProfile!==77&&i.videoCodecProfile!==100&&(Wt.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(i.videoCodecProfile," -> 100")),i.videoCodecProfile=100),i.transcodingUsers||(i.transcodingUsers=i.userConfigs),i.transcodingUsers&&(i.transcodingUsers=i.transcodingUsers.map(g=>nT(nT(nT({},eht),g),{},{zOrder:g.zOrder?g.zOrder+1:1}))),function(g){HE(g.width)||IE(g.width,"config.width",0,1e4),HE(g.height)||IE(g.height,"config.height",0,1e4),HE(g.videoBitrate)||IE(g.videoBitrate,"config.videoBitrate",1,1e6),HE(g.videoFrameRate)||IE(g.videoFrameRate,"config.videoFrameRate"),HE(g.lowLatency)||_R(g.lowLatency,"config.lowLatency"),HE(g.audioSampleRate)||oS(g.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),HE(g.audioBitrate)||IE(g.audioBitrate,"config.audioBitrate",1,128),HE(g.audioChannels)||oS(g.audioChannels,"config.audioChannels",[1,2,3,4,5]),HE(g.videoGop)||IE(g.videoGop,"config.videoGop"),HE(g.videoCodecProfile)||oS(g.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),HE(g.userCount)||IE(g.userCount,"config.userCount",0,17),HE(g.backgroundColor)||IE(g.backgroundColor,"config.backgroundColor",0,16777215),HE(g.userConfigExtraInfo)||fS(g.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),g.transcodingUsers&&!HE(g.transcodingUsers)&&(r0(g.transcodingUsers,"config.transcodingUsers"),g.transcodingUsers.forEach((b,C)=>{XL(b.uid),HE(b.x)||IE(b.x,"transcodingUser[".concat(C,"].x"),0,1e4),HE(b.y)||IE(b.y,"transcodingUser[".concat(C,"].y"),0,1e4),HE(b.width)||IE(b.width,"transcodingUser[".concat(C,"].width"),0,1e4),HE(b.height)||IE(b.height,"transcodingUser[".concat(C,"].height"),0,1e4),HE(b.zOrder)||IE(b.zOrder-1,"transcodingUser[".concat(C,"].zOrder"),0,100),HE(b.alpha)||IE(b.alpha,"transcodingUser[".concat(C,"].alpha"),0,1,!1)})),HE(g.watermark)||qF(g.watermark,"watermark"),HE(g.backgroundImage)||qF(g.backgroundImage,"backgroundImage"),g.images&&!HE(g.images)&&(r0(g.images,"config.images"),g.images.forEach((b,C)=>{qF(b,"images[".concat(C,"]"))}))}(i);const d=[];i.images&&d.push(...i.images.map(g=>nT(nT(nT({},GF),g),{},{zOrder:255}))),i.backgroundImage&&(d.push(nT(nT(nT({},GF),i.backgroundImage),{},{zOrder:0})),delete i.backgroundImage),i.watermark&&(d.push(nT(nT(nT({},GF),i.watermark),{},{zOrder:255})),delete i.watermark),i.images=d,i.transcodingUsers&&(i.userConfigs=i.transcodingUsers.map(g=>nT({},g)),i.userCount=i.transcodingUsers.length,delete i.transcodingUsers);const h=(i.userConfigs||[]).map(g=>typeof g.uid=="number"?T_.resolve(g.uid):$J(g.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await T_.all(h)).forEach((g,b)=>{i.userConfigs&&i.userConfigs[b]&&(i.userConfigs[b].uid=g)}),this.transcodingConfig=i,this.connection)try{var f;const g=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(sT(f=this.streamingTasks).call(f)).map(b=>b.taskId).join("#")});Wt.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(g.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(g){if(!g.data||!g.data.retry)throw g;g.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(b=>{Wt.warning("[".concat(this.spec.clientId,"] live streaming receive error"),g.toString(),"try to republish",b.url),this.startLiveStreamingTask(b.url,b.mode,g).then(()=>{Wt.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(b.url," success"))}).catch(C=>{Wt.error("[".concat(this.spec.clientId,"] live streaming republish failed"),b.url,C.toString()),this.onLiveStreamError&&this.onLiveStreamError(b.url,C)})})}}async startLiveStreamingTask(r,i,d){if(!this.transcodingConfig&&i===i0.TRANSCODE)throw new t_(Gi.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");const h={command:"PublishStream",ts:Date.now(),url:r,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};Wt.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(r,", mode: ").concat(i));const f=await this.taskMutex.lock();if(!this.connection&&d)return void f();if(this.streamingTasks.get(r)&&!d)return f(),new t_(Gi.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(i))}catch(b){throw f(),b}switch(i){case i0.TRANSCODE:h.transcodingConfig=nT({},this.transcodingConfig)}this.uapResponse&&this.uapResponse.vid&&(h.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const g=this.lastTaskId++;try{const b=new T_((P,x)=>{mS(this.retryTimeout).then(()=>{if(d)return x(d);const H=this.statusError.get(r);return H?(this.statusError.delete(r),x(H)):void 0})}),C=await T_.race([this.connection.request("request",{clientRequest:h},!0,{url:r,command:"PublishStream",workerType:i===i0.TRANSCODE?1:2,requestByUser:!d,tid:g.toString()}),b]);this.isStartingStreamingTask=!1,Wt.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(C.code)),this.streamingTasks.set(r,{clientRequest:h,mode:i,url:r,taskId:g}),f()}catch(b){if(f(),this.isStartingStreamingTask=!1,!b.data||!b.data.retry||d)throw b;return b.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(r,i,b)):await this.startLiveStreamingTask(r,i,b)}}stopLiveStreamingTask(r){return new T_((i,d)=>{const h=this.streamingTasks.get(r);if(!h||!this.connection)return new t_(Gi.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const f=h.mode;h.abortTask=()=>{Wt.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(r),i()},this.connection.request("request",{clientRequest:{command:"UnpublishStream",url:h.url}},!1,{url:r,command:"UnPublishStream",workerType:f===i0.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(g=>{Wt.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(g.code)),this.streamingTasks.delete(r),this.streamingTasks.size===0&&(this.connection&&this.connection.close(),this.connection=void 0),i()}).catch(d)})}resetAllTask(){var r;const i=Array.from(sT(r=this.streamingTasks).call(r));this.terminate();for(const d of i)this.startLiveStreamingTask(d.url,d.mode).catch(h=>{this.onLiveStreamError&&this.onLiveStreamError(d.url,h)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=zS.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(r){if(this.connection)throw new t_(Gi.UNEXPECTED_ERROR,"live streaming connection has already connected");const i=await TS(this,WF.REQUEST_WORKER_MANAGER_LIST,r);return this.uapResponse=i,this.connection=new fft(i.workerToken,this.spec,this.wsRetryConfig,r),this.connection.on(O0.WARNING,(d,h)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(h,d)),this.connection.on(O0.PUBLISH_STREAM_STATUS,d=>this.handlePublishStreamServer(d)),this.connection.on(O0.REQUEST_NEW_ADDRESS,(d,h)=>{if(!this.connection)return h(new t_(Gi.UNEXPECTED_ERROR,"can not get new live streaming address list"));TS(this,WF.REQUEST_WORKER_MANAGER_LIST,r).then(f=>{this.uapResponse=f,d(f.addressList)}).catch(h)}),await this.connection.init(i.addressList),this.connection}handlePublishStreamServer(r){const i=r.serverStatus&&r.serverStatus.url||"empty_url",d=this.streamingTasks.get(i),h=r.reason;switch(r.code){case nS.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case nS.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case nS.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case nS.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const g=new t_(Gi.LIVE_STREAMING_CDN_ERROR,"",{code:r.code});if(d)return Wt.error(g.toString()),this.onLiveStreamError&&this.onLiveStreamError(i,g);if(!this.isStartingStreamingTask)return;this.statusError.set(i,g)}case nS.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const g=new t_(Gi.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,h);return this.onLiveStreamWarning&&this.onLiveStreamWarning(i,g)}case nS.LIVE_STREAM_RESPONSE_WORKER_LOST:case nS.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var f;if(!this.connection)return;this.connection.tryNextAddress();const g=Array.from(sT(f=this.streamingTasks).call(f));for(const b of g)b.abortTask?b.abortTask():(Wt.warning("[".concat(this.spec.clientId,"] publish stream status code"),r.code,"try to republish",b.url),this.startLiveStreamingTask(b.url,b.mode,new t_(Gi.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:r.code})).then(()=>{Wt.debug("[".concat(this.spec.clientId,"] republish live stream success"),b.url)}).catch(C=>{Wt.error(C.toString()),this.onLiveStreamError&&this.onLiveStreamError(b.url,C)}));return}}}hasUrl(r){return this.streamingTasks.has(r)}}const _ft={name:"LiveStreaming",create:function(e){return new mft(e.joinInfo,e.websocketRetryConfig||Mb,e.httpRetryConfig||Mb)}};function Eft(e){let r=PQ();return function(i,d){let h=i.appId;h!==void 0&&(yE(d,10),zR(d,h));let f=i.cid;f!==void 0&&(yE(d,16),yE(d,f));let g=i.cname;g!==void 0&&(yE(d,26),zR(d,g));let b=i.deviceId;b!==void 0&&(yE(d,34),zR(d,b));let C=i.elapse;C!==void 0&&(yE(d,40),K0(d,C));let P=i.fileSize;P!==void 0&&(yE(d,48),K0(d,XO(P)));let x=i.height;x!==void 0&&(yE(d,56),K0(d,XO(x)));let H=i.jpg;H!==void 0&&(yE(d,66),yE(d,H.length),function(PS,s_){let __=QO(PS,s_.length);PS.bytes.set(s_,__)}(d,H));let $=i.networkType;$!==void 0&&(yE(d,72),K0(d,XO($)));let _t=i.osType;_t!==void 0&&(yE(d,80),K0(d,XO(_t)));let _i=i.requestId;_i!==void 0&&(yE(d,90),zR(d,_i));let ue=i.sdkVersion;ue!==void 0&&(yE(d,98),zR(d,ue));let _r=i.sequence;_r!==void 0&&(yE(d,104),K0(d,XO(_r)));let Fi=i.sid;Fi!==void 0&&(yE(d,114),zR(d,Fi));let Di=i.timestamp;Di!==void 0&&(yE(d,120),K0(d,Di));let Js=i.uid;Js!==void 0&&(yE(d,128),yE(d,Js));let _l=i.vid;_l!==void 0&&(yE(d,136),yE(d,_l));let _u=i.width;_u!==void 0&&(yE(d,144),K0(d,XO(_u)));let ga=i.service;ga!==void 0&&(yE(d,152),yE(d,ga));let _m=i.callbackData;_m!==void 0&&(yE(d,162),zR(d,_m));let r_=i.jpgEncryption;r_!==void 0&&(yE(d,168),yE(d,r_));let a_=i.requestType;a_!==void 0&&(yE(d,176),yE(d,a_));let p_=i.scorePorn;p_!==void 0&&(yE(d,185),YG(d,p_));let Q_=i.scoreSexy;Q_!==void 0&&(yE(d,193),YG(d,Q_));let $_=i.scoreNeutral;$_!==void 0&&(yE(d,201),YG(d,$_));let F_=i.scene;F_!==void 0&&(yE(d,208),yE(d,F_));let mE=i.ossFilePrefix;mE!==void 0&&(yE(d,218),zR(d,mE));let pE=i.serviceVendor;if(pE!==void 0)for(let PS of pE){yE(d,226);let s_=PQ();bft(PS,s_),yE(d,s_.limit),Rft(d,s_),Tft(s_)}}(e,r),function(i){let d=i.bytes,h=i.limit;return d.length===h?d:d.subarray(0,h)}(r)}function gft(e){return function(i){let d={};t:for(;!DQ(i);){let h=YR(i);switch(h>>>3){case 0:break t;case 1:d.code=YR(i);break;case 2:d.msg=kQ(i,YR(i));break;case 3:{let f=yft(i);d.data=vft(i),i.limit=f;break}default:OQ(i,7&h)}}return d}({bytes:r=e,offset:0,limit:r.length});var r}function vft(e){let r={};t:for(;!DQ(e);){let i=YR(e);switch(i>>>3){case 0:break t;case 1:r.requestId=kQ(e,YR(e));break;case 2:r.requestType=YR(e)>>>0;break;case 3:r.scorePorn=zG(e);break;case 4:r.scoreSexy=zG(e);break;case 5:r.scoreNeutral=zG(e);break;case 6:r.requestScene=YR(e)>>>0;break;case 7:r.scene=YR(e)>>>0;break;default:OQ(e,7&i)}}return r}function bft(e,r){let i=e.service;i!==void 0&&(yE(r,8),yE(r,i));let d=e.vendor;d!==void 0&&(yE(r,16),yE(r,d));let h=e.token;h!==void 0&&(yE(r,26),zR(r,h));let f=e.callbackUrl;f!==void 0&&(yE(r,34),zR(r,f))}function yft(e){let r=YR(e),i=e.limit;return e.limit=e.offset+r,i}function OQ(e,r){switch(r){case 0:for(;128&LQ(e););break;case 2:KG(e,YR(e));break;case 5:KG(e,4);break;case 1:KG(e,8);break;default:throw new Error("Unimplemented type: "+r)}}let Sft=new Float32Array(1);new Uint8Array(Sft.buffer);let WG=new Float64Array(1),rT=new Uint8Array(WG.buffer);function XO(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let NQ=[];function PQ(){const e=NQ.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function Tft(e){NQ.push(e)}function KG(e,r){if(e.offset+r>e.limit)throw new Error("Skip past limit");e.offset+=r}function DQ(e){return e.offset>=e.limit}function QO(e,r){let i=e.bytes,d=e.offset,h=e.limit,f=d+r;if(f>i.length){let g=new Uint8Array(2*f);g.set(i),e.bytes=g}return e.offset=f,f>h&&(e.limit=f),d}function HG(e,r){let i=e.offset;if(i+r>e.limit)throw new Error("Read past limit");return e.offset+=r,i}function kQ(e,r){let i=HG(e,r),d=String.fromCharCode,h=e.bytes,f="�",g="";for(let b=0;b<r;b++){let C,P,x,H,$=h[b+i];128&$?(224&$)==192?b+1>=r?g+=f:(C=h[b+i+1],(192&C)!=128?g+=f:(H=(31&$)<<6|63&C,H<128?g+=f:(g+=d(H),b++))):(240&$)==224?b+2>=r?g+=f:(C=h[b+i+1],P=h[b+i+2],(49344&(C|P<<8))!=32896?g+=f:(H=(15&$)<<12|(63&C)<<6|63&P,H<2048||H>=55296&&H<=57343?g+=f:(g+=d(H),b+=2))):(248&$)==240?b+3>=r?g+=f:(C=h[b+i+1],P=h[b+i+2],x=h[b+i+3],(12632256&(C|P<<8|x<<16))!=8421504?g+=f:(H=(7&$)<<18|(63&C)<<12|(63&P)<<6|63&x,H<65536||H>1114111?g+=f:(H-=65536,g+=d(55296+(H>>10),56320+(1023&H)),b+=3))):g+=f:g+=d($)}return g}function zR(e,r){let i=r.length,d=0;for(let g=0;g<i;g++){let b=r.charCodeAt(g);b>=55296&&b<=56319&&g+1<i&&(b=(b<<10)+r.charCodeAt(++g)-56613888),d+=b<128?1:b<2048?2:b<65536?3:4}yE(e,d);let h=QO(e,d),f=e.bytes;for(let g=0;g<i;g++){let b=r.charCodeAt(g);b>=55296&&b<=56319&&g+1<i&&(b=(b<<10)+r.charCodeAt(++g)-56613888),b<128?f[h++]=b:(b<2048?f[h++]=b>>6&31|192:(b<65536?f[h++]=b>>12&15|224:(f[h++]=b>>18&7|240,f[h++]=b>>12&63|128),f[h++]=b>>6&63|128),f[h++]=63&b|128)}}function Rft(e,r){let i=QO(e,r.limit),d=e.bytes,h=r.bytes;for(let f=0,g=r.limit;f<g;f++)d[f+i]=h[f]}function LQ(e){return e.bytes[HG(e,1)]}function MQ(e,r){let i=QO(e,1);e.bytes[i]=r}function zG(e){let r=HG(e,8),i=e.bytes;return rT[0]=i[r++],rT[1]=i[r++],rT[2]=i[r++],rT[3]=i[r++],rT[4]=i[r++],rT[5]=i[r++],rT[6]=i[r++],rT[7]=i[r++],WG[0]}function YG(e,r){let i=QO(e,8),d=e.bytes;WG[0]=r,d[i++]=rT[0],d[i++]=rT[1],d[i++]=rT[2],d[i++]=rT[3],d[i++]=rT[4],d[i++]=rT[5],d[i++]=rT[6],d[i++]=rT[7]}function YR(e){let r,i=0,d=0;do r=LQ(e),i<32&&(d|=(127&r)<<i),i+=7;while(128&r);return d}function yE(e,r){for(r>>>=0;r>=128;)MQ(e,127&r|128),r>>>=7;MQ(e,r)}function K0(e,r){let i=r.low>>>0,d=(r.low>>>28|r.high<<4)>>>0,h=r.high>>>24,f=h===0?d===0?i<16384?i<128?1:2:i<1<<21?3:4:d<16384?d<128?5:6:d<1<<21?7:8:h<128?9:10,g=QO(e,f),b=e.bytes;switch(f){case 10:b[g+9]=h>>>7&1;case 9:b[g+8]=f!==9?128|h:127&h;case 8:b[g+7]=f!==8?d>>>21|128:d>>>21&127;case 7:b[g+6]=f!==7?d>>>14|128:d>>>14&127;case 6:b[g+5]=f!==6?d>>>7|128:d>>>7&127;case 5:b[g+4]=f!==5?128|d:127&d;case 4:b[g+3]=f!==4?i>>>21|128:i>>>21&127;case 3:b[g+2]=f!==3?i>>>14|128:i>>>14&127;case 2:b[g+1]=f!==2?i>>>7|128:i>>>7&127;case 1:b[g]=f!==1?128|i:127&i}}function xQ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}const Ift=new Map([["moderation",1],["supervise",2]]);class wft extends qE{get connectionState(){return this._connectionState}set connectionState(r){if(this._connectionState===r)return;const i=this._connectionState;this._connectionState=r,this.emit(dS.CONNECTION_STATE_CHANGE,i,r)}get inspectType(){return this._inspectType}set inspectType(r){var i;this._inspectMode=GT(i=r.map(d=>Ift.get(d)||0)).call(i,(d,h)=>d+h),this._inspectType=r}get quality(){return this._quality}set quality(r){this._quality=r>1?1:r<.1?.1:r,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(r){super(),Ei(this,"name","AgoraRTCVideoContentInspect"),Ei(this,"_connectionState",tR.CONNECTING),Ei(this,"_innerConnectionState",void 0),Ei(this,"sequence",0),Ei(this,"inspectStartTime",void 0),Ei(this,"workerManagerConnection",void 0),Ei(this,"workerConnection",void 0),Ei(this,"workerMessageLengthLimit",void 0),Ei(this,"inspectIntervalMinimum",void 0),Ei(this,"qualityRatio",void 0),Ei(this,"_connectInfo",void 0),Ei(this,"_cancelTokenSource",zS.CancelToken.source()),Ei(this,"_retryConfig",void 0),Ei(this,"wmSequence",0),Ei(this,"inspectInterval",void 0),Ei(this,"inspectTimer",null),Ei(this,"ossFilePrefix",void 0),Ei(this,"extraInfo",void 0),Ei(this,"_inspectType",void 0),Ei(this,"_inspectMode",void 0),Ei(this,"_quality",1),Ei(this,"qualityTimer",null),Ei(this,"_inspectId",void 0),Ei(this,"_needWorkUrlOnly",!1),Ei(this,"inspectImage",()=>{if(this.connectionState!==tR.CONNECTED)throw new t_(Gi.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===tR.CONNECTED?this.requestToInspectImage():Wt.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=AE(5,"inspect-"),this.workerMessageLengthLimit=_s("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=_s("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=_s("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=r.interval,this.ossFilePrefix=r.ossFilePrefix,this.extraInfo=r.extraInfo,this.inspectType=r.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new ZN("worker-manager-"+this._inspectId,Mb),this.on(dS.STATE_CHANGE,(i,d)=>{this._innerConnectionState=i,Wt.debug("[".concat(this._inspectId,"] Inspect operation :").concat(eR[i]," ").concat(d||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new ZN("worker-"+this._inspectId,Mb),this.handleWorkerEvents()}async init(r,i){this.emit(dS.STATE_CHANGE,eR.CONNECT_AP),this._connectInfo=r;const d=this._cancelTokenSource.token;return this._retryConfig=i,new T_((h,f)=>{this.on(dS.CONNECTION_STATE_CHANGE,(g,b)=>{b===tR.CONNECTED&&h()}),this.requestAP(r,d,i).then(g=>{this.connectWorkerManager(g)}).catch(g=>{f(g)})})}async requestAP(r,i,d){const h=_s("WEBCS_DOMAIN").map(b=>"https://".concat(b,"/api/v1")),f=await function(b,C,P,x){let{appId:H,areaCode:$,cname:_t,sid:_i,token:ue,uid:_r}=C;FO++;const Fi="image_moderation_api",Di={service_name:Fi,json_body:JSON.stringify({appId:H,areaCode:$,cname:_t,command:"allocateEdge",requestId:FO,seq:FO,sid:_i,token:ue,ts:Date.now(),uid:_r+""})};let Js,_l,_u=b[0];return ER(async()=>{Js=Date.now();const ga=await SR(_u,{data:Di,cancelToken:P,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(_l=Date.now()-Js,ga.code!==0){const p_=new t_(Gi.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ga.code,{retry:!0,responseTime:_l});throw Wt.error(p_.toString()),p_}const _m=JSON.parse(ga.json_body);if(_m.code!==200){const p_=new t_(Gi.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(_m.code,", reason: ").concat(_m.reason),{code:_m.code,responseTime:_l});throw Wt.error(p_.toString()),p_}if(!_m.servers||!Array.isArray(_m.servers)||_m.servers.length===0){const p_=new t_(Gi.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:_m.code,responseTime:_l});throw Wt.error(p_.toString()),p_}const r_=_s("VIDEO_INSPECT_WORKER_MANAGER_HOST"),a_=_s("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:_m.servers.map(p_=>{let{address:Q_,wss:$_}=p_;if(Q_&&$_)return"wss://".concat(Q_.replace(/\./g,"-"),".").concat(r_,":").concat(a_||$_)}).filter(p_=>!!p_),workerToken:_m.workerToken,vid:_m.vid,responseTime:_l}},(ga,_m)=>(k_.apworkerEvent(_i,{success:!0,sc:200,serviceName:Fi,responseDetail:JSON.stringify(ga.addressList),firstSuccess:_m===0,responseTime:_l,serverIp:b[_m%b.length]}),!1),(ga,_m)=>(k_.apworkerEvent(_i,{success:!1,sc:ga.data&&ga.data.code||200,serviceName:Fi,responseTime:_l,serverIp:b[_m%b.length]}),!!(ga.code!==Gi.OPERATION_ABORTED&&ga.code!==Gi.UNEXPECTED_RESPONSE||ga.data&&ga.data.retry)&&(_u=b[(_m+1)%b.length],!0)),x)}(h,r,i,d);this.emit(dS.STATE_CHANGE,eR.AP_CONNECTED);const{addressList:g}=f;return this.wmSequence++,g}async connectWorkerManager(r){let i=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=i,this.emit(dS.STATE_CHANGE,eR.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(r,1e4)}async connectWorker(r){await this.workerConnection.init([r])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Y_.CONNECTED,async()=>{this.emit(dS.STATE_CHANGE,eR.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.24.0",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Y_.CLOSED,()=>{this._innerConnectionState<eR.GET_WORKER_MANAGER_RESPONSE&&Wt.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Y_.FAILED,()=>{this._innerConnectionState<eR.GET_WORKER_MANAGER_RESPONSE&&Wt.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Y_.RECONNECTING,()=>{this._innerConnectionState<eR.GET_WORKER_MANAGER_RESPONSE&&Wt.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Y_.ON_MESSAGE,async r=>{this.emit(dS.STATE_CHANGE,eR.GET_WORKER_MANAGER_RESPONSE);const i=this.workerManagerConnection.url;this.workerManagerConnection.close();const d=JSON.parse(r.data);if(d.code!==200)throw Wt.error("[".concat(this._inspectId,"] Unexpected code ").concat(d.code," from worker manager")),new t_(Gi.UNEXPECTED_RESPONSE,"response code of worker is unexpected",d);if(!(d.serverResponse&&d.serverResponse.portWss&&i))throw Wt.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(d))),new t_(Gi.UNEXPECTED_RESPONSE,"response content of worker is unexpected",d);{const h=_s("VIDEO_INSPECT_WORKER_PORT")||d.serverResponse.portWss,f=i.replace(/:\d+\/?$/,":".concat(h));this.emit(dS.STATE_CHANGE,eR.CONNECT_WORKER,f),this._needWorkUrlOnly?this.emit(dS.REQUEST_NEW_WORKER_URL,f):await this.connectWorker(f)}}),this.workerManagerConnection.on(Y_.WILL_RECONNECT,(r,i,d)=>{d(r)}),this.workerManagerConnection.on(Y_.REQUEST_NEW_URLS,(r,i)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r).catch(i)})}handleWorkerEvents(){this.workerConnection.on(Y_.CONNECTED,async()=>{this.emit(dS.STATE_CHANGE,eR.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=tR.CONNECTED}),this.workerConnection.on(Y_.ON_MESSAGE,async r=>{if(r.data instanceof ArrayBuffer){const d=gft(new Uint8Array(r.data));if(_s("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&Wt.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(d)),d.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(dS.INSPECT_RESULT,void 0,void 0);if(d.data&&d.data.scorePorn&&d.data.scoreSexy&&d.data.scoreNeutral){var i;const h={porn:d.data.scorePorn,sexy:d.data.scoreSexy,neutral:d.data.scoreNeutral},f=GT(i=Object.keys(h)).call(i,(b,C)=>h[b]>h[C]?b:C,"porn"),g=Object.keys(h).find(b=>b===f);this.emit(dS.INSPECT_RESULT,g)}else this.emit(dS.INSPECT_RESULT,void 0,new t_(Gi.UNEXPECTED_RESPONSE,d.code+"","There is an unexpected data on message"))}else this.emit(dS.INSPECT_RESULT,void 0,new t_(Gi.UNEXPECTED_RESPONSE,d.code+"",d.msg))}else Wt.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(dS.INSPECT_RESULT,void 0,new t_(Gi.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Y_.CLOSED,()=>{this.connectionState=tR.CLOSED}),this.workerConnection.on(Y_.FAILED,()=>{this.connectionState=tR.CLOSED}),this.workerConnection.on(Y_.RECONNECTING,()=>{this.connectionState=this.connectionState===tR.CONNECTED?tR.RECONNECTING:tR.CONNECTING}),this.workerConnection.on(Y_.WILL_RECONNECT,(r,i,d)=>{r==="recover"&&d(r),d("tryNext")}),this.workerConnection.on(Y_.REQUEST_NEW_URLS,(r,i)=>{this.workerManagerConnection.close(),this.once(dS.REQUEST_NEW_WORKER_URL,d=>{r([d])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(d=>{this.connectWorkerManager(d,!0)}).catch(d=>{i(d)})})}async requestToInspectImage(){this.sequence++;const r=mT(this,dS.CLIENT_LOCAL_VIDEO_TRACK),i={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(r){if(!r.isPlaying)return void this.emit(dS.INSPECT_RESULT,void 0,new t_(Gi.INVALID_OPERATION,"Only the track being played can be inspected"));const d=await this.generateRequestData(r,i);this.workerConnection.sendMessage(d,!0,!0)}else this.emit(dS.INSPECT_RESULT,void 0,new t_(Gi.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(r,i){let{appId:d,cname:h,cid:f,vid:g,sid:b,uid:C}=i;const P=Date.now(),x=await r.getCurrentFrameImage("image/jpeg",this.quality),H=await _9(x,d,h),$=this.sequence+"-"+f+"-"+C+"-"+P+"-"+AE(12,""),_t={appId:d,cid:f,cname:h,deviceId:"",elapse:(_i=Number(P-this.inspectStartTime),{low:_i|=0,high:_i>>31,unsigned:_i>=0}),fileSize:H.byteLength,jpgEncryption:2,height:x.height,width:x.width,jpg:H,networkType:6,osType:7,requestId:$,sdkVersion:"4.24.0",sequence:this.sequence,sid:b,timestamp:WX(P),uid:C,vid:g,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};var _i;this.extraInfo===void 0&&delete _t.callbackData,this.ossFilePrefix===void 0&&delete _t.ossFilePrefix;const ue=Eft(_t);if(ue.byteLength<this.workerMessageLengthLimit){if(_s("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const _r=function(Fi){for(var Di=1;Di<arguments.length;Di++){var Js=arguments[Di]!=null?arguments[Di]:{};Di%2?xQ(Object(Js),!0).forEach(function(_l){Ei(Fi,_l,Js[_l])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Fi,Object.getOwnPropertyDescriptors(Js)):xQ(Object(Js)).forEach(function(_l){Object.defineProperty(Fi,_l,Object.getOwnPropertyDescriptor(Js,_l))})}return Fi}({},_t);delete _r.jpg,Wt.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(_r))}return ue}{const _r=this.quality*this.qualityRatio;return this.quality=_r,await this.generateRequestData(r,{appId:d,cname:h,cid:f,vid:g,sid:b,uid:C})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=zS.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=tR.CLOSED,this.emit(dS.STATE_CHANGE,eR.CLOSED)}}const Cft={name:"ContentInspect",create:function(e){let{config:r}=e;return function(i){if(!i)throw new t_(Gi.INVALID_PARAMS,"inspectConfig is necessary.");if(!i.inspectType||!Array.isArray(i.inspectType))throw new t_(Gi.INVALID_PARAMS,"inspectConfig.inspectType is necessary and is an instance of Array.");{const d=[...new Set(i.inspectType)];d.forEach(h=>{var f;if(!E_(f=["supervise","moderation"]).call(f,h))throw new t_(Gi.INVALID_PARAMS,"".concat(h," is not a valid inspect type."))}),i.inspectType=d}if(i&&i.extraInfo&&i.extraInfo.length>1024)throw new t_(Gi.INVALID_PARAMS,"inspectConfig.extraInfo length cannot exceed 1024 bytes")}(r),new wft(r)}};var UQ=_(bS.Object.getOwnPropertySymbols),Aft=bE,Oft=cM.indexOf,Nft=kP,JG=i_([].indexOf),VQ=!!JG&&1/JG([1],1,-0)<0;Aft({target:"Array",proto:!0,forced:VQ||!Nft("indexOf")},{indexOf:function(e){var r=arguments.length>1?arguments[1]:void 0;return VQ?JG(this,e,r)||0:Oft(this,e,r)}});var Pft=BT("Array","indexOf"),Dft=_n,kft=Pft,XG=Array.prototype,Lft=function(e){var r=e.indexOf;return e===XG||Dft(XG,e)&&r===XG.indexOf?kft:r},jQ=_(Lft);function Mft(e,r){if(e==null)return{};var i,d,h=function(g,b){if(g==null)return{};var C={};for(var P in g)if({}.hasOwnProperty.call(g,P)){if(jQ(b).call(b,P)!==-1)continue;C[P]=g[P]}return C}(e,r);if(UQ){var f=UQ(e);for(d=0;d<f.length;d++)i=f[d],jQ(r).call(r,i)===-1&&{}.propertyIsEnumerable.call(e,i)&&(h[i]=e[i])}return h}let FQ=class{get localCapabilities(){return BE(this._localCapabilities)}get rtpCapabilities(){return BE(this._rtpCapabilities)}get candidates(){return BE(this._candidates)}get iceParameters(){return BE(this._iceParameters)}get dtlsParameters(){return BE(this._dtlsParameters)}constructor(e){Ei(this,"sessionDesc",void 0),Ei(this,"_localCapabilities",void 0),Ei(this,"_rtpCapabilities",void 0),Ei(this,"_candidates",void 0),Ei(this,"_iceParameters",void 0),Ei(this,"_dtlsParameters",void 0),Ei(this,"setup",void 0),Ei(this,"currentMidIndex",void 0),Ei(this,"cname","o/i14u9pJrxRKAsu"),Ei(this,"firefoxSsrcMidMap",new Map),e=BE(e);const{remoteIceParameters:r,remoteDtlsParameters:i,candidates:d,remoteRTPCapabilities:h,localCapabilities:f,direction:g,setup:b,videoCodec:C,audioCodec:P}=e;let x;this.setup=b,x=g===qS.RECEIVE_ONLY?$S(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`):$S(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=extmap-allow-mixed
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=recvonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`),this._rtpCapabilities=h,this._candidates=d,this._iceParameters=r,this._dtlsParameters=i,this._localCapabilities=f;const H=g===qS.RECEIVE_ONLY?this.rtpCapabilities.send:this.rtpCapabilities.recv,$=g===qS.RECEIVE_ONLY?this._localCapabilities.recv:this._localCapabilities.send,_t=g===qS.RECEIVE_ONLY?h.send.videoCodecs:nP(A_.VIDEO,H,$,C),_i=g===qS.RECEIVE_ONLY?h.send.audioCodecs:nP(A_.AUDIO,H,$,P);for(const ue of x.mediaDescriptions)ue.attributes.iceUfrag=r.iceUfrag,ue.attributes.icePwd=r.icePwd,ue.attributes.fingerprints=i.fingerprints,ue.attributes.candidates=d,ue.attributes.setup=this.setup,ue.media.mediaType==="application"&&(ue.attributes.sctpPort="5000"),ue.media.mediaType==="video"&&(ue.media.fmts=_t.map(_r=>_r.payloadType.toString(10)),ue.attributes.payloads=_t,ue.attributes.extmaps=H.videoExtensions),ue.media.mediaType==="audio"&&(ue.media.fmts=_i.map(_r=>_r.payloadType.toString(10)),ue.attributes.payloads=_i,ue.attributes.extmaps=H.audioExtensions,jO(ue));this.sessionDesc=x,this.currentMidIndex=x.mediaDescriptions.length-1}toString(){return C0(this.sessionDesc)}hasMid(e){return Array.isArray(e)?e.every(r=>this.hasMid(r)):this.sessionDesc.mediaDescriptions.some(r=>r.attributes.mid===e)}send(e,r,i,d,h){i=i.replace(/ /g,"-");const{ssrcs:f,ssrcGroups:g}=eP(r,this.cname,_s("SYNC_GROUP")?i:void 0),b=this.findPreloadMediaDesc(f);if(b){if(KE()&&this.firefoxSsrcMidMap.set(f[0].ssrcId,b.attributes.mid),h&&(h.twcc||h.remb)){const C=this.sessionDesc.mediaDescriptions.indexOf(b);return this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(b,h),{mid:b.attributes.mid,needExchangeSDP:!0}}return{mid:b.attributes.mid,needExchangeSDP:!1}}{const C=this.findAvailableMediaIndex(e,f,d);let P;return C===-1?(P=this.createOrRecycleSendMedia(e,f,g,"sendonly",d,h),this.updateBundleMids()):(P=BE(this.sessionDesc.mediaDescriptions[C]),P.attributes.direction="sendonly",P.attributes.ssrcs=f,P.attributes.ssrcGroups=g,this.sessionDesc.mediaDescriptions[C]=this.mungSendMediaDesc(P,h)),KE()&&this.firefoxSsrcMidMap.set(f[0].ssrcId,P.attributes.mid),{needExchangeSDP:!0,mid:P.attributes.mid}}}stopSending(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>i.attributes.mid&&e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");r.forEach(i=>{i.attributes.ssrcs=[]}),this.updateBundleMids()}receive(e,r,i){const d=[];return e.forEach(h=>{const f=h._mediaStreamTrack.kind,g=this.findAvailableRecvMediaIndex(f);let b,C=!1;g===-1?(C=!0,b=this.createOrRecycleRecvMedia(h,[],"recvonly",r,i),this.updateBundleMids()):(b=BE(this.sessionDesc.mediaDescriptions[g]),b.attributes.direction="recvonly"),d.push({mid:b.attributes.mid,needCreateTransceiver:C})}),d}stopReceiving(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>e.indexOf(i.attributes.mid)!==-1);if(r.length!==e.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");r.forEach(i=>{i.media.port="0",i.attributes.direction="inactive"}),this.updateBundleMids()}addRemoteCandidate(e){const{foundation:r,protocol:i,address:d,port:h,type:f,relatedAddress:g,relatedPort:b,priority:C}=new RTCIceCandidate(e),P={foundation:r??"",componentId:"1",transport:i??"",priority:C?C+"":"",connectionAddress:d??"",port:h?h+"":"",type:f?f+"":"",relAddr:g??"",relPort:b?b+"":"",extension:{}};this.candidates.some(x=>x.priority===P.priority&&x.connectionAddress===P.connectionAddress&&x.port===P.port)||(this._candidates.push(P),this.sessionDesc.mediaDescriptions.forEach(x=>{x.attributes.candidates=this.candidates}))}clearRemoteCandidate(){this._candidates=[],this.sessionDesc.mediaDescriptions[0].attributes.candidates=this._candidates}createOrRecycleRecvMedia(e,r,i,d,h){const f=e._mediaStreamTrack.kind,g=this.rtpCapabilities.recv,b=nP(f,g,this.localCapabilities.send,f===A_.AUDIO?h:d),C=f===A_.VIDEO?g.videoExtensions:g.audioExtensions,P="".concat(++this.currentMidIndex);let x={media:{mediaType:f,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:b.map($=>$.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:C,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:b,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:i,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(P)}};x=this.mungRecvMediaDsec(x,e);const H=this.findFirstClosedMedia(f);if(H){const $=this.sessionDesc.mediaDescriptions.indexOf(H);this.sessionDesc.mediaDescriptions[$]=x}else this.sessionDesc.mediaDescriptions.push(x);return x}muteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>E_(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="inactive"})}unmuteRemote(e){const r=this.sessionDesc.mediaDescriptions.filter(i=>E_(e).call(e,i.attributes.mid||""));if(r.length!==e.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");r.forEach(i=>{i.attributes.direction="recvonly"})}findAvailableMediaIndex(e,r,i){return this.sessionDesc.mediaDescriptions.findIndex(d=>{const h=d.media.mediaType===e&&d.media.port!=="0"&&(d.attributes.direction==="sendonly"||d.attributes.direction==="sendrecv")&&d.attributes.ssrcs.length===0;if(KE()){if(h){const f=this.firefoxSsrcMidMap.get(r[0].ssrcId);return!(f||d.attributes.mid!=="0"&&d.attributes.mid!=="1")||!(!f||f!==d.attributes.mid)}return!1}return h&&d.attributes.mid===i})}findAvailableRecvMediaIndex(e){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const i=r.media.mediaType===e&&r.media.port!=="0"&&(r.attributes.direction==="recvonly"||r.attributes.direction==="sendrecv");return r.attributes.mid!=="0"&&r.attributes.mid!=="1"&&i})}predictReceivingMids(e){const r=[];for(let i=0;i<e;i++)r.push((this.currentMidIndex+i+1).toString(10));return r}restartICE(e){e=BE(e),this._iceParameters=e,this.sessionDesc.mediaDescriptions.forEach(r=>{r.attributes.iceUfrag=e.iceUfrag,r.attributes.icePwd=e.icePwd})}createOrRecycleSendMedia(e,r,i,d,h,f){const g=this.rtpCapabilities.send,b=e===A_.VIDEO?g.videoCodecs:g.audioCodecs,C=e===A_.VIDEO?g.videoExtensions:g.audioExtensions;KE()&&(h="".concat(++this.currentMidIndex));let P={media:{mediaType:e,port:"9",protos:["UDP","TLS","RTP","SAVPF"],fmts:b.map(H=>H.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:[],extmaps:C,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:r,ssrcGroups:i,rtcpFeedbackWildcards:[],payloads:b,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:d,rtcpMux:!0,rtcpRsize:!0,mid:h}};P=this.mungSendMediaDesc(P,f);const x=this.findFirstClosedMedia(e);if(x){const H=this.sessionDesc.mediaDescriptions.indexOf(x);this.sessionDesc.mediaDescriptions[H]=P}else this.sessionDesc.mediaDescriptions.push(P);return P}mungRecvMediaDsec(e,r,i){const d=BE(e);return XF(d),VO(d,r),QF(d,r),kJ(d),i1(d,i,this.localCapabilities.send),d}mungSendMediaDesc(e,r){const i=BE(e);return i1(i,r,this.localCapabilities.recv),jO(i),i}updateRecvMedia(e,r){const i=this.sessionDesc.mediaDescriptions.findIndex(d=>d.attributes.mid===e);if(i!==-1){const d=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[i],r);this.sessionDesc.mediaDescriptions[i]=d}}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(e=>e.media.port!=="0").map(e=>e.attributes.mid)}findPreloadMediaDesc(e){return this.sessionDesc.mediaDescriptions.find(r=>{var i;return((i=r.attributes)===null||i===void 0||(i=i.ssrcs[0])===null||i===void 0?void 0:i.ssrcId)===e[0].ssrcId})}findFirstClosedMedia(e){return this.sessionDesc.mediaDescriptions.find(r=>KE()?r.media.port==="0"&&r.media.mediaType===e:r.media.port==="0")}};const xft=["sdp"];var ME;function BQ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function H0(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?BQ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):BQ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}let GQ=(ME=class $O extends mJ{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var r,i;return(r=(i=this.peerConnection.getReceivers()[0])===null||i===void 0||(i=i.transport)===null||i===void 0?void 0:i.state)!==null&&r!==void 0?r:null}get localCodecs(){return[]}set isInRestartIce(r){this._isInRestartIce=r}get isInRestartIce(){return this._isInRestartIce}constructor(r,i,d){super(r,i),Ei(this,"direction",void 0),Ei(this,"name",void 0),Ei(this,"store",void 0),Ei(this,"spec",void 0),Ei(this,"peerConnection",void 0),Ei(this,"initialOffer",void 0),Ei(this,"transport",void 0),Ei(this,"statsFilter",void 0),Ei(this,"localCandidateCount",0),Ei(this,"_isInRestartIce",!1),Ei(this,"mutex",void 0),Ei(this,"onLocalCandidate",void 0),Ei(this,"remoteSDP",void 0),Ei(this,"pendingCandidates",[]),Ei(this,"localCapabilities",void 0),Ei(this,"isReady",!1),Ei(this,"restartCnt",0),Ei(this,"curTurnServerIndex",0),this.store=i,this.spec=r,this.mutex=new wS("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection($O.resolvePCConfiguration(r,i.p2pTransport),{optional:[{googDscp:!0}]}),this.direction=d??qS.SEND_ONLY,this.name=this.direction===qS.SEND_ONLY?"sendP2PConnection":"recvP2PConnection",this.statsFilter=oF(this.peerConnection,_s("STATS_UPDATE_INTERVAL"),void 0,KE()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1}async establish(r){try{const i=await MJ();if(this.localCapabilities=o1(i),r){const{sdp:d}=r,h=Mft(r,xft),f=function(){const x={audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},H=tP(arguments.length>2?arguments[2]:void 0,arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},"sendonly"),$={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_t={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},_i={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(nR(H,x,"videoExtensions",$,_t,_i),nR(H,x,"videoCodecs",$,_t,_i),nR(H,x,"audioExtensions",$,_t,_i),nR(H,x,"audioCodecs",$,_t,_i),_s("RAISE_H264_BASELINE_PRIORITY")){const ue=_i.videoCodecs.findIndex(_r=>_r.rtpMap&&_r.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&_r.fmtp&&_r.fmtp.parameters["profile-level-id"]==="42001f");if(ue!==-1){const _r=_i.videoCodecs.findIndex(Fi=>Fi.rtpMap&&Fi.rtpMap.encodingName.toLocaleLowerCase()==="h264");if(_r<ue){Wt.debug("raising H264 baseline profile priority");const Fi=_i.videoCodecs[ue];_i.videoCodecs.splice(ue,1),_i.videoCodecs.splice(_r,0,Fi)}_r!==-1&&_s("FILTER_SEND_H264_BASELINE")&&($.videoCodecs=$.videoCodecs.filter(Fi=>!(Fi.rtpMap&&Fi.rtpMap.encodingName.toLocaleLowerCase()==="h264"&&Fi.fmtp&&Fi.fmtp.parameters["profile-level-id"]!=="42001f")))}}return{send:$,recv:_t,sendrecv:_i}}({},{},d);this.remoteSDP=new FQ({remoteIceParameters:h.iceParameters,remoteDtlsParameters:h.dtlsParameters,candidates:[],remoteRTPCapabilities:f,localCapabilities:this.localCapabilities,direction:this.direction,setup:"actpass",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()}),this.isReady=!0;const g=await this.peerConnection.createAnswer();if(!g.sdp)throw new Error("Cannot get answer sdp when trying to establish PeerConnection.");const b=k0(g.sdp);await this.peerConnection.setLocalDescription(g);const C=await xJ({},{},g.sdp);this.localCapabilities=o1(C);const P=this.peerConnection.getTransceivers()[0];return P!=null&&P.receiver&&P.receiver.transport&&this.tryBindTransportEvents(P.receiver.transport),H0(H0({},b),{},{sdp:g.sdp})}{this.peerConnection.addTransceiver("video",{direction:"sendonly"}),this.peerConnection.addTransceiver("audio",{direction:"sendonly"});const d=await this.peerConnection.createOffer();if(!d.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const h=k0(d.sdp);return this.initialOffer=d,H0(H0({},h),{},{sdp:d.sdp})}}catch(i){throw new n_(Gi.GET_LOCAL_CONNECTION_PARAMS_FAILED,i.toString())}}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");await this.peerConnection.setLocalDescription(this.initialOffer);const{sdp:i,iceParameters:d,dtlsParameters:h}=r,f=await xJ({},{},i);this.remoteSDP=new FQ({remoteIceParameters:d,remoteDtlsParameters:h,candidates:[],remoteRTPCapabilities:f,localCapabilities:this.localCapabilities,direction:this.direction,setup:"active",videoCodec:this.store.codec,audioCodec:this.store.audioCodec}),await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()});const g=this.peerConnection.getTransceivers()[0];g!=null&&g.sender&&g.sender.transport&&this.tryBindTransportEvents(g.sender.transport)}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async addRemoteCandidate(r){try{r&&this.pendingCandidates.push(r),this.peerConnection.remoteDescription&&this.isReady&&(this.pendingCandidates.forEach(i=>{this.peerConnection.addIceCandidate(i)}),this.pendingCandidates=[])}catch(i){throw new n_(Gi.ADD_CANDIDATE_FAILED,"P2PConnection.addRemoteCandidate failed; ".concat(i.toString()))}}send(r,i,d){var h=this;return CT(function*(){const f=yield cE(h.mutex.lock("From P2PConnection.send"));try{if(!h.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const g=[],b=h.remoteSDP.receive(r,i,d);r.forEach((_r,Fi)=>{if(b[Fi].needCreateTransceiver){const Di=h.peerConnection.addTransceiver(_r._mediaStreamTrack,{direction:"sendonly"});g.push(Di),_r._updateRtpTransceiver(Di)}else{const Di=h.peerConnection.getTransceivers().find(Js=>Js.mid===b[Fi].mid);if(!Di)throw new Error("cannot find transceiver when sendPeerconnection send, mid is ".concat(b[Fi].mid));g.push(Di),_r._updateRtpTransceiver(Di)}}),KE()&&_s("SIMULCAST")===!0&&(yield cE(h.applySimulcastForFirefox(g,r)));const C=b.map(_r=>_r.mid),P=yield cE(h.peerConnection.createOffer()),x=h.mungSendOfferSDP(P.sdp,r,C),H=$S(x),$=C.map(_r=>{const Fi=H.mediaDescriptions.find(Di=>Di.attributes.mid===_r);if(!Fi)throw new Error("Cannot extract ssrc from mediaDescription.");return NJ(Fi,_s("USE_PUB_RTX"))}),_t=g.map((_r,Fi)=>{const Di=C[Fi];return{localSSRC:$[Fi],id:Di}});yield cE(h.peerConnection.setLocalDescription({type:"offer",sdp:x}));try{yield _t}catch(_r){const Fi=h.remoteSDP.toString();throw yield cE(h.peerConnection.setLocalDescription({type:"offer",sdp:x})),yield cE(h.peerConnection.setRemoteDescription({type:"answer",sdp:Fi})),yield cE(h.stopSending(C,!0)),_r}yield cE(h.applySimulcastEncodings(g,r)),yield cE(h.applySendEncodings(g,r));const _i=h.remoteSDP.toString(),ue=h.logSDPExchange(x,"offer","local","send");return ue==null||ue(_i),yield cE(h.setRemoteDescription({type:"answer",sdp:_i})),g.map((_r,Fi)=>{const Di=C[Fi];return{localSSRC:$[Fi],id:Di}})}catch(g){throw g instanceof n_?g:new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(g.toString()))}finally{f()}})()}async stopSending(r,i){const d=i?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const h=this.peerConnection.getTransceivers().filter(C=>r.indexOf(C.mid)!==-1);if(h.length!==r.length)throw new Error("Transceivers' length (".concat(h.length,") doesn't match mids' length (").concat(r.length,") when trying to call P2PConnection.stopSending."));h.map(C=>{var P;C.direction="inactive",(P=C.stop)===null||P===void 0||P.call(C)});const f=await this.peerConnection.createOffer(),g=this.logSDPExchange(f.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(f),this.remoteSDP.stopReceiving(r);const b=this.remoteSDP.toString();g==null||g(b),await this.setRemoteDescription({type:"answer",sdp:b})}catch(h){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(h.toString()))}finally{d&&d()}}async receive(r,i,d,h){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:f,needExchangeSDP:g}=this.remoteSDP.send(r,i,d,h);if(g){const C=this.remoteSDP.toString(),P=this.logSDPExchange(C,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:C});const x=await this.peerConnection.createAnswer(),H=this.mungReceiveAnswerSDP(x.sdp,f,r);P==null||P(H||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:H}),Wt.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else Wt.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."));const b=this.peerConnection.getTransceivers().find(C=>C.mid===f);if(!b||b.mid===null)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:b.receiver.track,mid:b.mid,transceiver:b}}catch(f){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(f.toString()))}}async mockReceive(r,i,d,h){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{mid:f,needExchangeSDP:g}=this.remoteSDP.send(r,i,d,h);if(g){const b=this.remoteSDP.toString(),C=this.logSDPExchange(b,"offer","remote","receive");await this.setRemoteDescription({type:"offer",sdp:b});const P=await this.peerConnection.createAnswer(),x=this.mungReceiveAnswerSDP(P.sdp,f,r);C==null||C(x||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:x}),Wt.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," by exchanging SDP."))}else Wt.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(r," no need to exchange SDP."))}catch(f){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(f.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString(),d=this.logSDPExchange(i,"offer","remote","stopReceiving");await this.setRemoteDescription({type:"offer",sdp:i});const h=await this.peerConnection.createAnswer();d==null||d(h.sdp||""),await this.peerConnection.setLocalDescription(h)}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async restartICE(r){try{if(this.store.p2pTransport===fI.Auto&&(this.store.p2pTransport=fI.SdRtn,uE().supportPCSetConfiguration&&this.peerConnection.setConfiguration($O.resolvePCConfiguration(this.spec,this.store.p2pTransport))),this.restartCnt>3&&(this.restartCnt=0,uE().supportPCSetConfiguration&&this.peerConnection.setConfiguration($O.resolvePCConfiguration(this.spec,this.store.p2pTransport,++this.curTurnServerIndex))),!r){this.restartCnt++,this.isReady=!1;const i=await this.peerConnection.createOffer({iceRestart:!0});if(!i.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const{iceParameters:d}=k0(i.sdp);return this.store.descriptionStart(),this.direction===qS.SEND_ONLY&&await this.peerConnection.setLocalDescription(i),d}if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");if(this.remoteSDP.restartICE(r),this.store.descriptionStart(),this.direction===qS.RECEIVE_ONLY){this.restartCnt++,await this.setRemoteDescription({type:"offer",sdp:this.remoteSDP.toString()});const i=await this.peerConnection.createAnswer();if(!i.sdp)throw new Error("Cannot get answer sdp when trying to iceRestart.");const{iceParameters:d}=k0(i.sdp);return await this.peerConnection.setLocalDescription(i),d}await this.setRemoteDescription({type:"answer",sdp:this.remoteSDP.toString()}),this.isReady=!0}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}close(){var r;this.peerConnection.close(),this.peerConnection.onicecandidate=null,(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.transport=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const d=await this.peerConnection.createOffer(),h=this.mungSendOfferSDP(d.sdp,[i],[r]);this.remoteSDP.updateRecvMedia(r,i);const f=this.remoteSDP.toString(),g=this.logSDPExchange(h,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),g==null||g(f),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(d){throw new n_(Gi.EXCHANGE_SDP_FAILED,d.toString())}}async updateSendParameters(r,i){const d=this.peerConnection.getTransceivers().filter(h=>h.mid===r);d.length===1&&(this.isVP8Simulcast(i)?KE()||await this.applySimulcastEncodings(d,[i]):await this.applySendEncodings(d,[i]))}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const d=this.peerConnection.getTransceivers().find(h=>h.mid===i);d&&await d.sender.replaceTrack(r._mediaStreamTrack)}async getSelectedCandidatePair(){const r=this.peerConnection.getReceivers();if(r.length>0&&r[0].transport&&r[0].transport.iceTransport&&r[0].transport.iceTransport.getSelectedCandidatePair&&r[0].transport.iceTransport.getSelectedCandidatePair()){const i=r[0].transport.iceTransport,{local:d,remote:h}=i.getSelectedCandidatePair();return{local:H0(H0({},xR),{},{candidateType:d.type,protocol:d.protocol,address:d.address,port:d.port}),remote:H0(H0({},xR),{},{candidateType:h.type,protocol:h.protocol,address:h.address,port:h.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r,i;E_(r=["connected","completed"]).call(r,this.peerConnection.iceConnectionState)&&(this.isReady=!1),(i=this.onICEConnectionStateChange)===null||i===void 0||i.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;this.peerConnection.connectionState==="connected"&&(this.restartCnt=0),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.startICECandidate()}startICECandidate(){this.peerConnection.onicecandidate||(this.localCandidateCount=0,this.peerConnection.onicecandidate=r=>{if(r.candidate){var i;r.candidate.candidate&&((i=this.onLocalCandidate)===null||i===void 0||i.call(this,r.candidate.toJSON())),this.localCandidateCount+=1}else Wt.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount)})}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r,i){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const h={iceServers:[]};var f;return r.iceServers?h.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(jN(r.turnServer.servers)?h.iceServers=r.turnServer.servers:(h.iceServers&&h.iceServers.push(...$O.turnServerConfigToIceServers(r.turnServer.servers,i,d)),_s("USE_TURN_SERVER_OF_GATEWAY")&&h.iceServers&&r.turnServer.serversFromGateway&&h.iceServers.push(...$O.turnServerConfigToIceServers(r.turnServer.serversFromGateway,i,d)),E_(f=[fI.Relay,fI.SdRtn]).call(f,i)&&(h.iceTransportPolicy="relay"),_s("FORCE_TURN_TCP")?h.iceTransportPolicy="relay":r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(g=>{g.forceturn&&(h.iceTransportPolicy="relay")}))),_s("ENABLE_ENCODED_TRANSFORM")&&uE().supportWebRTCEncodedTransform&&(h.encodedInsertableStreams=!0),Wt.debug("P2PConnection p2pTransport is ".concat(i)),h}static turnServerConfigToIceServers(r,i){let d=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;const h=[],f=r.filter(b=>b.tcpport);Wt.debug("P2PConnection turnServers is ".concat(f,", current index is ").concat(d));const g=f.length>d?f[d]:f[0];switch(i){case fI.SdRtn:const b=r.filter(P=>{var x;return E_(x=P.username).call(x,"glb:")&&P.turnServerURL==P.turnServerURL}),C=b.length>d?b[d]:b[0];C&&(h.push({username:C.username,credential:C.password,credentialType:"password",urls:"turn:".concat(P0(C.turnServerURL),":").concat(C.tcpport,"?transport=udp")}),h.push({username:C.username,credential:C.password,credentialType:"password",urls:"turns:".concat(P0(C.turnServerURL),":").concat(C.tcpport,"?transport=tcp")}));break;case fI.Relay:g&&(h.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.tcpport,"?transport=udp")}),h.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(P0(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}));break;default:g&&(h.push({username:g.username,credential:g.password,credentialType:"password",urls:"turn:".concat(g.turnServerURL,":").concat(g.tcpport,"?transport=udp")}),h.push({username:g.username,credential:g.password,credentialType:"password",urls:"turns:".concat(P0(g.turnServerURL),":").concat(g.tcpport,"?transport=tcp")}),h.push({username:g.username,credential:g.password,credentialType:"password",urls:"stun:".concat(g.turnServerURL,":").concat(g.tcpport)}))}return h}tryBindTransportEvents(r){if(r){this.transport=r,r.onstatechange=()=>{var d;r!=null&&r.state&&((d=this.onDTLSTransportStateChange)===null||d===void 0||d.call(this,r.state))},r.onerror=d=>{var h;(h=this.onDTLSTransportError)===null||h===void 0||h.call(this,"error"in d?d.error:d)};const i=r.iceTransport;i&&(i.onstatechange=()=>{const d=r==null?void 0:r.iceTransport.state;var h;d&&((h=this.onICETransportStateChange)===null||h===void 0||h.call(this,d))},i.getSelectedCandidatePair&&(i.onselectedcandidatepairchange=()=>{if(i.getSelectedCandidatePair()){const{local:d,remote:h}=i.getSelectedCandidatePair()||{};if(d&&h){const f=d.address+":"+d.port,g=h.address+":"+h.port;Wt.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify(SI(f)),", remote ").concat(JSON.stringify(SI(g))))}}}))}}tryUnbindTransportEvents(){this.transport&&(this.transport.onstatechange=null,this.transport.onerror=null,this.transport.iceTransport&&(this.transport.iceTransport.onstatechange=null))}async updateRtpSenderEncodings(r,i){var d;if(i||(i=this.peerConnection.getSenders().find(x=>x.track===r._mediaStreamTrack)),!i)return Wt.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(this.isVP8Simulcast(r))return Wt.warn("[updateRtpSenderEncodings] Track is VP8 simulcast, please apply simulcast encodings");if(!uE().supportSetRtpSenderParameters)return Wt.warn("[updateRtpSenderEncodings] Browser not support set rtp-sender parameters");const h={},f={};switch(r._optimizationMode){case"motion":h.degradationPreference="maintain-framerate";break;case"detail":h.degradationPreference="maintain-resolution";break;default:h.degradationPreference="balanced"}if(r._encoderConfig){var g;const{bitrateMax:x,frameRate:H,scaleResolutionDownBy:$}=r._encoderConfig;x&&(f.maxBitrate=1e3*x),E_(g=r._hints).call(g,wE.LOW_STREAM)&&(H&&(f.maxFramerate=dT(H)),$&&$>=1&&(f.scaleResolutionDownBy=$))}if(_s("DSCP_TYPE")&&n0()){var b;const x=_s("DSCP_TYPE");E_(b=["very-low","low","medium","high"]).call(b,x)&&(f.networkPriority=x)}const C=i.getParameters(),P=(d=C.encodings)===null||d===void 0?void 0:d[0];KE()&&!P&&(h.encodings=[f]),P&&Object.assign(P,f),Object.assign(C,h),Wt.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(C.encodings))),await i.setParameters(C)}async applySendEncodings(r,i){try{if(!uE().supportSetRtpSenderParameters||r.length!==i.length)return;for(let d=0;d<r.length;d++){const h=r[d],f=i[d];f instanceof LE&&!this.isVP8Simulcast(f)&&await this.updateRtpSenderEncodings(f,h.sender)}}catch{Wt.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i,d){const h=$S(r);return i.forEach((f,g)=>{const b=d[g],C=h.mediaDescriptions.find(P=>P.attributes.mid===b);C&&(VO(C,f),LJ(C,f,this.store.codec))}),C0(h)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,d)=>{var h;(h=this.onFirstVideoDecoded)===null||h===void 0||h.call(this,r,i,d)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var d;(d=this.onSelectedLocalCandidateChanged)===null||d===void 0||d.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var d;(d=this.onSelectedRemoteCandidateChanged)===null||d===void 0||d.call(this,r,i)},this.statsFilter.onFirstVideoDecodedTimeout=r=>{var i;(i=this.onFirstVideoDecodedTimeout)===null||i===void 0||i.call(this,r)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(r,i){if(r.length===i.length)for(let C=0;C<r.length;C++){var d,h,f,g,b;const P=r[C],x=i[C];if(x instanceof LE&&!E_(d=x._hints).call(d,wE.LOW_STREAM)&&(h=x._encoderConfig)!==null&&h!==void 0&&h.bitrateMax&&((f=x._encoderConfig)===null||f===void 0?void 0:f.bitrateMax)>200&&(g=x._scalabilityMode)!==null&&g!==void 0&&g.numSpatialLayers&&((b=x._scalabilityMode)===null||b===void 0?void 0:b.numSpatialLayers)>1&&this.store.codec==="vp8"){const H={},$={high:1e3*(x._encoderConfig.bitrateMax-50),medium:5e4};H.encodings=[{rid:"m",active:!0,maxBitrate:$.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:$.high}];const _t=P.sender.getParameters();await P.sender.setParameters(Object.assign(_t,H))}}}async applySimulcastEncodings(r,i){if(!KE()&&r.length===i.length)for(let d=0;d<r.length;d++){const h=i[d];if(h instanceof LE&&this.isVP8Simulcast(h)){const f=r[d],g={},b={high:1e3*(h._encoderConfig.bitrateMax-50),medium:5e4};g.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:b.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:b.medium,scaleResolutionDownBy:4}];const C=f.sender.getParameters();await f.sender.setParameters(Object.assign(C,g))}}}isVP8Simulcast(r){var i,d,h,f,g;return!!(r instanceof LE&&_s("SIMULCAST")&&this.store.codec==="vp8"&&!E_(i=r._hints).call(i,wE.LOW_STREAM)&&(d=r._encoderConfig)!==null&&d!==void 0&&d.bitrateMax&&((h=r._encoderConfig)===null||h===void 0?void 0:h.bitrateMax)>200&&(f=r._scalabilityMode)!==null&&f!==void 0&&f.numSpatialLayers&&((g=r._scalabilityMode)===null||g===void 0?void 0:g.numSpatialLayers)>1)}logSDPExchange(r,i,d,h){if(_s("SDP_LOGGING"))return Wt.upload("[".concat(this.store.clientId,"] exchanging ").concat(d," ").concat(i," SDP during P2PConnection.").concat(h,`
`),r),i==="offer"?f=>{this.logSDPExchange(f,"answer",d==="local"?"remote":"local",h)}:void 0}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(g=>g.mid&&r.indexOf(g.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(g=>{g.direction="inactive"});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(d),this.remoteSDP.muteRemote(r);const f=this.remoteSDP.toString();h==null||h(f),await this.setRemoteDescription({type:"answer",sdp:f})}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getTransceivers().filter(g=>g.mid&&r.indexOf(g.mid)!==-1);if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length.");i.map(async g=>{g.direction="sendonly"});const d=await this.peerConnection.createOffer(),h=this.logSDPExchange(d.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(d),this.remoteSDP.unmuteRemote(r);const f=this.remoteSDP.toString();h==null||h(f),await this.setRemoteDescription({type:"answer",sdp:f})}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}async getRemoteSSRC(r,i){var d;if(i=i??((d=this.currentRemoteDescription)===null||d===void 0?void 0:d.sdp)){var h;const f=(h=$S(i).mediaDescriptions.find(g=>g.attributes.mid===r))===null||h===void 0?void 0:h.attributes.ssrcs;return f==null?void 0:f[0].ssrcId}}async setRemoteDescription(r){var i;await this.peerConnection.setRemoteDescription(r),E_(i=["connected","completed"]).call(i,this.peerConnection.iceConnectionState)||(this.isReady=!0,this.addRemoteCandidate())}mungReceiveAnswerSDP(r,i,d){const h=$S(r),f=h.mediaDescriptions.find(g=>g.attributes.mid===i);return f&&d===A_.AUDIO&&f.media.mediaType==="audio"&&jO(f),C0(h)}},D_(ME.prototype,"establish",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"establish"),ME.prototype),D_(ME.prototype,"connect",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"connect"),ME.prototype),D_(ME.prototype,"receive",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"receive"),ME.prototype),D_(ME.prototype,"mockReceive",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"mockReceive"),ME.prototype),D_(ME.prototype,"stopReceiving",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"stopReceiving"),ME.prototype),D_(ME.prototype,"restartICE",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"restartICE"),ME.prototype),D_(ME.prototype,"close",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"close"),ME.prototype),D_(ME.prototype,"updateEncoderConfig",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"updateEncoderConfig"),ME.prototype),D_(ME.prototype,"updateSendParameters",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"updateSendParameters"),ME.prototype),D_(ME.prototype,"replaceTrack",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"replaceTrack"),ME.prototype),D_(ME.prototype,"muteLocal",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"muteLocal"),ME.prototype),D_(ME.prototype,"unmuteLocal",[aR],Object.getOwnPropertyDescriptor(ME.prototype,"unmuteLocal"),ME.prototype),ME);function aR(e,r,i){const d=e[r];if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const h=this.mutex,f=await h.lock("From P2PConnection.".concat(r));try{for(var g=arguments.length,b=new Array(g),C=0;C<g;C++)b[C]=arguments[C];return await d.apply(this,b)}finally{f()}},i}let IR=function(e){return e.SEND_ONLY="SEND_ONLY",e.RECEIVE_ONLY="RECEIVE_ONLY",e}({});var qQ,WQ,KQ,HQ,zQ,YQ,JQ,XQ,QQ,ZQ,$Q,GE;function tZ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function G1(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?tZ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):tZ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}let Uft=(qQ=wR(IR.SEND_ONLY),WQ=wR(IR.SEND_ONLY),KQ=wR(),HQ=wR(IR.RECEIVE_ONLY),zQ=wR(IR.RECEIVE_ONLY),YQ=wR(IR.RECEIVE_ONLY),JQ=wR(IR.RECEIVE_ONLY),XQ=wR(IR.RECEIVE_ONLY),QQ=wR(IR.RECEIVE_ONLY),ZQ=wR(),$Q=wR(IR.RECEIVE_ONLY),GE=class extends qE{get state(){return this._state}set state(e){const r=this._state;this._state=e,this.emit(L_.StateChange,r,this._state)}constructor(e,r){super(),Ei(this,"isPlanB",!1),Ei(this,"store",void 0),Ei(this,"statsUploader",void 0),Ei(this,"sendConnection",void 0),Ei(this,"recvConnection",void 0),Ei(this,"localTrackMap",new Map),Ei(this,"remoteUserMap",new Map),Ei(this,"localDataChannels",[]),Ei(this,"pendingLocalTracks",[]),Ei(this,"pendingRemoteTracks",[]),Ei(this,"statsCollector",void 0),Ei(this,"dtlsFailedCount",0),Ei(this,"sendMutex",void 0),Ei(this,"recvMutex",void 0),Ei(this,"_state",EE.Disconnected),Ei(this,"_restartStates",["disconnected","failed"]),Ei(this,"reconnectInterval",void 0),Ei(this,"uploadUnplinkStarted",!1),Ei(this,"uploadDownlinkStarted",!1),Ei(this,"uplinkStateUploadInterval",void 0),Ei(this,"downlinkStatsUploadInterval",void 0),Ei(this,"handleMuteLocalTrack",async(i,d,h)=>{const f=await this.sendMutex.lock("Locking from P2PChannel2.handleMuteLocalTrack");try{if(!this.sendConnection||this.state!==EE.Connected)return void h(new n_(Gi.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established."));const C=this.filterTobeMutedTracks(i);if(C.length===0)return void d();const P=C.find(_t=>_t[0]==="videoLowTrack");P&&P[1].track._originMediaStreamTrack.stop(),await this.sendConnection.muteLocal(C.map(_t=>{let[,{id:_i}]=_t;return _i}));let x=!1;var g,b;i.trackMediaType==="video"?x=!((g=this.localTrackMap.get(l_.LocalAudioTrack))===null||g===void 0||!g.track._muted):x=((b=this.localTrackMap.get(l_.LocalVideoTrack))===null||b===void 0?void 0:b.id)===void 0;const H=this.createMuteMessage(C);await CE(this,L_.RequestMuteLocal,H);const $=i.trackMediaType==="video"?N0.MUTE_LOCAL_VIDEO:N0.MUTE_LOCAL_AUDIO;await CE(this,L_.RequestP2PMuteLocal,{action:$,message:H,isMuteAll:x}),d()}catch(C){h(C)}finally{f()}}),Ei(this,"handleUnmuteLocalTrack",async(i,d,h)=>{const f=await this.sendMutex.lock("Locking from P2PChannel2.handleUnmuteLocalTrack");try{if(!this.sendConnection||this.state!==EE.Connected)return void h(new n_(Gi.INVALID_OPERATION,"Cannot call P2PChannel2.handleUnmuteLocalTrack before sendConnection established."));const g=this.filterTobeUnmutedTracks(i);if(g.length===0)return void d();await this.sendConnection.unmuteLocal(g.map(P=>{let[,{id:x}]=P;return x}));const b=this.createUnmuteMessage(g),C=i.trackMediaType==="video"?N0.UNMUTE_LOCAL_VIDEO:N0.UNMUTE_LOCAL_AUDIO;await CE(this,L_.RequestP2PMuteLocal,{action:C,message:b}),d()}catch(g){h(g)}finally{f()}}),Ei(this,"handleUpdateVideoEncoder",async(i,d,h,f)=>{let g;typeof f=="boolean"&&f||(g=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoEncoder"));try{const C=this.localTrackMap.get(l_.LocalVideoTrack);if(!this.sendConnection||!C||C.track!==i||this.state!==EE.Connected)return void d();const{id:P,track:x}=C;P&&(await this.sendConnection.updateSendParameters(P,x),await this.sendConnection.updateEncoderConfig(P,x),this.emit(L_.UpdateVideoEncoder,x)),d()}catch(C){h(C)}finally{var b;(b=g)===null||b===void 0||b()}}),Ei(this,"handleUpdateVideoSendParameters",async(i,d,h)=>{const f=await this.sendMutex.lock("Locking from P2PChannel2.handleUpdateVideoSendParameters");try{const g=this.localTrackMap.get(l_.LocalVideoTrack);if(!this.sendConnection||!g||g.track!==i||this.state!==EE.Connected)return void d();const{id:b,track:C}=g;b&&await this.sendConnection.updateSendParameters(b,C),d()}catch(g){h(g)}finally{f()}}),Ei(this,"handleReplaceTrack",async(i,d,h,f)=>{let g;Wt.debug("[".concat(this.store.clientId,"] P2PChannel2 handleReplaceTrack for [track-id-").concat(i.getTrackId(),"]")),typeof f=="boolean"&&f||(g=await this.sendMutex.lock("From P2PChannel2.handleReplaceTrack"));try{var b;const P=Array.from(this.localTrackMap.entries()).find(x=>{let[,{track:H}]=x;return i===H});if(!this.sendConnection||!P||P[1].id===void 0||this.state!==EE.Connected)return void d();if(await((b=this.sendConnection)===null||b===void 0?void 0:b.replaceTrack(i,P[1].id)),P[0]===l_.LocalVideoTrack&&uE().supportDualStreamEncoding){const x=this.localTrackMap.get(l_.LocalVideoLowTrack);if(x){const H=i._mediaStreamTrack.clone();x.track._originMediaStreamTrack.stop(),x.track._mediaStreamTrack=H,x.track._originMediaStreamTrack=H,await new T_(($,_t)=>{this.handleReplaceTrack(x.track,$,_t,!0)})}}d()}catch(P){h(P)}finally{var C;(C=g)===null||C===void 0||C()}}),Ei(this,"handleGetLocalVideoStats",i=>{i(this.statsCollector.getLocalVideoTrackStats())}),Ei(this,"handleGetLocalAudioStats",i=>{i(this.statsCollector.getLocalAudioTrackStats())}),Ei(this,"handleGetRemoteVideoStats",i=>this.statsCollector.getRemoteVideoTrackStats(i.uid)[i.uid]),Ei(this,"handleGetRemoteAudioStats",i=>this.statsCollector.getRemoteAudioTrackStats(i.uid)[i.uid]),this.store=e,this.statsCollector=r,this.statsCollector.addP2PChannel(this),this.statsUploader=new EX(e),this.bindStatsUploaderEvents(),this.sendMutex=new wS("P2PChannel2-send-mutex",e.clientId),this.recvMutex=new wS("P2PChannel2-recv-mutex",e.clientId),this.reconnectInterval=window.setInterval(()=>{[this.sendConnection,this.recvConnection].forEach(i=>{i&&(i.iceConnectionState!=="disconnected"&&i.iceConnectionState!=="failed"||this.handleDisconnect(i.direction))})},_s("ICE_RESTART_INTERVAL"))}async startP2PConnection(e,r){throw new n_(Gi.NOT_SUPPORTED,"p2p mode does not support startP2PConnection.")}async connect(e){throw new n_(Gi.NOT_SUPPORTED,"p2p mode does not support connect.")}async startP2P(e,r){let i;try{if(r){this.recvConnection&&(Wt.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset recvConnection.")),this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection)),i=await this.recvMutex.lock("From P2PChannel.startP2P"),this.recvConnection=new GQ(e,this.store,qS.RECEIVE_ONLY),this.bindConnectionEvents(this.recvConnection);const d=await this.recvConnection.establish(r);return{iceParameters:d.iceParameters,dtlsParameters:d.dtlsParameters,sdp:d.sdp}}{this.state=EE.New,this.sendConnection&&(Wt.warning("[".concat(this.store.clientId,"] P2PChannel.startP2P reset sendConnection.")),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection)),i=await this.sendMutex.lock("From P2PChannel.startP2P"),this.sendConnection=new GQ(e,this.store),this.store.peerConnectionStart(),this.bindConnectionEvents(this.sendConnection);const d=await this.sendConnection.establish();return{iceParameters:d.iceParameters,dtlsParameters:d.dtlsParameters,sdp:d.sdp}}}finally{i&&i()}}async p2pConnect(e){if(!this.sendConnection)throw new n_(Gi.UNEXPECTED_ERROR,"Cannot P2PChannel2.p2pConnect before P2PChannel2.startP2PConnection .");this.store.peerConnectionStart(),await this.sendConnection.connect(e),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=EE.Connected}async addRemoteCandidate(e,r){if(r===qS.RECEIVE_ONLY){if(!this.sendConnection)throw new n_(Gi.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.sendConnection.addRemoteCandidate(e)}else{if(!this.recvConnection)throw new n_(Gi.UNEXPECTED_ERROR,"Cannot P2PChannel2.connect before P2PChannel2.addRemoteCandidate .");await this.recvConnection.addRemoteCandidate(e)}}publish(e,r,i){var d=this;return CT(function*(){const h=yield cE(d.sendMutex.lock("From P2PChannel.publish"));try{if(!d.sendConnection||d.state!==EE.Connected){d.throwIfTrackTypeNotMatch(e);const P=e.filter(x=>d.pendingLocalTracks.indexOf(x)===-1);return void(d.pendingLocalTracks=d.pendingLocalTracks.concat(P))}d.store.pubId=d.store.pubId+1,NS.markPublishStart(d.store.clientId,d.store.pubId);const f=d.filterTobePublishedTracks(e,r,i);if(f.length===0)return void(yield cE(d.tryToUnmuteAudio(e)));f.forEach(P=>{let{track:x,type:H}=P;const $=Date.now();d.store.publish(x.getTrackId(),H===l_.LocalAudioTrack?"audio":"video",$)}),d.bindLocalTrackEvents(f);const g=yield cE(d.sendConnection.send(f.map(P=>{let{track:x}=P;return x}),d.store.codec,d.store.audioCodec)),b=(yield cE(g.next())).value,C=d.createGatewayPublishMessage(f,b);try{yield C}catch(P){throw g.throw(P),(P==null?void 0:P.code)===Gi.WS_ABORT&&f.forEach(x=>{let{track:H}=x;d.pendingLocalTracks.indexOf(H)===-1&&d.pendingLocalTracks.push(H)}),d.unbindLocalTrackEvents(f),P}yield cE(g.next()),f.forEach(P=>{let{type:x}=P;d.statsCollector.addLocalStats(x)}),d.statsUploader.startUploadOutboundStats(),d.assignLocalTracks(f,b),f.forEach(P=>{let{track:x,type:H}=P;const $=Date.now();d.store.publish(x.getTrackId(),H===l_.LocalAudioTrack?"audio":"video",void 0,$)}),d.startUploadUplinkState()}finally{h()}})()}async unpublish(e){if(!this.sendConnection||this.state!==EE.Connected)return void(e.length===0?this.pendingLocalTracks.length=0:this.pendingLocalTracks=this.pendingLocalTracks.filter(h=>!E_(e).call(e,h)));const r=this.filterTobeUnpublishedTracks(e);if(r.length===0)return;const i=r.find(h=>h[0]==="videoLowTrack");i&&i[1].track.close();const d=this.createGatewayUnpublishMessage(r);if(await this.sendConnection.stopSending(r.map(h=>{let[,{id:f}]=h;return f})),this.withdrawLocalTracks(r),this.unbindLocalTrackEvents(r.map(h=>{let[f,{track:g}]=h;return{type:f,track:g}})),r.forEach(h=>{let[f]=h;this.statsCollector.removeLocalStats(f)}),this.localTrackMap.size===0&&(this.statsUploader.stopUploadOutboundStats(),this.stopUploadUplinkState()),this.sendConnection&&this.state===EE.Connected)return i&&i[1].track.close(),d;e.forEach(h=>{const f=this.pendingLocalTracks.indexOf(h);f!==-1&&this.pendingLocalTracks.splice(f,1)})}startUploadUplinkState(){if(this.uploadUnplinkStarted)return;this.uploadUnplinkStarted=!0,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval);const e=()=>{const r=[],i=[];Array.from(this.localTrackMap.entries()).forEach(d=>{let[h,{track:f,ssrcs:g}]=d;const b={stream_type:Oht(f,h),ssrcs:g};f._muted||!f._enabled?r.push(b):i.push(b)}),r.length>0&&r.forEach(d=>{CE(this,L_.RequestMuteLocal,[d])}),i.length>0&&i.forEach(d=>{CE(this,L_.RequestUnmuteLocal,[d])})};e(),this.uplinkStateUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadUplinkState(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStateUploadInterval&&window.clearInterval(this.uplinkStateUploadInterval))}publishLowStream(e){return CT(function*(){throw new n_(Gi.NOT_SUPPORTED,"p2p mode does not support publishLowStream.")})()}async republish(){this.pendingLocalTracks.length>0&&(Wt.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await TS(this,L_.RequestRePublish,this.pendingLocalTracks),this.emit(L_.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async unpublishLowStream(){throw new n_(Gi.NOT_SUPPORTED,"p2p mode does not support unpublishLowStream.")}async subscribe(e,r,i,d){var h;if(!this.recvConnection)throw new n_(Gi.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");if((h=this.remoteUserMap.get(e))!==null&&h!==void 0&&h.has(r))return;const{track:f,mid:g,transceiver:b}=await this.recvConnection.receive(r,[{ssrcId:i}],String(e.uid),d);r===A_.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(f):(e._audioTrack=new NO(f,e.uid,e._uintid,this.store),Wt.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),b&&e._audioTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoSSRC=i,e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(f):(e._videoTrack=new OO(f,e.uid,e._uintid,this.store),Wt.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),b&&e._videoTrack._updateRtpTransceiver(b),this.bindRemoteTrackEvents(e,e._videoTrack));const C=this.remoteUserMap.get(e);C?C.set(r,g):this.remoteUserMap.set(e,new Map([[r,g]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadInboundStats(),this.startUploadDownlinkState();const P=this.pendingRemoteTracks.findIndex(x=>{let{user:H,kind:$}=x;return H.uid===e.uid&&r===$});P!==-1&&(this.pendingRemoteTracks.splice(P,1),this.emit(L_.MediaReconnectEnd,e.uid))}async mockSubscribe(e,r,i,d){if(!this.recvConnection)throw new n_(Gi.INVALID_OPERATION,"Cannot subscribe remote user when recvConnection disconnected.");await this.recvConnection.mockReceive(r,[{ssrcId:i}],String(e.uid),d)}async unsubscribe(e,r,i){const d=this.pendingRemoteTracks.filter(f=>{let{user:g,kind:b}=f;return r!==void 0?g.uid===e.uid&&r===b:g.uid===e.uid});if(d.forEach(f=>{const g=this.pendingRemoteTracks.indexOf(f);this.pendingRemoteTracks.splice(g,1)}),this.recvConnection||i||d.forEach(f=>{let{kind:g}=f;var b;if(g===A_.AUDIO)(b=e._audioTrack)===null||b===void 0||b._destroy(),e._audioTrack=void 0;else if(g===A_.VIDEO){var C;(C=e._videoTrack)===null||C===void 0||C._destroy(),e._videoTrack=void 0}}),!this.recvConnection)return;const h=this.filterTobeUnSubscribedTracks(e,r);h.length!==0&&(await this.recvConnection.stopReceiving(h.map(f=>{let[,{id:g}]=f;return g})),this.withdrawRemoteTracks(h),this.remoteUserMap.size===0&&(this.statsUploader.stopUploadInboundStats(),this.stopUploadDownlinkState()),h.forEach(f=>{let[g,{kind:b}]=f;var C,P;if(b===A_.VIDEO&&g._videoSSRC&&((C=this.recvConnection)===null||C===void 0||C.setStatsRemoteVideoIsReady(g._videoSSRC,!1)),b===A_.VIDEO)this.unbindRemoteTrackEvents(g._videoTrack),i||((P=g._videoTrack)===null||P===void 0||P._destroy(),g._videoTrack=void 0);else if(b===A_.AUDIO){var x;this.unbindRemoteTrackEvents(g._audioTrack),!i&&((x=g._audioTrack)===null||x===void 0||x._destroy(),g._audioTrack=void 0)}}),h.forEach(f=>{let[,{kind:g}]=f;CE(this,L_.RequestP2PMuteRemote,g)}))}startUploadDownlinkState(){if(this.uploadDownlinkStarted)return;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);const e=()=>Array.from(this.remoteUserMap.entries()).forEach(r=>{let[,i]=r;[A_.VIDEO,A_.AUDIO].forEach(d=>{i.has(d)?CE(this,L_.RequestP2PUnmuteRemote,d):CE(this,L_.RequestP2PMuteRemote,d)})});e(),this.downlinkStatsUploadInterval=window.setInterval(()=>{e()},3e3)}stopUploadDownlinkState(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval))}getAllDataChannels(){return this.localDataChannels}async massSubscribe(e){throw new n_(Gi.NOT_SUPPORTED,"p2p mode does not support massSubscribe.")}async massSubscribeNoLock(e){throw new n_(Gi.NOT_SUPPORTED,"p2p mode does not support massSubscribeNoLock.")}async massUnsubscribe(e){throw new n_(Gi.NOT_SUPPORTED,"p2p mode does not support massUnsubscribe.")}async massUnsubscribeNoLock(e){throw new n_(Gi.NOT_SUPPORTED,"p2p mode does not support massUnsubscribeNoLock.")}async muteRemote(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void Wt.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid,"."));if(!i.get(r))return void Wt.warning("[".concat(this.store.clientId,"] P2PChannel2.muteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."));const d=r===A_.VIDEO?e._videoSSRC:e._audioSSRC;d!==void 0&&this.recvConnection.setStatsRemoteVideoIsReady(d,!1)}async unmuteRemote(e,r){return this.unmuteRemoteNoLock(e,r)}async unmuteRemoteNoLock(e,r){if(!this.recvConnection)return;const i=this.remoteUserMap.get(e);if(!i)return void Wt.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid,"."));i.get(r)||Wt.warning("[".concat(this.store.clientId,"] P2PChannel2.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(r,"."))}getAllTracks(e){const r=this.localTrackMap.get(l_.LocalAudioTrack);if((r==null?void 0:r.track)instanceof eS){const i=r.track;return Array.from(this.localTrackMap.entries()).filter(d=>{let[h]=d;return h!==l_.LocalAudioTrack}).filter(d=>{let[h]=d;return!(e&&h===l_.LocalVideoLowTrack)}).map(d=>{let[,{track:h}]=d;return h}).concat(i.trackList)}return Array.from(this.localTrackMap.entries()).filter(i=>{let[d]=i;return!(e&&d===l_.LocalVideoLowTrack)}).map(i=>{let[,{track:d}]=i;return d})}reportPublishEvent(e,r,i,d,h){if(e){const g=this.localTrackMap.get(l_.LocalAudioTrack),b=d?this.localTrackMap.get(l_.LocalVideoLowTrack):this.localTrackMap.get(l_.LocalVideoTrack);k_.publish(this.store.sessionId,{eventElapse:NS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:g==null?void 0:g.track.getTrackLabel(),videoName:b==null?void 0:b.track.getTrackLabel(),screenshare:(b==null?void 0:b.track._hints.indexOf(wE.SCREEN_TRACK))!==-1,audio:!!g,video:!!b,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:h})}else{var f;i||(i=[]);const g=i.find(C=>C instanceof XE),b=d?(f=this.localTrackMap.get(l_.LocalVideoTrack))===null||f===void 0?void 0:f.track:i.find(C=>C instanceof LE);k_.publish(this.store.sessionId,{eventElapse:NS.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:r,audioName:g==null?void 0:g.getTrackLabel(),videoName:b==null?void 0:b.getTrackLabel(),screenshare:(b==null?void 0:b._hints.indexOf(wE.SCREEN_TRACK))!==-1,audio:!!g,video:!!b,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:h})}}reportSubscribeEvent(e,r,i,d){const h=d===A_.VIDEO?i._videoSSRC:i._audioSSRC;h&&k_.subscribe(this.store.sessionId,{succ:e,ec:r,video:d===A_.VIDEO,audio:d===A_.AUDIO,peerid:i.uid,subscribeRequestid:d===A_.VIDEO?i._videoSSRC:i._audioSSRC,p2pid:this.store.p2pId,eventElapse:NS.measureFromSubscribeStart(this.store.clientId,h)})}reset(){Wt.debug("[".concat(this.store.clientId,"] P2PChannel2.reset")),this.sendMutex=new wS("P2PChannel2-send-mutex",this.store.clientId),this.sendMutex=new wS("P2PChannel2-recv-mutex",this.store.clientId),this.sendConnection&&(this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0),this.recvConnection&&(this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(l_.LocalAudioTrack);if((e==null?void 0:e.track)instanceof eS){if(e.track.trackList.length>0){const r=e.track;e.track.trackList.forEach(i=>{r.removeAudioTrack(i)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.reconnectInterval&&(window.clearInterval(this.reconnectInterval),this.reconnectInterval=void 0),this.state=EE.Disconnected}getStats(e){var r,i;return e?(i=this.recvConnection)===null||i===void 0?void 0:i.getStats():(r=this.sendConnection)===null||r===void 0?void 0:r.getStats()}getRemoteVideoIsReady(e){var r;return((r=this.recvConnection)===null||r===void 0?void 0:r.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(l_.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(l_.LocalVideoTrack);if(e)return{width:e.track.videoWidth||0,height:e.track.videoHeight||0}}getEncoderConfig(e){const r=this.localTrackMap.get(e);return r&&r.track instanceof LE||r&&r.track instanceof XE?r.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}async hasRemoteMediaWithLock(e,r){if(!e)return this.remoteUserMap.size>0;const i=this.remoteUserMap.get(e);return!!i&&(!r||i.has(r))}getRemoteMedia(e){var r;const i=Array.from(tT(r=this.remoteUserMap).call(r)).find(d=>d.uid===e);return i?{audioTrack:i.audioTrack,audioSSRC:i._audioSSRC,videoTrack:i.videoTrack,videoSSRC:i._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(i=>{let[d]=i;return{uid:d.uid,level:d.audioTrack?100*d.audioTrack._source.getAccurateVolumeLevel():0}});const r=this.localTrackMap.get(l_.LocalAudioTrack);return r&&e.push({level:100*r.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=nI(e).call(e,(i,d)=>i.level-d.level),e}async disconnectForReconnect(){this.sendConnection&&this.recvConnection&&(Wt.debug("[".concat(this.store.clientId,"] P2PChannel2.disconnectForReconnect closing P2PConnection")),this.state=EE.Reconnecting,_s("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r]=e;var i;r._videoTrack&&r._videoTrack._player&&((i=r._videoTrack._player.getVideoElement())===null||i===void 0||i.pause(),r._videoTrack._player.isKeepLastFrame=!0,r._videoTrack._originMediaStreamTrack.stop())}),this.sendConnection.close(),this.unbindConnectionEvents(this.sendConnection),this.sendConnection=void 0,this.recvConnection.close(),this.unbindConnectionEvents(this.recvConnection),this.recvConnection=void 0,this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{var r;let[i,{track:d}]=e;switch(i){case l_.LocalVideoTrack:E_(r=d._hints).call(r,wE.LOW_STREAM)?d.close():this.pendingLocalTracks.push(d);break;case l_.LocalAudioTrack:d instanceof eS?this.pendingLocalTracks=this.pendingLocalTracks.concat(d.trackList):this.pendingLocalTracks.push(d);case l_.LocalVideoLowTrack:}}),this.emit(L_.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;Array.from(tT(i).call(i)).forEach(d=>{this.setPendingRemoteMedia(r,d)}),this.emit(L_.MediaReconnectStart,r.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.stopUploadUplinkState(),this.stopUploadDownlinkState(),this.statsUploader.stopUploadOutboundStats(),this.statsUploader.stopUploadInboundStats(),this.statsUploader.stopUploadTransportStats(),Wt.debug("[".concat(this.store.clientId,"] P2PChannel2 disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,r){for(const i of this.pendingRemoteTracks){const{user:d,kind:h}=i;if((e instanceof U0?e.uid:e)===d.uid&&r===h)return!0}return!1}setPendingRemoteMedia(e,r){this.hasPendingRemoteMedia(e,r)||this.pendingRemoteTracks.push({user:e,kind:r})}async restartICE(e,r){let i,d;if(e===qS.SEND_ONLY){if(!this.sendConnection)throw new n_(Gi.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before sendConnection established.");i=await this.sendMutex.lock("From P2PChannel.restartICE"),d=this.sendConnection}else{if(!this.recvConnection)throw new n_(Gi.INVALID_OPERATION,"Cannot call P2PChannel2.handleMuteLocalTrack before recvConnection established.");i=await this.recvMutex.lock("From P2PChannel.restartICE"),d=this.recvConnection}try{if(r){const h=await d.restartICE(r);return d.isInRestartIce=!1,h}{const h=await d.restartICE();if(h){const f=await TS(this,L_.RequestP2PRestartICE,{direction:qS.RECEIVE_ONLY,iceParameter:h});await d.restartICE(f),d.isInRestartIce=!1}}}finally{i()}}getUplinkNetworkQuality(){if(!this.sendConnection)return 0;const e=this.sendConnection.getStats(),r=this.localTrackMap.get(l_.LocalVideoTrack),i=this.localTrackMap.get(l_.LocalAudioTrack),d=e.videoSend.find(_t=>{var _i;return _t.ssrc===(r==null||(_i=r.ssrcs)===null||_i===void 0?void 0:_i[0].ssrcId)}),h=e.audioSend.find(_t=>{var _i;return _t.ssrc===(i==null||(_i=i.ssrcs)===null||_i===void 0?void 0:_i[0].ssrcId)});if(!d||!h)return 1;const f=mT(this,L_.NeedSignalRTT),g=d?d.rttMs:void 0,b=h?h.rttMs:void 0,C=g&&b?(g+b)/2:g||b,P=(C&&f?(C+f)/2:C||f)||0,x=100*e.sendPacketLossRate*.7/50+.3*P/1500,H=x<.17?1:x<.36?2:x<.59?3:x<.1?4:5,$=r==null?void 0:r.track;if($&&$._encoderConfig&&$._hints.indexOf(wE.SCREEN_TRACK)===-1){const _t=$._encoderConfig.bitrateMax,_i=e.bitrate.actualEncoded;if(_t&&_i){const ue=(1e3*_t-_i)/(1e3*_t);return aJ[ue<.15?0:ue<.3?1:ue<.45?2:ue<.6?3:4][H]}}return H}getDownlinkNetworkQuality(){if(!this.recvConnection)return 0;const e=this.recvConnection.getStats();let r=0;return Array.from(this.remoteUserMap.entries()).forEach(i=>{let[d]=i;const h=d._audioSSRC,f=d._videoSSRC,g=e.audioRecv.find(_i=>_i.ssrc===h),b=e.videoRecv.find(_i=>_i.ssrc===f);if(!g&&!b)return void(r+=1);const C=mT(this,L_.NeedSignalRTT),P=e.rtt,x=(P&&C?(P+C)/2:P||C)||0,H=g?g.jitterMs:void 0,$=e.recvPacketLossRate;let _t=.7*$*100/50+.3*x/1500;H&&(_t=.6*$*100/50+.2*x/1500+.2*H/400),r+=_t<.1?1:_t<.17?2:_t<.36?3:_t<.59?4:5}),this.remoteUserMap.size>0?Math.round(r/this.remoteUserMap.size):r}async muteLocalTrack(e){return new T_((r,i)=>{this.handleMuteLocalTrack(e,r,i)})}filterTobePublishedTracks(e,r,i){const d=[],h=uE(),f=this.getAllTracks();e=_O(e=e.filter(C=>f.indexOf(C)===-1));let g=!1,b=!1;for(const C of e){if(C instanceof LE&&(this.localTrackMap.has(l_.LocalVideoTrack)||g?new n_(Gi.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(d.push({track:C,type:l_.LocalVideoTrack}),g=!0),r)){const P=this.getLowVideoTrack(C,i);d.push({track:P,type:l_.LocalVideoLowTrack})}if(C instanceof XE){const P=this.localTrackMap.get(l_.LocalAudioTrack);if(P){if(!(P.track instanceof eS))throw new n_(Gi.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(C._bypassWebAudio)throw new n_(Gi.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");P.track.addAudioTrack(C),this.bindLocalAudioTrackEvents(C,!0)}else if(b){const x=d.find(H=>{let{type:$}=H;return $===l_.LocalAudioTrack});if(!(x.track instanceof eS))throw new n_(Gi.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(C._bypassWebAudio)throw new n_(Gi.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");x.track.addAudioTrack(C)}else{if(!h.webAudioMediaStreamDest||C instanceof eS||C._bypassWebAudio)d.push({track:C,type:l_.LocalAudioTrack});else{const x=new eS;x.addAudioTrack(C),d.push({track:x,type:l_.LocalAudioTrack})}b=!0}}}return d}filterTobeUnpublishedTracks(e){const r=[],i=this.getAllTracks();e=_O(e=e.filter(d=>i.indexOf(d)!==-1));for(const d of e){if(d instanceof XE){const h=this.localTrackMap.get(l_.LocalAudioTrack);if(!h)continue;h.track instanceof eS?(h.track.removeAudioTrack(d),this.unbindLocalAudioTrackEvents(d),h.track.trackList.length===0&&(r.push([l_.LocalAudioTrack,h]),h.track.close())):r.push([l_.LocalAudioTrack,h])}if(d instanceof LE){const h=this.localTrackMap.get(l_.LocalVideoTrack);if(!h)continue;r.push([l_.LocalVideoTrack,h]);const f=this.localTrackMap.get(l_.LocalVideoLowTrack);f&&r.push([l_.LocalVideoLowTrack,f])}}return r}bindLocalTrackEvents(e){e.forEach(r=>{let{track:i,type:d}=r;switch(d){case l_.LocalVideoTrack:i.addListener(P_.GET_STATS,this.handleGetLocalVideoStats),i.addListener(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(P_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.addListener(P_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.addListener(P_.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.addListener(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case l_.LocalAudioTrack:this.bindLocalAudioTrackEvents(i);case l_.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,r){e instanceof eS?e.trackList.forEach(i=>{i.addListener(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.addListener(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.addListener(P_.GET_STATS,this.handleGetLocalAudioStats),i.addListener(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.addListener(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(P_.GET_STATS,this.handleGetLocalAudioStats),e.addListener(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),r||e.addListener(P_.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(r=>{let[i,{track:d}]=r;return{track:d,type:i}})),e.forEach(r=>{let{track:i,type:d}=r;switch(d){case l_.LocalVideoTrack:i.off(P_.GET_STATS,this.handleGetLocalVideoStats),i.off(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),i.off(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),i.off(P_.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),i.off(P_.NEED_UPDATE_VIDEO_SEND_PARAMETERS,this.handleUpdateVideoSendParameters),i.off(P_.NEED_REPLACE_TRACK,this.handleReplaceTrack),i.off(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),i.off(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case l_.LocalAudioTrack:this.unbindLocalAudioTrackEvents(i);case l_.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof eS?e.trackList.forEach(r=>{r.off(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),r.off(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),r.off(P_.GET_STATS,this.handleGetLocalAudioStats),r.off(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),r.off(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(P_.GET_STATS,this.handleGetLocalAudioStats),e.off(P_.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(P_.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(P_.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(P_.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(P_.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,r){r instanceof OO&&r.addListener(P_.GET_STATS,i=>{i(this.handleGetRemoteVideoStats(e))}),r instanceof NO&&r.addListener(P_.GET_STATS,i=>{i(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(P_.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[r,i]=e;i.has(A_.AUDIO)&&this.unbindRemoteTrackEvents(r._audioTrack),i.has(A_.VIDEO)&&this.unbindRemoteTrackEvents(r._videoTrack)})}createGatewayPublishMessage(e,r){return e.map((i,d)=>{var h;let f,{track:g,type:b}=i;switch(b){case l_.LocalAudioTrack:f=gE.Audio;break;case l_.LocalVideoTrack:f=E_(h=g._hints).call(h,wE.SCREEN_TRACK)?gE.Screen:gE.High;break;case l_.LocalVideoLowTrack:f=gE.Low}return{kind:b===l_.LocalAudioTrack?A_.AUDIO:A_.VIDEO,stream_type:f,mid:r[d].id,ssrcs:r[d].localSSRC,isMuted:g.muted||!g.enabled}})}createGatewayUnpublishMessage(e){return e.map(r=>{var i;let d,[h,{track:f,ssrcs:g,id:b}]=r;switch(h){case l_.LocalVideoTrack:d=E_(i=f._hints).call(i,wE.SCREEN_TRACK)?gE.Screen:gE.High;break;case l_.LocalAudioTrack:d=gE.Audio;break;case l_.LocalVideoLowTrack:d=gE.Low}return{stream_type:d,ssrcs:g,mid:b}})}assignLocalTracks(e,r){e.forEach((i,d)=>{let{track:h,type:f}=i;this.localTrackMap.set(f,{track:h,id:r[d].id,ssrcs:r[d].localSSRC})})}withdrawLocalTracks(e){e.forEach(r=>{let[i]=r;this.localTrackMap.delete(i)})}bindConnectionEvents(e){e.onConnectionStateChange=async r=>{var i;Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: ").concat(e.name,".onConnectionStateChange(").concat(r,")")),this.emit(L_.PeerConnectionStateChange,r),r!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),r==="connected"&&(e.isInRestartIce=!1),E_(i=this._restartStates).call(i,r)&&!e.isInRestartIce&&(r==="disconnected"&&await mS(800),e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="failed"||this.handleDisconnect(e.direction))},e.onICEConnectionStateChange=r=>{r!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(r,")")),k_.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:r,tag:FE.TRACER}).onSuccess(),this.emit(L_.IceConnectionStateChange,r)},e.onICETransportStateChange=r=>{Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(r,")"))},e.onDTLSTransportStateChange=r=>{Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(r,")"))},e.onDTLSTransportError=r=>{Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(r,")"))},e.onFirstAudioDecoded=r=>{var i;const d=Array.from(tT(i=this.remoteUserMap).call(i)).find(f=>f._audioSSRC===r);var h;d&&(this.store.subscribe(d.uid,"audio",void 0,void 0,void 0,Date.now()),(h=d.audioTrack)===null||h===void 0||h.emit(NT.FIRST_FRAME_DECODED),k_.firstRemoteFrame(this.store.sessionId,sS.FIRST_AUDIO_DECODE,jE.FIRST_AUDIO_DECODE,{peer:d._uintid,subscribeElapse:NS.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=r=>{var i;const d=Array.from(tT(i=this.remoteUserMap).call(i)).find(h=>h._audioSSRC===r);d&&k_.firstRemoteFrame(this.store.sessionId,sS.FIRST_AUDIO_RECEIVED,jE.FIRST_AUDIO_RECEIVED,{peer:d._uintid,subscribeElapse:NS.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(r,i,d)=>{this.reportVideoFirstFrameDecoded(r,i,d)},e.onFirstVideoReceived=r=>{var i;const d=Array.from(tT(i=this.remoteUserMap).call(i)).find(h=>h._videoSSRC===r);d&&k_.firstRemoteFrame(this.store.sessionId,sS.FIRST_VIDEO_RECEIVED,jE.FIRST_VIDEO_RECEIVED,{peer:d._uintid,subscribeElapse:NS.measureFromSubscribeStart(this.store.clientId,r),subscribeRequestid:r,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(r,i)=>{const d=r.candidateType==="relay",h=i.candidateType==="relay";i.candidateType!=="unknown"&&d===h||this.emit(L_.ConnectionTypeChange,d),Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(D0(i))," -> ").concat(JSON.stringify(D0(r)),")"))},e.onSelectedRemoteCandidateChanged=(r,i)=>{Wt.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(D0(i))," -> ").concat(JSON.stringify(D0(r)),")"))},e.onFirstVideoDecodedTimeout=r=>{this.reportVideoFirstFrameDecoded(r,void 0,void 0,!0)},e.onLocalCandidate=r=>{this.emit(L_.LocalCandidate,{candidate:r,direction:e.direction})}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0,e.onLocalCandidate=void 0}async handleDisconnect(e){const r=e===qS.SEND_ONLY?this.sendConnection:this.recvConnection;r&&!r.isInRestartIce&&(r.isInRestartIce=!0,Wt.debug("[".concat(this.store.clientId,"] [P2PChannel-").concat(r.name,"] start use restartICE")),e===qS.SEND_ONLY?this.restartICE(e):TS(this,L_.RequestP2PRestartICE,{direction:qS.SEND_ONLY}))}filterTobeMutedTracks(e){const r=[];if(this.getAllTracks().indexOf(e)===-1)return r;const i=this.localTrackMap.get(l_.LocalAudioTrack);if(e instanceof XE&&(i==null?void 0:i.track)instanceof eS)return i.track.isActive||r.push([l_.LocalAudioTrack,i]),r;const d=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:f}]=h;return e===f});if(d&&(r.push(d),d[0]===l_.LocalVideoTrack)){const h=this.localTrackMap.get(l_.LocalVideoLowTrack);h&&r.push([l_.LocalVideoLowTrack,h])}return r}filterTobeUnmutedTracks(e){const r=[],i=this.localTrackMap.get(l_.LocalAudioTrack);if(e instanceof XE&&(i==null?void 0:i.track)instanceof eS)return i.track.isActive&&r.push([l_.LocalAudioTrack,i]),r;const d=Array.from(this.localTrackMap.entries()).find(h=>{let[,{track:f}]=h;return e===f});if(d)if(d[0]===l_.LocalVideoTrack){r.push(d);const h=this.localTrackMap.get(l_.LocalVideoLowTrack);h&&r.push([l_.LocalVideoLowTrack,h])}else r.push(d);return r}createMuteMessage(e){return e.map(r=>{var i;let d,[h,{track:f,ssrcs:g,id:b}]=r;switch(h){case l_.LocalAudioTrack:d=gE.Audio;break;case l_.LocalVideoTrack:d=E_(i=f._hints).call(i,wE.SCREEN_TRACK)?gE.Screen:gE.High;break;case l_.LocalVideoLowTrack:d=gE.Low}return{stream_type:d,ssrcs:g,mid:b}})}createUnmuteMessage(e){return e.map(r=>{var i;let d,[h,{track:f,ssrcs:g,id:b}]=r;switch(h){case l_.LocalAudioTrack:d=gE.Audio;break;case l_.LocalVideoTrack:d=E_(i=f._hints).call(i,wE.SCREEN_TRACK)?gE.Screen:gE.High;break;case l_.LocalVideoLowTrack:d=gE.Low}return{stream_type:d,ssrcs:g,mid:b}})}filterTobeUnSubscribedTracks(e,r){const i=[],d=this.remoteUserMap.get(e);if(!d)return i;if(r){const h=d.get(r);if(!h)return i;i.push([e,{kind:r,id:h}])}else Array.from(d.entries()).forEach(h=>{let[f,g]=h;i.push([e,{kind:f,id:g}])});return i}createUnsubscribeMessage(e){const r=[];return e.forEach(i=>{let[d,{kind:h,id:f}]=i;switch(h){case A_.VIDEO:return void(d._videoSSRC&&r.push({stream_type:A_.VIDEO,ssrcId:d._videoSSRC}));case A_.AUDIO:return void(d._audioSSRC&&r.push({stream_type:A_.AUDIO,ssrcId:d._audioSSRC}))}}),r}withdrawRemoteTracks(e){e.forEach(r=>{let[i,{kind:d}]=r;const h=this.remoteUserMap.get(i);h&&(h.delete(d),Array.from(h.entries()).length===0&&this.remoteUserMap.delete(i))})}async updateBitrateLimit(e){const r=this.localTrackMap.get(l_.LocalVideoTrack),i=this.localTrackMap.get(l_.LocalVideoLowTrack);r&&(await r.track.setBitrateLimit(e.uplink),await new T_((d,h)=>{this.handleUpdateVideoEncoder(r.track,d,h,!0)})),i&&e.low_stream_uplink&&(await i.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0}),await new T_((d,h)=>{this.handleUpdateVideoEncoder(i.track,d,h,!0)}))}isP2PDisconnected(){if(this.sendConnection&&this.recvConnection){const e=this.sendConnection.peerConnectionState,r=this.recvConnection.peerConnectionState;return e!=="connected"&&r!=="connected"}return!0}async tryToUnmuteAudio(e){for(let r=0;r<e.length;r++)if(e[r]instanceof XE){const i=this.filterTobeUnmutedTracks(e[r]);if(i.length===0)continue;const d=this.createUnmuteMessage(i);return void await CE(this,L_.RequestUnmuteLocal,d)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=e=>this.getStats(e),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()).filter(e=>{let[,{ssrcs:r}]=e;return!!r}),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var r;return!((r=this.recvConnection)===null||r===void 0||!r.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,r)=>this.emit(L_.RequestUpload,e,r),this.statsUploader.requestUploadStats=e=>this.emit(L_.RequestUploadStats,e),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await mS($j(this.dtlsFailedCount,Mb)),this.emit(L_.RequestReconnect)}async reconnectP2P(){}canPublishLowStream(){return this.localTrackMap.has(l_.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof LE)}throwIfTrackTypeNotMatch(e){if(e.filter(r=>r instanceof LE).length>1)throw new n_(Gi.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(r=>r instanceof XE).length>1&&(e.some(r=>r instanceof XE&&r._bypassWebAudio)||!uE().webAudioMediaStreamDest))throw new n_(Gi.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const r of e){if(r instanceof LE&&this.pendingLocalTracks.some(i=>i instanceof LE))throw new n_(Gi.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(r instanceof XE&&this.pendingLocalTracks.some(i=>i instanceof XE)&&(!uE().webAudioMediaStreamDest||r._bypassWebAudio||this.pendingLocalTracks.some(i=>i instanceof XE&&i._bypassWebAudio)))throw new n_(Gi.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,r){const i=!_s("DISABLE_DUAL_STREAM_USE_ENCODING")&&uE().supportDualStreamEncoding,d=G1(G1({},{width:160,height:120,framerate:15,bitrate:50}),r);let h;h=i?e._mediaStreamTrack.clone():fG(e,d);const f=AE(8,"track-low-"),g=new LE(h,G1(G1({},i&&{scaleResolutionDownBy:JF(d,e)}),{},{frameRate:d.framerate,bitrateMax:d.bitrate,bitrateMin:d.bitrate}),void 0,void 0,f);return g.on(mI.TRANSCEIVER_UPDATED,b=>{e._updateRtpTransceiver(b,TO.LOW_STREAM)}),g._hints.push(wE.LOW_STREAM),e.addListener(P_.NEED_CLOSE,()=>{g.close()}),g}async globalLock(){return this.recvMutex.lock("From P2PChannel2.globalLock")}reportVideoFirstFrameDecoded(e,r,i,d){var h;const f=Array.from(tT(h=this.remoteUserMap).call(h)).find(g=>g._videoSSRC===e);if(f){d||this.store.subscribe(f.uid,"video",void 0,void 0,void 0,void 0,Date.now());const g=this.store.keyMetrics,b=g.subscribe.find(C=>C.userId===f.uid&&C.type==="video");k_.firstRemoteVideoDecode(this.store.sessionId,sS.FIRST_VIDEO_DECODE,jE.FIRST_VIDEO_DECODE,{peer:f._uintid,videowidth:r,videoheight:i,subscribeElapse:NS.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:g.requestAPEnd||0,apStart:g.requestAPStart||0,joinGwEnd:g.joinGatewayEnd||0,joinGwStart:g.joinGatewayStart||0,pcEnd:g.peerConnectionEnd||0,pcStart:g.peerConnectionStart||0,subscriberEnd:(b==null?void 0:b.subscribeEnd)||0,subscriberStart:(b==null?void 0:b.subscribeStart)||0,videoAddNotify:(b==null?void 0:b.streamAdded)||0,state:d?1:0})}}async remoteMediaSsrcChanged(e,r,i){if(!this.recvConnection)return!1;const d=this.remoteUserMap.get(e);if(!d)return!1;const h=d.get(r);if(!h)return!1;const f=await this.recvConnection.getRemoteSSRC(h);return f!==void 0&&f!==i}isPreSubScribe(e){return!1}async publishDataChannel(e){throw new n_(Gi.NOT_SUPPORTED)}async unpublishDataChannel(e){throw new n_(Gi.NOT_SUPPORTED)}async subscribeDataChannel(e,r){throw new n_(Gi.NOT_SUPPORTED)}async unsubscribeDataChannel(e,r){throw new n_(Gi.NOT_SUPPORTED)}hasPendingRemoteDataChannel(e,r){throw new n_(Gi.NOT_SUPPORTED)}setPendingRemoteDataChannel(e,r){throw new n_(Gi.NOT_SUPPORTED)}async preConnect(e){throw new n_(Gi.NOT_SUPPORTED)}getEstablishParams(){throw new n_(Gi.NOT_SUPPORTED)}async reSubscribe(e){throw new n_(Gi.NOT_SUPPORTED)}reportVideoFirstFrameRender(e){}async updateVideoStreamParameter(e,r){throw new n_(Gi.NOT_SUPPORTED)}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[r,{track:i}]=e;r===l_.LocalVideoLowTrack?i._updateRtpTransceiver(void 0,TO.LOW_STREAM):i._updateRtpTransceiver(void 0)})}},D_(GE.prototype,"p2pConnect",[qQ],Object.getOwnPropertyDescriptor(GE.prototype,"p2pConnect"),GE.prototype),D_(GE.prototype,"unpublish",[WQ],Object.getOwnPropertyDescriptor(GE.prototype,"unpublish"),GE.prototype),D_(GE.prototype,"unpublishLowStream",[KQ],Object.getOwnPropertyDescriptor(GE.prototype,"unpublishLowStream"),GE.prototype),D_(GE.prototype,"subscribe",[HQ],Object.getOwnPropertyDescriptor(GE.prototype,"subscribe"),GE.prototype),D_(GE.prototype,"mockSubscribe",[zQ],Object.getOwnPropertyDescriptor(GE.prototype,"mockSubscribe"),GE.prototype),D_(GE.prototype,"unsubscribe",[YQ],Object.getOwnPropertyDescriptor(GE.prototype,"unsubscribe"),GE.prototype),D_(GE.prototype,"muteRemote",[JQ],Object.getOwnPropertyDescriptor(GE.prototype,"muteRemote"),GE.prototype),D_(GE.prototype,"unmuteRemote",[XQ],Object.getOwnPropertyDescriptor(GE.prototype,"unmuteRemote"),GE.prototype),D_(GE.prototype,"hasRemoteMediaWithLock",[QQ],Object.getOwnPropertyDescriptor(GE.prototype,"hasRemoteMediaWithLock"),GE.prototype),D_(GE.prototype,"disconnectForReconnect",[ZQ],Object.getOwnPropertyDescriptor(GE.prototype,"disconnectForReconnect"),GE.prototype),D_(GE.prototype,"remoteMediaSsrcChanged",[$Q],Object.getOwnPropertyDescriptor(GE.prototype,"remoteMediaSsrcChanged"),GE.prototype),GE);function wR(e){return function(r,i,d){const h=r[i];if(typeof h!="function")throw new Error("Cannot use mutex on object property.");return d.value=async function(){for(var f=arguments.length,g=new Array(f),b=0;b<f;b++)g[b]=arguments[b];switch(e){case IR.SEND_ONLY:{const C=await this.sendMutex.lock("From P2PChannel2.".concat(i));try{return await h.apply(this,g)}finally{C()}}case IR.RECEIVE_ONLY:{const C=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await h.apply(this,g)}finally{C()}}default:{const C=await this.sendMutex.lock("From P2PChannel2.".concat(i)),P=await this.recvMutex.lock("From P2PChannel2.".concat(i));try{return await h.apply(this,g)}finally{C(),P()}}}},d}}class kI extends qE{constructor(r,i){super(),Ei(this,"signal",void 0),Ei(this,"token",void 0),Ei(this,"tokenTimeout",void 0),Ei(this,"tokenInterval",void 0),Ei(this,"_sequence",0),Ei(this,"userMap",new Map),Ei(this,"encoder",new TextEncoder),this.signal=r,this.token=i;const d=()=>{this.signal.connectionState===kE.CONNECTED&&this.check(),this.userMap.size===0?this.tokenInterval=window.setTimeout(d,1e3):this.tokenInterval=window.setTimeout(d,3*_s("P2P_TOKEN_INTERVAL"))};d()}async send(r,i,d,h,f){var g;if(this.userMap.size===0)return;const b=Array.from(sT(g=this.userMap).call(g))[0].token;typeof i!="string"&&(i=JSON.stringify(i)),h=h??AE(6,""),f=f??this._sequence++;const C={_id:h,_type:r,_seq:f,_message:i,token:"".concat(this.token,"_").concat(b)};_s("SHOW_P2P_LOG")&&Wt.debug("send message",C,"noNeedResponse : ".concat(d)),this.splitMessage(JSON.stringify(C)).forEach(x=>{this.signal.request(j_.DATA_STREAM,{payload:w0(this.encoder.encode(x))})});const P=new T_((x,H)=>{const $=window.setTimeout(()=>{this.off("res-@".concat(h,"_ack"),_t),this.off("res-@".concat(h),ue),this.off(MO.ABORT,_i),Wt.debug("[external-signal] request timeout, type: ".concat(r,", requestId: ").concat(h)),this.userMap.size===0?H(new n_(Gi.INVALID_REMOTE_USER)):H(new n_(Gi.TIMEOUT))},_s("EXTERNAL_SIGNAL_REQUEST_TIMEOUT")),_t=()=>{$&&window.clearTimeout($),this.off(MO.ABORT,_i),d&&x()},_i=()=>{$&&window.clearTimeout($),this.off("res-@".concat(h,"_ack"),_t),this.off("res-@".concat(h),ue),H(new n_(Gi.EXTERNAL_SIGNAL_ABORT,"type: ".concat(r,", requestId: ").concat(h)))};this.once(MO.ABORT,_i),this.once("res-@".concat(h,"_ack"),_t);const ue=(Fi,Di)=>{_r=!0,$&&window.clearTimeout($),this.off("res-@".concat(h,"_ack"),_t),this.off(MO.ABORT,_i),Fi==="success"?x(Di):H(new n_(Gi.P2P_MESSAGE_FAILED,"request ".concat(r," failed, requestId: ").concat(h)))};let _r=!1;d||(this.once("res-@".concat(h),ue),mS(_s("SIGNAL_REQUEST_TIMEOUT")).then(()=>{_r||Wt.warning("external_signal request timeout, type: ".concat(r,", requestId: ").concat(h,", ").concat(C))}))});try{return await P}catch(x){if(x.code===Gi.TIMEOUT)return await this.send(r,i,d,h,f);throw x}}onMessage(r){var i;const{_uid:d}=r;let h,f=this.userMap.get(d);if(f)h=f.splitMessageMap;else{if(this.userMap.size>0||!("_type"in r)||r._type!==$E.CHECK)return;const{token:P}=r;h=new Map,f={uid:d,isStart:!0,token:P,splitMessageMap:h,nextExpectedSequenceNumber:0,receivedMessagesMap:new Map},this.userMap.set(d,f),this.signal.emit(rE.ON_USER_ONLINE,{uid:d}),this.handleUserOnline()}if("id"in r&&"total"in r){var g;const{id:P,total:x}=r,H=(g=h.get(P))!==null&&g!==void 0?g:[];if(H.push(r),h.has(P)||h.set(P,H),H.length!==x)return;{const $=nI(H).call(H,(_t,_i)=>_t.index-_i.index).map(_t=>_t.payload).join("");h.delete(P),(r=JSON.parse($))._uid=d}}const{_type:b,token:C}=r;if(E_(i=[$E.ACK,$E.CHECK]).call(i,b))return b===$E.CHECK&&this.handleCheckToken(f,C),void this.receiveMessage(r);C==="".concat(f.token,"_").concat(this.token)?this.handleReceivedMessage(r):Wt.debug('Receive unexpected message", '.concat(C,", cur_token: ").concat(f.token,"_").concat(this.token),r)}check(){const r={_id:AE(6,""),token:this.token,_type:$E.CHECK};_s("SHOW_P2P_LOG")&&Wt.debug("send message",r),this.signal.request(j_.DATA_STREAM,{payload:w0(this.encoder.encode(JSON.stringify(r)))})}ack(r){const i={_id:r,_type:$E.ACK,token:this.token};_s("SHOW_P2P_LOG")&&Wt.debug("send message",i),this.signal.request(j_.DATA_STREAM,{payload:w0(this.encoder.encode(JSON.stringify(i)))})}response(r,i,d){this.send($E.RESPONSE,JSON.stringify({success:!d,message:i}),!0,r)}handleReceivedMessage(r){const i=()=>{this.userMap.forEach(P=>{const{receivedMessagesMap:x,nextExpectedSequenceNumber:H}=P;for(;x.has(H);){const $=x.get(H);x.delete(H),this.receiveMessage($),P.nextExpectedSequenceNumber++}})};if(!r)return void i();const{_uid:d,_seq:h}=r,f=this.userMap.get(d),{receivedMessagesMap:g,isStart:b,nextExpectedSequenceNumber:C}=f;if(h<C)return this.ack(r._id),void Wt.debug("[external-signal] receive old message, seq: ".concat(h,", ").concat(r._message));g.set(h,r),b&&h===C&&(this.receiveMessage(r),g.delete(C),f.nextExpectedSequenceNumber++,i())}receiveMessage(r){const{_id:i,_type:d,_message:h,_uid:f}=r;if(_s("SHOW_P2P_LOG")&&Wt.debug("receive message",r),i){let g;switch(r._type!==$E.ACK&&(h&&(g=JSON.parse(h)),this.ack(r._id)),r._type){case $E.CANDIDATE:case $E.CONTROL:this.signal.emit(d,g,f);break;case $E.PUBLISH:case $E.UNPUBLISH:case $E.RESTART_ICE:case $E.CALL:g.uid=f,TS(this.signal,d,g).then(b=>{this.response(r._id,b)}).catch(()=>{this.response(r._id,void 0,!0)});break;case $E.ACK:this.getListeners("res-@".concat(i,"_ack")).length>0&&this.emit("res-@".concat(i,"_ack"));break;case $E.RESPONSE:{const{success:b,message:C}=g;this.emit("res-@".concat(i),b?"success":"failed",C);break}}}}splitMessage(r){if(r.length<kI.MAX_MESSAGE_SIZE)return[r];const i=[],{remoteToken:d}=JSON.parse(r),h=AE(6,"");let f=0,g=800;const b=Math.ceil(r.length/g);for(;r.length>0;){f++;const C={id:h,index:f,total:b,payload:r.slice(0,g),token:"".concat(this.token,"_").concat(d)};JSON.stringify(C).length>kI.MAX_MESSAGE_SIZE?g-=50:(i.push(C),r=r.slice(g))}return i.map(C=>JSON.stringify(C))}handleCheckToken(r,i){return r.token!==i?(Wt.debug("token changed, from ".concat(r.token," to ").concat(i)),this.reset(r.uid,i),!1):(this.tokenTimeout&&(window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0),this.tokenTimeout=window.setTimeout(()=>{Wt.debug("token timeout, ".concat(i)),this.reset(r.uid)},_s("MAX_P2P_TIMEOUT")),!0)}async handleUserOnline(){const r=await TS(this.signal,$E.CALL,void 0),i=await this.send($E.CALL,r);this.signal.emit(B_.P2P_CONNECTION,i,!0)}async reset(r,i){const d=this.userMap.get(r);d&&(this.emit(MO.ABORT),this.signal.emit(rE.ON_USER_OFFLINE,{uid:d.uid,reason:rht.P2P_TOKEN_CHANGED}),this._sequence=0,this.userMap.clear(),i||(Wt.debug("change local token from ".concat(i," to ").concat(i)),this.token=AE(6,"")))}clear(){this._sequence=0,this.userMap.clear(),this.tokenInterval&&window.clearTimeout(this.tokenInterval),this.tokenInterval=void 0,this.tokenTimeout&&window.clearTimeout(this.tokenTimeout),this.tokenTimeout=void 0,this.emit(MO.ABORT)}}Ei(kI,"MAX_SIZE",1),Ei(kI,"MAX_MESSAGE_SIZE",1024);class Vft extends qE{get connectionState(){return this._connectionState}set connectionState(r){r!==this._connectionState&&(this._connectionState=r,r===kE.CONNECTED?this.emit(B_.WS_CONNECTED):r===kE.RECONNECTING?this.emit(B_.WS_RECONNECTING,this._websocketReconnectReason):r===kE.CLOSED&&this.emit(B_.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket&&this.websocket.url||null}get rtt(){return this.rttRolling.mean()}constructor(r,i){super(),Ei(this,"_disconnectedReason",void 0),Ei(this,"_websocketReconnectReason",void 0),Ei(this,"_connectionState",kE.CLOSED),Ei(this,"reconnectToken",void 0),Ei(this,"p2pToken",void 0),Ei(this,"websocket",void 0),Ei(this,"openConnectionTime",void 0),Ei(this,"clientId",void 0),Ei(this,"lastMsgTime",Date.now()),Ei(this,"uploadCache",[]),Ei(this,"uploadCacheInterval",void 0),Ei(this,"rttRolling",new O4(5)),Ei(this,"pingpongTimer",void 0),Ei(this,"pingpongTimeoutCount",0),Ei(this,"joinResponse",void 0),Ei(this,"multiIpOption",void 0),Ei(this,"initError",void 0),Ei(this,"spec",void 0),Ei(this,"store",void 0),Ei(this,"_external_signal",void 0),Ei(this,"onWebsocketMessage",d=>{if(d.data instanceof ArrayBuffer)return void this.emit(B_.ON_BINARY_DATA,d.data);const h=JSON.parse(d.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(h,"_id")){const f="res-@".concat(h._id);this.emit(f,h._result,h._message)}else if(Object.prototype.hasOwnProperty.call(h,"_type")){switch(h._type){case rE.ON_DATA_STREAM:return void this.handleDataStream(h._message);case rE.MUTE_AUDIO:case rE.MUTE_VIDEO:case rE.ON_P2P_LOST:case rE.ON_USER_ONLINE:return;case rE.ON_USER_OFFLINE:const{uid:f}=h._message;return Wt.debug("[".concat(this.clientId,"] user-offline uid: ").concat(f)),void this._external_signal.reset(f)}if(this.emit(h._type,h._message),h._type===rE.ON_NOTIFICATION&&this.handleNotification(h._message),h._type===rE.ON_USER_BANNED)switch(h._message.error_code){case 14:this.close(_E.UID_BANNED);break;case 15:this.close(_E.IP_BANNED);break;case 16:this.close(_E.CHANNEL_BANNED)}if(h._type===rE.ON_USER_LICENSE_BANNED)switch(h._message.error_code){case x_.ERR_LICENSE_MISSING:this.close(_E.LICENSE_MISSING);break;case x_.ERR_LICENSE_EXPIRED:this.close(_E.LICENSE_EXPIRED);break;case x_.ERR_LICENSE_MINUTES_EXCEEDED:this.close(_E.LICENSE_MINUTES_EXCEEDED);break;case x_.ERR_LICENSE_PERIOD_INVALID:this.close(_E.LICENSE_PERIOD_INVALID);break;case x_.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(_E.LICENSE_MULTIPLE_SDK_SERVICE);break;case x_.ERR_LICENSE_ILLEGAL:this.close(_E.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=r.clientId,this.spec=r,this.store=i,this.websocket=new zF("gateway-".concat(this.clientId),this.spec.retryConfig,!0,_s("JOIN_GATEWAY_USE_DUAL_DOMAIN"),_s("JOIN_GATEWAY_USE_443PORT_ONLY"),i),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===kE.CONNECTED&&this.reconnect("retry",SS.OFFLINE)}),this.p2pToken=AE(6,""),this._external_signal=new kI(this,this.p2pToken)}async request(r,i,d,h){const f=AE(6,""),g={_id:f,_type:r,_message:i},b=this.websocket.connectionID,C=()=>new T_((_i,ue)=>{if(this.connectionState===kE.CONNECTED)return _i();const _r=()=>{this.off(B_.WS_CLOSED,Fi),_i()},Fi=()=>{this.off(B_.WS_CONNECTED,_r),ue(new n_(Gi.WS_ABORT))};this.once(B_.WS_CONNECTED,_r),this.once(B_.WS_CLOSED,Fi)});if(this.connectionState!==kE.CONNECTING&&this.connectionState!==kE.RECONNECTING||r===j_.JOIN||r===j_.REJOIN||await C(),this.websocket.sendMessage(g,!0),h)return;const P=new T_((_i,ue)=>{let _r=!1;const Fi=(Js,_l)=>{_r=!0,_i({isSuccess:Js==="success",message:_l||{}}),this.off(B_.WS_CLOSED,Di),this.off(B_.WS_RECONNECTING,Di),this.emit(B_.REQUEST_SUCCESS,r,i)};this.once("res-@".concat(f),Fi);const Di=()=>{ue(new n_(Gi.WS_ABORT,"type: ".concat(r))),this.off(B_.WS_CLOSED,Di),this.off(B_.WS_RECONNECTING,Di),this.off("res-@".concat(f),Fi)};this.once(B_.WS_CLOSED,Di),this.once(B_.WS_RECONNECTING,Di),mS(_s("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==b||_r||(Wt.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(r)),this.emit(B_.REQUEST_TIMEOUT,r,i))})});let x=null;try{x=await P}catch(_i){if(this.connectionState===kE.CLOSED||r===j_.LEAVE)throw new n_(Gi.WS_ABORT);return!this.spec.forceWaitGatewayResponse||d?_i.throw():r===j_.JOIN||r===j_.REJOIN?null:(await C(),await this.request(r,i))}if(x.isSuccess)return x.message;const H=Number(x.message.error_code||x.message.code),$=QN(H),_t=new n_(Gi.UNEXPECTED_RESPONSE,"".concat($.desc,": ").concat(x.message.error_str),{code:H,data:x.message,desc:$.desc});return $.action==="success"?x.message:(Wt.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(r,", error_code: ").concat(H,", message: ").concat($.desc,", action: ").concat($.action)),H===x_.ERR_TOO_MANY_BROADCASTERS?((r===j_.JOIN||r===j_.REJOIN)&&(this.initError=_t,this.close()),_t.throw()):$.action==="failed"?_t.throw():$.action==="quit"?(this.initError=_t,this.close(),_t.throw()):(H===x_.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=x.message.option,Wt.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",SS.MULTI_IP)):this.reconnect($.action,SS.SERVER_ERROR),r===j_.JOIN||r===j_.REJOIN?null:await this.request(r,i)))}waitMessage(r,i){return new T_(d=>{const h=f=>{(!i||i(f))&&(this.off(r,h),d(f))};this.on(r,h)})}uploadWRTCStats(r){if(!this.store.sessionId)return void Wt.warn("[".concat(this.clientId,"] no session id when upload wrtc stats"));const i={lts:Date.now(),sid:this.store.sessionId,uid:this.store.intUid,stats:r};this.upload(JN.WRTC_STATS,i)}upload(r,i){const d={_type:r,_message:i};try{this.websocket.sendMessage(d)}catch{const f=_s("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(d),this.uploadCache.length>f&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==kE.CONNECTED)return;const g=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(g._type,g._message)},_s("UPLOAD_CACHE_INTERVAL")||2e3))}}send(r,i){const d={_type:r,_message:i};this.websocket.sendMessage(d)}async sendExtensionMessage(r,i,d){return await this._external_signal.send(r,i,d)}init(r){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new T_((i,d)=>{this.once(B_.WS_CONNECTED,()=>i(this.joinResponse)),this.once(B_.WS_CLOSED,()=>d(this.initError||new n_(Gi.WS_ABORT))),this.connectionState=kE.CONNECTING,this.websocket.init(r).catch(d)})}close(r){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._external_signal.clear(),this._disconnectedReason=r||_E.LEAVE,this.connectionState=kE.CLOSED,Wt.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),this.p2pToken=AE(6,""),this._external_signal.clear(),this._external_signal=new kI(this,this.p2pToken)}async join(){if(!this.joinResponse){this.emit(B_.ABORT_P2P_EXECUTION);const r=await TS(this,B_.REQUEST_JOIN_INFO),i=await this.request(j_.JOIN,r);if(!i)return this.emit(B_.REPORT_JOIN_GATEWAY,Gi.TIMEOUT,this.url||""),!1;this.joinResponse=i,this.emit(B_.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=kE.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}reconnect(r,i){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(r,i)}async downgradeCodec(r){return!1}handleDataStream(r){try{var i;const d=hI(r.payload),h=new TextDecoder().decode(d),f=JSON.parse(h);"total"in f&&"id"in f||E_(i=Object.values($E)).call(i,f._type)?(f._uid=r.uid,this._external_signal.onMessage(f)):this.emit(rE.ON_DATA_STREAM,r)}catch{this.emit(rE.ON_DATA_STREAM,r)}}handleNotification(r){Wt.debug("[".concat(this.clientId,"] receive notification: "),r);const i=QN(r.code);if(i.action!=="success"){if(i.action!=="failed")return i.action==="quit"?(i.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(_E.UID_BANNED),void this.close()):void this.reconnect(i.action,SS.SERVER_ERROR);Wt.error("[".concat(this.clientId,"] ignore error: "),i.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const r=_s("PING_PONG_TIME_OUT"),i=Date.now();this.pingpongTimeoutCount>=r&&(Wt.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(i-this.lastMsgTime,"ms")),i-this.lastMsgTime>_s("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",SS.TIMEOUT):this.request(j_.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const d=Date.now()-i;this.rttRolling.add(d),_s("REPORT_STATS")&&this.send(j_.PING_BACK,{pingpongElapse:d})}).catch(d=>{})}handleWebsocketEvents(){this.websocket.on(Y_.RECONNECT_CREATE_CONNECTION,r=>{this.emit(B_.WS_RECONNECT_CREATE_CONNECTION,r)}),this.websocket.on(Y_.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Y_.CLOSED,()=>{this.connectionState=kE.CLOSED}),this.websocket.on(Y_.FAILED,()=>{this._disconnectedReason=_E.NETWORK_ERROR,this.connectionState=kE.CLOSED}),this.websocket.on(Y_.RECONNECTING,r=>{this._websocketReconnectReason=r,this.joinResponse=void 0,this.connectionState===kE.CONNECTED?this.connectionState=kE.RECONNECTING:this.connectionState=kE.CONNECTING}),this.websocket.on(Y_.WILL_RECONNECT,(r,i,d)=>{r!=="retry"?(Wt.debug("".concat(this.clientId," websocket will_connect event, renewSession reconnectMode is ").concat(r)),this.reconnectToken=void 0):Wt.debug("".concat(this.clientId," reconnect mode is retry, no need to renew session")),d(r)}),this.websocket.on(Y_.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.join().catch(r=>{if(this.emit(B_.REPORT_JOIN_GATEWAY,r,this.url||""),r instanceof n_&&r.code===Gi.UNEXPECTED_RESPONSE&&r.data.code===x_.ERR_NO_AUTHORIZED)return Wt.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",SS.SERVER_ERROR);Wt.error("[".concat(this.clientId,"] join gateway request failed"),r.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",SS.SERVER_ERROR):(this.initError=r,this.close())})}),this.websocket.on(Y_.REQUEST_NEW_URLS,(r,i)=>{TS(this,B_.REQUEST_RECOVER,this.multiIpOption).then(r).catch(i)}),this.websocket.on(Y_.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(rE.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}const jft={name:"P2PChannel",create:function(e){let{store:r,statsCollector:i}=e;return new Uft(r,i)},createSubmodule:function(e){let{store:r,spec:i}=e;return new Vft(i,r)}};function eZ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function nZ(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?eZ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):eZ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}class Fft{constructor(r){Ei(this,"sessionDesc",void 0),Ei(this,"localCapabilities",void 0),Ei(this,"rtpCapabilities",void 0),Ei(this,"candidates",void 0),Ei(this,"_originCandidates",void 0),Ei(this,"iceParameters",void 0),Ei(this,"dtlsParameters",void 0),Ei(this,"setup",void 0),Ei(this,"currentMidIndex",void 0),Ei(this,"cname",void 0),r=BE(r);const{iceParameters:i,dtlsParameters:d,candidates:h,rtpCapabilities:f,setup:g,localCapabilities:b,sdkCodec:C,cname:P}=r,x=$S(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=f,this.candidates=h,this._originCandidates=BE(h),this.iceParameters=i,this.dtlsParameters=d,this.setup=g,this.localCapabilities=b,this.cname=P;for(let H=0;H<x.mediaDescriptions.length;H++){const $=x.mediaDescriptions[H];if($.attributes.iceUfrag=i.iceUfrag,$.attributes.icePwd=i.icePwd,$.attributes.fingerprints=d.fingerprints,$.attributes.candidates=h,$.attributes.setup=g,$.media.mediaType==="video"){$.media.fmts=f.videoCodecs.map(ue=>ue.payloadType.toString(10));const _t=f.videoCodecs.filter(ue=>{var _r,Fi;return(_r=ue.rtpMap)===null||_r===void 0?void 0:E_(Fi=_r.encodingName.toLowerCase()).call(Fi,C)}),_i=f.videoCodecs.filter(ue=>!E_(_t).call(_t,ue));$.attributes.payloads=[..._t,..._i],$.attributes.extmaps=f.videoExtensions}$.media.mediaType==="audio"&&($.media.fmts=f.audioCodecs.map(_t=>_t.payloadType.toString(10)),$.attributes.payloads=f.audioCodecs,$.attributes.extmaps=f.audioExtensions),x.mediaDescriptions[H]=this.mungMediaDesc($)}this.sessionDesc=x,this.currentMidIndex=x.mediaDescriptions.length-1}toString(){return C0(this.sessionDesc)}send(r,i,d){const{ssrcs:h,ssrcGroups:f}=eP(i,this.cname),g=this.sessionDesc.mediaDescriptions.find(P=>r===A_.VIDEO?P.media.mediaType==="video":P.media.mediaType==="audio"),b=h[0].attributes.label,C=h[0].attributes.mslabel;return g.attributes.ssrcs=g.attributes.ssrcs.concat(h),g.attributes.ssrcGroups=g.attributes.ssrcGroups.concat(f),{id:b,mslabel:C}}batchSend(r){return r.map(i=>{let{kind:d,ssrcMsg:h}=i;return this.send(d,h,void 0)})}stopSending(r){this.sessionDesc.mediaDescriptions.forEach(i=>{const d=[],h=[],f=[];i.attributes.ssrcs.forEach(g=>{E_(r).call(r,g.attributes.label||"")?f.push(g):d.push(g)}),i.attributes.ssrcGroups.forEach(g=>{var b;E_(b=f.map(C=>C.ssrcId)).call(b,g.ssrcIds[0])||h.push(g)}),i.attributes.ssrcs=d,i.attributes.ssrcGroups=h})}mute(r){const i=this.sessionDesc.mediaDescriptions.find(d=>d.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.mute."));i.attributes.direction="inactive"}unmute(r){const i=this.sessionDesc.mediaDescriptions.find(d=>d.attributes.mid===r);if(!i)throw new Error("mediaDescription not found with ".concat(r," in remote SDP when calling RemoteSDP.unmute."));i.attributes.direction="sendonly"}receive(r,i,d){r.forEach((h,f)=>{const g=h._mediaStreamTrack,b=this.sessionDesc.mediaDescriptions.findIndex(P=>P.attributes.mid===g.kind),C=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[b],h);this.sessionDesc.mediaDescriptions[b]=C})}stopReceiving(r){}updateCandidates(r){const i=this._originCandidates.filter(h=>h.transport==="udp"),d=[];if(i.forEach(h=>{d.push(nZ(nZ({},h),{},{foundation:"tcpcandidate",priority:Number(h.priority)-1+"",transport:"tcp",port:Number(h.port)+90+""}))}),i.length!==0){switch(r){case OS.TCP_RELAY:this.candidates=d;break;case OS.UDP_TCP_RELAY:case OS.RELAY:this.candidates=[...i,...d];break;default:this.candidates=i}for(const h of this.sessionDesc.mediaDescriptions)h.attributes.candidates=this.candidates}}restartICE(r){r=BE(r),this.iceParameters=r,this.sessionDesc.mediaDescriptions.forEach(i=>{i.attributes.iceUfrag=r.iceUfrag,i.attributes.icePwd=r.icePwd})}predictReceivingMids(r){const i=[];for(let d=0;d<r;d++)i.push((this.currentMidIndex+d+1).toString(10));return i}mungRecvMediaDsec(r,i){const d=BE(r);return VO(d,i),QF(d,i),d}updateRecvMedia(r,i){const d=this.sessionDesc.mediaDescriptions.findIndex(h=>h.attributes.mid===r);if(d!==-1){const h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[d],i);this.sessionDesc.mediaDescriptions[d]=h}}bumpMid(r){this.currentMidIndex+=r}updateTrackLabel(r,i,d){const h=this.sessionDesc.mediaDescriptions.find(g=>r===A_.VIDEO?g.attributes.mid==="video":g.attributes.mid==="audio");if(h){const g=h.attributes.ssrcs.find(b=>b.attributes.label===i);var f;g&&(g.attributes.label=d,(f=g.attributes.msid)===null||f===void 0||f.replace(i,d))}}mungMediaDesc(r){const i=BE(r);return XF(i),function(d){const h=d.attributes.extmaps.find(f=>r1(f.extensionName));h&&d.attributes.extmaps.splice(d.attributes.extmaps.indexOf(h),1),d.attributes.payloads.forEach(f=>{const g=f.rtcpFeedbacks.findIndex(b=>b.type==="transport-cc");g!==-1&&f.rtcpFeedbacks.splice(g,1)})}(i),i}getSSRC(r){for(const i of this.sessionDesc.mediaDescriptions)for(const d of i.attributes.ssrcs)if(d.attributes.label===r)return[d]}}var OE;function rZ(e,r){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var d=Object.getOwnPropertySymbols(e);r&&(d=d.filter(function(h){return Object.getOwnPropertyDescriptor(e,h).enumerable})),i.push.apply(i,d)}return i}function q1(e){for(var r=1;r<arguments.length;r++){var i=arguments[r]!=null?arguments[r]:{};r%2?rZ(Object(i),!0).forEach(function(d){Ei(e,d,i[d])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):rZ(Object(i)).forEach(function(d){Object.defineProperty(e,d,Object.getOwnPropertyDescriptor(i,d))})}return e}let Bft=(OE=class OP extends _J{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get localCodecs(){return[...new Set(this.localCapabilities&&this.localCapabilities.videoCodecs.map(r=>r.rtpMap&&r.rtpMap.encodingName.toLowerCase()||"").filter(r=>{var i;return E_(i=Object.keys(WN)).call(i,r)}))]}constructor(r,i){super(r,i),Ei(this,"store",void 0),Ei(this,"peerConnection",void 0),Ei(this,"remoteSDP",void 0),Ei(this,"initialOffer",void 0),Ei(this,"statsFilter",void 0),Ei(this,"useRTX",!1),Ei(this,"localCapabilities",void 0),Ei(this,"localCandidateCount",0),Ei(this,"allCandidatesReceived",!1),Ei(this,"establishPromise",void 0),Ei(this,"mutex",void 0),this.store=i,this.mutex=new wS("P2PConnection-mutex",i.clientId),this.peerConnection=new RTCPeerConnection(OP.resolvePCConfiguration(r),{optional:[{googDscp:!0}]}),this.statsFilter=oF(this.peerConnection,_s("STATS_UPDATE_INTERVAL"),void 0,KE()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const r=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!r.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const i=k0(r.sdp),d=tP(r.sdp,{filterRTX:!this.useRTX,filterVideoFec:_s("FILTER_VIDEO_FEC"),filterAudioFec:_s("FILTER_AUDIO_FEC"),filterAudioCodec:["opus"]});return this.localCapabilities=d,this.initialOffer=r,q1(q1({},i),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:d},offerSDP:r.sdp})}catch(r){throw new n_(Gi.GET_LOCAL_CONNECTION_PARAMS_FAILED,r.toString())}}async updateRemoteConnect(){}async connect(r){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new Fft(q1(q1({},r),{},{rtpCapabilities:r.rtpCapabilities.send,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec}));const i=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:i})}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(i.toString()))}}async updateRemoteRTPCapabilities(r,i){throw new n_(Gi.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}getPreMedia(r){}send(r,i){var d=this;return CT(function*(){const h=yield cE(d.mutex.lock());try{if(!d.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const f=r.map($=>d.peerConnection.addTrack($._mediaStreamTrack)),g=yield cE(d.peerConnection.createOffer()),b=$S(g.sdp),C=r.map($=>{const _t=$._mediaStreamTrack,_i=b.mediaDescriptions.find(ue=>ue.attributes.mid===_t.kind);if(!_i)throw new Error("Cannot extract ssrc from mediaDescription.");return function(ue,_r,Fi){const Di=ue.attributes.ssrcs.filter(_l=>_l.attributes.label===_r),Js=ue.attributes.ssrcGroups;if(Di.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(Js&&Di.length>1){const _l=Js.find(_u=>_u.ssrcIds.indexOf(Di[0].ssrcId)!==-1);return _l?[{ssrcId:_l.ssrcIds[0],rtx:Fi?_l.ssrcIds[1]:void 0}]:[{ssrcId:Di[0].ssrcId}]}return[{ssrcId:Di[0].ssrcId}]}(_i,_t.id,d.useRTX)});let P;try{P=yield C}catch($){throw f.forEach(_t=>{yS()&&_t.replaceTrack(null),d.peerConnection.removeTrack(_t)}),$}const x=d.mungSendOfferSDP(g.sdp,r);d.remoteSDP.receive(r,i,P);const H=d.remoteSDP.toString();return yield cE(d.peerConnection.setLocalDescription({type:"offer",sdp:x})),yield cE(d.applySendEncodings(f,r)),yield cE(d.peerConnection.setRemoteDescription({type:"answer",sdp:H})),r.map(($,_t)=>{const _i=$._mediaStreamTrack.id;return{localSSRC:C[_t],id:_i}})}catch(f){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(f.toString()))}finally{h()}})()}async stopSending(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const i=this.peerConnection.getSenders().filter(f=>{var g;return r.indexOf(((g=f.track)===null||g===void 0?void 0:g.id)||"")!==-1});if(i.length!==r.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");i.map(f=>{yS()&&f.replaceTrack(null),this.peerConnection.removeTrack(f)});const d=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(d),this.remoteSDP.stopReceiving(r);const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(i.toString()))}}async receive(r,i,d,h){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(r," before remoteSDP created."));const{id:f,mslabel:g}=this.remoteSDP.send(r,i,h),b=new T_((x,H)=>{const $=setTimeout(()=>{H(new Error("Cannot receive track, id: ".concat(f)))},1e4),_t=_i=>{const ue=oE();if((ue.name==="Safari"&&Number(ue.version)===11||LS())&&_i.track.id!==f&&_i.streams[0].id===g){var _r;const Fi=_i.streams[0].getTracks()[0];return(_r=this.remoteSDP)===null||_r===void 0||_r.updateTrackLabel(r,f,_i.track.id),this.peerConnection.removeEventListener("track",_t),clearTimeout($),void x(Fi)}if(_i.track.id===f)return this.peerConnection.removeEventListener("track",_t),clearTimeout($),void x(_i.track)};this.peerConnection.addEventListener("track",_t)}),C=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:C});const P=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(P),{track:await b,id:f}}catch(f){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(f.toString()))}}async stopReceiving(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(r);const i=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:i});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d)}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(i.toString()))}}async muteRemote(r){}async unmuteRemote(r){}async muteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(d=>{var h;return r.indexOf(((h=d.track)===null||h===void 0?void 0:h.id)||"")!==-1});if(i.length!==r.length)throw new Error("sender' length doesn't match mids' length.");i.map(d=>{if(yS()&&d.track)d.track.enabled=!1;else{const h=d.getParameters();h.encodings.forEach(f=>f.active=!1),d.setParameters(h)}})}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(i.toString()))}}async unmuteLocal(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const i=this.peerConnection.getSenders().filter(f=>{var g;return r.indexOf(((g=f.track)===null||g===void 0?void 0:g.id)||"")!==-1});if(i.length!==r.length)throw new Error("Senders' length doesn't match mids' length.");i.map(async f=>{if(yS()&&f.track)f.track.enabled=!0;else{const g=f.getParameters();g.encodings.forEach(b=>b.active=!0),await f.setParameters(g)}});const d=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(d);const h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:h})}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(i.toString()))}}restartICE(r){var i=this;return CT(function*(){const d=yield cE(i.mutex.lock("From P2PConnection.restartICE"));try{if(!i.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");const h=uE().supportPCSetConfiguration;if(r===OS.RELAY&&!h)return;if(h){const P=i.peerConnection.getConfiguration(),x=r===OS.RELAY?"relay":"all";P.iceTransportPolicy!==x&&(Wt.debug("[".concat(i.store.clientId,"] restartICE change iceTransportPolicy from [").concat(P.iceTransportPolicy,"] to [").concat(x,"]")),P.iceTransportPolicy=x,i.peerConnection.setConfiguration(P))}r!==OS.RELAY&&i.remoteSDP.updateCandidates(r);const f=yield cE(i.peerConnection.createOffer({iceRestart:!0}));if(!f.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const g=k0(f.sdp),{remoteIceParameters:b}=yield g.iceParameters;i.remoteSDP.restartICE(b);const C=i.remoteSDP.toString();yield cE(i.peerConnection.setLocalDescription(f)),yield cE(i.peerConnection.setRemoteDescription({type:"answer",sdp:C}))}catch(h){Wt.warning("[".concat(i.store.clientId,"] restart ICE failed, abort operation"),h)}finally{d()}})()}close(){var r;this.peerConnection.close(),(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(r){return this.statsFilter.getVideoIsReady(r)}async updateEncoderConfig(r,i){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const d=await this.peerConnection.createOffer(),h=this.mungSendOfferSDP(d.sdp,[i]);this.remoteSDP.updateRecvMedia(i._mediaStreamTrack.kind,i);const f=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:h}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:f})}catch(d){throw new n_(Gi.EXCHANGE_SDP_FAILED,d.toString())}}async updateSendParameters(r,i){const d=this.peerConnection.getSenders().filter(h=>{var f;return((f=h.track)===null||f===void 0?void 0:f.id)===r});d.length===1&&await this.applySendEncodings(d,[i])}setStatsRemoteVideoIsReady(r,i){this.statsFilter.setVideoIsReady2(r,i)}async replaceTrack(r,i){const d=this.peerConnection.getSenders().find(h=>{var f;return((f=h.track)===null||f===void 0?void 0:f.id)===i});d&&await d.replaceTrack(r._mediaStreamTrack)}createDataChannels(r,i){throw new n_(Gi.NOT_SUPPORTED,"Planb mode does not support createDataChannels.")}stopDataChannels(r){throw new n_(Gi.NOT_SUPPORTED,"Planb mode does not support stopDataChannels.")}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var r;(r=this.onICEConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var r;(r=this.onConnectionStateChange)===null||r===void 0||r.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=r=>{r.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,Wt.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,Wt.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},_s("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(r){const i={iceServers:[],sdpSemantics:"plan-b"};return r.iceServers?i.iceServers=r.iceServers:r.turnServer&&r.turnServer.mode!=="off"&&(jN(r.turnServer.servers)?i.iceServers=r.turnServer.servers:(i.iceServers&&i.iceServers.push(...OP.turnServerConfigToIceServers(r.turnServer.servers)),_s("USE_TURN_SERVER_OF_GATEWAY")&&i.iceServers&&r.turnServer.serversFromGateway&&i.iceServers.push(...OP.turnServerConfigToIceServers(r.turnServer.serversFromGateway)),r.turnServer.servers.concat(r.turnServer.serversFromGateway||[]).forEach(d=>{d.forceturn&&(i.iceTransportPolicy="relay")}))),i}static turnServerConfigToIceServers(r){const i=[];return r.forEach(d=>{d.security?d.tcpport&&i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turns:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=tcp")}):(d.udpport&&i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.udpport,"?transport=udp")}),d.tcpport&&i.push({username:d.username,credential:d.password,credentialType:"password",urls:"turn:".concat(d.turnServerURL,":").concat(d.tcpport,"?transport=tcp")}))}),i}async updateRtpSenderEncodings(r,i){var d;if(i||(i=this.peerConnection.getSenders().find(P=>{var x;return((x=P.track)===null||x===void 0?void 0:x.id)===r._mediaStreamTrack.id})),!i)return Wt.warn("[".concat(r.getTrackId(),"] no rtpSender found}"));if(!uE().supportSetRtpSenderParameters)return Wt.warn("Browser not support set rtp-sender parameters");const h={},f={};if(r instanceof LE)switch(r._optimizationMode){case"motion":h.degradationPreference="maintain-framerate";break;case"detail":h.degradationPreference="maintain-resolution";break;default:h.degradationPreference="balanced"}if(_s("DSCP_TYPE")&&n0()){var g;const P=_s("DSCP_TYPE");E_(g=["very-low","low","medium","high"]).call(g,P)&&(f.networkPriority=P)}const b=i.getParameters(),C=(d=b.encodings)===null||d===void 0?void 0:d[0];C&&Object.assign(C,f),Object.assign(b,h),Wt.debug("[".concat(r.getTrackId(),"] updateRtpSenderEncodings: ").concat(JSON.stringify(b.encodings))),await i.setParameters(b)}async applySendEncodings(r,i){try{if(!uE().supportSetRtpSenderParameters||r.length!==i.length)return;for(let d=0;d<r.length;d++){const h=r[d],f=i[d];h&&f&&await this.updateRtpSenderEncodings(f,h)}}catch{Wt.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(r,i){const d=$S(r);return i.forEach((h,f)=>{const g=h._mediaStreamTrack,b=d.mediaDescriptions.find(C=>C.attributes.mid===g.kind);b&&VO(b,h)}),C0(d)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=r=>{var i;(i=this.onFirstAudioReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoReceived=r=>{var i;(i=this.onFirstVideoReceived)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstAudioDecoded=r=>{var i;(i=this.onFirstAudioDecoded)===null||i===void 0||i.call(this,r)},this.statsFilter.onFirstVideoDecoded=(r,i,d)=>{var h;(h=this.onFirstVideoDecoded)===null||h===void 0||h.call(this,r,i,d)},this.statsFilter.onSelectedLocalCandidateChanged=(r,i)=>{var d;(d=this.onSelectedLocalCandidateChanged)===null||d===void 0||d.call(this,r,i)},this.statsFilter.onSelectedRemoteCandidateChanged=(r,i)=>{var d;(d=this.onSelectedRemoteCandidateChanged)===null||d===void 0||d.call(this,r,i)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(r){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const i=this.remoteSDP.batchSend(r).map((f,g)=>{let{id:b,mslabel:C}=f;const{kind:P}=r[g];return new T_((x,H)=>{const $=setTimeout(()=>{H(new Error("Cannot receive track, id: ".concat(b)))},1e4),_t=_i=>{const ue=oE();if(ue.name==="Safari"&&Number(ue.version)===11&&_i.track.id!==b&&_i.streams[0].id===C){var _r;const Fi=_i.streams[0].getTracks()[0];return(_r=this.remoteSDP)===null||_r===void 0||_r.updateTrackLabel(P,b,_i.track.id),this.peerConnection.removeEventListener("track",_t),clearTimeout($),void x({track:Fi,id:b})}if(_i.track.id===b)return this.peerConnection.removeEventListener("track",_t),clearTimeout($),void x({track:_i.track,id:b})};this.peerConnection.addEventListener("track",_t)})}),d=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:d});const h=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(h),await T_.all(i)}catch(i){throw new n_(Gi.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(i.toString()))}}async getRemoteSSRC(r){if(!this.remoteSDP)return;const i=this.remoteSDP.getSSRC(r);return i==null?void 0:i[0].ssrcId}setConfiguration(r){if(uE().supportPCSetConfiguration){const i=OP.resolvePCConfiguration(r);this.peerConnection.setConfiguration(i)}}},D_(OE.prototype,"connect",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"connect"),OE.prototype),D_(OE.prototype,"stopSending",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"stopSending"),OE.prototype),D_(OE.prototype,"receive",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"receive"),OE.prototype),D_(OE.prototype,"stopReceiving",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"stopReceiving"),OE.prototype),D_(OE.prototype,"muteRemote",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"muteRemote"),OE.prototype),D_(OE.prototype,"unmuteRemote",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"unmuteRemote"),OE.prototype),D_(OE.prototype,"muteLocal",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"muteLocal"),OE.prototype),D_(OE.prototype,"unmuteLocal",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"unmuteLocal"),OE.prototype),D_(OE.prototype,"close",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"close"),OE.prototype),D_(OE.prototype,"updateEncoderConfig",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"updateEncoderConfig"),OE.prototype),D_(OE.prototype,"updateSendParameters",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"updateSendParameters"),OE.prototype),D_(OE.prototype,"replaceTrack",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"replaceTrack"),OE.prototype),D_(OE.prototype,"getRemoteSSRC",[xT],Object.getOwnPropertyDescriptor(OE.prototype,"getRemoteSSRC"),OE.prototype),OE);function xT(e,r,i){const d=e[r];if(typeof d!="function")throw new Error("Cannot use mutex on object property.");return i.value=async function(){const h=this.mutex,f=await h.lock("Locking from P2PConnection.".concat(r));try{for(var g=arguments.length,b=new Array(g),C=0;C<g;C++)b[C]=arguments[C];return await d.apply(this,b)}finally{f()}},i}const Gft={name:"PlanBConnection",create:function(e){let{store:r,spec:i}=e;return new Bft(i,r)}},qft={interceptLocalAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!uE().supportWebRTCEncodedTransform)return void Wt.warning("browser not support audio encoded transform");if(FL.has(e)||!e.track)return;const i={track:e.track};if(e0()){if(!e.createEncodedStreams)return void Wt.warning("browser not support createEncodedStreams() API");let h=null;try{h=e.createEncodedStreams()}catch(g){return void Wt.error("create audio-encoded-streams error",g&&g.message)}const f=new TransformStream({transform(g,b){i.controller||(i.controller=b),e.track&&e.track.id!==i.track.id&&(Wt.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",d),i.track=e.track,i.track.addEventListener("ended",d));const C=r.metadata&&r.metadata();C?function(P,x){const{chunk:H,controller:$}=x,_t=A0.METADATA;H.data=function(_i,ue,_r){const Fi=_r.byteLength,Di=Fi+NF+$7,Js=AF+OF+Di,_l=new ArrayBuffer(_i.byteLength+Js),_u=new DataView(_l);_u.setUint8(0,Z7),_u.setUint16(1,Di),_u.setUint8(3,ue),_u.setUint16(4,Fi);for(let _m=0;_m<Fi;_m++)_u.setUint8(6+_m,_r[_m]);const ga=new Uint8Array(_u.buffer);return ga.set(new Uint8Array(_i),Js),ga.buffer}(H.data,_t,P),$.enqueue(H)}(C,{chunk:g,controller:b}):b.enqueue(g)}});h.readable.pipeThrough(f).pipeTo(h.writable)}else if(yS()){if(typeof RTCRtpScriptTransform>"u")return void Wt.warning("browser not support RTCRtpScriptTransform");const h=jL(),f=new MessageChannel;await new T_(b=>h.onmessage=C=>{C.data==="registered"&&b(void 0)});const g=new RTCRtpScriptTransform(h,{name:"audio-metadata-tx",port:f.port2},[f.port2]);e.transform=g,await new T_(b=>h.onmessage=C=>{C.data==="started"&&b(void 0)}),f.port1.onmessage=b=>{var C;if(b.data.transformed&&e.track&&((C=e.track)===null||C===void 0?void 0:C.id)!==i.track.id)Wt.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",d),i.track=e.track,i.track.addEventListener("ended",d);else if(b.data.getMetadata){const P=r.metadata&&r.metadata();P&&f.port1.postMessage({metadata:P})}},i.worker=h}function d(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",d)}const h=FL.get(e);if(h){FL.delete(e);try{var f,g;(f=h.controller)===null||f===void 0||f.terminate(),(g=h.worker)===null||g===void 0||g.terminate()}catch(b){Wt.warning(b&&b.message)}}}FL.set(e,i),e.track.addEventListener("ended",d)},interceptRemoteAudioFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!uE().supportWebRTCEncodedTransform)return void Wt.warning("browser not support audio encoded transform");if(HL.has(e))return;const i={track:e.track,onMetadata:r.onMetadata,onPts:r.onPts};if(e0()&&!LS()){if(!e.createEncodedStreams)return void Wt.warning("browser not support createEncodedStreams() API");BV(hE.CHROME,87,116)||(r.enableTopn=!1);let h=null;try{h=e.createEncodedStreams()}catch(g){return void Wt.error("create audio-encoded-streams error",g&&g.message)}const f=new TransformStream({transform(g,b){i.controller||(i.controller=b),e.track&&e.track.id!==i.track.id&&(Wt.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",d),i.track=e.track,i.track.addEventListener("ended",d)),r.enableTopn?function(C,P,x){var H;const $=PF(new DataView(P.data));if(!$)return x.enqueue(P);const _t=C.track.id;Rlt.set(_t,C.track);const _i=(H=$.tlv.find(_l=>_l.tag===A0.AUDIO_LEVEL))===null||H===void 0?void 0:H.value;let ue=0;typeof _i=="number"&&(ue=127-_i);const _r=Math.round(Math.pow(10,ue/60)-1),{selected:Fi,speaker:Di}=function(_l,_u){let ga=PO.get(_l);if(ga||(ga=function(_m){const r_=new eJ;return PO.set(_m,r_),vR||(vR=new Slt(_s("TOPN_SILENCE_THRESHOLD")||500),vR.on("ActiveSpeakerChanged",a_=>{a_!=null&&(qL=a_)})),vR.addSpeakers([r_]),r_}(_l)),PO.size<=nJ)return{selected:!0,speaker:ga};if(!vR)throw new Error("no active speaker detector");return vR.levelChanged(ga.id,_u),vI=vR.loudest.map(_m=>_m.id),qL&&!E_(vI).call(vI,qL)&&vI.length>=nJ&&vI.pop(),{selected:E_(vI).call(vI,ga.id)||ga.id===qL,speaker:ga}}(C,_r),Js=function(_l,_u,ga){const _m=bR.get(_l)||new Tlt(_l,_u);return _m.score=ga,bR.set(_l,_m),function(r_){if(WL.set(r_,!0),!KL)return void(KL=Date.now());const a_=Date.now();a_-KL>1e3&&(WL.get(r_)?WL.set(r_,!1):(rJ(r_),WL.delete(r_)),KL=a_)}(_l),_m}(_t,C.track,Di.energyScore);Js.addSample(Fi),Js.active&&(P.data=$.frame.buffer,x.enqueue(P))}(e,g,b):r.enableMetadata||r.enablePts?function(C,P,x,H){const $=new DataView(C.data),_t=$.getUint8(0);let _i;if(128&_t&&_t!==71){const Fi=function(Di){if(Di.byteLength<=0)return[];const Js=[];let _l=0;for(;_l<Di.byteLength;){const ga=(128&Di.getUint8(_l))>>7,_m=127&Di.getUint8(_l);if(!(ga&&_l+4<=Di.byteLength)){_l++;break}{const r_=Di.getUint32(_l,!1),a_=(16776192&r_)>>10,p_=1023&r_;Js.push({pt:_m,ts_offset:a_,length:p_,data:new Uint8Array}),_l+=4}}let _u=Di.byteLength-_l;for(const ga of Js){if(ga.length>_u)return console.warn("Broken red payload"),[];ga.length>0&&(ga.data=new Uint8Array(Di.buffer,Di.byteOffset+_l,ga.length),_l+=ga.length,_u-=ga.length)}if(_u>0){const ga={pt:Js.length>0?Js[Js.length-1].pt:0,ts_offset:0,length:_u,data:new Uint8Array(Di.buffer,Di.byteOffset+_l,_u)};Js.push(ga)}return Js}($);if(Fi.length>0){const Di=function(Js){let _l=0;for(let _m=0;_m<Js.length;_m++)_l+=_m<Js.length-1?4:1,_l+=Js[_m].length;const _u=new Uint8Array(_l);let ga=0;for(let _m=0;_m<Js.length;_m++)if(_m<Js.length-1){const r_=(2147483648|(127&Js[_m].pt)<<24|(262143&Js[_m].ts_offset)<<10|1023&Js[_m].length)>>>0;_u[ga++]=r_>>24&255,_u[ga++]=r_>>16&255,_u[ga++]=r_>>8&255,_u[ga++]=255&r_}else _u[ga++]=127&Js[_m].pt;for(const _m of Js)_u.set(_m.data,ga),ga+=_m.length;return _u}(Fi.map(Js=>{const _l=new Uint8Array(Js.length);_l.set(Js.data);const _u=PF(new DataView(_l.buffer));return _u!=null&&_u.frame&&(Js.data=_u==null?void 0:_u.frame),_i=_u,Js}));C.data=Di.buffer}}else _i=PF($),_i&&(C.data=_i.frame.buffer);if(P.enqueue(C),!_i)return;const ue=_i.tlv.find(Fi=>Fi.tag===A0.METADATA);ue&&x&&ue.value instanceof Uint8Array&&x(ue.value);const _r=_i.tlv.find(Fi=>Fi.tag===A0.AUDIO_64_BIT_PTS);_r&&H&&_r.value instanceof Uint8Array&&_r.value.length==8&&H(new DataView(_r.value.buffer).getBigUint64(0,!0))}(g,b,r.onMetadata,r.onPts):b.enqueue(g)}});h.readable.pipeThrough(f).pipeTo(h.writable)}else{if(typeof RTCRtpScriptTransform>"u")return void Wt.warning("browser not support RTCRtpScriptTransform");const h=jL(),f=new MessageChannel;await new T_(b=>h.onmessage=C=>{C.data==="registered"&&b(void 0)});const g=new RTCRtpScriptTransform(h,{name:"audio-metadata-rx",port:f.port2},[f.port2]);e.transform=g,await new T_(b=>h.onmessage=C=>{C.data==="started"&&b(void 0)}),f.port1.onmessage=b=>{var C;b.data.transformed&&e.track&&((C=e.track)===null||C===void 0?void 0:C.id)!==i.track.id?(Wt.debug("audio track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",d),i.track=e.track,i.track.addEventListener("ended",d)):b.data.metadata&&i.onMetadata?i.onMetadata(b.data.metadata):b.data.pts&&i.onPts&&i.onPts(b.data.pts)},i.worker=h}function d(){e.track.removeEventListener("ended",d),function(h){const f=HL.get(h);if(f){(function(C){const P=PO.get(C);P&&(PO.delete(C),vR&&(vR.removeSpeakers([P]),PO.size===0&&(vR.destroy(),vR=null)))})(h),rJ(h.track.id),HL.delete(h);try{var g,b;(g=f.controller)===null||g===void 0||g.terminate(),(b=f.worker)===null||b===void 0||b.terminate()}catch(C){Wt.warning(C&&C.message)}}}(e)}HL.set(e,i),e.track.addEventListener("ended",d)},interceptLocalVideoFrame:async function(e,r){if(!uE().supportWebRTCEncodedTransform)return void Wt.warning("browser not support video encoded transform");if(zL.has(e)||!e.track)return;const i={track:e.track};if(e0()){if(!e.createEncodedStreams)return void Wt.warning("browser not support createEncodedStreams() API");let h=null;try{h=e.createEncodedStreams()}catch(b){return void Wt.error("create video-encoded-streams error",b&&b.message)}const f=[];r.on("sei-to-send",b=>{f.push(b)});const g=new TransformStream({transform(b,C){i.controller||(i.controller=C),e.track&&e.track.id!==i.track.id&&(Wt.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",d),i.track=e.track,i.track.addEventListener("ended",d));const P=sJ(new Uint8Array(b.data)),x=f.shift();if(x){const H=function($,_t,_i){switch(_i){case MF:return function(ue,_r){const Fi=oJ(_r),Di=Fi.length,Js=Math.floor(Di/255),_l=Di%255,_u=new Uint8Array(6+Js+1+Di+ue.byteLength);_u[0]=0,_u[1]=0,_u[2]=0,_u[3]=1,_u[4]=6,_u[5]=101;let ga=0;for(;ga<Js;)_u[6+ga]=255,ga++;return _u[6+ga]=_l,ga++,_u.set(Fi,6+ga),_u.set(new Uint8Array(ue),6+ga+Di),_u.buffer}($,_t);case xF:return function(ue,_r){const Fi=oJ(_r),Di=Fi.length,Js=Math.floor(Di/255),_l=Di%255,_u=new Uint8Array(7+Js+1+Di+1+ue.byteLength);_u[0]=0,_u[1]=0,_u[2]=0,_u[3]=1,_u[4]=78,_u[5]=1,_u[6]=101;let ga=0;for(;ga<Js;)_u[7+ga]=255,ga++;return _u[7+ga]=_l,ga++,_u.set(Fi,7+ga),ga+=Di,_u[7+ga]=128,ga++,_u.set(new Uint8Array(ue),7+ga),_u.buffer}($,_t);default:return null}}(b.data,x,P);H&&(b.data=H)}C.enqueue(b)}});h.readable.pipeThrough(g).pipeTo(h.writable)}else{if(!yS())return;{if(typeof RTCRtpScriptTransform>"u")return void Wt.warning("browser not support RTCRtpScriptTransform");const h=jL(),f=new MessageChannel;await new T_(b=>h.onmessage=C=>{C.data==="registered"&&b(void 0)});const g=new RTCRtpScriptTransform(h,{name:"sei-tx",port:f.port2},[f.port2]);e.transform=g,await new T_(b=>h.onmessage=C=>{C.data==="started"&&b(void 0)}),r.on("sei-to-send",b=>{f.port1.postMessage({sei:b})}),f.port1.onmessage=b=>{var C;b.data.transformed&&e.track&&((C=e.track)===null||C===void 0?void 0:C.id)!==i.track.id&&(Wt.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",d),i.track=e.track,i.track.addEventListener("ended",d))},i.worker=h}}function d(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",d)}const h=zL.get(e);if(h){zL.delete(e);try{var f,g;(f=h.controller)===null||f===void 0||f.terminate(),(g=h.worker)===null||g===void 0||g.terminate()}catch(b){Wt.warning(b&&b.message)}}}zL.set(e,i),e.track.addEventListener("ended",d)},interceptRemoteVideoFrame:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(!uE().supportWebRTCEncodedTransform)return void Wt.warning("browser not support video encoded transform");if(!e.track)return;if(YN.has(e)){const h=YN.get(e);return void(h&&(h.onSei=r.onSei))}const i={track:e.track,onSei:r.onSei};if(e0()){if(!e.createEncodedStreams)return void Wt.warning("browser not support createEncodedStreams() API");let h=null;try{h=e.createEncodedStreams()}catch(g){return void Wt.error("create video-encoded-streams error",g&&g.message)}const f=new TransformStream({transform(g,b){i.controller||(i.controller=b),e.track&&e.track.id!==i.track.id&&(Wt.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",d),i.track=e.track,i.track.addEventListener("ended",d));const C=function(P,x){switch(x){case MF:return function(H){const $=new DataView(H.data);let _t=0;for(;_t+4<H.data.byteLength;){if($.getUint8(_t+0)===0&&$.getUint8(_t+1)===0&&$.getUint8(_t+2)===0&&$.getUint8(_t+3)===1&&$.getUint8(_t+4)===6){let _i=_t+6,ue=0,_r=0;for(;(_r=$.getUint8(_i++))===255;)ue+=255;ue+=_r;const Fi=iJ(H.data,_i,ue);return new Uint8Array(Fi)}_t++}return null}(P);case xF:return function(H){const $=new DataView(H.data);let _t=0;for(;_t+5<H.data.byteLength;){if($.getUint8(_t+0)===0&&$.getUint8(_t+1)===0&&$.getUint8(_t+2)===0&&$.getUint8(_t+3)===1&&$.getUint8(_t+4)===78&&$.getUint8(_t+5)===1&&$.getUint8(_t+6)===101){let _i=_t+7,ue=0,_r=0;for(;(_r=$.getUint8(_i++))===255;)ue+=255;ue+=_r;const Fi=iJ(H.data,_i,ue);return new Uint8Array(Fi)}_t++}return null}(P);default:return null}}(g,sJ(new Uint8Array(g.data)));C&&i.onSei&&i.onSei(C),b.enqueue(g)}});h.readable.pipeThrough(f).pipeTo(h.writable)}else if(yS()){if(typeof RTCRtpScriptTransform>"u")return void Wt.warning("browser not support RTCRtpScriptTransform");const h=jL(),f=new MessageChannel;await new T_(b=>h.onmessage=C=>{C.data==="registered"&&b(void 0)});const g=new RTCRtpScriptTransform(h,{name:"sei-rx",port:f.port2},[f.port2]);e.transform=g,await new T_(b=>h.onmessage=C=>{C.data==="started"&&b(void 0)}),f.port1.onmessage=b=>{var C;b.data.transformed&&e.track&&((C=e.track)===null||C===void 0?void 0:C.id)!==i.track.id?(Wt.debug("video track changed: ".concat(i.track.id," => ").concat(e.track.id)),i.track.removeEventListener("ended",d),i.track=e.track,i.track.addEventListener("ended",d)):b.data.sei&&i.onSei&&i.onSei(b.data.sei)},i.worker=h}function d(){if(e.track){if(this.id!==e.track.id)return;e.track.removeEventListener("ended",d)}(function(h){const f=YN.get(h);if(f){YN.delete(h);try{var g,b;(g=f.controller)===null||g===void 0||g.terminate(),(b=f.worker)===null||b===void 0||b.terminate()}catch(C){Wt.warning(C&&C.message)}}})(e)}YN.set(e,i),e.track.addEventListener("ended",d)}},Wft={name:"InterceptFrame",create:()=>qft};sF(),SE("PROCESS_ID","process-".concat(AE(8,""),"-").concat(AE(4,""),"-").concat(AE(4,""),"-").concat(AE(4,""),"-").concat(AE(12,""))),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(r){return void Wt.error("Error loading sdk config",r.message)}if(e)try{const r=JSON.parse(window.atob(e)),i=Date.now();Wt.debug("Loading global parameters from cache",r),Object.keys(r).forEach(d=>{if(Object.prototype.hasOwnProperty.call(VE,d)){const{value:h,expires:f}=r[d];if(f&&f<=i)return;gR[d]=h,VE[d]=h}})}catch(r){Wt.error("Error loading mutableParamsCache: ".concat(e),r.message)}}(),Array.isArray(gR.AREAS)&&gR.AREAS.length>0&&tG(gR.AREAS,!0);const iZ=(e,r,i)=>{Wt.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(r))),SE(e,r,i)};x0(pft,!1),x0(_ft,!1),x0(Jht,!1),x0(Cft,!1),x0(dft,!1),x0(jft,!1),x0(Gft,!1),x0(Wft,!1);const _y=function(e){const r=new qE,i=e,d={getListeners:r.getListeners.bind(r),on:(h,f)=>(function(g,b){g===FR.SECURITY_POLICY_VIOLATION&&V3(b,!0)}(h,f),r.on.bind(r)(h,f)),addListener:r.addListener.bind(r),once:r.once.bind(r),off:r.off.bind(r),removeAllListeners:r.removeAllListeners.bind(r),emit:r.emit.bind(r),safeEmit:r.safeEmit.bind(r)};return U3(U3({},i),d)}({__TRACK_LIST__:SO,VERSION:AT,BUILD:uF,ESM_BUNDLER:!1,ESM:!1,UMD:!0,DEV:!1,setParameter:iZ,getParameter:_s,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let r=new RTCPeerConnection;const i=await async function(d){let h;return uE().supportUnifiedPlan?(d.addTransceiver("video",{direction:"recvonly"}),d.addTransceiver("audio",{direction:"recvonly"}),h=(await d.createOffer()).sdp):h=(await d.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0})).sdp,h}(r);if(!i)return e;r.close(),r=null,e=function(d){const h={video:[],audio:[]};return d.match(/ VP8/i)&&h.video.push("VP8"),d.match(/ VP9/i)&&h.video.push("VP9"),d.match(/ AV1/i)&&h.video.push("AV1"),d.match(/ H264/i)&&h.video.push("H264"),d.match(/ H265/i)&&h.video.push("H265"),d.match(/ opus/i)&&h.audio.push("OPUS"),d.match(/ PCMU/i)&&h.audio.push("PCMU"),d.match(/ PCMA/i)&&h.audio.push("PCMA"),d.match(/ G722/i)&&h.audio.push("G722"),h}(i)}catch(r){throw new t_(Gi.CREATE_OFFER_FAILED,r.toString&&r.toString()).print()}return e},checkSystemRequirements:function(){const e=k_.reportApiInvoke(null,{name:QE.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:FE.TRACER});let r=!1;try{const f=window.RTCPeerConnection,g=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,b=window.WebSocket;r=!!(f&&g&&b),r&&zV()&&i4(75)&&new f().close()}catch(f){return Wt.error("check system requirement failed: ",f),!1}let i=!1;const d=oE();d.name===hE.CHROME&&Number(d.version)>=58&&(mR.engine.name!=="WebKit"||function(){const f=oE();if(SL()){if(f.os===aS.MAC_OS)return!0;if(f.os===aS.IOS){const g=mR.os.version&&mR.os.version.split(".");if(g&&Number(g[0])===14&&g[1]&&Number(g[1])>=3||g&&Number(g[0])>14)return!0}}return!1}())&&(i=!0),(d.name===hE.FIREFOX&&Number(d.version)>=56||d.name===hE.OPERA&&Number(d.version)>=45||d.name===hE.SAFARI&&Number(d.version)>=11||d.name==="WebKit"&&(LS()||JT())&&d.osVersion&&Number(d.osVersion.split(".")[0])>=11||d4()||oE().name===hE.QQ)&&(i=!0),Wt.debug("checkSystemRequirements, api:",r,"browser",i);const h=r&&i;return e.onSuccess(h),h},getDevices:function(e){return yT.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return yT.getRecordingDevices(e)},getCameras:function(e){return yT.getCamerasDevices(e)},getElectronScreenSources:i9,getPlaybackDevices:function(e){return yT.getSpeakers(e)},createClient:function(){var e;let r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const i=AE(5,"client-"),d=k_.reportApiInvoke(null,{id:i,name:QE.CREATE_CLIENT,options:[r],tag:FE.TRACER});try{(function(h){oS(h.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),oS(h.mode,"config.mode",["rtc","live","p2p"]),h.audioCodec!==void 0&&oS(h.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),h.proxyServer!==void 0&&fS(h.proxyServer,"config.proxyServer",1,1e4),h.turnServer!==void 0&&g4(h.turnServer),h.httpRetryConfig!==void 0&&E4(h.httpRetryConfig),h.websocketRetryConfig!==void 0&&E4(h.websocketRetryConfig)})(r)}catch(h){throw d.onError(h),h}return(a4(16,0)||WV(16,0,!0))&&(r.codec==="vp9"&&(r.codec="vp8",Wt.debug("browser not support vp9, force use vp8")),SE("UNSUPPORTED_VIDEO_CODEC",["vp9"])),r.audioCodec===void 0&&(r.audioCodec="opus"),d.onSuccess(),new Xht(iR(iR({forceWaitGatewayResponse:!0},r),{},{role:E_(e=["rtc","p2p"]).call(e,r.mode)?"host":r.role||"audience"}),i)},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=_s("CAMERA_CAPTURE_CONFIG"),i=AE(8,"track-cam-"),d=k_.reportApiInvoke(null,{id:i,tag:FE.TRACER,name:QE.CREATE_CAM_VIDEO_TRACK,options:[DE({},e),r]});r&&(e.encoderConfig=r);const h=UL(e);let f=null;Wt.info("start create camera video track with config",JSON.stringify(e),"trackId",i);try{f=(await bT({video:h},i)).getVideoTracks()[0]||null}catch(b){throw d.onError(b),b}if(!f){const b=new n_(Gi.UNEXPECTED_ERROR,"can not find track in media stream");return d.onError(b),b.throw(Wt)}if(e.optimizationMode&&CF(i,f,e,ZT(e.encoderConfig)),_s("USE_STANDARD_BITRATE_DEFAULT")){const b=ZT(e.encoderConfig);e.encoderConfig=b,delete b.bitrateMax,delete b.bitrateMin}const g=new VL(f,e,h,e.scalabiltyMode?kL(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,i);return d.onSuccess(g.getTrackId()),Wt.info("create camera video success, trackId:",i),g},createCustomVideoTrack:function(e){const r=AE(8,"track-cus-"),i=k_.reportApiInvoke(null,{id:r,tag:FE.TRACER,name:QE.CREATE_CUSTOM_VIDEO_TRACK,options:[e]});_s("USE_STANDARD_BITRATE_DEFAULT")&&(delete e.bitrateMax,delete e.bitrateMin);const d=new LE(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?kL(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r,[wE.CUSTOM_TRACK]);return i.onSuccess(d.getTrackId()),Wt.info("create custom video track success with config",e,"trackId",d.getTrackId()),d},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const i=typeof r=="object"?function($){return f9($)}(r):void 0;i&&(r="auto");const d=AE(8,"track-scr-v-"),h=k_.reportApiInvoke(null,{id:d,tag:FE.TRACER,name:QE.CREATE_SCREEN_VIDEO_TRACK,options:[DE({},e),r]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const f=function($){const _t={};$.screenSourceType&&(_t.mediaSource=$.screenSourceType),$.extensionId&&e0()&&(_t.extensionId=$.extensionId);const{displaySurface:_i,selfBrowserSurface:ue,surfaceSwitching:_r,systemAudio:Fi,preferCurrentTab:Di}=$;(pO(107)||GV(107)||KV(93))&&(_i&&(oS(_i,"displaySurface",["browser","window","monitor"]),_t.displaySurface=_i),ue?(oS(ue,"selfBrowserSurface",["exclude","include"]),_t.selfBrowserSurface=ue):_t.selfBrowserSurface="include",_r&&(oS(_r,"surfaceSwitching",["exclude","include"]),_t.surfaceSwitching=_r)),(pO(105)||GV(105)||KV(91))&&Fi&&(oS(Fi,"systemAudio",["exclude","include"]),_t.systemAudio=Fi),(pO(94)||GV(94)||KV(80))&&Di&&(_t.preferCurrentTab=!0),$.electronScreenSourceId&&(_t.sourceId=$.electronScreenSourceId);const Js=$.encoderConfig?mF($.encoderConfig):null;return _t.mandatory={chromeMediaSource:"desktop",maxWidth:Js?Js.width:void 0,maxHeight:Js?Js.height:void 0},Js&&(Js.frameRate&&(typeof Js.frameRate=="number"?(_t.mandatory.maxFrameRate=Js.frameRate,_t.mandatory.minFrameRate=Js.frameRate):(_t.mandatory.maxFrameRate=Js.frameRate.max||Js.frameRate.ideal||Js.frameRate.exact||void 0,_t.mandatory.minFrameRate=Js.frameRate.min||Js.frameRate.ideal||Js.frameRate.exact||void 0),_t.frameRate=Js.frameRate),Js.width&&(_t.width=Js.width),Js.height&&(_t.height=Js.height)),_t}(e);let g=null,b=null;const C=uE();if(!C.supportShareAudio&&r==="enable"){const $=new n_(Gi.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return h.onError($),$.throw(Wt)}Wt.info("start create screen video track with config",e,"withAudio",r,"trackId",d);const P=C.supportShareAudio&&r!=="disable";try{const $=await bT({screen:f,screenAudio:P?i||!0:void 0},d);g=$.getVideoTracks()[0]||null,b=$.getAudioTracks()[0]||null}catch($){throw h.onError($),$}if(!g){const $=new n_(Gi.UNEXPECTED_ERROR,"can not find track in media stream");return h.onError($),$.throw(Wt)}if(!b&&r==="enable"){g&&g.stop();const $=new n_(Gi.SHARE_AUDIO_NOT_ALLOWED);return h.onError($),$.throw(Wt)}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(CF(d,g,e,e.encoderConfig&&mF(e.encoderConfig)||void 0),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const x=new LE(g,e.encoderConfig?mF(e.encoderConfig):{},e.scalabiltyMode?kL(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,d,[wE.SCREEN_TRACK]);if(!b)return h.onSuccess(x.getTrackId()),Wt.info("create screen video track success","video:",x.getTrackId()),x;const H=new XE(b,void 0,AE(8,"track-scr-a-"),!1);return h.onSuccess([x.getTrackId(),H.getTrackId()]),Wt.info("create screen video track success","video:",x.getTrackId(),"audio:",H.getTrackId()),[x,H]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const i=_s("CAMERA_CAPTURE_CONFIG"),d=AE(8,"track-mic-"),h=AE(8,"track-cam-"),f=k_.reportApiInvoke(null,{id:"".concat(d,"-").concat(h),tag:FE.TRACER,name:QE.CREATE_MIC_AND_CAM_TRACKS,options:[e,r,i]});i&&(r.encoderConfig=i);const g=UL(r),b=m9(e);let C=null,P=null;Wt.info("start create camera video track(".concat(h,") and microphone audio track(").concat(d,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(r)));try{const $=await bT({audio:b,video:g},"".concat(d,"-").concat(h));C=$.getAudioTracks()[0],P=$.getVideoTracks()[0]}catch($){throw f.onError($),$}if(!C||!P){const $=new n_(Gi.UNEXPECTED_ERROR,"can not find tracks in media stream");return f.onError($),$.throw(Wt)}if(r.optimizationMode&&CF(h,P,r,ZT(r.encoderConfig)),_s("USE_STANDARD_BITRATE_DEFAULT")){const $=ZT(r.encoderConfig);r.encoderConfig=$,delete $.bitrateMax,delete $.bitrateMin}const x=new zN(C,e,b,d),H=new VL(P,r,g,r.scalabiltyMode?kL(r.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},r.optimizationMode,h);return f.onSuccess([x.getTrackId(),H.getTrackId()]),Wt.info("create camera video track(".concat(h,") and microphone audio track(").concat(d,") success")),[x,H]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const r=AE(8,"track-mic-"),i=k_.reportApiInvoke(null,{id:r,tag:FE.TRACER,name:QE.CREATE_MIC_AUDIO_TRACK,options:[e]}),d=m9(e);let h=null;Wt.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{h=(await bT({audio:d},r)).getAudioTracks()[0]||null}catch(g){throw i.onError(g),g}if(!h){const g=new n_(Gi.UNEXPECTED_ERROR,"can not find track in media stream");return i.onError(g),g.throw(Wt)}const f=new zN(h,e,d,r);return i.onSuccess(f.getTrackId()),Wt.info("create microphone audio track success, trackId:",r),f},createCustomAudioTrack:function(e){const r=AE(8,"track-cus-"),i=k_.reportApiInvoke(null,{id:r,tag:FE.TRACER,name:QE.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),d=new XE(e.mediaStreamTrack,e.encoderConfig?LL(e.encoderConfig):{},r,!1);return Wt.info("create custom audio track success with config",e,"trackId",d.getTrackId()),i.onSuccess(d.getTrackId()),d},createBufferSourceAudioTrack:async function(e){var r;const{cacheOnlineFile:i,encoderConfig:d}=e;let{source:h}=e;const f={source:h instanceof AudioBuffer?"AudioBuffer":h instanceof File?(r=File.name)!==null&&r!==void 0?r:"File":h,cacheOnlineFile:i,encoderConfig:d},g=AE(8,"track-buf-"),b=k_.reportApiInvoke(null,{id:g,tag:FE.TRACER,name:QE.CREATE_BUFFER_AUDIO_TRACK,options:[f]});if(_s("DISABLE_WEBAUDIO"))throw new n_(Gi.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");Wt.info("start create buffer source audio track with config",JSON.stringify(f),"trackId",g);const C=h;if(!(h instanceof AudioBuffer))try{h=await async function(H,$){let _t=null;if(typeof H=="string"){const ue=e7.get(H);if(ue)return Wt.debug("use cached audio resource: ",H),ue;try{_t=(await ER(()=>zS.get(H,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(_r){throw new n_(Gi.FETCH_AUDIO_FILE_FAILED,_r.toString())}}else _t=await new T_((_r,Fi)=>{const Di=new FileReader;Di.onload=Js=>{Js.target?_r(Js.target.result):Fi(new n_(Gi.READ_LOCAL_AUDIO_FILE_ERROR))},Di.onerror=()=>{Fi(new n_(Gi.READ_LOCAL_AUDIO_FILE_ERROR))},Di.readAsArrayBuffer(H)});const _i=await function(ue){const _r=CO();return new T_((Fi,Di)=>{_r.decodeAudioData(ue,Js=>{Fi(Js)},Js=>{Di(new n_(Gi.DECODE_AUDIO_FILE_FAILED,Js.toString()))})})}(_t);return typeof H=="string"&&$&&e7.set(H,_i),_i}(h,i)}catch(H){return b.onError(H),H.throw(Wt)}const P=new Elt(h),x=new _lt(C,P,d?LL(d):{},g);return Wt.info("create buffer source audio track success, trackId:",g),b.onSuccess(x.getTrackId()),x},setAppType:function(e){if(Wt.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw Wt.debug("Invalid appType"),new t_(Gi.INVALID_PARAMS,"invalid app type",e);SE("APP_TYPE",Math.floor(e))},setLogLevel:function(e){Wt.setLogLevel(e)},enableLogUpload:function(){_s("USE_NEW_LOG")?SE("UPLOAD_LOG",!0):Wt.enableLogUpload()},disableLogUpload:function(){_s("USE_NEW_LOG")?SE("UPLOAD_LOG",!1):Wt.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new iX},checkAudioTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=k_.reportApiInvoke(null,{tag:FE.TRACER,name:QE.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof XE||e instanceof NO)){const C=new t_(Gi.INVALID_TRACK,"the parameter is not a audio track");return i.onError(C),C.throw()}r&&r<1e3&&(r=1e3);const d=e instanceof XE?e.getTrackLabel():"remote_track",h=e.getVolumeLevel();let f=h,g=h;const b=Date.now();return new T_(C=>{const P=setInterval(()=>{const x=e.getVolumeLevel();f=x>f?x:f,g=x<g?x:g;const H=f-g>1e-4,$=Date.now()-b;if(H||$>r){clearInterval(P);const _t=H,_i={duration:$,deviceLabel:d,maxVolumeLevel:f,result:_t};Wt.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(_i))),i.onSuccess(_i),C(_t)}},200)})},checkVideoTrackIsActive:async function(e){let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const i=k_.reportApiInvoke(null,{tag:FE.TRACER,name:QE.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[r]});if(!(e instanceof LE||e instanceof OO)){const H=new t_(Gi.INVALID_TRACK,"the parameter is not a video track");return i.onError(H),H.throw()}r&&r<1e3&&(r=1e3);const d=e instanceof LE?e.getTrackLabel():"remote_track",h=e.getMediaStreamTrack(!0),f=document.createElement("video");f.style.width="1px",f.style.height="1px",f.setAttribute("muted",""),f.muted=!0,f.setAttribute("playsinline",""),f.controls=!1,(yS()||SL())&&(f.style.opacity="0.01",f.style.position="fixed",f.style.left="0",f.style.top="0",document.body.appendChild(f)),f.srcObject=new MediaStream([h]),f.play();const g=document.createElement("canvas");g.width=160,g.height=120;let b=0,C=0;try{const H=Date.now();b=await function($,_t,_i,ue){let _r,Fi=0,Di=null;return new T_((Js,_l)=>{function _u(){Fi>ue&&_r&&(_r(),Js(Fi));const ga=_i.getContext("2d");if(!ga){const a_=new t_(Gi.UNEXPECTED_ERROR,"can not get canvas 2d context.");return Wt.error(a_.toString()),void _l(a_)}ga.drawImage($,0,0,160,120);const _m=ga.getImageData(0,0,_i.width,_i.height),r_=Math.floor(_m.data.length/3);if(Di){for(let a_=0;a_<r_;a_+=3)if(_m.data[a_]!==Di[a_])return Fi+=1,void(Di=_m.data);Di=_m.data}else Di=_m.data}setTimeout(()=>{_r&&(_r(),Js(Fi))},_t),_r=bF(()=>{_u()},30)})}(f,r,g,4),C=Date.now()-H}catch(H){throw i.onError(H),H}xht===hE.SAFARI&&(f.pause(),f.remove()),f.srcObject=null;const P=b>4,x={duration:C,changedPicNum:b,deviceLabel:d,result:P};return Wt.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(x))),i.onSuccess(x),P},setArea:tG,audioElementPlayCenter:YS,resumeAudioContext:function(){YS.autoResumeAfterInterruption(!0)},processExternalMediaAEC:function(e){Zht.processExternalMediaAEC(e)},registerExtensions:function(e){const r=_s("PLUGIN_INFO")||[];e.forEach(i=>{"name"in i&&!E_(r).call(r,i.name)&&r.push(i.name);const d=i;d.__registered__=!0,d.logger.hookLog=Wt.extLog,d.reporter.hookApiInvoke=k_.extApiInvoke,d.parameters&&Object.keys(d.parameters).forEach(h=>{d.parameters[h]=_s(h)})}),iZ("PLUGIN_INFO",r)},ChannelMediaRelayError:kO,ChannelMediaRelayEvent:o0,ChannelMediaRelayState:eT,RemoteStreamFallbackType:ult,RemoteStreamType:clt,ConnectionDisconnectedReason:_E,AudienceLatencyLevelType:jdt,AREAS:fE,preload:async function(e,r,i,d){return AX(e,r,i,d)}});return Object.defineProperties(_y,{onAudioAutoplayFailed:{get:()=>ST.onAudioAutoplayFailed,set:e=>{ST.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>ST.onAutoplayFailed,set:e=>{ST.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>_y._onSecurityPolicyViolation,set(e){_y._onSecurityPolicyViolation=e,V3(e)}},__CLIENT_LIST__:{get:()=>_s("SHOW_GLOBAL_CLIENT_LIST")?bI:[]}}),yT.on(_I.CAMERA_DEVICE_CHANGED,e=>{Wt.info("camera device changed",JSON.stringify(e)),_y.onCameraChanged&&_y.onCameraChanged(e),_y.safeEmit(FR.CAMERA_CHANGED,e)}),yT.on(_I.RECORDING_DEVICE_CHANGED,e=>{Wt.info("microphone device changed",JSON.stringify(e)),_y.onMicrophoneChanged&&_y.onMicrophoneChanged(e),_y.safeEmit(FR.MICROPHONE_CHANGED,e)}),yT.on(_I.PLAYOUT_DEVICE_CHANGED,e=>{Wt.debug("playout device changed",JSON.stringify(e)),_y.onPlaybackDeviceChanged&&_y.onPlaybackDeviceChanged(e),_y.safeEmit(FR.PLAYBACK_DEVICE_CHANGED,e)}),YS.onAutoplayFailed=()=>{Wt.info("detect audio element autoplay failed"),ST.onAudioAutoplayFailed&&ST.onAudioAutoplayFailed()},TE.on("autoplay-failed",()=>{Wt.info("detect webaudio autoplay failed"),ST.onAudioAutoplayFailed&&ST.onAudioAutoplayFailed(),_y.safeEmit(FR.AUTOPLAY_FAILED)}),TE.on(ES.STATE_CHANGE,(e,r)=>{Wt.info("audio context state changed: ".concat(r," => ").concat(e)),_y.onAudioContextStateChanged&&_y.onAudioContextStateChanged(e,r),_y.safeEmit(FR.AUDIO_CONTEXT_STATE_CHANGED,e,r)}),Fg.on(mO.NETWORK_STATE_CHANGE,(e,r)=>{Wt.info("[network-indicator] network state changed, ".concat(r," => ").concat(e))}),window&&(window.__ARTC__=_y),_y})})(AgoraRTC_NProduction);var AgoraRTC_NProductionExports=AgoraRTC_NProduction.exports;const AgoraRTC__default=getDefaultExportFromCjs(AgoraRTC_NProductionExports);function _objectWithoutPropertiesLoose(s,o){if(s==null)return{};var l={},p=Object.keys(s),_,A;for(A=0;A<p.length;A++)_=p[A],!(o.indexOf(_)>=0)&&(l[_]=s[_]);return l}var AgoraRTCErrorCode;(function(s){s.UNEXPECTED_ERROR="UNEXPECTED_ERROR",s.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",s.TIMEOUT="TIMEOUT",s.INVALID_PARAMS="INVALID_PARAMS",s.NOT_SUPPORTED="NOT_SUPPORTED",s.INVALID_OPERATION="INVALID_OPERATION",s.OPERATION_ABORTED="OPERATION_ABORTED",s.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",s.NETWORK_ERROR="NETWORK_ERROR",s.NETWORK_TIMEOUT="NETWORK_TIMEOUT",s.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",s.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",s.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",s.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",s.ELECTRON_IS_NULL="ELECTRON_IS_NULL",s.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",s.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",s.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",s.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",s.PERMISSION_DENIED="PERMISSION_DENIED",s.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",s.TRACK_IS_DISABLED="TRACK_IS_DISABLED",s.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",s.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",s.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",s.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",s.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",s.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",s.UID_CONFLICT="UID_CONFLICT",s.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",s.INVALID_TRACK="INVALID_TRACK",s.SENDER_NOT_FOUND="SENDER_NOT_FOUND",s.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",s.SET_ANSWER_FAILED="SET_ANSWER_FAILED",s.ICE_FAILED="ICE_FAILED",s.PC_CLOSED="PC_CLOSED",s.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",s.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",s.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",s.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",s.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",s.INVALID_REMOTE_USER="INVALID_REMOTE_USER",s.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",s.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",s.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",s.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",s.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",s.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",s.WS_ABORT="WS_ABORT",s.WS_DISCONNECT="WS_DISCONNECT",s.WS_ERR="WS_ERR",s.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",s.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",s.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",s.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",s.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",s.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",s.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",s.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",s.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",s.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",s.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",s.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",s.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",s.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",s.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",s.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",s.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",s.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE"})(AgoraRTCErrorCode||(AgoraRTCErrorCode={}));var createClient=function(o){var l;function p(){return l||(l=AgoraRTC__default.createClient(o)),l}return function(){return p()}};function createMicrophoneAndCameraTracks(s,o){var l=function(){try{return Promise.resolve(AgoraRTC__default.createMicrophoneAndCameraTracks(s,o)).then(function(A){return p=A,p})}catch(A){return Promise.reject(A)}},p=null;return function(){var A=reactExports.useState(!1),k=A[0],j=A[1],B=reactExports.useState(null),z=B[0],Vt=B[1],_e=reactExports.useRef(p);return reactExports.useEffect(function(){return _e.current===null?l().then(function(_n){_e.current=_n,j(!0)},function(_n){Vt(_n)}):j(!0),function(){p=null}},[]),{ready:k,tracks:_e.current,error:z}}}var AgoraVideoPlayer=function(o){var l=reactExports.useRef(null),p=o.videoTrack,_=o.config,A=_objectWithoutPropertiesLoose(o,["videoTrack","config"]);return reactExports.useLayoutEffect(function(){return l.current!==null&&p.play(l.current,_),function(){p.stop()}},[p]),React.createElement("div",Object.assign({},A,{ref:l}))},agoraRtmSdk={exports:{}};agoraRtmSdk.exports;(function(module,exports){var define_process_env_default={};/*
 @preserve
 AgoraRTM Web SDK 1.4.3-203 - commit: v1.4.3-17-g1e27aa38
 Copyright (C) 2018-2021 Agora Lab.
 This file is licensed under the AGORA, INC. SDK LICENSE AGREEMENT
 A copy of this license may be found at https://www.agora.io/en/sdk-license-agreement/
*/(function(s,o){module.exports=o()})(commonjsGlobal,function(){function be(s,o){var l=Object.keys(s);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(s);o&&(p=p.filter(function(_){return Object.getOwnPropertyDescriptor(s,_).enumerable})),l.push.apply(l,p)}return l}function ua(s){for(var o=1;o<arguments.length;o++){var l=arguments[o]!=null?arguments[o]:{};o%2?be(Object(l),!0).forEach(function(p){m(s,p,l[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(s,Object.getOwnPropertyDescriptors(l)):be(Object(l)).forEach(function(p){Object.defineProperty(s,p,Object.getOwnPropertyDescriptor(l,p))})}return s}function X(s){return(X=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(s)}function sl(s,o,l,p,_,A,k){try{var j=s[A](k),B=j.value}catch(z){return void l(z)}j.done?o(B):Promise.resolve(B).then(p,_)}function J(s){return function(){var o=this,l=arguments;return new Promise(function(p,_){function A(B){sl(j,p,_,A,k,"next",B)}function k(B){sl(j,p,_,A,k,"throw",B)}var j=s.apply(o,l);A(void 0)})}}function W(s,o){if(!(s instanceof o))throw new TypeError("Cannot call a class as a function")}function tl(s,o){for(var l=0;l<o.length;l++){var p=o[l];p.enumerable=p.enumerable||!1,p.configurable=!0,"value"in p&&(p.writable=!0),Object.defineProperty(s,p.key,p)}}function Ha(s,o,l){return o&&tl(s.prototype,o),l&&tl(s,l),s}function m(s,o,l){return o in s?Object.defineProperty(s,o,{value:l,enumerable:!0,configurable:!0,writable:!0}):s[o]=l,s}function la(s,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");s.prototype=Object.create(o&&o.prototype,{constructor:{value:s,writable:!0,configurable:!0}}),o&&df(s,o)}function wd(s){return(wd=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(s)}function df(s,o){return(df=Object.setPrototypeOf||function(l,p){return l.__proto__=p,l})(s,o)}function ul(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Sh(s,o,l){return(Sh=ul()?Reflect.construct:function(p,_,A){var k=[null];return k.push.apply(k,_),p=new(Function.bind.apply(p,k)),A&&df(p,A.prototype),p}).apply(null,arguments)}function ef(s){var o=typeof Map=="function"?new Map:void 0;return(ef=function(l){function p(){return Sh(l,arguments,wd(this).constructor)}if(l===null||Function.toString.call(l).indexOf("[native code]")===-1)return l;if(typeof l!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(l))return o.get(l);o.set(l,p)}return p.prototype=Object.create(l.prototype,{constructor:{value:p,enumerable:!1,writable:!0,configurable:!0}}),df(p,l)})(s)}function ff(s,o){if(s==null)return{};if(s==null)var l={};else{l={};var p,_=Object.keys(s);for(p=0;p<_.length;p++){var A=_[p];0<=o.indexOf(A)||(l[A]=s[A])}}if(Object.getOwnPropertySymbols)for(p=Object.getOwnPropertySymbols(s),A=0;A<p.length;A++)_=p[A],0<=o.indexOf(_)||Object.prototype.propertyIsEnumerable.call(s,_)&&(l[_]=s[_]);return l}function n(s){if(s===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return s}function ma(s){var o=ul();return function(){var l=wd(s);if(o){var p=wd(this).constructor;l=Reflect.construct(l,arguments,p)}else l=l.apply(this,arguments);return l=!l||typeof l!="object"&&typeof l!="function"?n(this):l}}function Th(s,o,l){return(Th=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(p,_,A){for(;!Object.prototype.hasOwnProperty.call(p,_)&&(p=wd(p))!==null;);if(p)return(_=Object.getOwnPropertyDescriptor(p,_)).get?_.get.call(A):_.value})(s,o,l||s)}function ra(s,o){var l=Array.isArray(s)?s:void 0;if(!l)if((l=s&&(typeof Symbol<"u"&&s[Symbol.iterator]||s["@@iterator"]))==null)l=void 0;else{var p,_=[],A=!0,k=!1;try{for(l=l.call(s);!(A=(p=l.next()).done)&&(_.push(p.value),!o||_.length!==o);A=!0);}catch(B){k=!0;var j=B}finally{try{A||l.return==null||l.return()}finally{if(k)throw j}}l=_}if(!(s=l||vl(s,o)))throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return s}function G(s){var o=Array.isArray(s)?Uh(s):void 0;if(o||(o=typeof Symbol<"u"&&s[Symbol.iterator]!=null||s["@@iterator"]!=null?Array.from(s):void 0),!(s=o||vl(s)))throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`);return s}function vl(s,o){if(s){if(typeof s=="string")return Uh(s,o);var l=Object.prototype.toString.call(s).slice(8,-1);if(l==="Object"&&s.constructor&&(l=s.constructor.name),l==="Map"||l==="Set")return Array.from(s);if(l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l))return Uh(s,o)}}function Uh(s,o){(o==null||o>s.length)&&(o=s.length);for(var l=0,p=Array(o);l<o;l++)p[l]=s[l];return p}function fa(s,o,l,p,_){var A={};return Object.keys(p).forEach(function(k){A[k]=p[k]}),A.enumerable=!!A.enumerable,A.configurable=!!A.configurable,("value"in A||A.initializer)&&(A.writable=!0),A=l.slice().reverse().reduce(function(k,j){return j(s,o,k)||k},A),_&&A.initializer!==void 0&&(A.value=A.initializer?A.initializer.call(_):void 0,A.initializer=void 0),A.initializer===void 0&&(Object.defineProperty(s,o,A),A=null),A}function $a(s){var o={exports:{}};return s(o,o.exports),o.exports}function wl(s,o){var l,p=3>arguments.length?s:arguments[2];return va(s)===p?s[o]:(l=Fb.f(s,o))?Q(l,"value")?l.value:l.get===void 0?void 0:l.get.call(p):ha(l=Vb(s))?wl(l,o,p):void 0}function rs(s){var o=s.charCodeAt(0)<<24,l=0|ss(~o),p=0,_=0|s.length,A="";if(5>l&&_>=l){for(o=o<<l>>>24+l,p=1;p<l;p=p+1|0)o=o<<6|63&s.charCodeAt(p);65535>=o?A+=xd(o):1114111>=o?A+=xd(55296+((o=o-65536|0)>>10)|0,56320+(1023&o)|0):p=0}for(;p<_;p=p+1|0)A+="�";return A}function xl(){}function ts(s){var o=0|s.charCodeAt(0);if(55296<=o&&56319>=o){var l=0|s.charCodeAt(1);if(!(l==l&&56320<=l&&57343>=l))return xd(239,191,189);if(65535<(o=(o-55296<<10)+l-56320+65536|0))return xd(240|o>>>18,128|o>>>12&63,128|o>>>6&63,128|63&o)}return 127>=o?s:2047>=o?xd(192|o>>>6,128|63&o):xd(224|o>>>12,128|o>>>6&63,128|63&o)}function yl(){}function ea(){ea.init.call(this)}function ng(s){if(typeof s!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+X(s))}function zl(s,o,l,p){ng(l);var _=s._events;if(_===void 0)_=s._events=Object.create(null),s._eventsCount=0;else{_.newListener!==void 0&&(s.emit("newListener",o,l.listener?l.listener:l),_=s._events);var A=_[o]}return A===void 0?(_[o]=l,++s._eventsCount):(typeof A=="function"?A=_[o]=p?[l,A]:[A,l]:p?A.unshift(l):A.push(l),0<(l=s._maxListeners===void 0?ea.defaultMaxListeners:s._maxListeners)&&A.length>l&&!A.warned&&(A.warned=!0,(l=Error("Possible EventEmitter memory leak detected. "+A.length+" "+String(o)+" listeners added. Use emitter.setMaxListeners() to increase limit")).name="MaxListenersExceededWarning",l.emitter=s,l.type=o,l.count=A.length,console&&console.warn&&console.warn(l))),s}function us(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Al(s,o,l){return s={fired:!1,wrapFn:void 0,target:s,type:o,listener:l},(o=us.bind(s)).listener=l,s.wrapFn=o}function Bl(s,o,l){if((s=s._events)===void 0)return[];if((o=s[o])===void 0)return[];if(typeof o=="function")return l?[o.listener||o]:[o];if(l)for(l=Array(o.length),s=0;s<l.length;++s)l[s]=o[s].listener||o[s];else l=Cl(o,o.length);return l}function Dl(s){var o=this._events;if(o!==void 0){if(typeof(s=o[s])=="function")return 1;if(s!==void 0)return s.length}return 0}function Cl(s,o){for(var l=Array(o),p=0;p<o;++p)l[p]=s[p];return l}function vs(s,o,l){typeof s.on=="function"&&El(s,"error",o,l)}function El(s,o,l,p){if(typeof s.on=="function")p.once?s.once(o,l):s.on(o,l);else{if(typeof s.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+X(s));s.addEventListener(o,function _(A){p.once&&s.removeEventListener(o,_),l(A)})}}function ws(s){return s?G(s):xs(function(){return[]},function(o,l){return o.push(l),o})}function Fl(s,o){var l,p,_,A;return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:l=Gl(s)([Hl,Hl,function(j,B){return B}])[2],p=0;case 2:if(!(p<o.length)){k.next=17;break}if(_=o[p],!((A=l(Vh,_))instanceof og)){k.next=11;break}if((A=Wh(A.deref()))===Vh){k.next=10;break}return k.next=10,A;case 10:return k.abrupt("return");case 11:if(A===Vh){k.next=14;break}return k.next=14,A;case 14:p++,k.next=2;break;case 17:case"end":return k.stop()}},ys)}function pg(s,o){return o!=null&&typeof o[Symbol.iterator]=="function"?Fl(pg(s),o):function(l){var p=l[2];return zs(l,function(_,A){return p(_,s(A))})}}function Ac(s){return Object.prototype.toString.call(s).slice(8,-1)}function yd(s){return Ac(s)==="Object"&&s.constructor===Object&&Object.getPrototypeOf(s)===Object.prototype}function Il(s){var o;return(o=Ac(s)==="Boolean"||Ac(s)==="Null"||Ac(s)==="Undefined")||(o=Ac(s)==="Number"&&!isNaN(s)),o||Ac(s)==="String"||Ac(s)==="Symbol"}function zd(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var p=s[o];this.set(p[0],p[1])}}function ce(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var p=s[o];this.set(p[0],p[1])}}function de(s){var o=-1,l=s==null?0:s.length;for(this.clear();++o<l;){var p=s[o];this.set(p[0],p[1])}}function gf(s){var o=-1,l=s==null?0:s.length;for(this.__data__=new qg;++o<l;)this.add(s[o])}function ee(s){this.size=(this.__data__=new rg(s)).size}function fe(s,o,l,p,_,A){var k,j=1&o,B=2&o,z=4&o;if(l&&(k=_?l(s,p,_,A):l(s)),k!==void 0)return k;if(!lb(s))return s;if(p=Va(s)){if(k=As(s),!j)return Xh(s,k)}else{var Vt=hf(s),_e=Vt=="[object Function]"||Vt=="[object GeneratorFunction]";if(jf(s))return Jl(s,j);if(Vt=="[object Object]"||Vt=="[object Arguments]"||_e&&!_){if(k=B||_e?{}:Kl(s),!j)return B?Bs(s,Cs(k,s)):Ds(s,Es(k,s))}else{if(!wa[Vt])return _?s:{};k=Fs(s,Vt,j)}}if(A||(A=new ge),_=A.get(s))return _;A.set(s,k),Gs(s)?s.forEach(function(_o){k.add(fe(_o,o,l,_o,s,A))}):Hs(s)&&s.forEach(function(_o,_c){k.set(_c,fe(_o,o,l,_c,s,A))}),B=z?B?Ll:Yh:B?kf:Ad;var _n=p?void 0:B(s);return Is(_n||s,function(_o,_c){_n&&(_o=s[_c=_o]),Ml(k,_c,fe(_o,o,l,_c,s,A))}),k}function Zh(s,o){if(typeof s!="function"||o!=null&&typeof o!="function")throw new TypeError("Expected a function");var l=function p(){var _=arguments,A=o?o.apply(this,_):_[0],k=p.cache;return k.has(A)?k.get(A):(_=s.apply(this,_),p.cache=k.set(A,_)||k,_)};return l.cache=new(Zh.Cache||qg),l}function Nl(s){if(typeof s=="string")return s;if(Va(s))return he(s,Nl)+"";if(ie(s))return Ol?Ol.call(s):"";var o=s+"";return o=="0"&&1/s==-1/0?"-0":o}function $h(s,o,l,p,_){var A=-1,k=s.length;for(l||(l=Ks),_||(_=[]);++A<k;){var j=s[A];l(j)?ai(_,j):_[_.length]=j}return _}function je(s,o,l,p,_){if(s===o)o=!0;else if(s==null||o==null||!gc(s)&&!gc(o))o=s!=s&&o!=o;else t:{var A=Va(s),k=Va(o),j=A?"[object Array]":hf(s),B=k?"[object Array]":hf(o),z=(j=j=="[object Arguments]"?"[object Object]":j)=="[object Object]";if(k=(B=B=="[object Arguments]"?"[object Object]":B)=="[object Object]",(B=j==B)&&jf(s)){if(!jf(o)){o=!1;break t}A=!0,z=!1}if(B&&!z)_||(_=new ge),o=A||bi(s)?Pl(s,o,l,p,je,_):Ls(s,o,j,l,p,je,_);else{if(!(1&l)&&(A=z&&Ql.call(s,"__wrapped__"),j=k&&Ql.call(o,"__wrapped__"),A||j)){s=A?s.value():s,o=j?o.value():o,_||(_=new ge),o=je(s,o,l,p,_);break t}if(B)e:if(_||(_=new ge),A=1&l,j=Yh(s),k=j.length,B=Yh(o).length,k==B||A){for(B=k;B--;){var Vt=j[B];if(!(A?Vt in o:Ms.call(o,Vt))){o=!1;break e}}if(z=_.get(s),Vt=_.get(o),z&&Vt)o=z==o&&Vt==s;else{z=!0,_.set(s,o),_.set(o,s);for(var _e=A;++B<k;){var _n=s[Vt=j[B]],_o=o[Vt];if(p)var _c=A?p(_o,_n,Vt,o,s,_):p(_n,_o,Vt,s,o,_);if(_c===void 0?_n!==_o&&!je(_n,_o,l,p,_):!_c){z=!1;break}_e||(_e=Vt=="constructor")}z&&!_e&&(l=s.constructor)!=(p=o.constructor)&&"constructor"in s&&"constructor"in o&&!(typeof l=="function"&&l instanceof l&&typeof p=="function"&&p instanceof p)&&(z=!1),_.delete(s),_.delete(o),o=z}}else o=!1;else o=!1}}return o}function xa(s,o,l){this.low=0|s,this.high=0|o,this.unsigned=!!l}function mb(s){return(s&&s.__isLong__)===!0}function Bd(s,o){var l;if(o){if((o=0<=(s>>>=0)&&256>s)&&(l=Rl[s]))return l;l=ya(s,0>(0|s)?-1:0,!0),o&&(Rl[s]=l)}else{if((o=-128<=(s|=0)&&128>s)&&(l=Sl[s]))return l;l=ya(s,0>s?-1:0,!1),o&&(Sl[s]=l)}return l}function Gb(s,o){if(isNaN(s))return o?Cd:Hb;if(o){if(0>s)return Cd;if(s>=Tl)return Ul}else{if(s<=-Vl)return nb;if(s+1>=Vl)return Wl}return 0>s?Gb(-s,o).neg():ya(s%ke|0,s/ke|0,o)}function ya(s,o,l){return new xa(s,o,l)}function ci(s,o,l){if(s.length===0)throw Error("empty string");if(s==="NaN"||s==="Infinity"||s==="+Infinity"||s==="-Infinity")return Hb;if(typeof o=="number"?(l=o,o=!1):o=!!o,2>(l=l||10)||36<l)throw RangeError("radix");var p;if(0<(p=s.indexOf("-")))throw Error("interior hyphen");if(p===0)return ci(s.substring(1),o,l).neg();p=Gb(sg(l,8));for(var _=Hb,A=0;A<s.length;A+=8){var k=Math.min(8,s.length-A),j=parseInt(s.substring(A,A+k),l);8>k?(k=Gb(sg(l,k)),_=_.mul(k).add(Gb(j))):_=(_=_.mul(p)).add(Gb(j))}return _.unsigned=o,_}function Wb(s,o){return typeof s=="number"?Gb(s,o):typeof s=="string"?ci(s,o):ya(s.low,s.high,typeof o=="boolean"?o:s.unsigned)}function O(s,o){function l(){this.constructor=s}di(s,o),s.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}function le(s){return typeof s=="function"}function me(s){setTimeout(function(){throw s},0)}function ei(s){return s!==null&&X(s)==="object"}function Xl(s){return s.reduce(function(o,l){return o.concat(l instanceof lf?l.errors:l)},[])}function fi(s){for(;s;){var o=s.destination,l=s.isStopped;if(s.closed||l)return!1;s=o&&o instanceof ia?o:null}return!0}function Yc(s){return s}function gi(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];return Yl(s)}function Yl(s){return s.length===0?Yc:s.length===1?s[0]:function(o){return s.reduce(function(l,p){return p(l)},o)}}function Zl(s){if(s||(s=Ib.Promise||Promise),!s)throw Error("no Promise impl found");return s}function $l(){return function(s){return s.lift(new Ns(s))}}function mf(s){return s?Os(s):vb}function Os(s){return new Y(function(o){return s.schedule(function(){return o.complete()})})}function Zc(s){return s&&typeof s.schedule=="function"}function hi(s,o){return new Y(function(l){var p=new Oa,_=0;return p.add(o.schedule(function(){_===s.length?l.complete():(l.next(s[_++]),l.closed||p.add(this.schedule()))})),p})}function nf(s,o){return o?hi(s,o):new Y(am(s))}function bb(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];return Zc(o=s[s.length-1])?(s.pop(),hi(s,o)):nf(s)}function Z(s,o){return new Y(o?function(l){return o.schedule(Ps,0,{error:s,subscriber:l})}:function(l){return l.error(s)})}function Ps(s){s.subscriber.error(s.error)}function Qs(s,o){return o===void 0&&(o=0),function(l){return l.lift(new Rs(s,o))}}function bm(s){return s in ii&&(delete ii[s],!0)}function hc(){}function ba(s,o){return function(l){if(typeof s!="function")throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return l.lift(new Ss(s,o))}}function cm(s,o,l){if(o){if(!Zc(o))return function(){for(var p=[],_=0;_<arguments.length;_++)p[_]=arguments[_];return cm(s,l).apply(void 0,p).pipe(ba(function(A){return Jb(A)?o.apply(void 0,A):o(A)}))};l=o}return function(){for(var p=[],_=0;_<arguments.length;_++)p[_]=arguments[_];var A,k=this,j={context:k,subject:A,callbackFunc:s,scheduler:l};return new Y(function(B){if(l)return l.schedule(Ts,0,{args:p,subscriber:B,params:j});if(!A){A=new of;try{s.apply(k,p.concat([function(){for(var z=[],Vt=0;Vt<arguments.length;Vt++)z[Vt]=arguments[Vt];A.next(1>=z.length?z[0]:z),A.complete()}]))}catch(z){fi(A)?A.error(z):console.warn(z)}}return A.subscribe(B)})}}function Ts(s){var o=this,l=s.args,p=s.subscriber,_=s.params;s=_.callbackFunc;var A=_.context,k=_.scheduler,j=_.subject;if(!j){j=_.subject=new of,_=function(){for(var B=[],z=0;z<arguments.length;z++)B[z]=arguments[z];o.add(k.schedule(Us,0,{value:1>=B.length?B[0]:B,subject:j}))};try{s.apply(A,l.concat([_]))}catch(B){j.error(B)}}this.add(j.subscribe(p))}function Us(s){var o=s.subject;o.next(s.value),o.complete()}function dm(s,o,l){if(o){if(!Zc(o))return function(){for(var p=[],_=0;_<arguments.length;_++)p[_]=arguments[_];return dm(s,l).apply(void 0,p).pipe(ba(function(A){return Jb(A)?o.apply(void 0,A):o(A)}))};l=o}return function(){for(var p=[],_=0;_<arguments.length;_++)p[_]=arguments[_];var A={subject:void 0,args:p,callbackFunc:s,scheduler:l,context:this};return new Y(function(k){var j=A.context,B=A.subject;if(l)return l.schedule(Vs,0,{params:A,subscriber:k,context:j});if(!B){B=A.subject=new of;try{s.apply(j,p.concat([function(){for(var z=[],Vt=0;Vt<arguments.length;Vt++)z[Vt]=arguments[Vt];(Vt=z.shift())?B.error(Vt):(B.next(1>=z.length?z[0]:z),B.complete())}]))}catch(z){fi(B)?B.error(z):console.warn(z)}}return B.subscribe(k)})}}function Vs(s){var o=this,l=s.params,p=s.subscriber;s=s.context;var _=l.callbackFunc,A=l.args,k=l.scheduler,j=l.subject;if(!j){j=l.subject=new of,l=function(){for(var B=[],z=0;z<arguments.length;z++)B[z]=arguments[z];(z=B.shift())?o.add(k.schedule(em,0,{err:z,subject:j})):o.add(k.schedule(Ws,0,{value:1>=B.length?B[0]:B,subject:j}))};try{_.apply(s,A.concat([l]))}catch(B){this.add(k.schedule(em,0,{err:B,subject:j}))}}this.add(j.subscribe(p))}function Ws(s){var o=s.subject;o.next(s.value),o.complete()}function em(s){s.subject.error(s.err)}function fm(s){return!!s&&typeof s.subscribe!="function"&&typeof s.then=="function"}function ji(s,o,l,p,_){if(_===void 0&&(_=new Xs(s,l,p)),!_.closed)return o instanceof Y?o.subscribe(_):pf(o)(_)}function Ys(s,o){return new Y(function(l){var p=new Oa;return p.add(o.schedule(function(){var _=s[ne]();p.add(_.subscribe({next:function(A){p.add(o.schedule(function(){return l.next(A)}))},error:function(A){p.add(o.schedule(function(){return l.error(A)}))},complete:function(){p.add(o.schedule(function(){return l.complete()}))}}))})),p})}function Zs(s,o){return new Y(function(l){var p=new Oa;return p.add(o.schedule(function(){return s.then(function(_){p.add(o.schedule(function(){l.next(_),p.add(o.schedule(function(){return l.complete()}))}))},function(_){p.add(o.schedule(function(){return l.error(_)}))})})),p})}function $s(s,o){if(!s)throw Error("Iterable cannot be null");return new Y(function(l){var p,_=new Oa;return _.add(function(){p&&typeof p.return=="function"&&p.return()}),_.add(o.schedule(function(){p=s[$c](),_.add(o.schedule(function(){if(!l.closed){try{var A=p.next(),k=A.value,j=A.done}catch(B){return void l.error(B)}j?l.complete():(l.next(k),this.schedule())}}))})),_})}function gm(s,o){if(s!=null){if(s&&typeof s[ne]=="function")return Ys(s,o);if(fm(s))return Zs(s,o);if(hm(s))return hi(s,o);if(s&&typeof s[$c]=="function"||typeof s=="string")return $s(s,o)}throw new TypeError((s!==null&&X(s)||s)+" is not observable")}function Kb(s,o){return o?gm(s,o):s instanceof Y?s:new Y(pf(s))}function ic(s,o){if(!o.closed){if(s instanceof Y)return s.subscribe(o);try{var l=pf(s)(o)}catch(p){o.error(p)}return l}}function cb(s,o,l){return l===void 0&&(l=Number.POSITIVE_INFINITY),typeof o=="function"?function(p){return p.pipe(cb(function(_,A){return Kb(s(_,A)).pipe(ba(function(k,j){return o(_,k,A,j)}))},l))}:(typeof o=="number"&&(l=o),function(p){return p.lift(new at(s,l))})}function tg(s){return s===void 0&&(s=Number.POSITIVE_INFINITY),cb(Yc,s)}function im(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];return tg(1)(bb.apply(void 0,s))}function ad(s){return new Y(function(o){try{var l=s()}catch(p){return void o.error(p)}return(l?Kb(l):mf()).subscribe(o)})}function jm(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];if(s.length===1){var l=s[0];if(Jb(l))return ug(l,null);if(ei(l)&&Object.getPrototypeOf(l)===Object.prototype)return ug((s=Object.keys(l)).map(function(_){return l[_]}),s)}if(typeof s[s.length-1]=="function"){var p=s.pop();return ug(s=s.length===1&&Jb(s[0])?s[0]:s,null).pipe(ba(function(_){return p.apply(void 0,_)}))}return ug(s,null)}function ug(s,o){return new Y(function(l){var p=s.length;if(p===0)l.complete();else for(var _=Array(p),A=0,k=0,j=function(z){var Vt=Kb(s[z]),_e=!1;l.add(Vt.subscribe({next:function(_n){_e||(_e=!0,k++),_[z]=_n},error:function(_n){return l.error(_n)},complete:function(){++A!==p&&_e||(k===p&&l.next(o?o.reduce(function(_n,_o,_c){return _n[_o]=_[_c],_n},{}):_),l.complete())}}))},B=0;B<p;B++)j(B)})}function gb(s,o,l,p){return le(l)&&(p=l,l=void 0),p?gb(s,o,l).pipe(ba(function(_){return Jb(_)?p.apply(void 0,_):p(_)})):new Y(function(_){km(s,o,function(A){1<arguments.length?_.next(Array.prototype.slice.call(arguments)):_.next(A)},_,l)})}function km(s,o,l,p,_){if(s&&typeof s.addEventListener=="function"&&typeof s.removeEventListener=="function"){s.addEventListener(o,l,_);var A=function(){return s.removeEventListener(o,l,_)}}else if(s&&typeof s.on=="function"&&typeof s.off=="function")s.on(o,l),A=function(){return s.off(o,l)};else if(s&&typeof s.addListener=="function"&&typeof s.removeListener=="function")s.addListener(o,l),A=function(){return s.removeListener(o,l)};else{if(!s||!s.length)throw new TypeError("Invalid event target");for(var k=0,j=s.length;k<j;k++)km(s[k],o,l,p,_)}p.add(A)}function lm(s,o,l){return l?lm(s,o).pipe(ba(function(p){return Jb(p)?l.apply(void 0,p):l(p)})):new Y(function(p){var _=function(){for(var k=[],j=0;j<arguments.length;j++)k[j]=arguments[j];return p.next(k.length===1?k[0]:k)};try{var A=s(_)}catch(k){return void p.error(k)}if(le(o))return function(){return o(_,A)}})}function bt(s){var o=s.subscriber,l=s.condition;if(!o.closed){if(s.needIterate)try{s.state=s.iterate(s.state)}catch(A){return void o.error(A)}else s.needIterate=!0;if(l){var p=void 0;try{p=l(s.state)}catch(A){return void o.error(A)}if(!p)return void o.complete();if(o.closed)return}try{var _=s.resultSelector(s.state)}catch(A){return void o.error(A)}if(!o.closed&&(o.next(_),!o.closed))return this.schedule(s)}}function ki(s){return!Jb(s)&&0<=s-parseFloat(s)+1}function mm(s,o){return s===void 0&&(s=0),o===void 0&&(o=bd),(!ki(s)||0>s)&&(s=0),o&&typeof o.schedule=="function"||(o=bd),new Y(function(l){return l.add(o.schedule(ct,s,{subscriber:l,counter:0,period:s})),l})}function ct(s){var o=s.subscriber,l=s.counter;s=s.period,o.next(l),this.schedule({subscriber:o,counter:l+1,period:s},s)}function Xb(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];o=Number.POSITIVE_INFINITY;var l=null,p=s[s.length-1];return Zc(p)?(l=s.pop(),1<s.length&&typeof s[s.length-1]=="number"&&(o=s.pop())):typeof p=="number"&&(o=s.pop()),l===null&&s.length===1&&s[0]instanceof Y?s[0]:tg(o)(nf(s,l))}function li(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];if(s.length===0)return vb;var l=s[0],p=s.slice(1);return s.length===1&&Jb(l)?li.apply(void 0,l):new Y(function(_){var A=function(){return _.add(li.apply(void 0,p).subscribe(_))};return Kb(l).subscribe({next:function(k){_.next(k)},error:A,complete:A})})}function dt(s){var o=s.keys,l=s.index,p=s.subscriber,_=s.subscription;if(s=s.obj,!p.closed)if(l<o.length){var A=o[l];p.next([A,s[A]]),_.add(this.schedule({keys:o,index:l+1,subscriber:p,subscription:_,obj:s}))}else p.complete()}function et(s,o){function l(){return!l.pred.apply(l.thisArg,arguments)}return l.pred=s,l.thisArg=o,l}function wb(s,o){return function(l){return l.lift(new ft(s,o))}}function Ca(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];if(s.length===1){if(!Jb(s[0]))return s[0];s=s[0]}return nf(s,void 0).lift(new gt)}function ht(s){var o=s.start,l=s.index,p=s.subscriber;l>=s.count?p.complete():(p.next(o),p.closed||(s.index=l+1,s.start=o+1,this.schedule(s)))}function Bc(s,o,l){s===void 0&&(s=0);var p=-1;return ki(o)?p=1>Number(o)?1:Number(o):Zc(o)&&(l=o),Zc(l)||(l=bd),new Y(function(_){var A=ki(s)?s:+s-l.now();return l.schedule(it,A,{index:0,period:p,subscriber:_})})}function it(s){var o=s.index,l=s.period,p=s.subscriber;if(p.next(o),!p.closed){if(l===-1)return p.complete();s.index=o+1,this.schedule(s,l)}}function mi(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];return typeof(o=s[s.length-1])=="function"&&s.pop(),nf(s,void 0).lift(new jt(o))}function Ga(s){return function(o){var l=new kt(s);return o=o.lift(l),l.caught=o}}function ni(s,o){return cb(s,o,1)}function nm(s){return s===void 0&&(s=null),function(o){return o.lift(new lt(s))}}function cd(s,o){o===void 0&&(o=bd);var l=s instanceof Date&&!isNaN(+s)?+s-o.now():Math.abs(s);return function(p){return p.lift(new mt(l,o))}}function om(s,o){return function(l){return l.lift(new nt(s,o))}}function Dd(s){return s===void 0&&(s=ot),function(o){return o.lift(new pt(s))}}function ot(){return new vg}function Ka(s){return function(o){return s===0?mf():o.lift(new qt(s))}}function pm(s,o){return o?function(l){return l.pipe(pm(function(p,_){return Kb(s(p,_)).pipe(ba(function(A,k){return o(p,A,_,k)}))}))}:function(l){return l.lift(new rt(s))}}function wg(s){return function(o){return o.lift(new st(s))}}function aa(s,o){var l=2<=arguments.length;return function(p){return p.pipe(s?wb(function(_,A){return s(_,A,p)}):Yc,Ka(1),l?nm(o):Dd(function(){return new vg}))}}function tt(){return function(s){return s.lift(new ut)}}function qm(s){return function(o){return s===0?mf():o.lift(new vt(s))}}function qf(s){return function(o){return o.lift(new wt(s))}}function xg(s,o){var l=!1;return 2<=arguments.length&&(l=!0),function(p){return p.lift(new xt(s,o,l))}}function rm(s,o){return 2<=arguments.length?function(l){return gi(xg(s,o),qm(1),nm(o))(l)}:function(l){return gi(xg(function(p,_,A){return s(p,_,A+1)}),qm(1))(l)}}function yt(s,o){return function(l){var p=typeof s=="function"?s:function(){return s},_=Object.create(l,At);return _.source=l,_.subjectFactory=p,_}}function oe(s){return function(o){return o.lift(new Bt(s,o))}}function Ct(){return new Pa}function pe(){return function(s){return $l()(yt(Ct)(s))}}function sm(s,o,l){var p=s&&X(s)==="object"?s:{bufferSize:s,windowTime:o,refCount:!1,scheduler:l};return function(_){return _.lift(Dt(p))}}function Dt(s){var o,l,p=s.bufferSize,_=p===void 0?Number.POSITIVE_INFINITY:p,A=(p=s.windowTime)===void 0?Number.POSITIVE_INFINITY:p,k=s.refCount,j=s.scheduler,B=0,z=!1,Vt=!1;return function(_e){if(B++,!o||z){z=!1;var _n=(o=new qe(_,A,j)).subscribe(this);l=_e.subscribe({next:function(_o){o.next(_o)},error:function(_o){z=!0,o.error(_o)},complete:function(){Vt=!0,l=void 0,o.complete()}}),Vt&&(l=void 0)}else _n=o.subscribe(this);this.add(function(){B--,_n.unsubscribe(),_n=void 0,l&&!Vt&&k&&B===0&&(l.unsubscribe(),o=l=void 0)})}}function Cc(s,o){return typeof o=="function"?function(l){return l.pipe(Cc(function(p,_){return Kb(s(p,_)).pipe(ba(function(A,k){return o(p,A,_,k)}))}))}:function(l){return l.lift(new Et(s))}}function ob(s){return function(o){return o.lift(new Ft(s))}}function Gt(s,o){return o===void 0&&(o=!1),function(l){return l.lift(new Ht(s,o))}}function ca(s,o,l){return function(p){return p.lift(new It(s,o,l))}}function Jt(s,o,l){return o===void 0&&(o=bd),l===void 0&&(l=Kt),function(p){return p.lift(new Lt(s,o,l.leading,l.trailing))}}function Mt(s){s.subscriber.clearThrottle()}function Nt(s,o,l){return l===void 0&&(l=bd),function(p){var _=s instanceof Date&&!isNaN(+s),A=_?+s-l.now():Math.abs(s);return p.lift(new Ot(A,_,o,l))}}function hb(s,o){return o===void 0&&(o=bd),Nt(s,Z(new pb),o)}function Pt(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];return function(l){var p;return typeof s[s.length-1]=="function"&&(p=s.pop()),l.lift(new Qt(s,p))}}function tm(s,o,l,p,_){s!==o&&um(o,function(A,k){if(_||(_=new ge),lb(A)){A=_;var j=oi(s,k),B=oi(o,k),z=A.get(B);if(z)pi(s,k,z);else{var Vt=(z=p?p(j,B,k+"",s,o,A):void 0)===void 0;if(Vt){var _e=Va(B),_n=!_e&&jf(B),_o=!_e&&!_n&&bi(B);z=B,_e||_n||_o?Va(j)?z=j:gc(j)&&Ed(j)?z=Xh(j):_n?(Vt=!1,z=Jl(B,!0)):_o?(Vt=!1,z=vm(B,!0)):z=[]:wm(B)||rf(B)?(z=j,rf(j)?z=re(j,kf(j)):lb(j)&&!qi(j)||(z=Kl(B))):Vt=!1}Vt&&(A.set(B,z),tm(z,B,l,p,A),A.delete(B)),pi(s,k,z)}}else(j=p?p(oi(s,k),A,k+"",s,o,_):void 0)===void 0&&(j=A),pi(s,k,j)},kf)}function Rt(s){var o=1,l=ri;(1>=arguments.length?0:arguments.length-1)==1?typeof(1>=arguments.length?void 0:arguments[1])=="number"?o=1>=arguments.length?void 0:arguments[1]:l=1>=arguments.length?void 0:arguments[1]:(1>=arguments.length?0:arguments.length-1)==2&&(o=1>=arguments.length?void 0:arguments[1],l=2>=arguments.length?void 0:arguments[2]);var p=o||1;return function(_){return _.pipe(xg(function(A,k){var j=l.now(),B=j-s;if((A=A.filter(function(_e){return _e.until>B})).length>=p){var z=A[A.length-1],Vt=A[0].until+s*Math.floor(A.length/p);A.push({delay:z.until<j?Vt-j:Vt-z.until,until:Vt,value:k})}else A.push({delay:0,until:j,value:k});return A},[]),ba(function(A){return A[A.length-1]}),ni(function(A){var k=bb(A.value);return A.delay?k.pipe(cd(A.delay,l)):k}))}}function St(s,o){var l=(o=o===void 0?{protocols:xm,makeWebSocket:ym}:o).protocols,p=l===void 0?xm:l,_=(o=o.makeWebSocket)===void 0?ym:o;return new Y(function(A){var k,j=new Pa,B=_(s,p),z=!1,Vt=!1,_e=function(_n){if(k)throw z=!0,_n=Error("Web socket message factory function called more than once"),A.error(_n),_n;return k=_n.subscribe(function(_o){B.send(_o)}),j};return B.onopen=function(){Vt?(z=!0,B.close()):A.next(_e)},B.onmessage=function(_n){j.next(_n.data)},B.onerror=function(_n){z=!0,A.error(Error(_n.message))},B.onclose=function(_n){z||(z=!0,Vt?(A.complete(),j.complete()):A.error(Error(_n.code===1e3?"Normal closure":_n.reason)))},function(){Vt=!0,k&&k.unsubscribe(),z||(z=!0,B.close())}})}function yg(){this._listeners={}}function zm(s){return typeof Float32Array<"u"?function(){function o(B,z,Vt){A[0]=B,z[Vt]=k[0],z[Vt+1]=k[1],z[Vt+2]=k[2],z[Vt+3]=k[3]}function l(B,z,Vt){A[0]=B,z[Vt]=k[3],z[Vt+1]=k[2],z[Vt+2]=k[1],z[Vt+3]=k[0]}function p(B,z){return k[0]=B[z],k[1]=B[z+1],k[2]=B[z+2],k[3]=B[z+3],A[0]}function _(B,z){return k[3]=B[z],k[2]=B[z+1],k[1]=B[z+2],k[0]=B[z+3],A[0]}var A=new Float32Array([-0]),k=new Uint8Array(A.buffer),j=k[3]===128;s.writeFloatLE=j?o:l,s.writeFloatBE=j?l:o,s.readFloatLE=j?p:_,s.readFloatBE=j?_:p}():function(){function o(p,_,A,k){var j=0>_?1:0;if(j&&(_=-_),_===0)p(0<1/_?0:2147483648,A,k);else if(isNaN(_))p(2143289344,A,k);else if(34028234663852886e22<_)p((j<<31|2139095040)>>>0,A,k);else if(11754943508222875e-54>_)p((j<<31|Math.round(_/1401298464324817e-60))>>>0,A,k);else{var B=Math.floor(Math.log(_)/Math.LN2);p((j<<31|B+127<<23|8388607&Math.round(_*Math.pow(2,-B)*8388608))>>>0,A,k)}}function l(p,_,A){return A=p(_,A),p=2*(A>>31)+1,_=A>>>23&255,A&=8388607,_===255?A?NaN:1/0*p:_===0?1401298464324817e-60*p*A:p*Math.pow(2,_-150)*(A+8388608)}s.writeFloatLE=o.bind(null,Am),s.writeFloatBE=o.bind(null,Bm),s.readFloatLE=l.bind(null,Cm),s.readFloatBE=l.bind(null,Dm)}(),typeof Float64Array<"u"?function(){function o(B,z,Vt){A[0]=B,z[Vt]=k[0],z[Vt+1]=k[1],z[Vt+2]=k[2],z[Vt+3]=k[3],z[Vt+4]=k[4],z[Vt+5]=k[5],z[Vt+6]=k[6],z[Vt+7]=k[7]}function l(B,z,Vt){A[0]=B,z[Vt]=k[7],z[Vt+1]=k[6],z[Vt+2]=k[5],z[Vt+3]=k[4],z[Vt+4]=k[3],z[Vt+5]=k[2],z[Vt+6]=k[1],z[Vt+7]=k[0]}function p(B,z){return k[0]=B[z],k[1]=B[z+1],k[2]=B[z+2],k[3]=B[z+3],k[4]=B[z+4],k[5]=B[z+5],k[6]=B[z+6],k[7]=B[z+7],A[0]}function _(B,z){return k[7]=B[z],k[6]=B[z+1],k[5]=B[z+2],k[4]=B[z+3],k[3]=B[z+4],k[2]=B[z+5],k[1]=B[z+6],k[0]=B[z+7],A[0]}var A=new Float64Array([-0]),k=new Uint8Array(A.buffer),j=k[7]===128;s.writeDoubleLE=j?o:l,s.writeDoubleBE=j?l:o,s.readDoubleLE=j?p:_,s.readDoubleBE=j?_:p}():function(){function o(p,_,A,k,j,B){var z=0>k?1:0;if(z&&(k=-k),k===0)p(0,j,B+_),p(0<1/k?0:2147483648,j,B+A);else if(isNaN(k))p(0,j,B+_),p(2146959360,j,B+A);else if(17976931348623157e292<k)p(0,j,B+_),p((z<<31|2146435072)>>>0,j,B+A);else if(22250738585072014e-324>k)p((k/=5e-324)>>>0,j,B+_),p((z<<31|k/4294967296)>>>0,j,B+A);else{var Vt=Math.floor(Math.log(k)/Math.LN2);Vt===1024&&(Vt=1023),p(4503599627370496*(k*=Math.pow(2,-Vt))>>>0,j,B+_),p((z<<31|Vt+1023<<20|1048576*k&1048575)>>>0,j,B+A)}}function l(p,_,A,k,j){return _=p(k,j+_),k=p(k,j+A),p=2*(k>>31)+1,_=4294967296*(1048575&k)+_,(A=k>>>20&2047)===2047?_?NaN:1/0*p:A===0?5e-324*p*_:p*Math.pow(2,A-1075)*(_+4503599627370496)}s.writeDoubleLE=o.bind(null,Am,0,4),s.writeDoubleBE=o.bind(null,Bm,4,0),s.readDoubleLE=l.bind(null,Cm,0,4),s.readDoubleBE=l.bind(null,Dm,4,0)}(),s}function Am(s,o,l){o[l]=255&s,o[l+1]=s>>>8&255,o[l+2]=s>>>16&255,o[l+3]=s>>>24}function Bm(s,o,l){o[l]=s>>>24,o[l+1]=s>>>16&255,o[l+2]=s>>>8&255,o[l+3]=255&s}function Cm(s,o){return(s[o]|s[o+1]<<8|s[o+2]<<16|s[o+3]<<24)>>>0}function Dm(s,o){return(s[o]<<24|s[o+1]<<16|s[o+2]<<8|s[o+3])>>>0}function Wa(s,o){this.lo=s>>>0,this.hi=o>>>0}function sf(s,o,l){this.fn=s,this.len=o,this.next=void 0,this.val=l}function si(){}function Tt(s){this.head=s.head,this.tail=s.tail,this.len=s.len,this.next=s.states}function ja(){this.len=0,this.tail=this.head=new sf(si,0,0),this.states=null}function ti(s,o,l){o[l]=255&s}function ui(s,o){this.len=s,this.next=void 0,this.val=o}function vi(s,o,l){for(;s.hi;)o[l++]=127&s.lo|128,s.lo=(s.lo>>>7|s.hi<<25)>>>0,s.hi>>>=7;for(;127<s.lo;)o[l++]=127&s.lo|128,s.lo>>>=7;o[l++]=s.lo}function wi(s,o,l){o[l]=255&s,o[l+1]=s>>>8&255,o[l+2]=s>>>16&255,o[l+3]=s>>>24}function jc(){xi.call(this)}function Ut(s,o,l){40>s.length?V.utf8.write(s,o,l):o.utf8Write?o.utf8Write(s,l):o.write(s,l)}function Yb(s,o){return RangeError("index out of range: "+s.pos+" + "+(o||1)+" > "+s.len)}function La(s){this.buf=s,this.pos=0,this.len=s.length}function yi(){var s=new Em(0,0),o=0;if(!(4<this.len-this.pos)){for(;3>o;++o){if(this.pos>=this.len)throw Yb(this);if(s.lo=(s.lo|(127&this.buf[this.pos])<<7*o)>>>0,128>this.buf[this.pos++])return s}return s.lo=(s.lo|(127&this.buf[this.pos++])<<7*o)>>>0,s}for(;4>o;++o)if(s.lo=(s.lo|(127&this.buf[this.pos])<<7*o)>>>0,128>this.buf[this.pos++])return s;if(s.lo=(s.lo|(127&this.buf[this.pos])<<28)>>>0,s.hi=(s.hi|(127&this.buf[this.pos])>>4)>>>0,128>this.buf[this.pos++])return s;if(o=0,4<this.len-this.pos){for(;5>o;++o)if(s.hi=(s.hi|(127&this.buf[this.pos])<<7*o+3)>>>0,128>this.buf[this.pos++])return s}else for(;5>o;++o){if(this.pos>=this.len)throw Yb(this);if(s.hi=(s.hi|(127&this.buf[this.pos])<<7*o+3)>>>0,128>this.buf[this.pos++])return s}throw Error("invalid varint encoding")}function zg(s,o){return(s[o-4]|s[o-3]<<8|s[o-2]<<16|s[o-1]<<24)>>>0}function Fm(){if(this.pos+8>this.len)throw Yb(this,8);return new Em(zg(this.buf,this.pos+=4),zg(this.buf,this.pos+=4))}function Fd(s){zi.call(this,s)}function tf(s,o,l){if(typeof s!="function")throw TypeError("rpcImpl must be a function");V.EventEmitter.call(this),this.rpcImpl=s,this.requestDelimited=!!o,this.responseDelimited=!!l}function za(s){return typeof s=="string"&&/^[\s\w!#$%&()+,.:;<=>?@[\]^{|}~-]{1,64}$/.test(s)&&s!=="null"}function Gm(s){try{var o=s.split(".").map(function(p){return Number(p)})}catch{return!1}if(o.length!==4||o[0]===0)return!1;for(s=0;s<o.length;s++){var l=o[s];if(!Number.isInteger(l)||0>l||255<l)return!1}return!0}function Hm(s,o){if(!Array.isArray(o)||o.length===0||32<o.length||o.some(function(l){return l.length===0||32<l.length}))throw new I("arguments is not valid",Ja);if(!za(s))throw new I("ID is invalid",Ja)}function uf(s){var o=s.attributes,l=s.attrSizeMap,p=s.maxAttrsCount,_=s.maxAttrValueSize;if(s=s.maxTotalSize,!yd(o))throw new I("attributes must be an object",Ja);if(Object.keys(o).length>p)throw new ib("Exceed the limit of ".concat(p," attributes"),se);if(Object.keys(o).length===0)throw new I("The attributes is an empty object",Ja);var A=0,k=0;for(o=Object.entries(o);k<o.length;k++){var j=ra(o[k],2),B=j[1];j=new Blob([j[0]]).size;var z=new Blob([B]).size;if(j===0||32<j)throw new I("Invalid attribute key",Ja);if(z>_)throw new ib("Invalid attribute value, over the limit of ".concat(_," bytes"),se);if(typeof B!="string"||B.length===0)throw new I("Invalid attribute value",Ja);A+=j,A+=z}if(A>s)throw new ib("The attributes size overflow",se);if(l!==void 0){if(Object.keys(l).length>p)throw new ib("Exceed the limit of ".concat(p," attributes"),se);for(A=p=0,l=Object.entries(l);A<l.length;A++){if(k=(o=ra(l[A],2))[1],(o=new Blob([o[0]]).size)===0)throw new I("Invalid attribute key",Ja);if(k>_)throw new ib("Invalid attribute value, over the limit of ".concat(_," bytes"),se);p+=o,p+=k}if(p>s)throw new ib("The attributes size overflow",se)}}function Ag(s,o){return Math.floor(Math.random()*(Math.floor(o)-Math.ceil(s)+1))+s}function Bg(){var s=Ag(0,4294967295),o=Ag(1,4294967295);return new U(s,o,!0)}function Xa(s){return s.toString().padEnd(32,"0")}function Im(s,o){return new TypeError("Unexpected ".concat(s,": ").concat(o))}function Jm(s,o){return s=s.split(".").map(function(l){return Number(l)}),o=o.split(".").map(function(l){return Number(l)}),Math.sqrt(1e3*Math.pow(s[0]-o[0],2)+100*Math.pow(s[1]-o[1],2)+10*Math.pow(s[2]-o[2],2)+1*Math.pow(s[3]-o[3],2))}function Km(s){return s.lessThanOrEqual(Number.MAX_SAFE_INTEGER)?s.toNumber():s.toString()}function Ai(s,o){o="".concat(s).concat(o||"");var l=Lm.get(o)||1;return Lm.set(o,l+1),"".concat(s).concat(l)}function Mm(s,o){var l=typeof o=="number"?o:o!==void 0&&typeof o!="string"?o.code:void 0;return o=typeof o!="number"&&typeof o!="string"&&o!==void 0&&o.serverCode!==void 0?o.serverCode:void 0,l="".concat(l!==void 0?" Error Code ".concat(l):"").concat(o!==void 0?", server Code ".concat(o):""),s=typeof s=="string"&&s?Cg(s):Array.isArray(s)&&typeof s[0]=="string"&&s[0]?Cg(Nm.apply(void 0,[s[0]].concat(G(s.slice(1))))):"","".concat(l===""?"":"".concat(l," - ")).concat(s)}function Om(s){return Bi.apply(this,arguments)}function Bi(){return(Bi=J(w.mark(function s(o){return w.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(p){setTimeout(function(){p()},o)}));case 1:case"end":return l.stop()}},s)}))).apply(this,arguments)}function Pm(s){return s instanceof Blob||Object.prototype.toString.call(s)==="[object Blob]"}function Dg(s){var o=255&s,l=s>>8&255,p=s>>16&255;return"".concat(s>>24&255,".").concat(p,".").concat(l,".").concat(o)}function te(s,o,l){return Ci.apply(this,arguments)}function Ci(){return(Ci=J(w.mark(function s(o,l,p){var _,A,k,j,B,z,Vt,_e,_n,_o,_c,_d,_h,_p,_f,e_,u_,w_,O_,y_,Z_,NE,i_,S_,h_,I_;return w.wrap(function(vf){for(;;)switch(vf.prev=vf.next){case 0:if(_=l.body,A=l.headers,k=A===void 0?{}:A,j=l.timeout,B=j===void 0?1e4:j,z=l.signal,Vt=l.withCredentials,_e=Vt!==void 0&&Vt,_n=(p||{}).useBinaryResponse,_o=_n!==void 0&&_n,(_c=new XMLHttpRequest).open("POST",o,!0),_c.responseType=_o?"arraybuffer":"text",_c.withCredentials=_e,_c.timeout=B,_d=_ instanceof FormData,_h=_ instanceof Uint8Array,!(1<(_p=Object.keys(k).filter(function(o_){return o_.toLowerCase()==="content-type"})).length)){vf.next=14;break}throw new RangeError("multiple content-type");case 14:_p.length===0&&(_h?k["Content-Type"]="application/octet-stream":_d||(k["Content-Type"]="application/json"));case 15:if("setRequestHeader"in _c){vf.next=46;break}return _c.abort(),vf.next=19,fetch(o,{body:_d||_h?_:JSON.stringify(_),cache:"no-cache",credentials:_e?"include":"same-origin",headers:k,method:"POST",mode:"cors",referrer:"no-referrer",signal:z});case 19:if(_f=vf.sent,!(200<=(e_=_f.status)&&300>e_||e_===304)){vf.next=31;break}if(!_o){vf.next=27;break}return vf.next=25,_f.arrayBuffer();case 25:return u_=vf.sent,vf.abrupt("return",{status:e_,responseData:u_});case 27:return vf.next=29,_f.text();case 29:return w_=vf.sent,vf.abrupt("return",{status:e_,responseText:w_});case 31:return O_=new da(["Post XHR failure, status %d",e_]),vf.prev=32,vf.next=35,_f.text();case 35:throw y_=vf.sent,O_.statusCode=e_,O_.message=y_||"Request failed, status ".concat(e_),O_;case 41:throw vf.prev=41,vf.t0=vf.catch(32),O_.statusCode=e_,O_.message="Request failed, status ".concat(e_),O_;case 46:if(Object.keys(k).length!==0)for(Z_=0,NE=Object.entries(k);Z_<NE.length;Z_++)i_=ra(NE[Z_],2),S_=i_[0],h_=i_[1],_c.setRequestHeader(S_,h_);return z!==void 0&&(I_=function o_(){_c.abort(),z.removeEventListener("abort",o_)},z.addEventListener("abort",I_)),_d||_h?_c.send(_):_c.send(JSON.stringify(_)),vf.abrupt("return",new Promise(function(o_,d_){_c.onload=function(){var g_=_c.status;if(200<=g_&&300>g_||g_===304)o_(_o?{status:g_,responseData:_c.response}:{status:g_,responseText:_c.responseText});else{var v_=new da(["Post XHR failure, status %d",g_]);v_.statusCode=g_,v_.message=_c.response||"Request failed, status ".concat(_c.status),d_(v_)}},_c.ontimeout=function(g_){d_(new db(["XHR request timed out after %d ms",B],{originalError:g_}))},_c.onerror=function(){var g_=new da(["Post XHR failure, status %d",_c.status]);g_.statusCode=_c.status,g_.message=_c.response||"Request failed, status ".concat(_c.status),d_(g_)},_c.onabort=function(){try{d_(new DOMException("The request aborted.","AbortError"))}catch{var g_=Error("The request aborted.");g_.name="AbortError",d_(g_)}}}));case 50:case"end":return vf.stop()}},s,null,[[32,41]])}))).apply(this,arguments)}function Rm(s){return Hi.apply(this,arguments)}function Hi(){return(Hi=J(w.mark(function s(o){var l;return w.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return(l=new Image).src=o,p.abrupt("return",new Promise(function(_,A){l.onload=function(){_({width:l.width,height:l.height})},l.onerror=A}));case 3:case"end":return p.stop()}},s)}))).apply(this,arguments)}function Xt(s,o){return Ii.apply(this,arguments)}function Ii(){return(Ii=J(w.mark(function s(o,l){var p,_,A,k,j,B,z,Vt,_e,_n;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:if(p=o.thumbnailHeight,_=p===void 0?0:p,A=o.thumbnailWidth,k=A===void 0?0:A,j=o.width,B=j===void 0?0:j,z=o.height,Vt=z===void 0?0:z,_e=o.thumbnail,_n=[],typeof _=="number"&&typeof k=="number"&&typeof B=="number"&&typeof Vt=="number"){_o.next=5;break}throw new I("Invalid message params",wf);case 5:return 0>=B&&0>=Vt&&_n.push(Rm(Sm(l)).then(function(_c){B=_c.width,Vt=_c.height})),0>=k&&0>=_&&_e!==void 0&&_n.push(Ji(_e).then(function(){var _c=J(w.mark(function _d(_h){var _p;return w.wrap(function(_f){for(;;)switch(_f.prev=_f.next){case 0:return _f.next=2,Rm(Sm(_h));case 2:_p=_f.sent,k=_p.width,_=_p.height;case 5:case"end":return _f.stop()}},_d)}));return function(_d){return _c.apply(this,arguments)}}())),_o.next=9,Promise.all(_n).catch(function(){});case 9:return _o.abrupt("return",{width:B,height:Vt,thumbnailWidth:k,thumbnailHeight:_});case 10:case"end":return _o.stop()}},s)}))).apply(this,arguments)}function Tm(s,o){if(!yd(s))throw new I("message object is not a plain object",o);if(s.messageType===void 0)if(s.rawMessage instanceof Uint8Array){if(s.messageType="RAW",s.text!==void 0)throw new I("Raw messages cannot have text property. Use description instead",o)}else{if(typeof s.text!="string")throw new I("messageType is undefined",o);if(s.messageType="TEXT",s.rawMessage!==void 0)throw new I("Text messages cannot have rawMessage property",o)}}function Gg(s){return Ki.apply(this,arguments)}function Ki(){return(Ki=J(w.mark(function s(o){var l,p,_,A,k,j,B,z,Vt,_e,_n,_o,_c,_d,_h,_p,_f,e_,u_,w_,O_;return w.wrap(function(y_){for(;;)switch(y_.prev=y_.next){case 0:if(l=o.message,p=o.peerId,_=o.toPeer,A=o.session,k=o.errorCodes,j=o.diff,B=o.logger,z=o.options,A!==void 0){y_.next=3;break}throw new K("The client is not logged in. Cannot do the operation",k.NOT_LOGGED_IN);case 3:if(Vt=!1,l.messageType!=="TEXT"||!l.text.startsWith("AgoraRTMLegacyEndcallCompatibleMessagePrefix")||!_){y_.next=11;break}if(_e=l.text.split("_"),_n=ra(_e,3),_o=_n[0],_c=_n[1],_n[2]!==void 0&&za(_c)&&_o==="AgoraRTMLegacyEndcallCompatibleMessagePrefix"){y_.next=10;break}throw new I("Message is not valid",ve);case 10:Vt=!0;case 11:if(_d=Date.now(),_h=A.messageSentTimes.length-1,!((_p=A.messageSentTimes[_h])&&_p+3e3<_d)){y_.next=18;break}A.messageSentTimes=[_d],y_.next=29;break;case 18:_f=_h;case 19:if(!(0<=_f)){y_.next=28;break}if(!(A.messageSentTimes[_f]+3e3<_d)){y_.next=23;break}return A.messageSentTimes=A.messageSentTimes.slice(_f+1,_h+1),y_.abrupt("break",28);case 23:if(!(180<=_h-_f+1)){y_.next=25;break}throw new ib("Message sent failed, exceeded the 180 message in 3 seconds",k.TOO_OFTEN);case 25:_f--,y_.next=19;break;case 28:A.messageSentTimes.push(_d);case 29:y_.t0=l.messageType,y_.next=y_.t0==="TEXT"?32:y_.t0==="RAW"?37:y_.t0==="FILE"||y_.t0==="IMAGE"?39:40;break;case 32:if(!Vt){y_.next=36;break}return e_=l.text.split("_"),u_=ra(e_,3),w_=u_[1],O_=u_[2],B.info("[rtm-API] EndCall message send api is called"),y_.abrupt("return",A.sendInvitationMessage({peerId:p,type:"CallCancel",extra:O_,channelId:w_,callId:"0"}));case 36:return y_.abrupt("return",A.sendTextMessage(l.text,p,_,z,1e4-j));case 37:return l.description===void 0&&(l.description=""),y_.abrupt("return",A.sendRawMessage(l.rawMessage,l.description,p,_,z,1e4-j));case 39:return y_.abrupt("return",A.sendMediaMessage(l.messageType,l,p,_,z,1e4-j));case 40:throw new I("Invalid message type",ve);case 41:case"end":return y_.stop()}},s)}))).apply(this,arguments)}function Yt(s){var o=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],l=s.replace(/(https?:\/\/)?(www.)?/i,"");return o||(l=l.split(".").slice(s.length-2).join(".")),l.indexOf("/")!==-1?l.split("/")[0]:l}function oa(s){if(typeof s!="string")return"[Sensitive Info]";var o=Math.floor(.7*s.length),l=s.length;return Um(s,o,l,"*".repeat(l-o))}function Vm(s,o,l){function p(_){if(s===void 0)return s;if(Il(_))return _;if(Array.isArray(_))return _.map(p);var A={},k=0;for(_=Hg(_);k<_.length;k++){var j=ra(_[k],2),B=j[0];if(typeof(j=j[1])=="string"&&l.includes(B)){A[B]=typeof j=="string"?oa(j):"[Sensitive Info]";break}o.includes(B)?A[B]="[Hidden Info]":A[B]=j==null?j:l.includes(B)?"[Sensitive Info]":p(j)}return A}return Array.isArray(s)?s.map(p):p(s)}function Wm(s){return Object.getOwnPropertyNames(s).forEach(function(o){X(o=s[o])=="object"&&o!==null&&Wm(o)}),Object.freeze(s)}function pa(s){return new TextDecoder("utf-8").decode(s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength))}function Ig(s){return new TextEncoder().encode(s).length}function Xm(){for(var s=0,o=arguments.length,l=Array(o),p=0;p<o;p++)l[p]=arguments[p];for(o=0;o<l.length;o++)s+=l[o].length;for(s=new Uint8Array(s),p=o=0;p<l.length;p++){var _=l[p];s.set(_,o),o+=_.length}return s}function we(s,o,l){var p=s.match(/([^?#]+)(\?[^#]*)?(#.*)?/);if(s=p==null?void 0:p[1],p=p==null?void 0:p[2]){var _;for(p=p.substr(1).split("&"),_=0;_<p.length;_++)if(p[_].split("=")[0]==o){p[_]=o+"="+encodeURIComponent(l);break}return _==p.length&&p.push(o+"="+encodeURIComponent(l)),s+"?"+p.join("&")}return s+"?"+o+"="+encodeURIComponent(l)}function Ji(s){return new Promise(function(o,l){var p=new FileReader;p.onloadend=function(){var _=p.result||new ArrayBuffer(0);o(_)},p.onerror=l,p.readAsArrayBuffer(s)})}function Zt(s,o){s=s=[s],typeof(o=o||{})=="string"&&(o={type:o});try{var l=new Blob(s,o)}catch(_){if(_.name!=="TypeError")throw _;l=new(typeof BlobBuilder<"u"?BlobBuilder:typeof MSBlobBuilder<"u"?MSBlobBuilder:typeof MozBlobBuilder<"u"?MozBlobBuilder:WebKitBlobBuilder);for(var p=0;p<s.length;p+=1)l.append(s[p]);l=l.getBlob(o.type)}return l}function Um(s,o,l,p){return typeof s!="string"?"[Sensitive Info]":s.substring(0,o)+p+s.substring(l)}function Ym(s){var o=[];return function l(p){if(p===null||X(p)!=="object")return p;if(o.indexOf(p)!==-1)return"[Circular]";if(o.push(p),typeof p.toJSON=="function")try{var _=l(p.toJSON());return o.pop(),_}catch(A){return"[Throws: "+(A?A.message:"?")+"]"}return Array.isArray(p)?(_=p.map(l),o.pop(),_):(_=Object.keys(p).reduce(function(A,k){t:{if($t.call(p,k))try{var j=p[k];break t}catch(B){j="[Throws: "+(B?B.message:"?")+"]";break t}j=p[k]}return A[k]=l(j),A},{}),o.pop(),_)}(s)}function au(s){if(!(100<(s=String(s)).length)&&(s=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(s))){var o=parseFloat(s[1]);switch((s[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*o;case"weeks":case"week":case"w":return 6048e5*o;case"days":case"day":case"d":return 864e5*o;case"hours":case"hour":case"hrs":case"hr":case"h":return 36e5*o;case"minutes":case"minute":case"mins":case"min":case"m":return 6e4*o;case"seconds":case"second":case"secs":case"sec":case"s":return 1e3*o;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return o}}}function Jg(s,o,l,p){return Math.round(s/l)+" "+p+(o>=1.5*l?"s":"")}function bu(s){var o=s.areas,l=s.excludedArea;if(o.length===1&&o[0]===F.GLOBAL&&l===F.CHINA)return xe([F.OVERSEA]);if(o.includes(F.GLOBAL)){if(s=xf(Kg).filter(function(A){return A!==F.GLOBAL&&A!==F.OVERSEA}),l in yf){o=yf[l];var p=[].concat(G(o??[]),[l]);return xe(s.filter(function(A){return!p.includes(A)}))}if(Zm(l)){var _=cu(l);return xe(s.filter(function(A){return A!==l&&A!==_}))}}if(Zm(l)||l in yf)return xe(o);throw new I("Invalid excludedArea area config")}function Ma(s,o,l){l===void 0&&(l=Object.getOwnPropertyDescriptor(s,o));var p=l.value;return l.value=function(){for(var _=this,A=arguments.length,k=Array(A),j=0;j<A;j++)k[j]=arguments[j];this.invokeTracker.apply(this,["%s: ".concat(0<k.length?"%s with args: ".concat(k.map(function(){return"%o"})):"%s"),this.name,o].concat(G(k.map(ye))));try{var B=p.apply(this,k)}catch(Vt){throw this.logError.apply(this,["".concat(Vt.code!==void 0?"Error Code ".concat(Vt.code,": "):"","%s failed").concat(0<k.length?" with args: ".concat(k.map(function(){return"%o"})):""),o].concat(G(k.map(ye)))),Vt.originalError&&this.logError(Vt.originalError),this.errorTracker(Vt),Vt}var z=Date.now();return J(w.mark(function Vt(){var _e,_n;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:return _o.prev=0,_o.next=3,B;case 3:_e=_o.sent,_o.next=12;break;case 6:return _o.prev=6,_o.t0=_o.catch(0),_.logError.apply(_,["".concat(_o.t0.code!==void 0?"Error Code ".concat(_o.t0.code,": "):"","%s failed").concat(0<k.length?" with args: ".concat(k.map(function(){return"%o"})):""),o].concat(G(k.map(ye)))),_o.t0.originalError&&_.logError(_o.t0.originalError),_.errorTracker(_o.t0),_o.abrupt("return");case 12:_e!==B?_e===void 0?_.resultTracker("%s promise resolves after %dms",o,Date.now()-z):_.resultTracker("%s promise resolves after %dms, result is %o",o,Date.now()-z,ye(_e)):Ac(_e)!=="Object"||yd(_e)?_.resultTracker("%s result is %o",o,ye(_e)):_.resultTracker("%s result is %s",o,_e.name||((_n=_e.constructor)===null||_n===void 0?void 0:_n.name));case 13:case"end":return _o.stop()}},Vt,null,[[0,6]])}))(),B},l}function Nb(s,o,l){l===void 0&&(l=Object.getOwnPropertyDescriptor(s,o));var p=l.value;return l.value=function(){for(var _=this,A=arguments.length,k=Array(A),j=0;j<A;j++)k[j]=arguments[j];this.invokeTracker.apply(this,["%s: ".concat(0<k.length?"%s with args: ".concat(k.map(function(){return"%o"})):"%s"),this.name,o].concat(k));try{var B=p.apply(this,k)}catch(Vt){throw this.logError.apply(this,["".concat(Vt.code!==void 0?"Error Code ".concat(Vt.code,": "):"","%s failed").concat(0<k.length?" with args: ".concat(k.map(function(){return"%o"})):""),o].concat(k)),Vt.originalError&&this.logError(Vt.originalError),this.errorTracker(Vt),Vt}var z=Date.now();return J(w.mark(function Vt(){var _e,_n;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:return _o.prev=0,_o.next=3,B;case 3:_e=_o.sent,_o.next=12;break;case 6:return _o.prev=6,_o.t0=_o.catch(0),_.logError.apply(_,["".concat(_o.t0.code!==void 0?"Error Code ".concat(_o.t0.code,": "):"","%s failed").concat(0<k.length?" with args: ".concat(k.map(function(){return"%o"})):""),o].concat(k)),_o.t0.originalError&&_.logError(_o.t0.originalError),_.errorTracker(_o.t0),_o.abrupt("return");case 12:_e!==B?_e===void 0?_.resultTracker("%s promise resolves after %dms",o,Date.now()-z):_.resultTracker("%s promise resolves after %dms, result is %o",o,Date.now()-z,_e):Ac(_e)!=="Object"||yd(_e)?_.resultTracker("%s result is %o",o,_e):_.resultTracker("%s result is %s",o,_e.name||((_n=_e.constructor)===null||_n===void 0?void 0:_n.name));case 13:case"end":return _o.stop()}},Vt,null,[[0,6]])}))(),B},l}function du(s,o){var l="".concat(s,"Uri");if(typeof(l=Li[l])!="number"||l===0)throw new TypeError("Got Unknown URI Name");return o=new(s=$m[s])(o),o=s.encode(o).finish(),new eu({uri:l,data:o})}function an(s,o){return"".concat(s.split(".").join("-"),".edge.").concat(o?"sd-rtn.com":"agora.io")}function eb(s,o,l){return Mi.apply(this,arguments)}function Mi(){return(Mi=J(w.mark(function s(o,l,p){var _,A;return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:k.next=2;break;case 2:return _=fu[o].encode(l).finish(),A=function(){var j=J(w.mark(function B(z){var Vt,_e,_n,_o=arguments;return w.wrap(function(_c){for(;;)switch(_c.prev=_c.next){case 0:if(!(3<(_e=1<_o.length&&_o[1]!==void 0?_o[1]:0))){_c.next=3;break}return _c.abrupt("return");case 3:return _n=we(_n=p?"https://".concat((Vt=M==null?void 0:M.PROXY_NGINX[0])!==null&&Vt!==void 0?Vt:"webrtc-cloud-proxy.sd-rtn.com","/rs/?h=").concat(z,"&p=6443&d=events/proto-raw"):"https://".concat(z,":6443/events/proto-raw"),"sentTs",Math.ceil(Date.now()/1e3).toString()),_n=we(_n,"id",gu[o].toString()),_c.next=8,te(_n,{body:_,timeout:2e4,headers:{"Content-Type":"application/octet-stream"}}).catch(function(_d){return A(z,_e+1)});case 8:case"end":return _c.stop()}},B)}));return function(B){return j.apply(this,arguments)}}(),k.prev=4,k.next=7,A((M==null?void 0:M.EVENT_REPORT_DOMAIN[0])||"webcollector-rtm.agora.io");case 7:k.next=13;break;case 9:return k.prev=9,k.t0=k.catch(4),k.next=13,A(M&&bn(1<(M==null?void 0:M.EVENT_REPORT_DOMAIN.length)?M==null?void 0:M.EVENT_REPORT_DOMAIN.slice(1):M==null?void 0:M.EVENT_REPORT_DOMAIN)||"rtm.statscollector.sd-rtn.com");case 13:case"end":return k.stop()}},s,null,[[4,9]])}))).apply(this,arguments)}function fb(s){return s===void 0?U.fromNumber(0):U.fromNumber(Date.now()-s)}function hu(s){return btoa(String.fromCharCode.apply({},s.replace(/\r|\n/g,"").replace(/([\dA-Fa-f]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ").map(function(o){return parseInt(o,16)}))).replace(/={1,2}$/,"")}function Lg(s,o){return U.fromValue(s).eq(o)}function Mg(s,o){var l=o===void 0?s.val:o,p=s.isBoolean;o=s.isNumber;var _=s.oneof,A=s.len;if([p,o,_].filter(function(k){return!k}).length!==2)throw new TypeError("invalid field type");if(l!==void 0&&(s=!1,_!==void 0&&(_=Ni(_),iu(_,Lg).length===_.length&&ju(_,function(k){return Lg(l,k)})!==void 0&&(s=!0)),p=p!==void 0&&(l===0||l===1)&&A===1,o=o!==void 0&&l.toString(2).length<=A,!(s||p||o)))throw Error("invalid field value")}function cn(s){return function(){var o=s();if(!o)throw new K("Client is not logged in. Cannot do the operation");return o}}var Ya=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof globalThis<"u"?globalThis:typeof self<"u"?self:{},Ng=function(s){return s&&s.Math==Math&&s},y=Ng(typeof globalThis=="object"&&globalThis)||Ng(typeof window=="object"&&window)||Ng(typeof self=="object"&&self)||Ng(typeof Ya=="object"&&Ya)||function(){return this}()||Function("return this")(),R=function(s){try{return!!s()}catch{return!0}},ka=!R(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),dn={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,zf=en&&!dn.call({1:2},1)?function(s){return!!(s=en(this,s))&&s.enumerable}:dn,dd=function(s,o){return{enumerable:!(1&s),configurable:!(2&s),writable:!(4&s),value:o}},ku={}.toString,Zb=function(s){return ku.call(s).slice(8,-1)},lu="".split,Af=R(function(){return!Object("z").propertyIsEnumerable(0)})?function(s){return Zb(s)=="String"?lu.call(s,""):Object(s)}:Object,jb=function(s){if(s==null)throw TypeError("Can't call method on "+s);return s},qb=function(s){return Af(jb(s))},ha=function(s){return typeof s=="object"?s!==null:typeof s=="function"},lc=function(s,o){if(!ha(s))return s;var l,p;if(o&&typeof(l=s.toString)=="function"&&!ha(p=l.call(s))||typeof(l=s.valueOf)=="function"&&!ha(p=l.call(s))||!o&&typeof(l=s.toString)=="function"&&!ha(p=l.call(s)))return p;throw TypeError("Can't convert object to primitive value")},Qa=function(s){return Object(jb(s))},mu={}.hasOwnProperty,Q=function(s,o){return mu.call(Qa(s),o)},ze=y.document,Og=ha(ze)&&ha(ze.createElement),fn=!ka&&!R(function(){return Object.defineProperty(Og?ze.createElement("div"):{},"a",{get:function(){return 7}}).a!=7}),gn=Object.getOwnPropertyDescriptor,Fb={f:ka?gn:function(s,o){if(s=qb(s),o=lc(o,!0),fn)try{return gn(s,o)}catch{}if(Q(s,o))return dd(!zf.call(s,o),s[o])}},va=function(s){if(!ha(s))throw TypeError(String(s)+" is not an object");return s},hn=Object.defineProperty,Ra={f:ka?hn:function(s,o,l){if(va(s),o=lc(o,!0),va(l),fn)try{return hn(s,o,l)}catch{}if("get"in l||"set"in l)throw TypeError("Accessors not supported");return"value"in l&&(s[o]=l.value),s}},Na=ka?function(s,o,l){return Ra.f(s,o,dd(1,l))}:function(s,o,l){return s[o]=l,s},Oi=function(s,o){try{Na(y,s,o)}catch{y[s]=o}return o},ed=y["__core-js_shared__"]||Oi("__core-js_shared__",{}),nu=Function.toString;typeof ed.inspectSource!="function"&&(ed.inspectSource=function(s){return nu.call(s)});var Pi=ed.inspectSource,jn=y.WeakMap,ou=typeof jn=="function"&&/native code/.test(Pi(jn)),fd=$a(function(s){(s.exports=function(o,l){return ed[o]||(ed[o]=l!==void 0?l:{})})("versions",[]).push({version:"3.12.1",mode:"global",copyright:"© 2021 Denis Pushkarev (zloirock.ru)"})}),pu=0,qu=Math.random(),Ae=function(s){return"Symbol("+String(s===void 0?"":s)+")_"+(++pu+qu).toString(36)},kn=fd("keys"),Pg=function(s){return kn[s]||(kn[s]=Ae(s))},Be={},ru=y.WeakMap;if(ou||ed.state)var Gd=ed.state||(ed.state=new ru),su=Gd.get,ln=Gd.has,tu=Gd.set,Qi=function(s,o){if(ln.call(Gd,s))throw new TypeError("Object already initialized");return o.facade=s,tu.call(Gd,s,o),o},Qg=function(s){return su.call(Gd,s)||{}},Ri=function(s){return ln.call(Gd,s)};else{var Ce=Pg("state");Be[Ce]=!0,Qi=function(s,o){if(Q(s,Ce))throw new TypeError("Object already initialized");return o.facade=s,Na(s,Ce,o),o},Qg=function(s){return Q(s,Ce)?s[Ce]:{}},Ri=function(s){return Q(s,Ce)}}var Za={set:Qi,get:Qg,has:Ri,enforce:function(s){return Ri(s)?Qg(s):Qi(s,{})},getterFor:function(s){return function(o){var l;if(!ha(o)||(l=Qg(o)).type!==s)throw TypeError("Incompatible receiver, "+s+" required");return l}}},Ta=$a(function(s){var o=Za.get,l=Za.enforce,p=String(String).split("String");(s.exports=function(_,A,k,j){var B=!!j&&!!j.unsafe,z=!!j&&!!j.enumerable;if(j=!!j&&!!j.noTargetGet,typeof k=="function"){typeof A!="string"||Q(k,"name")||Na(k,"name",A);var Vt=l(k);Vt.source||(Vt.source=p.join(typeof A=="string"?A:""))}_===y?z?_[A]=k:Oi(A,k):(B?!j&&_[A]&&(z=!0):delete _[A],z?_[A]=k:Na(_,A,k))})(Function.prototype,"toString",function(){return typeof this=="function"&&o(this).source||Pi(this)})}),mn=function(s){return typeof s=="function"?s:void 0},mc=function(s,o){return 2>arguments.length?mn(y[s])||mn(y[s]):y[s]&&y[s][o]||y[s]&&y[s][o]},uu=Math.ceil,vu=Math.floor,$b=function(s){return isNaN(s=+s)?0:(0<s?vu:uu)(s)},wu=Math.min,ta=function(s){return 0<s?wu($b(s),9007199254740991):0},xu=Math.max,yu=Math.min,xb=function(s,o){return 0>(s=$b(s))?xu(s+o,0):yu(s,o)},nn=function(s){return function(o,l,p){o=qb(o);var _=ta(o.length);if(p=xb(p,_),s&&l!=l){for(;_>p;)if((l=o[p++])!=l)return!0}else for(;_>p;p++)if((s||p in o)&&o[p]===l)return s||p||0;return!s&&-1}},on=nn(!0),Si=nn(!1),pn=function(s,o){s=qb(s);var l,p=0,_=[];for(l in s)!Q(Be,l)&&Q(s,l)&&_.push(l);for(;o.length>p;)Q(s,l=o[p++])&&(~Si(_,l)||_.push(l));return _},Rg="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" "),zu=Rg.concat("length","prototype"),Hd={f:Object.getOwnPropertyNames||function(s){return pn(s,zu)}},Bf={f:Object.getOwnPropertySymbols},qn=mc("Reflect","ownKeys")||function(s){var o=Hd.f(va(s)),l=Bf.f;return l?o.concat(l(s)):o},rn=function(s,o){for(var l=qn(o),p=Ra.f,_=Fb.f,A=0;A<l.length;A++){var k=l[A];Q(s,k)||p(s,k,_(o,k))}},Au=/#|\.prototype\./,nc=function(s,o){return(s=Bu[Cu(s)])==Du||s!=Eu&&(typeof o=="function"?R(o):!!o)},Cu=nc.normalize=function(s){return String(s).replace(Au,".").toLowerCase()},Bu=nc.data={},Eu=nc.NATIVE="N",Du=nc.POLYFILL="P",Fu=Fb.f,N=function(s,o){var l,p,_,A=s.target,k=s.global,j=s.stat;if(p=k?y:j?y[A]||Oi(A,{}):(y[A]||{}).prototype)for(_ in o){var B=o[_],z=s.noTargetGet?(l=Fu(p,_))&&l.value:p[_];if(!(l=nc(k?_:A+(j?".":"#")+_,s.forced))&&z!==void 0){if(typeof B==typeof z)continue;rn(B,z)}(s.sham||z&&z.sham)&&Na(B,"sham",!0);try{Ta(p,_,B,s)}catch{}}},yb=function(s){if(typeof s!="function")throw TypeError(String(s)+" is not a function");return s},Id=function(s,o,l){if(yb(s),o===void 0)return s;switch(l){case 0:return function(){return s.call(o)};case 1:return function(p){return s.call(o,p)};case 2:return function(p,_){return s.call(o,p,_)};case 3:return function(p,_,A){return s.call(o,p,_,A)}}return function(){return s.apply(o,arguments)}},gd=Array.isArray||function(s){return Zb(s)=="Array"},De=mc("navigator","userAgent")||"",sn=y.process,tn=sn&&sn.versions,un=tn&&tn.v8;if(un)var hd=un.split("."),Ti=4>hd[0]?1:hd[0]+hd[1];else De&&(hd=De.match(/Edge\/(\d+)/),(!hd||74<=hd[1])&&(hd=De.match(/Chrome\/(\d+)/))&&(Ti=hd[1]));var id=Ti&&+Ti,oc=!!Object.getOwnPropertySymbols&&!R(function(){return!String(Symbol())||!Symbol.sham&&id&&41>id}),vn=oc&&!Symbol.sham&&typeof Symbol.iterator=="symbol",Cf=fd("wks"),Df=y.Symbol,Gu=vn?Df:Df&&Df.withoutSetter||Ae,qa=function(s){return Q(Cf,s)&&(oc||typeof Cf[s]=="string")||(oc&&Q(Df,s)?Cf[s]=Df[s]:Cf[s]=Gu("Symbol."+s)),Cf[s]},Hu=qa("species"),Sg=function(s,o){if(gd(s)){var l=s.constructor;typeof l!="function"||l!==Array&&!gd(l.prototype)?ha(l)&&(l=l[Hu])===null&&(l=void 0):l=void 0}return new(l===void 0?Array:l)(o===0?0:o)},wn=[].push,jd=function(s){var o=s==1,l=s==2,p=s==3,_=s==4,A=s==6,k=s==7,j=s==5||A;return function(B,z,Vt,_e){var _n=Qa(B),_o=Af(_n);z=Id(z,Vt,3),Vt=ta(_o.length);var _c,_d=0;for(_e=_e||Sg,B=o?_e(B,Vt):l||k?_e(B,0):void 0;Vt>_d;_d++)if((j||_d in _o)&&(_c=z(_e=_o[_d],_d,_n),s))if(o)B[_d]=_c;else if(_c)switch(s){case 3:return!0;case 5:return _e;case 6:return _d;case 2:wn.call(B,_e)}else switch(s){case 4:return!1;case 7:wn.call(B,_e)}return A?-1:p||_?_:B}},Jd=jd(0),xn=jd(1),yn=jd(2),Iu=jd(3),Ju=jd(4),zn=jd(5),An=jd(6),Ku=qa("species"),Ef=function(s){return 51<=id||!R(function(){var o=[];return(o.constructor={})[Ku]=function(){return{foo:1}},o[s](Boolean).foo!==1})},Lu=Ef("filter");N({target:"Array",proto:!0,forced:!Lu},{filter:function(s){return yn(this,s,1<arguments.length?arguments[1]:void 0)}});var Dc=Object.keys||function(s){return pn(s,Rg)},Mu=R(function(){Dc(1)});N({target:"Object",stat:!0,forced:Mu},{keys:function(s){return Dc(Qa(s))}});var Ee=function(s,o){var l=[][s];return!!l&&R(function(){l.call(null,o||function(){throw 1},1)})},Nu=[].join,Ou=Af!=Object,Pu=Ee("join",",");N({target:"Array",proto:!0,forced:Ou||!Pu},{join:function(s){return Nu.call(qb(this),s===void 0?",":s)}});var Qu=Ef("map");N({target:"Array",proto:!0,forced:!Qu},{map:function(s){return xn(this,s,1<arguments.length?arguments[1]:void 0)}});var Ui=function(s){var o=s.return;if(o!==void 0)return va(o.call(s)).value},Fe={},Ru=qa("iterator"),Su=Array.prototype,Vi=function(s){return s!==void 0&&(Fe.Array===s||Su[Ru]===s)},Ge=function(s,o,l){(o=lc(o))in s?Ra.f(s,o,dd(0,l)):s[o]=l},Tu=qa("toStringTag"),Bn={};Bn[Tu]="z";var Wi=String(Bn)==="[object z]",Uu=qa("toStringTag"),Vu=Zb(function(){return arguments}())=="Arguments",Ff=Wi?Zb:function(s){var o;if(s===void 0)var l="Undefined";else{if(s===null)var p="Null";else{t:{var _=s=Object(s);try{p=_[Uu];break t}catch{}p=void 0}p=typeof(l=p)=="string"?l:Vu?Zb(s):(o=Zb(s))=="Object"&&typeof s.callee=="function"?"Arguments":o}l=p}return l},Wu=qa("iterator"),Xi=function(s){if(s!=null)return s[Wu]||s["@@iterator"]||Fe[Ff(s)]},Cn=qa("iterator"),Dn=!1;try{var Xu=0,En={next:function(){return{done:!!Xu++}},return:function(){Dn=!0}};En[Cn]=function(){return this},Array.from(En,function(){throw 2})}catch(s){}var Tg=function(s,o){if(!o&&!Dn)return!1;var l=!1;try{(o={})[Cn]=function(){return{next:function(){return{done:l=!0}}}},s(o)}catch{}return l},Yu=!Tg(function(s){Array.from(s)});N({target:"Array",stat:!0,forced:Yu},{from:function(s){var o,l=Qa(s),p=typeof this=="function"?this:Array,_=arguments.length,A=1<_?arguments[1]:void 0,k=A!==void 0,j=Xi(l),B=0;if(k&&(A=Id(A,2<_?arguments[2]:void 0,2)),j==null||p==Array&&Vi(j)){var z=ta(l.length);for(p=new p(z);z>B;B++)j=k?A(l[B],B):l[B],Ge(p,B,j)}else for(_=(l=j.call(l)).next,p=new p;!(o=_.call(l)).done;B++){if(k){j=l;var Vt=A;o=[o.value,B];try{z=Vt(va(o)[0],o[1])}catch(_e){throw Ui(j),_e}}else z=o.value;Ge(p,B,j=z)}return p.length=B,p}});var Fn=function(s){return function(o,l){o=String(jb(o)),l=$b(l);var p,_=o.length;if(0>l||l>=_)return s?"":void 0;var A=o.charCodeAt(l);return 55296>A||56319<A||l+1===_||56320>(p=o.charCodeAt(l+1))||57343<p?s?o.charAt(l):A:s?o.slice(l,l+2):p-56320+(A-55296<<10)+65536}},Gn=Fn(!0),Hn=!R(function(){function s(){}return s.prototype.constructor=null,Object.getPrototypeOf(new s)!==s.prototype}),In=Pg("IE_PROTO"),Zu=Object.prototype,Vb=Hn?Object.getPrototypeOf:function(s){return s=Qa(s),Q(s,In)?s[In]:typeof s.constructor=="function"&&s instanceof s.constructor?s.constructor.prototype:s instanceof Object?Zu:null},Yi=qa("iterator"),Jn=!1,$u=function(){return this},Kd;if([].keys){var Kn=[].keys();if("next"in Kn){var Ln=Vb(Vb(Kn));Ln!==Object.prototype&&(Kd=Ln)}else Jn=!0}(Kd==null||R(function(){var s={};return Kd[Yi].call(s)!==s}))&&(Kd={}),Q(Kd,Yi)||Na(Kd,Yi,$u);var Ug=Kd,Vg=Jn,av=ka?Object.defineProperties:function(s,o){va(s);for(var l,p=Dc(o),_=p.length,A=0;_>A;)Ra.f(s,l=p[A++],o[l]);return s},Zi=mc("document","documentElement"),Mn=Pg("IE_PROTO"),$i=function(){},aj,Wg=function(){try{aj=document.domain&&new ActiveXObject("htmlfile")}catch{}if(aj){var s=aj;s.write("<script><\/script>"),s.close(),s=s.parentWindow.Object}else(s=Og?ze.createElement("iframe"):{}).style.display="none",Zi.appendChild(s),s.src="javascript:",(s=s.contentWindow.document).open(),s.write("<script>document.F=Object<\/script>"),s.close(),s=s.F;for(Wg=s,s=Rg.length;s--;)delete Wg.prototype[Rg[s]];return Wg()};Be[Mn]=!0;var ac=Object.create||function(s,o){if(s!==null){$i.prototype=va(s);var l=new $i;$i.prototype=null,l[Mn]=s}else l=Wg();return o===void 0?l:av(l,o)},bv=Ra.f,Nn=qa("toStringTag"),Ec=function(s,o,l){s&&!Q(s=l?s:s.prototype,Nn)&&bv(s,Nn,{configurable:!0,value:o})},cv=function(){return this},dv=function(s,o,l){return o+=" Iterator",s.prototype=ac(Ug,{next:dd(1,l)}),Ec(s,o,!1),Fe[o]=cv,s},Ua=Object.setPrototypeOf||("__proto__"in{}?function(){var s=!1,o={};try{var l=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set;l.call(o,[]),s=o instanceof Array}catch{}return function(p,_){if(va(p),!ha(_)&&_!==null)throw TypeError("Can't set "+String(_)+" as a prototype");return s?l.call(p,_):p.__proto__=_,p}}():void 0),Gf=qa("iterator"),ev=function(){return this},bj=function(s,o,l,p,_,A,k){dv(l,o,p),p=function(_d){if(_d===_&&_n)return _n;if(!Vg&&_d in Vt)return Vt[_d];switch(_d){case"keys":case"values":case"entries":return function(){return new l(this,_d)}}return function(){return new l(this)}};var j,B=o+" Iterator",z=!1,Vt=s.prototype,_e=Vt[Gf]||Vt["@@iterator"]||_&&Vt[_],_n=!Vg&&_e||p(_),_o=o=="Array"&&Vt.entries||_e;if(_o&&(s=Vb(_o.call(new s)),Ug!==Object.prototype&&s.next&&(Vb(s)!==Ug&&(Ua?Ua(s,Ug):typeof s[Gf]!="function"&&Na(s,Gf,ev)),Ec(s,B,!0))),_=="values"&&_e&&_e.name!=="values"&&(z=!0,_n=function(){return _e.call(this)}),Vt[Gf]!==_n&&Na(Vt,Gf,_n),Fe[o]=_n,_){var _c={values:p("values"),keys:A?_n:p("keys"),entries:p("entries")};if(k)for(j in _c)!Vg&&!z&&j in Vt||Ta(Vt,j,_c[j]);else N({target:o,proto:!0,forced:Vg||z},_c)}return _c},fv=Za.set,gv=Za.getterFor("String Iterator");bj(String,"String",function(s){fv(this,{type:"String Iterator",string:String(s),index:0})},function(){var s=gv(this),o=s.string,l=s.index;return l>=o.length?{value:void 0,done:!0}:(o=Gn(o,l),s.index+=o.length,{value:o,done:!1})});var cj=qa("unscopables"),dj=Array.prototype;dj[cj]==null&&Ra.f(dj,cj,{configurable:!0,value:ac(null)});var Ld=function(s){dj[cj][s]=!0},On=!0;"find"in[]&&Array(1).find(function(){On=!1}),N({target:"Array",proto:!0,forced:On},{find:function(s){return zn(this,s,1<arguments.length?arguments[1]:void 0)}}),Ld("find");var Pn=function(s){var o=String(jb(this)),l="";if(0>(s=$b(s))||s==1/0)throw RangeError("Wrong number of repetitions");for(;0<s;(s>>>=1)&&(o+=o))1&s&&(l+=o);return l};N({target:"String",proto:!0},{repeat:Pn}),N({target:"Number",stat:!0},{MAX_SAFE_INTEGER:9007199254740991}),N({target:"Number",stat:!0},{isNaN:function(s){return s!=s}}),y.Number.isNaN;var hv=Wi?{}.toString:function(){return"[object "+Ff(this)+"]"};Wi||Ta(Object.prototype,"toString",hv,{unsafe:!0});var Fc=y.Promise,Hf=function(s,o,l){for(var p in o)Ta(s,p,o[p],l);return s},Qn=qa("species"),If=function(s){s=mc(s);var o=Ra.f;ka&&s&&!s[Qn]&&o(s,Qn,{configurable:!0,get:function(){return this}})},Gc=function(s,o,l){if(!(s instanceof o))throw TypeError("Incorrect "+(l?l+" ":"")+"invocation");return s},Jf=function(s,o){this.stopped=s,this.result=o},Xg=function(s,o,l){var p,_=!(!l||!l.AS_ENTRIES),A=!(!l||!l.IS_ITERATOR),k=!(!l||!l.INTERRUPTED),j=Id(o,l&&l.that,1+_+k),B=function(Vt){return z&&Ui(z),new Jf(!0,Vt)};if(o=function(Vt){return _?(va(Vt),k?j(Vt[0],Vt[1],B):j(Vt[0],Vt[1])):k?j(Vt,B):j(Vt)},A)var z=s;else{if(typeof(A=Xi(s))!="function")throw TypeError("Target is not iterable");if(Vi(A)){for(A=0,l=ta(s.length);l>A;A++)if((p=o(s[A]))&&p instanceof Jf)return p;return new Jf(!1)}z=A.call(s)}for(s=z.next;!(A=s.call(z)).done;){try{p=o(A.value)}catch(Vt){throw Ui(z),Vt}if(typeof p=="object"&&p&&p instanceof Jf)return p}return new Jf(!1)},iv=qa("species"),kd=function(s,o){var l;return(s=va(s).constructor)===void 0||(l=va(s)[iv])==null?o:yb(l)},Rn=/(?:iphone|ipod|ipad).*applewebkit/i.test(De),Hc=Zb(y.process)=="process",Yg=y.location,ej=y.setImmediate,Sn=y.clearImmediate,jv=y.process,Tn=y.MessageChannel,fj=y.Dispatch,gj=0,Kf={},hj=function(s){if(Kf.hasOwnProperty(s)){var o=Kf[s];delete Kf[s],o()}},ij=function(s){return function(){hj(s)}},Un=function(s){hj(s.data)},Vn=function(s){y.postMessage(s+"",Yg.protocol+"//"+Yg.host)};if(!ej||!Sn)if(ej=function(s){for(var o=[],l=1;arguments.length>l;)o.push(arguments[l++]);return Kf[++gj]=function(){(typeof s=="function"?s:Function(s)).apply(void 0,o)},Lf(gj),gj},Sn=function(s){delete Kf[s]},Hc)var Lf=function(s){jv.nextTick(ij(s))};else if(fj&&fj.now)Lf=function(s){fj.now(ij(s))};else if(Tn&&!Rn){var Wn=new Tn,Xn=Wn.port2;Wn.port1.onmessage=Un,Lf=Id(Xn.postMessage,Xn,1)}else y.addEventListener&&typeof postMessage=="function"&&!y.importScripts&&Yg&&Yg.protocol!=="file:"&&!R(Vn)?(Lf=Vn,y.addEventListener("message",Un,!1)):Lf="onreadystatechange"in(Og?ze.createElement("script"):{})?function(s){Zi.appendChild(Og?ze.createElement("script"):{}).onreadystatechange=function(){Zi.removeChild(this),hj(s)}}:function(s){setTimeout(ij(s),0)};var jj=ej,kv=/web0s(?!.*chrome)/i.test(De),lv=Fb.f,Yn=y.MutationObserver||y.WebKitMutationObserver,Zn=y.document,$n=y.process,Zg=y.Promise,ao=lv(y,"queueMicrotask"),bo=ao&&ao.value,Md,Mf;if(!bo){var ah=function(){var s;for(Hc&&(s=$n.domain)&&s.exit();Md;){var o=Md.fn;Md=Md.next;try{o()}catch(l){throw Md?$g():Mf=void 0,l}}Mf=void 0,s&&s.enter()};if(Rn||Hc||kv||!Yn||!Zn)if(Zg&&Zg.resolve){var kj=Zg.resolve(void 0);kj.constructor=Zg;var mv=kj.then,$g=function(){mv.call(kj,ah)}}else $g=Hc?function(){$n.nextTick(ah)}:function(){jj.call(y,ah)};else{var co=!0,eo=Zn.createTextNode("");new Yn(ah).observe(eo,{characterData:!0}),$g=function(){eo.data=co=!co}}}var fo=bo||function(s){s={fn:s,next:void 0},Mf&&(Mf.next=s),Md||(Md=s,$g()),Mf=s},nv=function(s){var o,l;this.promise=new s(function(p,_){if(o!==void 0||l!==void 0)throw TypeError("Bad Promise constructor");o=p,l=_}),this.resolve=yb(o),this.reject=yb(l)},lj={f:function(s){return new nv(s)}},mj=function(s,o){return va(s),ha(o)&&o.constructor===s?o:((0,(s=lj.f(s)).resolve)(o),s.promise)},ov=function(s,o){var l=y.console;l&&l.error&&(arguments.length===1?l.error(s):l.error(s,o))},nj=function(s){try{return{error:!1,value:s()}}catch(o){return{error:!0,value:o}}},pv=typeof window=="object",qv=qa("species"),go=Za.get,rv=Za.set,sv=Za.getterFor("Promise"),Nd=Fc&&Fc.prototype,zb=Fc,bh=Nd,ho=y.TypeError,oj=y.document,pj=y.process,He=lj.f,tv=He,uv=!!(oj&&oj.createEvent&&y.dispatchEvent),io=typeof PromiseRejectionEvent=="function",jo=!1,Nf=nc("Promise",function(){var s=Pi(zb)!==String(zb);if(!s&&id===66)return!0;if(51<=id&&/native code/.test(zb))return!1;var o=new zb(function(p){p(1)}),l=function(p){p(function(){},function(){})};return(o.constructor={})[qv]=l,!(jo=o.then(function(){})instanceof l)||!s&&pv&&!io}),vv=Nf||!Tg(function(s){zb.all(s).catch(function(){})}),ko=function(s){var o;return!(!ha(s)||typeof(o=s.then)!="function")&&o},qj=function(s,o){if(!s.notified){s.notified=!0;var l=s.reactions;fo(function(){for(var p=s.value,_=s.state==1,A=0;l.length>A;){var k,j=l[A++],B=_?j.ok:j.fail,z=j.resolve,Vt=j.reject,_e=j.domain;try{if(B){if(_||(s.rejection===2&&wv(s),s.rejection=1),B===!0)var _n=p;else if(_e&&_e.enter(),_n=B(p),_e){_e.exit();var _o=!0}_n===j.promise?Vt(ho("Promise-chain cycle")):(k=ko(_n))?k.call(_n,z,Vt):z(_n)}else Vt(p)}catch(_c){_e&&!_o&&_e.exit(),Vt(_c)}}s.reactions=[],s.notified=!1,o&&!s.rejection&&xv(s)})}},lo=function(s,o,l){var p;if(uv){var _=oj.createEvent("Event");_.promise=o,_.reason=l,_.initEvent(s,!1,!0),y.dispatchEvent(_)}else _={promise:o,reason:l};!io&&(p=y["on"+s])?p(_):s==="unhandledrejection"&&ov("Unhandled promise rejection",l)},xv=function(s){jj.call(y,function(){var o=s.facade,l=s.value;if(s.rejection!==1&&!s.parent){var p=nj(function(){Hc?pj.emit("unhandledRejection",l,o):lo("unhandledrejection",o,l)});if(s.rejection=Hc||s.rejection!==1&&!s.parent?2:1,p.error)throw p.value}})},wv=function(s){jj.call(y,function(){var o=s.facade;Hc?pj.emit("rejectionHandled",o):lo("rejectionhandled",o,s.value)})},Ie=function(s,o,l){return function(p){s(o,p,l)}},Je=function(s,o,l){s.done||(s.done=!0,l&&(s=l),s.value=o,s.state=2,qj(s,!0))},rj=function(s,o,l){if(!s.done){s.done=!0,l&&(s=l);try{if(s.facade===o)throw ho("Promise can't be resolved itself");var p=ko(o);p?fo(function(){var _={done:!1};try{p.call(o,Ie(rj,_,s),Ie(Je,_,s))}catch(A){Je(_,A,s)}}):(s.value=o,s.state=1,qj(s,!1))}catch(_){Je({done:!1},_,s)}}};if(Nf){zb=function(s){Gc(this,zb,"Promise"),yb(s),sj.call(this);var o=go(this);try{s(Ie(rj,o),Ie(Je,o))}catch(l){Je(o,l)}},bh=zb.prototype;var sj=function(s){rv(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:[],rejection:!1,state:0,value:void 0})};sj.prototype=Hf(bh,{then:function(s,o){var l=sv(this),p=He(kd(this,zb));return p.ok=typeof s!="function"||s,p.fail=typeof o=="function"&&o,p.domain=Hc?pj.domain:void 0,l.parent=!0,l.reactions.push(p),l.state!=0&&qj(l,!1),p.promise},catch:function(s){return this.then(void 0,s)}});var yv=function(){var s=new sj,o=go(s);this.promise=s,this.resolve=Ie(rj,o),this.reject=Ie(Je,o)};if(lj.f=He=function(s){return s===zb||s===zv?new yv(s):tv(s)},typeof Fc=="function"&&Nd!==Object.prototype){var Av=Nd.then;jo||(Ta(Nd,"then",function(s,o){var l=this;return new zb(function(p,_){Av.call(l,p,_)}).then(s,o)},{unsafe:!0}),Ta(Nd,"catch",bh.catch,{unsafe:!0}));try{delete Nd.constructor}catch{}Ua&&Ua(Nd,bh)}}N({global:!0,wrap:!0,forced:Nf},{Promise:zb}),Ec(zb,"Promise",!1),If("Promise");var zv=mc("Promise");N({target:"Promise",stat:!0,forced:Nf},{reject:function(s){var o=He(this);return o.reject.call(void 0,s),o.promise}}),N({target:"Promise",stat:!0,forced:Nf},{resolve:function(s){return mj(this,s)}}),N({target:"Promise",stat:!0,forced:vv},{all:function(s){var o=this,l=He(o),p=l.resolve,_=l.reject,A=nj(function(){var k=yb(o.resolve),j=[],B=0,z=1;Xg(s,function(Vt){var _e=B++,_n=!1;j.push(void 0),z++,k.call(o,Vt).then(function(_o){_n||(_n=!0,j[_e]=_o,--z||p(j))},_)}),--z||p(j)});return A.error&&_(A.value),l.promise},race:function(s){var o=this,l=He(o),p=l.reject,_=nj(function(){var A=yb(o.resolve);Xg(s,function(k){A.call(o,k).then(l.resolve,p)})});return _.error&&p(_.value),l.promise}});var mo=[].indexOf,no=!!mo&&0>1/[1].indexOf(1,-0),Bv=Ee("indexOf");N({target:"Array",proto:!0,forced:no||!Bv},{indexOf:function(s){return no?mo.apply(this,arguments)||0:Si(this,s,1<arguments.length?arguments[1]:void 0)}});var tj=function(){var s=va(this),o="";return s.global&&(o+="g"),s.ignoreCase&&(o+="i"),s.multiline&&(o+="m"),s.dotAll&&(o+="s"),s.unicode&&(o+="u"),s.sticky&&(o+="y"),o},pc=R(function(){var s=RegExp("a","y");return s.lastIndex=2,s.exec("abcd")!=null}),Cv=R(function(){var s=RegExp("^r","gy");return s.lastIndex=2,s.exec("str")!=null}),ch=RegExp.prototype.exec,Dv=fd("native-string-replace",String.prototype.replace),oo=ch,uj=(c=/a/,a=/b*/g,ch.call(c,"a"),ch.call(a,"a"),c.lastIndex!==0||a.lastIndex!==0),po=pc||Cv,vj=/()??/.exec("")[1]!==void 0,c,a;(uj||vj||po)&&(oo=function(s){var o,l=po&&this.sticky,p=tj.call(this),_=this.source,A=0,k=s;if(l){(p=p.replace("y","")).indexOf("g")===-1&&(p+="g"),k=String(s).slice(this.lastIndex),0<this.lastIndex&&(!this.multiline||this.multiline&&s[this.lastIndex-1]!==`
`)&&(_="(?: "+_+")",k=" "+k,A++);var j=new RegExp("^(?:"+_+")",p)}if(vj&&(j=new RegExp("^"+_+"$(?!\\s)",p)),uj)var B=this.lastIndex;var z=ch.call(l?j:this,k);return l?z?(z.input=z.input.slice(A),z[0]=z[0].slice(A),z.index=this.lastIndex,this.lastIndex+=z[0].length):this.lastIndex=0:uj&&z&&(this.lastIndex=this.global?z.index+z[0].length:B),vj&&z&&1<z.length&&Dv.call(z[0],j,function(){for(o=1;o<arguments.length-2;o++)arguments[o]===void 0&&(z[o]=void 0)}),z});var Of=oo;N({target:"RegExp",proto:!0,forced:/./.exec!==Of},{exec:Of});var Ev=qa("species"),wj=RegExp.prototype,Fv=!R(function(){var s=/./;return s.exec=function(){var o=[];return o.groups={a:"7"},o},"".replace(s,"$<a>")!=="7"}),qo="a".replace(/./,"$0")==="$0",ro=qa("replace"),so=!!/./[ro]&&/./[ro]("a","$0")==="",Gv=!R(function(){var s=/(?:)/,o=s.exec;return s.exec=function(){return o.apply(this,arguments)},(s="ab".split(s)).length!==2||s[0]!=="a"||s[1]!=="b"}),dh=function(s,o,l,p){var _=qa(s),A=!R(function(){var z={};return z[_]=function(){return 7},""[s](z)!=7}),k=A&&!R(function(){var z=!1,Vt=/a/;return s==="split"&&((Vt={constructor:{}}).constructor[Ev]=function(){return Vt},Vt.flags="",Vt[_]=/./[_]),Vt.exec=function(){return z=!0,null},Vt[_](""),!z});if(!A||!k||s==="replace"&&(!Fv||!qo||so)||s==="split"&&!Gv){var j=/./[_],B=(l=l(_,""[s],function(z,Vt,_e,_n,_o){var _c=Vt.exec;return _c===Of||_c===wj.exec?A&&!_o?{done:!0,value:j.call(Vt,_e,_n)}:{done:!0,value:z.call(_e,Vt,_n)}:{done:!1}},{REPLACE_KEEPS_$0:qo,REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE:so}))[1];Ta(String.prototype,s,l[0]),Ta(wj,_,o==2?function(z,Vt){return B.call(z,this,Vt)}:function(z){return B.call(z,this)})}p&&Na(wj[_],"sham",!0)},xj=function(s,o,l){return o+(l?Gn(s,o).length:1)},Hv=Math.floor,Iv="".replace,Jv=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,Kv=/\$([$&'`]|\d{1,2})/g,Lv=function(s,o,l,p,_,A){var k=l+s.length,j=p.length,B=Kv;return _!==void 0&&(_=Qa(_),B=Jv),Iv.call(A,B,function(z,Vt){switch(Vt.charAt(0)){case"$":return"$";case"&":return s;case"`":return o.slice(0,l);case"'":return o.slice(k);case"<":z=_[Vt.slice(1,-1)];break;default:var _e=+Vt;if(_e===0)return z;if(_e>j)return(_e=Hv(_e/10))===0?z:_e<=j?p[_e-1]===void 0?Vt.charAt(1):p[_e-1]+Vt.charAt(1):z;z=p[_e-1]}return z===void 0?"":z})},Ke=function(s,o){var l=s.exec;if(typeof l=="function"){if(typeof(s=l.call(s,o))!="object")throw TypeError("RegExp exec method returned something other than an Object or null");return s}if(Zb(s)!=="RegExp")throw TypeError("RegExp#exec called on incompatible receiver");return Of.call(s,o)},Mv=Math.max,Nv=Math.min,Ov=function(s){return s===void 0?s:String(s)};dh("replace",2,function(s,o,l,p){var _=p.REGEXP_REPLACE_SUBSTITUTES_UNDEFINED_CAPTURE,A=p.REPLACE_KEEPS_$0,k=_?"$":"$0";return[function(j,B){var z=jb(this),Vt=j==null?void 0:j[s];return Vt!==void 0?Vt.call(j,z,B):o.call(String(z),j,B)},function(j,B){if(!_&&A||typeof B=="string"&&B.indexOf(k)===-1){var z=l(o,j,this,B);if(z.done)return z.value}var Vt=va(j);j=String(this),(z=typeof B=="function")||(B=String(B));var _e=Vt.global;if(_e){var _n=Vt.unicode;Vt.lastIndex=0}for(var _o=[];;){var _c=Ke(Vt,j);if(_c===null||(_o.push(_c),!_e))break;String(_c[0])===""&&(Vt.lastIndex=xj(j,ta(Vt.lastIndex),_n))}for(_n="",_e=Vt=0;_e<_o.length;_e++){_c=_o[_e];for(var _d=String(_c[0]),_h=Mv(Nv($b(_c.index),j.length),0),_p=[],_f=1;_f<_c.length;_f++)_p.push(Ov(_c[_f]));_c=_c.groups,z?(_p=[_d].concat(_p,_h,j),_c!==void 0&&_p.push(_c),_c=String(B.apply(void 0,_p))):_c=Lv(_d,j,_h,_p,_c,B),_h>=Vt&&(_n+=j.slice(Vt,_h)+_c,Vt=_h+_d.length)}return _n+j.slice(Vt)}]});var Pv=Ef("slice"),Qv=qa("species"),Rv=[].slice,Sv=Math.max;N({target:"Array",proto:!0,forced:!Pv},{slice:function(s,o){var l=qb(this),p=ta(l.length);if(s=xb(s,p),o=xb(o===void 0?p:o,p),gd(l)){var _=l.constructor;if(typeof _!="function"||_!==Array&&!gd(_.prototype)?ha(_)&&(_=_[Qv])===null&&(_=void 0):_=void 0,_===Array||_===void 0)return Rv.call(l,s,o)}for(_=new(_===void 0?Array:_)(Sv(o-s,0)),p=0;s<o;s++,p++)s in l&&Ge(_,p,l[s]);return _.length=p,_}});var Tv=Za.set,Uv=Za.getterFor("Array Iterator"),ld=bj(Array,"Array",function(s,o){Tv(this,{type:"Array Iterator",target:qb(s),index:0,kind:o})},function(){var s=Uv(this),o=s.target,l=s.kind,p=s.index++;return!o||p>=o.length?(s.target=void 0,{value:void 0,done:!0}):l=="keys"?{value:p,done:!1}:l=="values"?{value:o[p],done:!1}:{value:[p,o[p]],done:!1}},"values");Fe.Arguments=Fe.Array,Ld("keys"),Ld("values"),Ld("entries");var to=typeof ArrayBuffer<"u"&&typeof DataView<"u",Le=function(s){if(s===void 0)return 0;s=$b(s);var o=ta(s);if(s!==o)throw RangeError("Wrong length or index");return o},Vv=Math.abs,Ic=Math.pow,Wv=Math.floor,Xv=Math.log,Yv=Math.LN2,yj=function(s){var o=Qa(this),l=ta(o.length),p=arguments.length,_=xb(1<p?arguments[1]:void 0,l);for(l=(p=2<p?arguments[2]:void 0)===void 0?l:xb(p,l);l>_;)o[_++]=s;return o},Zv=Hd.f,$v=Ra.f,Me=Za.get,uo=Za.set,bc=y.ArrayBuffer,Ab=bc,cc=y.DataView,eh=cc&&cc.prototype,vo=Object.prototype,fh=y.RangeError,wo=function(s,o,l){var p,_=Array(l),A=(1<<(l=8*l-o-1))-1,k=A>>1,j=o===23?Ic(2,-24)-Ic(2,-77):0,B=0>s||s===0&&0>1/s?1:0,z=0;if((s=Vv(s))!=s||s===1/0){s=s!=s?1:0;var Vt=A}else Vt=Wv(Xv(s)/Yv),1>s*(p=Ic(2,-Vt))&&(Vt--,p*=2),2<=(s=1<=Vt+k?s+j/p:s+j*Ic(2,1-k))*p&&(Vt++,p/=2),Vt+k>=A?(s=0,Vt=A):1<=Vt+k?(s=(s*p-1)*Ic(2,o),Vt+=k):(s=s*Ic(2,k-1)*Ic(2,o),Vt=0);for(;8<=o;_[z++]=255&s,s/=256,o-=8);for(Vt=Vt<<o|s,l+=o;0<l;_[z++]=255&Vt,Vt/=256,l-=8);return _[--z]|=128*B,_},xo=function(s,o){var l=s.length,p=8*l-o-1,_=(1<<p)-1,A=_>>1;p-=7,--l;var k=s[l--],j=127&k;for(k>>=7;0<p;j=256*j+s[l],l--,p-=8);var B=j&(1<<-p)-1;for(j>>=-p,p+=o;0<p;B=256*B+s[l],l--,p-=8);if(j===0)j=1-A;else{if(j===_)return B?NaN:k?-1/0:1/0;B+=Ic(2,o),j-=A}return(k?-1:1)*B*Ic(2,j-o)},yo=function(s){return[255&s]},zo=function(s){return[255&s,s>>8&255]},Ao=function(s){return[255&s,s>>8&255,s>>16&255,s>>24&255]},Bo=function(s){return s[3]<<24|s[2]<<16|s[1]<<8|s[0]},aw=function(s){return wo(s,23,4)},bw=function(s){return wo(s,52,8)},gh=function(s,o){$v(s.prototype,o,{get:function(){return Me(this)[o]}})},md=function(s,o,l,p){l=Le(l);var _=Me(s);if(l+o>_.byteLength)throw fh("Wrong index");return s=Me(_.buffer).bytes,l+=_.byteOffset,o=s.slice(l,l+o),p?o:o.reverse()},nd=function(s,o,l,p,_,A){l=Le(l);var k=Me(s);if(l+o>k.byteLength)throw fh("Wrong index");for(s=Me(k.buffer).bytes,l+=k.byteOffset,p=p(+_),_=0;_<o;_++)s[l+_]=p[A?_:o-_-1]};if(to){if(!R(function(){bc(1)})||!R(function(){new bc(-1)})||R(function(){return new bc,new bc(1.5),new bc(NaN),bc.name!="ArrayBuffer"})){Ab=function(s){return Gc(this,Ab),new bc(Le(s))};for(var cw=Ab.prototype=bc.prototype,Co=Zv(bc),Do=0,zj;Co.length>Do;)(zj=Co[Do++])in Ab||Na(Ab,zj,bc[zj]);cw.constructor=Ab}Ua&&Vb(eh)!==vo&&Ua(eh,vo);var hh=new cc(new Ab(2)),Eo=eh.setInt8;hh.setInt8(0,2147483648),hh.setInt8(1,2147483649),!hh.getInt8(0)&&hh.getInt8(1)||Hf(eh,{setInt8:function(s,o){Eo.call(this,s,o<<24>>24)},setUint8:function(s,o){Eo.call(this,s,o<<24>>24)}},{unsafe:!0})}else Ab=function(s){Gc(this,Ab,"ArrayBuffer"),s=Le(s),uo(this,{bytes:yj.call(Array(s),0),byteLength:s}),ka||(this.byteLength=s)},cc=function(s,o,l){Gc(this,cc,"DataView"),Gc(s,Ab,"DataView");var p=Me(s).byteLength;if(0>(o=$b(o))||o>p)throw fh("Wrong offset");if(o+(l=l===void 0?p-o:ta(l))>p)throw fh("Wrong length");uo(this,{buffer:s,byteLength:l,byteOffset:o}),ka||(this.buffer=s,this.byteLength=l,this.byteOffset=o)},ka&&(gh(Ab,"byteLength"),gh(cc,"buffer"),gh(cc,"byteLength"),gh(cc,"byteOffset")),Hf(cc.prototype,{getInt8:function(s){return md(this,1,s)[0]<<24>>24},getUint8:function(s){return md(this,1,s)[0]},getInt16:function(s){var o=md(this,2,s,1<arguments.length?arguments[1]:void 0);return(o[1]<<8|o[0])<<16>>16},getUint16:function(s){var o=md(this,2,s,1<arguments.length?arguments[1]:void 0);return o[1]<<8|o[0]},getInt32:function(s){return Bo(md(this,4,s,1<arguments.length?arguments[1]:void 0))},getUint32:function(s){return Bo(md(this,4,s,1<arguments.length?arguments[1]:void 0))>>>0},getFloat32:function(s){return xo(md(this,4,s,1<arguments.length?arguments[1]:void 0),23)},getFloat64:function(s){return xo(md(this,8,s,1<arguments.length?arguments[1]:void 0),52)},setInt8:function(s,o){nd(this,1,s,yo,o)},setUint8:function(s,o){nd(this,1,s,yo,o)},setInt16:function(s,o){nd(this,2,s,zo,o,2<arguments.length?arguments[2]:void 0)},setUint16:function(s,o){nd(this,2,s,zo,o,2<arguments.length?arguments[2]:void 0)},setInt32:function(s,o){nd(this,4,s,Ao,o,2<arguments.length?arguments[2]:void 0)},setUint32:function(s,o){nd(this,4,s,Ao,o,2<arguments.length?arguments[2]:void 0)},setFloat32:function(s,o){nd(this,4,s,aw,o,2<arguments.length?arguments[2]:void 0)},setFloat64:function(s,o){nd(this,8,s,bw,o,2<arguments.length?arguments[2]:void 0)}});Ec(Ab,"ArrayBuffer"),Ec(cc,"DataView");var Pf={ArrayBuffer:Ab,DataView:cc},Aj=Pf.ArrayBuffer,Fo=Pf.DataView,Go=Aj.prototype.slice,dw=R(function(){return!new Aj(2).slice(1,void 0).byteLength});N({target:"ArrayBuffer",proto:!0,unsafe:!0,forced:dw},{slice:function(s,o){if(Go!==void 0&&o===void 0)return Go.call(va(this),s);var l=va(this).byteLength;s=xb(s,l),o=xb(o===void 0?l:o,l),l=new(kd(this,Aj))(ta(o-s));for(var p=new Fo(this),_=new Fo(l),A=0;s<o;)_.setUint8(A++,p.getUint8(s++));return l}});var ew=Ra.f,ih=y.Int8Array,Bj=ih&&ih.prototype,Ho=y.Uint8ClampedArray,Io=Ho&&Ho.prototype,qc=ih&&Vb(ih),dc=Bj&&Vb(Bj),Jo=Object.prototype,Ko=Jo.isPrototypeOf,Lo=qa("toStringTag"),Cj=Ae("TYPED_ARRAY_TAG"),Jc=to&&!!Ua&&Ff(y.opera)!=="Opera",Mo=!1,Bb,rc={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},fw={BigInt64Array:8,BigUint64Array:8},jh=function(s){return!!ha(s)&&(s=Ff(s),Q(rc,s)||Q(fw,s))};for(Bb in rc)y[Bb]||(Jc=!1);if((!Jc||typeof qc!="function"||qc===Function.prototype)&&(qc=function(){throw TypeError("Incorrect invocation")},Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb],qc);if((!Jc||!dc||dc===Jo)&&(dc=qc.prototype,Jc))for(Bb in rc)y[Bb]&&Ua(y[Bb].prototype,dc);if(Jc&&Vb(Io)!==dc&&Ua(Io,dc),ka&&!Q(dc,Lo))for(Bb in Mo=!0,ew(dc,Lo,{get:function(){return ha(this)?this[Cj]:void 0}}),rc)y[Bb]&&Na(y[Bb],Cj,Bb);var Qf=Jc,No=Mo&&Cj,Da=function(s){if(jh(s))return s;throw TypeError("Target is not a typed array")},Ne=function(s){if(Ua){if(Ko.call(qc,s))return s}else for(var o in rc)if(Q(rc,Bb)){var l=y[o];if(l&&(s===l||Ko.call(l,s)))return s}throw TypeError("Target is not a typed array constructor")},Aa=function(s,o,l){if(ka){if(l)for(var p in rc){var _=y[p];if(_&&Q(_.prototype,s))try{delete _.prototype[s]}catch{}}dc[s]&&!l||Ta(dc,s,l?o:Jc&&Bj[s]||o)}},Oo=function(s,o,l){var p,_;if(ka){if(Ua){if(l){for(p in rc)if((_=y[p])&&Q(_,s))try{delete _[s]}catch{}}if(qc[s]&&!l)return;try{return Ta(qc,s,l?o:Jc&&qc[s]||o)}catch{}}for(p in rc)!(_=y[p])||_[s]&&!l||Ta(_,s,o)}},Po=qc,Rf=dc,gw=y.ArrayBuffer,Od=y.Int8Array,Dj=!Qf||!R(function(){Od(1)})||!R(function(){new Od(-1)})||!Tg(function(s){new Od,new Od(null),new Od(1.5),new Od(s)},!0)||R(function(){return new Od(new gw(2),1,void 0).length!==1}),kh=function(s,o){if(0>(s=$b(s)))throw RangeError("The argument can't be less than 0");if(s%o)throw RangeError("Wrong offset");return s},Ej=function(s){var o=Qa(s),l=arguments.length,p=1<l?arguments[1]:void 0,_=p!==void 0,A=Xi(o);if(A!=null&&!Vi(A)){var k=A.call(o),j=k.next;for(o=[];!(A=j.call(k)).done;)o.push(A.value)}for(_&&2<l&&(p=Id(p,arguments[2],2)),A=ta(o.length),k=new(Ne(this))(A),l=0;A>l;l++)k[l]=_?p(o[l],l):o[l];return k},lh=function(s,o,l){var p,_;return Ua&&typeof(p=o.constructor)=="function"&&p!==l&&ha(_=p.prototype)&&_!==l.prototype&&Ua(s,_),s},Sf=$a(function(s){var o=Hd.f,l=Za.get,p=Za.set,_=Ra.f,A=Fb.f,k=Math.round,j=y.RangeError,B=Pf.ArrayBuffer,z=Pf.DataView,Vt=function(_h,_p){var _f=0,e_=_p.length;for(_h=new(Ne(_h))(e_);e_>_f;)_h[_f]=_p[_f++];return _h},_e=function(_h,_p){_(_h,_p,{get:function(){return l(this)[_p]}})},_n=function(_h){var _p;return _h instanceof B||(_p=Ff(_h))=="ArrayBuffer"||_p=="SharedArrayBuffer"},_o=function(_h,_p){return jh(_h)&&typeof _p!="symbol"&&_p in _h&&String(+_p)==String(_p)},_c=function(_h,_p){return _o(_h,_p=lc(_p,!0))?dd(2,_h[_p]):A(_h,_p)},_d=function(_h,_p,_f){return!(_o(_h,_p=lc(_p,!0))&&ha(_f)&&Q(_f,"value"))||Q(_f,"get")||Q(_f,"set")||_f.configurable||Q(_f,"writable")&&!_f.writable||Q(_f,"enumerable")&&!_f.enumerable?_(_h,_p,_f):(_h[_p]=_f.value,_h)};ka?(Qf||(Fb.f=_c,Ra.f=_d,_e(Rf,"buffer"),_e(Rf,"byteOffset"),_e(Rf,"byteLength"),_e(Rf,"length")),N({target:"Object",stat:!0,forced:!Qf},{getOwnPropertyDescriptor:_c,defineProperty:_d}),s.exports=function(_h,_p,_f){var e_=_h.match(/\d+$/)[0]/8,u_=_h+(_f?"Clamped":"")+"Array",w_="get"+_h,O_="set"+_h,y_=y[u_],Z_=y_;_h=Z_&&Z_.prototype;var NE={},i_=function(S_,h_){_(S_,h_,{get:function(){var I_=l(this);return I_.view[w_](h_*e_+I_.byteOffset,!0)},set:function(I_){var vf=l(this);_f&&(I_=0>(I_=k(I_))?0:255<I_?255:255&I_),vf.view[O_](h_*e_+vf.byteOffset,I_,!0)},enumerable:!0})};Qf?Dj&&(Z_=_p(function(S_,h_,I_,vf){return Gc(S_,Z_,u_),lh(ha(h_)?_n(h_)?vf!==void 0?new y_(h_,kh(I_,e_),vf):I_!==void 0?new y_(h_,kh(I_,e_)):new y_(h_):jh(h_)?Vt(Z_,h_):Ej.call(Z_,h_):new y_(Le(h_)),S_,Z_)}),Ua&&Ua(Z_,Po),Jd(o(y_),function(S_){S_ in Z_||Na(Z_,S_,y_[S_])}),Z_.prototype=_h):(Z_=_p(function(S_,h_,I_,vf){Gc(S_,Z_,u_);var o_=0,d_=0;if(ha(h_)){if(!_n(h_))return jh(h_)?Vt(Z_,h_):Ej.call(Z_,h_);var g_=h_;if(d_=kh(I_,e_),h_=h_.byteLength,vf===void 0){if(h_%e_||0>(vf=h_-d_))throw j("Wrong length")}else if((vf=ta(vf)*e_)+d_>h_)throw j("Wrong length");h_=vf/e_}else h_=Le(h_),g_=new B(vf=h_*e_);for(p(S_,{buffer:g_,byteOffset:d_,byteLength:vf,length:h_,view:new z(g_)});o_<h_;)i_(S_,o_++)}),Ua&&Ua(Z_,Po),_h=Z_.prototype=ac(Rf)),_h.constructor!==Z_&&Na(_h,"constructor",Z_),No&&Na(_h,No,u_),NE[u_]=Z_,N({global:!0,forced:Z_!=y_,sham:!Qf},NE),"BYTES_PER_ELEMENT"in Z_||Na(Z_,"BYTES_PER_ELEMENT",e_),"BYTES_PER_ELEMENT"in _h||Na(_h,"BYTES_PER_ELEMENT",e_),If(u_)}):s.exports=function(){}});Sf("Uint8",function(s){return function(o,l,p){return s(this,o,l,p)}});var hw=Math.min,iw=[].copyWithin||function(s,o){var l=Qa(this),p=ta(l.length),_=xb(s,p),A=xb(o,p),k=2<arguments.length?arguments[2]:void 0;for(p=hw((k===void 0?p:xb(k,p))-A,p-_),k=1,A<_&&_<A+p&&(k=-1,A+=p-1,_+=p-1);0<p--;)A in l?l[_]=l[A]:delete l[_],_+=k,A+=k;return l};Aa("copyWithin",function(s,o){return iw.call(Da(this),s,o,2<arguments.length?arguments[2]:void 0)}),Aa("every",function(s){return Ju(Da(this),s,1<arguments.length?arguments[1]:void 0)}),Aa("fill",function(s){return yj.apply(Da(this),arguments)}),Aa("filter",function(s){var o=yn(Da(this),s,1<arguments.length?arguments[1]:void 0),l=kd(this,this.constructor),p=0,_=o.length;for(l=new(Ne(l))(_);_>p;)l[p]=o[p++];return l}),Aa("find",function(s){return zn(Da(this),s,1<arguments.length?arguments[1]:void 0)}),Aa("findIndex",function(s){return An(Da(this),s,1<arguments.length?arguments[1]:void 0)}),Aa("forEach",function(s){Jd(Da(this),s,1<arguments.length?arguments[1]:void 0)}),Aa("includes",function(s){return on(Da(this),s,1<arguments.length?arguments[1]:void 0)}),Aa("indexOf",function(s){return Si(Da(this),s,1<arguments.length?arguments[1]:void 0)});var Qo=qa("iterator"),Ro=y.Uint8Array,jw=ld.values,kw=ld.keys,lw=ld.entries,Fj=Ro&&Ro.prototype[Qo],So=!!Fj&&(Fj.name=="values"||Fj.name==null),To=function(){return jw.call(Da(this))};Aa("entries",function(){return lw.call(Da(this))}),Aa("keys",function(){return kw.call(Da(this))}),Aa("values",To,!So),Aa(Qo,To,!So);var mw=[].join;Aa("join",function(s){return mw.apply(Da(this),arguments)});var nw=Math.min,Gj=[].lastIndexOf,Uo=!!Gj&&0>1/[1].lastIndexOf(1,-0),ow=Ee("lastIndexOf"),pw=Uo||!ow?function(s){if(Uo)return Gj.apply(this,arguments)||0;var o=qb(this),l=ta(o.length),p=l-1;for(1<arguments.length&&(p=nw(p,$b(arguments[1]))),0>p&&(p=l+p);0<=p;p--)if(p in o&&o[p]===s)return p||0;return-1}:Gj;Aa("lastIndexOf",function(s){return pw.apply(Da(this),arguments)}),Aa("map",function(s){return xn(Da(this),s,1<arguments.length?arguments[1]:void 0,function(o,l){return new(Ne(kd(o,o.constructor)))(l)})});var Vo=function(s){return function(o,l,p,_){yb(l),o=Qa(o);var A=Af(o),k=ta(o.length),j=s?k-1:0,B=s?-1:1;if(2>p)for(;;){if(j in A){_=A[j],j+=B;break}if(j+=B,s?0>j:k<=j)throw TypeError("Reduce of empty array with no initial value")}for(;s?0<=j:k>j;j+=B)j in A&&(_=l(_,A[j],j,o));return _}},Wo=Vo(!1),qw=Vo(!0);Aa("reduce",function(s){return Wo(Da(this),s,arguments.length,1<arguments.length?arguments[1]:void 0)}),Aa("reduceRight",function(s){return qw(Da(this),s,arguments.length,1<arguments.length?arguments[1]:void 0)});var rw=Math.floor;Aa("reverse",function(){for(var s,o=Da(this).length,l=rw(o/2),p=0;p<l;)s=this[p],this[p++]=this[--o],this[o]=s;return this});var sw=R(function(){new Int8Array(1).set({})});Aa("set",function(s){Da(this);var o=kh(1<arguments.length?arguments[1]:void 0,1),l=this.length,p=Qa(s),_=ta(p.length),A=0;if(_+o>l)throw RangeError("Wrong length");for(;A<_;)this[o+A]=p[A++]},sw);var tw=[].slice,uw=R(function(){new Int8Array(1).slice()});Aa("slice",function(s,o){s=tw.call(Da(this),s,o);var l=kd(this,this.constructor);o=0;var p=s.length;for(l=new(Ne(l))(p);p>o;)l[o]=s[o++];return l},uw),Aa("some",function(s){return Iu(Da(this),s,1<arguments.length?arguments[1]:void 0)});var vw=[].sort;Aa("sort",function(s){return vw.call(Da(this),s)}),Aa("subarray",function(s,o){var l=Da(this),p=l.length;return s=xb(s,p),new(kd(l,l.constructor))(l.buffer,l.byteOffset+s*l.BYTES_PER_ELEMENT,ta((o===void 0?p:xb(o,p))-s))});var mh=y.Int8Array,Xo=[].toLocaleString,ww=[].slice,xw=!!mh&&R(function(){Xo.call(new mh(1))}),yw=R(function(){return[1,2].toLocaleString()!=new mh([1,2]).toLocaleString()})||!R(function(){mh.prototype.toLocaleString.call([1,2])});Aa("toLocaleString",function(){return Xo.apply(xw?ww.call(Da(this)):Da(this),arguments)},yw);var Yo=y.Uint8Array,zw=Yo&&Yo.prototype||{},nh=[].toString,Aw=[].join;R(function(){nh.call({})})&&(nh=function(){return Aw.call(this)}),Aa("toString",nh,zw.toString!=nh);var Zo=Pf.ArrayBuffer;N({global:!0,forced:y.ArrayBuffer!==Zo},{ArrayBuffer:Zo}),If("ArrayBuffer");var Bw=Ra.f,Hj=Function.prototype,Cw=Hj.toString,Dw=/^\s*function ([^ (]*)/;!ka||"name"in Hj||Bw(Hj,"name",{configurable:!0,get:function(){try{return Cw.call(this).match(Dw)[1]}catch{return""}}});var $o=RegExp.prototype,ap=$o.toString,Ew=R(function(){return ap.call({source:"a",flags:"b"})!="/a/b"}),Fw=ap.name!="toString";(Ew||Fw)&&Ta(RegExp.prototype,"toString",function(){var s=va(this),o=String(s.source),l=s.flags;return"/"+o+"/"+(s=String(l===void 0&&s instanceof RegExp&&!("flags"in $o)?tj.call(s):l))},{unsafe:!0});var Gw=Ef("splice"),Hw=Math.max,Iw=Math.min;N({target:"Array",proto:!0,forced:!Gw},{splice:function(s,o){var l,p,_=Qa(this),A=ta(_.length),k=xb(s,A),j=arguments.length;if(j===0?j=l=0:j===1?(j=0,l=A-k):(j-=2,l=Iw(Hw($b(o),0),A-k)),9007199254740991<A+j-l)throw TypeError("Maximum allowed length exceeded");var B=Sg(_,l);for(p=0;p<l;p++){var z=k+p;z in _&&Ge(B,p,_[z])}if(B.length=l,j<l){for(p=k;p<A-l;p++){var Vt=p+j;(z=p+l)in _?_[Vt]=_[z]:delete _[Vt]}for(p=A;p>A-l+j;p--)delete _[p-1]}else if(j>l)for(p=A-l;p>k;p--)Vt=p+j-1,(z=p+l-1)in _?_[Vt]=_[z]:delete _[Vt];for(p=0;p<j;p++)_[p+k]=arguments[p+2];return _.length=A-l+j,B}});var Ij={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Jj=qa("iterator"),bp=qa("toStringTag"),Kj=ld.values,oh;for(oh in Ij){var cp=y[oh],Kc=cp&&cp.prototype;if(Kc){if(Kc[Jj]!==Kj)try{Na(Kc,Jj,Kj)}catch{Kc[Jj]=Kj}if(Kc[bp]||Na(Kc,bp,oh),Ij[oh]){for(var Oe in ld)if(Kc[Oe]!==ld[Oe])try{Na(Kc,Oe,ld[Oe])}catch{Kc[Oe]=ld[Oe]}}}}var dp=Object.is||function(s,o){return s===o?s!==0||1/s==1/o:s!=s&&o!=o};dh("search",1,function(s,o,l){return[function(p){var _=jb(this),A=p==null?void 0:p[s];return A!==void 0?A.call(p,_):new RegExp(p)[s](String(_))},function(p){var _=l(o,p,this);if(_.done)return _.value;p=va(p);var A=String(this);return _=p.lastIndex,dp(_,0)||(p.lastIndex=0),A=Ke(p,A),dp(p.lastIndex,_)||(p.lastIndex=_),A===null?-1:A.index}]}),$a(function(s){(function(o,l){s.exports?s.exports=l(o):l(o)})(typeof self<"u"?self:Ya,function(o){function l(i_){return btoa(i_).replace(/=+$/,"").replace(/\+/g,"-").replace(/\//g,"_")}function p(i_){return i_=(i_+="===").slice(0,-i_.length%4),atob(i_.replace(/-/g,"+").replace(/_/g,"/"))}function _(i_){for(var S_=new Uint8Array(i_.length),h_=0;h_<i_.length;h_++)S_[h_]=i_.charCodeAt(h_);return S_}function A(i_){return i_ instanceof ArrayBuffer&&(i_=new Uint8Array(i_)),String.fromCharCode.apply(String,i_)}function k(i_){var S_={name:(i_.name||i_||"").toUpperCase().replace("V","v")};switch(S_.name){case"SHA-1":case"SHA-256":case"SHA-384":case"SHA-512":break;case"AES-CBC":case"AES-GCM":case"AES-KW":i_.length&&(S_.length=i_.length);break;case"HMAC":i_.hash&&(S_.hash=k(i_.hash)),i_.length&&(S_.length=i_.length);break;case"RSAES-PKCS1-v1_5":i_.publicExponent&&(S_.publicExponent=new Uint8Array(i_.publicExponent)),i_.modulusLength&&(S_.modulusLength=i_.modulusLength);break;case"RSASSA-PKCS1-v1_5":case"RSA-OAEP":i_.hash&&(S_.hash=k(i_.hash)),i_.publicExponent&&(S_.publicExponent=new Uint8Array(i_.publicExponent)),i_.modulusLength&&(S_.modulusLength=i_.modulusLength);break;default:throw new SyntaxError("Bad algorithm name")}return S_}function j(i_){return{HMAC:{"SHA-1":"HS1","SHA-256":"HS256","SHA-384":"HS384","SHA-512":"HS512"},"RSASSA-PKCS1-v1_5":{"SHA-1":"RS1","SHA-256":"RS256","SHA-384":"RS384","SHA-512":"RS512"},"RSAES-PKCS1-v1_5":{"":"RSA1_5"},"RSA-OAEP":{"SHA-1":"RSA-OAEP","SHA-256":"RSA-OAEP-256"},"AES-KW":{128:"A128KW",192:"A192KW",256:"A256KW"},"AES-GCM":{128:"A128GCM",192:"A192GCM",256:"A256GCM"},"AES-CBC":{128:"A128CBC",192:"A192CBC",256:"A256CBC"}}[i_.name][(i_.hash||{}).name||i_.length||""]}function B(i_){(i_ instanceof ArrayBuffer||i_ instanceof Uint8Array)&&(i_=JSON.parse(decodeURIComponent(escape(A(i_)))));var S_={kty:i_.kty,alg:i_.alg,ext:i_.ext||i_.extractable};switch(S_.kty){case"oct":S_.k=i_.k;case"RSA":"n e d p q dp dq qi oth".split(" ").forEach(function(h_){h_ in i_&&(S_[h_]=i_[h_])});break;default:throw new TypeError("Unsupported key type")}return S_}function z(i_){return i_=B(i_),w_&&(i_.extractable=i_.ext,delete i_.ext),_(unescape(encodeURIComponent(JSON.stringify(i_)))).buffer}function Vt(i_){var S_=_e(i_),h_=!1;switch(2<S_.length&&(h_=!0,S_.shift()),i_={ext:!0},S_[0][0]){case"1.2.840.113549.1.1.1":var I_="n e d p q dp dq qi".split(" ");for(S_=_e(S_[1]),h_&&S_.shift(),h_=0;h_<S_.length;h_++)S_[h_][0]||(S_[h_]=S_[h_].subarray(1)),i_[I_[h_]]=l(A(S_[h_]));i_.kty="RSA";break;default:throw new TypeError("Unsupported key type")}return i_}function _e(i_,S_){if(i_ instanceof ArrayBuffer&&(i_=new Uint8Array(i_)),S_||(S_={pos:0,end:i_.length}),2>S_.end-S_.pos||S_.end>i_.length)throw new RangeError("Malformed DER");var h_=i_[S_.pos++],I_=i_[S_.pos++];if(128<=I_){if(I_&=127,S_.end-S_.pos<I_)throw new RangeError("Malformed DER");for(var vf=0;I_--;)vf<<=8,vf|=i_[S_.pos++];I_=vf}if(S_.end-S_.pos<I_)throw new RangeError("Malformed DER");switch(h_){case 2:h_=i_.subarray(S_.pos,S_.pos+=I_);break;case 3:if(i_[S_.pos++])throw Error("Unsupported bit string");I_--;case 4:h_=new Uint8Array(i_.subarray(S_.pos,S_.pos+=I_)).buffer;break;case 5:h_=null;break;case 6:if(!((i_=btoa(A(i_.subarray(S_.pos,S_.pos+=I_))))in y_))throw Error("Unsupported OBJECT ID "+i_);h_=y_[i_];break;case 48:for(h_=[],I_=S_.pos+I_;S_.pos<I_;)h_.push(_e(i_,S_));break;default:throw Error("Unsupported DER tag 0x"+h_.toString(16))}return h_}function _n(i_,S_){S_||(S_=[]);var h_=S_.length+2;if(S_.push(0,0),i_ instanceof Uint8Array)for(var I_=2,vf=i_.length,o_=0;o_<vf;o_++)S_.push(i_[o_]);else if(i_ instanceof ArrayBuffer)for(I_=4,vf=i_.byteLength,i_=new Uint8Array(i_),o_=0;o_<vf;o_++)S_.push(i_[o_]);else if(i_===null)I_=5,vf=0;else if(typeof i_=="string"&&i_ in Z_)for(I_=6,vf=(i_=_(atob(Z_[i_]))).length,o_=0;o_<vf;o_++)S_.push(i_[o_]);else if(i_ instanceof Array){for(o_=0;o_<i_.length;o_++)_n(i_[o_],S_);I_=48,vf=S_.length-h_}else{if(!(X(i_)==="object"&&i_.tag===3&&i_.value instanceof ArrayBuffer))throw Error("Unsupported DER value "+i_);for(I_=3,vf=(i_=new Uint8Array(i_.value)).byteLength,S_.push(0),o_=0;o_<vf;o_++)S_.push(i_[o_]);vf++}if(128<=vf){for(o_=vf,vf=4,S_.splice(h_,0,o_>>24&255,o_>>16&255,o_>>8&255,255&o_);1<vf&&!(o_>>24);)o_<<=8,vf--;4>vf&&S_.splice(h_,4-vf),vf|=128}return S_.splice(h_-2,2,I_,vf),S_}function _o(i_,S_,h_,I_){Object.defineProperties(this,{_key:{value:i_},type:{value:i_.type,enumerable:!0},extractable:{value:h_===void 0?i_.extractable:h_,enumerable:!0},algorithm:{value:S_===void 0?i_.algorithm:S_,enumerable:!0},usages:{value:I_===void 0?i_.usages:I_,enumerable:!0}})}function _c(i_){return i_==="verify"||i_==="encrypt"||i_==="wrapKey"}function _d(i_){return i_==="sign"||i_==="decrypt"||i_==="unwrapKey"}if(typeof Promise!="function")throw"Promise support required";var _h=o.crypto||o.msCrypto;if(_h){var _p=_h.subtle||_h.webkitSubtle;if(_p){var _f=o.Crypto||_h.constructor||Object,e_=o.SubtleCrypto||_p.constructor||Object;o.CryptoKey||o.Key;var u_=-1<o.navigator.userAgent.indexOf("Edge/"),w_=!!o.msCrypto&&!u_,O_=!_h.subtle&&!!_h.webkitSubtle;if(w_||O_){var y_={KoZIhvcNAQEB:"1.2.840.113549.1.1.1"},Z_={"1.2.840.113549.1.1.1":"KoZIhvcNAQEB"};if(["generateKey","importKey","unwrapKey"].forEach(function(i_){var S_=_p[i_];_p[i_]=function(h_,I_,vf){var o_=[].slice.call(arguments);switch(i_){case"generateKey":var d_=k(h_),g_=I_,v_=vf;break;case"importKey":d_=k(vf),g_=o_[3],v_=o_[4],h_==="jwk"&&((I_=B(I_)).alg||(I_.alg=j(d_)),I_.key_ops||(I_.key_ops=I_.kty!=="oct"?"d"in I_?v_.filter(_d):v_.filter(_c):v_.slice()),o_[1]=z(I_));break;case"unwrapKey":d_=o_[4],g_=o_[5],v_=o_[6],o_[2]=vf._key}if(i_==="generateKey"&&d_.name==="HMAC"&&d_.hash)return d_.length=d_.length||{"SHA-1":512,"SHA-256":512,"SHA-384":1024,"SHA-512":1024}[d_.hash.name],_p.importKey("raw",_h.getRandomValues(new Uint8Array(d_.length+7>>3)),d_,g_,v_);if(O_&&i_==="generateKey"&&d_.name==="RSASSA-PKCS1-v1_5"&&(!d_.modulusLength||2048<=d_.modulusLength))return(h_=k(h_)).name="RSAES-PKCS1-v1_5",delete h_.hash,_p.generateKey(h_,!0,["encrypt","decrypt"]).then(function(R_){return Promise.all([_p.exportKey("jwk",R_.publicKey),_p.exportKey("jwk",R_.privateKey)])}).then(function(R_){return R_[0].alg=R_[1].alg=j(d_),R_[0].key_ops=v_.filter(_c),R_[1].key_ops=v_.filter(_d),Promise.all([_p.importKey("jwk",R_[0],d_,!0,R_[0].key_ops),_p.importKey("jwk",R_[1],d_,g_,R_[1].key_ops)])}).then(function(R_){return{publicKey:R_[0],privateKey:R_[1]}});if((O_||w_&&(d_.hash||{}).name==="SHA-1")&&i_==="importKey"&&h_==="jwk"&&d_.name==="HMAC"&&I_.kty==="oct")return _p.importKey("raw",_(p(I_.k)),vf,o_[3],o_[4]);if(O_&&i_==="importKey"&&(h_==="spki"||h_==="pkcs8"))return _p.importKey("jwk",Vt(I_),vf,o_[3],o_[4]);if(w_&&i_==="unwrapKey")return _p.decrypt(o_[3],vf,I_).then(function(R_){return _p.importKey(h_,R_,o_[4],o_[5],o_[6])});try{var M_=S_.apply(_p,o_)}catch(R_){return Promise.reject(R_)}return w_&&(M_=new Promise(function(R_,X_){M_.onabort=M_.onerror=function(q_){X_(q_)},M_.oncomplete=function(q_){R_(q_.target.result)}})),M_=M_.then(function(R_){return d_.name!=="HMAC"||d_.length||(d_.length=8*R_.algorithm.length),d_.name.search("RSA")==0&&(d_.modulusLength||(d_.modulusLength=(R_.publicKey||R_).algorithm.modulusLength),d_.publicExponent||(d_.publicExponent=(R_.publicKey||R_).algorithm.publicExponent)),R_.publicKey&&R_.privateKey?{publicKey:new _o(R_.publicKey,d_,g_,v_.filter(_c)),privateKey:new _o(R_.privateKey,d_,g_,v_.filter(_d))}:new _o(R_,d_,g_,v_)})}}),["exportKey","wrapKey"].forEach(function(i_){var S_=_p[i_];_p[i_]=function(h_,I_,vf){var o_=[].slice.call(arguments);switch(i_){case"exportKey":o_[1]=I_._key;break;case"wrapKey":o_[1]=I_._key,o_[2]=vf._key}if((O_||w_&&(I_.algorithm.hash||{}).name==="SHA-1")&&i_==="exportKey"&&h_==="jwk"&&I_.algorithm.name==="HMAC"&&(o_[0]="raw"),!O_||i_!=="exportKey"||h_!=="spki"&&h_!=="pkcs8"||(o_[0]="jwk"),w_&&i_==="wrapKey")return _p.exportKey(h_,I_).then(function(g_){return h_==="jwk"&&(g_=_(unescape(encodeURIComponent(JSON.stringify(B(g_)))))),_p.encrypt(o_[3],vf,g_)});try{var d_=S_.apply(_p,o_)}catch(g_){return Promise.reject(g_)}return w_&&(d_=new Promise(function(g_,v_){d_.onabort=d_.onerror=function(M_){v_(M_)},d_.oncomplete=function(M_){g_(M_.target.result)}})),i_==="exportKey"&&h_==="jwk"&&(d_=d_.then(function(g_){return(O_||w_&&(I_.algorithm.hash||{}).name==="SHA-1")&&I_.algorithm.name==="HMAC"?{kty:"oct",alg:j(I_.algorithm),key_ops:I_.usages.slice(),ext:!0,k:l(A(g_))}:((g_=B(g_)).alg||(g_.alg=j(I_.algorithm)),g_.key_ops||(g_.key_ops=I_.type==="public"?I_.usages.filter(_c):I_.type==="private"?I_.usages.filter(_d):I_.usages.slice()),g_)})),!O_||i_!=="exportKey"||h_!=="spki"&&h_!=="pkcs8"||(d_=d_.then(function(g_){var v_=[["",null]],M_=!1;switch((g_=B(g_)).kty){case"RSA":for(var R_="n e d p q dp dq qi".split(" "),X_=[],q_=0;q_<R_.length&&R_[q_]in g_;q_++){var lE=X_[q_]=_(p(g_[R_[q_]]));128&lE[0]&&(X_[q_]=new Uint8Array(lE.length+1),X_[q_].set(lE,1))}2<X_.length&&(M_=!0,X_.unshift(new Uint8Array([0]))),v_[0][0]="1.2.840.113549.1.1.1";break;default:throw new TypeError("Unsupported key type")}return v_.push(new Uint8Array(_n(X_)).buffer),M_?v_.unshift(new Uint8Array([0])):v_[1]={tag:3,value:v_[1]},new Uint8Array(_n(v_)).buffer})),d_}}),["encrypt","decrypt","sign","verify"].forEach(function(i_){var S_=_p[i_];_p[i_]=function(h_,I_,vf,o_){if(w_&&(!vf.byteLength||o_&&!o_.byteLength))throw Error("Empty input is not allowed");var d_=[].slice.call(arguments),g_=k(h_);if(!w_||i_!=="sign"&&i_!=="verify"||h_!=="RSASSA-PKCS1-v1_5"&&h_!=="HMAC"||(d_[0]={name:h_}),w_&&I_.algorithm.hash&&(d_[0].hash=d_[0].hash||I_.algorithm.hash),w_&&i_==="decrypt"&&g_.name==="AES-GCM"){var v_=h_.tagLength>>3;d_[2]=(vf.buffer||vf).slice(0,vf.byteLength-v_),h_.tag=(vf.buffer||vf).slice(vf.byteLength-v_)}w_&&g_.name==="AES-GCM"&&d_[0].tagLength===void 0&&(d_[0].tagLength=128),d_[1]=I_._key;try{var M_=S_.apply(_p,d_)}catch(R_){return Promise.reject(R_)}return w_&&(M_=new Promise(function(R_,X_){M_.onabort=M_.onerror=function(q_){X_(q_)},M_.oncomplete=function(q_){if(q_=q_.target.result,i_==="encrypt"&&q_ instanceof AesGcmEncryptResult){var lE=q_.ciphertext,Lb=q_.tag;(q_=new Uint8Array(lE.byteLength+Lb.byteLength)).set(new Uint8Array(lE),0),q_.set(new Uint8Array(Lb),lE.byteLength),q_=q_.buffer}R_(q_)}})),M_}}),w_){var NE=_p.digest;_p.digest=function(i_,S_){if(!S_.byteLength)throw Error("Empty input is not allowed");try{var h_=NE.call(_p,i_,S_)}catch(I_){return Promise.reject(I_)}return h_=new Promise(function(I_,vf){h_.onabort=h_.onerror=function(o_){vf(o_)},h_.oncomplete=function(o_){I_(o_.target.result)}})},o.crypto=Object.create(_h,{getRandomValues:{value:function(i_){return _h.getRandomValues(i_)}},subtle:{value:_p}}),o.CryptoKey=_o}O_&&(_h.subtle=_p,o.Crypto=_f,o.SubtleCrypto=e_,o.CryptoKey=_o)}}}})});var Jw=qa("match"),Lj=function(s){var o;return ha(s)&&((o=s[Jw])!==void 0?!!o:Zb(s)=="RegExp")},Kw=[].push,Lw=Math.min;dh("split",2,function(s,o,l){var p="abbc".split(/(b)*/)[1]=="c"||"test".split(/(?:)/,-1).length!=4||"ab".split(/(?:ab)*/).length!=2||".".split(/(.?)(.?)/).length!=4||1<".".split(/()()/).length||"".split(/.?/).length?function(_,A){var k=String(jb(this));if((A=A===void 0?4294967295:A>>>0)===0)return[];if(_===void 0)return[k];if(!Lj(_))return o.call(k,_,A);var j,B,z,Vt=[],_e=0;for(_=new RegExp(_.source,(_.ignoreCase?"i":"")+(_.multiline?"m":"")+(_.unicode?"u":"")+(_.sticky?"y":"")+"g");(j=Of.call(_,k))&&!((B=_.lastIndex)>_e&&(Vt.push(k.slice(_e,j.index)),1<j.length&&j.index<k.length&&Kw.apply(Vt,j.slice(1)),z=j[0].length,_e=B,Vt.length>=A));)_.lastIndex===j.index&&_.lastIndex++;return _e===k.length?(z||!_.test(""))&&Vt.push(""):Vt.push(k.slice(_e)),Vt.length>A?Vt.slice(0,A):Vt}:"0".split(void 0,0).length?function(_,A){return _===void 0&&A===0?[]:o.call(this,_,A)}:o;return[function(_,A){var k=jb(this),j=_==null?void 0:_[s];return j!==void 0?j.call(_,k,A):p.call(String(k),_,A)},function(_,A){var k=l(p,_,this,A,p!==o);if(k.done)return k.value;var j=va(_);_=String(this);var B=kd(j,RegExp);if(k=j.unicode,j=new B(pc?"^(?:"+j.source+")":j,(j.ignoreCase?"i":"")+(j.multiline?"m":"")+(j.unicode?"u":"")+(pc?"g":"y")),(A=A===void 0?4294967295:A>>>0)===0)return[];if(_.length===0)return Ke(j,_)===null?[_]:[];var z=0,Vt=0;for(B=[];Vt<_.length;){j.lastIndex=pc?0:Vt;var _e,_n=Ke(j,pc?_.slice(Vt):_);if(_n===null||(_e=Lw(ta(j.lastIndex+(pc?Vt:0)),_.length))===z)Vt=xj(_,Vt,k);else{if(B.push(_.slice(z,Vt)),B.length===A)return B;for(z=1;z<=_n.length-1;z++)if(B.push(_n[z]),B.length===A)return B;Vt=z=_e}}return B.push(_.slice(z)),B}]},pc),function(s){s.console||(s.console={}),s=s.console;for(var o,l=function(){},p=["memory"],_="assert clear count debug dir dirxml error exception group groupCollapsed groupEnd info log markTimeline profile profiles profileEnd show table time timeEnd timeline timelineEnd timeStamp trace warn".split(" ");o=p.pop();)s[o]||(s[o]={});for(;o=_.pop();)s[o]||(s[o]=l)}(typeof window>"u"?Ya:window),N({target:"Object",stat:!0},{setPrototypeOf:Ua});var Mw=R(function(){Vb(1)});N({target:"Object",stat:!0,forced:Mw,sham:!Hn},{getPrototypeOf:function(s){return Vb(Qa(s))}});var ep=[].slice,Mj={},Nw=Function.bind||function(s){var o=yb(this),l=ep.call(arguments,1),p=function(){var _=l.concat(ep.call(arguments));if(this instanceof p){var A=_.length;if(!(A in Mj)){for(var k=[],j=0;j<A;j++)k[j]="a["+j+"]";Mj[A]=Function("C,a","return new C("+k.join(",")+")")}_=Mj[A](o,_)}else _=o.apply(s,_);return _};return ha(o.prototype)&&(p.prototype=o.prototype),p},Nj=mc("Reflect","construct"),fp=R(function(){function s(){}return!(Nj(function(){},[],s)instanceof s)}),gp=!R(function(){Nj(function(){})}),hp=fp||gp;N({target:"Reflect",stat:!0,forced:hp,sham:hp},{construct:function(s,o){yb(s),va(o);var l=3>arguments.length?s:yb(arguments[2]);if(gp&&!fp)return Nj(s,o,l);if(s==l){switch(o.length){case 0:return new s;case 1:return new s(o[0]);case 2:return new s(o[0],o[1]);case 3:return new s(o[0],o[1],o[2]);case 4:return new s(o[0],o[1],o[2],o[3])}return(l=[null]).push.apply(l,o),new(Nw.apply(s,l))}l=l.prototype,l=ac(ha(l)?l:Object.prototype);var p=Function.apply.call(s,l,o);return ha(p)?p:l}}),N({target:"Reflect",stat:!0},{get:wl});var ip=Fb.f,Ow=R(function(){ip(1)});N({target:"Object",stat:!0,forced:!ka||Ow,sham:!ka},{getOwnPropertyDescriptor:function(s,o){return ip(qb(s),o)}});var jp=Hd.f,Pw={}.toString,kp=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],Oj=function(s){if(kp&&Pw.call(s)=="[object Window]")try{var o=jp(s)}catch{o=kp.slice()}else o=jp(qb(s));return o},lp={f:qa},Qw=Ra.f,ph=function(s){var o=y.Symbol||(y.Symbol={});Q(o,s)||Qw(o,s,{value:lp.f(s)})},rb=Pg("hidden"),mp=qa("toPrimitive"),Rw=Za.set,np=Za.getterFor("Symbol"),Ob=Object.prototype,sb=y.Symbol,Tf=mc("JSON","stringify"),op=Fb.f,od=Ra.f,pp=Oj,Sw=zf,Lc=fd("symbols"),Uf=fd("op-symbols"),Pj=fd("string-to-symbol-registry"),Qj=fd("symbol-to-string-registry"),Tw=fd("wks"),Rj=y.QObject,Sj=!Rj||!Rj.prototype||!Rj.prototype.findChild,Tj=ka&&R(function(){return ac(od({},"a",{get:function(){return od(this,"a",{value:7}).a}})).a!=7})?function(s,o,l){var p=op(Ob,o);p&&delete Ob[o],od(s,o,l),p&&s!==Ob&&od(Ob,o,p)}:od,Uj=function(s,o){var l=Lc[s]=ac(sb.prototype);return Rw(l,{type:"Symbol",tag:s,description:o}),ka||(l.description=o),l},Vj=vn?function(s){return typeof s=="symbol"}:function(s){return Object(s)instanceof sb},qh=function(s,o,l){return s===Ob&&qh(Uf,o,l),va(s),o=lc(o,!0),va(l),Q(Lc,o)?(l.enumerable?(Q(s,rb)&&s[rb][o]&&(s[rb][o]=!1),l=ac(l,{enumerable:dd(0,!1)})):(Q(s,rb)||od(s,rb,dd(1,{})),s[rb][o]=!0),Tj(s,o,l)):od(s,o,l)},qp=function(s,o){va(s);var l=qb(o);return o=Dc(l).concat(Wj(l)),Jd(o,function(p){ka&&!Xj.call(l,p)||qh(s,p,l[p])}),s},Xj=function(s){s=lc(s,!0);var o=Sw.call(this,s);return!(this===Ob&&Q(Lc,s)&&!Q(Uf,s))&&(!(o||!Q(this,s)||!Q(Lc,s)||Q(this,rb)&&this[rb][s])||o)},rp=function(s,o){if(s=qb(s),o=lc(o,!0),s!==Ob||!Q(Lc,o)||Q(Uf,o)){var l=op(s,o);return!l||!Q(Lc,o)||Q(s,rb)&&s[rb][o]||(l.enumerable=!0),l}},sp=function(s){s=pp(qb(s));var o=[];return Jd(s,function(l){Q(Lc,l)||Q(Be,l)||o.push(l)}),o},Wj=function(s){var o=s===Ob;s=pp(o?Uf:qb(s));var l=[];return Jd(s,function(p){!Q(Lc,p)||o&&!Q(Ob,p)||l.push(Lc[p])}),l};if(oc||(sb=function(){if(this instanceof sb)throw TypeError("Symbol is not a constructor");var s=arguments.length&&arguments[0]!==void 0?String(arguments[0]):void 0,o=Ae(s),l=function(p){this===Ob&&l.call(Uf,p),Q(this,rb)&&Q(this[rb],o)&&(this[rb][o]=!1),Tj(this,o,dd(1,p))};return ka&&Sj&&Tj(Ob,o,{configurable:!0,set:l}),Uj(o,s)},Ta(sb.prototype,"toString",function(){return np(this).tag}),Ta(sb,"withoutSetter",function(s){return Uj(Ae(s),s)}),zf=Xj,Ra.f=qh,Fb.f=rp,Hd.f=Oj=sp,Bf.f=Wj,lp.f=function(s){return Uj(qa(s),s)},ka&&(od(sb.prototype,"description",{configurable:!0,get:function(){return np(this).description}}),Ta(Ob,"propertyIsEnumerable",Xj,{unsafe:!0}))),N({global:!0,wrap:!0,forced:!oc,sham:!oc},{Symbol:sb}),Jd(Dc(Tw),function(s){ph(s)}),N({target:"Symbol",stat:!0,forced:!oc},{for:function(s){if(s=String(s),Q(Pj,s))return Pj[s];var o=sb(s);return Pj[s]=o,Qj[o]=s,o},keyFor:function(s){if(!Vj(s))throw TypeError(s+" is not a symbol");if(Q(Qj,s))return Qj[s]},useSetter:function(){Sj=!0},useSimple:function(){Sj=!1}}),N({target:"Object",stat:!0,forced:!oc,sham:!ka},{create:function(s,o){return o===void 0?ac(s):qp(ac(s),o)},defineProperty:qh,defineProperties:qp,getOwnPropertyDescriptor:rp}),N({target:"Object",stat:!0,forced:!oc},{getOwnPropertyNames:sp,getOwnPropertySymbols:Wj}),N({target:"Object",stat:!0,forced:R(function(){Bf.f(1)})},{getOwnPropertySymbols:function(s){return Bf.f(Qa(s))}}),Tf){var Uw=!oc||R(function(){var s=sb();return Tf([s])!="[null]"||Tf({a:s})!="{}"||Tf(Object(s))!="{}"});N({target:"JSON",stat:!0,forced:Uw},{stringify:function(s,o,l){for(var p,_=[s],A=1;arguments.length>A;)_.push(arguments[A++]);if(p=o,(ha(o)||s!==void 0)&&!Vj(s))return gd(o)||(o=function(k,j){if(typeof p=="function"&&(j=p.call(this,k,j)),!Vj(j))return j}),_[1]=o,Tf.apply(null,_)}})}sb.prototype[mp]||Na(sb.prototype,mp,sb.prototype.valueOf),Ec(sb,"Symbol"),Be[rb]=!0;var Vw=Ra.f,Mc=y.Symbol;if(ka&&typeof Mc=="function"&&(!("description"in Mc.prototype)||Mc().description!==void 0)){var tp={},Vf=function(){var s=1>arguments.length||arguments[0]===void 0?void 0:String(arguments[0]),o=this instanceof Vf?new Mc(s):s===void 0?Mc():Mc(s);return s===""&&(tp[o]=!0),o};rn(Vf,Mc);var Yj=Vf.prototype=Mc.prototype;Yj.constructor=Vf;var Ww=Yj.toString,Xw=String(Mc("test"))=="Symbol(test)",Yw=/^Symbol\((.*)\)[^)]+$/;Vw(Yj,"description",{configurable:!0,get:function(){var s=ha(this)?this.valueOf():this,o=Ww.call(s);return Q(tp,s)?"":(s=Xw?o.slice(7,-1):o.replace(Yw,"$1"))===""?void 0:s}}),N({global:!0,forced:!0},{Symbol:Vf})}ph("toStringTag"),Ec(y.JSON,"JSON",!0),Ec(Math,"Math",!0),function(){function s(_n,_o){if(!(_n instanceof _o))throw new TypeError("Cannot call a class as a function")}function o(_n,_o){for(var _c=0;_c<_o.length;_c++){var _d=_o[_c];_d.enumerable=_d.enumerable||!1,_d.configurable=!0,"value"in _d&&(_d.writable=!0),Object.defineProperty(_n,_d.key,_d)}}function l(_n,_o,_c){return _o&&o(_n.prototype,_o),_n}function p(_n,_o){if(typeof _o!="function"&&_o!==null)throw new TypeError("Super expression must either be null or a function");_n.prototype=Object.create(_o&&_o.prototype,{constructor:{value:_n,writable:!0,configurable:!0}}),_o&&A(_n,_o)}function _(_n){return(_=Object.setPrototypeOf?Object.getPrototypeOf:function(_o){return _o.__proto__||Object.getPrototypeOf(_o)})(_n)}function A(_n,_o){return(A=Object.setPrototypeOf||function(_c,_d){return _c.__proto__=_d,_c})(_n,_o)}function k(_n){if(_n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _n}function j(_n){var _o=function(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}();return function(){var _c=_(_n);if(_o){var _d=_(this).constructor;_c=Reflect.construct(_c,arguments,_d)}else _c=_c.apply(this,arguments);return _c=!_c||X(_c)!=="object"&&typeof _c!="function"?k(this):_c}}function B(_n,_o,_c){return(B=typeof Reflect<"u"&&Reflect.get?Reflect.get:function(_d,_h,_p){for(;!Object.prototype.hasOwnProperty.call(_d,_h)&&(_d=_(_d))!==null;);if(_d)return(_h=Object.getOwnPropertyDescriptor(_d,_h)).get?_h.get.call(_p):_h.value})(_n,_o,_c||_n)}var z=function(){function _n(){s(this,_n),Object.defineProperty(this,"listeners",{value:{},writable:!0,configurable:!0})}return l(_n,[{key:"addEventListener",value:function(_o,_c,_d){_o in this.listeners||(this.listeners[_o]=[]),this.listeners[_o].push({callback:_c,options:_d})}},{key:"removeEventListener",value:function(_o,_c){if(_o in this.listeners){for(var _d=0,_h=(_o=this.listeners[_o]).length;_d<_h;_d++)if(_o[_d].callback===_c){_o.splice(_d,1);break}}}},{key:"dispatchEvent",value:function(_o){if(_o.type in this.listeners){for(var _c=this.listeners[_o.type].slice(),_d=0,_h=_c.length;_d<_h;_d++){var _p=_c[_d];try{_p.callback.call(this,_o)}catch(_f){Promise.resolve().then(function(){throw _f})}_p.options&&_p.options.once&&this.removeEventListener(_o.type,_p.callback)}return!_o.defaultPrevented}}}]),_n}(),Vt=function(_n){function _o(){s(this,_o);var _d=_c.call(this);return _d.listeners||z.call(k(_d)),Object.defineProperty(k(_d),"aborted",{value:!1,writable:!0,configurable:!0}),Object.defineProperty(k(_d),"onabort",{value:null,writable:!0,configurable:!0}),_d}p(_o,_n);var _c=j(_o);return l(_o,[{key:"toString",value:function(){return"[object AbortSignal]"}},{key:"dispatchEvent",value:function(_d){_d.type==="abort"&&(this.aborted=!0,typeof this.onabort=="function"&&this.onabort.call(this,_d)),B(_(_o.prototype),"dispatchEvent",this).call(this,_d)}}]),_o}(z),_e=function(){function _n(){s(this,_n),Object.defineProperty(this,"signal",{value:new Vt,writable:!0,configurable:!0})}return l(_n,[{key:"abort",value:function(){try{var _o=new Event("abort")}catch{typeof document<"u"?document.createEvent?(_o=document.createEvent("Event")).initEvent("abort",!1,!1):(_o=document.createEventObject()).type="abort":_o={type:"abort",bubbles:!1,cancelable:!1}}this.signal.dispatchEvent(_o)}},{key:"toString",value:function(){return"[object AbortController]"}}]),_n}();typeof Symbol<"u"&&Symbol.toStringTag&&(_e.prototype[Symbol.toStringTag]="AbortController",Vt.prototype[Symbol.toStringTag]="AbortSignal"),function(_n){if(_n.__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL){console.log("__FORCE_INSTALL_ABORTCONTROLLER_POLYFILL=true is set, will force install polyfill");var _o=!0}else _o=typeof _n.Request=="function"&&!_n.Request.prototype.hasOwnProperty("signal")||!_n.AbortController;_o&&(_n.AbortController=_e,_n.AbortSignal=Vt)}(typeof self<"u"?self:Ya)}();var Zw=Math.floor,$w=Math.log,ax=Math.LOG2E;N({target:"Math",stat:!0},{clz32:function(s){return(s>>>=0)?31-Zw($w(s+.5)*ax):32}});var bx=Math.log,cx=Math.LN2,ss=Math.clz32||function(s){return 31-bx(s>>>0)/cx|0},xd=String.fromCharCode,up={}.toString,Zj=window.Uint8Array,ak=Zj||Array,dx=up.call((window.ArrayBuffer||ak).prototype),bk;xl.prototype.decode=function(s){if(s=s&&s.buffer||s,up.call(s)!==dx)throw Error("Failed to execute 'decode' on 'TextDecoder': The provided value is not of type '(ArrayBuffer or ArrayBufferView)'");for(var o="",l=0,p=0|(s=Zj?new ak(s):s).length;l<p;l=l+32768|0)o+=xd.apply(0,s[Zj?"slice":"subarray"](l,l+32768|0));return o.replace(/[\xc0-\xff][\x80-\xbf]*/g,rs)},window.TextDecoder||(window.TextDecoder=xl),yl.prototype.encode=function(s){for(var o=0|(s=s===void 0?"":(""+s).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ts)).length,l=new ak(o),p=0;p<o;p=p+1|0)l[p]=s.charCodeAt(p);return l},window.TextEncoder||(window.TextEncoder=yl),function(s){var o,l,p,_,A,k,j,B,z,Vt,_e;(function(_n){_n.LOGIN="LOGIN",_n.LOGIN_SUCCESS="LOGIN_SUCCESS",_n.LOGIN_FAILURE="LOGIN_FAILURE",_n.LOGIN_TIMEOUT="LOGIN_TIMEOUT",_n.INTERRUPTED="INTERRUPTED",_n.LOGOUT="LOGOUT",_n.BANNED_BY_SERVER="BANNED_BY_SERVER",_n.REMOTE_LOGIN="REMOTE_LOGIN"})(o||(o={})),s.ConnectionChangeReason=o,function(_n){_n.DISCONNECTED="DISCONNECTED",_n.CONNECTING="CONNECTING",_n.CONNECTED="CONNECTED",_n.RECONNECTING="RECONNECTING",_n.ABORTED="ABORTED"}(l||(l={})),s.ConnectionState=l,function(_n){_n.IDLE="IDLE",_n.SENT_TO_REMOTE="SENT_TO_REMOTE",_n.RECEIVED_BY_REMOTE="RECEIVED_BY_REMOTE",_n.ACCEPTED_BY_REMOTE="ACCEPTED_BY_REMOTE",_n.REFUSED_BY_REMOTE="REFUSED_BY_REMOTE",_n.CANCELED="CANCELED",_n.FAILURE="FAILURE"}(p||(p={})),s.LocalInvitationState=p,function(_n){_n.INVITATION_RECEIVED="INVITATION_RECEIVED",_n.ACCEPT_SENT_TO_LOCAL="ACCEPT_SENT_TO_LOCAL",_n.REFUSED="REFUSED",_n.ACCEPTED="ACCEPTED",_n.CANCELED="CANCELED",_n.FAILURE="FAILURE"}(_||(_={})),s.RemoteInvitationState=_,function(_n){_n.UNKNOWN="UNKNOWN",_n.PEER_NO_RESPONSE="PEER_NO_RESPONSE",_n.INVITATION_EXPIRE="INVITATION_EXPIRE",_n.PEER_OFFLINE="PEER_OFFLINE",_n.NOT_LOGGEDIN="NOT_LOGGEDIN"}(A||(A={})),s.LocalInvitationFailureReason=A,function(_n){_n.UNKNOWN="UNKNOWN",_n.PEER_OFFLINE="PEER_OFFLINE",_n.ACCEPT_FAILURE="ACCEPT_FAILURE",_n.INVITATION_EXPIRE="INVITATION_EXPIRE"}(k||(k={})),s.RemoteInvitationFailureReason=k,function(_n){_n.ONLINE="ONLINE",_n.UNREACHABLE="UNREACHABLE",_n.OFFLINE="OFFLINE"}(j||(j={})),s.PeerOnlineState=j,(B||(B={})).ONLINE_STATUS="ONLINE_STATUS",s.PeerSubscriptionOption=B,function(_n){_n.TEXT="TEXT",_n.RAW="RAW",_n.IMAGE="IMAGE",_n.FILE="FILE"}(z||(z={})),s.MessageType=z,function(_n){_n.CN="CN",_n.NA="NA",_n.EU="EU",_n.AS="AS",_n.JP="JP",_n.IN="IN",_n.GLOB="GLOB",_n.OC="OC",_n.SA="SA",_n.AF="AF",_n.OVS="OVS"}(Vt||(Vt={})),s.LegacyAreaCode=Vt,function(_n){_n.GLOBAL="GLOBAL",_n.INDIA="INDIA",_n.JAPAN="JAPAN",_n.ASIA="ASIA",_n.EUROPE="EUROPE",_n.CHINA="CHINA",_n.NORTH_AMERICA="NORTH_AMERICA"}(_e||(_e={})),s.AreaCode=_e}(bk||(bk={}));var S=bk;N({target:"Array",proto:!0},{includes:function(s){return on(this,s,1<arguments.length?arguments[1]:void 0)}}),Ld("includes");var ck=function(s){if(Lj(s))throw TypeError("The method doesn't accept regular expressions");return s},ex=qa("match"),dk=function(s){var o=/./;try{"/./"[s](o)}catch{try{return o[ex]=!1,"/./"[s](o)}catch{}}return!1};N({target:"String",proto:!0,forced:!dk("includes")},{includes:function(s){return!!~String(jb(this)).indexOf(ck(s),1<arguments.length?arguments[1]:void 0)}});var Nc={RECONNECTING_AP_INTERVAL:2500,RECONNECTING_AP_NUM:2,DISABLE_MESSAGE_COMPRESSION:!1,LOG_UPLOAD_INTERVAL:3e3,LOG_HANDLER:void 0};ph("iterator"),ph("asyncIterator");var ek=Ee("forEach")?[].forEach:function(s){return Jd(this,s,1<arguments.length?arguments[1]:void 0)},vp;for(vp in Ij){var wp=y[vp],rh=wp&&wp.prototype;if(rh&&rh.forEach!==ek)try{Na(rh,"forEach",ek)}catch{rh.forEach=ek}}var fx=[].reverse,xp=[1,2];N({target:"Array",proto:!0,forced:String(xp)===String(xp.reverse())},{reverse:function(){return gd(this)&&(this.length=this.length),fx.call(this)}});var w=$a(function(s){s=function(o){function l(vf,o_,d_){return Object.defineProperty(vf,o_,{value:d_,enumerable:!0,configurable:!0,writable:!0}),vf[o_]}function p(vf,o_,d_,g_){return o_=Object.create((o_&&o_.prototype instanceof A?o_:A).prototype),g_=new _o(g_||[]),o_._invoke=function(v_,M_,R_){var X_=y_;return function(q_,lE){if(X_===NE)throw Error("Generator is already running");if(X_===i_){if(q_==="throw")throw lE;return _d()}for(R_.method=q_,R_.arg=lE;;){if((q_=R_.delegate)&&(q_=Vt(q_,R_))){if(q_===S_)continue;return q_}if(R_.method==="next")R_.sent=R_._sent=R_.arg;else if(R_.method==="throw"){if(X_===y_)throw X_=i_,R_.arg;R_.dispatchException(R_.arg)}else R_.method==="return"&&R_.abrupt("return",R_.arg);if(X_=NE,(q_=_(v_,M_,R_)).type==="normal"){if(X_=R_.done?i_:Z_,q_.arg===S_)continue;return{value:q_.arg,done:R_.done}}q_.type==="throw"&&(X_=i_,R_.method="throw",R_.arg=q_.arg)}}}(vf,d_,g_),o_}function _(vf,o_,d_){try{return{type:"normal",arg:vf.call(o_,d_)}}catch(g_){return{type:"throw",arg:g_}}}function A(){}function k(){}function j(){}function B(vf){["next","throw","return"].forEach(function(o_){l(vf,o_,function(d_){return this._invoke(o_,d_)})})}function z(vf,o_){function d_(v_,M_,R_,X_){if((v_=_(vf[v_],vf,M_)).type!=="throw"){var q_=v_.arg;return(v_=q_.value)&&X(v_)==="object"&&_f.call(v_,"__await")?o_.resolve(v_.__await).then(function(lE){d_("next",lE,R_,X_)},function(lE){d_("throw",lE,R_,X_)}):o_.resolve(v_).then(function(lE){q_.value=lE,R_(q_)},function(lE){return d_("throw",lE,R_,X_)})}X_(v_.arg)}var g_;this._invoke=function(v_,M_){function R_(){return new o_(function(X_,q_){d_(v_,M_,X_,q_)})}return g_=g_?g_.then(R_,R_):R_()}}function Vt(vf,o_){var d_=vf.iterator[o_.method];if(d_===_h){if(o_.delegate=null,o_.method==="throw"){if(vf.iterator.return&&(o_.method="return",o_.arg=_h,Vt(vf,o_),o_.method==="throw"))return S_;o_.method="throw",o_.arg=new TypeError("The iterator does not provide a 'throw' method")}return S_}return(d_=_(d_,vf.iterator,o_.arg)).type==="throw"?(o_.method="throw",o_.arg=d_.arg,o_.delegate=null,S_):(d_=d_.arg)?d_.done?(o_[vf.resultName]=d_.value,o_.next=vf.nextLoc,o_.method!=="return"&&(o_.method="next",o_.arg=_h),o_.delegate=null,S_):d_:(o_.method="throw",o_.arg=new TypeError("iterator result is not an object"),o_.delegate=null,S_)}function _e(vf){var o_={tryLoc:vf[0]};1 in vf&&(o_.catchLoc=vf[1]),2 in vf&&(o_.finallyLoc=vf[2],o_.afterLoc=vf[3]),this.tryEntries.push(o_)}function _n(vf){var o_=vf.completion||{};o_.type="normal",delete o_.arg,vf.completion=o_}function _o(vf){this.tryEntries=[{tryLoc:"root"}],vf.forEach(_e,this),this.reset(!0)}function _c(vf){if(vf){var o_=vf[u_];if(o_)return o_.call(vf);if(typeof vf.next=="function")return vf;if(!isNaN(vf.length)){var d_=-1;return(o_=function g_(){for(;++d_<vf.length;)if(_f.call(vf,d_))return g_.value=vf[d_],g_.done=!1,g_;return g_.value=_h,g_.done=!0,g_}).next=o_}}return{next:_d}}function _d(){return{value:_h,done:!0}}var _h,_p=Object.prototype,_f=_p.hasOwnProperty,e_=typeof Symbol=="function"?Symbol:{},u_=e_.iterator||"@@iterator",w_=e_.asyncIterator||"@@asyncIterator",O_=e_.toStringTag||"@@toStringTag";try{l({},"")}catch{l=function(o_,d_,g_){return o_[d_]=g_}}o.wrap=p;var y_="suspendedStart",Z_="suspendedYield",NE="executing",i_="completed",S_={};l(e_={},u_,function(){return this});var h_=Object.getPrototypeOf;(h_=h_&&h_(h_(_c([]))))&&h_!==_p&&_f.call(h_,u_)&&(e_=h_);var I_=j.prototype=A.prototype=Object.create(e_);return k.prototype=j,l(I_,"constructor",j),l(j,"constructor",k),k.displayName=l(j,O_,"GeneratorFunction"),o.isGeneratorFunction=function(vf){return!!(vf=typeof vf=="function"&&vf.constructor)&&(vf===k||(vf.displayName||vf.name)==="GeneratorFunction")},o.mark=function(vf){return Object.setPrototypeOf?Object.setPrototypeOf(vf,j):(vf.__proto__=j,l(vf,O_,"GeneratorFunction")),vf.prototype=Object.create(I_),vf},o.awrap=function(vf){return{__await:vf}},B(z.prototype),l(z.prototype,w_,function(){return this}),o.AsyncIterator=z,o.async=function(vf,o_,d_,g_,v_){v_===void 0&&(v_=Promise);var M_=new z(p(vf,o_,d_,g_),v_);return o.isGeneratorFunction(o_)?M_:M_.next().then(function(R_){return R_.done?R_.value:M_.next()})},B(I_),l(I_,O_,"Generator"),l(I_,u_,function(){return this}),l(I_,"toString",function(){return"[object Generator]"}),o.keys=function(vf){var o_,d_=[];for(o_ in vf)d_.push(o_);return d_.reverse(),function g_(){for(;d_.length;){var v_=d_.pop();if(v_ in vf)return g_.value=v_,g_.done=!1,g_}return g_.done=!0,g_}},o.values=_c,_o.prototype={constructor:_o,reset:function(vf){if(this.next=this.prev=0,this.sent=this._sent=_h,this.done=!1,this.delegate=null,this.method="next",this.arg=_h,this.tryEntries.forEach(_n),!vf)for(var o_ in this)o_.charAt(0)==="t"&&_f.call(this,o_)&&!isNaN(+o_.slice(1))&&(this[o_]=_h)},stop:function(){this.done=!0;var vf=this.tryEntries[0].completion;if(vf.type==="throw")throw vf.arg;return this.rval},dispatchException:function(vf){function o_(q_,lE){return M_.type="throw",M_.arg=vf,d_.next=q_,lE&&(d_.method="next",d_.arg=_h),!!lE}if(this.done)throw vf;for(var d_=this,g_=this.tryEntries.length-1;0<=g_;--g_){var v_=this.tryEntries[g_],M_=v_.completion;if(v_.tryLoc==="root")return o_("end");if(v_.tryLoc<=this.prev){var R_=_f.call(v_,"catchLoc"),X_=_f.call(v_,"finallyLoc");if(R_&&X_){if(this.prev<v_.catchLoc)return o_(v_.catchLoc,!0);if(this.prev<v_.finallyLoc)return o_(v_.finallyLoc)}else if(R_){if(this.prev<v_.catchLoc)return o_(v_.catchLoc,!0)}else{if(!X_)throw Error("try statement without catch or finally");if(this.prev<v_.finallyLoc)return o_(v_.finallyLoc)}}}},abrupt:function(vf,o_){for(var d_=this.tryEntries.length-1;0<=d_;--d_){var g_=this.tryEntries[d_];if(g_.tryLoc<=this.prev&&_f.call(g_,"finallyLoc")&&this.prev<g_.finallyLoc){var v_=g_;break}}return v_&&(vf==="break"||vf==="continue")&&v_.tryLoc<=o_&&o_<=v_.finallyLoc&&(v_=null),(d_=v_?v_.completion:{}).type=vf,d_.arg=o_,v_?(this.method="next",this.next=v_.finallyLoc,S_):this.complete(d_)},complete:function(vf,o_){if(vf.type==="throw")throw vf.arg;return vf.type==="break"||vf.type==="continue"?this.next=vf.arg:vf.type==="return"?(this.rval=this.arg=vf.arg,this.method="return",this.next="end"):vf.type==="normal"&&o_&&(this.next=o_),S_},finish:function(vf){for(var o_=this.tryEntries.length-1;0<=o_;--o_){var d_=this.tryEntries[o_];if(d_.finallyLoc===vf)return this.complete(d_.completion,d_.afterLoc),_n(d_),S_}},catch:function(vf){for(var o_=this.tryEntries.length-1;0<=o_;--o_){var d_=this.tryEntries[o_];if(d_.tryLoc===vf){if((vf=d_.completion).type==="throw"){var g_=vf.arg;_n(d_)}return g_}}throw Error("illegal catch attempt")},delegateYield:function(vf,o_,d_){return this.delegate={iterator:_c(vf),resultName:o_,nextLoc:d_},this.method==="next"&&(this.arg=_h),S_}},o}(s.exports);try{regeneratorRuntime=s}catch{(typeof globalThis>"u"?"undefined":X(globalThis))==="object"?globalThis.regeneratorRuntime=s:Function("r","regeneratorRuntime = r")(s)}}),yp=!R(function(){return Object.isExtensible(Object.preventExtensions({}))}),fk=$a(function(s){var o=Ra.f,l=Ae("meta"),p=0,_=Object.isExtensible||function(){return!0},A=function(j){o(j,l,{value:{objectID:"O"+ ++p,weakData:{}}})},k=s.exports={REQUIRED:!1,fastKey:function(j,B){if(!ha(j))return typeof j=="symbol"?j:(typeof j=="string"?"S":"P")+j;if(!Q(j,l)){if(!_(j))return"F";if(!B)return"E";A(j)}return j[l].objectID},getWeakData:function(j,B){if(!Q(j,l)){if(!_(j))return!0;if(!B)return!1;A(j)}return j[l].weakData},onFreeze:function(j){return yp&&k.REQUIRED&&_(j)&&!Q(j,l)&&A(j),j}};Be[l]=!0}),zp=function(s,o,l){var p=s.indexOf("Map")!==-1,_=s.indexOf("Weak")!==-1,A=p?"set":"add",k=y[s],j=k&&k.prototype,B=k,z={},Vt=function(_h){var _p=j[_h];Ta(j,_h,_h=="add"?function(_f){return _p.call(this,_f===0?0:_f),this}:_h=="delete"?function(_f){return!(_&&!ha(_f))&&_p.call(this,_f===0?0:_f)}:_h=="get"?function(_f){return _&&!ha(_f)?void 0:_p.call(this,_f===0?0:_f)}:_h=="has"?function(_f){return!(_&&!ha(_f))&&_p.call(this,_f===0?0:_f)}:function(_f,e_){return _p.call(this,_f===0?0:_f,e_),this})};if(nc(s,typeof k!="function"||!(_||j.forEach&&!R(function(){new k().entries().next()}))))B=l.getConstructor(o,s,p,A),fk.REQUIRED=!0;else if(nc(s,!0)){var _e=new B,_n=_e[A](_?{}:-0,1)!=_e,_o=R(function(){_e.has(1)}),_c=Tg(function(_h){new k(_h)}),_d=!_&&R(function(){for(var _h=new k,_p=5;_p--;)_h[A](_p,_p);return!_h.has(-0)});_c||((B=o(function(_h,_p){return Gc(_h,B,s),_h=lh(new k,_h,B),_p!=null&&Xg(_p,_h[A],{that:_h,AS_ENTRIES:p}),_h})).prototype=j,j.constructor=B),(_o||_d)&&(Vt("delete"),Vt("has"),p&&Vt("get")),(_d||_n)&&Vt(A),_&&j.clear&&delete j.clear}return z[s]=B,N({global:!0,forced:B!=k},z),Ec(B,s),_||l.setStrong(B,s,p),B},gx=Ra.f,Ap=fk.fastKey,Bp=Za.set,gk=Za.getterFor,Cp={getConstructor:function(s,o,l,p){var _=s(function(B,z){Gc(B,_,o),Bp(B,{type:o,index:ac(null),first:void 0,last:void 0,size:0}),ka||(B.size=0),z!=null&&Xg(z,B[p],{that:B,AS_ENTRIES:l})}),A=gk(o),k=function(B,z,Vt){var _e,_n=A(B),_o=j(B,z);return _o?_o.value=Vt:(_n.last=_o={index:_e=Ap(z,!0),key:z,value:Vt,previous:z=_n.last,next:void 0,removed:!1},_n.first||(_n.first=_o),z&&(z.next=_o),ka?_n.size++:B.size++,_e!=="F"&&(_n.index[_e]=_o)),B},j=function(B,z){B=A(B);var Vt=Ap(z);if(Vt!=="F")return B.index[Vt];for(B=B.first;B;B=B.next)if(B.key==z)return B};return Hf(_.prototype,{clear:function(){for(var B=A(this),z=B.index,Vt=B.first;Vt;)Vt.removed=!0,Vt.previous&&(Vt.previous=Vt.previous.next=void 0),delete z[Vt.index],Vt=Vt.next;B.first=B.last=void 0,ka?B.size=0:this.size=0},delete:function(B){var z=A(this);if(B=j(this,B)){var Vt=B.next,_e=B.previous;delete z.index[B.index],B.removed=!0,_e&&(_e.next=Vt),Vt&&(Vt.previous=_e),z.first==B&&(z.first=Vt),z.last==B&&(z.last=_e),ka?z.size--:this.size--}return!!B},forEach:function(B){for(var z,Vt=A(this),_e=Id(B,1<arguments.length?arguments[1]:void 0,3);z=z?z.next:Vt.first;)for(_e(z.value,z.key,this);z&&z.removed;)z=z.previous},has:function(B){return!!j(this,B)}}),Hf(_.prototype,l?{get:function(B){return(B=j(this,B))&&B.value},set:function(B,z){return k(this,B===0?0:B,z)}}:{add:function(B){return k(this,B=B===0?0:B,B)}}),ka&&gx(_.prototype,"size",{get:function(){return A(this).size}}),_},setStrong:function(s,o,l){var p=o+" Iterator",_=gk(o),A=gk(p);bj(s,o,function(k,j){Bp(this,{type:p,target:k,state:_(k),kind:j,last:void 0})},function(){for(var k=A(this),j=k.kind,B=k.last;B&&B.removed;)B=B.previous;return k.target&&(k.last=B=B?B.next:k.state.first)?j=="keys"?{value:B.key,done:!1}:j=="values"?{value:B.value,done:!1}:{value:[B.key,B.value],done:!1}:(k.target=void 0,{value:void 0,done:!0})},l?"entries":"values",!l,!0),If(o)}};zp("Set",function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}},Cp);var hx=/^[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*/,ix=/[\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff][\t\n\x0B\f\r \u00a0\u1680\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029\ufeff]*$/,hk=function(s){return function(o){return o=String(jb(o)),1&s&&(o=o.replace(hx,"")),2&s&&(o=o.replace(ix,"")),o}},ik=hk(3),sh=y.parseInt,jx=/^[+-]?0[Xx]/,Dp=sh(`	
\v\f\r                　\u2028\u2029\uFEFF08`)!==8||sh(`	
\v\f\r                　\u2028\u2029\uFEFF0x16`)!==22?function(s,o){return s=ik(String(s)),sh(s,o>>>0||(jx.test(s)?16:10))}:sh;N({global:!0,forced:parseInt!=Dp},{parseInt:Dp});var kx=Hd.f,lx=Fb.f,mx=Ra.f,pd=y.Number,th=pd.prototype,nx=Zb(ac(th))=="Number",Ep=function(s){var o,l=lc(s,!1);if(typeof l=="string"&&2<l.length){if((s=(l=ik(l)).charCodeAt(0))===43||s===45){if((s=l.charCodeAt(2))===88||s===120)return NaN}else if(s===48){switch(l.charCodeAt(1)){case 66:case 98:s=2;var p=49;break;case 79:case 111:s=8,p=55;break;default:return+l}var _=(l=l.slice(2)).length;for(o=0;o<_;o++){var A=l.charCodeAt(o);if(48>A||A>p)return NaN}return parseInt(l,s)}}return+l};if(nc("Number",!pd(" 0o1")||!pd("0b1")||pd("+0x1"))){for(var Pd=function(s){var o=1>arguments.length?0:s,l=this;return l instanceof Pd&&(nx?R(function(){th.valueOf.call(l)}):Zb(l)!="Number")?lh(new pd(Ep(o)),l,Pd):Ep(o)},Fp=ka?kx(pd):"MAX_VALUE MIN_VALUE NaN NEGATIVE_INFINITY POSITIVE_INFINITY EPSILON isFinite isInteger isNaN isSafeInteger MAX_SAFE_INTEGER MIN_SAFE_INTEGER parseFloat parseInt isInteger fromString range".split(" "),jk=0,uh;Fp.length>jk;jk++)Q(pd,uh=Fp[jk])&&!Q(Pd,uh)&&mx(Pd,uh,lx(pd,uh));Pd.prototype=th,th.constructor=Pd,Ta(y,"Number",Pd)}var Gp=qa("isConcatSpreadable"),ox=51<=id||!R(function(){var s=[];return s[Gp]=!1,s.concat()[0]!==s}),px=Ef("concat");N({target:"Array",proto:!0,forced:!ox||!px},{concat:function(s){var o,l=Qa(this),p=Sg(l,0),_=0,A=-1;for(o=arguments.length;A<o;A++){var k=A===-1?l:arguments[A],j=k;if(ha(j)){var B=j[Gp];j=B!==void 0?!!B:gd(j)}else j=!1;if(j){if(9007199254740991<_+(B=ta(k.length)))throw TypeError("Maximum allowed index exceeded");for(j=0;j<B;j++,_++)j in k&&Ge(p,_,k[j])}else{if(9007199254740991<=_)throw TypeError("Maximum allowed index exceeded");Ge(p,_++,k)}}return p.length=_,p}});var kk=mc("Reflect","apply"),qx=Function.apply,rx=!R(function(){kk(function(){})});N({target:"Reflect",stat:!0,forced:rx},{apply:function(s,o,l){return yb(s),va(l),kk?kk(s,o,l):qx.call(s,o,l)}}),N({target:"Reflect",stat:!0},{ownKeys:qn});var sx=Oj,tx=R(function(){return!Object.getOwnPropertyNames(1)});N({target:"Object",stat:!0,forced:tx},{getOwnPropertyNames:sx});var Pe=(typeof Reflect>"u"?"undefined":X(Reflect))==="object"?Reflect:null,Hp=Pe&&typeof Pe.apply=="function"?Pe.apply:function(s,o,l){return Function.prototype.apply.call(s,o,l)},ux=Pe&&typeof Pe.ownKeys=="function"?Pe.ownKeys:Object.getOwnPropertySymbols?function(s){return Object.getOwnPropertyNames(s).concat(Object.getOwnPropertySymbols(s))}:function(s){return Object.getOwnPropertyNames(s)},Ip=Number.isNaN||function(s){return s!=s};ea.EventEmitter=ea,ea.prototype._events=void 0,ea.prototype._eventsCount=0,ea.prototype._maxListeners=void 0;var Jp=10;Object.defineProperty(ea,"defaultMaxListeners",{enumerable:!0,get:function(){return Jp},set:function(s){if(typeof s!="number"||0>s||Ip(s))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+s+".");Jp=s}}),ea.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},ea.prototype.setMaxListeners=function(s){if(typeof s!="number"||0>s||Ip(s))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+s+".");return this._maxListeners=s,this},ea.prototype.getMaxListeners=function(){return this._maxListeners===void 0?ea.defaultMaxListeners:this._maxListeners},ea.prototype.emit=function(s){for(var o=[],l=1;l<arguments.length;l++)o.push(arguments[l]);l=s==="error";var p=this._events;if(p!==void 0)l=l&&p.error===void 0;else if(!l)return!1;if(l){var _;throw 0<o.length&&(_=o[0]),_ instanceof Error?_:((o=Error("Unhandled error."+(_?" ("+_.message+")":""))).context=_,o)}if((l=p[s])===void 0)return!1;if(typeof l=="function")Hp(l,this,o);else for(p=Cl(l,_=l.length),l=0;l<_;++l)Hp(p[l],this,o);return!0},ea.prototype.addListener=function(s,o){return zl(this,s,o,!1)},ea.prototype.on=ea.prototype.addListener,ea.prototype.prependListener=function(s,o){return zl(this,s,o,!0)},ea.prototype.once=function(s,o){return ng(o),this.on(s,Al(this,s,o)),this},ea.prototype.prependOnceListener=function(s,o){return ng(o),this.prependListener(s,Al(this,s,o)),this},ea.prototype.removeListener=function(s,o){var l;ng(o);var p=this._events;if(p===void 0)return this;var _=p[s];if(_===void 0)return this;if(_===o||_.listener===o)--this._eventsCount==0?this._events=Object.create(null):(delete p[s],p.removeListener&&this.emit("removeListener",s,_.listener||o));else if(typeof _!="function"){var A=-1;for(l=_.length-1;0<=l;l--)if(_[l]===o||_[l].listener===o){var k=_[l].listener;A=l;break}if(0>A)return this;if(A===0)_.shift();else{for(;A+1<_.length;A++)_[A]=_[A+1];_.pop()}_.length===1&&(p[s]=_[0]),p.removeListener!==void 0&&this.emit("removeListener",s,k||o)}return this},ea.prototype.off=ea.prototype.removeListener,ea.prototype.removeAllListeners=function(s){var o=this._events;if(o===void 0)return this;if(o.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):o[s]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete o[s]),this;if(arguments.length===0){var l=Object.keys(o);for(o=0;o<l.length;++o){var p=l[o];p!=="removeListener"&&this.removeAllListeners(p)}return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(l=o[s])=="function")this.removeListener(s,l);else if(l!==void 0)for(o=l.length-1;0<=o;o--)this.removeListener(s,l[o]);return this},ea.prototype.listeners=function(s){return Bl(this,s,!0)},ea.prototype.rawListeners=function(s){return Bl(this,s,!1)},ea.listenerCount=function(s,o){return typeof s.listenerCount=="function"?s.listenerCount(o):Dl.call(s,o)},ea.prototype.listenerCount=Dl,ea.prototype.eventNames=function(){return 0<this._eventsCount?ux(this._events):[]},ea.once=function(s,o){return new Promise(function(l,p){function _(k){s.removeListener(o,A),p(k)}function A(){typeof s.removeListener=="function"&&s.removeListener("error",_),l([].slice.call(arguments))}El(s,o,A,{once:!0}),o!=="error"&&vs(s,_,{once:!0})})};var Qe=Object.assign,Kp=Object.defineProperty,Lp=!Qe||R(function(){if(ka&&Qe({b:1},Qe(Kp({},"a",{enumerable:!0,get:function(){Kp(this,"b",{value:3,enumerable:!1})}}),{b:2})).b!==1)return!0;var s={},o={},l=Symbol();return s[l]=7,"abcdefghijklmnopqrst".split("").forEach(function(p){o[p]=p}),Qe({},s)[l]!=7||Dc(Qe({},o)).join("")!="abcdefghijklmnopqrst"})?function(s,o){for(var l=Qa(s),p=arguments.length,_=1,A=Bf.f,k=zf;p>_;)for(var j,B=Af(arguments[_++]),z=A?Dc(B).concat(A(B)):Dc(B),Vt=z.length,_e=0;Vt>_e;)j=z[_e++],(!ka||k.call(B,j))&&(l[j]=B[j]);return l}:Qe;N({target:"Object",stat:!0,forced:Object.assign!==Lp},{assign:Lp}),zp("Map",function(s){return function(){return s(this,arguments.length?arguments[0]:void 0)}},Cp);var vx=Math.log,wx=Math.LN2;N({target:"Math",stat:!0},{log2:function(s){return vx(s)/wx}});var xx=Ra.f,yx=Hd.f,zx=Za.enforce,Ax=qa("match"),sc=y.RegExp,lk=sc.prototype,Wf=/a/g,mk=/a/g,nk=new sc(Wf)!==Wf;if(ka&&nc("RegExp",!nk||pc||R(function(){return mk[Ax]=!1,sc(Wf)!=Wf||sc(mk)==mk||sc(Wf,"i")!="/a/i"}))){for(var Oc=function(s,o){var l,p=this instanceof Oc,_=Lj(s),A=o===void 0;return!p&&_&&s.constructor===Oc&&A||(nk?_&&!A&&(s=s.source):s instanceof Oc&&(A&&(o=tj.call(s)),s=s.source),pc&&(l=!!o&&-1<o.indexOf("y"))&&(o=o.replace(/y/g,"")),s=lh(nk?new sc(s,o):sc(s,o),p?this:lk,Oc),pc&&l&&(zx(s).sticky=!0)),s},Bx=function(s){s in Oc||xx(Oc,s,{configurable:!0,get:function(){return sc[s]},set:function(o){sc[s]=o}})},Mp=yx(sc),Np=0;Mp.length>Np;)Bx(Mp[Np++]);lk.constructor=Oc,Oc.prototype=lk,Ta(y,"RegExp",Oc)}If("RegExp"),Sf("Float32",function(s){return function(o,l,p){return s(this,o,l,p)}}),Sf("Float64",function(s){return function(o,l,p){return s(this,o,l,p)}}),Sf("Uint32",function(s){return function(o,l,p){return s(this,o,l,p)}}),Sf("Uint16",function(s){return function(o,l,p){return s(this,o,l,p)}});var ok=function(s,o){return s===o?0:s==null?o==null?0:-1:o==null?s==null?0:1:typeof s.compare=="function"?s.compare(o):typeof o.compare=="function"?-o.compare(s):s<o?-1:s>o?1:0},pk=[],Op=pk.sort,Cx=R(function(){pk.sort(void 0)}),Dx=R(function(){pk.sort(null)}),Ex=Ee("sort");N({target:"Array",proto:!0,forced:Cx||!Dx||!Ex},{sort:function(s){return s===void 0?Op.call(Qa(this)):Op.call(Qa(this),yb(s))}});var Pp=Object.getPrototypeOf({}),Xf=function(s,o){var l;return s===o||(s==null?s==o:X(s.equiv)==="function"?s.equiv(o):o==null?s==o:X(o.equiv)==="function"?o.equiv(s):X(s)!=="string"&&X(o)!=="string"&&((l=Object.getPrototypeOf(s))!=null&&l!==Pp||(l=Object.getPrototypeOf(o))!=null&&l!==Pp?X(s)!=="function"&&s.length!==void 0&&X(o)!=="function"&&o.length!==void 0?Gx(s,o):s instanceof Set&&o instanceof Set?Hx(s,o):s instanceof Map&&o instanceof Map?Ix(s,o):s instanceof Date&&o instanceof Date?s.getTime()===o.getTime():s instanceof RegExp&&o instanceof RegExp?s.toString()===o.toString():s!=s&&o!=o:Fx(s,o)))},Gx=function(s,o){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf,p=s.length;if(p===o.length)for(;0<=--p&&l(s[p],o[p]););return 0>p},Hx=function(s,o){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return s.size===o.size&&l(G(s.keys()).sort(),G(o.keys()).sort())},Ix=function(s,o){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;return s.size===o.size&&l(G(s).sort(),G(o).sort())},Fx=function(s,o){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:Xf;if(Object.keys(s).length!==Object.keys(o).length)return!1;for(var p in s)if(!o.hasOwnProperty(p)||!l(s[p],o[p]))return!1;return!0},Qp=function(s){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:function(l){return l!==void 0?": "+l:""};return function(l){function p(A){return W(this,p),_.call(this,s(A)+o(A))}la(p,l);var _=ma(p);return p}(ef(Error))},Jx=Qp(function(){return"illegal argument(s)"}),vh=function(s){throw new Jx(s)},qk=Qp(function(){return"index out of bounds"}),Rp=1/4294967295,Kx=function(){function s(){W(this,s)}return Ha(s,[{key:"float",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return this.int()*Rp*o}},{key:"norm",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(this.int()*Rp-.5)*o}},{key:"minmax",value:function(o,l){return this.float()*(l-o)+o}}]),s}(),rk=Math.random,Lx=new(function(s){function o(){return W(this,o),l.apply(this,arguments)}la(o,s);var l=ma(o);return Ha(o,[{key:"int",value:function(){return 4294967296*rk()>>>0}},{key:"float",value:function(){var p=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return rk()*p}},{key:"norm",value:function(){var p=0<arguments.length&&arguments[0]!==void 0?arguments[0]:1;return 2*(rk()-.5)*p}}]),o}(Kx)),Vh=Symbol(),Hl=function(){},Mx=fk.onFreeze,sk=Object.freeze,Nx=R(function(){sk(1)});N({target:"Object",stat:!0,forced:Nx,sham:!yp},{freeze:function(s){return sk&&ha(s)?sk(Mx(s)):s}});var Ox=Ee("reduce"),Px=!Hc&&79<id&&83>id;N({target:"Array",proto:!0,forced:!Ox||Px},{reduce:function(s){return Wo(this,s,arguments.length,1<arguments.length?arguments[1]:void 0)}});var Gl=function(s){return s!=null&&typeof s.xform=="function"?s.xform():s},og=function(){function s(o){W(this,s),this.value=o}return Ha(s,[{key:"deref",value:function(){return this.value}}]),s}(),Wh=function(s){return s instanceof og?s.deref():s},xs=function(s,o){return[s,function(l){return l},o]},Qx=w.mark(function(s,o){var l,p,_,A,k,j;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:l=Gl(s)(ws()),p=l[1],_=l[2],A=0;case 4:if(!(A<o.length)){B.next=15;break}if(k=o[A],!((j=_([],k))instanceof og)){B.next=10;break}return B.delegateYield(Wh(p(j.deref())),"t0",9);case 9:return B.abrupt("return");case 10:if(!j.length){B.next=12;break}return B.delegateYield(j,"t1",12);case 12:A++,B.next=4;break;case 15:return B.delegateYield(Wh(p([])),"t2",16);case 16:case"end":return B.stop()}},Qx)}),ys=w.mark(Fl),zs=function(s,o){return[s[0],s[1],o]},Sp=!0;"findIndex"in[]&&Array(1).findIndex(function(){Sp=!1}),N({target:"Array",proto:!0,forced:Sp},{findIndex:function(s){return An(this,s,1<arguments.length?arguments[1]:void 0)}}),Ld("findIndex"),N({target:"Array",proto:!0},{fill:yj}),Ld("fill");var Rx=function(){function s(o){W(this,s),this._length=0,o&&this.into(o)}return Ha(s,[{key:"length",get:function(){return this._length}},{key:"copy",value:function(){return new s(this)}},{key:"empty",value:function(){return new s}},{key:"clear",value:function(){this.release()}},{key:"release",value:function(){for(var o,l=this.head;l;)o=l.next,delete l.value,delete l.prev,delete l.next,l=o;return delete this.head,delete this.tail,this._length=0,!0}},{key:"compare",value:function(o){var l=this._length;if(l<o._length)return-1;if(l>o._length)return 1;if(l===0)return 0;l=this.head,o=o.head;for(var p=0;l&&p==0;)p=ok(l.value,o.value),l=l.next,o=o.next;return p}},{key:"equiv",value:function(o){if(!(o instanceof s||o!=null&&typeof o!="function"&&o.length!==void 0)||this._length!==o.length)return!1;if(!this._length||this===o)return!0;for(var l=this.head,p=0;p<o.length;p++){if(!Xf(l.value,o[p]))return!1;l=l.next}return!0}},{key:Symbol.iterator,value:w.mark(function o(){var l;return w.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:l=this.head;case 1:if(!l){p.next=7;break}return p.next=4,l.value;case 4:l=l.next,p.next=1;break;case 7:case"end":return p.stop()}},o,this)})},{key:"seq",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,l=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;if(!(o>=l||0>o)){o=this.nthCell(o);var p=this.nthCell(l-1);return l=function _(A){return{first:function(){return A.value},next:function(){return A!==p&&A.next?_(A.next):void 0}}},o?l(o):void 0}}},{key:"cycle",value:w.mark(function o(){return w.wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.delegateYield(this,"t0",2);case 2:l.next=0;break;case 4:case"end":return l.stop()}},o,this)})},{key:"$reduce",value:function(o,l){for(var p=this.head;p&&!(l instanceof og);)l=o(l,p.value),p=p.next;return l}},{key:"drop",value:function(){var o=this.head;if(o)return(this.head=o.next)?delete this.head.prev:delete this.tail,this._length--,o.value}},{key:"cons",value:function(o){return o={value:o,next:this.head},this.head?this.head.prev=o:this.tail=o,this.head=o,this._length++,this}},{key:"insertBefore",value:function(o,l){return o||vh("cell is undefined"),l={value:l,next:o,prev:o.prev},o.prev?o.prev.next=l:this.head=l,o.prev=l,this._length++,this}},{key:"insertAfter",value:function(o,l){return o||vh("cell is undefined"),l={value:l,next:o.next,prev:o},o.next?o.next.prev=l:this.tail=l,o.next=l,this._length++,this}},{key:"insertBeforeNth",value:function(o,l){if(0>o&&(o+=this._length),0>=o)return this.cons(l);if(0>o||o>=this._length)throw new qk(o);return this.insertBefore(this.nthCellUnsafe(o),l)}},{key:"insertAfterNth",value:function(o,l){if(0>o&&(o+=this._length),o>=this._length-1)return this.push(l);if(0>o||o>=this._length)throw new qk(o);return this.insertAfter(this.nthCellUnsafe(o),l)}},{key:"insertSorted",value:function(o,l){l=l||ok;for(var p=this.head;p;){if(0>=l(o,p.value))return this.insertBefore(p,o);p=p.next}return this.push(o)}},{key:"find",value:function(o){for(var l=this.head;l;){if(l.value===o)return l;l=l.next}}},{key:"findWith",value:function(o){for(var l=this.head;l;){if(o(l.value))return l;l=l.next}}},{key:"concat",value:function(){for(var o=this.copy(),l=arguments.length,p=Array(l),_=0;_<l;_++)p[_]=arguments[_];for(l=0;l<p.length;l++)o.into(p[l]);return o}},{key:"into",value:function(o){for(var l=0;l<o.length;l++)this.push(o[l])}},{key:"slice",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,l=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.length;o=0>o?o+this._length:o,l=0>l?l+this._length:l,(0>o||0>l)&&vh("invalid indices: ${from} / ${to}");for(var p=new s,_=this.nthCell(o);_&&++o<=l;)p.push(_.value),_=_.next;return p}},{key:"splice",value:function(o){var l=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,p=2<arguments.length?arguments[2]:void 0;if(typeof o=="number"){if(0>o&&(o+=this._length),0>o||o>=this._length)throw new qk(o);var _=this.nthCellUnsafe(o)}else _=o;var A=new s;if(0<l)for(;_&&0<l--;)this.remove(_),A.push(_.value),_=_.next;else _&&(_=_.next);if(p)if(_)for(l=0;l<p.length;l++)this.insertBefore(_,p[l]);else for(_=0;_<p.length;_++)this.push(p[_]);return A}},{key:"remove",value:function(o){return o.prev?o.prev.next=o.next:this.head=o.next,o.next?o.next.prev=o.prev:this.tail=o.prev,this._length--,this}},{key:"swap",value:function(o,l){if(o!==l){var p=o.value;o.value=l.value,l.value=p}return this}},{key:"push",value:function(o){return this.tail?(o={value:o,prev:this.tail},this.tail=this.tail.next=o,this._length++,this):this.cons(o)}},{key:"pop",value:function(){var o=this.tail;if(o)return(this.tail=o.prev)?delete this.tail.next:delete this.head,this._length--,o.value}},{key:"first",value:function(){return this.head&&this.head.value}},{key:"peek",value:function(){return this.tail&&this.tail.value}},{key:"setHead",value:function(o){return this.head?(this.head.value=o,this):this.cons(o)}},{key:"setTail",value:function(o){return this.tail?(this.tail.value=o,this):this.push(o)}},{key:"setNth",value:function(o,l){var p=this.nthCell(o);return!p&&vh("index out of bounds: ".concat(o)),p.value=l,this}},{key:"nth",value:function(o,l){return(o=this.nthCell(o))?o.value:l}},{key:"nthCell",value:function(o){if(0>o&&(o+=this._length),!(0>o||o>=this._length))return this.nthCellUnsafe(o)}},{key:"rotateLeft",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:return this.push(this.drop())}}},{key:"rotateRight",value:function(){switch(this._length){case 0:case 1:return this;case 2:return this.swap(this.head,this.tail);default:var o=this.peek();return this.pop(),this.cons(o)}}},{key:"map",value:function(o){for(var l=new s,p=this.head;p;)l.push(o(p.value)),p=p.next;return l}},{key:"filter",value:function(o){for(var l=new s,p=this.head;p;)o(p.value)&&l.push(p.value),p=p.next;return l}},{key:"reduce",value:function(o,l){for(var p=this.head;p;)l=o(l,p.value),p=p.next;return l}},{key:"shuffle",value:function(o){var l=1<arguments.length&&arguments[1]!==void 0?arguments[1]:Lx;if(2>this._length)return this;for(o=o??Math.ceil(1.5*Math.log2(this._length));0<o;o--)for(var p=this.head;p;){var _=p.next;.5>l.float()?this.asHead(p):this.asTail(p),p=_}return this}},{key:"sort",value:function(){var o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:ok;if(!this._length)return this;for(var l=1;;){var p=this.head;this.tail=this.head=void 0;for(var _=0;p;){_++;for(var A=p,k=0,j=0;j<l&&(k++,A=A.next);j++);for(j=l;0<k||0<j&&A;){if(k===0){var B=A;A=A.next,j--}else A&&j!==0?0>=o(p.value,A.value)?(B=p,p=p.next,k--):(B=A,A=A.next,j--):(B=p,p=p.next,k--);this.tail?this.tail.next=B:this.head=B,B.prev=this.tail,this.tail=B}p=A}if(this.tail.next=void 0,1>=_)return this;l*=2}}},{key:"reverse",value:function(){for(var o=this.head,l=this.tail,p=(this._length>>>1)+(1&this._length);o&&l&&0<p;){var _=o.value;o.value=l.value,l.value=_,o=o.next,l=l.prev,p--}return this}},{key:"asHead",value:function(o){return o===this.head||(this.remove(o),this.head.prev=o,o.next=this.head,o.prev=void 0,this.head=o,this._length++),this}},{key:"asTail",value:function(o){return o===this.tail||(this.remove(o),this.tail.next=o,o.prev=this.tail,o.next=void 0,this.tail=o,this._length++),this}},{key:"toString",value:function(){for(var o=[],l=this.head;l;)o.push(String(l.value)),l=l.next;return o.join(", ")}},{key:"toJSON",value:function(){return G(this)}},{key:"nthCellUnsafe",value:function(o){if(o<=this._length>>1)var l=this.head,p="next";else l=this.tail,p="prev",o=this._length-o-1;for(;0<o--&&l;)l=l[p];return l}}]),s}(),tc=function(){function s(o,l){W(this,s),l=Object.assign({maxlen:1/0,maxsize:1/0,map:function(){return new Map},ksize:function(){return 0},vsize:function(){return 0}},l),this.map=l.map(),this.items=new Rx,this._size=0,this.opts=l,o&&this.into(o)}return Ha(s,[{key:"length",get:function(){return this.items.length}},{key:"size",get:function(){return this._size}},{key:Symbol.iterator,value:function(){return this.entries()}},{key:"entries",value:function(){return pg(function(o){return[o.k,o]},this.items)}},{key:"keys",value:function(){return pg(function(o){return o.k},this.items)}},{key:"values",value:function(){return pg(function(o){return o.v},this.items)}},{key:"copy",value:function(){var o=this.empty();o.items=this.items.copy();for(var l=o.items.head;l;)o.map.set(l.value.k,l),l=l.next;return o}},{key:"empty",value:function(){return new s(null,this.opts)}},{key:"release",value:function(){this._size=0,this.map.clear();var o=this.opts.release;if(o){for(var l;l=this.items.drop();)o(l.k,l.v);return!0}return this.items.release()}},{key:"has",value:function(o){return this.map.has(o)}},{key:"get",value:function(o,l){return(o=this.map.get(o))?this.resetEntry(o):l}},{key:"set",value:function(o,l){var p=this.opts.ksize(o)+this.opts.vsize(l),_=this.map.get(o);return this._size+=Math.max(0,p-(_?_.value.s:0)),this.ensureSize()&&this.doSetEntry(_,o,l,p),l}},{key:"into",value:function(o){for(var l=0;l<o.length;l++){var p=o[l];this.set(p[0],p[1])}return this}},{key:"getSet",value:function(o,l){var p=this,_=this.map.get(o);return _?Promise.resolve(this.resetEntry(_)):l().then(function(A){return p.set(o,A)})}},{key:"delete",value:function(o){return!!(o=this.map.get(o))&&(this.removeEntry(o),!0)}},{key:"resetEntry",value:function(o){return this.items.asTail(o),o.value.v}},{key:"ensureSize",value:function(){for(var o=this.opts.release,l=this.opts.maxsize,p=this.opts.maxlen;this._size>l||this.length>=p;){var _=this.items.drop();if(!_)return!1;this.map.delete(_.k),o&&o(_.k,_.v),this._size-=_.s}return!0}},{key:"removeEntry",value:function(o){var l=o.value;this.map.delete(l.k),this.items.remove(o),this.opts.release&&this.opts.release(l.k,l.v),this._size-=l.s}},{key:"doSetEntry",value:function(o,l,p,_){o?(o.value.v=p,o.value.s=_,this.items.asTail(o)):(this.items.push({k:l,v:p,s:_}),this.map.set(l,this.items.tail))}}]),s}(),Sx=function(s){function o(p,_){return W(this,o),_=Object.assign({ttl:36e5},_),l.call(this,p,_)}la(o,s);var l=ma(o);return Ha(o,[{key:"empty",value:function(){return new o(null,this.opts)}},{key:"has",value:function(p){return this.get(p)!==void 0}},{key:"get",value:function(p,_){if(p=this.map.get(p)){if(p.value.t>=Date.now())return this.resetEntry(p);this.removeEntry(p)}return _}},{key:"set",value:function(p,_){var A=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,k=this.opts.ksize(p)+this.opts.vsize(_),j=this.map.get(p);return this._size+=Math.max(0,k-(j?j.value.s:0)),this.ensureSize()&&(A=Date.now()+A,j?(j.value.v=_,j.value.s=k,j.value.t=A,this.items.asTail(j)):(this.items.push({k:p,v:_,s:k,t:A}),this.map.set(p,this.items.tail))),_}},{key:"getSet",value:function(p,_){var A=this,k=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this.opts.ttl,j=this.get(p);return j?Promise.resolve(j):_().then(function(B){return A.set(p,B,k)})}},{key:"prune",value:function(){for(var p=Date.now(),_=this.items.head;_;)_.value.t<p&&this.removeEntry(_),_=_.next}},{key:"ensureSize",value:function(){for(var p=this.opts.maxsize,_=this.opts.maxlen,A=Date.now(),k=this.items.head;k&&(this._size>p||this.length>=_);)k.value.t<A&&this.removeEntry(k),k=k.next;return Th(wd(o.prototype),"ensureSize",this).call(this)}}]),o}(tc),Tp=X(Ya)=="object"&&Ya&&Ya.Object===Object&&Ya,Tx=(typeof self>"u"?"undefined":X(self))=="object"&&self&&self.Object===Object&&self,Cb=Tp||Tx||Function("return this")(),Pb=Cb.Symbol,Up=Object.prototype,Ux=Up.hasOwnProperty,Vx=Up.toString,Yf=Pb?Pb.toStringTag:void 0,Wx=Object.prototype.toString,Vp=Pb?Pb.toStringTag:void 0,Qd=function(s){if(s==null)s=s===void 0?"[object Undefined]":"[object Null]";else if(Vp&&Vp in Object(s)){var o=Ux.call(s,Yf),l=s[Yf];try{s[Yf]=void 0;var p=!0}catch{}var _=Vx.call(s);p&&(o?s[Yf]=l:delete s[Yf]),s=_}else s=Wx.call(s);return s},lb=function(s){var o=X(s);return s!=null&&(o=="object"||o=="function")},qi=function(s){return!!lb(s)&&((s=Qd(s))=="[object Function]"||s=="[object GeneratorFunction]"||s=="[object AsyncFunction]"||s=="[object Proxy]")},tk=Cb["__core-js_shared__"],Wp=function(){var s=/[^.]+$/.exec(tk&&tk.keys&&tk.keys.IE_PROTO||"");return s?"Symbol(src)_1."+s:""}(),Xx=Function.prototype.toString,Rd=function(s){if(s!=null){try{return Xx.call(s)}catch{}return s+""}return""},Yx=/^\[object .+?Constructor\]$/,Zx=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Sd=function(s,o){return s=s==null?void 0:s[o],!lb(s)||Wp&&Wp in s||!(qi(s)?Zx:Yx).test(Rd(s))?void 0:s},Zf=Sd(Object,"create"),$x=Object.prototype.hasOwnProperty,ay=Object.prototype.hasOwnProperty;zd.prototype.clear=function(){this.__data__=Zf?Zf(null):{},this.size=0},zd.prototype.delete=function(s){return s=this.has(s)&&delete this.__data__[s],this.size-=s?1:0,s},zd.prototype.get=function(s){var o=this.__data__;return Zf?(s=o[s])==="__lodash_hash_undefined__"?void 0:s:$x.call(o,s)?o[s]:void 0},zd.prototype.has=function(s){var o=this.__data__;return Zf?o[s]!==void 0:ay.call(o,s)},zd.prototype.set=function(s,o){var l=this.__data__;return this.size+=this.has(s)?0:1,l[s]=Zf&&o===void 0?"__lodash_hash_undefined__":o,this};var $f=function(s,o){return s===o||s!=s&&o!=o},wh=function(s,o){for(var l=s.length;l--;)if($f(s[l][0],o))return l;return-1},by=Array.prototype.splice;ce.prototype.clear=function(){this.__data__=[],this.size=0},ce.prototype.delete=function(s){var o=this.__data__;return!(0>(s=wh(o,s)))&&(s==o.length-1?o.pop():by.call(o,s,1),--this.size,!0)},ce.prototype.get=function(s){var o=this.__data__;return 0>(s=wh(o,s))?void 0:o[s][1]},ce.prototype.has=function(s){return-1<wh(this.__data__,s)},ce.prototype.set=function(s,o){var l=this.__data__,p=wh(l,s);return 0>p?(++this.size,l.push([s,o])):l[p][1]=o,this};var rg=ce,ag=Sd(Cb,"Map"),xh=function(s,o){s=s.__data__;var l=X(o);return(l=="string"||l=="number"||l=="symbol"||l=="boolean"?o!=="__proto__":o===null)?s[typeof o=="string"?"string":"hash"]:s.map};de.prototype.clear=function(){this.size=0,this.__data__={hash:new zd,map:new(ag||rg),string:new zd}},de.prototype.delete=function(s){return s=xh(this,s).delete(s),this.size-=s?1:0,s},de.prototype.get=function(s){return xh(this,s).get(s)},de.prototype.has=function(s){return xh(this,s).has(s)},de.prototype.set=function(s,o){var l=xh(this,s),p=l.size;return l.set(s,o),this.size+=l.size==p?0:1,this};var qg=de;gf.prototype.add=gf.prototype.push=function(s){return this.__data__.set(s,"__lodash_hash_undefined__"),this},gf.prototype.has=function(s){return this.__data__.has(s)};var Xp=function(s,o,l,p){var _=s.length;for(l+=-1;++l<_;)if(o(s[l],l,s))return l;return-1},cy=function(s){return s!=s},dy=function(s,o){var l;if(l=!(s==null||!s.length)){if(o==o)t:{l=-1;for(var p=s.length;++l<p;)if(s[l]===o){s=l;break t}s=-1}else s=Xp(s,cy,0);l=-1<s}return l},ey=function(s,o,l){for(var p=-1,_=s==null?0:s.length;++p<_;)if(l(o,s[p]))return!0;return!1},fy=function(s,o){return s.has(o)},Re=Sd(Cb,"Set"),gy=function(){},uk=function(s){var o=-1,l=Array(s.size);return s.forEach(function(p){l[++o]=p}),l},hy=1/0,iy=Re&&1/uk(new Re([,-0]))[1]==hy?function(s){return new Re(s)}:gy,vk=function(s,o,l){var p=-1,_=dy,A=s.length,k=!0,j=[],B=j;if(l)k=!1,_=ey;else if(200<=A){if(_=iy(s))return uk(_);k=!1,_=fy,B=new gf}else B=j;t:for(;++p<A;){var z=s[p],Vt=z;if(z=l||z!==0?z:0,k&&Vt==Vt){for(var _e=B.length;_e--;)if(B[_e]===Vt)continue t;j.push(z)}else _(B,Vt,l)||(B!==j&&B.push(Vt),j.push(z))}return j},Yp=function(s){for(var o=-1,l=s==null?0:s.length,p={};++o<l;){var _=s[o];p[_[0]]=_[1]}return p},he=function(s,o){for(var l=-1,p=s==null?0:s.length,_=Array(p);++l<p;)_[l]=o(s[l],l,s);return _};ee.prototype.clear=function(){this.__data__=new rg,this.size=0},ee.prototype.delete=function(s){var o=this.__data__;return s=o.delete(s),this.size=o.size,s},ee.prototype.get=function(s){return this.__data__.get(s)},ee.prototype.has=function(s){return this.__data__.has(s)},ee.prototype.set=function(s,o){var l=this.__data__;if(l instanceof rg){var p=l.__data__;if(!ag||199>p.length)return p.push([s,o]),this.size=++l.size,this;l=this.__data__=new qg(p)}return l.set(s,o),this.size=l.size,this};var ge=ee,Is=function(s,o){for(var l=-1,p=s==null?0:s.length;++l<p&&o(s[l],l,s)!==!1;);return s},yh=function(){try{var s=Sd(Object,"defineProperty");return s({},"",{}),s}catch{}}(),bg=function(s,o,l){o=="__proto__"&&yh?yh(s,o,{configurable:!0,enumerable:!0,value:l,writable:!0}):s[o]=l},jy=Object.prototype.hasOwnProperty,Ml=function(s,o,l){var p=s[o];jy.call(s,o)&&$f(p,l)&&(l!==void 0||o in s)||bg(s,o,l)},re=function(s,o,l,p){var _=!l;l||(l={});for(var A=-1,k=o.length;++A<k;){var j=o[A],B=void 0;B===void 0&&(B=s[j]),_?bg(l,j,B):Ml(l,j,B)}return l},gc=function(s){return s!=null&&X(s)=="object"},Zp=function(s){return gc(s)&&Qd(s)=="[object Arguments]"},$p=Object.prototype,ky=$p.hasOwnProperty,ly=$p.propertyIsEnumerable,rf=Zp(function(){return arguments}())?Zp:function(s){return gc(s)&&ky.call(s,"callee")&&!ly.call(s,"callee")},Va=Array.isArray,my=function(){return!1},jf=$a(function(s,o){var l=(o=o&&!o.nodeType&&o)&&s&&!s.nodeType&&s;o=l&&l.exports===o?Cb.Buffer:void 0,s.exports=(o?o.isBuffer:void 0)||my}),ny=/^(?:0|[1-9]\d*)$/,wk=function(s,o){var l=X(s);return!!(o=o??9007199254740991)&&(l=="number"||l!="symbol"&&ny.test(s))&&-1<s&&s%1==0&&s<o},xk=function(s){return typeof s=="number"&&-1<s&&s%1==0&&9007199254740991>=s},Ea={};Ea["[object Float32Array]"]=Ea["[object Float64Array]"]=Ea["[object Int8Array]"]=Ea["[object Int16Array]"]=Ea["[object Int32Array]"]=Ea["[object Uint8Array]"]=Ea["[object Uint8ClampedArray]"]=Ea["[object Uint16Array]"]=Ea["[object Uint32Array]"]=!0,Ea["[object Arguments]"]=Ea["[object Array]"]=Ea["[object ArrayBuffer]"]=Ea["[object Boolean]"]=Ea["[object DataView]"]=Ea["[object Date]"]=Ea["[object Error]"]=Ea["[object Function]"]=Ea["[object Map]"]=Ea["[object Number]"]=Ea["[object Object]"]=Ea["[object RegExp]"]=Ea["[object Set]"]=Ea["[object String]"]=Ea["[object WeakMap]"]=!1;var oy=function(s){return gc(s)&&xk(s.length)&&!!Ea[Qd(s)]},zh=function(s){return function(o){return s(o)}},Se=$a(function(s,o){var l=o&&!o.nodeType&&o;l=(o=l&&s&&!s.nodeType&&s)&&o.exports===l&&Tp.process;t:{try{var p=o&&o.require&&o.require("util").types;if(p){var _=p;break t}_=l&&l.binding&&l.binding("util");break t}catch{}_=void 0}s.exports=_}),aq=Se&&Se.isTypedArray,bi=aq?zh(aq):oy,py=Object.prototype.hasOwnProperty,bq=function(s,o){var l=Va(s),p=!l&&rf(s),_=!l&&!p&&jf(s),A=!l&&!p&&!_&&bi(s);if(l=l||p||_||A){p=s.length;for(var k=String,j=-1,B=Array(p);++j<p;)B[j]=k(j);p=B}else p=[];for(var z in k=p.length,s)!o&&!py.call(s,z)||l&&(z=="length"||_&&(z=="offset"||z=="parent")||A&&(z=="buffer"||z=="byteLength"||z=="byteOffset")||wk(z,k))||p.push(z);return p},qy=Object.prototype,yk=function(s){var o=s&&s.constructor;return s===(typeof o=="function"&&o.prototype||qy)},cq=function(s,o){return function(l){return s(o(l))}},ry=cq(Object.keys,Object),sy=Object.prototype.hasOwnProperty,Ed=function(s){return s!=null&&xk(s.length)&&!qi(s)},Ad=function(s){if(Ed(s))s=bq(s);else if(yk(s)){var o,l=[];for(o in Object(s))sy.call(s,o)&&o!="constructor"&&l.push(o);s=l}else s=ry(s);return s},Es=function(s,o){return s&&re(o,Ad(o),s)},ty=Object.prototype.hasOwnProperty,kf=function(s){if(Ed(s))s=bq(s,!0);else if(lb(s)){var o=yk(s),l=[];for(p in s)(p!="constructor"||!o&&ty.call(s,p))&&l.push(p);s=l}else{var p=[];if(s!=null)for(o in Object(s))p.push(o);s=p}return s},Cs=function(s,o){return s&&re(o,kf(o),s)},Jl=$a(function(s,o){var l=(o=o&&!o.nodeType&&o)&&s&&!s.nodeType&&s,p=(o=l&&l.exports===o?Cb.Buffer:void 0)?o.allocUnsafe:void 0;s.exports=function(_,A){return A?_.slice():(A=_.length,A=p?p(A):new _.constructor(A),_.copy(A),A)}}),Xh=function(s,o){var l=-1,p=s.length;for(o||(o=Array(p));++l<p;)o[l]=s[l];return o},uy=function(s,o){for(var l=-1,p=s==null?0:s.length,_=0,A=[];++l<p;){var k=s[l];o(k,l,s)&&(A[_++]=k)}return A},dq=function(){return[]},vy=Object.prototype.propertyIsEnumerable,eq=Object.getOwnPropertySymbols,zk=eq?function(s){return s==null?[]:(s=Object(s),uy(eq(s),function(o){return vy.call(s,o)}))}:dq,Ds=function(s,o){return re(s,zk(s),o)},ai=function(s,o){for(var l=-1,p=o.length,_=s.length;++l<p;)s[_+l]=o[l];return s},Ak=cq(Object.getPrototypeOf,Object),fq=Object.getOwnPropertySymbols?function(s){for(var o=[];s;)ai(o,zk(s)),s=Ak(s);return o}:dq,Bs=function(s,o){return re(s,fq(s),o)},gq=function(s,o,l){return o=o(s),Va(s)?o:ai(o,l(s))},Yh=function(s){return gq(s,Ad,zk)},Ll=function(s){return gq(s,kf,fq)},Bk=Sd(Cb,"DataView"),Ck=Sd(Cb,"Promise"),Dk=Sd(Cb,"WeakMap"),wy=Rd(Bk),xy=Rd(ag),yy=Rd(Ck),zy=Rd(Re),Ay=Rd(Dk),Td=Qd;(Bk&&Td(new Bk(new ArrayBuffer(1)))!="[object DataView]"||ag&&Td(new ag)!="[object Map]"||Ck&&Td(Ck.resolve())!="[object Promise]"||Re&&Td(new Re)!="[object Set]"||Dk&&Td(new Dk)!="[object WeakMap]")&&(Td=function(s){var o=Qd(s);if(s=(s=o=="[object Object]"?s.constructor:void 0)?Rd(s):"")switch(s){case wy:return"[object DataView]";case xy:return"[object Map]";case yy:return"[object Promise]";case zy:return"[object Set]";case Ay:return"[object WeakMap]"}return o});var hf=Td,By=Object.prototype.hasOwnProperty,As=function(s){var o=s.length,l=new s.constructor(o);return o&&typeof s[0]=="string"&&By.call(s,"index")&&(l.index=s.index,l.input=s.input),l},Ah=Cb.Uint8Array,Ek=function(s){var o=new s.constructor(s.byteLength);return new Ah(o).set(new Ah(s)),o},Cy=/\w*$/,hq=Pb?Pb.prototype:void 0,iq=hq?hq.valueOf:void 0,vm=function(s,o){return o=o?Ek(s.buffer):s.buffer,new s.constructor(o,s.byteOffset,s.length)},Fs=function(s,o,l){var p=s.constructor;switch(o){case"[object ArrayBuffer]":return Ek(s);case"[object Boolean]":case"[object Date]":return new p(+s);case"[object DataView]":return o=l?Ek(s.buffer):s.buffer,new s.constructor(o,s.byteOffset,s.byteLength);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return vm(s,l);case"[object Map]":return new p;case"[object Number]":case"[object String]":return new p(s);case"[object RegExp]":return(o=new s.constructor(s.source,Cy.exec(s))).lastIndex=s.lastIndex,o;case"[object Set]":return new p;case"[object Symbol]":return iq?Object(iq.call(s)):{}}},jq=Object.create,Dy=function(){function s(){}return function(o){return lb(o)?jq?jq(o):(s.prototype=o,o=new s,s.prototype=void 0,o):{}}}(),Kl=function(s){return typeof s.constructor!="function"||yk(s)?{}:Dy(Ak(s))},Ey=function(s){return gc(s)&&hf(s)=="[object Map]"},kq=Se&&Se.isMap,Hs=kq?zh(kq):Ey,Fy=function(s){return gc(s)&&hf(s)=="[object Set]"},lq=Se&&Se.isSet,Gs=lq?zh(lq):Fy,wa={};wa["[object Arguments]"]=wa["[object Array]"]=wa["[object ArrayBuffer]"]=wa["[object DataView]"]=wa["[object Boolean]"]=wa["[object Date]"]=wa["[object Float32Array]"]=wa["[object Float64Array]"]=wa["[object Int8Array]"]=wa["[object Int16Array]"]=wa["[object Int32Array]"]=wa["[object Map]"]=wa["[object Number]"]=wa["[object Object]"]=wa["[object RegExp]"]=wa["[object Set]"]=wa["[object String]"]=wa["[object Symbol]"]=wa["[object Uint8Array]"]=wa["[object Uint8ClampedArray]"]=wa["[object Uint16Array]"]=wa["[object Uint32Array]"]=!0,wa["[object Error]"]=wa["[object Function]"]=wa["[object WeakMap]"]=!1;var ie=function(s){return X(s)=="symbol"||gc(s)&&Qd(s)=="[object Symbol]"},Gy=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Hy=/^\w*$/,Fk=function(s,o){if(Va(s))return!1;var l=X(s);return!(l!="number"&&l!="symbol"&&l!="boolean"&&s!=null&&!ie(s))||Hy.test(s)||!Gy.test(s)||o!=null&&s in Object(o)};Zh.Cache=qg;var Iy=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Jy=/\\(\\)?/g,Ky=function(s){var o=(s=Zh(s,function(l){return o.size===500&&o.clear(),l})).cache;return s}(function(s){var o=[];return s.charCodeAt(0)===46&&o.push(""),s.replace(Iy,function(l,p,_,A){o.push(_?A.replace(Jy,"$1"):p||l)}),o}),mq=Pb?Pb.prototype:void 0,Ol=mq?mq.toString:void 0,Bh=function(s,o){return Va(s)?s:Fk(s,o)?[s]:Ky(s==null?"":Nl(s))},cg=function(s){if(typeof s=="string"||ie(s))return s;var o=s+"";return o=="0"&&1/s==-1/0?"-0":o},Ch=function(s,o){for(var l=0,p=(o=Bh(o,s)).length;s!=null&&l<p;)s=s[cg(o[l++])];return l&&l==p?s:void 0},My=function(s,o){if(!(2>(o=Bh(o,s)).length)){var l=o,p=0,_=-1,A=-1,k=l.length;for(0>p&&(p=-p>k?0:k+p),0>(_=_>k?k:_)&&(_+=k),k=p>_?0:_-p>>>0,p>>>=0,_=Array(k);++A<k;)_[A]=l[A+p];s=Ch(s,_)}return(l=s==null)||(l=o==null?0:o.length,l=delete s[cg(l?o[l-1]:void 0)]),l},nq=Function.prototype.toString,Ny=Object.prototype.hasOwnProperty,Oy=nq.call(Object),wm=function(s){return!(!gc(s)||Qd(s)!="[object Object]")&&((s=Ak(s))===null||typeof(s=Ny.call(s,"constructor")&&s.constructor)=="function"&&s instanceof s&&nq.call(s)==Oy)},Py=function(s){return wm(s)?void 0:s},oq=Pb?Pb.isConcatSpreadable:void 0,Ks=function(s){return Va(s)||rf(s)||!!(oq&&s&&s[oq])},Qy=function(s){return s!=null&&s.length?$h(s):[]},Ry=function(s,o,l){switch(l.length){case 0:return s.call(o);case 1:return s.call(o,l[0]);case 2:return s.call(o,l[0],l[1]);case 3:return s.call(o,l[0],l[1],l[2])}return s.apply(o,l)},pq=Math.max,qq=function(s,o,l){return o=pq(o===void 0?s.length-1:o,0),function(){for(var p=arguments,_=-1,A=pq(p.length-o,0),k=Array(A);++_<A;)k[_]=p[o+_];for(_=-1,A=Array(o+1);++_<o;)A[_]=p[_];return A[o]=l(k),Ry(s,this,A)}},Sy=function(s){return function(){return s}},Dh=function(s){return s},Ty=Date.now,rq=function(s){var o=0,l=0;return function(){var p=Ty(),_=16-(p-l);if(l=p,0<_){if(800<=++o)return arguments[0]}else o=0;return s.apply(void 0,arguments)}}(yh?function(s,o){return yh(s,"toString",{configurable:!0,enumerable:!1,value:Sy(o),writable:!0})}:Dh),Gk=function(s){return rq(qq(s,void 0,Qy),s+"")}(function(s,o){var l={};if(s==null)return l;var p=!1;o=he(o,function(A){return A=Bh(A,s),p||(p=1<A.length),A}),re(s,Ll(s),l),p&&(l=fe(l,7,Py));for(var _=o.length;_--;)My(l,o[_]);return l}),Uy=function(s,o,l,p){for(var _=-1,A=s==null?0:s.length;++_<A;){var k=s[_];o(p,k,l(k),s)}return p},um=function(s,o,l){for(var p=-1,_=Object(s),A=(l=l(s)).length;A--;){var k=l[++p];if(o(_[k],k,_)===!1)break}return s},sq=function(s,o){return s&&um(s,o,Ad)},Hk=function(s,o){return function(l,p){if(l==null)return l;if(!Ed(l))return s(l,p);for(var _=l.length,A=-1,k=Object(l);++A<_&&p(k[A],A,k)!==!1;);return l}}(sq),Vy=function(s,o,l,p){return Hk(s,function(_,A,k){o(p,_,l(_),k)}),p},tq=function(s,o){for(var l=-1,p=s==null?0:s.length;++l<p;)if(o(s[l],l,s))return!0;return!1},Pl=function(s,o,l,p,_,A){var k=1&l,j=s.length,B=o.length;if(j!=B&&!(k&&B>j))return!1;B=A.get(s);var z=A.get(o);if(B&&z)return B==o&&z==s;B=-1,z=!0;var Vt=2&l?new gf:void 0;for(A.set(s,o),A.set(o,s);++B<j;){var _e=s[B],_n=o[B];if(p)var _o=k?p(_n,_e,B,o,s,A):p(_e,_n,B,s,o,A);if(_o!==void 0){if(_o)continue;z=!1;break}if(Vt){if(!tq(o,function(_c,_d){if(!Vt.has(_d)&&(_e===_c||_(_e,_c,l,p,A)))return Vt.push(_d)})){z=!1;break}}else if(_e!==_n&&!_(_e,_n,l,p,A)){z=!1;break}}return A.delete(s),A.delete(o),z},Wy=function(s){var o=-1,l=Array(s.size);return s.forEach(function(p,_){l[++o]=[_,p]}),l},uq=Pb?Pb.prototype:void 0,Ik=uq?uq.valueOf:void 0,Ls=function(s,o,l,p,_,A,k){switch(l){case"[object DataView]":if(s.byteLength!=o.byteLength||s.byteOffset!=o.byteOffset)break;s=s.buffer,o=o.buffer;case"[object ArrayBuffer]":if(s.byteLength!=o.byteLength||!A(new Ah(s),new Ah(o)))break;return!0;case"[object Boolean]":case"[object Date]":case"[object Number]":return $f(+s,+o);case"[object Error]":return s.name==o.name&&s.message==o.message;case"[object RegExp]":case"[object String]":return s==o+"";case"[object Map]":var j=Wy;case"[object Set]":if(j||(j=uk),s.size!=o.size&&!(1&p))break;return(l=k.get(s))?l==o:(p|=2,k.set(s,o),o=Pl(j(s),j(o),p,_,A,k),k.delete(s),o);case"[object Symbol]":if(Ik)return Ik.call(s)==Ik.call(o)}return!1},Ms=Object.prototype.hasOwnProperty,Ql=Object.prototype.hasOwnProperty,Xy=function(s,o,l,p){var _=l.length,A=_;if(s==null)return!A;for(s=Object(s);_--;){var k=l[_];if(k[2]?k[1]!==s[k[0]]:!(k[0]in s))return!1}for(;++_<A;){var j=(k=l[_])[0],B=s[j],z=k[1];if(k[2]){if(B===void 0&&!(j in s))return!1}else{var Vt;if(k=new ge,Vt===void 0?!je(z,B,3,p,k):!Vt)return!1}}return!0},Yy=function(s){for(var o=Ad(s),l=o.length;l--;){var p=o[l],_=s[p];o[l]=[p,_,_==_&&!lb(_)]}return o},vq=function(s,o){return function(l){return l!=null&&l[s]===o&&(o!==void 0||s in Object(l))}},Zy=function(s){var o=Yy(s);return o.length==1&&o[0][2]?vq(o[0][0],o[0][1]):function(l){return l===s||Xy(l,s,o)}},$y=function(s,o){return Fk(s)&&o==o&&!lb(o)?vq(cg(s),o):function(l){var p=l==null?void 0:Ch(l,s);if((p=p===void 0?void 0:p)===void 0&&p===o){if(p=l!=null){for(var _=-1,A=(p=Bh(p=s,l)).length,k=!1;++_<A;){var j=cg(p[_]);if(!(k=l!=null&&l!=null&&j in Object(l)))break;l=l[j]}k||++_!=A?p=k:p=!!(A=l==null?0:l.length)&&xk(A)&&wk(j,A)&&(Va(l)||rf(l))}j=p}else j=je(o,p,3);return j}},az=function(s){return function(o){return o==null?void 0:o[s]}},bz=function(s){return function(o){return Ch(o,s)}},Te=function(s){return typeof s=="function"?s:s==null?Dh:X(s)=="object"?Va(s)?$y(s[0],s[1]):Zy(s):Fk(s)?az(cg(s)):bz(s)},Jk=function(s,o){return function(l,p){var _={};return(Va(l)?Uy:Vy)(l,s,Te(p),_)}}(function(s,o,l){bg(s,l,o)}),uc=function(s,o){var l={};return o=Te(o),sq(s,function(p,_,A){bg(l,_,o(p,_,A))}),l};N({target:"String",proto:!0,forced:R(function(){var s="".sub('"');return s!==s.toLowerCase()||3<s.split('"').length})},{sub:function(){return"<sub>"+String(jb(this))+"</sub>"}});var U=xa,Qb=null;try{Qb=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(s){}xa.prototype.__isLong__,Object.defineProperty(xa.prototype,"__isLong__",{value:!0}),xa.isLong=mb;var Sl={},Rl={};xa.fromInt=Bd,xa.fromNumber=Gb,xa.fromBits=ya;var sg=Math.pow;xa.fromString=ci,xa.fromValue=Wb;var ke=4294967296,Tl=ke*ke,Vl=Tl/2,wq=Bd(16777216),Hb=Bd(0);xa.ZERO=Hb;var Cd=Bd(0,!0);xa.UZERO=Cd;var Ue=Bd(1);xa.ONE=Ue;var xq=Bd(1,!0);xa.UONE=xq;var Kk=Bd(-1);xa.NEG_ONE=Kk;var Wl=ya(-1,2147483647,!1);xa.MAX_VALUE=Wl;var Ul=ya(-1,-1,!0);xa.MAX_UNSIGNED_VALUE=Ul;var nb=ya(0,-2147483648,!1);xa.MIN_VALUE=nb;var D=xa.prototype;D.toInt=function(){return this.unsigned?this.low>>>0:this.low},D.toNumber=function(){return this.unsigned?(this.high>>>0)*ke+(this.low>>>0):this.high*ke+(this.low>>>0)},D.toString=function(s){if(2>(s=s||10)||36<s)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(nb)){var o=Gb(s),l=this.div(o);return o=l.mul(o).sub(this),l.toString(s)+o.toInt().toString(s)}return"-"+this.neg().toString(s)}l=Gb(sg(s,6),this.unsigned),o=this;for(var p="";;){var _=o.div(l),A=(o.sub(_.mul(l)).toInt()>>>0).toString(s);if((o=_).isZero())return A+p;for(;6>A.length;)A="0"+A;p=""+A+p}},D.getHighBits=function(){return this.high},D.getHighBitsUnsigned=function(){return this.high>>>0},D.getLowBits=function(){return this.low},D.getLowBitsUnsigned=function(){return this.low>>>0},D.getNumBitsAbs=function(){if(this.isNegative())return this.eq(nb)?64:this.neg().getNumBitsAbs();for(var s=this.high!=0?this.high:this.low,o=31;0<o&&!(s&1<<o);o--);return this.high!=0?o+33:o+1},D.isZero=function(){return this.high===0&&this.low===0},D.eqz=D.isZero,D.isNegative=function(){return!this.unsigned&&0>this.high},D.isPositive=function(){return this.unsigned||0<=this.high},D.isOdd=function(){return(1&this.low)==1},D.isEven=function(){return(1&this.low)==0},D.equals=function(s){return mb(s)||(s=Wb(s)),(this.unsigned===s.unsigned||this.high>>>31!=1||s.high>>>31!=1)&&this.high===s.high&&this.low===s.low},D.eq=D.equals,D.notEquals=function(s){return!this.eq(s)},D.neq=D.notEquals,D.ne=D.notEquals,D.lessThan=function(s){return 0>this.comp(s)},D.lt=D.lessThan,D.lessThanOrEqual=function(s){return 0>=this.comp(s)},D.lte=D.lessThanOrEqual,D.le=D.lessThanOrEqual,D.greaterThan=function(s){return 0<this.comp(s)},D.gt=D.greaterThan,D.greaterThanOrEqual=function(s){return 0<=this.comp(s)},D.gte=D.greaterThanOrEqual,D.ge=D.greaterThanOrEqual,D.compare=function(s){if(mb(s)||(s=Wb(s)),this.eq(s))return 0;var o=this.isNegative(),l=s.isNegative();return o&&!l?-1:!o&&l?1:this.unsigned?s.high>>>0>this.high>>>0||s.high===this.high&&s.low>>>0>this.low>>>0?-1:1:this.sub(s).isNegative()?-1:1},D.comp=D.compare,D.negate=function(){return!this.unsigned&&this.eq(nb)?nb:this.not().add(Ue)},D.neg=D.negate,D.add=function(s){mb(s)||(s=Wb(s));var o=this.high>>>16,l=65535&this.high,p=this.low>>>16,_=s.high>>>16,A=65535&s.high,k=s.low>>>16;return p=(k=((s=(65535&this.low)+(65535&s.low))>>>16)+(p+k))>>>16,ya((65535&k)<<16|65535&s,(o=((p+=l+A)>>>16)+(o+_)&65535)<<16|65535&p,this.unsigned)},D.subtract=function(s){return mb(s)||(s=Wb(s)),this.add(s.neg())},D.sub=D.subtract,D.multiply=function(s){if(this.isZero())return Hb;if(mb(s)||(s=Wb(s)),Qb){var o=Qb.mul(this.low,this.high,s.low,s.high);return ya(o,Qb.get_high(),this.unsigned)}if(s.isZero())return Hb;if(this.eq(nb))return s.isOdd()?nb:Hb;if(s.eq(nb))return this.isOdd()?nb:Hb;if(this.isNegative())return s.isNegative()?this.neg().mul(s.neg()):this.neg().mul(s).neg();if(s.isNegative())return this.mul(s.neg()).neg();if(this.lt(wq)&&s.lt(wq))return Gb(this.toNumber()*s.toNumber(),this.unsigned);o=this.high>>>16;var l=65535&this.high,p=this.low>>>16,_=65535&this.low,A=s.high>>>16,k=65535&s.high,j=s.low>>>16,B=_*(s=65535&s.low),z=(B>>>16)+p*s,Vt=z>>>16;Vt+=(z=(65535&z)+_*j)>>>16;var _e=(Vt+=l*s)>>>16;return ya((65535&z)<<16|65535&B,(_e=(_e+=(Vt=(65535&Vt)+p*j)>>>16)+((Vt=(65535&Vt)+_*k)>>>16)+(o*s+l*j+p*k+_*A)&65535)<<16|65535&Vt,this.unsigned)},D.mul=D.multiply,D.divide=function(s){if(mb(s)||(s=Wb(s)),s.isZero())throw Error("division by zero");if(Qb)return this.unsigned||this.high!==-2147483648||s.low!==-1||s.high!==-1?ya(s=(this.unsigned?Qb.div_u:Qb.div_s)(this.low,this.high,s.low,s.high),Qb.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?Cd:Hb;if(this.unsigned){if(s.unsigned||(s=s.toUnsigned()),s.gt(this))return Cd;if(s.gt(this.shru(1)))return xq;var o=Cd}else{if(this.eq(nb)){if(s.eq(Ue)||s.eq(Kk))return nb;if(s.eq(nb))return Ue;var l=this.shr(1).div(s).shl(1);if(l.eq(Hb))return s.isNegative()?Ue:Kk;var p=this.sub(s.mul(l));return l.add(p.div(s))}if(s.eq(nb))return this.unsigned?Cd:Hb;if(this.isNegative())return s.isNegative()?this.neg().div(s.neg()):this.neg().div(s).neg();if(s.isNegative())return this.div(s.neg()).neg();o=Hb}for(p=this;p.gte(s);){l=Math.max(1,Math.floor(p.toNumber()/s.toNumber()));var _=Math.ceil(Math.log(l)/Math.LN2);_=48>=_?1:sg(2,_-48);for(var A=Gb(l),k=A.mul(s);k.isNegative()||k.gt(p);)k=(A=Gb(l-=_,this.unsigned)).mul(s);A.isZero()&&(A=Ue),o=o.add(A),p=p.sub(k)}return o},D.div=D.divide,D.modulo=function(s){return mb(s)||(s=Wb(s)),Qb?ya(s=(this.unsigned?Qb.rem_u:Qb.rem_s)(this.low,this.high,s.low,s.high),Qb.get_high(),this.unsigned):this.sub(this.div(s).mul(s))},D.mod=D.modulo,D.rem=D.modulo,D.not=function(){return ya(~this.low,~this.high,this.unsigned)},D.and=function(s){return mb(s)||(s=Wb(s)),ya(this.low&s.low,this.high&s.high,this.unsigned)},D.or=function(s){return mb(s)||(s=Wb(s)),ya(this.low|s.low,this.high|s.high,this.unsigned)},D.xor=function(s){return mb(s)||(s=Wb(s)),ya(this.low^s.low,this.high^s.high,this.unsigned)},D.shiftLeft=function(s){return mb(s)&&(s=s.toInt()),(s&=63)==0?this:32>s?ya(this.low<<s,this.high<<s|this.low>>>32-s,this.unsigned):ya(0,this.low<<s-32,this.unsigned)},D.shl=D.shiftLeft,D.shiftRight=function(s){return mb(s)&&(s=s.toInt()),(s&=63)==0?this:32>s?ya(this.low>>>s|this.high<<32-s,this.high>>s,this.unsigned):ya(this.high>>s-32,0<=this.high?0:-1,this.unsigned)},D.shr=D.shiftRight,D.shiftRightUnsigned=function(s){if(mb(s)&&(s=s.toInt()),(s&=63)===0)return this;var o=this.high;return 32>s?ya(this.low>>>s|o<<32-s,o>>>s,this.unsigned):ya(s===32?o:o>>>s-32,0,this.unsigned)},D.shru=D.shiftRightUnsigned,D.shr_u=D.shiftRightUnsigned,D.toSigned=function(){return this.unsigned?ya(this.low,this.high,!1):this},D.toUnsigned=function(){return this.unsigned?this:ya(this.low,this.high,!0)},D.toBytes=function(s){return s?this.toBytesLE():this.toBytesBE()},D.toBytesLE=function(){var s=this.high,o=this.low;return[255&o,o>>>8&255,o>>>16&255,o>>>24,255&s,s>>>8&255,s>>>16&255,s>>>24]},D.toBytesBE=function(){var s=this.high,o=this.low;return[s>>>24,s>>>16&255,s>>>8&255,255&s,o>>>24,o>>>16&255,o>>>8&255,255&o]},xa.fromBytes=function(s,o,l){return l?xa.fromBytesLE(s,o):xa.fromBytesBE(s,o)},xa.fromBytesLE=function(s,o){return new xa(s[0]|s[1]<<8|s[2]<<16|s[3]<<24,s[4]|s[5]<<8|s[6]<<16|s[7]<<24,o)},xa.fromBytesBE=function(s,o){return new xa(s[4]<<24|s[5]<<16|s[6]<<8|s[7],s[0]<<24|s[1]<<16|s[2]<<8|s[3],o)};var di=function(s,o){return(di=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var _ in p)p.hasOwnProperty(_)&&(l[_]=p[_])})(s,o)},Lk=!1,Ib={Promise:void 0,set useDeprecatedSynchronousErrorHandling(s){s?console.warn(`DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: 
`+Error().stack):Lk&&console.log("RxJS: Back to a better error behavior. Thank you. <3"),Lk=s},get useDeprecatedSynchronousErrorHandling(){return Lk}},Eh={closed:!0,next:function(s){},error:function(s){if(Ib.useDeprecatedSynchronousErrorHandling)throw s;me(s)},complete:function(){}},Jb=Array.isArray||function(s){return s&&typeof s.length=="number"},lf=function(){function s(o){return Error.call(this),this.message=o?o.length+` errors occurred during unsubscription:
`+o.map(function(l,p){return p+1+") "+l.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=o,this}return s.prototype=Object.create(Error.prototype),s}(),Oa=function(){function s(o){this.closed=!1,this._subscriptions=this._parentOrParents=null,o&&(this._ctorUnsubscribe=!0,this._unsubscribe=o)}return s.prototype.unsubscribe=function(){if(!this.closed){var o=this._parentOrParents,l=this._ctorUnsubscribe,p=this._unsubscribe,_=this._subscriptions;if(this.closed=!0,this._subscriptions=this._parentOrParents=null,o instanceof s)o.remove(this);else if(o!==null)for(var A=0;A<o.length;++A)o[A].remove(this);if(le(p)){l&&(this._unsubscribe=void 0);try{p.call(this)}catch(j){var k=j instanceof lf?Xl(j.errors):[j]}}if(Jb(_)){for(A=-1,o=_.length;++A<o;)if(ei(l=_[A]))try{l.unsubscribe()}catch(j){k=k||[],j instanceof lf?k=k.concat(Xl(j.errors)):k.push(j)}}if(k)throw new lf(k)}},s.prototype.add=function(o){var l=o;if(!o)return s.EMPTY;switch(X(o)){case"function":l=new s(o);case"object":if(l===this||l.closed||typeof l.unsubscribe!="function")return l;if(this.closed)return l.unsubscribe(),l;l instanceof s||(o=l,(l=new s)._subscriptions=[o]);break;default:throw Error("unrecognized teardown "+o+" added to Subscription.")}if((o=l._parentOrParents)===null)l._parentOrParents=this;else if(o instanceof s){if(o===this)return l;l._parentOrParents=[o,this]}else{if(o.indexOf(this)!==-1)return l;o.push(this)}return(o=this._subscriptions)===null?this._subscriptions=[l]:o.push(l),l},s.prototype.remove=function(o){var l=this._subscriptions;l&&(o=l.indexOf(o))!==-1&&l.splice(o,1)},s.EMPTY=function(o){return o.closed=!0,o}(new s),s}(),Fh=typeof Symbol=="function"?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random(),ia=function(s){function o(l,p,_){var A=s.call(this)||this;switch(A.syncErrorValue=null,A.syncErrorThrown=!1,A.syncErrorThrowable=!1,A.isStopped=!1,arguments.length){case 0:A.destination=Eh;break;case 1:if(!l){A.destination=Eh;break}if(X(l)==="object"){l instanceof o?(A.syncErrorThrowable=l.syncErrorThrowable,A.destination=l,l.add(A)):(A.syncErrorThrowable=!0,A.destination=new yq(A,l));break}default:A.syncErrorThrowable=!0,A.destination=new yq(A,l,p,_)}return A}return O(o,s),o.prototype[Fh]=function(){return this},o.create=function(l,p,_){return(l=new o(l,p,_)).syncErrorThrowable=!1,l},o.prototype.next=function(l){this.isStopped||this._next(l)},o.prototype.error=function(l){this.isStopped||(this.isStopped=!0,this._error(l))},o.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},o.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,s.prototype.unsubscribe.call(this))},o.prototype._next=function(l){this.destination.next(l)},o.prototype._error=function(l){this.destination.error(l),this.unsubscribe()},o.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},o.prototype._unsubscribeAndRecycle=function(){var l=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.isStopped=this.closed=!1,this._parentOrParents=l,this},o}(Oa),yq=function(s){function o(l,p,_,A){var k=s.call(this)||this;if(k._parentSubscriber=l,l=k,le(p))var j=p;else p&&(j=p.next,_=p.error,A=p.complete,p!==Eh&&(le((l=Object.create(p)).unsubscribe)&&k.add(l.unsubscribe.bind(l)),l.unsubscribe=k.unsubscribe.bind(k)));return k._context=l,k._next=j,k._error=_,k._complete=A,k}return O(o,s),o.prototype.next=function(l){if(!this.isStopped&&this._next){var p=this._parentSubscriber;Ib.useDeprecatedSynchronousErrorHandling&&p.syncErrorThrowable?this.__tryOrSetError(p,this._next,l)&&this.unsubscribe():this.__tryOrUnsub(this._next,l)}},o.prototype.error=function(l){if(!this.isStopped){var p=this._parentSubscriber,_=Ib.useDeprecatedSynchronousErrorHandling;if(this._error)_&&p.syncErrorThrowable?this.__tryOrSetError(p,this._error,l):this.__tryOrUnsub(this._error,l),this.unsubscribe();else if(p.syncErrorThrowable)_?(p.syncErrorValue=l,p.syncErrorThrown=!0):me(l),this.unsubscribe();else{if(this.unsubscribe(),_)throw l;me(l)}}},o.prototype.complete=function(){var l=this;if(!this.isStopped){var p=this._parentSubscriber;if(this._complete){var _=function(){return l._complete.call(l._context)};Ib.useDeprecatedSynchronousErrorHandling&&p.syncErrorThrowable?this.__tryOrSetError(p,_):this.__tryOrUnsub(_)}this.unsubscribe()}},o.prototype.__tryOrUnsub=function(l,p){try{l.call(this._context,p)}catch(_){if(this.unsubscribe(),Ib.useDeprecatedSynchronousErrorHandling)throw _;me(_)}},o.prototype.__tryOrSetError=function(l,p,_){if(!Ib.useDeprecatedSynchronousErrorHandling)throw Error("bad call");try{p.call(this._context,_)}catch(A){return Ib.useDeprecatedSynchronousErrorHandling?(l.syncErrorValue=A,l.syncErrorThrown=!0):me(A),!0}return!1},o.prototype._unsubscribe=function(){var l=this._parentSubscriber;this._parentSubscriber=this._context=null,l.unsubscribe()},o}(ia),ne=typeof Symbol=="function"&&Symbol.observable||"@@observable",Y=function(){function s(o){this._isScalar=!1,o&&(this._subscribe=o)}return s.prototype.lift=function(o){var l=new s;return l.source=this,l.operator=o,l},s.prototype.subscribe=function(o,l,p){var _=this.operator;t:{if(o){if(o instanceof ia)break t;if(o[Fh]){o=o[Fh]();break t}}o=o||l||p?new ia(o,l,p):new ia(Eh)}if(_?o.add(_.call(o,this.source)):o.add(this.source||Ib.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),Ib.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},s.prototype._trySubscribe=function(o){try{return this._subscribe(o)}catch(l){Ib.useDeprecatedSynchronousErrorHandling&&(o.syncErrorThrown=!0,o.syncErrorValue=l),fi(o)?o.error(l):console.warn(l)}},s.prototype.forEach=function(o,l){var p=this;return new(l=Zl(l))(function(_,A){var k=p.subscribe(function(j){try{o(j)}catch(B){A(B),k&&k.unsubscribe()}},A,_)})},s.prototype._subscribe=function(o){var l=this.source;return l&&l.subscribe(o)},s.prototype[ne]=function(){return this},s.prototype.pipe=function(){for(var o=[],l=0;l<arguments.length;l++)o[l]=arguments[l];return o.length===0?this:Yl(o)(this)},s.prototype.toPromise=function(o){var l=this;return new(o=Zl(o))(function(p,_){var A;l.subscribe(function(k){return A=k},function(k){return _(k)},function(){return p(A)})})},s.create=function(o){return new s(o)},s}(),qd=function(){function s(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return s.prototype=Object.create(Error.prototype),s}(),zq=function(s){function o(l,p){var _=s.call(this)||this;return _.subject=l,_.subscriber=p,_.closed=!1,_}return O(o,s),o.prototype.unsubscribe=function(){if(!this.closed){this.closed=!0;var l=this.subject,p=l.observers;this.subject=null,!p||p.length===0||l.isStopped||l.closed||(l=p.indexOf(this.subscriber))!==-1&&p.splice(l,1)}},o}(Oa),Aq=function(s){function o(l){var p=s.call(this,l)||this;return p.destination=l,p}return O(o,s),o}(ia),Pa=function(s){function o(){var l=s.call(this)||this;return l.observers=[],l.closed=!1,l.isStopped=!1,l.hasError=!1,l.thrownError=null,l}return O(o,s),o.prototype[Fh]=function(){return new Aq(this)},o.prototype.lift=function(l){var p=new Bq(this,this);return p.operator=l,p},o.prototype.next=function(l){if(this.closed)throw new qd;if(!this.isStopped){var p=this.observers,_=p.length;p=p.slice();for(var A=0;A<_;A++)p[A].next(l)}},o.prototype.error=function(l){if(this.closed)throw new qd;this.hasError=!0,this.thrownError=l,this.isStopped=!0;var p=this.observers,_=p.length;p=p.slice();for(var A=0;A<_;A++)p[A].error(l);this.observers.length=0},o.prototype.complete=function(){if(this.closed)throw new qd;this.isStopped=!0;var l=this.observers,p=l.length;l=l.slice();for(var _=0;_<p;_++)l[_].complete();this.observers.length=0},o.prototype.unsubscribe=function(){this.closed=this.isStopped=!0,this.observers=null},o.prototype._trySubscribe=function(l){if(this.closed)throw new qd;return s.prototype._trySubscribe.call(this,l)},o.prototype._subscribe=function(l){if(this.closed)throw new qd;return this.hasError?(l.error(this.thrownError),Oa.EMPTY):this.isStopped?(l.complete(),Oa.EMPTY):(this.observers.push(l),new zq(this,l))},o.prototype.asObservable=function(){var l=new Y;return l.source=this,l},o.create=function(l,p){return new Bq(l,p)},o}(Y),Bq=function(s){function o(l,p){var _=s.call(this)||this;return _.destination=l,_.source=p,_}return O(o,s),o.prototype.next=function(l){var p=this.destination;p&&p.next&&p.next(l)},o.prototype.error=function(l){var p=this.destination;p&&p.error&&this.destination.error(l)},o.prototype.complete=function(){var l=this.destination;l&&l.complete&&this.destination.complete()},o.prototype._subscribe=function(l){return this.source?this.source.subscribe(l):Oa.EMPTY},o}(Pa),Ns=function(){function s(o){this.connectable=o}return s.prototype.call=function(o,l){var p=this.connectable;return p._refCount++,o=new cz(o,p),l=l.subscribe(o),o.closed||(o.connection=p.connect()),l},s}(),cz=function(s){function o(l,p){return(l=s.call(this,l)||this).connectable=p,l}return O(o,s),o.prototype._unsubscribe=function(){var l=this.connectable;if(l){this.connectable=null;var p=l._refCount;0>=p?this.connection=null:(l._refCount=p-1,1<p?this.connection=null:(p=this.connection,l=l._connection,this.connection=null,!l||p&&l!==p||l.unsubscribe()))}else this.connection=null},o}(ia),Cq=function(s){function o(l,p){var _=s.call(this)||this;return _.source=l,_.subjectFactory=p,_._refCount=0,_._isComplete=!1,_}return O(o,s),o.prototype._subscribe=function(l){return this.getSubject().subscribe(l)},o.prototype.getSubject=function(){var l=this._subject;return l&&!l.isStopped||(this._subject=this.subjectFactory()),this._subject},o.prototype.connect=function(){var l=this._connection;return l||(this._isComplete=!1,(l=this._connection=new Oa).add(this.source.subscribe(new dz(this.getSubject(),this))),l.closed&&(this._connection=null,l=Oa.EMPTY)),l},o.prototype.refCount=function(){return $l()(this)},o}(Y),At=function(){var s=Cq.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:s._subscribe},_isComplete:{value:s._isComplete,writable:!0},getSubject:{value:s.getSubject},connect:{value:s.connect},refCount:{value:s.refCount}}}(),dz=function(s){function o(l,p){return(l=s.call(this,l)||this).connectable=p,l}return O(o,s),o.prototype._error=function(l){this._unsubscribe(),s.prototype._error.call(this,l)},o.prototype._complete=function(){this.connectable._isComplete=!0,this._unsubscribe(),s.prototype._complete.call(this)},o.prototype._unsubscribe=function(){var l=this.connectable;if(l){this.connectable=null;var p=l._connection;l._refCount=0,l._subject=null,l._connection=null,p&&p.unsubscribe()}},o}(Aq);(function(s){function o(l,p){return(l=s.call(this,l)||this).connectable=p,l}O(o,s),o.prototype._unsubscribe=function(){var l=this.connectable;if(l){this.connectable=null;var p=l._refCount;0>=p?this.connection=null:(l._refCount=p-1,1<p?this.connection=null:(p=this.connection,l=l._connection,this.connection=null,!l||p&&l!==p||l.unsubscribe()))}else this.connection=null}})(ia),function(s){function o(l,p,_,A,k){return(l=s.call(this,l)||this).keySelector=p,l.elementSelector=_,l.durationSelector=A,l.subjectSelector=k,l.groups=null,l.attemptedToUnsubscribe=!1,l.count=0,l}O(o,s),o.prototype._next=function(l){try{var p=this.keySelector(l)}catch(_){return void this.error(_)}this._group(l,p)},o.prototype._group=function(l,p){var _=this.groups;_||(_=this.groups=new Map);var A=_.get(p);if(this.elementSelector)try{var k=this.elementSelector(l)}catch(j){this.error(j)}else k=l;if(!A&&(A=this.subjectSelector?this.subjectSelector():new Pa,_.set(p,A),l=new Mk(p,A,this),this.destination.next(l),this.durationSelector)){l=void 0;try{l=this.durationSelector(new Mk(p,A))}catch(j){return void this.error(j)}this.add(l.subscribe(new ez(p,A,this)))}A.closed||A.next(k)},o.prototype._error=function(l){var p=this.groups;p&&(p.forEach(function(_,A){_.error(l)}),p.clear()),this.destination.error(l)},o.prototype._complete=function(){var l=this.groups;l&&(l.forEach(function(p,_){p.complete()}),l.clear()),this.destination.complete()},o.prototype.removeGroup=function(l){this.groups.delete(l)},o.prototype.unsubscribe=function(){this.closed||(this.attemptedToUnsubscribe=!0,this.count===0&&s.prototype.unsubscribe.call(this))}}(ia);var ez=function(s){function o(l,p,_){var A=s.call(this,p)||this;return A.key=l,A.group=p,A.parent=_,A}return O(o,s),o.prototype._next=function(l){this.complete()},o.prototype._unsubscribe=function(){var l=this.parent,p=this.key;this.key=this.parent=null,l&&l.removeGroup(p)},o}(ia),Mk=function(s){function o(l,p,_){var A=s.call(this)||this;return A.key=l,A.groupSubject=p,A.refCountSubscription=_,A}return O(o,s),o.prototype._subscribe=function(l){var p=new Oa,_=this.refCountSubscription,A=this.groupSubject;return _&&!_.closed&&p.add(new fz(_)),p.add(A.subscribe(l)),p},o}(Y),fz=function(s){function o(l){var p=s.call(this)||this;return p.parent=l,l.count++,p}return O(o,s),o.prototype.unsubscribe=function(){var l=this.parent;l.closed||this.closed||(s.prototype.unsubscribe.call(this),--l.count,l.count===0&&l.attemptedToUnsubscribe&&l.unsubscribe())},o}(Oa),gz=function(s){function o(l){var p=s.call(this)||this;return p._value=l,p}return O(o,s),Object.defineProperty(o.prototype,"value",{get:function(){return this.getValue()},enumerable:!0,configurable:!0}),o.prototype._subscribe=function(l){var p=s.prototype._subscribe.call(this,l);return p&&!p.closed&&l.next(this._value),p},o.prototype.getValue=function(){if(this.hasError)throw this.thrownError;if(this.closed)throw new qd;return this._value},o.prototype.next=function(l){s.prototype.next.call(this,this._value=l)},o}(Pa),dg=function(s){function o(l,p){var _=s.call(this,l,p)||this;return _.scheduler=l,_.work=p,_.pending=!1,_}return O(o,s),o.prototype.schedule=function(l,p){if(p===void 0&&(p=0),this.closed)return this;this.state=l,l=this.id;var _=this.scheduler;return l!=null&&(this.id=this.recycleAsyncId(_,l,p)),this.pending=!0,this.delay=p,this.id=this.id||this.requestAsyncId(_,this.id,p),this},o.prototype.requestAsyncId=function(l,p,_){return _===void 0&&(_=0),setInterval(l.flush.bind(l,this),_)},o.prototype.recycleAsyncId=function(l,p,_){if(_===void 0&&(_=0),_!==null&&this.delay===_&&this.pending===!1)return p;clearInterval(p)},o.prototype.execute=function(l,p){return this.closed?Error("executing a cancelled action"):(this.pending=!1,(l=this._execute(l,p))?l:void(this.pending===!1&&this.id!=null&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))))},o.prototype._execute=function(l,p){p=!1;var _=void 0;try{this.work(l)}catch(A){p=!0,_=!!A&&A||Error(A)}if(p)return this.unsubscribe(),_},o.prototype._unsubscribe=function(){var l=this.id,p=this.scheduler,_=p.actions,A=_.indexOf(this);this.state=this.work=null,this.pending=!1,this.scheduler=null,A!==-1&&_.splice(A,1),l!=null&&(this.id=this.recycleAsyncId(p,l,null)),this.delay=null},o}(function(s){function o(l,p){return s.call(this)||this}return O(o,s),o.prototype.schedule=function(l,p){return this},o}(Oa)),hz=function(s){function o(l,p){var _=s.call(this,l,p)||this;return _.scheduler=l,_.work=p,_}return O(o,s),o.prototype.schedule=function(l,p){return p===void 0&&(p=0),0<p?s.prototype.schedule.call(this,l,p):(this.delay=p,this.state=l,this.scheduler.flush(this),this)},o.prototype.execute=function(l,p){return 0<p||this.closed?s.prototype.execute.call(this,l,p):this._execute(l,p)},o.prototype.requestAsyncId=function(l,p,_){return _===void 0&&(_=0),_!==null&&0<_||_===null&&0<this.delay?s.prototype.requestAsyncId.call(this,l,p,_):l.flush(this)},o}(dg),Nk=function(){function s(o,l){l===void 0&&(l=s.now),this.SchedulerAction=o,this.now=l}return s.prototype.schedule=function(o,l,p){return l===void 0&&(l=0),new this.SchedulerAction(this,o).schedule(p,l)},s.now=function(){return Date.now()},s}(),eg=function(s){function o(l,p){p===void 0&&(p=Nk.now);var _=s.call(this,l,function(){return o.delegate&&o.delegate!==_?o.delegate.now():p()})||this;return _.actions=[],_.active=!1,_.scheduled=void 0,_}return O(o,s),o.prototype.schedule=function(l,p,_){return p===void 0&&(p=0),o.delegate&&o.delegate!==this?o.delegate.schedule(l,p,_):s.prototype.schedule.call(this,l,p,_)},o.prototype.flush=function(l){var p=this.actions;if(this.active)p.push(l);else{var _;this.active=!0;do if(_=l.execute(l.state,l.delay))break;while(l=p.shift());if(this.active=!1,_){for(;l=p.shift();)l.unsubscribe();throw _}}},o}(Nk),fg=new(function(s){function o(){return s!==null&&s.apply(this,arguments)||this}return O(o,s),o}(eg))(hz),vb=new Y(function(s){return s.complete()}),am=function(s){return function(o){for(var l=0,p=s.length;l<p&&!o.closed;l++)o.next(s[l]);o.complete()}},Ok;(function(s){s.NEXT="N",s.ERROR="E",s.COMPLETE="C"})(Ok||(Ok={}));var Ve=function(){function s(o,l,p){this.kind=o,this.value=l,this.error=p,this.hasValue=o==="N"}return s.prototype.observe=function(o){switch(this.kind){case"N":return o.next&&o.next(this.value);case"E":return o.error&&o.error(this.error);case"C":return o.complete&&o.complete()}},s.prototype.do=function(o,l,p){switch(this.kind){case"N":return o&&o(this.value);case"E":return l&&l(this.error);case"C":return p&&p()}},s.prototype.accept=function(o,l,p){return o&&typeof o.next=="function"?this.observe(o):this.do(o,l,p)},s.prototype.toObservable=function(){switch(this.kind){case"N":return bb(this.value);case"E":return Z(this.error);case"C":return mf()}throw Error("unexpected notification kind value")},s.createNext=function(o){return o!==void 0?new s("N",o):s.undefinedValueNotification},s.createError=function(o){return new s("E",void 0,o)},s.createComplete=function(){return s.completeNotification},s.completeNotification=new s("C"),s.undefinedValueNotification=new s("N",void 0),s}(),Rs=function(){function s(o,l){l===void 0&&(l=0),this.scheduler=o,this.delay=l}return s.prototype.call=function(o,l){return l.subscribe(new Dq(o,this.scheduler,this.delay))},s}(),Dq=function(s){function o(l,p,_){return _===void 0&&(_=0),(l=s.call(this,l)||this).scheduler=p,l.delay=_,l}return O(o,s),o.dispatch=function(l){l.notification.observe(l.destination),this.unsubscribe()},o.prototype.scheduleMessage=function(l){this.destination.add(this.scheduler.schedule(o.dispatch,this.delay,new iz(l,this.destination)))},o.prototype._next=function(l){this.scheduleMessage(Ve.createNext(l))},o.prototype._error=function(l){this.scheduleMessage(Ve.createError(l)),this.unsubscribe()},o.prototype._complete=function(){this.scheduleMessage(Ve.createComplete()),this.unsubscribe()},o}(ia),iz=function(s,o){this.notification=s,this.destination=o},qe=function(s){function o(l,p,_){l===void 0&&(l=Number.POSITIVE_INFINITY),p===void 0&&(p=Number.POSITIVE_INFINITY);var A=s.call(this)||this;return A.scheduler=_,A._events=[],A._infiniteTimeWindow=!1,A._bufferSize=1>l?1:l,A._windowTime=1>p?1:p,p===Number.POSITIVE_INFINITY?(A._infiniteTimeWindow=!0,A.next=A.nextInfiniteTimeWindow):A.next=A.nextTimeWindow,A}return O(o,s),o.prototype.nextInfiniteTimeWindow=function(l){if(!this.isStopped){var p=this._events;p.push(l),p.length>this._bufferSize&&p.shift()}s.prototype.next.call(this,l)},o.prototype.nextTimeWindow=function(l){this.isStopped||(this._events.push(new jz(this._getNow(),l)),this._trimBufferThenGetEvents()),s.prototype.next.call(this,l)},o.prototype._subscribe=function(l){var p=this._infiniteTimeWindow,_=p?this._events:this._trimBufferThenGetEvents(),A=this.scheduler,k=_.length;if(this.closed)throw new qd;if(this.isStopped||this.hasError)var j=Oa.EMPTY;else this.observers.push(l),j=new zq(this,l);if(A&&l.add(l=new Dq(l,A)),p)for(p=0;p<k&&!l.closed;p++)l.next(_[p]);else for(p=0;p<k&&!l.closed;p++)l.next(_[p].value);return this.hasError?l.error(this.thrownError):this.isStopped&&l.complete(),j},o.prototype._getNow=function(){return(this.scheduler||fg).now()},o.prototype._trimBufferThenGetEvents=function(){for(var l=this._getNow(),p=this._bufferSize,_=this._windowTime,A=this._events,k=A.length,j=0;j<k&&!(l-A[j].time<_);)j++;return k>p&&(j=Math.max(j,k-p)),0<j&&A.splice(0,j),A},o}(Pa),jz=function(s,o){this.time=s,this.value=o},of=function(s){function o(){var l=s!==null&&s.apply(this,arguments)||this;return l.value=null,l.hasNext=!1,l.hasCompleted=!1,l}return O(o,s),o.prototype._subscribe=function(l){return this.hasError?(l.error(this.thrownError),Oa.EMPTY):this.hasCompleted&&this.hasNext?(l.next(this.value),l.complete(),Oa.EMPTY):s.prototype._subscribe.call(this,l)},o.prototype.next=function(l){this.hasCompleted||(this.value=l,this.hasNext=!0)},o.prototype.error=function(l){this.hasCompleted||s.prototype.error.call(this,l)},o.prototype.complete=function(){this.hasCompleted=!0,this.hasNext&&s.prototype.next.call(this,this.value),s.prototype.complete.call(this)},o}(Pa),kz=1,lz=Promise.resolve(),ii={},Eq={setImmediate:function(s){var o=kz++;return ii[o]=!0,lz.then(function(){return bm(o)&&s()}),o},clearImmediate:function(s){bm(s)}},mz=function(s){function o(l,p){var _=s.call(this,l,p)||this;return _.scheduler=l,_.work=p,_}return O(o,s),o.prototype.requestAsyncId=function(l,p,_){return _===void 0&&(_=0),_!==null&&0<_?s.prototype.requestAsyncId.call(this,l,p,_):(l.actions.push(this),l.scheduled||(l.scheduled=Eq.setImmediate(l.flush.bind(l,null))))},o.prototype.recycleAsyncId=function(l,p,_){if(_===void 0&&(_=0),_!==null&&0<_||_===null&&0<this.delay)return s.prototype.recycleAsyncId.call(this,l,p,_);l.actions.length===0&&(Eq.clearImmediate(p),l.scheduled=void 0)},o}(dg),ri=new(function(s){function o(){return s!==null&&s.apply(this,arguments)||this}return O(o,s),o.prototype.flush=function(l){this.active=!0,this.scheduled=void 0;var p,_=this.actions,A=-1,k=_.length;l=l||_.shift();do if(p=l.execute(l.state,l.delay))break;while(++A<k&&(l=_.shift()));if(this.active=!1,p){for(;++A<k&&(l=_.shift());)l.unsubscribe();throw p}},o}(eg))(mz),nz=ri,Pk=new eg(dg),bd=Pk,oz=function(s){function o(l,p){var _=s.call(this,l,p)||this;return _.scheduler=l,_.work=p,_}return O(o,s),o.prototype.requestAsyncId=function(l,p,_){return _===void 0&&(_=0),_!==null&&0<_?s.prototype.requestAsyncId.call(this,l,p,_):(l.actions.push(this),l.scheduled||(l.scheduled=requestAnimationFrame(function(){return l.flush(null)})))},o.prototype.recycleAsyncId=function(l,p,_){if(_===void 0&&(_=0),_!==null&&0<_||_===null&&0<this.delay)return s.prototype.recycleAsyncId.call(this,l,p,_);l.actions.length===0&&(cancelAnimationFrame(p),l.scheduled=void 0)},o}(dg),Fq=new(function(s){function o(){return s!==null&&s.apply(this,arguments)||this}return O(o,s),o.prototype.flush=function(l){this.active=!0,this.scheduled=void 0;var p,_=this.actions,A=-1,k=_.length;l=l||_.shift();do if(p=l.execute(l.state,l.delay))break;while(++A<k&&(l=_.shift()));if(this.active=!1,p){for(;++A<k&&(l=_.shift());)l.unsubscribe();throw p}},o}(eg))(oz),pz=function(s){function o(l,p){l===void 0&&(l=Gq),p===void 0&&(p=Number.POSITIVE_INFINITY);var _=s.call(this,l,function(){return _.frame})||this;return _.maxFrames=p,_.frame=0,_.index=-1,_}return O(o,s),o.prototype.flush=function(){for(var l,p,_=this.actions,A=this.maxFrames;(p=_[0])&&p.delay<=A&&(_.shift(),this.frame=p.delay,!(l=p.execute(p.state,p.delay))););if(l){for(;p=_.shift();)p.unsubscribe();throw l}},o.frameTimeFactor=10,o}(eg),Gq=function(s){function o(l,p,_){_===void 0&&(_=l.index+=1);var A=s.call(this,l,p)||this;return A.scheduler=l,A.work=p,A.index=_,A.active=!0,A.index=l.index=_,A}return O(o,s),o.prototype.schedule=function(l,p){if(p===void 0&&(p=0),!this.id)return s.prototype.schedule.call(this,l,p);this.active=!1;var _=new o(this.scheduler,this.work);return this.add(_),_.schedule(l,p)},o.prototype.requestAsyncId=function(l,p,_){return _===void 0&&(_=0),this.delay=l.frame+_,(l=l.actions).push(this),l.sort(o.sortActions),!0},o.prototype.recycleAsyncId=function(l,p,_){},o.prototype._execute=function(l,p){if(this.active===!0)return s.prototype._execute.call(this,l,p)},o.sortActions=function(l,p){return l.delay===p.delay?l.index===p.index?0:l.index>p.index?1:-1:l.delay>p.delay?1:-1},o}(dg),Qk=function(){function s(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return s.prototype=Object.create(Error.prototype),s}(),vg=function(){function s(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return s.prototype=Object.create(Error.prototype),s}(),pb=function(){function s(){return Error.call(this),this.message="Timeout has occurred",this.name="TimeoutError",this}return s.prototype=Object.create(Error.prototype),s}(),Ss=function(){function s(o,l){this.project=o,this.thisArg=l}return s.prototype.call=function(o,l){return l.subscribe(new qz(o,this.project,this.thisArg))},s}(),qz=function(s){function o(l,p,_){return(l=s.call(this,l)||this).project=p,l.count=0,l.thisArg=_||l,l}return O(o,s),o.prototype._next=function(l){try{var p=this.project.call(this.thisArg,l,this.count++)}catch(_){return void this.destination.error(_)}this.destination.next(p)},o}(ia),Rk=function(s){function o(){return s!==null&&s.apply(this,arguments)||this}return O(o,s),o.prototype.notifyNext=function(l,p,_,A,k){this.destination.next(p)},o.prototype.notifyError=function(l,p){this.destination.error(l)},o.prototype.notifyComplete=function(l){this.destination.complete()},o}(ia),Xs=function(s){function o(l,p,_){var A=s.call(this)||this;return A.parent=l,A.outerValue=p,A.outerIndex=_,A.index=0,A}return O(o,s),o.prototype._next=function(l){this.parent.notifyNext(this.outerValue,l,this.outerIndex,this.index++,this)},o.prototype._error=function(l){this.parent.notifyError(l,this),this.unsubscribe()},o.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},o}(ia),rz=function(s){return function(o){return s.then(function(l){o.closed||(o.next(l),o.complete())},function(l){return o.error(l)}).then(null,me),o}},$c=typeof Symbol=="function"&&Symbol.iterator?Symbol.iterator:"@@iterator",sz=function(s){return function(o){for(var l=s[$c]();;){var p=void 0;try{p=l.next()}catch(_){return o.error(_),o}if(p.done){o.complete();break}if(o.next(p.value),o.closed)break}return typeof l.return=="function"&&o.add(function(){l.return&&l.return()}),o}},tz=function(s){return function(o){var l=s[ne]();if(typeof l.subscribe!="function")throw new TypeError("Provided object does not correctly implement Symbol.observable");return l.subscribe(o)}},hm=function(s){return s&&typeof s.length=="number"&&typeof s!="function"},pf=function(s){if(s&&typeof s[ne]=="function")return tz(s);if(hm(s))return am(s);if(fm(s))return rz(s);if(s&&typeof s[$c]=="function")return sz(s);throw s=ei(s)?"an invalid object":"'"+s+"'",new TypeError("You provided "+s+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")},Hq={},vz=function(){function s(o){this.resultSelector=o}return s.prototype.call=function(o,l){return l.subscribe(new uz(o,this.resultSelector))},s}(),uz=function(s){function o(l,p){return(l=s.call(this,l)||this).resultSelector=p,l.active=0,l.values=[],l.observables=[],l}return O(o,s),o.prototype._next=function(l){this.values.push(Hq),this.observables.push(l)},o.prototype._complete=function(){var l=this.observables,p=l.length;if(p===0)this.destination.complete();else{this.toRespond=this.active=p;for(var _=0;_<p;_++)this.add(ji(this,l[_],void 0,_))}},o.prototype.notifyComplete=function(l){--this.active==0&&this.destination.complete()},o.prototype.notifyNext=function(l,p,_){var A=(l=this.values)[_];A=this.toRespond?A===Hq?--this.toRespond:this.toRespond:0,l[_]=p,A===0&&(this.resultSelector?this._tryResultSelector(l):this.destination.next(l.slice()))},o.prototype._tryResultSelector=function(l){try{var p=this.resultSelector.apply(this,l)}catch(_){return void this.destination.error(_)}this.destination.next(p)},o}(Rk),vc=function(s){function o(l){var p=s.call(this)||this;return p.parent=l,p}return O(o,s),o.prototype._next=function(l){this.parent.notifyNext(l)},o.prototype._error=function(l){this.parent.notifyError(l),this.unsubscribe()},o.prototype._complete=function(){this.parent.notifyComplete(),this.unsubscribe()},o}(ia);(function(s){function o(l,p,_){var A=s.call(this)||this;return A.parent=l,A.outerValue=p,A.outerIndex=_,A}O(o,s),o.prototype._next=function(l){this.parent.notifyNext(this.outerValue,l,this.outerIndex,this)},o.prototype._error=function(l){this.parent.notifyError(l),this.unsubscribe()},o.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()}})(ia);var wc=function(s){function o(){return s!==null&&s.apply(this,arguments)||this}return O(o,s),o.prototype.notifyNext=function(l){this.destination.next(l)},o.prototype.notifyError=function(l){this.destination.error(l)},o.prototype.notifyComplete=function(){this.destination.complete()},o}(ia);(function(s){function o(){return s!==null&&s.apply(this,arguments)||this}O(o,s),o.prototype.notifyNext=function(l,p,_,A){this.destination.next(p)},o.prototype.notifyError=function(l){this.destination.error(l)},o.prototype.notifyComplete=function(l){this.destination.complete()}})(ia);var at=function(){function s(o,l){l===void 0&&(l=Number.POSITIVE_INFINITY),this.project=o,this.concurrent=l}return s.prototype.call=function(o,l){return l.subscribe(new wz(o,this.project,this.concurrent))},s}(),wz=function(s){function o(l,p,_){return _===void 0&&(_=Number.POSITIVE_INFINITY),(l=s.call(this,l)||this).project=p,l.concurrent=_,l.hasCompleted=!1,l.buffer=[],l.active=0,l.index=0,l}return O(o,s),o.prototype._next=function(l){this.active<this.concurrent?this._tryNext(l):this.buffer.push(l)},o.prototype._tryNext=function(l){var p=this.index++;try{var _=this.project(l,p)}catch(A){return void this.destination.error(A)}this.active++,this._innerSub(_)},o.prototype._innerSub=function(l){var p=new vc(this),_=this.destination;_.add(p),(l=ic(l,p))!==p&&_.add(l)},o.prototype._complete=function(){this.hasCompleted=!0,this.active===0&&this.buffer.length===0&&this.destination.complete(),this.unsubscribe()},o.prototype.notifyNext=function(l){this.destination.next(l)},o.prototype.notifyComplete=function(){var l=this.buffer;this.active--,0<l.length?this._next(l.shift()):this.active===0&&this.hasCompleted&&this.destination.complete()},o}(wc),Sk=y.parseFloat,Iq=1/Sk(`	
\v\f\r                　\u2028\u2029\uFEFF-0`)!=-1/0?function(s){s=ik(String(s));var o=Sk(s);return o===0&&s.charAt(0)=="-"?-0:o}:Sk;N({global:!0,forced:parseFloat!=Iq},{parseFloat:Iq});var Tk=new Y(hc),ft=function(){function s(o,l){this.predicate=o,this.thisArg=l}return s.prototype.call=function(o,l){return l.subscribe(new xz(o,this.predicate,this.thisArg))},s}(),xz=function(s){function o(l,p,_){return(l=s.call(this,l)||this).predicate=p,l.thisArg=_,l.count=0,l}return O(o,s),o.prototype._next=function(l){try{var p=this.predicate.call(this.thisArg,l,this.count++)}catch(_){return void this.destination.error(_)}p&&this.destination.next(l)},o}(ia),gt=function(){function s(){}return s.prototype.call=function(o,l){return l.subscribe(new yz(o))},s}(),yz=function(s){function o(l){return(l=s.call(this,l)||this).hasFirst=!1,l.observables=[],l.subscriptions=[],l}return O(o,s),o.prototype._next=function(l){this.observables.push(l)},o.prototype._complete=function(){var l=this.observables,p=l.length;if(p===0)this.destination.complete();else{for(var _=0;_<p&&!this.hasFirst;_++){var A=ji(this,l[_],void 0,_);this.subscriptions&&this.subscriptions.push(A),this.add(A)}this.observables=null}},o.prototype.notifyNext=function(l,p,_){if(!this.hasFirst){for(this.hasFirst=!0,l=0;l<this.subscriptions.length;l++)if(l!==_){var A=this.subscriptions[l];A.unsubscribe(),this.remove(A)}this.subscriptions=null}this.destination.next(p)},o}(Rk),jt=function(){function s(o){this.resultSelector=o}return s.prototype.call=function(o,l){return l.subscribe(new zz(o,this.resultSelector))},s}(),zz=function(s){function o(l,p,_){return(l=s.call(this,l)||this).resultSelector=p,l.iterators=[],l.active=0,l.resultSelector=typeof p=="function"?p:void 0,l}return O(o,s),o.prototype._next=function(l){var p=this.iterators;Jb(l)?p.push(new Az(l)):typeof l[$c]=="function"?p.push(new Bz(l[$c]())):p.push(new Cz(this.destination,this,l))},o.prototype._complete=function(){var l=this.iterators,p=l.length;if(this.unsubscribe(),p===0)this.destination.complete();else{this.active=p;for(var _=0;_<p;_++){var A=l[_];A.stillUnsubscribed?this.destination.add(A.subscribe()):this.active--}}},o.prototype.notifyInactive=function(){this.active--,this.active===0&&this.destination.complete()},o.prototype.checkIterators=function(){for(var l=this.iterators,p=l.length,_=this.destination,A=0;A<p;A++){var k=l[A];if(typeof k.hasValue=="function"&&!k.hasValue())return}var j=!1,B=[];for(A=0;A<p;A++){var z=(k=l[A]).next();if(k.hasCompleted()&&(j=!0),z.done)return void _.complete();B.push(z.value)}this.resultSelector?this._tryresultSelector(B):_.next(B),j&&_.complete()},o.prototype._tryresultSelector=function(l){try{var p=this.resultSelector.apply(this,l)}catch(_){return void this.destination.error(_)}this.destination.next(p)},o}(ia),Bz=function(){function s(o){this.iterator=o,this.nextResult=o.next()}return s.prototype.hasValue=function(){return!0},s.prototype.next=function(){var o=this.nextResult;return this.nextResult=this.iterator.next(),o},s.prototype.hasCompleted=function(){var o=this.nextResult;return!(!o||!o.done)},s}(),Az=function(){function s(o){this.array=o,this.length=this.index=0,this.length=o.length}return s.prototype[$c]=function(){return this},s.prototype.next=function(o){o=this.index++;var l=this.array;return o<this.length?{value:l[o],done:!1}:{value:null,done:!0}},s.prototype.hasValue=function(){return this.array.length>this.index},s.prototype.hasCompleted=function(){return this.array.length===this.index},s}(),Cz=function(s){function o(l,p,_){return(l=s.call(this,l)||this).parent=p,l.observable=_,l.stillUnsubscribed=!0,l.buffer=[],l.isComplete=!1,l}return O(o,s),o.prototype[$c]=function(){return this},o.prototype.next=function(){var l=this.buffer;return l.length===0&&this.isComplete?{value:null,done:!0}:{value:l.shift(),done:!1}},o.prototype.hasValue=function(){return 0<this.buffer.length},o.prototype.hasCompleted=function(){return this.buffer.length===0&&this.isComplete},o.prototype.notifyComplete=function(){0<this.buffer.length?(this.isComplete=!0,this.parent.notifyInactive()):this.destination.complete()},o.prototype.notifyNext=function(l){this.buffer.push(l),this.parent.checkIterators()},o.prototype.subscribe=function(){return ic(this.observable,new vc(this))},o}(wc),Dz=Object.freeze({__proto__:null,Observable:Y,ConnectableObservable:Cq,GroupedObservable:Mk,observable:ne,Subject:Pa,BehaviorSubject:gz,ReplaySubject:qe,AsyncSubject:of,asap:nz,asapScheduler:ri,async:bd,asyncScheduler:Pk,queue:fg,queueScheduler:fg,animationFrame:Fq,animationFrameScheduler:Fq,VirtualTimeScheduler:pz,VirtualAction:Gq,Scheduler:Nk,Subscription:Oa,Subscriber:ia,Notification:Ve,get NotificationKind(){return Ok},pipe:gi,noop:hc,identity:Yc,isObservable:function(s){return!!s&&(s instanceof Y||typeof s.lift=="function"&&typeof s.subscribe=="function")},ArgumentOutOfRangeError:Qk,EmptyError:vg,ObjectUnsubscribedError:qd,UnsubscriptionError:lf,TimeoutError:pb,bindCallback:cm,bindNodeCallback:dm,combineLatest:function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];var l=o=void 0;return Zc(s[s.length-1])&&(l=s.pop()),typeof s[s.length-1]=="function"&&(o=s.pop()),s.length===1&&Jb(s[0])&&(s=s[0]),nf(s,l).lift(new vz(o))},concat:im,defer:ad,empty:mf,forkJoin:jm,from:Kb,fromEvent:gb,fromEventPattern:lm,generate:function(s,o,l,p,_){if(arguments.length==1){var A=s.initialState;o=s.condition,l=s.iterate;var k=s.resultSelector||Yc;_=s.scheduler}else p===void 0||Zc(p)?(A=s,k=Yc,_=p):(A=s,k=p);return new Y(function(j){var B=A;if(_)return _.schedule(bt,0,{subscriber:j,iterate:l,condition:o,resultSelector:k,state:B});for(;;){if(o){var z=void 0;try{z=o(B)}catch(Vt){j.error(Vt);break}if(!z){j.complete();break}}z=void 0;try{z=k(B)}catch(Vt){j.error(Vt);break}if(j.next(z),j.closed)break;try{B=l(B)}catch(Vt){j.error(Vt);break}}})},iif:function(s,o,l){return o===void 0&&(o=vb),l===void 0&&(l=vb),ad(function(){return s()?o:l})},interval:mm,merge:Xb,never:function(){return Tk},of:bb,onErrorResumeNext:li,pairs:function(s,o){return new Y(o?function(l){var p=Object.keys(s),_=new Oa;return _.add(o.schedule(dt,0,{keys:p,index:0,subscriber:l,subscription:_,obj:s})),_}:function(l){for(var p=Object.keys(s),_=0;_<p.length&&!l.closed;_++){var A=p[_];s.hasOwnProperty(A)&&l.next([A,s[A]])}l.complete()})},partition:function(s,o,l){return[wb(o,l)(new Y(pf(s))),wb(et(o,l))(new Y(pf(s)))]},race:Ca,range:function(s,o,l){return s===void 0&&(s=0),new Y(function(p){o===void 0&&(o=s,s=0);var _=0,A=s;if(l)return l.schedule(ht,0,{index:_,count:o,start:s,subscriber:p});for(;;){if(_++>=o){p.complete();break}if(p.next(A++),p.closed)break}})},throwError:Z,timer:Bc,using:function(s,o){return new Y(function(l){try{var p=s()}catch(k){return void l.error(k)}try{var _=o(p)}catch(k){return void l.error(k)}var A=(_?Kb(_):vb).subscribe(l);return function(){A.unsubscribe(),p&&p.unsubscribe()}})},zip:mi,scheduled:gm,EMPTY:vb,NEVER:Tk,config:Ib}),kt=function(){function s(o){this.selector=o}return s.prototype.call=function(o,l){return l.subscribe(new Ez(o,this.selector,this.caught))},s}(),Ez=function(s){function o(l,p,_){return(l=s.call(this,l)||this).selector=p,l.caught=_,l}return O(o,s),o.prototype.error=function(l){if(!this.isStopped){var p=void 0;try{p=this.selector(l,this.caught)}catch(_){return void s.prototype.error.call(this,_)}this._unsubscribeAndRecycle(),l=new vc(this),this.add(l),(p=ic(p,l))!==l&&this.add(p)}},o}(wc),lt=function(){function s(o){this.defaultValue=o}return s.prototype.call=function(o,l){return l.subscribe(new Fz(o,this.defaultValue))},s}(),Fz=function(s){function o(l,p){return(l=s.call(this,l)||this).defaultValue=p,l.isEmpty=!0,l}return O(o,s),o.prototype._next=function(l){this.isEmpty=!1,this.destination.next(l)},o.prototype._complete=function(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()},o}(ia),mt=function(){function s(o,l){this.delay=o,this.scheduler=l}return s.prototype.call=function(o,l){return l.subscribe(new Gz(o,this.delay,this.scheduler))},s}(),Gz=function(s){function o(l,p,_){return(l=s.call(this,l)||this).delay=p,l.scheduler=_,l.queue=[],l.active=!1,l.errored=!1,l}return O(o,s),o.dispatch=function(l){for(var p=l.source,_=p.queue,A=l.scheduler,k=l.destination;0<_.length&&0>=_[0].time-A.now();)_.shift().notification.observe(k);0<_.length?(p=Math.max(0,_[0].time-A.now()),this.schedule(l,p)):(this.unsubscribe(),p.active=!1)},o.prototype._schedule=function(l){this.active=!0,this.destination.add(l.schedule(o.dispatch,this.delay,{source:this,destination:this.destination,scheduler:l}))},o.prototype.scheduleNotification=function(l){if(this.errored!==!0){var p=this.scheduler;l=new Hz(p.now()+this.delay,l),this.queue.push(l),this.active===!1&&this._schedule(p)}},o.prototype._next=function(l){this.scheduleNotification(Ve.createNext(l))},o.prototype._error=function(l){this.errored=!0,this.queue=[],this.destination.error(l),this.unsubscribe()},o.prototype._complete=function(){this.scheduleNotification(Ve.createComplete()),this.unsubscribe()},o}(ia),Hz=function(s,o){this.time=s,this.notification=o},nt=function(){function s(o,l){this.keySelector=o,this.flushes=l}return s.prototype.call=function(o,l){return l.subscribe(new Iz(o,this.keySelector,this.flushes))},s}(),Iz=function(s){function o(l,p,_){return(l=s.call(this,l)||this).keySelector=p,l.values=new Set,_&&l.add(ic(_,new vc(l))),l}return O(o,s),o.prototype.notifyNext=function(){this.values.clear()},o.prototype.notifyError=function(l){this._error(l)},o.prototype._next=function(l){this.keySelector?this._useKeySelector(l):this._finalizeNext(l,l)},o.prototype._useKeySelector=function(l){var p=this.destination;try{var _=this.keySelector(l)}catch(A){return void p.error(A)}this._finalizeNext(_,l)},o.prototype._finalizeNext=function(l,p){var _=this.values;_.has(l)||(_.add(l),this.destination.next(p))},o}(wc),pt=function(){function s(o){this.errorFactory=o}return s.prototype.call=function(o,l){return l.subscribe(new Jz(o,this.errorFactory))},s}(),Jz=function(s){function o(l,p){return(l=s.call(this,l)||this).errorFactory=p,l.hasValue=!1,l}return O(o,s),o.prototype._next=function(l){this.hasValue=!0,this.destination.next(l)},o.prototype._complete=function(){if(this.hasValue)return this.destination.complete();var l=void 0;try{l=this.errorFactory()}catch(p){l=p}this.destination.error(l)},o}(ia),qt=function(){function s(o){if(this.total=o,0>this.total)throw new Qk}return s.prototype.call=function(o,l){return l.subscribe(new Kz(o,this.total))},s}(),Kz=function(s){function o(l,p){return(l=s.call(this,l)||this).total=p,l.count=0,l}return O(o,s),o.prototype._next=function(l){var p=this.total,_=++this.count;_<=p&&(this.destination.next(l),_===p&&(this.destination.complete(),this.unsubscribe()))},o}(ia),rt=function(){function s(o){this.project=o}return s.prototype.call=function(o,l){return l.subscribe(new Lz(o,this.project))},s}(),Lz=function(s){function o(l,p){return(l=s.call(this,l)||this).project=p,l.hasSubscription=!1,l.hasCompleted=!1,l.index=0,l}return O(o,s),o.prototype._next=function(l){this.hasSubscription||this.tryNext(l)},o.prototype.tryNext=function(l){var p=this.index++;try{var _=this.project(l,p)}catch(A){return void this.destination.error(A)}this.hasSubscription=!0,this._innerSub(_)},o.prototype._innerSub=function(l){var p=new vc(this),_=this.destination;_.add(p),(l=ic(l,p))!==p&&_.add(l)},o.prototype._complete=function(){this.hasCompleted=!0,this.hasSubscription||this.destination.complete(),this.unsubscribe()},o.prototype.notifyNext=function(l){this.destination.next(l)},o.prototype.notifyError=function(l){this.destination.error(l)},o.prototype.notifyComplete=function(){this.hasSubscription=!1,this.hasCompleted&&this.destination.complete()},o}(wc),st=function(){function s(o){this.callback=o}return s.prototype.call=function(o,l){return l.subscribe(new Mz(o,this.callback))},s}(),Mz=function(s){function o(l,p){return(l=s.call(this,l)||this).add(new Oa(p)),l}return O(o,s),o}(ia),ut=function(){function s(){}return s.prototype.call=function(o,l){return l.subscribe(new Nz(o))},s}(),Nz=function(s){function o(){return s!==null&&s.apply(this,arguments)||this}return O(o,s),o.prototype._next=function(l){},o}(ia),vt=function(){function s(o){if(this.total=o,0>this.total)throw new Qk}return s.prototype.call=function(o,l){return l.subscribe(new Oz(o,this.total))},s}(),Oz=function(s){function o(l,p){return(l=s.call(this,l)||this).total=p,l.ring=[],l.count=0,l}return O(o,s),o.prototype._next=function(l){var p=this.ring,_=this.total,A=this.count++;p.length<_?p.push(l):p[A%_]=l},o.prototype._complete=function(){var l=this.destination,p=this.count;if(0<p)for(var _=this.count>=this.total?this.total:this.count,A=this.ring,k=0;k<_;k++){var j=p++%_;l.next(A[j])}l.complete()},o}(ia),wt=function(){function s(o){this.value=o}return s.prototype.call=function(o,l){return l.subscribe(new Pz(o,this.value))},s}(),Pz=function(s){function o(l,p){return(l=s.call(this,l)||this).value=p,l}return O(o,s),o.prototype._next=function(l){this.destination.next(this.value)},o}(ia),xt=function(){function s(o,l,p){p===void 0&&(p=!1),this.accumulator=o,this.seed=l,this.hasSeed=p}return s.prototype.call=function(o,l){return l.subscribe(new Qz(o,this.accumulator,this.seed,this.hasSeed))},s}(),Qz=function(s){function o(l,p,_,A){return(l=s.call(this,l)||this).accumulator=p,l._seed=_,l.hasSeed=A,l.index=0,l}return O(o,s),Object.defineProperty(o.prototype,"seed",{get:function(){return this._seed},set:function(l){this.hasSeed=!0,this._seed=l},enumerable:!0,configurable:!0}),o.prototype._next=function(l){if(this.hasSeed)return this._tryNext(l);this.seed=l,this.destination.next(l)},o.prototype._tryNext=function(l){var p=this.index++;try{var _=this.accumulator(this.seed,l,p)}catch(A){this.destination.error(A)}this.seed=_,this.destination.next(_)},o}(ia),Bt=function(){function s(o,l){this.notifier=o,this.source=l}return s.prototype.call=function(o,l){return l.subscribe(new Rz(o,this.notifier,this.source))},s}(),Rz=function(s){function o(l,p,_){return(l=s.call(this,l)||this).notifier=p,l.source=_,l}return O(o,s),o.prototype.error=function(l){if(!this.isStopped){var p=this.errors,_=this.retries,A=this.retriesSubscription;if(_)this.retriesSubscription=this.errors=void 0;else{p=new Pa;try{_=(0,this.notifier)(p)}catch(k){return s.prototype.error.call(this,k)}A=ic(_,new vc(this))}this._unsubscribeAndRecycle(),this.errors=p,this.retries=_,this.retriesSubscription=A,p.next(l)}},o.prototype._unsubscribe=function(){var l=this.errors,p=this.retriesSubscription;l&&(l.unsubscribe(),this.errors=void 0),p&&(p.unsubscribe(),this.retriesSubscription=void 0),this.retries=void 0},o.prototype.notifyNext=function(){var l=this._unsubscribe;this._unsubscribe=null,this._unsubscribeAndRecycle(),this._unsubscribe=l,this.source.subscribe(this)},o}(wc),Et=function(){function s(o){this.project=o}return s.prototype.call=function(o,l){return l.subscribe(new Sz(o,this.project))},s}(),Sz=function(s){function o(l,p){return(l=s.call(this,l)||this).project=p,l.index=0,l}return O(o,s),o.prototype._next=function(l){var p=this.index++;try{var _=this.project(l,p)}catch(A){return void this.destination.error(A)}this._innerSub(_)},o.prototype._innerSub=function(l){var p=this.innerSubscription;p&&p.unsubscribe(),p=new vc(this);var _=this.destination;_.add(p),this.innerSubscription=ic(l,p),this.innerSubscription!==p&&_.add(this.innerSubscription)},o.prototype._complete=function(){var l=this.innerSubscription;l&&!l.closed||s.prototype._complete.call(this),this.unsubscribe()},o.prototype._unsubscribe=function(){this.innerSubscription=void 0},o.prototype.notifyComplete=function(){this.innerSubscription=void 0,this.isStopped&&s.prototype._complete.call(this)},o.prototype.notifyNext=function(l){this.destination.next(l)},o}(wc),Ft=function(){function s(o){this.notifier=o}return s.prototype.call=function(o,l){o=new Tz(o);var p=ic(this.notifier,new vc(o));return p&&!o.seenValue?(o.add(p),l.subscribe(o)):o},s}(),Tz=function(s){function o(l){return(l=s.call(this,l)||this).seenValue=!1,l}return O(o,s),o.prototype.notifyNext=function(){this.seenValue=!0,this.complete()},o.prototype.notifyComplete=function(){},o}(wc),Ht=function(){function s(o,l){this.predicate=o,this.inclusive=l}return s.prototype.call=function(o,l){return l.subscribe(new Uz(o,this.predicate,this.inclusive))},s}(),Uz=function(s){function o(l,p,_){return(l=s.call(this,l)||this).predicate=p,l.inclusive=_,l.index=0,l}return O(o,s),o.prototype._next=function(l){var p=this.destination;try{var _=this.predicate(l,this.index++)}catch(A){return void p.error(A)}this.nextOrComplete(l,_)},o.prototype.nextOrComplete=function(l,p){var _=this.destination;p?_.next(l):(this.inclusive&&_.next(l),_.complete())},o}(ia),It=function(){function s(o,l,p){this.nextOrObserver=o,this.error=l,this.complete=p}return s.prototype.call=function(o,l){return l.subscribe(new Vz(o,this.nextOrObserver,this.error,this.complete))},s}(),Vz=function(s){function o(l,p,_,A){return(l=s.call(this,l)||this)._tapNext=hc,l._tapError=hc,l._tapComplete=hc,l._tapError=_||hc,l._tapComplete=A||hc,le(p)?(l._context=l,l._tapNext=p):p&&(l._context=p,l._tapNext=p.next||hc,l._tapError=p.error||hc,l._tapComplete=p.complete||hc),l}return O(o,s),o.prototype._next=function(l){try{this._tapNext.call(this._context,l)}catch(p){return void this.destination.error(p)}this.destination.next(l)},o.prototype._error=function(l){try{this._tapError.call(this._context,l)}catch(p){return void this.destination.error(p)}this.destination.error(l)},o.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(l){return void this.destination.error(l)}return this.destination.complete()},o}(ia),Kt={leading:!0,trailing:!1};(function(s){function o(l,p,_,A){var k=s.call(this,l)||this;return k.destination=l,k.durationSelector=p,k._leading=_,k._trailing=A,k._hasValue=!1,k}O(o,s),o.prototype._next=function(l){this._hasValue=!0,this._sendValue=l,this._throttled||(this._leading?this.send():this.throttle(l))},o.prototype.send=function(){var l=this._sendValue;this._hasValue&&(this.destination.next(l),this.throttle(l)),this._hasValue=!1,this._sendValue=void 0},o.prototype.throttle=function(l){(l=this.tryDurationSelector(l))&&this.add(this._throttled=ic(l,new vc(this)))},o.prototype.tryDurationSelector=function(l){try{return this.durationSelector(l)}catch(p){return this.destination.error(p),null}},o.prototype.throttlingDone=function(){var l=this._throttled,p=this._trailing;l&&l.unsubscribe(),this._throttled=void 0,p&&this.send()},o.prototype.notifyNext=function(){this.throttlingDone()},o.prototype.notifyComplete=function(){this.throttlingDone()}})(wc);for(var Lt=function(){function s(o,l,p,_){this.duration=o,this.scheduler=l,this.leading=p,this.trailing=_}return s.prototype.call=function(o,l){return l.subscribe(new Wz(o,this.duration,this.scheduler,this.leading,this.trailing))},s}(),Wz=function(s){function o(l,p,_,A,k){return(l=s.call(this,l)||this).duration=p,l.scheduler=_,l.leading=A,l.trailing=k,l._hasTrailingValue=!1,l._trailingValue=null,l}return O(o,s),o.prototype._next=function(l){this.throttled?this.trailing&&(this._trailingValue=l,this._hasTrailingValue=!0):(this.add(this.throttled=this.scheduler.schedule(Mt,this.duration,{subscriber:this})),this.leading?this.destination.next(l):this.trailing&&(this._trailingValue=l,this._hasTrailingValue=!0))},o.prototype._complete=function(){this._hasTrailingValue&&this.destination.next(this._trailingValue),this.destination.complete()},o.prototype.clearThrottle=function(){var l=this.throttled;l&&(this.trailing&&this._hasTrailingValue&&(this.destination.next(this._trailingValue),this._trailingValue=null,this._hasTrailingValue=!1),l.unsubscribe(),this.remove(l),this.throttled=null)},o}(ia),Ot=function(){function s(o,l,p,_){this.waitFor=o,this.absoluteTimeout=l,this.withObservable=p,this.scheduler=_}return s.prototype.call=function(o,l){return l.subscribe(new Xz(o,this.absoluteTimeout,this.waitFor,this.withObservable,this.scheduler))},s}(),Xz=function(s){function o(l,p,_,A,k){return(l=s.call(this,l)||this).absoluteTimeout=p,l.waitFor=_,l.withObservable=A,l.scheduler=k,l.scheduleTimeout(),l}return O(o,s),o.dispatchTimeout=function(l){var p=l.withObservable;l._unsubscribeAndRecycle(),l.add(ic(p,new vc(l)))},o.prototype.scheduleTimeout=function(){var l=this.action;l?this.action=l.schedule(this,this.waitFor):this.add(this.action=this.scheduler.schedule(o.dispatchTimeout,this.waitFor,this))},o.prototype._next=function(l){this.absoluteTimeout||this.scheduleTimeout(),s.prototype._next.call(this,l)},o.prototype._unsubscribe=function(){this.action=void 0,this.withObservable=this.scheduler=null},o}(wc),Qt=function(){function s(o,l){this.observables=o,this.project=l}return s.prototype.call=function(o,l){return l.subscribe(new Yz(o,this.observables,this.project))},s}(),Yz=function(s){function o(l,p,_){(l=s.call(this,l)||this).observables=p,l.project=_,l.toRespond=[],_=p.length,l.values=Array(_);for(var A=0;A<_;A++)l.toRespond.push(A);for(A=0;A<_;A++)l.add(ji(l,p[A],void 0,A));return l}return O(o,s),o.prototype.notifyNext=function(l,p,_){this.values[_]=p,0<(l=this.toRespond).length&&(_=l.indexOf(_))!==-1&&l.splice(_,1)},o.prototype.notifyComplete=function(){},o.prototype._next=function(l){this.toRespond.length===0&&(l=[l].concat(this.values),this.project?this._tryProject(l):this.destination.next(l))},o.prototype._tryProject=function(l){try{var p=this.project.apply(this,l)}catch(_){return void this.destination.error(_)}this.destination.next(p)},o}(Rk),Jq=$a(function(s){var o=typeof crypto<"u"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||typeof msCrypto<"u"&&typeof window.msCrypto.getRandomValues=="function"&&msCrypto.getRandomValues.bind(msCrypto);if(o){var l=new Uint8Array(16);s.exports=function(){return o(l),l}}else{var p=Array(16);s.exports=function(){for(var _,A=0;16>A;A++)!(3&A)&&(_=4294967296*Math.random()),p[A]=_>>>((3&A)<<3)&255;return p}}}),ab=[],Gh=0;256>Gh;++Gh)ab[Gh]=(Gh+256).toString(16).substr(1);var Kq=function(s,o){return o=o||0,[ab[s[o++]],ab[s[o++]],ab[s[o++]],ab[s[o++]],"-",ab[s[o++]],ab[s[o++]],"-",ab[s[o++]],ab[s[o++]],"-",ab[s[o++]],ab[s[o++]],"-",ab[s[o++]],ab[s[o++]],ab[s[o++]],ab[s[o++]],ab[s[o++]],ab[s[o++]]].join("")},Ud=function(s,o,l){if(l=o&&l||0,typeof s=="string"&&(o=s==="binary"?Array(16):null,s=null),(s=(s=s||{}).random||(s.rng||Jq)())[6]=15&s[6]|64,s[8]=63&s[8]|128,o)for(var p=0;16>p;++p)o[l+p]=s[p];return o||Kq(s)},gg=Ud(),Uk=!1,Pc,rd,Vk,Wk,sd,Vd,ec,We,Rb,Xk,Qc,Wd,Rc,Sc,Tc,Xe,Uc,Vc;(function(s){s[s.ATTRIBUTE_OPERATION_ERR_FAILURE=2]="ATTRIBUTE_OPERATION_ERR_FAILURE",s[s.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT=3]="ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT",s[s.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW=4]="ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW",s[s.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN=5]="ATTRIBUTE_OPERATION_ERR_TOO_OFTEN",s[s.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND=6]="ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND",s[s.ATTRIBUTE_OPERATION_ERR_TIMEOUT=7]="ATTRIBUTE_OPERATION_ERR_TIMEOUT",s[s.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN=102]="ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN"})(Pc||(Pc={})),function(s){s[s.CHANNEL_MESSAGE_ERR_FAILURE=1]="CHANNEL_MESSAGE_ERR_FAILURE",s[s.CHANNEL_MESSAGE_ERR_TIMEOUT=2]="CHANNEL_MESSAGE_ERR_TIMEOUT",s[s.CHANNEL_MESSAGE_ERR_TOO_OFTEN=3]="CHANNEL_MESSAGE_ERR_TOO_OFTEN",s[s.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE=4]="CHANNEL_MESSAGE_ERR_INVALID_MESSAGE",s[s.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL=5]="CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL",s[s.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(rd||(rd={})),function(s){s[s.CREATE_CHANNEL_ERR_INVALID_ARGUMENT=1]="CREATE_CHANNEL_ERR_INVALID_ARGUMENT"}(Vk||(Vk={})),function(s){s[s.CREATE_INSTANCE_ERR_INVALID_ARGUMENT=1]="CREATE_INSTANCE_ERR_INVALID_ARGUMENT"}(Wk||(Wk={})),function(s){s[s.GET_MEMBERS_ERR_FAILURE=1]="GET_MEMBERS_ERR_FAILURE",s[s.GET_MEMBERS_ERR_REJECTED=2]="GET_MEMBERS_ERR_REJECTED",s[s.GET_MEMBERS_ERR_TIMEOUT=3]="GET_MEMBERS_ERR_TIMEOUT",s[s.GET_MEMBERS_ERR_TOO_OFTEN=4]="GET_MEMBERS_ERR_TOO_OFTEN",s[s.GET_MEMBERS_ERR_NOT_IN_CHANNEL=5]="GET_MEMBERS_ERR_NOT_IN_CHANNEL",s[s.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN=102]="GET_MEMBERS_ERR_USER_NOT_LOGGED_IN"}(sd||(sd={})),function(s){s[s.INVITATION_API_CALL_ERR_INVALID_ARGUMENT=1]="INVITATION_API_CALL_ERR_INVALID_ARGUMENT",s[s.INVITATION_API_CALL_ERR_NOT_STARTED=2]="INVITATION_API_CALL_ERR_NOT_STARTED",s[s.INVITATION_API_CALL_ERR_ALREADY_END=3]="INVITATION_API_CALL_ERR_ALREADY_END",s[s.INVITATION_API_CALL_ERR_ALREADY_ACCEPT=4]="INVITATION_API_CALL_ERR_ALREADY_ACCEPT",s[s.INVITATION_API_CALL_ERR_ALREADY_SENT=5]="INVITATION_API_CALL_ERR_ALREADY_SENT"}(Vd||(Vd={})),function(s){s[s.JOIN_CHANNEL_ERR_FAILURE=1]="JOIN_CHANNEL_ERR_FAILURE",s[s.JOIN_CHANNEL_ERR_REJECTED=2]="JOIN_CHANNEL_ERR_REJECTED",s[s.JOIN_CHANNEL_ERR_INVALID_ARGUMENT=3]="JOIN_CHANNEL_ERR_INVALID_ARGUMENT",s[s.JOIN_CHANNEL_TIMEOUT=4]="JOIN_CHANNEL_TIMEOUT",s[s.JOIN_CHANNEL_ERR_EXCEED_LIMIT=5]="JOIN_CHANNEL_ERR_EXCEED_LIMIT",s[s.JOIN_CHANNEL_ERR_ALREADY_JOINED=6]="JOIN_CHANNEL_ERR_ALREADY_JOINED",s[s.JOIN_CHANNEL_ERR_TOO_OFTEN=7]="JOIN_CHANNEL_ERR_TOO_OFTEN",s[s.JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN=8]="JOIN_CHANNEL_ERR_JOIN_SAME_CHANNEL_TOO_OFTEN",s[s.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN",s[s.JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE=201]="JOIN_CHANNEL_ERR_ABORTED_BY_LEAVE",s[s.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID=202]="JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID"}(ec||(ec={})),function(s){s[s.LEAVE_CHANNEL_ERR_FAILURE=1]="LEAVE_CHANNEL_ERR_FAILURE",s[s.LEAVE_CHANNEL_ERR_REJECTED=2]="LEAVE_CHANNEL_ERR_REJECTED",s[s.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL=3]="LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL",s[s.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN=102]="LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN"}(We||(We={})),function(s){s[s.LOGIN_ERR_UNKNOWN=1]="LOGIN_ERR_UNKNOWN",s[s.LOGIN_ERR_REJECTED=2]="LOGIN_ERR_REJECTED",s[s.LOGIN_ERR_INVALID_ARGUMENT=3]="LOGIN_ERR_INVALID_ARGUMENT",s[s.LOGIN_ERR_INVALID_APP_ID=4]="LOGIN_ERR_INVALID_APP_ID",s[s.LOGIN_ERR_INVALID_TOKEN=5]="LOGIN_ERR_INVALID_TOKEN",s[s.LOGIN_ERR_TOKEN_EXPIRED=6]="LOGIN_ERR_TOKEN_EXPIRED",s[s.LOGIN_ERR_NOT_AUTHORIZED=7]="LOGIN_ERR_NOT_AUTHORIZED",s[s.LOGIN_ERR_ALREADY_LOGIN=8]="LOGIN_ERR_ALREADY_LOGIN",s[s.LOGIN_ERR_TIMEOUT=9]="LOGIN_ERR_TIMEOUT",s[s.LOGIN_ERR_TOO_OFTEN=10]="LOGIN_ERR_TOO_OFTEN",s[s.LOGIN_ERR_ABORTED_BY_LOGOUT=201]="LOGIN_ERR_ABORTED_BY_LOGOUT"}(Rb||(Rb={})),function(s){s[s.LOGOUT_ERR_USER_NOT_LOGGED_IN=102]="LOGOUT_ERR_USER_NOT_LOGGED_IN"}(Xk||(Xk={})),function(s){s[s.PEER_MESSAGE_ERR_FAILURE=1]="PEER_MESSAGE_ERR_FAILURE",s[s.PEER_MESSAGE_ERR_TIMEOUT=2]="PEER_MESSAGE_ERR_TIMEOUT",s[s.PEER_MESSAGE_ERR_TOO_OFTEN=5]="PEER_MESSAGE_ERR_TOO_OFTEN",s[s.PEER_MESSAGE_ERR_INVALID_USERID=6]="PEER_MESSAGE_ERR_INVALID_USERID",s[s.PEER_MESSAGE_ERR_INVALID_MESSAGE=7]="PEER_MESSAGE_ERR_INVALID_MESSAGE",s[s.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE=8]="PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE",s[s.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN=102]="PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN"}(Qc||(Qc={})),function(s){s[s.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT=2]="QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT",s[s.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED=3]="QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED",s[s.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT=4]="QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT",s[s.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN=5]="QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN",s[s.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN"}(Wd||(Wd={})),function(s){s[s.RENEW_TOKEN_ERR_FAILURE=1]="RENEW_TOKEN_ERR_FAILURE",s[s.RENEW_TOKEN_ERR_INVALID_ARGUMENT=2]="RENEW_TOKEN_ERR_INVALID_ARGUMENT",s[s.RENEW_TOKEN_ERR_REJECTED=3]="RENEW_TOKEN_ERR_REJECTED",s[s.RENEW_TOKEN_ERR_TOO_OFTEN=4]="RENEW_TOKEN_ERR_TOO_OFTEN",s[s.RENEW_TOKEN_ERR_TOKEN_EXPIRED=5]="RENEW_TOKEN_ERR_TOKEN_EXPIRED",s[s.RENEW_TOKEN_ERR_INVALID_TOKEN=6]="RENEW_TOKEN_ERR_INVALID_TOKEN",s[s.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN=102]="RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN",s[s.RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT=201]="RENEW_TOKEN_ERR_ABORTED_BY_LOGOUT"}(Rc||(Rc={})),function(s){s[s.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE=1]="GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE",s[s.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT=2]="GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT",s[s.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN=3]="GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN",s[s.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT=4]="GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT",s[s.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT=5]="GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT",s[s.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED=101]="GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED",s[s.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN=102]="GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN"}(Sc||(Sc={})),function(s){s[s.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE=1]="PEER_SUBSCRIPTION_STATUS_ERR_FAILURE",s[s.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT=2]="PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT",s[s.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED=3]="PEER_SUBSCRIPTION_STATUS_ERR_REJECTED",s[s.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT=4]="PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT",s[s.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN=5]="PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN",s[s.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW=6]="PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW",s[s.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN=102]="PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN"}(Tc||(Tc={})),function(s){s[s.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE=1]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE",s[s.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT=2]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT",s[s.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN=3]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN",s[s.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN=102]="QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN"}(Xe||(Xe={})),function(s){s[s.UPLOAD_MEDIA_ERR_FAILURE=1]="UPLOAD_MEDIA_ERR_FAILURE",s[s.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="UPLOAD_MEDIA_ERR_INVALID_ARGUMENT",s[s.UPLOAD_MEDIA_ERR_TIMEOUT=3]="UPLOAD_MEDIA_ERR_TIMEOUT",s[s.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW=4]="UPLOAD_MEDIA_ERR_SIZE_OVERFLOW",s[s.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",s[s.UPLOAD_MEDIA_ERR_INTERRUPTED=6]="UPLOAD_MEDIA_ERR_INTERRUPTED",s[s.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="UPLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Uc||(Uc={})),function(s){s[s.DOWNLOAD_MEDIA_ERR_FAILURE=1]="DOWNLOAD_MEDIA_ERR_FAILURE",s[s.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT=2]="DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT",s[s.DOWNLOAD_MEDIA_ERR_TIMEOUT=3]="DOWNLOAD_MEDIA_ERR_TIMEOUT",s[s.DOWNLOAD_MEDIA_ERR_NOT_EXIST=4]="DOWNLOAD_MEDIA_ERR_NOT_EXIST",s[s.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED=5]="DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED",s[s.DOWNLOAD_MEDIA_ERR_INTERRUPTED=6]="DOWNLOAD_MEDIA_ERR_INTERRUPTED",s[s.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN=102]="DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN"}(Vc||(Vc={}));var Sb=Pc.ATTRIBUTE_OPERATION_ERR_FAILURE,Ja=Pc.ATTRIBUTE_OPERATION_ERR_INVALID_ARGUMENT,se=Pc.ATTRIBUTE_OPERATION_ERR_SIZE_OVERFLOW;Pc.ATTRIBUTE_OPERATION_ERR_TOO_OFTEN;var Lq=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_FOUND,Tb=Pc.ATTRIBUTE_OPERATION_ERR_TIMEOUT,Ub=Pc.ATTRIBUTE_OPERATION_ERR_USER_NOT_LOGGED_IN,hg=rd.CHANNEL_MESSAGE_ERR_FAILURE,Yk=rd.CHANNEL_MESSAGE_ERR_TIMEOUT,Mq=rd.CHANNEL_MESSAGE_ERR_TOO_OFTEN,Hh=rd.CHANNEL_MESSAGE_ERR_INVALID_MESSAGE;rd.CHANNEL_MESSAGE_ERR_NOT_IN_CHANNEL;var ig=rd.CHANNEL_MESSAGE_ERR_USER_NOT_LOGGED_IN,Zz=Vk.CREATE_CHANNEL_ERR_INVALID_ARGUMENT,Nq=Wk.CREATE_INSTANCE_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_FAILURE;var Oq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_INVALID_ARGUMENT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TOO_OFTEN;var Pq=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_TIMEOUT,$z=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_EXCEED_LIMIT;Sc.GET_CHANNEL_MEMBER_COUNT_ERR_NOT_INITIALIZED;var aA=Sc.GET_CHANNEL_MEMBER_COUNT_ERR_USER_NOT_LOGGED_IN,bA=sd.GET_MEMBERS_ERR_FAILURE,cA=sd.GET_MEMBERS_ERR_REJECTED;sd.GET_MEMBERS_ERR_TIMEOUT,sd.GET_MEMBERS_ERR_TOO_OFTEN;var dA=sd.GET_MEMBERS_ERR_NOT_IN_CHANNEL,eA=sd.GET_MEMBERS_ERR_USER_NOT_LOGGED_IN,xc=Vd.INVITATION_API_CALL_ERR_INVALID_ARGUMENT,fA=Vd.INVITATION_API_CALL_ERR_NOT_STARTED,Ih=Vd.INVITATION_API_CALL_ERR_ALREADY_END,Qq=Vd.INVITATION_API_CALL_ERR_ALREADY_ACCEPT,gA=Vd.INVITATION_API_CALL_ERR_ALREADY_SENT,Rq=ec.JOIN_CHANNEL_ERR_FAILURE;ec.JOIN_CHANNEL_ERR_REJECTED;var hA=ec.JOIN_CHANNEL_ERR_INVALID_ARGUMENT,Sq=ec.JOIN_CHANNEL_TIMEOUT,Tq=ec.JOIN_CHANNEL_ERR_EXCEED_LIMIT,Uq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED;ec.JOIN_CHANNEL_ERR_TOO_OFTEN;var Vq=ec.JOIN_CHANNEL_ERR_USER_NOT_LOGGED_IN,Wq=ec.JOIN_CHANNEL_ERR_ALREADY_JOINED_CHANNEL_OF_SAME_ID,Xq=We.LEAVE_CHANNEL_ERR_FAILURE,Yq=We.LEAVE_CHANNEL_ERR_REJECTED,iA=We.LEAVE_CHANNEL_ERR_NOT_IN_CHANNEL,jA=We.LEAVE_CHANNEL_ERR_USER_NOT_LOGGED_IN,Zq=Rb.LOGIN_ERR_UNKNOWN,jg=Rb.LOGIN_ERR_REJECTED,Jh=Rb.LOGIN_ERR_INVALID_ARGUMENT,$q=Rb.LOGIN_ERR_INVALID_APP_ID,ar=Rb.LOGIN_ERR_INVALID_TOKEN,Kh=Rb.LOGIN_ERR_TOKEN_EXPIRED;Rb.LOGIN_ERR_NOT_AUTHORIZED;var kA=Rb.LOGIN_ERR_ALREADY_LOGIN,lA=Rb.LOGIN_ERR_TIMEOUT,mA=Rb.LOGIN_ERR_TOO_OFTEN,br=Xk.LOGOUT_ERR_USER_NOT_LOGGED_IN,cr=Qc.PEER_MESSAGE_ERR_FAILURE,Zk=Qc.PEER_MESSAGE_ERR_TIMEOUT,dr=Qc.PEER_MESSAGE_ERR_TOO_OFTEN,$k=Qc.PEER_MESSAGE_ERR_INVALID_USERID,ve=Qc.PEER_MESSAGE_ERR_INVALID_MESSAGE,al=Qc.PEER_MESSAGE_ERR_USER_NOT_LOGGED_IN,nA=Qc.PEER_MESSAGE_ERR_INCOMPATIBLE_MESSAGE,er=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_INVALID_ARGUMENT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_REJECTED;var oA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TIMEOUT;Wd.QUERY_PEERS_ONLINE_STATUS_ERR_TOO_OFTEN;var pA=Wd.QUERY_PEERS_ONLINE_STATUS_ERR_USER_NOT_LOGGED_IN,qA=Rc.RENEW_TOKEN_ERR_FAILURE,rA=Rc.RENEW_TOKEN_ERR_INVALID_ARGUMENT;Rc.RENEW_TOKEN_ERR_REJECTED,Rc.RENEW_TOKEN_ERR_TOO_OFTEN;var sA=Rc.RENEW_TOKEN_ERR_TOKEN_EXPIRED,tA=Rc.RENEW_TOKEN_ERR_INVALID_TOKEN,uA=Rc.RENEW_TOKEN_ERR_USER_NOT_LOGGED_IN,fr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_FAILURE,kg=Tc.PEER_SUBSCRIPTION_STATUS_ERR_INVALID_ARGUMENT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_REJECTED;var vA=Tc.PEER_SUBSCRIPTION_STATUS_ERR_TIMEOUT;Tc.PEER_SUBSCRIPTION_STATUS_ERR_TOO_OFTEN;var gr=Tc.PEER_SUBSCRIPTION_STATUS_ERR_OVERFLOW,bl=Tc.PEER_SUBSCRIPTION_STATUS_ERR_USER_NOT_LOGGED_IN;Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_FAILURE,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TIMEOUT,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_TOO_OFTEN,Xe.QUERY_PEERS_BY_SUBSCRIPTION_OPTION_ERR_USER_NOT_LOGGED_IN;var lg=Uc.UPLOAD_MEDIA_ERR_FAILURE,wf=Uc.UPLOAD_MEDIA_ERR_INVALID_ARGUMENT,Lh=Uc.UPLOAD_MEDIA_ERR_TIMEOUT,wA=Uc.UPLOAD_MEDIA_ERR_SIZE_OVERFLOW,xA=Uc.UPLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,hr=Uc.UPLOAD_MEDIA_ERR_INTERRUPTED,yA=Uc.UPLOAD_MEDIA_ERR_NOT_LOGGED_IN,mg=Vc.DOWNLOAD_MEDIA_ERR_FAILURE,cl=Vc.DOWNLOAD_MEDIA_ERR_INVALID_ARGUMENT,zA=Vc.DOWNLOAD_MEDIA_ERR_TIMEOUT,AA=Vc.DOWNLOAD_MEDIA_ERR_NOT_EXIST,BA=Vc.DOWNLOAD_MEDIA_ERR_CONCURRENCY_LIMIT_EXCEEDED,ir=Vc.DOWNLOAD_MEDIA_ERR_INTERRUPTED,CA=Vc.DOWNLOAD_MEDIA_ERR_NOT_LOGGED_IN,DA=function(s,o){var l;return Hk(s,function(p,_,A){return!(l=o(p,_,A))}),!!l},Mh=function(s,o,l){if(!lb(l))return!1;var p=X(o);return!!(p=="number"?Ed(l)&&wk(o,l.length):p=="string"&&o in l)&&$f(l[o],s)},dl=function(s,o,l){var p=Va(s)?tq:DA;return p(s,Te(o))},EA=function(s,o){var l=-1,p=Ed(s)?Array(s.length):[];return Hk(s,function(_,A,k){p[++l]=o(_,A,k)}),p},FA=function(s,o){var l=s.length;for(s.sort(o);l--;)s[l]=s[l].value;return s},GA=function(s,o,l){o=o.length?he(o,function(_){return Va(_)?function(A){return Ch(A,_.length===1?_[0]:_)}:_}):[Dh];var p=-1;return o=he(o,zh(Te)),s=EA(s,function(_,A,k){return{criteria:he(o,function(j){return j(_)}),index:++p,value:_}}),FA(s,function(_,A){t:{for(var k=-1,j=_.criteria,B=A.criteria,z=j.length,Vt=l.length;++k<z;){e:{var _e=j[k],_n=B[k];if(_e!==_n){var _o=_e!==void 0,_c=_e===null,_d=_e==_e,_h=ie(_e),_p=_n!==void 0,_f=_n===null,e_=_n==_n,u_=ie(_n);if(!_f&&!u_&&!_h&&_e>_n||_h&&_p&&e_&&!_f&&!u_||_c&&_p&&e_||!_o&&e_||!_d){_e=1;break e}if(!_c&&!_h&&!u_&&_e<_n||u_&&_o&&_d&&!_c&&!_h||_f&&_o&&_d||!_p&&_d||!e_){_e=-1;break e}}_e=0}if(_e){_=k>=Vt?_e:_e*(l[k]=="desc"?-1:1);break t}}_=_.index-A.index}return _})},jr=function(s,o){return rq(qq(s,o,Dh),s+"")},kr=jr(function(s,o){if(s==null)return[];var l=o.length;return 1<l&&Mh(s,o[0],o[1])?o=[]:2<l&&Mh(o[0],o[1],o[2])&&(o=[o[0]]),GA(s,$h(o),[])}),lr=function(s){if(s.__esModule)return s;var o=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(s).forEach(function(l){var p=Object.getOwnPropertyDescriptor(s,l);Object.defineProperty(o,l,p.get?p:{enumerable:!0,get:function(){return s[l]}})}),o}(Dz),mr=$a(function(s,o){Object.defineProperty(o,"__esModule",{value:!0});var l=[],p=function(_,A){return new WebSocket(_,A)};o.normalClosureMessage="Normal closure",o.default=function(_,A){var k=(A=A===void 0?{protocols:l,makeWebSocket:p}:A).protocols,j=k===void 0?l:k,B=(A=A.makeWebSocket)===void 0?p:A;return new lr.Observable(function(z){var Vt,_e=new lr.Subject,_n=B(_,j),_o=!1,_c=!1,_d=function(_h){if(Vt)throw _o=!0,_h=Error("Web socket message factory function called more than once"),z.error(_h),_h;return Vt=_h.subscribe(function(_p){_n.send(_p)}),_e};return _n.onopen=function(){_c?(_o=!0,_n.close()):z.next(_d)},_n.onmessage=function(_h){_e.next(_h.data)},_n.onerror=function(_h){_o=!0,z.error(Error(_h.message))},_n.onclose=function(_h){_o||(_o=!0,_c?(z.complete(),_e.complete()):z.error(Error(_h.code===1e3?o.normalClosureMessage:_h.reason)))},function(){_c=!0,Vt&&Vt.unsubscribe(),_o||(_o=!0,_n.close())}})}});(function(s){s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")&&s.default})(mr);var pi=function(s,o,l){(l===void 0||$f(s[o],l))&&(l!==void 0||o in s)||bg(s,o,l)},oi=function(s,o){if((o!=="constructor"||typeof s[o]!="function")&&o!="__proto__")return s[o]},HA=function(s){return jr(function(o,l){var p=-1,_=l.length,A=1<_?l[_-1]:void 0,k=2<_?l[2]:void 0;for(A=3<s.length&&typeof A=="function"?(_--,A):void 0,k&&Mh(l[0],l[1],k)&&(A=3>_?void 0:A,_=1),o=Object(o);++p<_;)(k=l[p])&&s(o,k,p,A);return o})}(function(s,o,l,p){tm(s,o,l,p)}),IA=Math.floor,JA=Math.random,nr=function(s,o){return s+IA(JA()*(o-s+1))},or=function(s){var o=s.length;return o?s[nr(0,o-1)]:void 0},KA=function(s,o){return he(o,function(l){return s[l]})},Ni=function(s){return s==null?[]:KA(s,Ad(s))},LA=function(s){return or(Ni(s))},bn=function(s){return(Va(s)?or:LA)(s)},xm=[],ym=function(s,o){return new WebSocket(s,o)},MA=Math.floor;N({target:"Number",stat:!0},{isInteger:function(s){return!ha(s)&&isFinite(s)&&MA(s)===s}}),Oo("from",Ej,Dj);var NA=function(s,o){for(var l=Array(arguments.length-1),p=0,_=2,A=!0;_<arguments.length;)l[p++]=arguments[_++];return new Promise(function(k,j){l[p]=function(B){if(A)if(A=!1,B)j(B);else{for(var z=Array(arguments.length-1),Vt=0;Vt<z.length;)z[Vt++]=arguments[Vt];k.apply(null,z)}};try{s.apply(o||null,l)}catch(B){A&&(A=!1,j(B))}})},OA=$a(function(s,o){o.length=function(_){var A=_.length;if(!A)return 0;for(var k=0;1<--A%4&&_.charAt(A)==="=";)++k;return Math.ceil(3*_.length)/4-k};var l=Array(64),p=Array(123);for(s=0;64>s;)p[l[s]=26>s?s+65:52>s?s+71:62>s?s-4:s-59|43]=s++;o.encode=function(_,A,k){for(var j,B=null,z=[],Vt=0,_e=0;A<k;){var _n=_[A++];switch(_e){case 0:z[Vt++]=l[_n>>2],j=(3&_n)<<4,_e=1;break;case 1:z[Vt++]=l[j|_n>>4],j=(15&_n)<<2,_e=2;break;case 2:z[Vt++]=l[j|_n>>6],z[Vt++]=l[63&_n],_e=0}8191<Vt&&((B||(B=[])).push(String.fromCharCode.apply(String,z)),Vt=0)}return _e&&(z[Vt++]=l[j],z[Vt++]=61,_e===1&&(z[Vt++]=61)),B?(Vt&&B.push(String.fromCharCode.apply(String,z.slice(0,Vt))),B.join("")):String.fromCharCode.apply(String,z.slice(0,Vt))},o.decode=function(_,A,k){for(var j,B=k,z=0,Vt=0;Vt<_.length;){var _e=_.charCodeAt(Vt++);if(_e===61&&1<z)break;if((_e=p[_e])===void 0)throw Error("invalid encoding");switch(z){case 0:j=_e,z=1;break;case 1:A[k++]=j<<2|(48&_e)>>4,j=_e,z=2;break;case 2:A[k++]=(15&j)<<4|(60&_e)>>2,j=_e,z=3;break;case 3:A[k++]=(3&j)<<6|_e,z=0}}if(z===1)throw Error("invalid encoding");return k-B},o.test=function(_){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(_)}});yg.prototype.on=function(s,o,l){return(this._listeners[s]||(this._listeners[s]=[])).push({fn:o,ctx:l||this}),this},yg.prototype.off=function(s,o){if(s===void 0)this._listeners={};else if(o===void 0)this._listeners[s]=[];else{s=this._listeners[s];for(var l=0;l<s.length;)s[l].fn===o?s.splice(l,1):++l}return this},yg.prototype.emit=function(s){var o=this._listeners[s];if(o){for(var l=[],p=1;p<arguments.length;)l.push(arguments[p++]);for(p=0;p<o.length;)o[p].fn.apply(o[p++].ctx,l)}return this};var PA=zm(zm),QA=function(c){try{var a=eval("quire".replace(/^/,"re"))(c);if(a&&(a.length||Object.keys(a).length))return a}catch(s){}return null},RA=$a(function(s,o){o.length=function(l){for(var p,_=0,A=0;A<l.length;++A)128>(p=l.charCodeAt(A))?_+=1:2048>p?_+=2:(64512&p)==55296&&(64512&l.charCodeAt(A+1))==56320?(++A,_+=4):_+=3;return _},o.read=function(l,p,_){if(1>_-p)return"";for(var A,k=null,j=[],B=0;p<_;)128>(A=l[p++])?j[B++]=A:191<A&&224>A?j[B++]=(31&A)<<6|63&l[p++]:239<A&&365>A?(A=((7&A)<<18|(63&l[p++])<<12|(63&l[p++])<<6|63&l[p++])-65536,j[B++]=55296+(A>>10),j[B++]=56320+(1023&A)):j[B++]=(15&A)<<12|(63&l[p++])<<6|63&l[p++],8191<B&&((k||(k=[])).push(String.fromCharCode.apply(String,j)),B=0);return k?(B&&k.push(String.fromCharCode.apply(String,j.slice(0,B))),k.join("")):String.fromCharCode.apply(String,j.slice(0,B))},o.write=function(l,p,_){for(var A,k,j=_,B=0;B<l.length;++B)128>(A=l.charCodeAt(B))?p[_++]=A:(2048>A?p[_++]=A>>6|192:((64512&A)==55296&&(64512&(k=l.charCodeAt(B+1)))==56320?(A=65536+((1023&A)<<10)+(1023&k),++B,p[_++]=A>>18|240,p[_++]=A>>12&63|128):p[_++]=A>>12|224,p[_++]=A>>6&63|128),p[_++]=63&A|128);return _-j}}),SA=function(s,o,l){var p=l||8192,_=p>>>1,A=null,k=p;return function(j){return 1>j||j>_?s(j):(k+j>p&&(A=s(p),k=0),j=o.call(A,k,k+=j),7&k&&(k=1+(7|k)),j)}},Xd=Wa.zero=new Wa(0,0);Xd.toNumber=function(){return 0},Xd.zzEncode=Xd.zzDecode=function(){return this},Xd.length=function(){return 1};var TA=Wa.zeroHash="\0\0\0\0\0\0\0\0";Wa.fromNumber=function(s){if(s===0)return Xd;var o=0>s;o&&(s=-s);var l=s>>>0;return s=(s-l)/4294967296>>>0,o&&(s=~s>>>0,l=~l>>>0,4294967295<++l&&(l=0,4294967295<++s&&(s=0))),new Wa(l,s)},Wa.from=function(s){if(typeof s=="number")return Wa.fromNumber(s);if(V.isString(s)){if(!V.Long)return Wa.fromNumber(parseInt(s,10));s=V.Long.fromString(s)}return s.low||s.high?new Wa(s.low>>>0,s.high>>>0):Xd},Wa.prototype.toNumber=function(s){if(!s&&this.hi>>>31){s=1+~this.lo>>>0;var o=~this.hi>>>0;return s||(o=o+1>>>0),-(s+4294967296*o)}return this.lo+4294967296*this.hi},Wa.prototype.toLong=function(s){return V.Long?new V.Long(0|this.lo,0|this.hi,!!s):{low:0|this.lo,high:0|this.hi,unsigned:!!s}};var td=String.prototype.charCodeAt;Wa.fromHash=function(s){return s===TA?Xd:new Wa((td.call(s,0)|td.call(s,1)<<8|td.call(s,2)<<16|td.call(s,3)<<24)>>>0,(td.call(s,4)|td.call(s,5)<<8|td.call(s,6)<<16|td.call(s,7)<<24)>>>0)},Wa.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},Wa.prototype.zzEncode=function(){var s=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^s)>>>0,this.lo=(this.lo<<1^s)>>>0,this},Wa.prototype.zzDecode=function(){var s=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^s)>>>0,this.hi=(this.hi>>>1^s)>>>0,this},Wa.prototype.length=function(){var s=this.lo,o=(this.lo>>>28|this.hi<<4)>>>0,l=this.hi>>>24;return l===0?o===0?16384>s?128>s?1:2:2097152>s?3:4:16384>o?128>o?5:6:2097152>o?7:8:128>l?9:10};var V=$a(function(s,o){function l(_,A,k){for(var j=Object.keys(A),B=0;B<j.length;++B)_[j[B]]!==void 0&&k||(_[j[B]]=A[j[B]]);return _}function p(_){function A(k,j){if(!(this instanceof A))return new A(k,j);Object.defineProperty(this,"message",{get:function(){return k}}),Error.captureStackTrace?Error.captureStackTrace(this,A):Object.defineProperty(this,"stack",{value:Error().stack||""}),j&&l(this,j)}return(A.prototype=Object.create(Error.prototype)).constructor=A,Object.defineProperty(A.prototype,"name",{get:function(){return _}}),A.prototype.toString=function(){return this.name+": "+this.message},A}o.asPromise=NA,o.base64=OA,o.EventEmitter=yg,o.float=PA,o.inquire=QA,o.utf8=RA,o.pool=SA,o.LongBits=Wa,o.isNode=!!(Ya!==void 0&&Ya&&Ya.process&&Ya.process.versions&&Ya.process.versions.node),o.global=o.isNode&&Ya||typeof window<"u"&&window||typeof self<"u"&&self||Ya,o.emptyArray=Object.freeze?Object.freeze([]):[],o.emptyObject=Object.freeze?Object.freeze({}):{},o.isInteger=Number.isInteger||function(_){return typeof _=="number"&&isFinite(_)&&Math.floor(_)===_},o.isString=function(_){return typeof _=="string"||_ instanceof String},o.isObject=function(_){return _&&X(_)==="object"},o.isset=o.isSet=function(_,A){var k=_[A];return!(k==null||!_.hasOwnProperty(A))&&(X(k)!=="object"||0<(Array.isArray(k)?k.length:Object.keys(k).length))},o.Buffer=function(){try{var _=o.inquire("buffer").Buffer;return _.prototype.utf8Write?_:null}catch{return null}}(),o._Buffer_from=null,o._Buffer_allocUnsafe=null,o.newBuffer=function(_){return typeof _=="number"?o.Buffer?o._Buffer_allocUnsafe(_):new o.Array(_):o.Buffer?o._Buffer_from(_):typeof Uint8Array>"u"?_:new Uint8Array(_)},o.Array=typeof Uint8Array<"u"?Uint8Array:Array,o.Long=o.global.dcodeIO&&o.global.dcodeIO.Long||o.global.Long||o.inquire("long"),o.key2Re=/^true|false|0|1$/,o.key32Re=/^-?(?:0|[1-9][0-9]*)$/,o.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,o.longToHash=function(_){return _?o.LongBits.from(_).toHash():o.LongBits.zeroHash},o.longFromHash=function(_,A){return _=o.LongBits.fromHash(_),o.Long?o.Long.fromBits(_.lo,_.hi,A):_.toNumber(!!A)},o.merge=l,o.lcFirst=function(_){return _.charAt(0).toLowerCase()+_.substring(1)},o.newError=p,o.ProtocolError=p("ProtocolError"),o.oneOfGetter=function(_){for(var A={},k=0;k<_.length;++k)A[_[k]]=1;return function(){for(var j=Object.keys(this),B=j.length-1;-1<B;--B)if(A[j[B]]===1&&this[j[B]]!==void 0&&this[j[B]]!==null)return j[B]}},o.oneOfSetter=function(_){return function(A){for(var k=0;k<_.length;++k)_[k]!==A&&delete this[_[k]]}},o.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},o._configure=function(){var _=o.Buffer;_?(o._Buffer_from=_.from!==Uint8Array.from&&_.from||function(A,k){return new _(A,k)},o._Buffer_allocUnsafe=_.allocUnsafe||function(A){return new _(A)}):o._Buffer_from=o._Buffer_allocUnsafe=null}}),xi=ja,el,Nh=V.LongBits,pr=V.base64,qr=V.utf8,rr=function(){return V.Buffer?function(){return(ja.create=function(){return new el})()}:function(){return new ja}};ja.create=rr(),ja.alloc=function(s){return new V.Array(s)},V.Array!==Array&&(ja.alloc=V.pool(ja.alloc,V.Array.prototype.subarray)),ja.prototype._push=function(s,o,l){return this.tail=this.tail.next=new sf(s,o,l),this.len+=o,this},ui.prototype=Object.create(sf.prototype),ui.prototype.fn=function(s,o,l){for(;127<s;)o[l++]=127&s|128,s>>>=7;o[l]=s},ja.prototype.uint32=function(s){return this.len+=(this.tail=this.tail.next=new ui(128>(s>>>=0)?1:16384>s?2:2097152>s?3:268435456>s?4:5,s)).len,this},ja.prototype.int32=function(s){return 0>s?this._push(vi,10,Nh.fromNumber(s)):this.uint32(s)},ja.prototype.sint32=function(s){return this.uint32((s<<1^s>>31)>>>0)},ja.prototype.uint64=function(s){return s=Nh.from(s),this._push(vi,s.length(),s)},ja.prototype.int64=ja.prototype.uint64,ja.prototype.sint64=function(s){return s=Nh.from(s).zzEncode(),this._push(vi,s.length(),s)},ja.prototype.bool=function(s){return this._push(ti,1,s?1:0)},ja.prototype.fixed32=function(s){return this._push(wi,4,s>>>0)},ja.prototype.sfixed32=ja.prototype.fixed32,ja.prototype.fixed64=function(s){return s=Nh.from(s),this._push(wi,4,s.lo)._push(wi,4,s.hi)},ja.prototype.sfixed64=ja.prototype.fixed64,ja.prototype.float=function(s){return this._push(V.float.writeFloatLE,4,s)},ja.prototype.double=function(s){return this._push(V.float.writeDoubleLE,8,s)};var UA=V.Array.prototype.set?function(s,o,l){o.set(s,l)}:function(s,o,l){for(var p=0;p<s.length;++p)o[l+p]=s[p]};ja.prototype.bytes=function(s){var o=s.length>>>0;if(!o)return this._push(ti,1,0);if(V.isString(s)){var l=ja.alloc(o=pr.length(s));pr.decode(s,l,0),s=l}return this.uint32(o)._push(UA,o,s)},ja.prototype.string=function(s){var o=qr.length(s);return o?this.uint32(o)._push(qr.write,o,s):this._push(ti,1,0)},ja.prototype.fork=function(){return this.states=new Tt(this),this.head=this.tail=new sf(si,0,0),this.len=0,this},ja.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new sf(si,0,0),this.len=0),this},ja.prototype.ldelim=function(){var s=this.head,o=this.tail,l=this.len;return this.reset().uint32(l),l&&(this.tail.next=s.next,this.tail=o,this.len+=l),this},ja.prototype.finish=function(){for(var s=this.head.next,o=this.constructor.alloc(this.len),l=0;s;)s.fn(s.val,o,l),l+=s.len,s=s.next;return o},ja._configure=function(s){el=s,ja.create=rr(),el._configure()},(jc.prototype=Object.create(xi.prototype)).constructor=jc,jc._configure=function(){jc.alloc=V._Buffer_allocUnsafe,jc.writeBytesBuffer=V.Buffer&&V.Buffer.prototype instanceof Uint8Array&&V.Buffer.prototype.set.name==="set"?function(s,o,l){o.set(s,l)}:function(s,o,l){if(s.copy)s.copy(o,l,0,s.length);else for(var p=0;p<s.length;)o[l++]=s[p++]}},jc.prototype.bytes=function(s){V.isString(s)&&(s=V._Buffer_from(s,"base64"));var o=s.length>>>0;return this.uint32(o),o&&this._push(jc.writeBytesBuffer,o,s),this},jc.prototype.string=function(s){var o=V.Buffer.byteLength(s);return this.uint32(o),o&&this._push(Ut,o,s),this},jc._configure();var zi=La,fl,Em=V.LongBits,VA=V.utf8,sr=typeof Uint8Array<"u"?function(s){if(s instanceof Uint8Array||Array.isArray(s))return new La(s);throw Error("illegal buffer")}:function(s){if(Array.isArray(s))return new La(s);throw Error("illegal buffer")},tr=function(){return V.Buffer?function(s){return(La.create=function(o){return V.Buffer.isBuffer(o)?new fl(o):sr(o)})(s)}:sr};La.create=tr(),La.prototype._slice=V.Array.prototype.subarray||V.Array.prototype.slice,La.prototype.uint32=function(){var s=4294967295;return function(){if(s=(127&this.buf[this.pos])>>>0,128>this.buf[this.pos++]||(s=(s|(127&this.buf[this.pos])<<7)>>>0,128>this.buf[this.pos++])||(s=(s|(127&this.buf[this.pos])<<14)>>>0,128>this.buf[this.pos++])||(s=(s|(127&this.buf[this.pos])<<21)>>>0,128>this.buf[this.pos++])||(s=(s|(15&this.buf[this.pos])<<28)>>>0,128>this.buf[this.pos++]))return s;if((this.pos+=5)>this.len)throw this.pos=this.len,Yb(this,10);return s}}(),La.prototype.int32=function(){return 0|this.uint32()},La.prototype.sint32=function(){var s=this.uint32();return s>>>1^-(1&s)|0},La.prototype.bool=function(){return this.uint32()!==0},La.prototype.fixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return zg(this.buf,this.pos+=4)},La.prototype.sfixed32=function(){if(this.pos+4>this.len)throw Yb(this,4);return 0|zg(this.buf,this.pos+=4)},La.prototype.float=function(){if(this.pos+4>this.len)throw Yb(this,4);var s=V.float.readFloatLE(this.buf,this.pos);return this.pos+=4,s},La.prototype.double=function(){if(this.pos+8>this.len)throw Yb(this,4);var s=V.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,s},La.prototype.bytes=function(){var s=this.uint32(),o=this.pos,l=this.pos+s;if(l>this.len)throw Yb(this,s);return this.pos+=s,Array.isArray(this.buf)?this.buf.slice(o,l):o===l?new this.buf.constructor(0):this._slice.call(this.buf,o,l)},La.prototype.string=function(){var s=this.bytes();return VA.read(s,0,s.length)},La.prototype.skip=function(s){if(typeof s=="number"){if(this.pos+s>this.len)throw Yb(this,s);this.pos+=s}else do if(this.pos>=this.len)throw Yb(this);while(128&this.buf[this.pos++]);return this},La.prototype.skipType=function(s){switch(s){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(s=7&this.uint32())!=4;)this.skipType(s);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+s+" at offset "+this.pos)}return this},La._configure=function(s){fl=s,La.create=tr(),fl._configure();var o=V.Long?"toLong":"toNumber";V.merge(La.prototype,{int64:function(){return yi.call(this)[o](!1)},uint64:function(){return yi.call(this)[o](!0)},sint64:function(){return yi.call(this).zzDecode()[o](!1)},fixed64:function(){return Fm.call(this)[o](!0)},sfixed64:function(){return Fm.call(this)[o](!1)}})},(Fd.prototype=Object.create(zi.prototype)).constructor=Fd,Fd._configure=function(){V.Buffer&&(Fd.prototype._slice=V.Buffer.prototype.slice)},Fd.prototype.string=function(){var s=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+s,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+s,this.len))},Fd._configure(),(tf.prototype=Object.create(V.EventEmitter.prototype)).constructor=tf,tf.prototype.rpcCall=function s(o,l,p,_,A){if(!_)throw TypeError("request must be specified");var k=this;if(!A)return V.asPromise(s,k,o,l,p,_);if(k.rpcImpl)try{return k.rpcImpl(o,l[k.requestDelimited?"encodeDelimited":"encode"](_).finish(),function(j,B){if(j)return k.emit("error",j,o),A(j);if(B!==null){if(!(B instanceof p))try{B=p[k.responseDelimited?"decodeDelimited":"decode"](B)}catch(z){return k.emit("error",z,o),A(z)}return k.emit("data",B,o),A(null,B)}k.end(!0)})}catch(j){k.emit("error",j,o),setTimeout(function(){A(j)},0)}else setTimeout(function(){A(Error("already ended"))},0)},tf.prototype.end=function(s){return this.rpcImpl&&(s||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this};var WA=$a(function(s,o){o.Service=tf}),XA={},fc=$a(function(s,o){function l(){p.util._configure(),p.Writer._configure(p.BufferWriter),p.Reader._configure(p.BufferReader)}var p=o;p.build="minimal",p.Writer=xi,p.BufferWriter=jc,p.Reader=zi,p.BufferReader=Fd,p.util=V,p.rpc=WA,p.roots=XA,p.configure=l,l()});fc.util.Long=U,fc.configure();var u=fc.Reader,L=fc.Writer,q=fc.util,t=fc.roots.default||(fc.roots.default={}),YA=t.URI=function(){var s={},o=Object.create(s);return o[s[0]="Unknown"]=0,o[s[1]="PingUri"]=1,o[s[2]="PongUri"]=2,o[s[11]="UserJoinUri"]=11,o[s[12]="UserRespUri"]=12,o[s[21]="UserQuitUri"]=21,o[s[22]="UserDropUri"]=22,o[s[31]="GroupEnterUri"]=31,o[s[32]="GroupLeaveUri"]=32,o[s[33]="GroupReplyUri"]=33,o[s[36]="GroupEnterNoticeUri"]=36,o[s[37]="GroupLeaveNoticeUri"]=37,o[s[38]="GroupEventNoticeUri"]=38,o[s[39]="GroupCountNoticeUri"]=39,o[s[41]="UserStatusListUri"]=41,o[s[42]="UserStatusResultUri"]=42,o[s[51]="GroupStatusListUri"]=51,o[s[52]="GroupStatusResultUri"]=52,o[s[55]="GroupAllUsersListUri"]=55,o[s[56]="GroupAllUsersResultUri"]=56,o[s[100]="MessageUri"]=100,o[s[101]="AckUri"]=101,o[s[115]="FileUploadIndexGetUri"]=115,o[s[116]="FileUploadIndexRetUri"]=116,o[s[117]="FileUploadIndexSetUri"]=117,o[s[118]="FileUploadIndexFinUri"]=118,o[s[119]="FileUploadIndexErrUri"]=119,o[s[125]="FileDownloadIndexGetUri"]=125,o[s[126]="FileDownloadIndexRetUri"]=126,o[s[127]="FileDownloadIndexErrUri"]=127,o[s[201]="UserJoinNoticeUri"]=201,o[s[202]="UserQuitNoticeUri"]=202,o[s[203]="UserWaitNoticeUri"]=203,o[s[301]="UserAttributeGetUri"]=301,o[s[302]="UserAttributeRetUri"]=302,o[s[303]="UserAttributeSetUri"]=303,o[s[304]="UserAttributeModUri"]=304,o[s[305]="UserAttributeDelUri"]=305,o[s[307]="UserAttributeRspUri"]=307,o[s[308]="UserAttributeErrUri"]=308,o[s[311]="UserAttributeKeysGetUri"]=311,o[s[312]="UserAttributeKeysRetUri"]=312,o[s[351]="GroupAttributeGetUri"]=351,o[s[352]="GroupAttributeRetUri"]=352,o[s[353]="GroupAttributeSetUri"]=353,o[s[354]="GroupAttributeModUri"]=354,o[s[355]="GroupAttributeDelUri"]=355,o[s[356]="GroupAttributeAltUri"]=356,o[s[357]="GroupAttributeRspUri"]=357,o[s[358]="GroupAttributeErrUri"]=358,o[s[361]="GroupAttributeKeysGetUri"]=361,o[s[362]="GroupAttributeKeysRetUri"]=362,o[s[401]="SubscribeUserStatusUri"]=401,o[s[402]="UnsubscribeUserStatusUri"]=402,o[s[499]="SubscribeResponseUri"]=499,o}(),Oh=t.Wrapper=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.uri=0,s.prototype.data=q.newBuffer([]),s.encode=function(o,l){return l||(l=L.create()),o.uri!=null&&Object.hasOwnProperty.call(o,"uri")&&l.uint32(8).int32(o.uri),o.data!=null&&Object.hasOwnProperty.call(o,"data")&&l.uint32(18).bytes(o.data),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.Wrapper;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.uri=o.int32();break;case 2:p.data=o.bytes();break;default:o.skipType(7&_)}}return p},s}(),ZA=t.Ping=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.ms!=null&&Object.hasOwnProperty.call(o,"ms")&&l.uint32(16).uint64(o.ms),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.Ping;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.ms=o.uint64();break;default:o.skipType(7&_)}}return p},s}(),$A=t.Pong=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.ms!=null&&Object.hasOwnProperty.call(o,"ms")&&l.uint32(16).uint64(o.ms),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.Pong;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.ms=o.uint64();break;default:o.skipType(7&_)}}return p},s}(),aB=t.UserJoin=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.opt=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.account="",s.prototype.ticket="",s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.opt!=null&&Object.hasOwnProperty.call(o,"opt")&&l.uint32(16).uint64(o.opt),o.instance!=null&&Object.hasOwnProperty.call(o,"instance")&&l.uint32(24).uint64(o.instance),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&l.uint32(34).string(o.account),o.ticket!=null&&Object.hasOwnProperty.call(o,"ticket")&&l.uint32(42).string(o.ticket),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserJoin;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.opt=o.uint64();break;case 3:p.instance=o.uint64();break;case 4:p.account=o.string();break;case 5:p.ticket=o.string();break;default:o.skipType(7&_)}}return p},s}(),bB=t.UserResp=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.account="",s.prototype.code=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&l.uint32(18).string(o.account),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&l.uint32(24).uint32(o.code),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserResp;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.account=o.string();break;case 3:p.code=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),cB=t.UserQuit=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.encode=function(o,l){return l||(l=L.create()),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserQuit;o.pos<l;){var _=o.uint32();o.skipType(7&_)}return p},s}(),dB=t.UserDrop=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.code=0,s.encode=function(o,l){return l||(l=L.create()),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&l.uint32(8).uint32(o.code),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserDrop;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.code=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),eB=t.GroupEnter=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.account="",s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&l.uint32(18).string(o.account),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupEnter;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.account=o.string();break;default:o.skipType(7&_)}}return p},s}(),fB=t.GroupLeave=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.account="",s.encode=function(o,l){return l||(l=L.create()),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&l.uint32(10).string(o.account),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupLeave;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.account=o.string();break;default:o.skipType(7&_)}}return p},s}(),gB=t.GroupReply=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.account="",s.prototype.code=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&l.uint32(18).string(o.account),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&l.uint32(24).uint32(o.code),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupReply;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.account=o.string();break;case 3:p.code=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),ur=t.GroupLeaveNotice=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.user="",s.prototype.group="",s.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.size=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.user!=null&&Object.hasOwnProperty.call(o,"user")&&l.uint32(18).string(o.user),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(26).string(o.group),o.instance!=null&&Object.hasOwnProperty.call(o,"instance")&&l.uint32(32).uint64(o.instance),o.size!=null&&Object.hasOwnProperty.call(o,"size")&&l.uint32(40).uint32(o.size),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupLeaveNotice;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.user=o.string();break;case 3:p.group=o.string();break;case 4:p.instance=o.uint64();break;case 5:p.size=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),vr=t.GroupEnterNotice=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.user="",s.prototype.group="",s.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.size=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.user!=null&&Object.hasOwnProperty.call(o,"user")&&l.uint32(18).string(o.user),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(26).string(o.group),o.instance!=null&&Object.hasOwnProperty.call(o,"instance")&&l.uint32(32).uint64(o.instance),o.size!=null&&Object.hasOwnProperty.call(o,"size")&&l.uint32(40).uint32(o.size),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupEnterNotice;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.user=o.string();break;case 3:p.group=o.string();break;case 4:p.instance=o.uint64();break;case 5:p.size=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),wr=t.Message=function(){function s(o){if(this.MiscMap={},o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.options=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.src="",s.prototype.dst="",s.prototype.payload=q.newBuffer([]),s.prototype.MiscMap=q.emptyObject,s.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,s.encode=function(o,l){if(l||(l=L.create()),o.instance!=null&&Object.hasOwnProperty.call(o,"instance")&&l.uint32(8).uint64(o.instance),o.dialogue!=null&&Object.hasOwnProperty.call(o,"dialogue")&&l.uint32(16).uint64(o.dialogue),o.sequence!=null&&Object.hasOwnProperty.call(o,"sequence")&&l.uint32(24).uint64(o.sequence),o.options!=null&&Object.hasOwnProperty.call(o,"options")&&l.uint32(32).uint64(o.options),o.src!=null&&Object.hasOwnProperty.call(o,"src")&&l.uint32(42).string(o.src),o.dst!=null&&Object.hasOwnProperty.call(o,"dst")&&l.uint32(50).string(o.dst),o.payload!=null&&Object.hasOwnProperty.call(o,"payload")&&l.uint32(58).bytes(o.payload),o.MiscMap!=null&&Object.hasOwnProperty.call(o,"MiscMap"))for(var p=Object.keys(o.MiscMap),_=0;_<p.length;++_)l.uint32(66).fork().uint32(10).string(p[_]).uint32(18).bytes(o.MiscMap[p[_]]).ldelim();return o.ms!=null&&Object.hasOwnProperty.call(o,"ms")&&l.uint32(72).uint64(o.ms),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p,_,A=new t.Message;o.pos<l;)switch(p=o.uint32(),p>>>3){case 1:A.instance=o.uint64();break;case 2:A.dialogue=o.uint64();break;case 3:A.sequence=o.uint64();break;case 4:A.options=o.uint64();break;case 5:A.src=o.string();break;case 6:A.dst=o.string();break;case 7:A.payload=o.bytes();break;case 8:A.MiscMap===q.emptyObject&&(A.MiscMap={});var k=o.uint32()+o.pos;for(p="",_=[];o.pos<k;){var j=o.uint32();switch(j>>>3){case 1:p=o.string();break;case 2:_=o.bytes();break;default:o.skipType(7&j)}}A.MiscMap[p]=_;break;case 9:A.ms=o.uint64();break;default:o.skipType(7&p)}return A},s}(),xr=t.Ack=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.dialogue=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.sequence=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.code=0,s.encode=function(o,l){return l||(l=L.create()),o.instance!=null&&Object.hasOwnProperty.call(o,"instance")&&l.uint32(8).uint64(o.instance),o.dialogue!=null&&Object.hasOwnProperty.call(o,"dialogue")&&l.uint32(16).uint64(o.dialogue),o.sequence!=null&&Object.hasOwnProperty.call(o,"sequence")&&l.uint32(24).uint64(o.sequence),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&l.uint32(32).uint32(o.code),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.Ack;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.instance=o.uint64();break;case 2:p.dialogue=o.uint64();break;case 3:p.sequence=o.uint64();break;case 4:p.code=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),hB=t.FileUploadIndexGet=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.hash=q.newBuffer([]),s.prototype.size=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.hash!=null&&Object.hasOwnProperty.call(o,"hash")&&l.uint32(18).bytes(o.hash),o.size!=null&&Object.hasOwnProperty.call(o,"size")&&l.uint32(24).uint32(o.size),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.FileUploadIndexGet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.hash=o.bytes();break;case 3:p.size=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),iB=t.FileUploadIndexRet=function(){function s(o){if(this.servers=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.unit=0,s.prototype.servers=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.unit!=null&&Object.hasOwnProperty.call(o,"unit")&&l.uint32(16).uint32(o.unit),o.servers!=null&&o.servers.length){l.uint32(26).fork();for(var p=0;p<o.servers.length;++p)l.uint32(o.servers[p]);l.ldelim()}return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.FileUploadIndexRet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.unit=o.uint32();break;case 3:if(p.servers&&p.servers.length||(p.servers=[]),(7&_)==2)for(_=o.uint32()+o.pos;o.pos<_;)p.servers.push(o.uint32());else p.servers.push(o.uint32());break;default:o.skipType(7&_)}}return p},s}(),jB=t.FileUploadIndexSet=function(){function s(o){if(this.servers=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.hash=q.newBuffer([]),s.prototype.unit=0,s.prototype.servers=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.hash!=null&&Object.hasOwnProperty.call(o,"hash")&&l.uint32(18).bytes(o.hash),o.unit!=null&&Object.hasOwnProperty.call(o,"unit")&&l.uint32(24).uint32(o.unit),o.servers!=null&&o.servers.length){l.uint32(34).fork();for(var p=0;p<o.servers.length;++p)l.uint32(o.servers[p]);l.ldelim()}return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.FileUploadIndexSet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.hash=o.bytes();break;case 3:p.unit=o.uint32();break;case 4:if(p.servers&&p.servers.length||(p.servers=[]),(7&_)==2)for(_=o.uint32()+o.pos;o.pos<_;)p.servers.push(o.uint32());else p.servers.push(o.uint32());break;default:o.skipType(7&_)}}return p},s}(),kB=t.FileUploadIndexFin=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.zone=0,s.prototype.unit=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.zone!=null&&Object.hasOwnProperty.call(o,"zone")&&l.uint32(16).uint32(o.zone),o.unit!=null&&Object.hasOwnProperty.call(o,"unit")&&l.uint32(24).uint32(o.unit),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.FileUploadIndexFin;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.zone=o.uint32();break;case 3:p.unit=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),lB=t.FileUploadIndexErr=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.code=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&l.uint32(16).uint32(o.code),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.FileUploadIndexErr;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.code=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),mB=t.FileDownloadIndexGet=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.zone=0,s.prototype.hash=q.newBuffer([]),s.prototype.size=0,s.prototype.unit=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.zone!=null&&Object.hasOwnProperty.call(o,"zone")&&l.uint32(16).uint32(o.zone),o.hash!=null&&Object.hasOwnProperty.call(o,"hash")&&l.uint32(26).bytes(o.hash),o.size!=null&&Object.hasOwnProperty.call(o,"size")&&l.uint32(32).uint32(o.size),o.unit!=null&&Object.hasOwnProperty.call(o,"unit")&&l.uint32(40).uint32(o.unit),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.FileDownloadIndexGet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.zone=o.uint32();break;case 3:p.hash=o.bytes();break;case 4:p.size=o.uint32();break;case 5:p.unit=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),nB=t.FileDownloadIndexRet=function(){function s(o){if(this.servers=[],this.backups=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.unit=0,s.prototype.zone=0,s.prototype.servers=q.emptyArray,s.prototype.backups=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.unit!=null&&Object.hasOwnProperty.call(o,"unit")&&l.uint32(16).uint32(o.unit),o.zone!=null&&Object.hasOwnProperty.call(o,"zone")&&l.uint32(24).uint32(o.zone),o.servers!=null&&o.servers.length){l.uint32(34).fork();for(var p=0;p<o.servers.length;++p)l.uint32(o.servers[p]);l.ldelim()}if(o.backups!=null&&o.backups.length){for(l.uint32(42).fork(),p=0;p<o.backups.length;++p)l.uint32(o.backups[p]);l.ldelim()}return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.FileDownloadIndexRet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.unit=o.uint32();break;case 3:p.zone=o.uint32();break;case 4:if(p.servers&&p.servers.length||(p.servers=[]),(7&_)==2)for(_=o.uint32()+o.pos;o.pos<_;)p.servers.push(o.uint32());else p.servers.push(o.uint32());break;case 5:if(p.backups&&p.backups.length||(p.backups=[]),(7&_)==2)for(_=o.uint32()+o.pos;o.pos<_;)p.backups.push(o.uint32());else p.backups.push(o.uint32());break;default:o.skipType(7&_)}}return p},s}(),oB=t.FileDownloadIndexErr=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.code=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&l.uint32(16).uint32(o.code),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.FileDownloadIndexErr;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.code=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),pB=t.GroupAllUsersList=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.group="",s.prototype.pageSize=0,s.prototype.pageNumber=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(18).string(o.group),o.pageSize!=null&&Object.hasOwnProperty.call(o,"pageSize")&&l.uint32(24).uint32(o.pageSize),o.pageNumber!=null&&Object.hasOwnProperty.call(o,"pageNumber")&&l.uint32(32).uint32(o.pageNumber),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAllUsersList;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.group=o.string();break;case 3:p.pageSize=o.uint32();break;case 4:p.pageNumber=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),qB=t.GroupAllUsersResult=function(){function s(o){if(this.memberInfos=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.group="",s.prototype.totalSize=0,s.prototype.pageSize=0,s.prototype.pageNumber=0,s.prototype.memberInfos=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(18).string(o.group),o.totalSize!=null&&Object.hasOwnProperty.call(o,"totalSize")&&l.uint32(24).uint32(o.totalSize),o.pageSize!=null&&Object.hasOwnProperty.call(o,"pageSize")&&l.uint32(32).uint32(o.pageSize),o.pageNumber!=null&&Object.hasOwnProperty.call(o,"pageNumber")&&l.uint32(40).uint32(o.pageNumber),o.memberInfos!=null&&o.memberInfos.length)for(var p=0;p<o.memberInfos.length;++p)t.GroupAllUsersResult.MemberInfo.encode(o.memberInfos[p],l.uint32(50).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAllUsersResult;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.group=o.string();break;case 3:p.totalSize=o.uint32();break;case 4:p.pageSize=o.uint32();break;case 5:p.pageNumber=o.uint32();break;case 6:p.memberInfos&&p.memberInfos.length||(p.memberInfos=[]),p.memberInfos.push(t.GroupAllUsersResult.MemberInfo.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.MemberInfo=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.account="",o.prototype.ts=0,o.encode=function(l,p){return p||(p=L.create()),l.account!=null&&Object.hasOwnProperty.call(l,"account")&&p.uint32(10).string(l.account),l.ts!=null&&Object.hasOwnProperty.call(l,"ts")&&p.uint32(16).uint32(l.ts),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.GroupAllUsersResult.MemberInfo;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.account=l.string();break;case 2:_.ts=l.uint32();break;default:l.skipType(7&A)}}return _},o}(),s}(),rB=t.UserStatusList=function(){function s(o){if(this.users=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.users=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.users!=null&&o.users.length)for(var p=0;p<o.users.length;++p)l.uint32(18).string(o.users[p]);return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserStatusList;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.users&&p.users.length||(p.users=[]),p.users.push(o.string());break;default:o.skipType(7&_)}}return p},s}(),sB=t.UserStatusResult=function(){function s(o){if(this.userInfos=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.userInfos=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.userInfos!=null&&o.userInfos.length)for(var p=0;p<o.userInfos.length;++p)t.UserStatusResult.UserStatusInfo.encode(o.userInfos[p],l.uint32(18).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserStatusResult;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.userInfos&&p.userInfos.length||(p.userInfos=[]),p.userInfos.push(t.UserStatusResult.UserStatusInfo.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.UserStatusInfo=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.account="",o.prototype.ts=0,o.encode=function(l,p){return p||(p=L.create()),l.account!=null&&Object.hasOwnProperty.call(l,"account")&&p.uint32(10).string(l.account),l.ts!=null&&Object.hasOwnProperty.call(l,"ts")&&p.uint32(16).uint32(l.ts),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.UserStatusResult.UserStatusInfo;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.account=l.string();break;case 2:_.ts=l.uint32();break;default:l.skipType(7&A)}}return _},o}(),s}(),tB=t.UserAttributeGet=function(){function s(o){if(this.attributes=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.account="",s.prototype.attributes=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&l.uint32(18).string(o.account),o.attributes!=null&&o.attributes.length)for(var p=0;p<o.attributes.length;++p)l.uint32(26).string(o.attributes[p]);return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserAttributeGet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.account=o.string();break;case 3:p.attributes&&p.attributes.length||(p.attributes=[]),p.attributes.push(o.string());break;default:o.skipType(7&_)}}return p},s}(),uB=t.UserAttributeRet=function(){function s(o){if(this.attributeInfos=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.attributeInfos=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.attributeInfos!=null&&o.attributeInfos.length)for(var p=0;p<o.attributeInfos.length;++p)t.UserAttributeRet.AttributeInfo.encode(o.attributeInfos[p],l.uint32(18).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserAttributeRet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.attributeInfos&&p.attributeInfos.length||(p.attributeInfos=[]),p.attributeInfos.push(t.UserAttributeRet.AttributeInfo.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.AttributeInfo=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.key="",o.prototype.value="",o.encode=function(l,p){return p||(p=L.create()),l.key!=null&&Object.hasOwnProperty.call(l,"key")&&p.uint32(10).string(l.key),l.value!=null&&Object.hasOwnProperty.call(l,"value")&&p.uint32(18).string(l.value),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.UserAttributeRet.AttributeInfo;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.key=l.string();break;case 2:_.value=l.string();break;default:l.skipType(7&A)}}return _},o}(),s}(),vB=t.UserAttributeSet=function(){function s(o){if(this.attributeInfos=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.account="",s.prototype.attributeInfos=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&l.uint32(18).string(o.account),o.attributeInfos!=null&&o.attributeInfos.length)for(var p=0;p<o.attributeInfos.length;++p)t.UserAttributeSet.AttributeInfo.encode(o.attributeInfos[p],l.uint32(26).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserAttributeSet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.account=o.string();break;case 3:p.attributeInfos&&p.attributeInfos.length||(p.attributeInfos=[]),p.attributeInfos.push(t.UserAttributeSet.AttributeInfo.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.AttributeInfo=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.key="",o.prototype.value="",o.encode=function(l,p){return p||(p=L.create()),l.key!=null&&Object.hasOwnProperty.call(l,"key")&&p.uint32(10).string(l.key),l.value!=null&&Object.hasOwnProperty.call(l,"value")&&p.uint32(18).string(l.value),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.UserAttributeSet.AttributeInfo;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.key=l.string();break;case 2:_.value=l.string();break;default:l.skipType(7&A)}}return _},o}(),s}(),wB=t.UserAttributeMod=function(){function s(o){if(this.attributeInfos=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.account="",s.prototype.attributeInfos=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&l.uint32(18).string(o.account),o.attributeInfos!=null&&o.attributeInfos.length)for(var p=0;p<o.attributeInfos.length;++p)t.UserAttributeMod.AttributeInfo.encode(o.attributeInfos[p],l.uint32(26).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserAttributeMod;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.account=o.string();break;case 3:p.attributeInfos&&p.attributeInfos.length||(p.attributeInfos=[]),p.attributeInfos.push(t.UserAttributeMod.AttributeInfo.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.AttributeInfo=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.key="",o.prototype.value="",o.encode=function(l,p){return p||(p=L.create()),l.key!=null&&Object.hasOwnProperty.call(l,"key")&&p.uint32(10).string(l.key),l.value!=null&&Object.hasOwnProperty.call(l,"value")&&p.uint32(18).string(l.value),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.UserAttributeMod.AttributeInfo;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.key=l.string();break;case 2:_.value=l.string();break;default:l.skipType(7&A)}}return _},o}(),s}(),xB=t.UserAttributeDel=function(){function s(o){if(this.attributes=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.account="",s.prototype.attributes=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&l.uint32(18).string(o.account),o.attributes!=null&&o.attributes.length)for(var p=0;p<o.attributes.length;++p)l.uint32(26).string(o.attributes[p]);return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserAttributeDel;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.account=o.string();break;case 3:p.attributes&&p.attributes.length||(p.attributes=[]),p.attributes.push(o.string());break;default:o.skipType(7&_)}}return p},s}(),yB=t.UserAttributeErr=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.code=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&l.uint32(16).uint32(o.code),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserAttributeErr;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.code=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),zB=t.UserAttributeKeysGet=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.account="",s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.account!=null&&Object.hasOwnProperty.call(o,"account")&&l.uint32(18).string(o.account),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserAttributeKeysGet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.account=o.string();break;default:o.skipType(7&_)}}return p},s}(),AB=t.UserAttributeKeysRet=function(){function s(o){if(this.keys=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.keys=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.keys!=null&&o.keys.length)for(var p=0;p<o.keys.length;++p)l.uint32(18).string(o.keys[p]);return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserAttributeKeysRet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.keys&&p.keys.length||(p.keys=[]),p.keys.push(o.string());break;default:o.skipType(7&_)}}return p},s}(),BB=t.UserAttributeRsp=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserAttributeRsp;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;default:o.skipType(7&_)}}return p},s}(),CB=t.GroupStatusList=function(){function s(o){if(this.groups=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.groups=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.groups!=null&&o.groups.length)for(var p=0;p<o.groups.length;++p)l.uint32(18).string(o.groups[p]);return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupStatusList;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.groups&&p.groups.length||(p.groups=[]),p.groups.push(o.string());break;default:o.skipType(7&_)}}return p},s}(),DB=t.GroupStatusResult=function(){function s(o){if(this.groupInfos=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.groupInfos=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.groupInfos!=null&&o.groupInfos.length)for(var p=0;p<o.groupInfos.length;++p)t.GroupStatusResult.GroupInfo.encode(o.groupInfos[p],l.uint32(18).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupStatusResult;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.groupInfos&&p.groupInfos.length||(p.groupInfos=[]),p.groupInfos.push(t.GroupStatusResult.GroupInfo.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.GroupInfo=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.group="",o.prototype.memberCount=0,o.encode=function(l,p){return p||(p=L.create()),l.group!=null&&Object.hasOwnProperty.call(l,"group")&&p.uint32(10).string(l.group),l.memberCount!=null&&Object.hasOwnProperty.call(l,"memberCount")&&p.uint32(16).uint32(l.memberCount),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.GroupStatusResult.GroupInfo;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.group=l.string();break;case 2:_.memberCount=l.uint32();break;default:l.skipType(7&A)}}return _},o}(),s}(),EB=t.GroupCountNotice=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.group="",s.prototype.size=0,s.encode=function(o,l){return l||(l=L.create()),o.instance!=null&&Object.hasOwnProperty.call(o,"instance")&&l.uint32(8).uint64(o.instance),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(16).uint64(o.seq),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(26).string(o.group),o.size!=null&&Object.hasOwnProperty.call(o,"size")&&l.uint32(32).uint32(o.size),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupCountNotice;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.instance=o.uint64();break;case 2:p.seq=o.uint64();break;case 3:p.group=o.string();break;case 4:p.size=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),FB=t.GroupAttributeGet=function(){function s(o){if(this.attributes=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.group="",s.prototype.attributes=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(18).string(o.group),o.attributes!=null&&o.attributes.length)for(var p=0;p<o.attributes.length;++p)l.uint32(26).string(o.attributes[p]);return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAttributeGet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.group=o.string();break;case 3:p.attributes&&p.attributes.length||(p.attributes=[]),p.attributes.push(o.string());break;default:o.skipType(7&_)}}return p},s}(),GB=t.GroupAttributeRet=function(){function s(o){if(this.attributeMaps=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.attributeMaps=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.attributeMaps!=null&&o.attributeMaps.length)for(var p=0;p<o.attributeMaps.length;++p)t.GroupAttributeRet.AttributeMap.encode(o.attributeMaps[p],l.uint32(18).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAttributeRet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.attributeMaps&&p.attributeMaps.length||(p.attributeMaps=[]),p.attributeMaps.push(t.GroupAttributeRet.AttributeMap.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.AttributeMap=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.key="",o.prototype.value="",o.prototype.origin="",o.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,o.encode=function(l,p){return p||(p=L.create()),l.key!=null&&Object.hasOwnProperty.call(l,"key")&&p.uint32(10).string(l.key),l.value!=null&&Object.hasOwnProperty.call(l,"value")&&p.uint32(18).string(l.value),l.origin!=null&&Object.hasOwnProperty.call(l,"origin")&&p.uint32(26).string(l.origin),l.ms!=null&&Object.hasOwnProperty.call(l,"ms")&&p.uint32(32).uint64(l.ms),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.GroupAttributeRet.AttributeMap;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.key=l.string();break;case 2:_.value=l.string();break;case 3:_.origin=l.string();break;case 4:_.ms=l.uint64();break;default:l.skipType(7&A)}}return _},o}(),s}(),HB=t.GroupAttributeSet=function(){function s(o){if(this.attributeInfos=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.group="",s.prototype.broadcast=!1,s.prototype.attributeInfos=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(18).string(o.group),o.broadcast!=null&&Object.hasOwnProperty.call(o,"broadcast")&&l.uint32(24).bool(o.broadcast),o.attributeInfos!=null&&o.attributeInfos.length)for(var p=0;p<o.attributeInfos.length;++p)t.GroupAttributeSet.AttributeInfo.encode(o.attributeInfos[p],l.uint32(34).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAttributeSet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.group=o.string();break;case 3:p.broadcast=o.bool();break;case 4:p.attributeInfos&&p.attributeInfos.length||(p.attributeInfos=[]),p.attributeInfos.push(t.GroupAttributeSet.AttributeInfo.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.AttributeInfo=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.key="",o.prototype.value="",o.encode=function(l,p){return p||(p=L.create()),l.key!=null&&Object.hasOwnProperty.call(l,"key")&&p.uint32(10).string(l.key),l.value!=null&&Object.hasOwnProperty.call(l,"value")&&p.uint32(18).string(l.value),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.GroupAttributeSet.AttributeInfo;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.key=l.string();break;case 2:_.value=l.string();break;default:l.skipType(7&A)}}return _},o}(),s}(),IB=t.GroupAttributeMod=function(){function s(o){if(this.attributeInfos=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.group="",s.prototype.broadcast=!1,s.prototype.attributeInfos=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(18).string(o.group),o.broadcast!=null&&Object.hasOwnProperty.call(o,"broadcast")&&l.uint32(24).bool(o.broadcast),o.attributeInfos!=null&&o.attributeInfos.length)for(var p=0;p<o.attributeInfos.length;++p)t.GroupAttributeMod.AttributeInfo.encode(o.attributeInfos[p],l.uint32(34).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAttributeMod;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.group=o.string();break;case 3:p.broadcast=o.bool();break;case 4:p.attributeInfos&&p.attributeInfos.length||(p.attributeInfos=[]),p.attributeInfos.push(t.GroupAttributeMod.AttributeInfo.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.AttributeInfo=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.key="",o.prototype.value="",o.encode=function(l,p){return p||(p=L.create()),l.key!=null&&Object.hasOwnProperty.call(l,"key")&&p.uint32(10).string(l.key),l.value!=null&&Object.hasOwnProperty.call(l,"value")&&p.uint32(18).string(l.value),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.GroupAttributeMod.AttributeInfo;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.key=l.string();break;case 2:_.value=l.string();break;default:l.skipType(7&A)}}return _},o}(),s}(),JB=t.GroupAttributeDel=function(){function s(o){if(this.attributes=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.group="",s.prototype.broadcast=!1,s.prototype.attributes=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(18).string(o.group),o.broadcast!=null&&Object.hasOwnProperty.call(o,"broadcast")&&l.uint32(24).bool(o.broadcast),o.attributes!=null&&o.attributes.length)for(var p=0;p<o.attributes.length;++p)l.uint32(34).string(o.attributes[p]);return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAttributeDel;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.group=o.string();break;case 3:p.broadcast=o.bool();break;case 4:p.attributes&&p.attributes.length||(p.attributes=[]),p.attributes.push(o.string());break;default:o.skipType(7&_)}}return p},s}(),KB=t.GroupAttributeAlt=function(){function s(o){if(this.attributeMaps=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.group="",s.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.attributeMaps=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(18).string(o.group),o.instance!=null&&Object.hasOwnProperty.call(o,"instance")&&l.uint32(24).uint64(o.instance),o.attributeMaps!=null&&o.attributeMaps.length)for(var p=0;p<o.attributeMaps.length;++p)t.GroupAttributeAlt.AttributeMap.encode(o.attributeMaps[p],l.uint32(34).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAttributeAlt;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.group=o.string();break;case 3:p.instance=o.uint64();break;case 4:p.attributeMaps&&p.attributeMaps.length||(p.attributeMaps=[]),p.attributeMaps.push(t.GroupAttributeAlt.AttributeMap.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.AttributeMap=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.key="",o.prototype.value="",o.prototype.origin="",o.prototype.ms=q.Long?q.Long.fromBits(0,0,!0):0,o.encode=function(l,p){return p||(p=L.create()),l.key!=null&&Object.hasOwnProperty.call(l,"key")&&p.uint32(10).string(l.key),l.value!=null&&Object.hasOwnProperty.call(l,"value")&&p.uint32(18).string(l.value),l.origin!=null&&Object.hasOwnProperty.call(l,"origin")&&p.uint32(26).string(l.origin),l.ms!=null&&Object.hasOwnProperty.call(l,"ms")&&p.uint32(32).uint64(l.ms),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.GroupAttributeAlt.AttributeMap;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.key=l.string();break;case 2:_.value=l.string();break;case 3:_.origin=l.string();break;case 4:_.ms=l.uint64();break;default:l.skipType(7&A)}}return _},o}(),s}(),LB=t.GroupAttributeRsp=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAttributeRsp;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;default:o.skipType(7&_)}}return p},s}(),MB=t.GroupAttributeErr=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.code=0,s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&l.uint32(16).uint32(o.code),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAttributeErr;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.code=o.uint32();break;default:o.skipType(7&_)}}return p},s}(),NB=t.GroupAttributeKeysGet=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.group="",s.encode=function(o,l){return l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.group!=null&&Object.hasOwnProperty.call(o,"group")&&l.uint32(18).string(o.group),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAttributeKeysGet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.group=o.string();break;default:o.skipType(7&_)}}return p},s}(),OB=t.GroupAttributeKeysRet=function(){function s(o){if(this.keys=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.keys=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.keys!=null&&o.keys.length)for(var p=0;p<o.keys.length;++p)l.uint32(18).string(o.keys[p]);return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.GroupAttributeKeysRet;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.keys&&p.keys.length||(p.keys=[]),p.keys.push(o.string());break;default:o.skipType(7&_)}}return p},s}(),PB=t.SubscribeUserStatus=function(){function s(o){if(this.users=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.users=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.users!=null&&o.users.length)for(var p=0;p<o.users.length;++p)l.uint32(18).string(o.users[p]);return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.SubscribeUserStatus;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.users&&p.users.length||(p.users=[]),p.users.push(o.string());break;default:o.skipType(7&_)}}return p},s}(),QB=t.UnsubscribeUserStatus=function(){function s(o){if(this.users=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.users=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.users!=null&&o.users.length)for(var p=0;p<o.users.length;++p)l.uint32(18).string(o.users[p]);return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UnsubscribeUserStatus;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.users&&p.users.length||(p.users=[]),p.users.push(o.string());break;default:o.skipType(7&_)}}return p},s}(),RB=t.UserJoinNotice=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.user="",s.encode=function(o,l){return l||(l=L.create()),o.instance!=null&&Object.hasOwnProperty.call(o,"instance")&&l.uint32(8).uint64(o.instance),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(16).uint64(o.seq),o.user!=null&&Object.hasOwnProperty.call(o,"user")&&l.uint32(26).string(o.user),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserJoinNotice;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.instance=o.uint64();break;case 2:p.seq=o.uint64();break;case 3:p.user=o.string();break;default:o.skipType(7&_)}}return p},s}(),SB=t.UserQuitNotice=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.user="",s.encode=function(o,l){return l||(l=L.create()),o.instance!=null&&Object.hasOwnProperty.call(o,"instance")&&l.uint32(8).uint64(o.instance),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(16).uint64(o.seq),o.user!=null&&Object.hasOwnProperty.call(o,"user")&&l.uint32(26).string(o.user),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserQuitNotice;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.instance=o.uint64();break;case 2:p.seq=o.uint64();break;case 3:p.user=o.string();break;default:o.skipType(7&_)}}return p},s}(),TB=t.UserWaitNotice=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.instance=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.user="",s.encode=function(o,l){return l||(l=L.create()),o.instance!=null&&Object.hasOwnProperty.call(o,"instance")&&l.uint32(8).uint64(o.instance),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(16).uint64(o.seq),o.user!=null&&Object.hasOwnProperty.call(o,"user")&&l.uint32(26).string(o.user),l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.UserWaitNotice;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.instance=o.uint64();break;case 2:p.seq=o.uint64();break;case 3:p.user=o.string();break;default:o.skipType(7&_)}}return p},s}(),UB=t.SubscribeResponse=function(){function s(o){if(this.errors=[],o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.seq=q.Long?q.Long.fromBits(0,0,!0):0,s.prototype.errors=q.emptyArray,s.encode=function(o,l){if(l||(l=L.create()),o.seq!=null&&Object.hasOwnProperty.call(o,"seq")&&l.uint32(8).uint64(o.seq),o.errors!=null&&o.errors.length)for(var p=0;p<o.errors.length;++p)t.SubscribeResponse.SubscribeErrorsType.encode(o.errors[p],l.uint32(18).fork()).ldelim();return l},s.decode=function(o,l){o instanceof u||(o=u.create(o)),l=l===void 0?o.len:o.pos+l;for(var p=new t.SubscribeResponse;o.pos<l;){var _=o.uint32();switch(_>>>3){case 1:p.seq=o.uint64();break;case 2:p.errors&&p.errors.length||(p.errors=[]),p.errors.push(t.SubscribeResponse.SubscribeErrorsType.decode(o,o.uint32()));break;default:o.skipType(7&_)}}return p},s.SubscribeErrorsType=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.account="",o.prototype.code=0,o.encode=function(l,p){return p||(p=L.create()),l.account!=null&&Object.hasOwnProperty.call(l,"account")&&p.uint32(10).string(l.account),l.code!=null&&Object.hasOwnProperty.call(l,"code")&&p.uint32(16).uint32(l.code),p},o.decode=function(l,p){l instanceof u||(l=u.create(l)),p=p===void 0?l.len:l.pos+p;for(var _=new t.SubscribeResponse.SubscribeErrorsType;l.pos<p;){var A=l.uint32();switch(A>>>3){case 1:_.account=l.string();break;case 2:_.code=l.uint32();break;default:l.skipType(7&A)}}return _},o}(),s}(),VB=Object.freeze({__proto__:null,URI:YA,Wrapper:Oh,Ping:ZA,Pong:$A,UserJoin:aB,UserResp:bB,UserQuit:cB,UserDrop:dB,GroupEnter:eB,GroupLeave:fB,GroupReply:gB,GroupLeaveNotice:ur,GroupEnterNotice:vr,Message:wr,Ack:xr,FileUploadIndexGet:hB,FileUploadIndexRet:iB,FileUploadIndexSet:jB,FileUploadIndexFin:kB,FileUploadIndexErr:lB,FileDownloadIndexGet:mB,FileDownloadIndexRet:nB,FileDownloadIndexErr:oB,GroupAllUsersList:pB,GroupAllUsersResult:qB,UserStatusList:rB,UserStatusResult:sB,UserAttributeGet:tB,UserAttributeRet:uB,UserAttributeSet:vB,UserAttributeMod:wB,UserAttributeDel:xB,UserAttributeErr:yB,UserAttributeKeysGet:zB,UserAttributeKeysRet:AB,UserAttributeRsp:BB,GroupStatusList:CB,GroupStatusResult:DB,GroupCountNotice:EB,GroupAttributeGet:FB,GroupAttributeRet:GB,GroupAttributeSet:HB,GroupAttributeMod:IB,GroupAttributeDel:JB,GroupAttributeAlt:KB,GroupAttributeRsp:LB,GroupAttributeErr:MB,GroupAttributeKeysGet:NB,GroupAttributeKeysRet:OB,SubscribeUserStatus:PB,UnsubscribeUserStatus:QB,UserJoinNotice:RB,UserQuitNotice:SB,UserWaitNotice:TB,SubscribeResponse:UB,default:t}),WB=Math.ceil,yr=function(s){return function(o,l,p){var _=(o=String(jb(o))).length;return p=p===void 0?" ":String(p),(l=ta(l))<=_||p==""?o:(l-=_,(_=Pn.call(p,WB(l/p.length))).length>l&&(_=_.slice(0,l)),s?o+_:_+o)}},XB=yr(!1),YB=yr(!0),zr=/Version\/10(?:\.\d+){1,2}(?: [\w./]+)?(?: Mobile\/\w+)? Safari\//.test(De);N({target:"String",proto:!0,forced:zr},{padEnd:function(s){return YB(this,s,1<arguments.length?arguments[1]:void 0)}});var ZB=zf,Ar=function(s){return function(o){o=qb(o);for(var l,p=Dc(o),_=p.length,A=0,k=[];_>A;)l=p[A++],ka&&!ZB.call(o,l)||k.push(s?[l,o[l]]:o[l]);return k}},$B=Ar(!0),aC=Ar(!1);N({target:"Object",stat:!0},{entries:function(s){return $B(s)}});var bC=Fb.f,Br="".endsWith,cC=Math.min,Cr=dk("endsWith"),dC=!Cr&&!!function(){var s=bC(String.prototype,"endsWith");return s&&!s.writable}();N({target:"String",proto:!0,forced:!dC&&!Cr},{endsWith:function(s){var o=String(jb(this));ck(s);var l=1<arguments.length?arguments[1]:void 0,p=ta(o.length);return l=l===void 0?p:cC(ta(l),p),p=String(s),Br?Br.call(o,p,l):o.slice(l-p.length,l)===p}}),dh("match",1,function(s,o,l){return[function(p){var _=jb(this),A=p==null?void 0:p[s];return A!==void 0?A.call(p,_):new RegExp(p)[s](String(_))},function(p){var _=l(o,p,this);if(_.done)return _.value;if(p=va(p),_=String(this),!p.global)return Ke(p,_);var A=p.unicode;p.lastIndex=0;for(var k,j=[],B=0;(k=Ke(p,_))!==null;)k=String(k[0]),j[B]=k,k===""&&(p.lastIndex=xj(_,ta(p.lastIndex),A)),B++;return B===0?null:j}]});var eC=Fb.f,Dr="".startsWith,fC=Math.min,Er=dk("startsWith"),gC=!Er&&!!function(){var s=eC(String.prototype,"startsWith");return s&&!s.writable}();N({target:"String",proto:!0,forced:!gC&&!Er},{startsWith:function(s){var o=String(jb(this));ck(s);var l=ta(fC(1<arguments.length?arguments[1]:void 0,o.length)),p=String(s);return Dr?Dr.call(o,p,l):o.slice(l,l+p.length)===p}});var Nm=function(s){var o=/(%?)(%([jds]))/g,l=Array.prototype.slice.call(arguments,1);return l.length&&(s=s.replace(o,function(p,_,A,k){switch(A=l.shift(),k){case"s":A=""+A;break;case"d":A=Number(A);break;case"j":A=JSON.stringify(A)}return _?(l.unshift(A),p):A})),l.length&&(s+=" "+l.join(" ")),""+(s=s.replace(/%{2,2}/g,"%"))},hC=/\s/,iC=function(s){for(var o=s.length;o--&&hC.test(s.charAt(o)););return o},jC=/^\s+/,Fr=NaN,kC=/^[-+]0x[0-9a-f]+$/i,lC=/^0b[01]+$/i,mC=/^0o[0-7]+$/i,nC=parseInt,gl=function(s){if(typeof s=="number")return s;if(ie(s))return Fr;if(lb(s)&&(s=typeof s.valueOf=="function"?s.valueOf():s,s=lb(s)?s+"":s),typeof s!="string")return s===0?s:+s;s=s&&s.slice(0,iC(s)+1).replace(jC,"");var o=lC.test(s);return o||mC.test(s)?nC(s.slice(2),o?2:8):kC.test(s)?Fr:+s},oC=Math.max,pC=Math.min,qC=function(s,o,l){function p(_f){var e_=B,u_=z;return B=z=void 0,_o=_f,Vt=s.apply(u_,e_)}function _(_f){var e_=_f-_n;return _f-=_o,_n===void 0||e_>=o||0>e_||_d&&_f>=_p}function A(){var _f=Cb.Date.now();if(_(_f))return k(_f);var e_=setTimeout,u_=_f-_o;_f=o-(_f-_n),u_=_d?pC(_f,_p-u_):_f,_e=e_(A,u_)}function k(_f){return _e=void 0,_h&&B?p(_f):(B=z=void 0,Vt)}function j(){var _f=Cb.Date.now(),e_=_(_f);if(B=arguments,z=this,_n=_f,e_){if(_e===void 0)return _o=_f=_n,_e=setTimeout(A,o),_c?p(_f):Vt;if(_d)return clearTimeout(_e),_e=setTimeout(A,o),p(_n)}return _e===void 0&&(_e=setTimeout(A,o)),Vt}var B,z,Vt,_e,_n,_o=0,_c=!1,_d=!1,_h=!0;if(typeof s!="function")throw new TypeError("Expected a function");if(o=gl(o)||0,lb(l)){_c=!!l.leading;var _p=(_d="maxWait"in l)?oC(gl(l.maxWait)||0,o):_p;_h="trailing"in l?!!l.trailing:_h}return j.cancel=function(){_e!==void 0&&clearTimeout(_e),_o=0,B=_n=z=_e=void 0},j.flush=function(){return _e===void 0?Vt:k(Cb.Date.now())},j},yc=function(s){function o(p,_){return W(this,o),m(n(p=l.call(this,Mm(p,_))),"originalError",void 0),m(n(p),"code",void 0),m(n(p),"serverCode",void 0),typeof _=="number"?p.code=_:typeof _=="string"?p.name=_:_!==void 0&&(_.originalError&&(p.originalError=_.originalError),_.code!==void 0&&(p.code=_.code),_.serverCode!==void 0&&(p.serverCode=_.serverCode)),p}la(o,s);var l=ma(o);return o}(ef(Error)),Ia=function(s){function o(p,_){return W(this,o),m(n(p=l.call(this,Mm(p,_))),"name","RtmInternalError"),m(n(p),"code",void 0),p.code=_,p}la(o,s);var l=ma(o);return o}(ef(Error)),Ph=function(){return function(s){function o(p){W(this,o);var _=Object.keys(p);return l.call(this,p[_[0]],_[0])}la(o,s);var l=ma(o);return o}(Ia)},Fa=Ph(),db=function(s){function o(){W(this,o);for(var p=arguments.length,_=Array(p),A=0;A<p;A++)_[A]=arguments[A];return m(n(p=l.call.apply(l,[this].concat(_))),"name","RtmTimeoutError"),p}la(o,s);var l=ma(o);return o}(yc),I=function(s){function o(){W(this,o);for(var p=arguments.length,_=Array(p),A=0;A<p;A++)_[A]=arguments[A];return m(n(p=l.call.apply(l,[this].concat(_))),"name","RtmInvalidArgumentError"),p}la(o,s);var l=ma(o);return o}(yc),K=function(s){function o(){W(this,o);for(var p=arguments.length,_=Array(p),A=0;A<p;A++)_[A]=arguments[A];return m(n(p=l.call.apply(l,[this].concat(_))),"name","RtmInvalidStatusError"),p}la(o,s);var l=ma(o);return o}(yc),hl=function(s){function o(){W(this,o);for(var p=arguments.length,_=Array(p),A=0;A<p;A++)_[A]=arguments[A];return m(n(p=l.call.apply(l,[this].concat(_))),"name","RtmInterruptedError"),p}la(o,s);var l=ma(o);return o}(yc),ib=function(s){function o(){W(this,o);for(var p=arguments.length,_=Array(p),A=0;A<p;A++)_[A]=arguments[A];return m(n(p=l.call.apply(l,[this].concat(_))),"name","RtmLimitExceededError"),p}la(o,s);var l=ma(o);return o}(yc),rC=function(s){function o(){W(this,o);for(var p=arguments.length,_=Array(p),A=0;A<p;A++)_[A]=arguments[A];return m(n(p=l.call.apply(l,[this].concat(_))),"name","RtmInvokeTooOftenError"),p}la(o,s);var l=ma(o);return o}(yc),da=function(s){function o(){W(this,o);for(var p=arguments.length,_=Array(p),A=0;A<p;A++)_[A]=arguments[A];return m(n(p=l.call.apply(l,[this].concat(_))),"name","RtmUnavailableError"),m(n(p),"serverCode",void 0),m(n(p),"statusCode",void 0),p}la(o,s);var l=ma(o);return o}(yc),Ye=function(s){function o(){W(this,o);for(var p=arguments.length,_=Array(p),A=0;A<p;A++)_[A]=arguments[A];return m(n(p=l.call.apply(l,[this].concat(_))),"name","RtmUnauthenticatedError"),m(n(p),"serverCode",void 0),p}la(o,s);var l=ma(o);return o}(yc),Wc=function(s){function o(){W(this,o);for(var p=arguments.length,_=Array(p),A=0;A<p;A++)_[A]=arguments[A];return m(n(p=l.call.apply(l,[this].concat(_))),"name","RtmUnknownError"),p}la(o,s);var l=ma(o);return o}(yc),Sa=function(s){return s instanceof db||s instanceof pb},sa=function(s){return s instanceof yc},Yd=function(s,o,l){return['Executing "%s.%s" timed out after %ds',s,o,l/1e3]},Lm=new Map,sC=function(){var s=new Date;return"".concat(s.toISOString().split("T")[1].replace(/\..+/,""),".").concat(s.getMilliseconds())},xf=Object.keys,Hg=Object.entries.bind(Object),Cg=function(s){return typeof s=="string"?s.endsWith(".")?s:"".concat(s,"."):s},Sm=function(s){for(var o="",l=(s=new Uint8Array(s)).byteLength,p=-1;++p<l;)o+=String.fromCharCode(s[p]);return o=btoa(o),"data:;base64,".concat(o)},tC=R(function(){return new Date(NaN).toJSON()!==null||Date.prototype.toJSON.call({toISOString:function(){return 1}})!==1});N({target:"Date",proto:!0,forced:tC},{toJSON:function(s){s=Qa(this);var o=lc(s);return typeof o!="number"||isFinite(o)?s.toISOString():null}}),N({target:"URL",proto:!0,enumerable:!0},{toJSON:function(){return URL.prototype.toString.call(this)}});var $t=Object.prototype.hasOwnProperty,Gr=function(s,o,l){return JSON.stringify(Ym(s),o,l)};Gr.ensureProperties=Ym;var uC=function(s,o){o=o||{};var l=X(s);if(l==="string"&&0<s.length)return au(s);if(l==="number"&&isFinite(s))return o.long?s=864e5<=(o=Math.abs(s))?Jg(s,o,864e5,"day"):36e5<=o?Jg(s,o,36e5,"hour"):6e4<=o?Jg(s,o,6e4,"minute"):1e3<=o?Jg(s,o,1e3,"second"):s+" ms":s=864e5<=(o=Math.abs(s))?Math.round(s/864e5)+"d":36e5<=o?Math.round(s/36e5)+"h":6e4<=o?Math.round(s/6e4)+"m":1e3<=o?Math.round(s/1e3)+"s":s+"ms",s;throw Error("val is not a non-empty string or a valid number. val="+JSON.stringify(s))},vC=function(s){function o(_){function A(){for(var B=arguments.length,z=Array(B),Vt=0;Vt<B;Vt++)z[Vt]=arguments[Vt];if(A.enabled){B=Number(new Date),A.diff=B-(k||B),A.prev=k,k=A.curr=B,z[0]=o.coerce(z[0]),typeof z[0]!="string"&&z.unshift("%O");var _e=0;z[0]=z[0].replace(/%([a-zA-Z%])/g,function(_n,_o){return _n==="%%"?"%":(_e++,typeof(_o=o.formatters[_o])=="function"&&(_n=_o.call(A,z[_e]),z.splice(_e,1),_e--),_n)}),o.formatArgs.call(A,z),(A.log||o.log).apply(A,z)}}var k,j=null;return A.namespace=_,A.useColors=o.useColors(),A.color=o.selectColor(_),A.extend=l,A.destroy=o.destroy,Object.defineProperty(A,"enabled",{enumerable:!0,configurable:!1,get:function(){return j===null?o.enabled(_):j},set:function(B){j=B}}),typeof o.init=="function"&&o.init(A),A}function l(_,A){return(_=o(this.namespace+(A===void 0?":":A)+_)).log=this.log,_}function p(_){return _.toString().substring(2,_.toString().length-2).replace(/\.\*\?$/,"*")}return o.debug=o,o.default=o,o.coerce=function(_){return _ instanceof Error?_.stack||_.message:_},o.disable=function(){var _=[].concat(G(o.names.map(p)),G(o.skips.map(p).map(function(A){return"-"+A}))).join(",");return o.enable(""),_},o.enable=function(_){o.save(_),o.names=[],o.skips=[];var A,k=(typeof _=="string"?_:"").split(/[\s,]+/),j=k.length;for(A=0;A<j;A++)k[A]&&((_=k[A].replace(/\*/g,".*?"))[0]==="-"?o.skips.push(new RegExp("^"+_.substr(1)+"$")):o.names.push(new RegExp("^"+_+"$")))},o.enabled=function(_){if(_[_.length-1]==="*")return!0;var A,k=0;for(A=o.skips.length;k<A;k++)if(o.skips[k].test(_))return!1;for(k=0,A=o.names.length;k<A;k++)if(o.names[k].test(_))return!0;return!1},o.humanize=uC,o.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(s).forEach(function(_){o[_]=s[_]}),o.names=[],o.skips=[],o.formatters={},o.selectColor=function(_){for(var A=0,k=0;k<_.length;k++)A=(A<<5)-A+_.charCodeAt(k),A|=0;return o.colors[Math.abs(A)%o.colors.length]},o.enable(o.load()),o},Hr=$a(function(s,o){o.formatArgs=function(p){if(p[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+p[0]+(this.useColors?"%c ":" ")+"+"+s.exports.humanize(this.diff),this.useColors){var _="color: "+this.color;p.splice(1,0,_,"color: inherit");var A=0,k=0;p[0].replace(/%[a-zA-Z%]/g,function(j){j!=="%%"&&(A++,j==="%c"&&(k=A))}),p.splice(k,0,_)}},o.save=function(p){try{p?o.storage.setItem("debug",p):o.storage.removeItem("debug")}catch{}},o.load=function(){try{var p=o.storage.getItem("debug")}catch{}return!p&&typeof process<"u"&&"env"in process&&(p=define_process_env_default.DEBUG),p},o.useColors=function(){return!(typeof window>"u"||!window.process||window.process.type!=="renderer"&&!window.process.__nwjs)||(typeof navigator>"u"||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&(typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))};t:{try{var l=localStorage;break t}catch{}l=void 0}o.storage=l,o.destroy=function(){var p=!1;return function(){p||(p=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}}(),o.colors="#0000CC #0000FF #0033CC #0033FF #0066CC #0066FF #0099CC #0099FF #00CC00 #00CC33 #00CC66 #00CC99 #00CCCC #00CCFF #3300CC #3300FF #3333CC #3333FF #3366CC #3366FF #3399CC #3399FF #33CC00 #33CC33 #33CC66 #33CC99 #33CCCC #33CCFF #6600CC #6600FF #6633CC #6633FF #66CC00 #66CC33 #9900CC #9900FF #9933CC #9933FF #99CC00 #99CC33 #CC0000 #CC0033 #CC0066 #CC0099 #CC00CC #CC00FF #CC3300 #CC3333 #CC3366 #CC3399 #CC33CC #CC33FF #CC6600 #CC6633 #CC9900 #CC9933 #CCCC00 #CCCC33 #FF0000 #FF0033 #FF0066 #FF0099 #FF00CC #FF00FF #FF3300 #FF3333 #FF3366 #FF3399 #FF33CC #FF33FF #FF6600 #FF6633 #FF9900 #FF9933 #FFCC00 #FFCC33".split(" "),o.log=console.debug||console.log||function(){},s.exports=vC(o),s.exports.formatters.j=function(p){try{return JSON.stringify(p)}catch(_){return"[UnexpectedJSONParseError]: "+_.message}}}),Ir=Hr("RTM:DEBUG"),Ze;Ir.enabled=!1,function(s){s[s.Uploading=0]="Uploading",s[s.Free=1]="Free"}(Ze||(Ze={}));var wC=function(){function s(o){W(this,s),m(this,"uploadRequest",void 0),m(this,"uploadState",void 0),m(this,"uploadResendCount",void 0),m(this,"LogCache",void 0),m(this,"LogsToPost",void 0),m(this,"processId",void 0),m(this,"sdkVersion",void 0),m(this,"logId",void 0),m(this,"rtmConfig",void 0),this.processId=o.processId,this.sdkVersion=o.sdkVersion,this.rtmConfig=o.rtmConfig,this.uploadRequest=o.uploadRequest,this.uploadState=Ze.Free,this.uploadResendCount=0,this.LogCache=[],this.LogsToPost=[],this.logId=0}return Ha(s,[{key:"upload",value:function(o){this.LogCache.push(o),this.uploadState===Ze.Free&&(this.LogsToPost=40>this.LogCache.length?this.LogCache.splice(0,this.LogCache.length):this.LogCache.splice(0,40),this.postLog(this.LogsToPost))}},{key:"postLog",value:function(o){var l=this;this.uploadState=Ze.Uploading,setTimeout(J(w.mark(function p(){var _,A,k;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:return _={sdk_version:l.sdkVersion,process_id:l.processId,payload:JSON.stringify(o)},j.prev=1,j.next=4,l.uploadRequest(_,(A=l.rtmConfig.enableCloudProxy)!==null&&A!==void 0&&A);case 4:if(!Uk){j.next=6;break}throw Error("RTM is busy");case 6:j.next=13;break;case 8:return j.prev=8,j.t0=j.catch(1),k=2>l.uploadResendCount++?2e3:1e4,setTimeout(function(){return l.postLog(l.LogsToPost)},k),j.abrupt("return");case 13:if(Ir('The logs uploaded for "process-'.concat(gg,'"')),l.LogCache.length!==0){j.next=17;break}return l.uploadState=Ze.Free,j.abrupt("return");case 17:l.uploadResendCount=0,l.LogsToPost=40>l.LogCache.length?l.LogCache.splice(0,l.LogCache.length):l.LogCache.splice(0,40),l.postLog(l.LogsToPost);case 20:case"end":return j.stop()}},p,null,[[1,8]])})),Zd.getParameter("LOG_UPLOAD_INTERVAL"))}}]),s}(),Jr=function(s,o,l,p,_,A,k,j){var B=0;for(k=!!k&&Id(k,j,3);B<p;){if(B in l){if(j=k?k(l[B],B,o):l[B],0<A&&gd(j))_=Jr(s,o,j,ta(j.length),_,A-1)-1;else{if(9007199254740991<=_)throw TypeError("Exceed the acceptable array length");s[_]=j}_++}B++}return _},xC=Jr;N({target:"Array",proto:!0},{flat:function(){var s=arguments.length?arguments[0]:void 0,o=Qa(this),l=ta(o.length),p=Sg(o,0);return p.length=xC(p,o,o,l,0,s===void 0?1:$b(s)),p}}),N({target:"Object",stat:!0},{values:function(s){return aC(s)}});var yC=["CODE"],Db,ud,F;(function(s){s.CHINA="CN",s.ASIA="AS",s.NORTH_AMERICA="NA",s.EUROPE="EU",s.JAPAN="JP",s.INDIA="IN",s.OCEANIA="OC",s.SOUTH_AMERICA="SA",s.AFRICA="AF",s.OVERSEA="OVERSEA",s.GLOBAL="GLOBAL"})(F||(F={}));var zC={CN:F.CHINA,NA:F.NORTH_AMERICA,EU:F.EUROPE,AS:F.ASIA,JP:F.JAPAN,IN:F.INDIA,GLOB:F.GLOBAL,AF:F.AFRICA,OC:F.OVERSEA,OVS:F.OVERSEA,SA:F.SOUTH_AMERICA},Kg=Wm((Db={},m(Db,F.ASIA,{CODE:F.ASIA,AP_DOMAINS:["ap-web-1-asia.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-asia.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_AP:["proxy-ap-web-asia.agora.io"],PROXY_NGINX:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.NORTH_AMERICA,{CODE:F.NORTH_AMERICA,AP_DOMAINS:["ap-web-1-north-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-north-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_AP:["proxy-ap-web-america.agora.io"],PROXY_NGINX:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.EUROPE,{CODE:F.EUROPE,AP_DOMAINS:["ap-web-1-europe.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-europe.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_AP:["proxy-ap-web-europe.agora.io"],PROXY_NGINX:["europe.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.JAPAN,{CODE:F.JAPAN,AP_DOMAINS:["ap-web-1-japan.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-japan.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_AP:["proxy-ap-web-japan.agora.io"],PROXY_NGINX:["japan.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.INDIA,{CODE:F.INDIA,AP_DOMAINS:["ap-web-1-india.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-india.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_AP:["proxy-ap-web-india.agora.io"],PROXY_NGINX:["india.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OVERSEA,{CODE:F.OVERSEA,AP_DOMAINS:["ap-web-1-oversea.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_AP:["proxy-ap-web-oversea.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.agora.io"]}),m(Db,F.GLOBAL,{CODE:F.GLOBAL,AP_DOMAINS:["ap-web-1.agora.io","ap-web-2.agora.io"],AP_BACKUP_DOMAINS:["ap-web-3.agora.io","ap-web-4.agora.io"],EVENT_REPORT_DOMAIN:["webcollector-rtm.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["webcollector-1.agora.io"],LOG_UPLOAD_SERVER:["logservice-rtm.agora.io"],PROXY_AP:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],PROXY_NGINX:["webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.OCEANIA,{CODE:F.OCEANIA,AP_DOMAINS:["ap-web-1-oceania.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-oceania.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_AP:["proxy-ap-web-oceania.agora.io"],PROXY_NGINX:["oceania.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.SOUTH_AMERICA,{CODE:F.SOUTH_AMERICA,AP_DOMAINS:["ap-web-1-south-america.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-south-america.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_AP:["proxy-ap-web-south-america.agora.io"],PROXY_NGINX:["south-america.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.AFRICA,{CODE:F.AFRICA,AP_DOMAINS:["ap-web-1-africa.agora.io"],AP_BACKUP_DOMAINS:["ap-web-2-africa.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_AP:["proxy-ap-web-africa.agora.io"],PROXY_NGINX:["africa.webrtc-cloud-proxy.sd-rtn.com"]}),m(Db,F.CHINA,{CODE:F.CHINA,AP_DOMAINS:["webrtc2-2.ap.sd-rtn.com"],AP_BACKUP_DOMAINS:["webrtc2-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_AP:["proxy-ap-web.agoraio.cn"],PROXY_NGINX:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),Db)),yf=(ud={},m(ud,F.ASIA,[F.CHINA,F.JAPAN,F.INDIA]),m(ud,F.EUROPE,[]),m(ud,F.NORTH_AMERICA,[]),m(ud,F.SOUTH_AMERICA,[]),m(ud,F.OCEANIA,[]),m(ud,F.AFRICA,[]),ud),Kr=[F.OVERSEA,F.GLOBAL,F.CHINA,F.NORTH_AMERICA,F.EUROPE,F.ASIA,F.JAPAN,F.INDIA,F.OCEANIA,F.SOUTH_AMERICA,F.AFRICA],Zm=function(s){return Object.values(yf).flat().includes(s)},cu=function(s){var o;return(o=Hg(yf).find(function(l){return(l=ra(l,2))[0],l[1].includes(s)}))===null||o===void 0?void 0:o[0]},AC=function(s){return s.sort(function(o,l){return Kr.indexOf(o)-Kr.indexOf(l)})},xe=function(s){var o=new Set;if((s=AC(s).slice(0,3).map(function(l){var p=Kg[l];if(p===void 0)throw new Ia("invalid area key");return l=p.CODE,p=ff(p,yC),o.add(l),p})).length===0)throw new Ia("areas cannot be empty");return ua({CODES:o},s.reduce(function(l,p){for(var _=0,A=Hg(l);_<A.length;_++){var k=ra(A[_],2),j=k[0];k=k[1],l[j]=Array.from(new Set([].concat(G(p[j]),G(k))))}return l}))},M,Lr=function(){var s=J(w.mark(function o(l,p){var _,A,k,j,B,z=arguments;return w.wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:if(!(2<(A=2<z.length&&z[2]!==void 0?z[2]:0))){Vt.next=3;break}return Vt.abrupt("return");case 3:return k={withCredentials:!0,body:l,timeout:2e4},j=0<A?(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"rtm.logservice.sd-rtn.com":(M==null?void 0:M.LOG_UPLOAD_SERVER[0])||"logservice-rtm.agora.io",B=p?"https://".concat((_=M==null?void 0:M.PROXY_NGINX[0])!==null&&_!==void 0?_:"webrtc-cloud-proxy.sd-rtn.com","/ls/?h=").concat(j,"&p=443&d=upload/v1"):"https://".concat(j,"/upload/v1"),Vt.next=8,te(B,k).catch(function(_e){return Lr(l,p,A+1)});case 8:case"end":return Vt.stop()}},o)}));return function(o,l){return s.apply(this,arguments)}}(),Mr=new wC({processId:"process-".concat(gg),sdkVersion:"Agora_RTM_SDK_for_Web_".concat("v1.4.3-17-g1e27aa38"),uploadRequest:Lr,rtmConfig:{}}),il="text payload rawMessage thumbnail attributeInfos keys value extra".split(" "),Nr="account ticket uid detail token account fileName cname user group key origin users src dst lastUpdateUserId channel cert wan_ip".split(" "),Or="serverReceivedTs isOfflineMessage enableHistoricalMessaging enableOfflineMessaging hasPeerReceived messageType enableNotificationToChannelMembers lastUpdateTs".split(" "),BC="ChannelMessage MemberLeft MessageFromPeer LocalInvitationRefused LocalInvitationAccepted RemoteInvitationCanceled PeersOnlineStatusChanged AttributesUpdated MemberJoined".split(" "),ye=function(s){if(typeof s=="string")return oa(s);if(Array.isArray(s)&&s.every(function(A){return typeof A=="string"}))return s.map(function(A){return oa(A)});if(!Il(s)){for(var o={},l=0;l<Or.length;l++){var p=Or[l];p in s&&(o[p]=s[p])}if(0<Object.keys(o).length)return o;if(5>Object.keys(s).length){for(l=0,s=Object.entries(s);l<s.length;l++){var _=ra(s[l],2);p=_[0],_=_[1],il.includes(p)?o[p]="[Hidden Info]":o[oa(p)]=typeof _=="string"?oa(_):"[Sensitive Info]"}return o}return"[Sensitive Info]"}return s},Pr=function(s){return X(s)==="object"?yd(s)?Vm(fe(s,5),il,Nr):s.constructor&&s.constructor.name:s},Qr=function(s,o){return s instanceof Error?s.message:typeof s!="string"?JSON.stringify(Vm(fe(s,5),il,Nr)):(o=o.map(function(l){return l instanceof Error?l.message:X(l)==="object"?Gr(Array.isArray(l)?l.map(Pr):Pr(l)):l}),Nm.apply(void 0,[s.replace(/%[%Oo]/g,function(l){return l==="%%"?"%":l==="%o"||l==="%O"?"%s":l})].concat(G(o))))},CC=1,Rr=function(s,o,l){var p=Hr(s);return p.enabled=!0,p.log=l,p.useColors=!1,function(_){for(var A=arguments.length,k=Array(1<A?A-1:0),j=1;j<A;j++)k[j-1]=arguments[j];if(o.enableLogUpload){A=Cg(_);var B=Qr(A,k);Mr.upload({log_item_id:"".concat(CC++),log_level:s,payload_str:"[".concat(sC(),"] ").concat(s," - ").concat(256<B.length?B.slice(0,256):B)})}switch(A=function(z){var Vt=B||Qr(Cg(_),k),_e=Nc.LOG_HANDLER;typeof _e=="function"&&_e({level:z,message:Vt}),p(Vt)},s){case"RTM:INFO":o.logFilter.info&&A("log");break;case"RTM:WARN":o.logFilter.warn&&A("warning");break;case"RTM:ERROR":o.logFilter.error&&A("error");break;case"RTM:TRACK":o.logFilter.track&&A("log");break;case"RTM:MSG:RECV":case"RTM:MSG:SEND":o.logFilter.debug&&A("debug");break;case"RTM:DEBUG":o.logFilter.debug&&A("debug")}}},jl,Sr=function(s){return function(o){var l=jl===1||s===void 0?"":"Ins#".concat(s," ");return"".concat(l).concat(o)}},kl=function(s,o,l){var p=Sr(jl);return Rr("RTM:".concat(o),l,function(_){return s(p(_))})},tb=function(){return function(s){function o(p,_){var A=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,o);var k=l.call(this);if(m(n(k),"logError",void 0),m(n(k),"invokeTracker",void 0),m(n(k),"resultTracker",void 0),m(n(k),"errorTracker",void 0),m(n(k),"eventTracker",void 0),m(n(k),"info",void 0),m(n(k),"warn",void 0),m(n(k),"log",void 0),m(n(k),"genLogger",void 0),m(n(k),"loggerId",void 0),m(n(k),"logger",void 0),m(n(k),"name",void 0),k.logger=p,k.name=_,k.loggerId=p.loggerId,k.info=p.info,k.warn=p.warn,k.logError=p.logError,k.genLogger=p.genLogger,k.log=p.genLogger("RTM:DEBUG","<".concat(_,"> ")),k.invokeTracker=p.genTracker("Invoke"),k.eventTracker=p.genTracker("Event"),k.resultTracker=p.genTracker("Result"),k.errorTracker=p.genTracker("Error"),A){var j=k.emit.bind(n(k));k.emit=function(){for(var B=arguments.length,z=Array(B),Vt=0;Vt<B;Vt++)z[Vt]=arguments[Vt];B=z[0],Vt=z.slice(1);var _e=BC.includes(B);k.eventTracker.apply(k,["%s: ".concat(0<Vt.length?"%s emitted with args: ".concat(Vt.map(function(){return"%o"})):"%s emitted"),_,B].concat(G(_e?Vt.map(ye):Vt)));try{j.apply(void 0,z)}catch(_n){k.logError("Caught in the callback function of the event %s",B,_n)}}}return k}la(o,s);var l=ma(o);return o}(ea)},DC=function(s){return kl(console.log.bind(console),"INFO",s)},EC=function(s){return kl(console.warn.bind(console),"WARN",s)},FC=function(s){return kl(console.error.bind(console),"ERROR",s)},Tr=function(s,o){return function(l){var p=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"",_=Sr(s),A=console.debug.bind(console),k=Rr(l,o,function(j){return A(_(j))});return function(j){for(var B=arguments.length,z=Array(1<B?B-1:0),Vt=1;Vt<B;Vt++)z[Vt-1]=arguments[Vt];return k.apply(void 0,[p+j].concat(z))}}},GC=function(s,o){return function(l){return Tr(s,o)("RTM:TRACK","[".concat(l,"] "))}},Li=t.URI,eu=Oh,HC=ff(VB,["Wrapper"]),$m=Gk(HC,"URI"),Ur=function(s,o){var l=-1,p=s.length,_=p-1;for(o=o===void 0?p:o;++l<o;){var A=s[p=nr(l,_)];s[p]=s[l],s[l]=A}return s.length=o,s},IC=function(s){return Ur(Xh(s))},JC=function(s){return Ur(Ni(s))},$e=function(s){return(Va(s)?IC:JC)(s)},af={0:9591,1:9593},$d=function(s){return"https://".concat(s,"/api/v1")},KC=bb.apply(void 0,G($e(["web-1.ap.sd-rtn.com","web-2.ap.sd-rtn.com"].map($d)))),LC=bb.apply(void 0,G($e(["ap-web-1.agora.io","ap-web-2.agora.io"].map($d)))),MC=bb.apply(void 0,G($e(["web-3.ap.sd-rtn.com","web-4.ap.sd-rtn.com"].map($d)))),NC=bb.apply(void 0,G($e(["ap-web-3.agora.io","ap-web-4.agora.io"].map($d)))),ll=Ph(),ml=function(s){function o(p,_,A,k,j,B){W(this,o);var z=l.call(this,j,Ai("Socket-",j.loggerId));if(m(n(z),"isActiveClose",!1),m(n(z),"loggedIn",!1),m(n(z),"useNewDomain",void 0),m(n(z),"receivedPacket",new Pa),m(n(z),"open$",void 0),m(n(z),"input$",new Pa),m(n(z),"userJoin$",new Pa),m(n(z),"attemptsSinceLastError",0),m(n(z),"message$",new Pa),m(n(z),"socket$",void 0),m(n(z),"toClose",new Pa),m(n(z),"toReconnect",new Pa),m(n(z),"sendLogger",void 0),m(n(z),"receiveLogger",void 0),m(n(z),"ip",void 0),m(n(z),"env",void 0),m(n(z),"ticket",void 0),m(n(z),"context",void 0),m(n(z),"getDomain",function(){return an(z.ip,z.useNewDomain)}),m(n(z),"socketReconnector",function(_n){var _o=function(_c){return z.attemptsSinceLastError+=1,z.warn("The %s of Env %d reconnecting %s",z.name,z.env,_c.message),Bc(3e3)};return _n.pipe(Ga(function(_c){return z.log("socket connection closed"),z.loggedIn=!1,2<=z.attemptsSinceLastError?(z.warn("socket connection failure"),z.emit("connectionFailure"),z.close(),Z(_c)):z.isActiveClose?vb:(z.emit("reconnect"),z.useNewDomain=!z.useNewDomain,Z(_c))}),oe(function(_c){return _c.pipe(Cc(_o))}))}),z.ip=p,z.env=_,z.ticket=A,z.context=k,z.useNewDomain=B??.5<=Math.random(),z.sendLogger=z.genLogger("RTM:MSG:SEND"),z.receiveLogger=z.genLogger("RTM:MSG:RECV"),_!==0&&_!==1)throw new ll({ILLEGAL_RTM_ENV:"The env number is out of rtm env count"});if(!Gm(p))throw new ll({IP_NOT_VALID:"The ip from ap is not valid"});var Vt=af[_];z.log("Opening websocket address %s for the Env %d",z.ip,z.env);var _e=Xb(z.input$,z.userJoin$.pipe(Rt(2)),z.message$).pipe(ba(function(_n){return Oh.encode(_n).finish()}));return p=Xb(St("",{protocols:[],makeWebSocket:function(){if(z.context.config.enableCloudProxy){if(z.context.cloudProxyServers.length===0)throw z.logError("No cloud proxy server to connect"),new da;var _n="wss://".concat(an(bn(z.context.cloudProxyServers),!1),"/");_n=we(_n,"sid",z.context.sid),_n=we(_n,"remote_port",Vt.toString()),_n=we(_n,"remote_ip",z.ip),_n=we(_n,"token",z.context.key),_n=new WebSocket(_n)}else _n=new WebSocket("wss://".concat(z.getDomain(),":").concat(Vt));return _n.binaryType="arraybuffer",_n}}),z.toReconnect),z.socket$=Ca(p,Tk.pipe(hb(15e3),Ga(function(_n){return Sa(_n)&&z.warn("socket open timed out"),Z(_n)}))).pipe(ba(function(_n){if(_n instanceof Error)throw z.warn("Env_%d: Force reconnect the socket",z.env),_n;return _n(_e).pipe(ba(function(_o){return Oh.decode(new Uint8Array(_o))}))}),z.socketReconnector),z.open$=z.socket$.pipe(ca(function(_n){z.log("Websocket opened",z.name),_n.subscribe(function(_o){var _c=_o.data;_o=Li[_o.uri].slice(0,-3),_c=$m[_o].decode(_c);var _d=HA({},Gk(_c,"toJSON"),function(e_,u_){return u_ instanceof U?Km(u_):u_}),_h=!1;if((_c instanceof vr||_c instanceof ur)&&_c.instance.lessThanOrEqual(4294967295)&&(_h=!0),_c instanceof wr||_c instanceof xr){var _p=_c.instance,_f=_c.sequence;(_c.dialogue.lessThanOrEqual(4294967295)||_p.lessThanOrEqual(4294967295)||_f.lessThan(1))&&(_h=!0)}_h?z.warn("Env_%d: Illegal %s, abandoned %o",z.env,_o,_d):(_o!=="Pong"&&z.receiveLogger("Env_%d: %s %o",z.env,_o,_d),z.receivedPacket.next([_o,_c]))},function(){})}),qf(void 0),ob(z.toClose),pe()),z}la(o,s);var l=ma(o);return Ha(o,[{key:"address",get:function(){return"".concat(this.ip,":").concat(af[this.env])}},{key:"sendPacket",value:function(p,_){if(p!=="Ping"){var A=uc(_,function(k){return k instanceof U?Km(k):k});this.sendLogger("Env_%d: %s %o",this.env,p,A)}_=du(p,_),p==="UserJoin"?this.userJoin$.next(_):p==="Message"?this.message$.next(_):this.input$.next(_)}},{key:"close",value:function(){this.isActiveClose=!0,this.loggedIn=!1,this.toClose.next()}},{key:"fromReceived",value:function(p){var _=this;return this.receivedPacket.pipe(ca(function(A){var k=ra(A,2);A=k[0],k=k[1],A==="UserResp"&&(_.attemptsSinceLastError=0,_.loggedIn=!0),A==="UserDrop"&&_.emit("socketUserDrop",k)}),wb(function(A){return ra(A,1)[0]===p}),ba(function(A){return ra(A,2)[1]}))}},{key:"forceReconnect",value:function(){this.toReconnect.next(new ll({FORCE_RECONNECTING:"Connection seems broken, try force reconnecting"}))}}]),o}(tb());N({target:"String",proto:!0,forced:zr},{padStart:function(s){return XB(this,s,1<arguments.length?arguments[1]:void 0)}});var OC=function(s){var o=xf(Kg);s=Yt(s);for(var l=0;l<o.length;l++){var p=Kg[o[l]];if(p!=null&&p.AP_DOMAINS.includes(s)||p!=null&&p.AP_BACKUP_DOMAINS.includes(s)||p!=null&&p.PROXY_AP.includes(s))return[p.CODE]}return[F.CHINA,F.GLOBAL]},PC={INVALID_APP_ID:"Illegal App ID",NO_AUTHORIZED:"Signature verification failed",TOKEN_TIMEOUT:"Dynamic key expired",INVALID_TOKEN_UID:"UID in the security key(token) is not valid",APP_ID_NO_ACTIVATED:"The vendor is not activated",DYNAMIC_KEY_NOT_ENABLED:"The vendor did not enable the dynamic key, but uses the dynamic key",DYNAMIC_ENABLED_BUT_STATIC_KEY:"The vendor enabled the dynamic key, but uses the static key",TOKEN_EXPIRED:"The token has expired",INVALID_USER_ID:"The user ID to login does not match the token",FORBIDDEN_REGION:"Forbidden to access the request in this area",CANNOT_MEET_AREA_DEMAND:"Cannot allocate to meet the requirements of the given area limit"},Vr={5:"INVALID_APP_ID",7:"INVALID_USER_ID",9:"NO_AUTHORIZED",10:"TOKEN_TIMEOUT",11:"APP_ID_NO_ACTIVATED",12:"INVALID_TOKEN_UID",13:"TOKEN_EXPIRED",14:"DYNAMIC_KEY_NOT_ENABLED",15:"DYNAMIC_ENABLED_BUT_STATIC_KEY",18:"FORBIDDEN_REGION",19:"CANNOT_MEET_AREA_DEMAND"},QC=[100,101,102],Qh=/web-(\d)/,Wr=function(s){function o(p,_){var A=2<arguments.length&&arguments[2]!==void 0&&arguments[2];W(this,o);var k=l.call(this,_,"AccessPoint");return m(n(k),"handleUniLbsError",function(j,B){var z=j;if(4<j.toString().length){var Vt=j.toString().padStart(8,"0"),_e=parseInt(Vt.slice(0,4),10);if(Vt=parseInt(Vt.slice(4,8),10),_e===201)z=Vt;else if(_e===101&&!QC.includes(Vt))return Z(Error("service is currently unavailable"))}if(_e=z.toString(),!Object.keys(Vr).includes(_e))return(j=new da(["Login is rejected by the server. The response code is %d",j],jg)).serverCode=z,Z(j);switch(_e=Vr[_e],z=PC[_e],_e){case"INVALID_APP_ID":case"APP_ID_NO_ACTIVATED":return(B=new Ye(z,$q)).serverCode=j,Z(B);case"INVALID_USER_ID":return(B=new Ye(z,Jh)).serverCode=j,Z(B);case"TOKEN_EXPIRED":case"TOKEN_TIMEOUT":return(B=new Ye(z,Kh)).serverCode=j,Z(B);case"NO_AUTHORIZED":case"INVALID_TOKEN_UID":case"DYNAMIC_KEY_NOT_ENABLED":case"DYNAMIC_ENABLED_BUT_STATIC_KEY":return(B=new Ye(z,ar)).serverCode=j,Z(B);case"CANNOT_MEET_AREA_DEMAND":return(B=OC(B)).forEach(function(_n){return k.failedAreas.add(_n)}),k.failedAreas.size===(M===void 0?2:M.CODES.size)?((B=new I(z,jg)).serverCode=j,Z(B)):Z(Error("ap ".concat(B.join(", ")," cannot meet requirement")));case"FORBIDDEN_REGION":return(B=new da(z,jg)).serverCode=j,Z(B);default:return Z(Im("ApResErrType",_e))}}),m(n(k),"getApEdgeInfo$",void 0),m(n(k),"getApEdgeInfoEndFirst$",void 0),m(n(k),"apFinish$",new Pa),m(n(k),"retryCount",0),m(n(k),"failedAreas",new Set),m(n(k),"usedUrl",[]),m(n(k),"newDomainUsed",!1),m(n(k),"backupNewDomainUsed",!1),m(n(k),"genUrl",function(){return M===void 0?mi.apply(void 0,G($e([KC,LC]))).pipe(ni(function(j){return bb.apply(void 0,G(j))})):bb.apply(void 0,G(M.AP_DOMAINS.slice(0,3).map($d)))}),m(n(k),"genBackupUrl",function(){return M===void 0?mi.apply(void 0,G($e([MC,NC]))).pipe(ni(function(j){return bb.apply(void 0,G(j))})):bb.apply(void 0,G(M.AP_BACKUP_DOMAINS.slice(0,3).map($d)))}),m(n(k),"getApUrl$",function(j){var B,z;return k.genUrl().pipe(wb(function(Vt){return(!k.newDomainUsed||!Vt.includes("sd-rtn.com"))&&(Vt.includes("sd-rtn.com")&&(k.newDomainUsed=!0),!dl(k.usedUrl,function(_e){var _n;return _e===((_n=Vt.match(Qh))===null||_n===void 0?void 0:_n[1])}))}),ca(function(Vt){var _e;M===void 0&&typeof(Vt=(_e=Vt.match(Qh))===null||_e===void 0?void 0:_e[1])=="string"&&k.usedUrl.push(Vt)}),Ka(j?Math.max(Nc.RECONNECTING_AP_NUM,(B=M==null?void 0:M.CODES.size)!==null&&B!==void 0?B:0):(z=M==null?void 0:M.CODES.size)!==null&&z!==void 0?z:2),Dd(function(){return o.runOutOfUrlSymbol}),Ga(function(Vt,_e){return k.newDomainUsed=!1,Vt===o.runOutOfUrlSymbol?(k.usedUrl=[],_e):Z(Vt)}))}),m(n(k),"getBackupApUrl$",function(j){var B,z;return k.genBackupUrl().pipe(wb(function(Vt){return(!k.backupNewDomainUsed||!Vt.includes("sd-rtn.com"))&&(Vt.includes("sd-rtn.com")&&(k.backupNewDomainUsed=!0),!dl(k.usedUrl,function(_e){var _n;return _e===((_n=Vt.match(Qh))===null||_n===void 0?void 0:_n[1])}))}),ca(function(Vt){var _e;M===void 0&&typeof(Vt=(_e=Vt.match(Qh))===null||_e===void 0?void 0:_e[1])=="string"&&k.usedUrl.push(Vt)}),Ka(j?Math.max(Nc.RECONNECTING_AP_NUM,(B=M==null?void 0:M.CODES.size)!==null&&B!==void 0?B:0):(z=M==null?void 0:M.CODES.size)!==null&&z!==void 0?z:2),Dd(function(){return o.runOutOfUrlSymbol}),Ga(function(Vt,_e){return k.backupNewDomainUsed=!1,Vt===o.runOutOfUrlSymbol?(k.usedUrl=[],_e):Z(Vt)}))}),m(n(k),"getProxyApUrl$",function(j){var B,z;return bb.apply(void 0,G(((M==null?void 0:M.PROXY_AP.slice(0,3))||["ap-proxy-1.agora.io","ap-proxy-2.agora.io"]).map($d))).pipe(Ka(j?Math.max(Nc.RECONNECTING_AP_NUM,(B=M==null?void 0:M.CODES.size)!==null&&B!==void 0?B:0):(z=M==null?void 0:M.CODES.size)!==null&&z!==void 0?z:2))}),m(n(k),"context",void 0),m(n(k),"fetchCloudProxy",function(j,B){var z=Ai("AP-",k.loggerId);k.log("The AccessPoint requests %s(%s)",j,z);var Vt=new AbortController;return k.apFinish$.pipe(Ka(1)).subscribe(function(){return Vt.abort()}),ad(J(w.mark(function _e(){var _n;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:return _n=Ag(0,Number.MAX_SAFE_INTEGER),k.log("%s request opid: %d",z,_n),_o.abrupt("return",te(j,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"90","Content-Type":"application/json"},body:{sid:k.context.sid,opid:_n,appid:k.context.appId,client_ts:Math.ceil(Date.now()/1e3),request_bodies:[{uri:22,buffer:{service_ids:[7,16],key:B??k.context.key,cname:k.context.uid,uid:0,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(_c){return _c===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):_c}).join(",")})}}]},signal:Vt.signal}));case 3:case"end":return _o.stop()}},_e)}))).pipe(Ga(function(_e){return _e.name!=="AbortError"&&(k.logError(_e),k.warn("The AP server %s request failure",j,_e)),vb}),cb(function(){var _e=J(w.mark(function _n(_o){var _c,_d,_h,_p,_f,e_,u_,w_,O_,y_,Z_,NE,i_,S_,h_,I_,vf,o_,d_;return w.wrap(function(g_){for(;;)switch(g_.prev=g_.next){case 0:if(_c=_o.responseText,_d=JSON.parse(_c),k.log("The %s response is %o",z,_d),((_h=_d.response_body)===void 0||_h.length===0||_h.some(function(v_){var M_;return((M_=v_.buffer)===null||M_===void 0?void 0:M_.code)===void 0||v_.uri!==23}))&&Z(new da("cloud proxy response_body not valid",jg)),(_p=_h.filter(function(v_){return v_.buffer.code!==0})).length===0){g_.next=14;break}if((_f=_p.find(function(v_){return v_.buffer.flag===128}))===void 0){g_.next=12;break}return g_.abrupt("return",k.handleUniLbsError(_f.buffer.code,j));case 12:return k.logError("cloud proxy error response"),g_.abrupt("return",k.handleUniLbsError(_p[0].buffer.code,j));case 14:for(e_=[],u_=0;u_<_h.length;u_++)if(((y_=_h[u_])==null||(w_=y_.buffer)===null||w_===void 0?void 0:w_.flag)===262144)(Z_=y_.buffer)===null||Z_===void 0||(NE=Z_.edges_services)===null||NE===void 0||(i_=NE.forEach)===null||i_===void 0||i_.call(NE,function(v_){Gm(v_=v_.ip)&&k.context.cloudProxyServers.indexOf(v_)===-1&&(k.log("got cloud proxy server: %s",v_),k.context.cloudProxyServers.push(v_))});else if((y_==null||(O_=y_.buffer)===null||O_===void 0?void 0:O_.flag)===128){for(vf=function(v_,M_){var R_=M_[v_];e_.some(function(X_){return X_.ip===R_.ip})||e_.push({ip:R_.ip,ticket:y_.buffer.cert})},o_=0,d_=y_.buffer.edges_services;o_<d_.length;o_++)vf(o_,d_);k.context.rtmArea=(S_=(h_=y_.buffer)===null||h_===void 0||(I_=h_.detail)===null||I_===void 0?void 0:I_[9])!==null&&S_!==void 0?S_:""}return g_.abrupt("return",bb.apply(void 0,G(e_).concat([fg])));case 19:case"end":return g_.stop()}},_n)}));return function(_n){return _e.apply(this,arguments)}}()),Ga(function(_e){return sa(_e)?Z(_e):vb}),tg(),wb(function(_e){return _e!==void 0&&typeof _e.ip=="string"&&typeof _e.ticket=="string"}))}),m(n(k),"fetchAp",function(j,B){var z=Ai("AP-",k.loggerId);k.log("The AccessPoint requests %s(%s)",j,z);var Vt=new AbortController;return k.apFinish$.pipe(Ka(1)).subscribe(function(){return Vt.abort()}),ad(J(w.mark(function _e(){var _n;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:return _n=Ag(0,Number.MAX_SAFE_INTEGER),k.log("%s request opid: %d",z,_n),_o.abrupt("return",te(j,{headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"69","Content-Type":"application/json"},body:{flag:128,opid:_n,key:B||k.context.key,cname:k.context.uid,detail:ua({},M===void 0?{11:[F.CHINA,F.GLOBAL].join()}:{11:Array.from(M.CODES).map(function(_c){return _c===F.OVERSEA?"".concat(F.ASIA,",").concat(F.EUROPE,",").concat(F.AFRICA,",").concat(F.NORTH_AMERICA,",").concat(F.SOUTH_AMERICA,",").concat(F.OCEANIA):_c}).join(",")}),uid:0,sid:k.context.sid},signal:Vt.signal}));case 3:case"end":return _o.stop()}},_e)}))).pipe(Ga(function(_e){return _e.name!=="AbortError"&&(k.logError(_e),k.warn("The AP server %s request failure",j,_e)),vb}),cb(function(){var _e=J(w.mark(function _n(_o){var _c,_d,_h,_p,_f,e_,u_;return w.wrap(function(w_){for(;;)switch(w_.prev=w_.next){case 0:if(_c=_o.responseText,_d=JSON.parse(_c),k.log("The %s response is %o",z,_d),_p=(_h=_d).code,_f=_h.addresses,e_=_h.detail,_p===0){w_.next=6;break}return w_.abrupt("return",k.handleUniLbsError(_p,j));case 6:if((u_=_f).length!==0){w_.next=11;break}return w_.abrupt("return",Z(Error("No available edge address to connect")));case 11:return k.context.rtmArea=e_==null?void 0:e_[9],w_.abrupt("return",bb.apply(void 0,G(u_).concat([fg])));case 13:case"end":return w_.stop()}},_n)}));return function(_n){return _e.apply(this,arguments)}}()),tg(),Ga(function(_e){return sa(_e)?Z(_e):vb}),wb(function(_e){return _e!==void 0&&typeof _e.ip=="string"&&typeof _e.ticket=="string"}))}),k.context=p,k.getApEdgeInfoEndFirst$=function(){var j=0<arguments.length&&arguments[0]!==void 0&&arguments[0];return Bc(0,j||A?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(1),ca(function(){k.retryCount+=1}),cb(function(){return k.context.config.enableCloudProxy?k.getProxyApUrl$(j||A):(4<=k.retryCount&&(k.retryCount=0),3>=k.retryCount?k.getApUrl$(j||A):k.getBackupApUrl$(j||A))}),cb(function(B){return k.context.config.enableCloudProxy?k.fetchCloudProxy(B):k.fetchAp(B)}),Ga(function(B){return B instanceof pb&&k.warn("AP request timeout"),Z(B)}),om(function(B){return B.ip}),ob(k.apFinish$))},k.getApEdgeInfo$=function(j){return Bc(0,j||A?Nc.RECONNECTING_AP_INTERVAL:2e3).pipe(Ka(8),ca(function(){k.retryCount+=1}),cb(function(){return k.context.config.enableCloudProxy?k.getProxyApUrl$(j||A):3>=k.retryCount?k.getApUrl$(j||A):k.getBackupApUrl$(j||A)}),cb(function(B){return(k.context.config.enableCloudProxy?k.fetchCloudProxy(B):k.fetchAp(B)).pipe()}),Ga(function(B){return B instanceof pb&&k.warn("AP request timeout"),Z(B)}),om(function(B){return B.ip}),ob(k.apFinish$))},k}la(o,s);var l=ma(o);return Ha(o,[{key:"clearUp",value:function(){this.failedAreas.clear(),this.retryCount=0}}]),o}(tb());m(Wr,"runOutOfUrlSymbol",Symbol("AP urls are used up"));var Xr=Ph(),Yr=function(s){function o(p,_,A){W(this,o);var k=l.call(this,_,"Connection");m(n(k),"apClient",void 0),m(n(k),"lastOpenSockets",[new qe(1),new qe(1)]),m(n(k),"curOpenSockets",[void 0,void 0]),m(n(k),"ipIterator",0),m(n(k),"firstEnv",.5<=Math.random()?1:0),m(n(k),"firstSocketOpener",void 0),m(n(k),"secondSocketOpener",void 0),m(n(k),"firstOpenKeeperSubject",new Pa),m(n(k),"secondOpenKeeperSubject",new Pa),m(n(k),"edgeInfoReplayed",void 0),m(n(k),"firstEnvOpenSocket",void 0),m(n(k),"firstOpenKeeperSub",void 0),m(n(k),"secondOpenKeeperSub",void 0),m(n(k),"context",void 0),m(n(k),"logger",void 0),k.context=p,k.logger=_,k.apClient=new Wr(k.context,_),k.apClient.apFinish$.subscribe(function(){k.log("Ap client fetch finished")});var j,B=[];return k.edgeInfoReplayed=k.apClient.getApEdgeInfo$(A).pipe(oe(function(z){return z.pipe(ca(function(Vt){if(sa(Vt))throw Vt}),cd(A?Zd.getParameter("RECONNECTING_AP_INTERVAL"):900),ob(Bc(2e4)))}),wb(function(z){return!dl(B,z)}),Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),ca(function(z){B.push(z),k.log("An edge info got %o",z)}),ca({error:function(z){k.emit("connectionInitFailure",z)}}),wg(function(){k.apClient.clearUp()}),sm()),k.firstEnvOpenSocket=k.edgeInfoReplayed.pipe(cb(function(z){if(z===void 0)return Z(Error("Invalid edge info"));var Vt=new ml(z.ip,k.firstEnv,z.ticket,k.context,_,j);return k.firstEnv=k.firstEnv===1?0:1,Vt.on("connectionFailure",function(){return k.onSocketConnectionFailure(Vt)}),j=!Vt.useNewDomain,Vt.open$.pipe(qf(Vt))}),ca(function(z){k.log("The websocket of ENV_%d opened to %s:%d",z.env,z.ip,af[z.env]),k.curOpenSockets[z.env]=z,k.lastOpenSockets[z.env].next(z),k.firstEnv=z.env,k.openSecondSocket(z.env,z.ip,z.useNewDomain)}),Ka(1),pe()),k.firstSocketOpener=k.firstEnvOpenSocket.pipe(cb(function(z){return z.open$.pipe(ca(function(){k.log("The websocket of first ENV_%d re-opened to %s:%d",z.env,z.ip,af[z.env]),k.curOpenSockets[z.env]=z,k.lastOpenSockets[z.env].next(z)}))})),p=k.firstOpenKeeperSubject.pipe(Cc(Yc)),k.firstOpenKeeperSub=p.subscribe({error:k.logError}),k}la(o,s);var l=ma(o);return Ha(o,[{key:"initConnection",value:function(){this.firstOpenKeeperSubject.next(this.firstSocketOpener)}},{key:"closeSocket",value:function(p,_){if(![0,1].includes(p))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});var A=p===this.firstEnv?this.firstOpenKeeperSub:this.secondOpenKeeperSub;this.firstOpenKeeperSub=void 0;var k=this.curOpenSockets[p];this.curOpenSockets[p]=void 0,k&&(k.isActiveClose=!0,setTimeout(function(){k.close()},_)),A!==void 0&&setTimeout(function(){A==null||A.unsubscribe()},_)}},{key:"waitClosing",value:function(p){var _=this;return p.isActiveClose=!0,p.open$.pipe(tt(),Ga(function(A){return A.message===mr.normalClosureMessage?vb:Z(A)}),hb(5e3),Ga(function(A){return A instanceof pb?(_.warn("Force closing the ENV_%d connection",p.env),vb):Z(A)}))}},{key:"onSocketConnectionFailure",value:function(p){var _=[0,1].filter(function(A){return A!==p.env})[0];(_=this.curOpenSockets[_])&&_.loggedIn?this.reopenSocketWithApRequest(p.env):this.emit("socketsFailure")}},{key:"openSecondSocket",value:function(p,_,A){var k=this,j=p===1?0:1;this.secondSocketOpener=this.edgeInfoReplayed.pipe(rm(function(B,z){return[].concat(G(B),[z])},[]),ba(function(B){return kr(B,function(z){return Jm(_,z.ip)}).slice(-1)[0]}),Ka(1),cb(function(B){if(B===void 0)return Z(Error("Invalid edge info"));var z=new ml(B.ip,j,B.ticket,k.context,k.logger,A);return z.on("connectionFailure",function(){return k.onSocketConnectionFailure(z)}),z.open$.pipe(ca(function(){k.lastOpenSockets[j].next(z),k.curOpenSockets[j]=z}))}),pe()),this.secondOpenKeeperSub=this.secondOpenKeeperSubject.pipe(Cc(Yc)).subscribe({error:this.logError}),this.secondOpenKeeperSubject.next(this.secondSocketOpener)}},{key:"reopenSocketWithApRequest",value:function(p){var _=this,A=[0,1].filter(function(B){return B!==p})[0];if((A=this.curOpenSockets[A])!==void 0){var k,j=A.ip;A=this.apClient.getApEdgeInfoEndFirst$(!0).pipe(Dd(function(){return new Xr({AP_NO_AVAILABLE_EDGE:"No available edge address to connect"})}),oe(function(B){return B.pipe(ca(function(z){if(z.code===Kh)_.emit("tokenExpired"),_.apClient.apFinish$.next(void 0);else if(sa(z))throw z}),cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")),ob(Bc(15e3)))}),ca(function(B){_.log("An edge info got %o",B)}),wg(function(){_.apClient.clearUp()})).pipe(rm(function(B,z){return[].concat(G(B),[z])},[]),ba(function(B){return(B=kr(B,function(z){return Jm(j,z.ip)})).length-1>=_.ipIterator?B.slice(-_.ipIterator++-1)[0]:(_.ipIterator=0,B.slice(-1)[0])}),Dd(),cb(function(B){if(B===void 0)return Z(Error("Invalid edge info"));var z=new ml(B.ip,p,B.ticket,_.context,_.logger,k);return z.on("connectionFailure",function(){return _.onSocketConnectionFailure(z)}),k=!z.useNewDomain,z.open$.pipe(qf(z))}),ca(function(B){_.log("The websocket of ENV_%d re-opened to %s:%d using ap",B.env,B.ip,af[B.env]),_.curOpenSockets[p]=B,_.lastOpenSockets[p].next(B)}),cb(function(B){return B.open$.pipe(ca(function(){_.log("The websocket of ENV_%d re-opened to %s:%d",B.env,B.ip,af[B.env]),_.curOpenSockets[p]=B,_.lastOpenSockets[p].next(B)}))}),pe()),p===this.firstEnv?this.firstOpenKeeperSubject.next(A):this.secondOpenKeeperSubject.next(A)}}}]),o}(tb()),Xc=fc.Writer,na=fc.util,zc=fc.roots.default||(fc.roots.default={}),RC=zc.Session=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.sid="",s.prototype.userId="",s.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.appId="",s.prototype.ver="",s.prototype.buildno=0,s.prototype.installId="",s.prototype.os=0,s.prototype.did="",s.prototype.index=null,s.prototype.token="",s.prototype.version=0,s.prototype.subVersion=0,s.encode=function(o,l){return l||(l=Xc.create()),o.sid!=null&&Object.hasOwnProperty.call(o,"sid")&&l.uint32(10).string(o.sid),o.userId!=null&&Object.hasOwnProperty.call(o,"userId")&&l.uint32(18).string(o.userId),o.lts!=null&&Object.hasOwnProperty.call(o,"lts")&&l.uint32(24).int64(o.lts),o.elapse!=null&&Object.hasOwnProperty.call(o,"elapse")&&l.uint32(32).int64(o.elapse),o.appId!=null&&Object.hasOwnProperty.call(o,"appId")&&l.uint32(42).string(o.appId),o.ver!=null&&Object.hasOwnProperty.call(o,"ver")&&l.uint32(50).string(o.ver),o.buildno!=null&&Object.hasOwnProperty.call(o,"buildno")&&l.uint32(56).int32(o.buildno),o.installId!=null&&Object.hasOwnProperty.call(o,"installId")&&l.uint32(66).string(o.installId),o.os!=null&&Object.hasOwnProperty.call(o,"os")&&l.uint32(128).int32(o.os),o.did!=null&&Object.hasOwnProperty.call(o,"did")&&l.uint32(138).string(o.did),o.index!=null&&Object.hasOwnProperty.call(o,"index")&&zc.Session.CommonIndex.encode(o.index,l.uint32(162).fork()).ldelim(),o.token!=null&&Object.hasOwnProperty.call(o,"token")&&l.uint32(170).string(o.token),o.version!=null&&Object.hasOwnProperty.call(o,"version")&&l.uint32(176).int32(o.version),o.subVersion!=null&&Object.hasOwnProperty.call(o,"subVersion")&&l.uint32(184).int32(o.subVersion),l},s.CommonIndex=function(){function o(l){if(l)for(var p=Object.keys(l),_=0;_<p.length;++_)l[p[_]]!=null&&(this[p[_]]=l[p[_]])}return o.prototype.index1="",o.prototype.index2="",o.prototype.index3="",o.encode=function(l,p){return p||(p=Xc.create()),l.index1!=null&&Object.hasOwnProperty.call(l,"index1")&&p.uint32(10).string(l.index1),l.index2!=null&&Object.hasOwnProperty.call(l,"index2")&&p.uint32(18).string(l.index2),l.index3!=null&&Object.hasOwnProperty.call(l,"index3")&&p.uint32(26).string(l.index3),p},o}(),s}(),SC=zc.Link=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.sid="",s.prototype.userId="",s.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.ec=0,s.prototype.sc=0,s.prototype.destServerIp="",s.prototype.ackedServerIp="",s.prototype.responseTime=0,s.encode=function(o,l){return l||(l=Xc.create()),o.sid!=null&&Object.hasOwnProperty.call(o,"sid")&&l.uint32(10).string(o.sid),o.userId!=null&&Object.hasOwnProperty.call(o,"userId")&&l.uint32(18).string(o.userId),o.lts!=null&&Object.hasOwnProperty.call(o,"lts")&&l.uint32(24).int64(o.lts),o.elapse!=null&&Object.hasOwnProperty.call(o,"elapse")&&l.uint32(32).int64(o.elapse),o.ec!=null&&Object.hasOwnProperty.call(o,"ec")&&l.uint32(40).int32(o.ec),o.sc!=null&&Object.hasOwnProperty.call(o,"sc")&&l.uint32(48).int32(o.sc),o.destServerIp!=null&&Object.hasOwnProperty.call(o,"destServerIp")&&l.uint32(58).string(o.destServerIp),o.ackedServerIp!=null&&Object.hasOwnProperty.call(o,"ackedServerIp")&&l.uint32(66).string(o.ackedServerIp),o.responseTime!=null&&Object.hasOwnProperty.call(o,"responseTime")&&l.uint32(72).int32(o.responseTime),l},s}(),TC=zc.Logout=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.sid="",s.prototype.userId="",s.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,s.encode=function(o,l){return l||(l=Xc.create()),o.sid!=null&&Object.hasOwnProperty.call(o,"sid")&&l.uint32(10).string(o.sid),o.userId!=null&&Object.hasOwnProperty.call(o,"userId")&&l.uint32(18).string(o.userId),o.lts!=null&&Object.hasOwnProperty.call(o,"lts")&&l.uint32(24).int64(o.lts),o.elapse!=null&&Object.hasOwnProperty.call(o,"elapse")&&l.uint32(32).int64(o.elapse),l},s}(),UC=zc.KickedOff=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.sid="",s.prototype.userId="",s.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.linkId=0,s.prototype.code=0,s.prototype.server="",s.prototype.serverCode=0,s.encode=function(o,l){return l||(l=Xc.create()),o.sid!=null&&Object.hasOwnProperty.call(o,"sid")&&l.uint32(10).string(o.sid),o.userId!=null&&Object.hasOwnProperty.call(o,"userId")&&l.uint32(18).string(o.userId),o.lts!=null&&Object.hasOwnProperty.call(o,"lts")&&l.uint32(24).int64(o.lts),o.elapse!=null&&Object.hasOwnProperty.call(o,"elapse")&&l.uint32(32).int64(o.elapse),o.linkId!=null&&Object.hasOwnProperty.call(o,"linkId")&&l.uint32(48).int32(o.linkId),o.code!=null&&Object.hasOwnProperty.call(o,"code")&&l.uint32(56).int32(o.code),o.server!=null&&Object.hasOwnProperty.call(o,"server")&&l.uint32(66).string(o.server),o.serverCode!=null&&Object.hasOwnProperty.call(o,"serverCode")&&l.uint32(72).int32(o.serverCode),l},s}(),VC=zc.ChnJoin=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.sid="",s.prototype.userId="",s.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.cname="",s.prototype.errCode=0,s.encode=function(o,l){return l||(l=Xc.create()),o.sid!=null&&Object.hasOwnProperty.call(o,"sid")&&l.uint32(10).string(o.sid),o.userId!=null&&Object.hasOwnProperty.call(o,"userId")&&l.uint32(18).string(o.userId),o.lts!=null&&Object.hasOwnProperty.call(o,"lts")&&l.uint32(24).int64(o.lts),o.elapse!=null&&Object.hasOwnProperty.call(o,"elapse")&&l.uint32(32).int64(o.elapse),o.cname!=null&&Object.hasOwnProperty.call(o,"cname")&&l.uint32(50).string(o.cname),o.errCode!=null&&Object.hasOwnProperty.call(o,"errCode")&&l.uint32(56).int32(o.errCode),l},s}(),WC=zc.ChnJoinRes=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.sid="",s.prototype.userId="",s.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.cname="",s.prototype.errCode=0,s.prototype.serverErrCode=0,s.encode=function(o,l){return l||(l=Xc.create()),o.sid!=null&&Object.hasOwnProperty.call(o,"sid")&&l.uint32(10).string(o.sid),o.userId!=null&&Object.hasOwnProperty.call(o,"userId")&&l.uint32(18).string(o.userId),o.lts!=null&&Object.hasOwnProperty.call(o,"lts")&&l.uint32(24).int64(o.lts),o.elapse!=null&&Object.hasOwnProperty.call(o,"elapse")&&l.uint32(32).int64(o.elapse),o.cname!=null&&Object.hasOwnProperty.call(o,"cname")&&l.uint32(50).string(o.cname),o.errCode!=null&&Object.hasOwnProperty.call(o,"errCode")&&l.uint32(56).int32(o.errCode),o.serverErrCode!=null&&Object.hasOwnProperty.call(o,"serverErrCode")&&l.uint32(64).int32(o.serverErrCode),l},s}(),XC=zc.ChnLeave=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.sid="",s.prototype.userId="",s.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.cname="",s.prototype.errCode=0,s.encode=function(o,l){return l||(l=Xc.create()),o.sid!=null&&Object.hasOwnProperty.call(o,"sid")&&l.uint32(10).string(o.sid),o.userId!=null&&Object.hasOwnProperty.call(o,"userId")&&l.uint32(18).string(o.userId),o.lts!=null&&Object.hasOwnProperty.call(o,"lts")&&l.uint32(24).int64(o.lts),o.elapse!=null&&Object.hasOwnProperty.call(o,"elapse")&&l.uint32(32).int64(o.elapse),o.cname!=null&&Object.hasOwnProperty.call(o,"cname")&&l.uint32(50).string(o.cname),o.errCode!=null&&Object.hasOwnProperty.call(o,"errCode")&&l.uint32(56).int32(o.errCode),l},s}(),YC=zc.ConnectionStateChange=function(){function s(o){if(o)for(var l=Object.keys(o),p=0;p<l.length;++p)o[l[p]]!=null&&(this[l[p]]=o[l[p]])}return s.prototype.sid="",s.prototype.userId="",s.prototype.lts=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.elapse=na.Long?na.Long.fromBits(0,0,!1):0,s.prototype.oldState=0,s.prototype.newState=0,s.prototype.reason=0,s.prototype.reconnId=0,s.encode=function(o,l){return l||(l=Xc.create()),o.sid!=null&&Object.hasOwnProperty.call(o,"sid")&&l.uint32(10).string(o.sid),o.userId!=null&&Object.hasOwnProperty.call(o,"userId")&&l.uint32(18).string(o.userId),o.lts!=null&&Object.hasOwnProperty.call(o,"lts")&&l.uint32(24).int64(o.lts),o.elapse!=null&&Object.hasOwnProperty.call(o,"elapse")&&l.uint32(32).int64(o.elapse),o.oldState!=null&&Object.hasOwnProperty.call(o,"oldState")&&l.uint32(40).int32(o.oldState),o.newState!=null&&Object.hasOwnProperty.call(o,"newState")&&l.uint32(48).int32(o.newState),o.reason!=null&&Object.hasOwnProperty.call(o,"reason")&&l.uint32(56).int32(o.reason),o.reconnId!=null&&Object.hasOwnProperty.call(o,"reconnId")&&l.uint32(64).int32(o.reconnId),l},s}(),fu=Object.freeze({__proto__:null,Session:RC,Link:SC,Logout:TC,KickedOff:UC,ChnJoin:VC,ChnJoinRes:WC,ChnLeave:XC,ConnectionStateChange:YC,default:zc}),gu=Object.freeze({__proto__:null,Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191,default:{Counter:1,ApiExec:154,Session:164,ApEvent:165,Link:166,Logout:167,TxMessage:168,RxMessage:169,KickedOff:170,TxMessageRes:171,ChnJoin:172,ChnJoinRes:173,ChnLeave:174,ChnGetMembers:175,ChnGetMembersRes:176,ChnMemberJoined:177,ChnMemberLeft:178,QueryPeersOnlineStatus:179,QueryPeersOnlineStatusRes:180,RenewToken:181,OperateAttribute:186,OperateAttributeRes:187,ApRequest:188,LinkTcpEvent:189,LinkLoginRequest:190,ConnectionStateChange:191}}),ZC=function(s){function o(p,_,A){return W(this,o),m(n(A=l.call(this,A,"Context")),"_token",void 0),m(n(A),"config",void 0),m(n(A),"_uid",void 0),m(n(A),"_sid",void 0),m(n(A),"_area","CN"),m(n(A),"appId",void 0),m(n(A),"enableCloudProxy",!1),m(n(A),"cloudProxyServers",[]),A.appId=p,A.config=_,A}la(o,s);var l=ma(o);return Ha(o,[{key:"token",set:function(p){this._token=typeof p=="string"&&p?p:void 0}},{key:"uid",get:function(){if(typeof this._uid=="string"&&this._uid)return this._uid;throw new Ia("Cannot get illegal uid")},set:function(p){if(this.log("The user ID is set to %s",oa(p)),!za(p))throw new Ia;this._uid=p}},{key:"key",get:function(){if(typeof this._token=="string"&&this._token)return this._token;if(typeof this.appId=="string"&&this.appId)return this.appId;throw new Ia("Cannot get illegal key")}},{key:"sid",get:function(){if(typeof this._sid=="string"&&this._sid)return this._sid;throw new Ia("Cannot get illegal sid")},set:function(p){if(this.log("sid is set to %s",p),typeof p!="string"||!p)throw new Ia;this._sid=p}},{key:"rtmArea",get:function(){if(typeof this._area=="string"&&this._area)return this._area;throw new Ia("Cannot get illegal area")},set:function(p){this.log("area is set to %s",p),typeof p=="string"&&p?this._area=p:this.warn("set area failed")}}]),o}(tb()),$C=!!Fc&&R(function(){Fc.prototype.finally.call({then:function(){}},function(){})});if(N({target:"Promise",proto:!0,real:!0,forced:$C},{finally:function(s){var o=kd(this,mc("Promise")),l=typeof s=="function";return this.then(l?function(p){return mj(o,s()).then(function(){return p})}:s,l?function(p){return mj(o,s()).then(function(){throw p})}:s)}}),typeof Fc=="function"){var Zr=mc("Promise").prototype.finally;Fc.prototype.finally!==Zr&&Ta(Fc.prototype,"finally",Zr,{unsafe:!0})}var aD=function(){var s=J(w.mark(function o(l){return w.wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.t0=Uint8Array,p.next=3,crypto.subtle.digest("SHA-256",l);case 3:return p.t1=p.sent,p.abrupt("return",new p.t0(p.t1));case 5:case"end":return p.stop()}},o)}));return function(o){return s.apply(this,arguments)}}(),$r=function(s){return Array.from(s).map(function(o){return o.toString(16).padStart(2,"0")}).join("")},bD=function(s){if(typeof s!="string")throw new TypeError("Expected input to be a string");if(s.length%2!=0)throw new RangeError("Expected string to be an even number of characters");for(var o=new Uint8Array(s.length/2),l=0;l<s.length;l+=2)o[l/2]=parseInt(s.substring(l,l+2),16);return o},as=function(s){return btoa(String.fromCharCode.apply(String,G(s))).replace(/={1,2}$/,"")},bs=function(){var s=J(w.mark(function o(l){var p;return w.wrap(function(_){for(;;)switch(_.prev=_.next){case 0:return _.prev=0,_.next=3,crypto.subtle.digest("SHA-1",l);case 3:p=_.sent,_.next=9;break;case 6:_.prev=6,_.t0=_.catch(0),p=sha1.arrayBuffer(l);case 9:return _.abrupt("return",as(new Uint8Array(p)));case 10:case"end":return _.stop()}},o,null,[[0,6]])}));return function(o){return s.apply(this,arguments)}}(),cs=function(s,o,l,p){p[o]=!0,l.has(s)?l.get(s).add(o):l.set(s,new Set([o]))},cD=function(s){switch(s){case"89504E47":return"image/png";case"47494638":return"image/gif";case"25504446":return"application/pdf";case"FFD8FFDB":case"FFD8FFE0":case"FFD8FFE1":return"image/jpeg";case"504B0304":return"application/zip";default:return"application/octet-stream"}},ds=function(s){function o(p,_,A,k){W(this,o);var j=l.call(this,A,"ChunkDownloadManager");if(m(n(j),"abortController",new AbortController),m(n(j),"downloadedSize",0),m(n(j),"successCount",0),m(n(j),"timer",void 0),m(n(j),"chunks",[]),m(n(j),"retUnit",void 0),m(n(j),"singleThread",!1),m(n(j),"initialized",!1),m(n(j),"ee",void 0),m(n(j),"chunkCount",void 0),m(n(j),"aborted",!1),m(n(j),"serverToIndices",new Map),m(n(j),"backupToIndices",new Map),m(n(j),"indexToBackupServers",[]),m(n(j),"busyBackupServers",new Map),m(n(j),"downloadingChunks",new Set),m(n(j),"metaInfo",void 0),m(n(j),"transHandler",void 0),j.metaInfo=p,j.transHandler=_,j.ee=k===void 0?new ea:k,A=p.size,p=p.unit,A===0)throw new Ia("size cannot be 0");return _.cancelSignal!==void 0&&_.cancelSignal.addEventListener("abort",function(){j.abortController.abort()},{once:!0}),j.abortController.signal.addEventListener("abort",function(){j.aborted=!0},{once:!0}),j.chunkCount=Math.ceil(A/(32768*p)),j}la(o,s);var l=ma(o);return Ha(o,[{key:"setInfoByResponse",value:function(p){var _=this,A=p.serverList,k=p.backupList;if(p=p.unit,A.length<this.chunkCount&&k.length<this.chunkCount)throw new Ia("servers is not enough");this.updateProgress(0),this.initialized=!0;var j=Array(this.chunkCount).fill(!1);if(A.forEach(function(B,z){return B.forEach(function(Vt){return cs(Vt,z,_.serverToIndices,j)})}),k.forEach(function(B,z){return B.forEach(function(Vt){return cs(Vt,z,_.backupToIndices,j)})}),j.some(function(){return!1}))throw new da("Not enough servers to download",mg);this.indexToBackupServers=k.map(function(B){return new Set(B)}),this.retUnit=p}},{key:"downloadChunks",value:function(){this.aborted?this.warn("downloadChunks after abort, ignored"):this.serverToIndices.size===1&&Array.from(this.serverToIndices.keys())[0]===0?this.serversDownload(this.backupToIndices):1<=this.serverToIndices.size?this.serversDownload(this.serverToIndices,!0):this.ee.emit("error",new da("not enough servers to download",mg))}},{key:"updateProgress",value:function(p){var _=this,A=this.downloadedSize+p;this.downloadedSize>this.metaInfo.size?(this.warn("Invalid download size, overflowed"),this.ee.emit("error",new Wc("Invalid download size",mg))):(this.downloadedSize=A,this.timer!==void 0&&p!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&this.successCount!==this.chunkCount&&(this.timer=setTimeout(function(){_.ee.emit("timedOut"),_.abortController.abort()},12e4)),this.initialized&&p===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.size,currentSize:this.downloadedSize}))}},{key:"getPayload",value:function(){for(var p=0,_=0,A=this.chunks;_<A.length;_++)p+=A[_].byteLength;if(p!==this.metaInfo.size)throw new Ia("invalid chunks total size");p=new Uint8Array(p),A=_=0;for(var k=this.chunks;A<k.length;A++){var j=k[A];p.set(new Uint8Array(j),_),_+=j.byteLength}return _=Array.from(p.subarray(0,4)).map(function(B){return B.toString(16)}).join("").toUpperCase(),Zt(p.buffer,cD(_))}},{key:"getDownloadUrl",value:function(p){var _=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(p).split(".").join("-"),".edge.").concat(_,":9601/api/v1/chuck/download")}},{key:"serversDownload",value:function(){var p=J(w.mark(function _(A){var k,j=this,B=arguments;return w.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return k=1<B.length&&B[1]!==void 0&&B[1],z.next=3,Promise.all(Array.from(A.entries()).map(function(Vt){return Vt=ra(Vt,2),j.postDownloadRequest(Vt[0],Array.from(Vt[1]),k).catch(function(_e){_e.statusCode===404?(j.ee.emit("notExist"),j.abortController.abort()):_e.name!=="AbortError"&&(Sa(_e)?j.singleThread?(j.abortController.abort(),j.ee.emit("timedOut")):(j.warn("%d download timed out after %d, retrying use single thread",_e.index,j.singleThread?6e4:3e4),j.abortController.abort(),j.singleThread=!0,j.ee.emit("multiTimeOut")):(j.ee.emit("error",_e),j.abortController.abort()))})}));case 3:case"end":return z.stop()}},_)}));return function(_){return p.apply(this,arguments)}}()},{key:"postDownloadRequest",value:function(){var p=J(w.mark(function _(A,k,j){var B,z,Vt,_e,_n,_o,_c,_d,_h,_p=this;return w.wrap(function(_f){for(;;)switch(_f.prev=_f.next){case 0:if(_h=function(){return(_h=J(w.mark(function e_(u_){var w_,O_,y_,Z_,NE,i_,S_,h_,I_;return w.wrap(function(vf){for(;;)switch(vf.prev=vf.next){case 0:if(vf.prev=0,u_!==void 0||A!==0){vf.next=5;break}throw new Ia("Invalid serverIp");case 5:w_=u_===void 0?_c.getDownloadUrl(A):u_;case 6:return _c.downloadingChunks.add(B),vf.next=9,_o(w_);case 9:return O_=vf.sent,y_=O_.responseData,_c.downloadingChunks.delete(B),vf.abrupt("return",y_);case 15:if(vf.prev=15,vf.t0=vf.catch(0),_c.downloadingChunks.delete(B),k.unshift(B),_c.metaInfo.useNewDomain=!1,vf.t0.name!=="AbortError"){vf.next=22;break}throw vf.t0;case 22:if(!Sa(vf.t0)){vf.next=25;break}throw vf.t0.index=B,vf.t0;case 25:if(Z_=_e,_e+=1,!(2>Z_)){vf.next=30;break}return vf.t0 instanceof Ia||_c.warn("%o, %d download failed, retrying",vf.t0,B),vf.abrupt("return",_d());case 30:if(vf.t0.statusCode!==504){vf.next=34;break}throw(NE=new db("download server timed out",{originalError:vf.t0,serverCode:504})).index=B,NE;case 34:if(!j||Z_!==2||_n[0]===0){vf.next=45;break}return vf.t0 instanceof Ia||_c.warn("%d download failed, using backup: %d, %o",B,_n[0],vf.t0),vf.next=38,_c.busyBackupServers.get(_n[0]);case 38:return i_=_d(_c.getDownloadUrl(_n[0])),_c.busyBackupServers.set(_n[0],i_),vf.next=42,i_;case 42:return S_=vf.sent,_c.busyBackupServers.delete(_n[0]),vf.abrupt("return",S_);case 45:if(!(j&&2<Z_&&_n[1]!==void 0&&_n[1]!==0)){vf.next=56;break}return _c.warn("%d download failed, using backup 1: %d",B,_n[1]),vf.next=49,_c.busyBackupServers.get(_n[1]);case 49:return h_=_d(_c.getDownloadUrl(_n[1])),_c.busyBackupServers.set(_n[1],h_),vf.next=53,h_;case 53:return I_=vf.sent,_c.busyBackupServers.delete(_n[1]),vf.abrupt("return",I_);case 56:throw vf.t0.index=B,vf.t0;case 58:case"end":return vf.stop()}},e_,null,[[0,15]])}))).apply(this,arguments)},_d=function(e_){return _h.apply(this,arguments)},!this.aborted){_f.next=4;break}throw new Ia("download already aborted");case 4:if((B=k.shift())!==void 0){_f.next=8;break}return this.log("%s download finished",A),_f.abrupt("return");case 8:if(!(this.singleThread&&0<this.downloadingChunks.size)){_f.next=10;break}return _f.abrupt("return");case 10:if(!this.downloadingChunks.has(B)){_f.next=13;break}return this.log("%s already downloading, return",B),_f.abrupt("return");case 13:if(this.chunks[B]===void 0){_f.next=19;break}return this.successCount===this.chunkCount&&(this.log("chunks all download"),this.ee.emit("finished")),this.log("%s already downloaded, do next",B),_f.next=18,this.postDownloadRequest(A,k,j);case 18:return _f.abrupt("return");case 19:return z=new FormData,Vt={hash:hu(this.metaInfo.hashHexStr),unit:this.retUnit===void 0?this.metaInfo.unit:this.retUnit,instance:this.metaInfo.instance,loginOpt:this.metaInfo.loginOpt,ticket:this.metaInfo.ticket,index:B},z.append("parameter",JSON.stringify(Vt)),_e=0,_n=Array.from(this.indexToBackupServers[B]),_o=function(e_){return te(e_,{body:z,signal:_p.abortController.signal,timeout:_p.singleThread?12e4:3e4},{useBinaryResponse:!0})},_c=this,_f.next=28,_d().then(function(e_){return _p.chunks[B]!==void 0?_p.log("chunk %d download duplicated",B):(_p.chunks[B]=e_,_p.log("chunk %d downloaded",B),_p.successCount+=1,_p.updateProgress(_p.chunks[B].byteLength)),_p.successCount===_p.chunkCount&&(_p.log("chunks all download"),_p.ee.emit("finished")),_p.singleThread?(_p.downloadChunks(),Promise.resolve()):_p.postDownloadRequest(A,k,j)});case 28:case"end":return _f.stop()}},_,this)}));return function(_,A,k){return p.apply(this,arguments)}}()}]),o}(tb()),es=function(s){function o(p,_,A,k){W(this,o);var j=l.call(this,A,"ChunkUploadManager");if(m(n(j),"chunkCount",0),m(n(j),"chunks",[]),m(n(j),"uploadedChunks",[]),m(n(j),"totalFailures",0),m(n(j),"timer",void 0),m(n(j),"initState","uninitialized"),m(n(j),"ee",void 0),m(n(j),"unit",0),m(n(j),"uploadedSize",0),m(n(j),"singleThread",!1),m(n(j),"abortController",new AbortController),m(n(j),"servers",[]),m(n(j),"aborted",!1),m(n(j),"metaInfo",void 0),m(n(j),"transHandler",void 0),j.metaInfo=p,j.transHandler=_,j.ee=k===void 0?new ea:k,p.file.length===0)throw new I("file not found or is empty",wf);return _.cancelSignal!==void 0&&_.cancelSignal.addEventListener("abort",function(){j.abortController.abort()},{once:!0}),j.abortController.signal.addEventListener("abort",function(){j.aborted=!0},{once:!0}),j}la(o,s);var l=ma(o);return Ha(o,[{key:"initChunks",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt,_e=this;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(this.initState!=="initialized"&&this.initState!=="initializing"){_n.next=2;break}throw new Ia("cannot re-initialize");case 2:for(this.initState="initializing",this.unit=A,k=this.sliceFile(A,this.metaInfo.file),this.chunkCount=k.length,j=[],B=function(_o,_c){var _d=(_o=ra(_c[_o],2))[0],_h=_o[1];_o=bs(_h).then(function(_p){_e.chunks[_d]={payload:_h,sha1:_p,uploadedTo:void 0,index:_d,processed:!1}}),j.push(_o)},z=0,Vt=Array.from(k.entries());z<Vt.length;z++)B(z,Vt);return _n.next=11,Promise.all(j);case 11:this.updateProgress(0),this.initState="initialized",this.log("upload chunks initialized");case 14:case"end":return _n.stop()}},_,this)}));return function(_){return p.apply(this,arguments)}}()},{key:"uploadToServers",value:function(){var p=this;if(!this.aborted){for(var _=this.chunks.filter(function(j){return!j.processed}),A=function(j){var B=_[j],z=p.servers.filter(function(_e){return!_e.isUploading}).sort(function(_e,_n){return _e.successCount-_n.successCount}).sort(function(_e,_n){return _e.failureCount-_n.failureCount})[0];if(z===void 0||1<z.failureCount)return p.log("Upload server not available, waiting"),p.ee.emit("serverUsedUp"),Om(1e3).then(function(){p.totalFailures>2*p.chunkCount&&p.ee.emit("error"),p.totalFailures+=1,z!==void 0&&(z.failureCount=0),p.uploadToServers()}).catch(function(){}),"break";B.processed=!0,z.isUploading=!0,p.log("uploading chunk %d to server %s",B.index,Dg(z.ip));var Vt=p.getUploadUrl(z.ip);return J(w.mark(function _e(){var _n;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:return _o.prev=0,_o.next=3,p.postChunk(B.payload,Vt,B.index);case 3:_n=p.chunks.findIndex(function(_c){return _c===B}),B.uploadedTo=z.ip,p.chunks.splice(_n,1),p.uploadedChunks.push(B),z.successCount+=1,z.isUploading=!1,p.updateProgress(B.payload.byteLength),p.log("upload chunk %d successfully",B.index),_o.next=31;break;case 13:if(_o.prev=13,_o.t0=_o.catch(0),z.isUploading=!1,B.processed=!1,_o.t0.statusCode!==504&&!Sa(_o.t0)){_o.next=27;break}if(p.singleThread){_o.next=24;break}return p.warn("%d upload timed out after %d, retrying use single thread",B.index,p.singleThread?12e4:3e4),p.abortController.abort(),p.singleThread=!0,p.ee.emit("multiTimeOut"),_o.abrupt("return");case 24:return p.ee.emit("timedOut"),p.abortController.abort(),_o.abrupt("return");case 27:return p.metaInfo.useNewDomain=!1,z.failureCount+=1,_o.next=31,Om(1e3);case 31:p.uploadedChunks.length===p.chunkCount?(p.log("chunks uploaded"),p.ee.emit("finished")):(p.singleThread||p.chunks.filter(function(_c){return!_c.processed}).length===1)&&p.uploadToServers();case 32:case"end":return _o.stop()}},_e,null,[[0,13]])}))(),p.singleThread?"break":void 0},k=0;k<_.length&&A(k)!=="break";k++);_.length===0&&this.uploadedChunks.length!==this.chunkCount&&this.log("%d chunks left uploading",this.chunkCount-this.uploadedChunks.length)}}},{key:"getUploadServerIPs",value:function(){var p=!0,_=[],A=G(this.uploadedChunks).sort(function(B,z){return B.index-z.index}),k=0;for(A=Array.from(A.values());k<A.length;k++){var j=A[k].uploadedTo;if(j===void 0){p=!1;break}_.push(j)}if(!p)throw new Ia("some chunks not uploaded, cannot get upload server ips");return _}},{key:"addServers",value:function(p){var _=this;p.forEach(function(A){var k=_.servers.findIndex(function(j){return j.ip===A});k!==-1?_.servers[k].failureCount=0:(_.log("server %s added",Dg(A)),_.servers.push({successCount:0,isUploading:!1,ip:A,failureCount:0}))})}},{key:"updateProgress",value:function(p){var _=this,A=p!==void 0?this.uploadedSize+p:this.metaInfo.file.length;A>this.metaInfo.file.length?(this.warn("Invalid upload size, overflowed"),this.ee.emit("error",new Wc("Invalid upload size",lg))):(this.uploadedSize=A,this.timer!==void 0&&p!==0&&(clearTimeout(this.timer),this.timer=void 0),this.timer===void 0&&p!==void 0&&this.uploadedChunks.length!==this.chunkCount&&(this.timer=setTimeout(function(){_.ee.emit("timedOut"),_.abortController.abort()},12e4)),this.initState==="initialized"&&p===0||this.transHandler.onOperationProgress===void 0||this.transHandler.onOperationProgress({totalSize:this.metaInfo.file.length,currentSize:this.uploadedSize}))}},{key:"sliceFile",value:function(p,_){var A=0,k=[],j=_.length;for(p*=32768;A<j;)k.push(_.slice(A,A+p)),A+=p;return this.log("chunks split into %d",k.length),k}},{key:"postChunk",value:function(){var p=J(w.mark(function _(A,k,j){var B,z,Vt,_e,_n,_o,_c,_d;return w.wrap(function(_h){for(;;)switch(_h.prev=_h.next){case 0:if(!this.aborted){_h.next=2;break}throw new Ia("upload already aborted");case 2:if(this.unit!==void 0){_h.next=4;break}throw new Ia("unit is undefined");case 4:return B=this.metaInfo,z=B.ticket,Vt=B.instance,_e=B.loginOpt,_n=B.hashStr,_h.t0=j,_h.t1=_n,_h.next=9,bs(A);case 9:return _h.t2=_h.sent,_h.t3=this.unit,_h.t4=z,_h.t5=Vt,_h.t6=_e,_o={index:_h.t0,hash:_h.t1,sha1:_h.t2,unit:_h.t3,ticket:_h.t4,instance:_h.t5,loginOpt:_h.t6},(_c=new FormData).append("parameter",JSON.stringify(_o)),_c.append("payload",new Blob([A])),_h.next=20,te(k,{headers:{Accept:"application/json"},body:_c,timeout:this.singleThread?12e4:3e4,signal:this.abortController.signal});case 20:if(_d=_h.sent,_d.status===201){_h.next=24;break}throw new da("uploading chunk ".concat(j," failed"));case 24:case"end":return _h.stop()}},_,this)}));return function(_,A,k){return p.apply(this,arguments)}}()},{key:"getUploadUrl",value:function(p){var _=this.metaInfo.useNewDomain?"sd-rtn.com":"agora.io";return"https://".concat(Dg(p).split(".").join("-"),".edge.").concat(_,":9601/api/v1/chuck/upload")}}]),o}(tb()),fs=function(s){function o(p){W(this,o);var _=l.call(this,p,"MediaTaskManager");return m(n(_),"isProcessing",!1),m(n(_),"authInfo",void 0),m(n(_),"taskFinishers",{}),m(n(_),"mediaTasks",new Map),m(n(_),"ongoingTask",void 0),_.on("connectionStateChanged",function(A){if(A===S.ConnectionState.ABORTED||A===S.ConnectionState.DISCONNECTED){_.ongoingTask!==void 0&&_.cancelTask(_.ongoingTask),A=0;for(var k=Array.from(_.mediaTasks.entries());A<k.length;A++){var j=ra(k[A],2)[1];_.cancelTask(j)}_.mediaTasks.clear(),_.taskFinishers={}}else A===S.ConnectionState.RECONNECTING?_.ongoingTask!==void 0&&_.ongoingTask.manager.abortController.abort():A===S.ConnectionState.CONNECTED&&_.ongoingTask!==void 0&&_.ongoingTask.manager.ee.emit("reconnected")}),_}la(o,s);var l=ma(o);return Ha(o,[{key:"setAuthInfo",value:function(p){this.authInfo=p}},{key:"waitMediaTask",value:function(p){var _=this;return new Promise(function(A,k){_.taskFinishers[p]={resolve:A,reject:k},_.isProcessing||_.processMediaTask()}).finally(function(){_.ongoingTask!==void 0&&_.ongoingTask.manager.timer!==void 0&&clearTimeout(_.ongoingTask.manager.timer),delete _.taskFinishers[p],_.mediaTasks.size!==0?_.processMediaTask():_.isProcessing=!1})}},{key:"addUploadTask",value:function(p,_,A,k){var j=p.file;if(p=p.hash,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=o.MAX_PENDING_TASK_COUNT-1)throw new ib("Upload media failed, exceed max pending jobs",xA);return k=new es({hashStr:as(p),file:j,ticket:this.authInfo.ticket,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),useNewDomain:this.authInfo.useNewDomain},k,this.logger),j=Ud(),this.mediaTasks.set(j,{type:"UPLOAD",manager:k,hash:p,setter:A,fetcher:_,taskId:j}),j}},{key:"addDownloadTask",value:function(p,_,A){var k=p.hashHexStr,j=p.size,B=p.unit;if(p=p.zone,this.authInfo===void 0)throw new Ia("session not found");if(this.mediaTasks.size>=o.MAX_PENDING_TASK_COUNT-1)throw new ib("Download media failed, exceed max pending jobs",BA);return A=new ds({hashHexStr:k,ticket:this.authInfo.ticket,useNewDomain:this.authInfo.useNewDomain,instance:this.authInfo.instance.toString(),loginOpt:this.authInfo.loginOpt.toString(),size:j,zone:p,unit:B},A,this.logger),k=Ud(),this.mediaTasks.set(k,{type:"DOWNLOAD",manager:A,fetcher:_,taskId:k}),k}},{key:"doDownloadTaskImpl",value:function(){var p=J(w.mark(function _(A,k){var j,B,z,Vt,_e,_n,_o,_c,_d=this,_h=arguments;return w.wrap(function(_p){for(;;)switch(_p.prev=_p.next){case 0:return j=2<_h.length&&_h[2]!==void 0&&_h[2],z=B=A.manager,j&&(B=new ds(z.metaInfo,z.transHandler,this.logger,z.ee)),Vt=A.fetcher,_p.next=7,Vt();case 7:if(_e=_p.sent,_n=_e.serverList,_o=_e.backupList,_c=_e.unit,!j||_c===z.retUnit){_p.next=13;break}throw new da("download unit is different, reject to continue",mg);case 13:j&&(A.manager=B,B.downloadedSize=z.downloadedSize,B.successCount=z.successCount,B.timer=z.timer,B.chunks=z.chunks,B.initialized=z.initialized,B.singleThread=z.singleThread,B.updateProgress(0)),B.ee.once("reconnected",function(){B.ee.removeAllListeners(),_d.doDownloadTaskImpl(A,k,!0).catch(function(_f){k.reject(_f)})}),B.ee.once("multiTimeOut",function(){B.ee.removeAllListeners(),_d.doDownloadTaskImpl(A,k,!0).catch(function(_f){k.reject(_f)})}),B.ee.once("error",function(_f){B.ee.removeAllListeners(),k.reject(new da(["download file file, index %d",_f.index],{code:mg,originalError:_f}))}),B.ee.once("notExist",function(){B.abortController.abort(),B.ee.removeAllListeners(),k.reject(new da("download file not found",AA))}),B.ee.once("timedOut",function(){B.ee.removeAllListeners(),B.abortController.abort(),k.reject(new db("download timed out",zA))}),B.transHandler.cancelSignal!==void 0&&B.transHandler.cancelSignal.addEventListener("abort",function(){k.reject(new hl("Downloading canceled",ir))},{once:!0}),B.ee.once("finished",function(){k.resolve({type:"DOWNLOAD",payload:B.getPayload()})}),B.setInfoByResponse({serverList:_n,backupList:_o,unit:_c}),B.downloadChunks();case 23:case"end":return _p.stop()}},_,this)}));return function(_,A){return p.apply(this,arguments)}}()},{key:"doDownloadTask",value:function(p,_){var A=this,k=2<arguments.length&&arguments[2]!==void 0&&arguments[2],j=p.taskId;return k||(this.mediaTasks.delete(j),this.ongoingTask=p),new Promise(function(B,z){A.doDownloadTaskImpl(p,_,k).then(B).catch(z)})}},{key:"doUploadTaskImpl",value:function(){var p=J(w.mark(function _(A,k){var j,B,z,Vt,_e,_n,_o,_c,_d,_h=this,_p=arguments;return w.wrap(function(_f){for(;;)switch(_f.prev=_f.next){case 0:return j=2<_p.length&&_p[2]!==void 0&&_p[2],z=B=A.manager,j&&(B=new es(z.metaInfo,z.transHandler,this.logger,z.ee)),Vt=A.fetcher,_e=new Pa,_o=new Promise(function(e_,u_){var w_=Vt(),O_=w_.ret,y_=w_.err,Z_=w_.timeout;w_.fin.pipe(ob(_e)).subscribe({next:function(NE){k.resolve({type:"UPLOAD",retUnit:NE.unit,zone:NE.zone})},complete:function(){e_({hasExist:!0}),_e.next(),_e.complete()}}),O_.pipe(ob(_e),cb(function(){var NE=J(w.mark(function i_(S_){var h_,I_;return w.wrap(function(vf){for(;;)switch(vf.prev=vf.next){case 0:if(h_=S_.servers,I_=S_.unit,j&&z.unit!==I_?k.reject(new da("upload unit is different, reject to continue",lg)):j&&(A.manager=B,B.chunkCount=z.chunkCount,B.chunks=z.chunks,B.totalFailures=z.totalFailures,B.uploadedChunks=z.uploadedChunks,B.timer=z.timer,B.initState=z.initState,B.unit=z.unit,B.uploadedSize=z.uploadedSize,B.singleThread=z.singleThread,B.updateProgress(0)),B.addServers(h_),B.initState!=="uninitialized"){vf.next=7;break}return _n=B.initChunks(I_),vf.next=7,_n;case 7:case"end":return vf.stop()}},i_)}));return function(i_){return NE.apply(this,arguments)}}())).subscribe({complete:function(){return e_({hasExist:!1})},error:u_}),w_=function(NE){B.initState!=="uninitialized"&&_n?e_(_n.then(function(){return{hasExist:!1}})):u_(NE)},y_.pipe(ob(_e)).subscribe({error:w_}),Z_.pipe(ob(_e)).subscribe({error:w_})}),_f.next=9,_o;case 9:if(_c=_f.sent,!_c.hasExist){_f.next=15;break}return B.updateProgress(),this.log("file already exists, skipping upload"),_f.abrupt("return");case 15:_e.next(),_e.complete(),this.log("chunks initialization promise resolved"),_d=gb(B.ee,"serverUsedUp").pipe(Gt(function(){return B.chunkCount!==B.uploadedChunks.length}),Jt(5e3,void 0,{leading:!1}),pm(function(){return Vt().ret})).subscribe(function(e_){B.addServers(e_.servers)}),B.ee.once("reconnected",function(){B.ee.removeAllListeners(),_h.doUploadTask(A,k,!0).catch(function(e_){k.reject(e_)})}),B.ee.once("multiTimeOut",function(){B.ee.removeAllListeners(),_h.doUploadTask(A,k,!0).catch(function(e_){k.reject(e_)})}),B.ee.once("timedOut",function(){_d.unsubscribe(),B.ee.removeAllListeners(),B.abortController.abort(),k.reject(new db("upload timed out",Lh))}),B.ee.once("error",function(e_){_d.unsubscribe(),B.ee.removeAllListeners(),B.abortController.abort(),k.reject(e_||new da("upload error",lg))}),B.transHandler.cancelSignal!==void 0&&B.transHandler.cancelSignal.addEventListener("abort",function(){k.reject(new hl("Uploading canceled",hr))},{once:!0}),B.ee.once("finished",J(w.mark(function e_(){var u_,w_,O_;return w.wrap(function(y_){for(;;)switch(y_.prev=y_.next){case 0:return _d.unsubscribe(),y_.next=3,A.setter(B.unit,B.getUploadServerIPs());case 3:u_=y_.sent,w_=u_.zone,O_=u_.unit,B.ee.removeAllListeners(),k.resolve({type:"UPLOAD",retUnit:O_,zone:w_});case 8:case"end":return y_.stop()}},e_)}))),B.uploadToServers();case 26:case"end":return _f.stop()}},_,this)}));return function(_,A){return p.apply(this,arguments)}}()},{key:"doUploadTask",value:function(p,_){var A=this,k=2<arguments.length&&arguments[2]!==void 0&&arguments[2],j=p.taskId;return k||(this.mediaTasks.delete(j),this.ongoingTask=p),new Promise(function(B,z){A.doUploadTaskImpl(p,_,k).then(B).catch(z)})}},{key:"processMediaTask",value:function(){var p=J(w.mark(function _(){var A,k,j;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(this.mediaTasks.size!==0){B.next=2;break}throw Error("no upload tasks");case 2:if(this.isProcessing=!0,A=this.mediaTasks.keys().next().value,(k=this.taskFinishers[A])!==void 0){B.next=7;break}throw Error("top task not found");case 7:if((j=this.mediaTasks.get(A))!==void 0){B.next=10;break}throw new Ia("task invalid");case 10:if(j.type!=="UPLOAD"){B.next=15;break}return B.next=13,this.doUploadTask(j,k).catch(function(z){j.manager.ee.removeAllListeners(),k.reject(z)});case 13:B.next=18;break;case 15:if(j.type!=="DOWNLOAD"){B.next=18;break}return B.next=18,this.doDownloadTask(j,k).catch(function(z){j.manager.ee.removeAllListeners(),k.reject(z)});case 18:case"end":return B.stop()}},_,this)}));return function(){return p.apply(this,arguments)}}()},{key:"cancelTask",value:function(p){var _=p.type==="DOWNLOAD"?ir:hr;p.manager.ee.removeAllListeners(),p.manager.abortController.abort(),this.taskFinishers[p.taskId]!==void 0&&this.taskFinishers[p.taskId].reject(new hl("User logged out or kicked off, media task canceled",_))}}]),o}(tb());m(fs,"MAX_PENDING_TASK_COUNT",9),Oo("of",function(){for(var s=0,o=arguments.length,l=new(Ne(this))(o);o>s;)l[s]=arguments[s++];return l},Dj);var gs=1/0,dD=Math.max,ju=function(s,o,l){var p=Object(s);if(!Ed(s)){var _=Te(o);s=Ad(s),o=function(A){return _(p[A],A,p)}}return-1<(o=function(A,k,j){var B=A==null?0:A.length;if(!B)return-1;if(j==null)j=0;else{var z=(j=j?(j=gl(j))===gs||j===-gs?17976931348623157e292*(0>j?-1:1):j==j?j:0:j===0?j:0)%1;j=j==j?z?j-z:j:0}return 0>j&&(j=dD(B+j,0)),Xp(A,Te(k),j)}(s,o,l))?p[_?s[o]:o]:void 0},iu=function(s,o){return s&&s.length?vk(s,void 0,typeof o=="function"?o:void 0):[]},hs=function(){function s(){W(this,s),m(this,"size",0),m(this,"fields",new Map)}return Ha(s,[{key:"define",value:function(o,l,p){if(this.size+=p,64<this.size)throw new RangeError("the struct over 64 bits is not supported");Mg(l={val:0,isNumber:l==="number",isBoolean:l==="boolean",oneof:l==="number"||l==="boolean"?void 0:l,len:p}),this.fields.set(o,l)}},{key:"set",value:function(o,l){if(!(o=this.fields.get(o)))throw Error("field not found");var p=o.oneof;if(!U.isLong(l)&&typeof l!="number")if(typeof l=="boolean")l=l?1:0;else{if(p===void 0)throw Error("invalid field type");if((l=p[l])===void 0)throw Error("field type not found")}Mg(o,l),o.val=l}},{key:"toNumber",value:function(){for(var o=0,l=0,p=0,_=Array.from(this.fields);p<_.length;p++){var A=ra(_[p],2)[1],k=A.len;(A=A.val)!==void 0&&(o+=U.fromValue(A).shiftLeft(l).toNumber(),l+=k)}return o}},{key:"toLong",value:function(){for(var o=U.fromNumber(0,!0),l=0,p=0,_=Array.from(this.fields);p<_.length;p++){var A=ra(_[p],2)[1],k=A.len;(A=A.val)!==void 0&&(o=U.fromValue(A).shiftLeft(l).add(o),l+=k)}return o}},{key:"assert",value:function(o,l){function p(k){if(!U.isLong(k)&&typeof k!="number")if(typeof k=="boolean")k=k?1:0;else{if(A===void 0)throw Error("invalid field type");if((k=A[k])===void 0)throw Error("field type not found")}return Mg(_,k),Lg(k,_.val)}var _=this.fields.get(o);if(!_)throw Error("field not found");var A=_.oneof;if(!Array.isArray(l))return p(l);if(l.length===1)return p(l[0]);if(l.every(function(k){return typeof k=="string"})&&A!==void 0)return l.some(function(k){return p(k)});throw Error("invalid valueTypes")}},{key:"from",value:function(o){o=U.fromValue(o);for(var l=0,p=0,_=Array.from(this.fields);p<_.length;p++){var A=ra(_[p],2)[1],k=A.len,j=U.fromNumber(Math.pow(2,k)-1,!0).shiftLeft(l);Mg(A,j=o.and(j).shiftRightUnsigned(l)),A.val=j,l+=k}}},{key:"typeOf",value:function(o){if((o=this.fields.get(o))!==void 0){var l=o.oneof;if(o=o.val,l!==void 0){var p=0;for(l=Object.entries(l);p<l.length;p++){var _=ra(l[p],2),A=_[0];if(Lg(o,_[1]))return A}}}throw new TypeError("can only get type of oneof type")}}]),s}(),is=function(s){function o(p){W(this,o);var _=l.call(this);return _.define("Rejoin","boolean",1),_.define("Unused","number",31),_.define("Platform","number",8),_.define("Version","number",12),_.define("Subversion","number",12),_.set("Platform",7),_.set("Version",4),_.set("Subversion",203),_.set("Rejoin",p),_}la(o,s);var l=ma(o);return o}(hs),eD=ua(ua(ua(ua({},{PeerTextMessage:0,ChannelTextMessage:1,VendorTextMessage:2}),{PeerRawMessage:3,ChannelRawMessage:4,VendorRawMessage:5}),{PeerImageMessage:6,ChannelImageMessage:7,VendorImageMessage:8}),{PeerFileMessage:15,ChannelFileMessage:16,VendorFileMessage:17}),js={CallInvite:101,CallAccept:102,CallReject:103,CallCancel:104},fD=ua(ua({},eD),js),gD={Uncompressed:0,Zlib:1},ae=function(s){function o(p){W(this,o);var _=l.call(this);if(_.define("MessageType",fD,8),_.define("BroadcastJumps","number",2),_.define("ToCache","boolean",1),_.define("FromCache","boolean",1),_.define("CompressionMethod",gD,2),_.define("IterationNumber","number",4),_.define("BufferedMessage","boolean",1),_.define("ToArchive","boolean",1),_.define("FromArchive","boolean",1),typeof p=="number"||U.isLong(p))_.from(p);else if(p!==void 0){var A=0;for(p=Hg(p);A<p.length;A++){var k=ra(p[A],2);_.set(k[0],k[1])}}return _}la(o,s);var l=ma(o);return Ha(o,[{key:"isTextMessage",value:function(){return this.assert("MessageType",["PeerTextMessage","ChannelTextMessage","VendorTextMessage"])}},{key:"isRawMessage",value:function(){return this.assert("MessageType",["ChannelRawMessage","PeerRawMessage","VendorRawMessage"])}},{key:"isRawPeerMessage",value:function(){return this.assert("MessageType","PeerRawMessage")}},{key:"isRawChannelMessage",value:function(){return this.assert("MessageType","ChannelRawMessage")}},{key:"isPeerTextMessage",value:function(){return this.assert("MessageType","PeerTextMessage")}},{key:"isChannelTextMessage",value:function(){return this.assert("MessageType","ChannelTextMessage")}},{key:"isInvitation",value:function(p){var _=this;return p!==void 0?this.assert("MessageType",p):xf(js).some(function(A){return _.assert("MessageType",A)})}},{key:"isFileMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","ChannelFileMessage","VendorFileMessage"])}},{key:"isImageMessage",value:function(){return this.assert("MessageType",["PeerImageMessage","ChannelImageMessage","VendorImageMessage"])}},{key:"isPeerMessage",value:function(){return this.assert("MessageType",["PeerFileMessage","PeerTextMessage","PeerImageMessage","PeerRawMessage"])}},{key:"isZlibCompressed",value:function(){return this.assert("CompressionMethod","Zlib")}},{key:"isFromCache",value:function(){return this.assert("FromCache",!0)}},{key:"isBufferedMessage",value:function(){return this.assert("BufferedMessage",!0)}},{key:"getInvitationType",value:function(){if(!this.isInvitation())throw new TypeError("cannot get InvitationType of a normal message type");return this.typeOf("MessageType")}}]),o}(hs),hD=function(s){function o(p){return W(this,o),m(n(p=l.call(this,p,"ChatManager")),"dialogueLru",new Sx(void 0,{maxlen:1e4,ttl:1e4})),p}la(o,s);var l=ma(o);return Ha(o,[{key:"getChatInfo",value:function(p){var _=this.dialogueLru.get(p);if(this.dialogueLru.prune(),_){var A=_.dialogue,k={dialogue:A,sequence:_=_.sequence.add(1)};return this.dialogueLru.set(p,{dialogue:A,sequence:_}),k}return A={dialogue:Bg(),sequence:U.fromNumber(1,!0)},this.dialogueLru.set(p,A),A}}]),o}(tb()),v={};X(module)=="object"&&(module.exports=v),v.parse=function(s,o){var l,p=v.bin.readUshort,_=v.bin.readUint,A={};for(l=(s=new Uint8Array(s)).length-4;_(s,l)!=101010256;)l--;var k=p(s,l=l+4+4);p(s,l+=2),_(s,l+=2),l=_(s,l+=4);for(var j=0;j<k;j++){_(s,l),l+=4,l+=4,l+=4,_(s,l+=4);var B=_(s,l+=4),z=_(s,l+=4),Vt=p(s,l+=4),_e=p(s,l+2),_n=p(s,l+4);l+=6;var _o=_(s,l+=8);l+=4,l+=Vt+_e+_n,v._readLocal(s,_o,A,B,z,o)}return A},v._readLocal=function(s,o,l,p,_,A){var k=v.bin.readUshort,j=v.bin.readUint;j(s,o),k(s,o+=4),k(s,o+=2);var B=k(s,o+=2);j(s,o+=2),j(s,o+=4),j=k(s,o=o+4+8);var z=k(s,o+=2);if(o+=2,k=v.bin.readUTF8(s,o,j),o=o+j+z,A)l[k]={size:_,csize:p};else if(s=new Uint8Array(s.buffer,o),B==0)l[k]=new Uint8Array(s.buffer.slice(o,o+p));else{if(B!=8)throw"unknown compression method: "+B;o=new Uint8Array(_),v.inflateRaw(s,o),l[k]=o}},v.inflateRaw=function(s,o){return v.F.inflate(s,o)},v.inflate=function(s,o){return s[0],s[1],v.inflateRaw(new Uint8Array(s.buffer,s.byteOffset+2,s.length-2),o)},v.deflate=function(s,o){o==null&&(o={level:6});var l=0,p=new Uint8Array(50+Math.floor(1.1*s.length));return p[l]=120,p[l+1]=156,l=v.F.deflateRaw(s,p,l+2,o.level),s=v.adler(s,0,s.length),p[l+0]=s>>>24&255,p[l+1]=s>>>16&255,p[l+2]=s>>>8&255,p[l+3]=s>>>0&255,new Uint8Array(p.buffer,0,l+4)},v.deflateRaw=function(s,o){o==null&&(o={level:6});var l=new Uint8Array(50+Math.floor(1.1*s.length)),p=v.F.deflateRaw(s,l,p,o.level);return new Uint8Array(l.buffer,0,p)},v.encode=function(s,o){o==null&&(o=!1);var l,p=0,_=v.bin.writeUint,A=v.bin.writeUshort,k={};for(l in s){var j=!v._noNeed(l)&&!o,B=s[l],z=v.crc.crc(B,0,B.length);k[l]={cpr:j,usize:B.length,crc:z,file:j?v.deflateRaw(B):B}}for(l in k)p+=k[l].file.length+30+46+2*v.bin.sizeUTF8(l);for(l in s=new Uint8Array(p+22),o=0,B=[],k)z=k[l],B.push(o),o=v._writeHeader(s,o,l,z,0);for(l in p=0,j=o,k)z=k[l],B.push(o),o=v._writeHeader(s,o,l,z,1,B[p++]);return k=o-j,_(s,o,101010256),A(s,o=o+4+4,p),A(s,o+=2,p),_(s,o+=2,k),_(s,o+4,j),s.buffer},v._noNeed=function(s){return s=s.split(".").pop().toLowerCase(),"png,jpg,jpeg,zip".indexOf(s)!=-1},v._writeHeader=function(s,o,l,p,_,A){var k=v.bin.writeUint,j=v.bin.writeUshort,B=p.file;return k(s,o,_==0?67324752:33639248),o+=4,_==1&&(o+=2),j(s,o,20),j(s,o+=2,0),j(s,o+=2,p.cpr?8:0),k(s,o+=2,0),k(s,o+=4,p.crc),k(s,o+=4,B.length),k(s,o+=4,p.usize),j(s,o+=4,v.bin.sizeUTF8(l)),j(s,o+=2,0),o+=2,_==1&&(k(s,o=o+2+2+6,A),o+=4),o+=l=v.bin.writeUTF8(s,o,l),_==0&&(s.set(B,o),o+=B.length),o},v.crc={table:function(){for(var s=new Uint32Array(256),o=0;256>o;o++){for(var l=o,p=0;8>p;p++)l=1&l?3988292384^l>>>1:l>>>1;s[o]=l}return s}(),update:function(s,o,l,p){for(var _=0;_<p;_++)s=v.crc.table[255&(s^o[l+_])]^s>>>8;return s},crc:function(s,o,l){return 4294967295^v.crc.update(4294967295,s,o,l)}},v.adler=function(s,o,l){var p=1,_=0,A=o;for(o+=l;A<o;){for(l=Math.min(A+5552,o);A<l;)_+=p+=s[A++];p%=65521,_%=65521}return _<<16|p},v.bin={readUshort:function(s,o){return s[o]|s[o+1]<<8},writeUshort:function(s,o,l){s[o]=255&l,s[o+1]=l>>8&255},readUint:function(s,o){return 16777216*s[o+3]+(s[o+2]<<16|s[o+1]<<8|s[o])},writeUint:function(s,o,l){s[o]=255&l,s[o+1]=l>>8&255,s[o+2]=l>>16&255,s[o+3]=l>>24&255},readASCII:function(s,o,l){for(var p="",_=0;_<l;_++)p+=String.fromCharCode(s[o+_]);return p},writeASCII:function(s,o,l){for(var p=0;p<l.length;p++)s[o+p]=l.charCodeAt(p)},pad:function(s){return 2>s.length?"0"+s:s},readUTF8:function(s,o,l){for(var p,_="",A=0;A<l;A++)_+="%"+v.bin.pad(s[o+A].toString(16));try{p=decodeURIComponent(_)}catch{return v.bin.readASCII(s,o,l)}return p},writeUTF8:function(s,o,l){for(var p=l.length,_=0,A=0;A<p;A++){var k=l.charCodeAt(A);if(!(4294967168&k))s[o+_]=k,_++;else if(!(4294965248&k))s[o+_]=192|k>>6,s[o+_+1]=128|k>>0&63,_+=2;else if(!(4294901760&k))s[o+_]=224|k>>12,s[o+_+1]=128|k>>6&63,s[o+_+2]=128|k>>0&63,_+=3;else{if(4292870144&k)throw"e";s[o+_]=240|k>>18,s[o+_+1]=128|k>>12&63,s[o+_+2]=128|k>>6&63,s[o+_+3]=128|k>>0&63,_+=4}}return _},sizeUTF8:function(s){for(var o=s.length,l=0,p=0;p<o;p++){var _=s.charCodeAt(p);if(!(4294967168&_))l++;else if(!(4294965248&_))l+=2;else if(!(4294901760&_))l+=3;else{if(4292870144&_)throw"e";l+=4}}return l}},v.F={},v.F.deflateRaw=function(s,o,l,p){var _=[[0,0,0,0,0],[4,4,8,4,0],[4,5,16,8,0],[4,6,16,16,0],[4,10,16,32,0],[8,16,32,32,0],[8,16,128,128,0],[8,32,128,256,0],[32,128,258,1024,1],[32,258,258,4096,1]][p],A=v.F.U,k=v.F._goodIndex;v.F._hash;var j=v.F._putsE,B=0;l<<=3;var z=0,Vt=s.length;if(p==0){for(;B<Vt;){var _e=Math.min(65535,Vt-B);j(o,l,B+_e==Vt?1:0),l=v.F._copyExact(s,B,_e,o,l+8),B+=_e}return l>>>3}j=A.lits,p=A.strt;var _n=A.prev,_o=0,_c=0,_d=0,_h=0,_p=0;for(2<Vt&&(p[_p=v.F._hash(s,0)]=0),B=0;B<Vt;B++){if(_e=_p,B+1<Vt-2){_p=v.F._hash(s,B+1);var _f=B+1&32767;_n[_f]=p[_p],p[_p]=_f}if(z<=B){if((14e3<_o||26697<_c)&&100<Vt-B&&(z<B&&(j[_o]=B-z,_o+=2,z=B),l=v.F._writeBlock(B==Vt-1||z==Vt?1:0,j,_o,_h,s,_d,B-_d,o,l),_o=_c=_h=0,_d=B),_f=0,B<Vt-2&&(_f=v.F._bestMatch(s,B,_n,_e,Math.min(_[2],Vt-B),_[3])),_f!=0){_e=_f>>>16,_f&=65535;var e_=k(_e,A.of0);A.lhst[257+e_]++;var u_=k(_f,A.df0);A.dhst[u_]++,_h+=A.exb[e_]+A.dxb[u_],j[_o]=_e<<23|B-z,j[_o+1]=_f<<16|e_<<8|u_,_o+=2,z=B+_e}else A.lhst[s[B]]++;_c++}}for(_d==B&&s.length!=0||(z<B&&(j[_o]=B-z,_o+=2),l=v.F._writeBlock(1,j,_o,_h,s,_d,B-_d,o,l));7&l;)l++;return l>>>3},v.F._bestMatch=function(s,o,l,p,_,A){var k=32767&o,j=l[k],B=k-j+32768&32767;if(j==k||p!=v.F._hash(s,o-B))return 0;for(var z=p=0,Vt=Math.min(32767,o);B<=Vt&&--A!=0&&j!=k;){if((p==0||s[o+p]==s[o+p-B])&&(k=v.F._howLong(s,o,B))>p){if(z=B,(p=k)>=_)break;B+2<k&&(k=B+2);for(var _e=0,_n=0;_n<k-2;_n++){var _o=o-B+_n+32768&32767,_c=_o-l[_o]+32768&32767;_c>_e&&(_e=_c,j=_o)}}B+=(k=j)-(j=l[k])+32768&32767}return p<<16|z},v.F._howLong=function(s,o,l){if(s[o]!=s[o-l]||s[o+1]!=s[o+1-l]||s[o+2]!=s[o+2-l])return 0;var p=o,_=Math.min(s.length,o+258);for(o+=3;o<_&&s[o]==s[o-l];)o++;return o-p},v.F._hash=function(s,o){return(s[o]<<8|s[o+1])+(s[o+2]<<4)&65535},v.saved=0,v.F._writeBlock=function(s,o,l,p,_,A,k,j,B){var z=v.F.U,Vt=v.F._putsF,_e=v.F._putsE;z.lhst[256]++;var _n=v.F.getTrees(),_o=_n[0],_c=_n[1],_d=_n[2],_h=_n[3],_p=_n[4],_f=_n[5],e_=_n[6];_n=_n[7];var u_=32+(B+3&7?8-(B+3&7):0)+(k<<3),w_=p+v.F.contSize(z.fltree,z.lhst)+v.F.contSize(z.fdtree,z.dhst);p=p+v.F.contSize(z.ltree,z.lhst)+v.F.contSize(z.dtree,z.dhst),p+=14+3*_f+v.F.contSize(z.itree,z.ihst)+(2*z.ihst[16]+3*z.ihst[17]+7*z.ihst[18]);for(var O_=0;286>O_;O_++)z.lhst[O_]=0;for(O_=0;30>O_;O_++)z.dhst[O_]=0;for(O_=0;19>O_;O_++)z.ihst[O_]=0;if(u_=u_<w_&&u_<p?0:w_<p?1:2,Vt(j,B,s),Vt(j,B+1,u_),B+=3,u_==0){for(;7&B;)B++;B=v.F._copyExact(_,A,k,j,B)}else{if(u_==1)var y_=z.fltree,Z_=z.fdtree;if(u_==2){for(v.F.makeCodes(z.ltree,_o),v.F.revCodes(z.ltree,_o),v.F.makeCodes(z.dtree,_c),v.F.revCodes(z.dtree,_c),v.F.makeCodes(z.itree,_d),v.F.revCodes(z.itree,_d),y_=z.ltree,Z_=z.dtree,_e(j,B,_h-257),_e(j,B+=5,_p-1),_e(j,B+=5,_f-4),B+=4,s=0;s<_f;s++)_e(j,B+3*s,z.itree[1+(z.ordr[s]<<1)]);B=v.F._codeTiny(e_,z.itree,j,B+3*_f),B=v.F._codeTiny(_n,z.itree,j,B)}for(_f=0;_f<l;_f+=2){for(e_=(s=o[_f])>>>23,s=A+(8388607&s);A<s;)B=v.F._writeLit(_[A++],y_,j,B);e_!=0&&(s=(_o=o[_f+1])>>16,k=_o>>8&255,_o&=255,_e(j,B=v.F._writeLit(257+k,y_,j,B),e_-z.of0[k]),B+=z.exb[k],Vt(j,B=v.F._writeLit(_o,Z_,j,B),s-z.df0[_o]),B+=z.dxb[_o],A+=e_)}B=v.F._writeLit(256,y_,j,B)}return B},v.F._copyExact=function(s,o,l,p,_){var A=_>>>3;return p[A]=l,p[A+1]=l>>>8,p[A+2]=255-p[A],p[A+3]=255-p[A+1],A+=4,p.set(new Uint8Array(s.buffer,o,l),A),_+(l+4<<3)},v.F.getTrees=function(){for(var s=v.F.U,o=v.F._hufTree(s.lhst,s.ltree,15),l=v.F._hufTree(s.dhst,s.dtree,15),p=[],_=v.F._lenCodes(s.ltree,p),A=[],k=v.F._lenCodes(s.dtree,A),j=0;j<p.length;j+=2)s.ihst[p[j]]++;for(j=0;j<A.length;j+=2)s.ihst[A[j]]++;j=v.F._hufTree(s.ihst,s.itree,7);for(var B=19;4<B&&s.itree[1+(s.ordr[B-1]<<1)]==0;)B--;return[o,l,j,_,k,B,p,A]},v.F.getSecond=function(s){for(var o=[],l=0;l<s.length;l+=2)o.push(s[l+1]);return o},v.F.nonZero=function(s){for(var o="",l=0;l<s.length;l+=2)s[l+1]!=0&&(o+=(l>>1)+",");return o},v.F.contSize=function(s,o){for(var l=0,p=0;p<o.length;p++)l+=o[p]*s[1+(p<<1)];return l},v.F._codeTiny=function(s,o,l,p){for(var _=0;_<s.length;_+=2){var A=s[_],k=s[_+1];p=v.F._writeLit(A,o,l,p);var j=A==16?2:A==17?3:7;15<A&&(v.F._putsE(l,p,k,j),p+=j)}return p},v.F._lenCodes=function(s,o){for(var l=s.length;l!=2&&s[l-1]==0;)l-=2;for(var p=0;p<l;p+=2){var _=s[p+1],A=p+3<l?s[p+3]:-1,k=p+5<l?s[p+5]:-1,j=p==0?-1:s[p-1];if(_==0&&A==_&&k==_){for(A=p+5;A+2<l&&s[A+2]==_;)A+=2;11>(_=Math.min(A+1-p>>>1,138))?o.push(17,_-3):o.push(18,_-11),p+=2*_-2}else if(_==j&&A==_&&k==_){for(A=p+5;A+2<l&&s[A+2]==_;)A+=2;_=Math.min(A+1-p>>>1,6),o.push(16,_-3),p+=2*_-2}else o.push(_,0)}return l>>>1},v.F._hufTree=function(s,o,l){var p=[],_=s.length,A=o.length,k=0;for(k=0;k<A;k+=2)o[k]=0,o[k+1]=0;for(k=0;k<_;k++)s[k]!=0&&p.push({lit:k,f:s[k]});if(s=p.length,_=p.slice(0),s==0)return 0;if(s==1)return o[1+((l=p[0].lit)<<1)]=1,o[1+((l==0?1:0)<<1)]=1;p.sort(function(Vt,_e){return Vt.f-_e.f}),k=p[0],A=p[1];var j=0,B=1,z=2;for(p[0]={lit:-1,f:k.f+A.f,l:k,r:A,d:0};B!=s-1;)k=j!=B&&(z==s||p[j].f<p[z].f)?p[j++]:p[z++],A=j!=B&&(z==s||p[j].f<p[z].f)?p[j++]:p[z++],p[B++]={lit:-1,f:k.f+A.f,l:k,r:A};for((p=v.F.setDepth(p[B-1],0))>l&&(v.F.restrictDepth(_,l,p),p=l),k=0;k<s;k++)o[1+(_[k].lit<<1)]=_[k].d;return p},v.F.setDepth=function(s,o){return s.lit!=-1?s.d=o:Math.max(v.F.setDepth(s.l,o+1),v.F.setDepth(s.r,o+1))},v.F.restrictDepth=function(s,o,l){var p=0,_=1<<l-o,A=0;for(s.sort(function(j,B){return B.d==j.d?j.f-B.f:B.d-j.d}),p=0;p<s.length&&s[p].d>o;p++){var k=s[p].d;s[p].d=o,A+=_-(1<<l-k)}for(A>>>=l-o;0<A;)(k=s[p].d)<o?(s[p].d++,A-=1<<o-k-1):p++;for(;0<=p;p--)s[p].d==o&&0>A&&(s[p].d--,A++);A!=0&&console.log("debt left")},v.F._goodIndex=function(s,o){var l=0;return o[16|l]<=s&&(l|=16),o[8|l]<=s&&(l|=8),o[4|l]<=s&&(l|=4),o[2|l]<=s&&(l|=2),o[1|l]<=s&&(l|=1),l},v.F._writeLit=function(s,o,l,p){return v.F._putsF(l,p,o[s<<1]),p+o[1+(s<<1)]},v.F.inflate=function(s,o){var l=Uint8Array;if(s[0]==3&&s[1]==0)return o||new l(0);var p=v.F,_=p._bitsF,A=p._bitsE,k=p._decodeTiny,j=p.makeCodes,B=p.codes2map,z=p._get17,Vt=p.U,_e=o==null;_e&&(o=new l(s.length>>>2<<3));for(var _n,_o,_c,_d,_h=0,_p=0,_f=_o=0,e_=0;_h==0;)if(_h=_(s,e_,1),_n=_(s,e_+1,2),e_+=3,_n==0)7&e_&&(e_+=8-(7&e_)),_n=s[(e_=4+(e_>>>3))-4]|s[e_-3]<<8,_e&&(o=v.F._check(o,_f+_n)),o.set(new l(s.buffer,s.byteOffset+e_,_n),_f),e_=e_+_n<<3,_f+=_n;else{if(_e&&(o=v.F._check(o,_f+131072)),_n==1&&(_c=Vt.flmap,_d=Vt.fdmap,_p=511,_o=31),_n==2){for(_o=A(s,e_,5)+257,_n=A(s,e_+5,5)+1,_c=A(s,e_+10,4)+4,e_+=14,_d=0;38>_d;_d+=2)Vt.itree[_d]=0,Vt.itree[_d+1]=0;for(_p=1,_d=0;_d<_c;_d++){var u_=A(s,e_+3*_d,3);Vt.itree[1+(Vt.ordr[_d]<<1)]=u_,u_>_p&&(_p=u_)}e_+=3*_c,j(Vt.itree,_p),B(Vt.itree,_p,Vt.imap),_c=Vt.lmap,_d=Vt.dmap,e_=k(Vt.imap,(1<<_p)-1,_o+_n,s,e_,Vt.ttree),_p=(1<<(u_=p._copyOut(Vt.ttree,0,_o,Vt.ltree)))-1,_o=(1<<(_n=p._copyOut(Vt.ttree,_o,_n,Vt.dtree)))-1,j(Vt.ltree,u_),B(Vt.ltree,u_,_c),j(Vt.dtree,_n),B(Vt.dtree,_n,_d)}for(;;)if(e_+=15&(_n=_c[z(s,e_)&_p]),(u_=_n>>>4)>>>8==0)o[_f++]=u_;else{if(u_==256)break;_n=_f+u_-254,264<u_&&(_n=_f+((u_=Vt.ldef[u_-257])>>>3)+A(s,e_,7&u_),e_+=7&u_),e_+=15&(u_=_d[z(s,e_)&_o]);var w_=((u_=Vt.ddef[u_>>>4])>>>4)+_(s,e_,15&u_);for(e_+=15&u_,_e&&(o=v.F._check(o,_f+131072));_f<_n;)o[_f]=o[_f++-w_],o[_f]=o[_f++-w_],o[_f]=o[_f++-w_],o[_f]=o[_f++-w_];_f=_n}}return o.length==_f?o:o.slice(0,_f)},v.F._check=function(s,o){var l=s.length;return o<=l?s:((o=new Uint8Array(Math.max(l<<1,o))).set(s,0),o)},v.F._decodeTiny=function(s,o,l,p,_,A){for(var k=v.F._bitsE,j=v.F._get17,B=0;B<l;){var z=s[j(p,_)&o];_+=15&z;var Vt=z>>>4;if(15>=Vt)A[B]=Vt,B++;else{var _e=z=0;for(Vt==16?(_e=3+k(p,_,2),_+=2,z=A[B-1]):Vt==17?(_e=3+k(p,_,3),_+=3):Vt==18&&(_e=11+k(p,_,7),_+=7),Vt=B+_e;B<Vt;)A[B]=z,B++}}return _},v.F._copyOut=function(s,o,l,p){for(var _=0,A=0,k=p.length>>>1;A<l;){var j=s[A+o];p[A<<1]=0,p[1+(A<<1)]=j,j>_&&(_=j),A++}for(;A<k;)p[A<<1]=0,p[1+(A<<1)]=0,A++;return _},v.F.makeCodes=function(s,o){var l,p,_=v.F.U,A=s.length,k=_.bl_count;for(l=0;l<=o;l++)k[l]=0;for(l=1;l<A;l+=2)k[s[l]]++;for(_=_.next_code,l=0,k[0]=0,p=1;p<=o;p++)l=l+k[p-1]<<1,_[p]=l;for(o=0;o<A;o+=2)(k=s[o+1])!=0&&(s[o]=_[k],_[k]++)},v.F.codes2map=function(s,o,l){for(var p=s.length,_=v.F.U.rev15,A=0;A<p;A+=2)if(s[A+1]!=0){var k=s[A+1],j=A>>1<<4|k,B=o-k;for(B=(k=s[A]<<B)+(1<<B);k!=B;)l[_[k]>>>15-o]=j,k++}},v.F.revCodes=function(s,o){for(var l=v.F.U.rev15,p=15-o,_=0;_<s.length;_+=2)s[_]=l[s[_]<<o-s[_+1]]>>>p},v.F._putsE=function(s,o,l){l<<=7&o,s[o>>>=3]|=l,s[o+1]|=l>>>8},v.F._putsF=function(s,o,l){l<<=7&o,s[o>>>=3]|=l,s[o+1]|=l>>>8,s[o+2]|=l>>>16},v.F._bitsE=function(s,o,l){return(s[o>>>3]|s[1+(o>>>3)]<<8)>>>(7&o)&(1<<l)-1},v.F._bitsF=function(s,o,l){return(s[o>>>3]|s[1+(o>>>3)]<<8|s[2+(o>>>3)]<<16)>>>(7&o)&(1<<l)-1},v.F._get17=function(s,o){return(s[o>>>3]|s[1+(o>>>3)]<<8|s[2+(o>>>3)]<<16)>>>(7&o)},v.F._get25=function(s,o){return(s[o>>>3]|s[1+(o>>>3)]<<8|s[2+(o>>>3)]<<16|s[3+(o>>>3)]<<24)>>>(7&o)},v.F.U=function(){var s=Uint16Array,o=Uint32Array;return{next_code:new s(16),bl_count:new s(16),ordr:[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],of0:[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,999,999,999],exb:[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0],ldef:new s(32),df0:[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,65535,65535],dxb:[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0],ddef:new o(32),flmap:new s(512),fltree:[],fdmap:new s(32),fdtree:[],lmap:new s(32768),ltree:[],ttree:[],dmap:new s(32768),dtree:[],imap:new s(512),itree:[],rev15:new s(32768),lhst:new o(286),dhst:new o(30),ihst:new o(19),lits:new o(15e3),strt:new s(65536),prev:new s(32768)}}(),function(){function s(_,A,k){for(;A--!=0;)_.push(0,k)}for(var o=v.F.U,l=0;32768>l;l++){var p=l;p=(4278255360&(p=(4042322160&(p=(3435973836&(p=(2863311530&p)>>>1|(1431655765&p)<<1))>>>2|(858993459&p)<<2))>>>4|(252645135&p)<<4))>>>8|(16711935&p)<<8,o.rev15[l]=(p>>>16|p<<16)>>>17}for(l=0;32>l;l++)o.ldef[l]=o.of0[l]<<3|o.exb[l],o.ddef[l]=o.df0[l]<<4|o.dxb[l];s(o.fltree,144,8),s(o.fltree,112,9),s(o.fltree,24,7),s(o.fltree,8,8),v.F.makeCodes(o.fltree,9),v.F.codes2map(o.fltree,9,o.flmap),v.F.revCodes(o.fltree,9),s(o.fdtree,32,5),v.F.makeCodes(o.fdtree,5),v.F.codes2map(o.fdtree,5,o.fdmap),v.F.revCodes(o.fdtree,5),s(o.itree,19,0),s(o.ltree,286,0),s(o.dtree,30,0),s(o.ttree,320,0)}();var iD=["backups","servers"],jD=["backups","servers"],kD=["group"],nl=v.inflate,ks=v.deflate,ls=function(s){function o(p,_,A,k){W(this,o);var j=l.call(this,k,"Session");return m(n(j),"chatManager",void 0),m(n(j),"joinedChannels",new Set),m(n(j),"msgDedupLru",new tc(void 0,{maxlen:200})),m(n(j),"startTime",Date.now()),m(n(j),"seq",U.fromNumber(1,!0)),m(n(j),"userJoinOptions",new is(!1)),m(n(j),"seqSentStatuses",[!1,!1]),m(n(j),"dialogueSequenceLru",new tc(void 0,{maxlen:1e4})),m(n(j),"loggedOut",!1),m(n(j),"messageSentTimes",[]),m(n(j),"curLoginSockets",[void 0,void 0]),m(n(j),"loginSocketSubs",[{channels:new Map,receivers:[]},{channels:new Map,receivers:[]}]),m(n(j),"lastLoginSockets",[new qe(1),new qe(1)]),m(n(j),"dialPendingMsgSubjectMap",new Map),m(n(j),"context",void 0),m(n(j),"connection",void 0),m(n(j),"instanceId",void 0),m(n(j),"registerSocketsFailureListener",function(){j.connection.once("socketsFailure",function(){j.log("socketsFailure, creating a new connection"),ad(function(){return j.connection.removeAllListeners(),j.connection=new Yr(j.context,j.logger,!0),j.loginHandler(15e3,!0)}).pipe(oe(function(B){return B.pipe(cd(Zd.getParameter("RECONNECTING_AP_INTERVAL")))}),ob(j.connection.apClient.apFinish$)).subscribe(function(){j.log("new connection connected")})}),j.connection.listenerCount("tokenExpired")===0&&j.connection.on("tokenExpired",function(){j.emit("tokenExpired")})}),j.context=p,j.connection=_,j.instanceId=A,j.chatManager=new hD(k),j.log("The instanceId is %s",j.instanceId.toString()),j}la(o,s);var l=ma(o);return Ha(o,[{key:"fetchFileUploadIndexGet",value:function(p){var _=p.hash,A=p.size;if((p=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var k=this.incGetSeq();return p.forEach(function(j){j.sendPacket("FileUploadIndexGet",{seq:k,hash:_,size:A})}),{ret:Ca.apply(void 0,G(p.map(function(j){return j.fromReceived("FileUploadIndexRet").pipe(aa(function(B){return k.eq(B.seq)}))}))),fin:Ca.apply(void 0,G(p.map(function(j){return j.fromReceived("FileUploadIndexFin").pipe(aa(function(B){return k.eq(B.seq)}))}))),err:Xb.apply(void 0,G(p.map(function(j){return j.fromReceived("FileUploadIndexErr").pipe(aa(function(B){return k.eq(B.seq)}),ba(function(B){throw new da(["The media message upload failure, code %d",B.code],lg)}))}))),timeout:o.genTimeoutError(Lh)}}},{key:"requestFileUploadIndexSet",value:function(p){var _=p.hash,A=p.unit,k=p.servers;if((p=this.getLoginSockets()).length===0)throw new K("Client is not logged in");var j=this.incGetSeq();return p.forEach(function(B){B.sendPacket("FileUploadIndexSet",{seq:j,servers:k,hash:_,unit:A})}),Ca.apply(void 0,[o.genTimeoutError(Lh)].concat(G(p.map(function(B){return B.fromReceived("FileUploadIndexErr").pipe(aa(function(z){return j.eq(z.seq)}),ba(function(z){throw new da(["FileUploadIndexSet failure, code %d",z.code],lg)}))})),G(p.map(function(B){return B.fromReceived("FileUploadIndexFin").pipe(aa(function(z){return j.eq(z.seq)}))}))))}},{key:"requestFileDownloadIndexGet",value:function(p){var _=p.size,A=p.zone,k=p.unit,j=p.hash,B=this.getLoginSockets();if(B.length===0)throw new K("Client is not logged in");var z=this.incGetSeq();return B.forEach(function(Vt){Vt.sendPacket("FileDownloadIndexGet",{seq:z,size:_,zone:A,unit:k,hash:j})}),p=Ca.apply(void 0,G(B.map(function(Vt){return Vt.fromReceived("FileDownloadIndexRet").pipe(aa(function(_e){return z.eq(_e.seq)}))}))).pipe(ba(function(Vt){var _e=Vt.backups,_n=Vt.servers;return Vt=ff(Vt,iD),ua({backupList:_e.map(function(_o){return[_o]}),serverList:_n.map(function(_o){return[_o]})},Vt)}),cd(500)),B=jm(B.map(function(Vt){return Vt.fromReceived("FileDownloadIndexRet").pipe(aa(function(_e){return z.eq(_e.seq)}))})),Ca(p,B.pipe(ba(function(Vt){return Vt.reduce(function(_e,_n){var _o=_e.backupList,_c=_e.serverList;_e=_n.backups;var _d=_n.servers;return _n=ff(_n,jD),ua({backupList:_e.map(function(_h,_p){return[_h].concat(G(_o!==void 0&&Array.isArray(_o[_p])?_o[_p]:[]))}),serverList:_d.map(function(_h,_p){return[_h].concat(G(_o!==void 0&&Array.isArray(_c[_p])?_c[_p]:[]))})},_n)},{})})),o.genTimeoutError(Lh))}},{key:"loginHandler",value:function(){var p=this,_=0<arguments.length&&arguments[0]!==void 0?arguments[0]:2e4,A=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(this.loggedOut&&A)throw new K("Already logged out, request ignored");A&&this.registerSocketsFailureListener(),this.connection.initConnection();var k=this.getSocketLoginObservables(this.connection.lastOpenSockets,this.seq),j=Date.now();return k.forEach(function(B,z){var Vt=p.loginSocketSubs[z].login;Vt!==void 0&&Vt.unsubscribe(),p.loginSocketSubs[z].login=B.pipe(ca(function(_e){var _n;p.curLoginSockets[z]=_e;var _o=Date.now();eb("Link",{ackedServerIp:_e.address,destServerIp:_e.ip,ec:0,sc:0,elapse:fb(p.startTime),lts:U.fromNumber(_o),responseTime:j-_o,sid:Xa(p.instanceId),userId:p.context.uid},(_n=p.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n),p.emit("userJoined",_e.env),A&&p.connection.apClient.apFinish$.next(void 0)})).subscribe(p.lastLoginSockets[z])}),this.initKeepAliveSender(),this.initKeepAliveReconnector(),this.initLoginReceiver(),Xb.apply(void 0,G(k).concat([gb(this.connection,"connectionInitFailure").pipe(ca(function(B){throw sa(B)||Sa(B)?B:new da("Login failure",{code:Zq,originalError:B})}))])).pipe(Ka(1),hb(_),Ga(function(B){return B instanceof pb&&p.warn("Client login timeout"),B&&B.code===Kh&&(p.connection.emit("tokenExpired"),p.connection.apClient.apFinish$.next(void 0)),p.clearSockets(0,A),Z(B)}),ca(function(){A||p.registerSocketsFailureListener()}),wg(function(){A||p.connection.apClient.apFinish$.next(void 0)}))}},{key:"logoutHandler",value:function(){var p=J(w.mark(function _(){var A,k,j,B=this;return w.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return this.loggedOut=!0,this.connection.apClient.apFinish$.next(void 0),A=this.getLoginSockets(),k=A.map(function(Vt){return Vt.sendPacket("UserQuit",{}),B.connection.waitClosing(Vt)}),this.clearSockets(5e3),j=A.map(function(Vt){return Vt.env}),[0,1].filter(function(Vt){return!j.includes(Vt)}).forEach(function(Vt){B.connection.closeSocket(Vt,0)}),z.abrupt("return",Xb.apply(void 0,G(k)).toPromise());case 9:case"end":return z.stop()}},_,this)}));return function(){return p.apply(this,arguments)}}()},{key:"requestChannelJoin",value:function(){var p=J(w.mark(function _(A,k){var j,B,z,Vt=this;return w.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(this.getLoginSockets().length!==0){_e.next=2;break}throw new K("Client is not logged in. Cannot join the channel",Vq);case 2:return j=gb(this,"channelLeft").pipe(wb(function(_n){return _n===A}),Ka(1)),B=this.incGetSeq(),(z=this.lastLoginSockets.map(function(_n){return _n.pipe(Cc(function(_o,_c){_c!==0&&Vt.incSeqIfNeeded(_o.env);var _d=_c===0?B:Vt.seq;return _o.sendPacket("GroupEnter",{account:k,seq:_d}),_o.fromReceived("GroupReply").pipe(aa(function(_h){return _d.eq(_h.seq)}),ca(function(_h){if((_h=_h.code)!==0)throw new da(["Channel join failure. The response code is %d",_h],Rq)}))}),ob(j),pe())})).forEach(function(_n,_o){var _c=function(){return Vt.loginSocketSubs[_o].channels.delete(A.channelId)};Vt.loginSocketSubs[_o].channels.set(A.channelId,_n.subscribe({error:_c,complete:_c}))}),_e.next=8,Xb.apply(void 0,G(z)).pipe(Ka(1),hb(1e4),Ga(function(_n){return _n instanceof pb&&Vt.warn("Channel join timeout"),Z(_n)})).toPromise();case 8:this.joinedChannels.add(A);case 9:case"end":return _e.stop()}},_,this)}));return function(_,A){return p.apply(this,arguments)}}()},{key:"requestChannelLeave",value:function(p,_){this.emit("channelLeft",p),this.joinedChannels.delete(p),this.getLoginSockets().forEach(function(A){A.sendPacket("GroupLeave",{account:_})})}},{key:"requestChannelMemberList",value:function(p){var _=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in. Cannot get the channel members",cA);var A=this.incGetSeq();return _.forEach(function(k){k.sendPacket("GroupAllUsersList",{group:p,pageNumber:0,pageSize:200,seq:A})}),Ca.apply(void 0,[o.genTimeoutError(Pq)].concat(G(_.map(function(k){return k.fromReceived("GroupAllUsersResult").pipe(aa(function(j){var B=j.seq;return j.group===p&&A.eq(B)}))}))))}},{key:"requestPeersOnlineStatus",value:function(p){var _=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return _.forEach(function(k){k.sendPacket("UserStatusList",{users:p,seq:A})}),Ca.apply(void 0,[o.genTimeoutError(oA)].concat(G(_.map(function(k){return k.fromReceived("UserStatusResult").pipe(aa(function(j){return A.eq(j.seq)}))}))))}},{key:"requestSetLocalUserAttributes",value:function(p,_){var A=this,k=this.getLoginSockets();if(k.length===0)throw new K("Client is not logged in");var j=this.incGetSeq();return k.forEach(function(B,z){_!==void 0&&z!==_||B.sendPacket("UserAttributeSet",{account:A.context.uid,attributeInfos:Object.entries(p).map(function(Vt){return{key:(Vt=ra(Vt,2))[0],value:Vt[1]}}),seq:j})}),Ca.apply(void 0,G(k.map(function(B){return B.fromReceived("UserAttributeErr").pipe(aa(function(z){return j.eq(z.seq)}),ba(function(z){throw new da(["The user attributes set failure, code %d",z.code],Sb)}))})).concat([o.genTimeoutError(Tb)],G(k.map(function(B){return B.fromReceived("UserAttributeRsp").pipe(aa(function(z){return j.eq(z.seq)}))}))))}},{key:"requestSetChannelAttributes",value:function(p,_,A){var k=this.getLoginSockets();if(k.length===0)throw new K("Client is not logged in");var j=this.incGetSeq();return k.forEach(function(B){B.sendPacket("GroupAttributeSet",{broadcast:A,group:p,attributeInfos:Object.entries(_).map(function(z){return{key:(z=ra(z,2))[0],value:z[1]}}),seq:j})}),Ca.apply(void 0,G(k.map(function(B){return B.fromReceived("GroupAttributeErr").pipe(aa(function(z){return j.eq(z.seq)}),ba(function(z){throw new da(["The group attributes set failure, code %d",z.code],Sb)}))})).concat([o.genTimeoutError(Tb)],G(k.map(function(B){return B.fromReceived("GroupAttributeRsp").pipe(aa(function(z){return j.eq(z.seq)}))}))))}},{key:"requestAddOrUpdateLocalUserAttributes",value:function(p){var _=this,A=this.getLoginSockets();if(A.length===0)throw new K("Client is not logged in");var k=this.incGetSeq();return A.forEach(function(j){j.sendPacket("UserAttributeMod",{account:_.context.uid,attributeInfos:Object.entries(p).map(function(B){return{key:(B=ra(B,2))[0],value:B[1]}}),seq:k})}),Ca.apply(void 0,G(A.map(function(j){return j.fromReceived("UserAttributeErr").pipe(aa(function(B){return k.eq(B.seq)}),ba(function(B){throw new da(["The user attributes add or update failure, code %d",B.code],Sb)}))})).concat([o.genTimeoutError(Tb)],G(A.map(function(j){return j.fromReceived("UserAttributeRsp").pipe(aa(function(B){return k.eq(B.seq)}))}))))}},{key:"requestAddOrUpdateChannelAttributes",value:function(p,_,A){var k=this.getLoginSockets();if(k.length===0)throw new K("Client is not logged in");var j=this.incGetSeq();return k.forEach(function(B){B.sendPacket("GroupAttributeMod",{broadcast:A,group:p,attributeInfos:Object.entries(_).map(function(z){return{key:(z=ra(z,2))[0],value:z[1]}}),seq:j})}),Ca.apply(void 0,G(k.map(function(B){return B.fromReceived("GroupAttributeErr").pipe(aa(function(z){return j.eq(z.seq)}),ba(function(z){throw new da(["The group attributes add or update failure, code %d",z.code],Sb)}))})).concat([o.genTimeoutError(Tb)],G(k.map(function(B){return B.fromReceived("GroupAttributeRsp").pipe(aa(function(z){return j.eq(z.seq)}))}))))}},{key:"requestDeleteLocalUserAttributesByKeys",value:function(p){var _=this,A=this.getLoginSockets();if(A.length===0)throw new K("Client is not logged in");var k=this.incGetSeq();return A.forEach(function(j){j.sendPacket("UserAttributeDel",{account:_.context.uid,attributes:p,seq:k})}),Ca.apply(void 0,G(A.map(function(j){return j.fromReceived("UserAttributeErr").pipe(aa(function(B){return k.eq(B.seq)}),ba(function(B){throw new da(["The user attributes delete failure, code %d",B.code],Sb)}))})).concat([o.genTimeoutError(Tb)],G(A.map(function(j){return j.fromReceived("UserAttributeRsp").pipe(aa(function(B){return k.eq(B.seq)}))}))))}},{key:"requestDeleteChannelAttributesByKeys",value:function(p,_,A){var k=this.getLoginSockets();if(k.length===0)throw new K("Client is not logged in");var j=this.incGetSeq();return k.forEach(function(B){B.sendPacket("GroupAttributeDel",{group:p,broadcast:A,attributes:_,seq:j})}),Ca.apply(void 0,G(k.map(function(B){return B.fromReceived("GroupAttributeErr").pipe(aa(function(z){return j.eq(z.seq)}),ba(function(z){throw new da(["The channel attributes delete failure, code %d",z.code],Sb)}))})).concat([o.genTimeoutError(Tb)],G(k.map(function(B){return B.fromReceived("GroupAttributeRsp").pipe(aa(function(z){return j.eq(z.seq)}))}))))}},{key:"requestClearLocalUserAttributes",value:function(){var p=this,_=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return _.forEach(function(k){k.sendPacket("UserAttributeSet",{account:p.context.uid,seq:A,attributeInfos:[]})}),Ca.apply(void 0,G(_.map(function(k){return k.fromReceived("UserAttributeErr").pipe(aa(function(j){return A.eq(j.seq)}),ba(function(j){throw new da(["The user attributes clear failure, code %d",j.code],Sb)}))})).concat([o.genTimeoutError(Tb)],G(_.map(function(k){return k.fromReceived("UserAttributeRsp").pipe(aa(function(j){return A.eq(j.seq)}))}))))}},{key:"requestClearChannelAttributes",value:function(p,_){var A=this.getLoginSockets();if(A.length===0)throw new K("Client is not logged in");var k=this.incGetSeq();return A.forEach(function(j){j.sendPacket("GroupAttributeSet",{group:p,seq:k,attributeInfos:[],broadcast:_})}),Ca.apply(void 0,G(A.map(function(j){return j.fromReceived("GroupAttributeErr").pipe(aa(function(B){return k.eq(B.seq)}),ba(function(B){throw new da(["The channel attributes clear failure, code %d",B.code],Sb)}))})).concat([o.genTimeoutError(Tb)],G(A.map(function(j){return j.fromReceived("GroupAttributeRsp").pipe(aa(function(B){return k.eq(B.seq)}))}))))}},{key:"requestGetUserAttributesByKeys",value:function(p,_){var A=this.getLoginSockets();if(A.length===0)throw new K("Client is not logged in");var k=this.incGetSeq();return A.forEach(function(j){j.sendPacket("UserAttributeGet",{account:p,seq:k,attributes:_})}),Ca.apply(void 0,[o.genTimeoutError(Tb)].concat(G(A.map(function(j){return j.fromReceived("UserAttributeErr").pipe(aa(function(B){return k.eq(B.seq)}),ba(function(B){throw(B=B.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",B],Sb)}))})),G(A.map(function(j){return j.fromReceived("UserAttributeRet").pipe(aa(function(B){return k.eq(B.seq)}))}))))}},{key:"requestGetChannelAttributesByKeys",value:function(p,_){var A=this.getLoginSockets();if(A.length===0)throw new K("Client is not logged in");var k=this.incGetSeq();return A.forEach(function(j){j.sendPacket("GroupAttributeGet",{group:p,seq:k,attributes:_})}),Ca.apply(void 0,[o.genTimeoutError(Tb)].concat(G(A.map(function(j){return j.fromReceived("GroupAttributeErr").pipe(aa(function(B){return k.eq(B.seq)}),ba(function(B){throw new da(["The channel attributes get failure, code %d",B.code],Sb)}))})),G(A.map(function(j){return j.fromReceived("GroupAttributeRet").pipe(aa(function(B){return k.eq(B.seq)}))}))))}},{key:"requestGetUserAttributeKeys",value:function(p){var _=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return _.forEach(function(k){k.sendPacket("UserAttributeKeysGet",{account:p,seq:A})}),Ca.apply(void 0,[o.genTimeoutError(Tb)].concat(G(_.map(function(k){return k.fromReceived("UserAttributeErr").pipe(aa(function(j){return A.eq(j.seq)}),ba(function(j){throw(j=j.code)===10008?new da("The user requested is not online",Lq):new Wc(["User attribute operation unknown error code: %d",j],Sb)}))})),G(_.map(function(k){return k.fromReceived("UserAttributeKeysRet").pipe(aa(function(j){return A.eq(j.seq)}))}))))}},{key:"requestGetChannelAttributesKeys",value:function(p){var _=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return _.forEach(function(k){k.sendPacket("GroupAttributeKeysGet",{group:p,seq:A})}),Ca.apply(void 0,[o.genTimeoutError(Tb)].concat(G(_.map(function(k){return k.fromReceived("GroupAttributeErr").pipe(aa(function(j){return A.eq(j.seq)}),ba(function(j){throw new Wc(["Channel attribute operation unknown error code: %d",j.code],Sb)}))})),G(_.map(function(k){return k.fromReceived("GroupAttributeKeysRet").pipe(aa(function(j){return A.eq(j.seq)}))}))))}},{key:"requestGetChannelMemberCount",value:function(p){var _=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return _.forEach(function(k){k.sendPacket("GroupStatusList",{groups:p,seq:A})}),Ca.apply(void 0,[o.genTimeoutError(Pq)].concat(G(_.map(function(k){return k.fromReceived("GroupStatusResult").pipe(aa(function(j){return A.eq(j.seq)}))}))))}},{key:"requestSubscribePeersOnlineStatus",value:function(p){var _=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();return _.forEach(function(k){k.sendPacket("SubscribeUserStatus",{seq:A,users:p})}),Ca.apply(void 0,[o.genTimeoutError(vA)].concat(G(_.map(function(k){return k.fromReceived("SubscribeResponse").pipe(aa(function(j){return A.eq(j.seq)}))}))))}},{key:"requestUnsubscribePeersOnlineStatus",value:function(p){var _=this.getLoginSockets();if(_.length===0)throw new K("Client is not logged in");var A=this.incGetSeq();_.forEach(function(k){k.sendPacket("UnsubscribeUserStatus",{seq:A,users:p})})}},{key:"sendInvitationMessage",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt,_e,_n,_o,_c,_d,_h,_p,_f=this;return w.wrap(function(e_){for(;;)switch(e_.prev=e_.next){case 0:if(k=A.peerId,j=A.callId,B=A.extra,z=A.isAcceptAck,Vt=A.channelId,_e=A.type,_n={callId:j},z===void 0){e_.next=6;break}if(_e==="CallAccept"){e_.next=5;break}throw Error("invalid invitation type");case 5:_n.type=z?"ack":"request";case 6:return _n.channel=Vt,(_e==="CallInvite"||_e==="CallCancel"||_e==="CallReject"||_e==="CallAccept"&&z===!1)&&B!==void 0&&(_n.extra=B),_o=Bg(),this.log("The sent invitation body is %o",_n),_c=function(u_){return{MiscMap:{},sequence:U.fromNumber(1),dialogue:_o,instance:_f.instanceId,dst:k,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:u_,MessageType:_e}).toLong(),payload:new TextEncoder().encode(JSON.stringify(_n)),src:_f.context.uid}},e_.next=14,Kb(this.sendMessageToRetry(_c,!0)).pipe(hb(1e4),Ga(function(u_){return u_ instanceof pb&&_f.warn("Send invitation timeout"),Z(u_)})).toPromise();case 14:return _d=e_.sent,_h=_d.code,_p=_d.retryTimes,e_.abrupt("return",{hasPeerReceived:_h===0,hasReSent:_p!==0});case 18:case"end":return e_.stop()}},_,this)}));return function(_){return p.apply(this,arguments)}}()},{key:"sendMediaMessage",value:function(){var p=J(w.mark(function _(A,k,j,B,z,Vt){var _e,_n,_o,_c,_d,_h,_p,_f,e_,u_,w_,O_,y_,Z_,NE,i_,S_,h_,I_,vf,o_,d_,g_,v_,M_,R_,X_,q_,lE,Lb=this;return w.wrap(function(vS){for(;;)switch(vS.prev=vS.next){case 0:if(_n=k.width,_o=_n===void 0?0:_n,_c=k.height,_d=_c===void 0?0:_c,_h=k.fileName,_p=_h===void 0?"":_h,_f=k.description,e_=_f===void 0?"":_f,u_=k.thumbnail,w_=u_===void 0?new Blob:u_,O_=k.thumbnailHeight,y_=O_===void 0?0:O_,Z_=k.thumbnailWidth,NE=Z_===void 0?0:Z_,i_=k.size,S_=i_===void 0?0:i_,h_=k.mediaId,I_=z.enableOfflineMessaging,vf=z.enableHistoricalMessaging,za(j)){vS.next=4;break}throw new I("The send message arguments are not valid",B?$k:hg);case 4:if(!(32768<new Blob([_p,w_,e_]).size)){vS.next=6;break}throw new I("The size of message overflowed ",B?ve:Hh);case 6:return o_=this.chatManager.getChatInfo(j),d_=o_.dialogue,g_=o_.sequence,v_=this.instanceId,this.log('A%s media message is sending to %s: "'.concat(v_,"-").concat(d_,"#").concat(g_,'"'),B?" peer":" channel",oa(j)),m(_e={},"media_description",e_),m(_e,"media_width",_o),m(_e,"media_height",_d),m(_e,"media_thumbnailwidth",NE),m(_e,"media_thumbnailheight",y_),m(_e,"media_size",S_),m(_e,"media_id",h_),m(_e,"media_filename",_p),M_=uc(_e,function(jT){return new TextEncoder().encode(jT.toString())}),vS.t0=Uint8Array,vS.next=14,Ji(w_);case 14:return vS.t1=vS.sent,M_.media_thumbnail=new vS.t0(vS.t1),R_=B&&A==="IMAGE"?"PeerImageMessage":B&&A==="FILE"?"PeerFileMessage":B||A!=="IMAGE"?"ChannelFileMessage":"ChannelImageMessage",X_=function(jT){return{MiscMap:M_,sequence:g_,dialogue:d_,instance:v_,dst:j,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:jT,CompressionMethod:"Uncompressed",MessageType:R_,ToCache:I_,ToArchive:vf}).toLong(),payload:new Uint8Array,src:Lb.context.uid}},vS.next=20,Kb(this.sendMessageToRetry(X_,!0)).pipe(hb(Vt===void 0?1e4:Vt),Ga(function(jT){return jT instanceof pb&&Lb.warn("Send message timeout"),Z(jT)})).toPromise();case 20:if(q_=vS.sent,(lE=q_.code)!==2){vS.next=24;break}throw new da("The peer does not support this type of message",nA);case 24:return vS.abrupt("return",{hasPeerReceived:lE===0});case 25:case"end":return vS.stop()}},_,this)}));return function(_,A,k,j,B,z){return p.apply(this,arguments)}}()},{key:"sendRawMessage",value:function(){var p=J(w.mark(function _(A,k,j,B,z,Vt){var _e,_n,_o,_c,_d,_h,_p,_f,e_,u_,w_=this;return w.wrap(function(O_){for(;;)switch(O_.prev=O_.next){case 0:if(_e=z.enableOfflineMessaging,_n=z.enableHistoricalMessaging,za(j)&&A instanceof Uint8Array&&typeof k=="string"){O_.next=3;break}throw new I("The send message arguments are not valid",B?$k:hg);case 3:if(!(32768<A.byteLength+new Blob([k]).size)){O_.next=5;break}throw new ib("The message size is over the 32KB limit",B?ve:Hh);case 5:return _o=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=A.byteLength,_c=this.chatManager.getChatInfo(j),_d=_c.dialogue,_h=_c.sequence,_p=this.instanceId,this.log('A%s %s raw message is sending to %s: "'.concat(_p,"-").concat(_d,"#").concat(_h,'"'),_o?" compressed":"",B?"peer":"channel",oa(j)),_f=function(y_){return{MiscMap:{description:new TextEncoder().encode(k)},sequence:_h,dialogue:_d,instance:_p,dst:j,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:y_,CompressionMethod:_o?"Zlib":"Uncompressed",MessageType:B?"PeerRawMessage":"ChannelRawMessage",ToCache:_e,ToArchive:_n}).toLong(),payload:_o?ks(A):A,src:w_.context.uid}},O_.next=12,Kb(this.sendMessageToRetry(_f,!0)).pipe(hb(Vt===void 0?1e4:Vt),Ga(function(y_){return y_ instanceof pb&&w_.warn("Send message timeout"),Z(y_)})).toPromise();case 12:return e_=O_.sent,u_=e_.code,O_.abrupt("return",{hasPeerReceived:u_===0});case 15:case"end":return O_.stop()}},_,this)}));return function(_,A,k,j,B,z){return p.apply(this,arguments)}}()},{key:"sendTextMessage",value:function(){var p=J(w.mark(function _(A,k,j,B,z){var Vt,_e,_n,_o,_c,_d,_h,_p,_f,e_,u_,w_=this;return w.wrap(function(O_){for(;;)switch(O_.prev=O_.next){case 0:if(Vt=B.enableOfflineMessaging,_e=B.enableHistoricalMessaging,za(k)){O_.next=3;break}throw new I("The send message arguments are not valid",j?$k:hg);case 3:if(!(32768<new Blob([A]).size)){O_.next=5;break}throw new ib("The message size is over the 32KB limit",j?ve:Hh);case 5:return _n=!Zd.getParameter("DISABLE_MESSAGE_COMPRESSION")&&128<=new Blob([A]).size,_o=this.chatManager.getChatInfo(k),_c=_o.dialogue,_d=_o.sequence,_h=this.instanceId,this.log('A%s %s message is sending to %s: "'.concat(_h,"-").concat(_c,"#").concat(_d,'"'),_n?" compressed":"",j?"peer":"channel",oa(k)),_p=new TextEncoder().encode(A),_f=function(y_){return{MiscMap:{},sequence:_d,dialogue:_c,instance:_h,dst:k,ms:U.fromNumber(Date.now(),!0),options:new ae({IterationNumber:y_,CompressionMethod:_n?"Zlib":"Uncompressed",MessageType:j?"PeerTextMessage":"ChannelTextMessage",ToCache:Vt,ToArchive:_e}).toLong(),payload:_n?ks(_p):_p,src:w_.context.uid}},O_.next=13,Kb(this.sendMessageToRetry(_f,!0)).pipe(hb(z===void 0?1e4:z),Ga(function(y_){return y_ instanceof pb&&w_.warn("Send message timeout"),Z(y_)})).toPromise();case 13:return e_=O_.sent,u_=e_.code,O_.abrupt("return",{hasPeerReceived:u_===0});case 16:case"end":return O_.stop()}},_,this)}));return function(_,A,k,j,B){return p.apply(this,arguments)}}()},{key:"cleanLoginSubs",value:function(p,_){Object.entries(this.loginSocketSubs[p]).forEach(function(A){var k=(A=ra(A,2))[1];A[0]==="channels"&&_||(Array.isArray(k)||k instanceof Map?k.forEach(function(j){return j.unsubscribe()}):k&&k.unsubscribe())}),this.loginSocketSubs[p]={channels:_?this.loginSocketSubs[p].channels:new Map,receivers:[]}}},{key:"sendMessageToRetry",value:function(){var p=J(w.mark(function _(A,k){var j,B,z,Vt,_e,_n,_o,_c,_d,_h=this,_p=arguments;return w.wrap(function(_f){for(;;)switch(_f.prev=_f.next){case 0:if(j=2<_p.length&&_p[2]!==void 0?_p[2]:0,this.log("Attempt to send the message ".concat(k?" with retrying, %o":"without retrying"),{retryTimes:j}),(B=this.getLoginSockets()).length!==0){_f.next=5;break}throw Error("no logged-in sockets");case 5:return z=A(j),B.forEach(function(e_){e_.sendPacket("Message",z)}),Vt=z.dialogue,_e=z.sequence,_n=z.instance,_o=B.map(function(e_){return e_.fromReceived("Ack").pipe(wb(function(u_){return Vt.eq(u_.dialogue)&&_e.eq(u_.sequence)&&_n.eq(u_.instance)}))}),_f.prev=9,_f.next=12,Xb.apply(void 0,G(_o)).pipe(hb(6e3),Ga(function(e_){return Sa(e_)&&_h.warn("Message send timeout, retry times %d",j),Z(e_)}),Ka(1)).toPromise();case 12:return _c=_f.sent,_d=_c.code,this.log("The message has been acked, %o",{code:_d}),_f.abrupt("return",{code:_d,retryTimes:j});case 18:if(_f.prev=18,_f.t0=_f.catch(9),!(_f.t0 instanceof pb&&k)){_f.next=22;break}return _f.abrupt("return",this.sendMessageToRetry(A,!1,j+1));case 22:throw _f.t0;case 23:case"end":return _f.stop()}},_,this,[[9,18]])}));return function(_,A){return p.apply(this,arguments)}}()},{key:"initKeepAliveSender",value:function(){var p=this;this.lastLoginSockets.map(function(_){return _.pipe(Cc(function(A){return Bc(0,2750).pipe(ca(function(){p.incSeqIfNeeded(A.env),A.sendPacket("Ping",{ms:U.fromNumber(Date.now(),!0),seq:p.seq})}))}))}).forEach(function(_,A){var k=p.loginSocketSubs[A].keepAlive;k!==void 0&&k.unsubscribe(),p.loginSocketSubs[A].keepAlive=_.subscribe({error:function(){}})})}},{key:"initKeepAliveReconnector",value:function(){var p=this;this.lastLoginSockets.map(function(_){return _.pipe(Cc(function(A){var k,j=!1,B=A.userJoin$.pipe(ca(function(){j=!0})),z=A.input$.pipe(ca(function(Vt){Li[Vt.uri].slice(0,-3)!=="Ping"&&(j=!1)}));return Xb(Bc(15e3,1e4).pipe(Pt(A.receivedPacket),ca(function(Vt){Vt=ra(Vt,2),Vt=ra(Vt[1],2)[1],k!==Vt||j||A.forceReconnect(),k=Vt})),B,z)}))}).forEach(function(_,A){var k=p.loginSocketSubs[A].keepAliveReconnector;k!==void 0&&k.unsubscribe(),p.loginSocketSubs[A].keepAliveReconnector=_.subscribe({error:function(){}})})}},{key:"initLoginReceiver",value:function(){var p=this;this.lastLoginSockets.map(function(_){return _.pipe(Cc(function(A){return Xb(gb(A,"reconnect").pipe(ca(p.onSocketReconnect(A))),A.fromReceived("Message").pipe(ca(p.onMessage(A))),A.fromReceived("GroupEnterNotice").pipe(ca(p.onGroupEnterNotice())),A.fromReceived("GroupLeaveNotice").pipe(ca(p.onGroupLeaveNotice())),A.fromReceived("GroupCountNotice").pipe(ca(p.onGroupCountNotice())),A.fromReceived("GroupAttributeAlt").pipe(ca(p.onGroupAttributeAlt())),A.fromReceived("UserJoinNotice").pipe(ca(p.onUserNotice(S.PeerOnlineState.ONLINE))),A.fromReceived("UserQuitNotice").pipe(ca(p.onUserNotice(S.PeerOnlineState.OFFLINE))),A.fromReceived("UserWaitNotice").pipe(ca(p.onUserNotice(S.PeerOnlineState.UNREACHABLE)))).pipe(qf(void 0))}))}).forEach(function(_,A){p.loginSocketSubs[A].receivers.push(_.subscribe({error:function(){}}))})}},{key:"requestSocketLogin",value:function(p,_,A){var k=this;return im(ad(function(){k.userJoinOptions=new is(_),p.sendPacket("UserJoin",{account:k.context.uid,instance:k.instanceId,opt:k.userJoinOptions.toLong(),seq:A,ticket:p.ticket})}),p.fromReceived("UserResp").pipe(aa(function(j){return A.eq(j.seq)}),ca(function(j){if((j=j.code)!==0)throw k.clearSockets(),k.logError("Connected to gateway success but the Rtm server rejected login"),new da(["Login failure. The response code from the RTM service is %d",j],jg);k.log("ENV_%d logged in",p.env)}),qf(p),hb(15e3))).pipe(wb(function(j){return j!==void 0}),Ga(function(j){return j instanceof pb&&k.warn("Login response timeout, rejoin: %s",_),Z(j)}))}},{key:"getSocketLoginObservables",value:function(p,_){var A=this;return p.map(function(k){return k.pipe(ca(function(j){j.listenerCount("socketUserDrop")===0&&j.on("socketUserDrop",function(B){return A.onUserDrop(B,j)})}),Cc(function(j,B){return A.incSeqIfNeeded(j.env),A.requestSocketLogin(j,B!==0,B===0?_:A.seq)}),pe())})}},{key:"incSeqIfNeeded",value:function(p){if(![0,1].includes(p))throw new Fa({INVALID_ENV:"The env argument is not 0 or 1"});this.seqSentStatuses[p]&&(this.seq=this.seq.add(1),this.seqSentStatuses=[!1,!1]),this.seqSentStatuses[p]=!0}},{key:"incGetSeq",value:function(){return this.seq=this.seq.add(1),this.seqSentStatuses=[!0,!0],this.seq}},{key:"getLoginSockets",value:function(){for(var p=this.curLoginSockets,_=-1,A=p==null?0:p.length,k=0,j=[];++_<A;){var B=p[_];B&&(j[k++]=B)}return j}},{key:"emitMessage",value:function(p,_){var A=p.options,k=p.payload,j=p.src,B=p.dst,z=p.instance,Vt=p.dialogue,_e=p.sequence,_n=p.ms,_o=p.MiscMap;this.dialogueSequenceLru.set(Vt.toString(),_e),z="".concat(z,"-").concat(Vt,"#").concat(_e),this.msgDedupLru.has(z)?this.warn("Env_%d: Messages out-of-order or not start with 1: %s",_,z):(this.msgDedupLru.set(z,void 0),_=new ae(A),this.lastLoginSockets.forEach(function(){var _c=J(w.mark(function _d(_h){var _p;return w.wrap(function(_f){for(;;)switch(_f.prev=_f.next){case 0:return _f.next=2,_h.pipe(Ka(1)).toPromise();case 2:_p=_f.sent,o.sendMessageAck(p,_p);case 4:case"end":return _f.stop()}},_d)}));return function(_d){return _c.apply(this,arguments)}}()),A=_.isZlibCompressed(),_.isInvitation()?(B=pa(A?nl(Xm(k,Uint8Array.of(0,0,0,0))):k),B=JSON.parse(B),this.log("The received invitation body is %o",B),this.emit("invitationMessage",{body:B,type:_.getInvitationType(),peerId:j,serverReceivedTs:_n.toNumber()})):_.isTextMessage()?(_o=_.isPeerTextMessage(),k=pa(A?nl(Xm(k,Uint8Array.of(0,0,0,0))):k),this.info("Received a %s %s text message from %s to %s, %s",A?" compressed":"",_o?"peer":"channel",oa(j),oa(B),z),_o?(j={text:k,peerId:j,properties:{serverReceivedTs:_n.toNumber(),isOfflineMessage:_.isFromCache()}},this.emit("peerTextMessage",j)):this.emit("channelTextMessage",{channelId:B,memberId:j,text:k,properties:{serverReceivedTs:_n.toNumber(),isOfflineMessage:!1}})):_.isRawMessage()?(Vt=_.isRawPeerMessage(),_o=(_o=_o.description)===void 0?"":pa(_o),k=A?nl(k):k,this.info("Received a %s %s raw message from %s to %s, %s",A?" compressed":"",Vt?"peer":"channel",oa(j),oa(B),z),Vt?(j={desc:_o,raw:k,peerId:j,properties:{serverReceivedTs:_n.toNumber(),isOfflineMessage:_.isFromCache()}},this.emit("peerRawMessage",j)):this.emit("channelRawMessage",{desc:_o,raw:k,channelId:B,memberId:j,properties:{serverReceivedTs:_n.toNumber(),isOfflineMessage:!1}})):(_.isImageMessage()||_.isFileMessage())&&(k=_.isPeerMessage(),this.info("Received a %s media message from %s to %s, %s",k?"peer":"channel",oa(j),oa(B),z),k?this.emit("peerMediaMessage",{messageType:_.isImageMessage()?"IMAGE":"FILE",details:_o,peerId:j,properties:{serverReceivedTs:_n.toNumber(),isOfflineMessage:_.isFromCache()}}):this.emit("channelMediaMessage",{messageType:_.isImageMessage()?"IMAGE":"FILE",details:_o,memberId:j,channelId:B,properties:{serverReceivedTs:_n.toNumber(),isOfflineMessage:_.isFromCache()}})))}},{key:"onSocketReconnect",value:function(p){var _=this;return function(){var A=[0,1].filter(function(k){return k!==p.env})[0];(A=_.connection.curOpenSockets[A])&&!A.loggedIn&&_.emit("connectionLost")}}},{key:"onUserDrop",value:function(p,_){var A;p=p.code,eb("KickedOff",{code:0,elapse:fb(this.startTime),linkId:parseInt(_.name.split("-")[1],10),lts:U.fromNumber(Date.now()),server:_.address,serverCode:p,sid:Xa(this.instanceId),userId:this.context.uid},(A=this.context.config.enableCloudProxy)!==null&&A!==void 0&&A),p===10006||p===10001?this.warn("Login too often and kicked off, reconnect and login"):p===10009?(this.warn("The instance ID conflicts, reconnecting"),this.instanceId=Bg(),this.context.sid=Xa(this.instanceId),this.emit("instanceChanged",this.instanceId)):[11,14,15,16].includes(p)&&(this.emit("userDrop",p),this.clearSockets())}},{key:"clearSockets",value:function(){var p=this,_=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,A=1<arguments.length&&arguments[1]!==void 0&&arguments[1];[0,1].forEach(function(k){p.cleanLoginSubs(k,A),p.connection.closeSocket(k,_)})}},{key:"onMessage",value:function(p){var _=this;return function(A){var k=A.dialogue,j=A.instance,B=A.sequence,z=A.options;if(A.src===_.context.uid)_.log("The message is from the local account, ignored");else{var Vt=k.toString(),_e=_.dialPendingMsgSubjectMap.get(Vt);if(k="".concat(j,"-").concat(k,"#").concat(B),_e)_e.next(A),_.log("Env_%d: The dialogue has pending messages, next: %s",p.env,k);else{var _n=_.dialogueSequenceLru.get(Vt);if(_e=!_n&&B.eq(1),j=_n!==void 0&&B.sub(_n).eq(1),_e||j)_.emitMessage(A,p.env);else{if(_n){if(B.lte(_n))return;_.log("Env_%d: The message pended, the sequence is not continuous with the last: %s",p.env,k)}else _.log("Env_%d: The message pended, the first sequence is not equal to 1: %s",p.env,k);B=new Pa,_.dialPendingMsgSubjectMap.set(Vt,B);var _o=B.pipe(Qs(Pk),xg(function(_c,_d){return[].concat(G(_c),[_d])},[]),ba(function(_c){return G(_c).sort(function(_d,_h){return _d=_d.sequence,_h=_h.sequence,_d.eq(_h)?0:_d.gt(_h)?1:-1})}),sm(1));z=!(z=new ae(z)).isFromCache()&&!z.isBufferedMessage(),_o.pipe(ob(Bc(z?750:1500)),aa(function(_c){if(2>_c.length)return!1;for(var _d=_n===void 0?U.fromNumber(1,!0):_n.add(1),_h=0;_h<_c.length;_d=_d.add(1),_h++)if(!_c[_h].sequence.eq(_d))return!1;return!0}),wg(function(){_.dialPendingMsgSubjectMap.delete(Vt)})).subscribe(function(_c){_c.forEach(function(_d){_.emitMessage(_d,p.env),_.log("Env_%d: The message queue has fully ordered, emitting: %s",p.env,"".concat(_d.instance,"-").concat(_d.dialogue,"#").concat(_d.sequence))})},function(_c){_c instanceof vg&&_o.pipe(Ka(1)).subscribe(function(_d){return _d.forEach(function(_h){_.log("Env_%d: The message pending queue expired, emitting: %s",p.env,"".concat(_h.instance,"-").concat(_h.dialogue,"#").concat(_h.sequence)),_.emitMessage(_h,p.env)})})}),B.next(A)}}}}}},{key:"onGroupEnterNotice",value:function(){var p=this;return function(_){p.emit("memberNotice",{channelId:_.group,seq:_.seq,instance:_.instance,memberId:_.user,type:"MemberJoined",size:_.size})}}},{key:"onGroupLeaveNotice",value:function(){var p=this;return function(_){p.emit("memberNotice",{channelId:_.group,seq:_.seq,instance:_.instance,memberId:_.user,type:"MemberLeft",size:_.size})}}},{key:"onGroupCountNotice",value:function(){var p=this;return function(_){p.emit("memberNotice",{channelId:_.group,seq:_.seq,instance:_.instance,type:"MemberCountUpdated",size:_.size})}}},{key:"onGroupAttributeAlt",value:function(){var p=this;return function(_){var A=_.group;_=ff(_,kD),p.emit("channelAttributesUpdated",ua({channelId:A},_))}}},{key:"onUserNotice",value:function(p){var _=this;return function(A){_.emit("peerOnlineStatusChanged",{peerId:A.user,instance:A.instance,seq:A.seq,state:p})}}}],[{key:"sendMessageAck",value:function(p,_){var A=new ae(p.options);(A.isInvitation()||A.isPeerMessage())&&_.sendPacket("Ack",{code:0,dialogue:p.dialogue,instance:p.instance,sequence:p.sequence})}}]),o}(tb());m(ls,"genTimeoutError",function(s,o){return bb(void 0).pipe(cd(o===void 0?1e4:o),ba(function(){throw new db(["Request timed out after %ds",o===void 0?1e4:o],s)}))});var ms,ol,pl=0,ql=0;Ud.v1=function(s,o,l){l=o&&l||0;var p=o||[],_=(s=s||{}).node||ms,A=s.clockseq!==void 0?s.clockseq:ol;if(_==null||A==null){var k=Jq();_==null&&(_=ms=[1|k[0],k[1],k[2],k[3],k[4],k[5]]),A==null&&(A=ol=16383&(k[6]<<8|k[7]))}k=s.msecs!==void 0?s.msecs:new Date().getTime();var j=s.nsecs!==void 0?s.nsecs:ql+1,B=k-pl+(j-ql)/1e4;if(0>B&&s.clockseq===void 0&&(A=A+1&16383),(0>B||k>pl)&&s.nsecs===void 0&&(j=0),1e4<=j)throw Error("uuid.v1(): Can't create more than 10M uuids/sec");for(pl=k,ql=j,ol=A,s=(1e4*(268435455&(k+=122192928e5))+j)%4294967296,p[l++]=s>>>24&255,p[l++]=s>>>16&255,p[l++]=s>>>8&255,p[l++]=255&s,s=k/4294967296*1e4&268435455,p[l++]=s>>>8&255,p[l++]=255&s,p[l++]=s>>>24&15|16,p[l++]=s>>>16&255,p[l++]=A>>>8|128,p[l++]=255&A,A=0;6>A;++A)p[l+A]=_[A];return o||Kq(p)},Ud.v4=Ud;var rl=Ph(),vd,bf=S.LocalInvitationFailureReason,Ba=S.LocalInvitationState,lD=(vd=function(s){function o(p,_,A){W(this,o);var k=l.call(this,A,"RtmLocalInvitation",!0);return m(n(k),"state",Ba.IDLE),m(n(k),"localInvitationEnd$",Ca(gb(n(k),"LocalInvitationAccepted"),gb(n(k),"LocalInvitationRefused"),gb(n(k),"LocalInvitationFailure"),gb(n(k),"LocalInvitationCanceled")).pipe(Ka(1))),m(n(k),"callId",Ud.v4()),m(n(k),"_content",""),m(n(k),"_channelId",""),m(n(k),"_response",""),m(n(k),"calleeId",void 0),m(n(k),"logger",void 0),m(n(k),"getSession",void 0),k.calleeId=p,k.getSession=_,k.logger=A,k}la(o,s);var l=ma(o);return Ha(o,[{key:"channelId",get:function(){return this._channelId},set:function(p){this.state!==Ba.IDLE?this.info("set channelId only allow before invitation sent to remote"):(this.log("set channelId for %s",this.callId),this._channelId=p)}},{key:"content",get:function(){return this._content},set:function(p){this.log("set content for %s",this.callId),this._content=p}},{key:"response",get:function(){return this._response},set:function(p){throw new I('Cannot set the "response" of the LocalInvitation instance.',xc)}},{key:"send",value:function(){var p,_=this;if(this.state===Ba.SENT_TO_REMOTE||this.state===Ba.RECEIVED_BY_REMOTE)throw new K("The local invitation send failure. The call invitation has already been sent.",gA);if(this.isLocalInvitationEnd())throw new K("The local invitation send failure. The call invitation has ended.",Ih);if(0<this._channelId.length&&!za(this._channelId))throw new I("Illegal invitation channel ID",xc);if(!za(this.calleeId))throw new I("Illegal invitation callee user ID",xc);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',xc);this.state=Ba.SENT_TO_REMOTE,ad(J(w.mark(function A(){var k,j,B;return w.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:return z.next=2,_.getSession().sendInvitationMessage({peerId:_.calleeId,callId:_.callId,extra:_._content,type:"CallInvite",channelId:_._channelId});case 2:if(k=z.sent,j=k.hasPeerReceived,B=k.hasReSent,!_.isLocalInvitationEnd()){z.next=7;break}throw new db("send invitation timeout");case 7:if(_.log("The local invitation has sent to the callee"),j||B){z.next=11;break}throw p=new rl({PEER_NOT_ONLINE:"The peer of the invitation is not online"});case 11:if(j){z.next=14;break}throw p=new rl({RESENT_AND_OFFLINE:"Resent and the peer of the invitation is not online"});case 14:case"end":return z.stop()}},A)}))).pipe(oe(function(A){return A.pipe(ca(function(k){if(!(k instanceof rl))throw k}),cd(2e3))}),hb(3e4),Ga(function(A){return Sa(A)&&_.warn("local invitation ack timed out"),Z(A)}),ob(this.localInvitationEnd$)).subscribe({next:function(){_.state===Ba.RECEIVED_BY_REMOTE?_.log('The local invitation state is already "RECEIVED_BY_REMOTE", skipped emitting "LocalInvitationReceivedByPeer"'):_.state!==Ba.SENT_TO_REMOTE?_.log("The invitation has ended, skipped emitting the %s event","LocalInvitationReceivedByPeer"):(_.info("The peer received the local invitation %s.",_.callId),_.state=Ba.RECEIVED_BY_REMOTE,_.emit("LocalInvitationReceivedByPeer"),_.localInvitationEnd$.pipe(hb(6e4),Ga(function(A){return Sa(A)&&_.warn("local invitation expired"),Z(A)})).subscribe({error:function(){_.state=Ba.FAILURE,_.emit("LocalInvitationFailure",bf.INVITATION_EXPIRE)}}))},error:function(A){_.isLocalInvitationEnd()?_.log("The invitation has ended, skipped emitting the %s event","LocalInvitationFailure"):(_.state=Ba.FAILURE,Sa(A)&&p?p.code==="PEER_NOT_ONLINE"?_.emit("LocalInvitationFailure",bf.PEER_OFFLINE):p.code==="RESENT_AND_OFFLINE"&&_.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):Sa(A)?_.emit("LocalInvitationFailure",bf.PEER_NO_RESPONSE):A.name==="RtmInvalidStatusError"?_.emit("LocalInvitationFailure",bf.NOT_LOGGEDIN):_.emit("LocalInvitationFailure",bf.UNKNOWN))}})}},{key:"cancel",value:function(){if(this.isLocalInvitationEnd())throw new K("The local invitation cancel failure",Ih);if(this.state===Ba.IDLE)throw new K("The local invitation has not been sent",fA);if(8192<Ig(this._content))throw new I('The length of the "content" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',xc);this.getSession().sendInvitationMessage({callId:this.callId,peerId:this.calleeId,type:"CallCancel",channelId:this._channelId,extra:this._content}),this.state=Ba.CANCELED,this.emit("LocalInvitationCanceled")}},{key:"onAcceptReceived",value:function(p){if(this.isLocalInvitationEnd()&&this.state!==Ba.ACCEPTED_BY_REMOTE)this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationAccepted");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote accept it?");this.getSession().sendInvitationMessage({callId:this.callId,isAcceptAck:!0,type:"CallAccept",peerId:this.calleeId,channelId:this.channelId}),this.state===Ba.ACCEPTED_BY_REMOTE?this.log("already in ACCEPTED_BY_REMOTE state, ignore emit ACCEPTED_BY_REMOTE"):(this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationAccepted before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this.state=Ba.ACCEPTED_BY_REMOTE,this._response=p,this.emit("LocalInvitationAccepted",p))}}},{key:"onRefuseReceived",value:function(p){if(this.isLocalInvitationEnd())this.log("The invitation has ended, skipped emitting the %s event","LocalInvitationRefused");else{if(this.state===Ba.IDLE)throw new K("the local have not sent the invitation, how can remote refuse it?");this.state===Ba.SENT_TO_REMOTE&&(this.log("receive LocalInvitationRefused before remote response to the invitation"),this.state=Ba.RECEIVED_BY_REMOTE,this.emit("LocalInvitationReceivedByPeer")),this._response=p,this.state=Ba.REFUSED_BY_REMOTE,this.emit("LocalInvitationRefused",p)}}},{key:"isLocalInvitationEnd",value:function(){return[Ba.CANCELED,Ba.FAILURE,Ba.ACCEPTED_BY_REMOTE,Ba.REFUSED_BY_REMOTE].includes(this.state)}}]),o}(tb()),fa(vd.prototype,"send",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"send"),vd.prototype),fa(vd.prototype,"cancel",[Nb],Object.getOwnPropertyDescriptor(vd.prototype,"cancel"),vd.prototype),vd),Rh=S.RemoteInvitationFailureReason,kb=S.RemoteInvitationState,mD=function(s){function o(p){var _=p.invitationChannel,A=p.extraContent,k=p.callId,j=p.callerId,B=p.logger;p=p.getSession,W(this,o);var z=l.call(this,B,"RtmRemoteInvitation",!0);return m(n(z),"state",kb.INVITATION_RECEIVED),m(n(z),"remoteInvitationEnd$",Ca(gb(n(z),"RemoteInvitationCanceled"),gb(n(z),"RemoteInvitationRefused"),gb(n(z),"RemoteInvitationAccepted"),gb(n(z),"RemoteInvitationFailure")).pipe(Ka(1))),m(n(z),"callerId",void 0),m(n(z),"callId",void 0),m(n(z),"_getSession",void 0),m(n(z),"logger",void 0),m(n(z),"_content",void 0),m(n(z),"_channelId",void 0),m(n(z),"_response",""),z._channelId=_,z._content=A,z.callId=k,z.callerId=j,z._getSession=p,z.logger=B,z.remoteInvitationEnd$.pipe(hb(6e4),Ga(function(Vt){return Sa(Vt)&&z.warn("Remote invitation expired"),Z(Vt)})).subscribe({error:function(){z.state=kb.FAILURE,z.emit("RemoteInvitationFailure",Rh.INVITATION_EXPIRE)}}),z}la(o,s);var l=ma(o);return Ha(o,[{key:"channelId",get:function(){return this._channelId},set:function(p){throw new I('Cannot set the "response" of the RemoteInvitation instance.',xc)}},{key:"content",get:function(){return this._content},set:function(p){throw new I('Cannot set the "content" of the RemoteInvitation instance.',xc)}},{key:"response",get:function(){return this._response},set:function(p){this._response=p}},{key:"accept",value:function(){var p,_=this;if(this.isRemoteInvitationEnd())throw new K("The local invitation has ended. Cannot accept.",Ih);if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',xc);this.state=kb.ACCEPT_SENT_TO_LOCAL,Xb(mm(1e3).pipe(cb(function(){return ad(J(w.mark(function A(){return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return k.abrupt("return",_._getSession().sendInvitationMessage({peerId:_.callerId,callId:_.callId,extra:_.response,type:"CallAccept",isAcceptAck:!1,channelId:_.channelId}));case 1:case"end":return k.stop()}},A)})))}),wb(function(A){return p=A.hasPeerReceived}),Ka(1)),gb(this,"RemoteInvitationAccepted")).pipe(hb(5e3),ob(this.remoteInvitationEnd$)).subscribe({error:function(A){if(_.logError(A),_.state=kb.FAILURE,Sa(A))switch(p){case void 0:case!0:return void _.emit("RemoteInvitationFailure",Rh.ACCEPT_FAILURE);case!1:return void _.emit("RemoteInvitationFailure",Rh.PEER_OFFLINE)}_.emit("RemoteInvitationFailure",Rh.UNKNOWN)}})}},{key:"refuse",value:function(){if(this.state===kb.ACCEPT_SENT_TO_LOCAL)throw new K("The remote invitation is accepting. Cannot do the operation.",Qq);if(this.isRemoteInvitationEnd())throw new K("The invitation is end. Cannot refuse",Ih);if(8192<Ig(this._response))throw new I('The length of the "response" overflows. The number of bytes representing content must not exceed 8 × 1024 if encoded in UTF-8.',xc);this._getSession().sendInvitationMessage({peerId:this.callerId,callId:this.callId,extra:this.response,type:"CallReject",channelId:this.channelId}),this.state=kb.REFUSED,this.emit("RemoteInvitationRefused")}},{key:"onCancelReceived",value:function(p){this.isRemoteInvitationEnd()?this.log("The invitation has ended, skipped emitting the %s event","RemoteInvitationCanceled"):(this.state===kb.ACCEPT_SENT_TO_LOCAL&&this.log("caller canceled before receive accept"),this._content=p,this.state=kb.CANCELED,this.emit("RemoteInvitationCanceled",p))}},{key:"onAcceptAckReceived",value:function(){this.state!==kb.ACCEPT_SENT_TO_LOCAL?this.log("The invitation has ended, skipped emitting the %s event","ori:".concat(this.state,", to: RemoteInvitationAccepted")):(this.state=kb.ACCEPTED,this.emit("RemoteInvitationAccepted"))}},{key:"isRemoteInvitationEnd",value:function(){return[kb.ACCEPTED,kb.REFUSED,kb.CANCELED,kb.FAILURE].includes(this.state)}}]),o}(tb()),nD=function(s){function o(p,_){W(this,o);var A=l.call(this,_,"InvitationManager");return m(n(A),"getSession",void 0),m(n(A),"invitationDispatcher",new ea.EventEmitter),m(n(A),"outgoingLocalInvitations",new Map),m(n(A),"receivedRemoteInvitations",new tc(void 0,{maxlen:1e4})),m(n(A),"logger",void 0),A.getSession=cn(p),A.logger=_,A.invitationDispatcher.on("remoteInvitationToManager",function(k){var j=k.callId,B=k.extra,z=k.callerId;k=k.channelId,A.receivedRemoteInvitations.has(j)||((B=new mD({callerId:z,callId:j,getSession:A.getSession,logger:_,extraContent:B,invitationChannel:k})).remoteInvitationEnd$.subscribe(function(){A.receivedRemoteInvitations.delete(j)}),A.receivedRemoteInvitations.set(j,B),A.emit("remoteInvitationInstance",B))}),A.invitationDispatcher.on("acceptAckToRemoteInvitation",function(k){(k=A.receivedRemoteInvitations.get(k.callId))&&k.onAcceptAckReceived()}),A.invitationDispatcher.on("cancelToRemoteInvitation",function(k){var j=k.extra;(k=A.receivedRemoteInvitations.get(k.callId))&&k.onCancelReceived(j)}),A.invitationDispatcher.on("acceptToLocalInvitation",function(k){var j=k.extra;(k=A.outgoingLocalInvitations.get(k.callId))&&k.onAcceptReceived(j)}),A.invitationDispatcher.on("refuseToLocalInvitation",function(k){var j=k.extra;(k=A.outgoingLocalInvitations.get(k.callId))&&k.onRefuseReceived(j)}),A}la(o,s);var l=ma(o);return Ha(o,[{key:"invitationMessageHandler",value:function(p){var _=p.body,A=_.callId,k=_.extra;k=k===void 0?"":k;var j=_.type,B=(_=_.channel)===void 0?"":_,z=p.type;switch(_=p.peerId,p=p.serverReceivedTs,z){case"CallAccept":j==="ack"?this.invitationDispatcher.emit("acceptAckToRemoteInvitation",{callId:A}):j==="request"&&this.invitationDispatcher.emit("acceptToLocalInvitation",{callId:A,extra:k});break;case"CallInvite":this.invitationDispatcher.emit("remoteInvitationToManager",{callId:A,callerId:_,extra:k,channelId:B});break;case"CallCancel":if(A==="0"){A="".concat("AgoraRTMLegacyEndcallCompatibleMessagePrefix","_").concat(B,"_").concat(k),this.getSession().emit("peerTextMessage",{peerId:_,properties:{serverReceivedTs:p,isOfflineMessage:!1},text:A});break}this.invitationDispatcher.emit("cancelToRemoteInvitation",{callId:A,extra:k});break;case"CallReject":this.invitationDispatcher.emit("refuseToLocalInvitation",{callId:A,extra:k});break;default:throw Im("invitationType",z)}}},{key:"genLocalInvitation",value:function(p){var _=this,A=new lD(p,this.getSession,this.logger);return A.localInvitationEnd$.subscribe(function(){_.outgoingLocalInvitations.delete(A.callId)}),this.outgoingLocalInvitations.set(A.callId,A),A}}]),o}(tb()),oD=function(s,o,l){var p=!0,_=!0;if(typeof s!="function")throw new TypeError("Expected a function");return lb(l)&&(p="leading"in l?!!l.leading:p,_="trailing"in l?!!l.trailing:_),qC(s,o,{leading:p,maxWait:o,trailing:_})},ub,cf;(function(s){s[s.JOINED=0]="JOINED",s[s.LEFT=1]="LEFT"})(cf||(cf={}));var ns=S.ConnectionState,pD=(ub=function(s){function o(p,_,A,k){W(this,o);var j=l.call(this,k,"RtmChannel",!0);return m(n(j),"onMemberCountUpdated",oD(function(B){B!==j.memberCount&&(j.memberCount=B,j.emit("MemberCountUpdated",B))},1e3)),m(n(j),"getSession",void 0),m(n(j),"memberCount",0),m(n(j),"memberJoinedLru",new tc(void 0,{maxlen:1e4})),m(n(j),"memberLeftLru",new tc(void 0,{maxlen:1e4})),m(n(j),"memberJoinStateLru",new tc(void 0,{maxlen:1e4})),m(n(j),"attributesSeqLru",new tc(void 0,{maxlen:1e4})),m(n(j),"channelId",void 0),m(n(j),"client",void 0),m(n(j),"onAttributesUpdated",function(B){var z=B.channelId,Vt=B.attributeMaps,_e=B.seq;B=B.instance.toString();var _n=j.attributesSeqLru.get(B);if((!_n||_e.greaterThan(_n))&&(j.attributesSeqLru.set(B,_e),z===j.channelId)){for(z={},_e=0;_e<Vt.length;_e++){var _o=Vt[_e];B=_o.key,_n=_o.ms;var _c=_o.value;if(_o=_o.origin,typeof B!="string"||!U.isLong(_n)||typeof _c!="string"||!za(_o))break;z[B]={value:_c,lastUpdateUserId:_o,lastUpdateTs:_n.toNumber()}}j.emit("AttributesUpdated",z)}}),m(n(j),"onChannelTextMessage",function(B){var z=B.memberId,Vt=B.text,_e=B.properties;B.channelId===j.channelId&&j.emit("ChannelMessage",{text:Vt,messageType:S.MessageType.TEXT},z,_e)}),m(n(j),"onChannelMediaMessage",function(B){var z=B.memberId,Vt=B.properties,_e=B.details,_n=B.messageType;B.channelId===j.channelId&&(_n==="FILE"?j.emit("ChannelMessage",{messageType:S.MessageType.FILE,size:parseInt(pa(_e.media_size),10),description:pa(_e.media_description),fileName:pa(_e.media_filename),mediaId:pa(_e.media_id),thumbnail:new Blob([_e.media_thumbnail])},z,Vt):_n==="IMAGE"&&j.emit("ChannelMessage",{messageType:S.MessageType.IMAGE,size:parseInt(pa(_e.media_size),10),description:pa(_e.media_description),fileName:pa(_e.media_filename),mediaId:pa(_e.media_id),thumbnail:new Blob([_e.media_thumbnail]),height:parseInt(pa(_e.media_height),10),width:parseInt(pa(_e.media_width),10),thumbnailHeight:parseInt(pa(_e.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(_e.media_thumbnailwidth),10)},z,Vt))}),m(n(j),"onChannelRawMessage",function(B){var z=B.desc,Vt=B.raw,_e=B.memberId,_n=B.properties;B.channelId===j.channelId&&j.emit("ChannelMessage",{messageType:S.MessageType.RAW,rawMessage:Vt,description:z},_e,_n)}),m(n(j),"onMemberNotice",function(B){var z=B.memberId,Vt=B.type,_e=B.size;if(B.channelId===j.channelId){var _n=B.instance.toString();B=B.seq.toString();var _o={MemberLeft:j.memberLeftLru,MemberJoined:j.memberJoinedLru,MemberCountUpdated:void 0}[Vt];if(_o){if(_o.has(_n+B))return void j.log("received duplicated %s notice (seq: %s), channel '%s', member '%s'",Vt,B,oa(j.channelId),oa(z||""));if(_o.set(_n+B,void 0),typeof z!="string")return;if(z!==j.getSession().context.uid&&((_n=j.memberJoinStateLru.get(z))===cf.JOINED&&Vt==="MemberJoined"||_n===cf.LEFT&&Vt==="MemberLeft"))return void j.log("received duplicated %s state (seq: %s), channel '%s', member '%s'",Vt,B,oa(j.channelId),oa(z||""));j.memberJoinStateLru.set(z,Vt==="MemberJoined"?cf.JOINED:cf.LEFT)}j.info("Channel %s - %s, memberId: %s",Vt,oa(j.channelId),Vt==="MemberCountUpdated"?"[unknown]":oa(z||"")),_n=z===j.getSession().context.uid,Vt==="MemberLeft"&&za(z)||Vt==="MemberJoined"&&za(z)?(_n||j.emit(Vt,z),j.onMemberCountUpdated(_e)):Vt==="MemberCountUpdated"&&typeof _e=="number"&&j.onMemberCountUpdated(_e)}}),j.getSession=cn(_),j.channelId=p,j.client=A,j.info("A channel created, id %s",oa(p)),j}la(o,s);var l=ma(o);return Ha(o,[{key:"join",value:function(){var p=J(w.mark(function _(){var A,k,j,B,z,Vt,_e;return w.wrap(function(_n){for(;;)switch(_n.prev=_n.next){case 0:if(za(this.channelId)){_n.next=2;break}throw new I(["The %s in the arguments is invalid","channelId"],hA);case 2:_n.prev=2,A=this.getSession(),_n.next=9;break;case 6:throw _n.prev=6,_n.t0=_n.catch(2),new K("The client is not logged in. Cannot do the operation",Vq);case 9:if(!A.joinedChannels.has(this)){_n.next=12;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:A.context.uid,elapse:fb(A.startTime),errCode:Uq,sid:Xa(A.instanceId)},(k=this.client.context.config.enableCloudProxy)!==null&&k!==void 0&&k),new K("The channel has joined. Cannot rejoin",Uq);case 12:if(_n.prev=12,this.log("Joining the channel %s",oa(this.channelId)),!this.hasOtherChannelJoined()){_n.next=17;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:A.context.uid,elapse:fb(A.startTime),errCode:Wq,sid:Xa(A.instanceId)},(z=this.client.context.config.enableCloudProxy)!==null&&z!==void 0&&z),new K("A channel of the same channel ID has already joined. Cannot rejoin",Wq);case 17:if(A.joinedChannels.size!==20){_n.next=20;break}throw eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:A.context.uid,elapse:fb(A.startTime),errCode:Tq,sid:Xa(A.instanceId)},(Vt=this.client.context.config.enableCloudProxy)!==null&&Vt!==void 0&&Vt),new ib("The joined channels has exceeded the limit of 20",Tq);case 20:return eb("ChnJoin",{cname:this.channelId,lts:U.fromNumber(Date.now()),userId:A.context.uid,elapse:fb(A.startTime),errCode:0,sid:Xa(A.instanceId)},(j=this.client.context.config.enableCloudProxy)!==null&&j!==void 0&&j),_n.next=23,A.requestChannelJoin(this,this.channelId);case 23:eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(A.startTime),errCode:0,sid:Xa(A.instanceId),serverErrCode:0,userId:A.context.uid},(B=this.client.context.config.enableCloudProxy)!==null&&B!==void 0&&B),this.info("The channel %s joined successfully",oa(this.channelId)),A.on("channelTextMessage",this.onChannelTextMessage),A.on("channelRawMessage",this.onChannelRawMessage),A.on("channelMediaMessage",this.onChannelMediaMessage),A.on("memberNotice",this.onMemberNotice),A.on("channelAttributesUpdated",this.onAttributesUpdated),_n.next=41;break;case 32:if(_n.prev=32,_n.t1=_n.catch(12),this.logError(_n.t1),!sa(_n.t1)){_n.next=37;break}throw _n.t1;case 37:if(!Sa(_n.t1)){_n.next=40;break}throw eb("ChnJoinRes",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(A.startTime),errCode:Sq,sid:Xa(A.instanceId),serverErrCode:0,userId:A.context.uid},(_e=this.client.context.config.enableCloudProxy)!==null&&_e!==void 0&&_e),new db(["Join channel %s timed out",oa(this.channelId)],Sq);case 40:throw new Wc(["The channel %s join failure",oa(this.channelId)],{code:Rq,originalError:_n.t1});case 41:case"end":return _n.stop()}},_,this,[[2,6],[12,32]])}));return function(){return p.apply(this,arguments)}}()},{key:"leave",value:function(){var p=J(w.mark(function _(){var A,k,j,B;return w.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:z.prev=0,k=this.getSession(),z.next=7;break;case 4:throw z.prev=4,z.t0=z.catch(0),new K("The client is not logged in. Cannot do the operation",jA);case 7:if(k.joinedChannels.has(this)){z.next=9;break}throw new K("The channel does not join. Cannot do the operation",iA);case 9:z.prev=9,k.requestChannelLeave(this,this.channelId),this.memberLeftLru.empty(),this.memberJoinedLru.empty(),this.attributesSeqLru.empty(),this.memberJoinStateLru.empty(),this.memberCount=0,k.removeListener("channelTextMessage",this.onChannelTextMessage),k.removeListener("channelRawMessage",this.onChannelRawMessage),k.removeListener("channelMediaMessage",this.onChannelMediaMessage),k.removeListener("memberNotice",this.onMemberNotice),k.removeListener("channelAttributesUpdated",this.onAttributesUpdated),z.next=32;break;case 23:if(z.prev=23,z.t1=z.catch(9),this.logError(z.t1),!sa(z.t1)){z.next=30;break}throw z.t1.code===void 0&&(z.t1.code=Yq),eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(k.startTime),errCode:Yq,sid:Xa(k.instanceId),userId:k.context.uid},(B=this.client.context.config.enableCloudProxy)!==null&&B!==void 0&&B),z.t1;case 30:throw eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(k.startTime),errCode:Xq,sid:Xa(k.instanceId),userId:k.context.uid},(j=this.client.context.config.enableCloudProxy)!==null&&j!==void 0&&j),new Wc("The channel leave failure",{code:Xq,originalError:z.t1});case 32:eb("ChnLeave",{cname:this.channelId,lts:U.fromNumber(Date.now()),elapse:fb(k.startTime),errCode:0,sid:Xa(k.instanceId),userId:k.context.uid},(A=this.client.context.config.enableCloudProxy)!==null&&A!==void 0&&A);case 33:case"end":return z.stop()}},_,this,[[0,4],[9,23]])}));return function(){return p.apply(this,arguments)}}()},{key:"sendMessage",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt,_e=this,_n=arguments;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:k=1<_n.length&&_n[1]!==void 0?_n[1]:{},j=k.enableHistoricalMessaging,B=j!==void 0&&j,Tm(A,Hh),_o.prev=2,z=this.getSession(),_o.next=9;break;case 6:throw _o.prev=6,_o.t0=_o.catch(2),new K("The client is not logged in. Cannot do the operation",ig);case 9:if(z.joinedChannels.has(this)){_o.next=11;break}throw new K("The channel does not join. Cannot do the operation",ig);case 11:if(this.client.connectionState!==ns.RECONNECTING){_o.next=16;break}return Vt=Date.now(),_o.next=15,new Promise(function(_c,_d){var _h=function(){var _f=J(w.mark(function e_(){var u_;return w.wrap(function(w_){for(;;)switch(w_.prev=w_.next){case 0:return u_=Date.now()-Vt,w_.prev=1,w_.next=4,Gg({message:A,peerId:_e.channelId,toPeer:!1,session:_e.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:u_,logger:_e.logger,options:{enableHistoricalMessaging:B,enableOfflineMessaging:!1}});case 4:_c(),w_.next=12;break;case 7:w_.prev=7,w_.t0=w_.catch(1),Sa(w_.t0)&&_d(new db(Yd(_e.name,"sendMessageToPeer",1e4),Yk)),sa(w_.t0)&&_d(w_.t0),_d(new da("Channel message send failure",{code:hg,originalError:w_.t0}));case 12:return w_.prev=12,clearTimeout(_p),w_.finish(12);case 15:case"end":return w_.stop()}},e_,null,[[1,7,12,15]])}));return function(){return _f.apply(this,arguments)}}();_e.client.internalEmitter.once("RECONNECTED",_h);var _p=setTimeout(function(){_e.client.internalEmitter.off("RECONNECTED",_h),_d(new db(Yd(_e.name,"sendMessageToPeer",1e4),Yk))},9e3)});case 15:return _o.abrupt("return");case 16:if(this.client.connectionState===ns.CONNECTED){_o.next=18;break}throw new K("The client is not logged in. Cannot do the operation",ig);case 18:return _o.prev=18,_o.next=21,Gg({message:A,peerId:this.channelId,toPeer:!1,session:this.getSession(),errorCodes:{NOT_LOGGED_IN:ig,TOO_OFTEN:Mq},diff:0,logger:this.logger,options:{enableHistoricalMessaging:B,enableOfflineMessaging:!1}});case 21:_o.next=31;break;case 23:if(_o.prev=23,_o.t1=_o.catch(18),!Sa(_o.t1)){_o.next=27;break}throw new db(Yd(this.name,"sendMessage",1e4),Yk);case 27:if(!sa(_o.t1)){_o.next=30;break}throw this.logError(_o.t1),_o.t1;case 30:throw new Wc("The channel message send failure",hg);case 31:case"end":return _o.stop()}},_,this,[[2,6],[18,23]])}));return function(_){return p.apply(this,arguments)}}()},{key:"getMembers",value:function(){var p=J(w.mark(function _(){var A,k,j;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:B.prev=0,B.prev=1,A=this.getSession(),B.next=8;break;case 5:throw B.prev=5,B.t0=B.catch(1),new K("The client is not logged in. Cannot do the operation",eA);case 8:if(A.joinedChannels.has(this)){B.next=10;break}throw new K("The channel does not join. Cannot do the operation",dA);case 10:return k=this.getSession().requestChannelMemberList(this.channelId),B.next=13,k.pipe(ba(function(z){return z.memberInfos.map(function(Vt){return Vt.account})})).toPromise();case 13:return j=B.sent,this.info("Channel %s - get members success, %o",oa(this.channelId),j.map(oa)),B.abrupt("return",j);case 18:if(B.prev=18,B.t1=B.catch(0),!sa(B.t1)){B.next=23;break}throw this.logError(B.t1),B.t1;case 23:throw new Wc("The channel members get failure",bA);case 24:case"end":return B.stop()}},_,this,[[0,18],[1,5]])}));return function(){return p.apply(this,arguments)}}()},{key:"hasOtherChannelJoined",value:function(){var p=this;return!this.getSession().joinedChannels.has(this)&&Array.from(this.getSession().joinedChannels).some(function(_){return _.channelId===p.channelId})}}]),o}(tb()),fa(ub.prototype,"join",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"join"),ub.prototype),fa(ub.prototype,"leave",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"leave"),ub.prototype),fa(ub.prototype,"sendMessage",[Nb],Object.getOwnPropertyDescriptor(ub.prototype,"sendMessage"),ub.prototype),fa(ub.prototype,"getMembers",[Ma],Object.getOwnPropertyDescriptor(ub.prototype,"getMembers"),ub.prototype),ub),E,Eb=S.ConnectionChangeReason,T=S.ConnectionState,os={DISCONNECTED:1,CONNECTING:2,CONNECTED:3,RECONNECTING:4,ABORTED:5},qD={LOGIN:1,LOGIN_SUCCESS:2,LOGIN_FAILURE:3,LOGIN_TIMEOUT:4,INTERRUPTED:5,LOGOUT:6,BANNED_BY_SERVER:7,REMOTE_LOGIN:8},rD=(E=function(s){function o(p,_,A,k){W(this,o);var j=l.call(this,_,"RtmClient",!0);return m(n(j),"connectionState",T.DISCONNECTED),m(n(j),"internalEmitter",new ea),m(n(j),"context",void 0),m(n(j),"attributes",{}),m(n(j),"loginPromise",void 0),m(n(j),"attributeDrafts",new Set),m(n(j),"session",void 0),m(n(j),"lastLoginTime",void 0),m(n(j),"reconnId",0),m(n(j),"channelAttributesCacheLru",new tc(void 0,{maxlen:1e4})),m(n(j),"invitationManager",void 0),m(n(j),"subscribedPeerStatusCache",{}),m(n(j),"peerStatusSeqLru",new tc(void 0,{maxlen:1e4})),m(n(j),"peerUnreachableTimers",{}),m(n(j),"mediaTaskManager",void 0),m(n(j),"setParameters",void 0),m(n(j),"updateConfig",void 0),m(n(j),"userDropHandler",function(B){if(j.connectionState!==T.ABORTED)switch(B){case 11:j.logError("Kicked off by remote session"),j.onConnectionStateChanged(T.ABORTED,Eb.REMOTE_LOGIN);break;case 14:case 15:case 16:j.logError("Server banned because of illegal ".concat({14:"User ID",15:"IP",16:"Channel Name"}[B])),j.onConnectionStateChanged(T.ABORTED,Eb.BANNED_BY_SERVER);break;default:j.logError("User kicked off for unknown code: ".concat(B)),j.onConnectionStateChanged(T.ABORTED,Eb.INTERRUPTED)}}),j.context=new ZC(p,A,_),j.mediaTaskManager=new fs(_),j.context.config=A,j.internalEmitter.setMaxListeners(512),j.setParameters=k.bind(n(j)),j.updateConfig=k.bind(n(j)),j.invitationManager=new nD(function(){return j.session},_),j.invitationManager.on("remoteInvitationInstance",function(B){j.emit("RemoteInvitationReceived",B)}),j}la(o,s);var l=ma(o);return Ha(o,[{key:"renewToken",value:function(){var p=J(w.mark(function _(A){var k,j,B,z=this;return w.wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:if(typeof A=="string"&&A.length!==0){Vt.next=2;break}throw new I("Invalid argument",rA);case 2:if(this.connectionState!==T.ABORTED){Vt.next=5;break}return Vt.next=5,new Promise(function(){});case 5:if(this.connectionState===T.CONNECTED||this.connectionState===T.RECONNECTING){Vt.next=7;break}throw new K("The client is not logged in",uA);case 7:if(this.session!==void 0){Vt.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return Vt.prev=9,k=this.context.token,this.context.token=A,Vt.next=14,this.session.connection.apClient.getApEdgeInfo$(!1).pipe(Dd(function(){return Error("No available edge address to connect")}),oe(function(_e){return _e.pipe(ca(function(_n){if(sa(_n))throw _n}),cd(2500),Ka(4))}),Ka(1),hb(2e4),Ga(function(_e){return Sa(_e)&&z.warn("renewToken timed out"),Z(_e)})).toPromise();case 14:j=Vt.sent,B=j.ticket,Vt.next=27;break;case 18:if(Vt.prev=18,Vt.t0=Vt.catch(9),this.context.token=k,Vt.t0.code!==$q&&Vt.t0.code!==ar){Vt.next=23;break}throw new Ye("Invalid token",tA);case 23:if(Vt.t0.code!==Kh){Vt.next=25;break}throw new Ye("The token expired",sA);case 25:if(!Sa(Vt.t0)){Vt.next=27;break}throw new db("Renew token timed out",qA);case 27:this.session.curLoginSockets.filter(function(_e){return _e!==void 0}).forEach(function(_e){return _e.ticket=B});case 28:case"end":return Vt.stop()}},_,this,[[9,18]])}));return function(_){return p.apply(this,arguments)}}()},{key:"queryPeersOnlineStatus",value:function(){var p=J(w.mark(function _(A){var k,j,B=this;return w.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(this.connectionState===T.CONNECTED){z.next=2;break}throw new K("The client is not logged in",pA);case 2:if(this.session!==void 0){z.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(!(!Array.isArray(A)||A.length===0||A.some(function(Vt){return!za(Vt)})||256<A.length)){z.next=6;break}throw new I("invalid arguments",er);case 6:return z.next=8,this.session.requestPeersOnlineStatus(A).toPromise();case 8:return k=z.sent,j=uc(Jk(k.userInfos,"account"),function(Vt){return!!Vt.ts}),Object.keys(j).forEach(function(Vt){if(Vt in B.subscribedPeerStatusCache&&B.subscribedPeerStatusCache[Vt]!==S.PeerOnlineState.UNREACHABLE){var _e=j[Vt]?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE;B.emit("PeersOnlineStatusChanged",m({},Vt,_e)),B.subscribedPeerStatusCache[Vt]=_e}}),z.abrupt("return",j);case 12:case"end":return z.stop()}},_,this)}));return function(_){return p.apply(this,arguments)}}()},{key:"getChannelMemberCount",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt,_e,_n,_o=this;return w.wrap(function(_c){for(;;)switch(_c.prev=_c.next){case 0:if(this.connectionState===T.CONNECTED){_c.next=2;break}throw new K("The client is not logged in",aA);case 2:if(this.session!==void 0){_c.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(A)&&A.every(function(_d){return typeof _d=="string"})&&A.length!==0){_c.next=6;break}throw new I("Invalid arguments: channelIds",Oq);case 6:if(!(32<A.length)){_c.next=8;break}throw new I("getChannelMemberCount exceed limit of 32 channelIds",$z);case 8:k=0;case 9:if(!(k<A.length)){_c.next=16;break}if(za(j=A[k])){_c.next=13;break}throw new I(["getChannelMemberCount channel id %s is invalid",j],Oq);case 13:k++,_c.next=9;break;case 16:return _c.next=18,this.session.requestGetChannelMemberCount(A).toPromise();case 18:for(B=_c.sent,z=B.groupInfos,Vt={},_e=function(_d){var _h=(_d=z[_d]).group,_p=_d.memberCount;za(_h)&&typeof _p=="number"&&(_o.session.joinedChannels.forEach(function(_f){_f.channelId===_h&&_f.onMemberCountUpdated(_p)}),Vt[_h]=_p)},_n=0;_n<z.length;_n++)_e(_n);return _c.abrupt("return",Vt);case 24:case"end":return _c.stop()}},_,this)}));return function(_){return p.apply(this,arguments)}}()},{key:"setLocalUserAttributes",value:function(){var p=J(w.mark(function _(A){var k,j;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(uf({attributes:A,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){B.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){B.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return k=this.session.requestSetLocalUserAttributes(A).toPromise(),j={attribute:A,promise:k},this.attributeDrafts.add(j),B.prev=8,B.next=11,k;case 11:this.attributes=A,B.next=19;break;case 14:if(B.prev=14,B.t0=B.catch(8),!sa(B.t0)){B.next=18;break}throw B.t0;case 18:throw new I("arguments is not valid",Ja);case 19:return B.prev=19,this.attributeDrafts.delete(j),B.finish(19);case 22:case"end":return B.stop()}},_,this,[[8,14,19,22]])}));return function(_){return p.apply(this,arguments)}}()},{key:"setChannelAttributes",value:function(){var p=J(w.mark(function _(A,k){var j,B,z,Vt,_e,_n=arguments;return w.wrap(function(_o){for(;;)switch(_o.prev=_o.next){case 0:if(j=2<_n.length&&_n[2]!==void 0?_n[2]:{},B=j.enableNotificationToChannelMembers,z=B!==void 0&&B,uf({attributes:k,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){_o.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_o.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return Vt=this.session.requestSetChannelAttributes(A,k,z).toPromise(),_o.prev=7,_o.next=10,Vt;case 10:_e=uc(k,function(_c){return new Blob([_c]).size}),this.channelAttributesCacheLru.set(A,_e),_o.next=19;break;case 14:if(_o.prev=14,_o.t0=_o.catch(7),!sa(_o.t0)){_o.next=18;break}throw _o.t0;case 18:throw new I("arguments is not valid",Ja);case 19:case"end":return _o.stop()}},_,this,[[7,14]])}));return function(_,A){return p.apply(this,arguments)}}()},{key:"addOrUpdateLocalUserAttributes",value:function(){var p=J(w.mark(function _(A){var k,j,B;return w.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(k=ua(ua({},this.attributes),A),uf({attributes:A,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),uf({attributes:k,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:16384}),this.connectionState===T.CONNECTED){z.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){z.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return j=this.session.requestAddOrUpdateLocalUserAttributes(A).toPromise(),B={attribute:k,promise:j},this.attributeDrafts.add(B),z.prev=10,z.next=13,j;case 13:this.attributes=k,z.next=21;break;case 16:if(z.prev=16,z.t0=z.catch(10),!sa(z.t0)){z.next=20;break}throw z.t0;case 20:throw new I("arguments is not valid",er);case 21:return z.prev=21,this.attributeDrafts.delete(B),z.finish(21);case 24:case"end":return z.stop()}},_,this,[[10,16,21,24]])}));return function(_){return p.apply(this,arguments)}}()},{key:"addOrUpdateChannelAttributes",value:function(){var p=J(w.mark(function _(A,k){var j,B,z,Vt,_e,_n,_o,_c=arguments;return w.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:if(j=2<_c.length&&_c[2]!==void 0?_c[2]:{},B=j.enableNotificationToChannelMembers,z=B!==void 0&&B,Vt=this.channelAttributesCacheLru.get(A,{}),_e=uc(k,function(_h){return new Blob([_h]).size}),_n=ua(ua({},Vt),_e),uf({attributes:k,attrSizeMap:_n,maxAttrValueSize:8192,maxAttrsCount:32,maxTotalSize:32768}),this.connectionState===T.CONNECTED){_d.next=7;break}throw new K("The client is not logged in",Ub);case 7:if(this.session!==void 0){_d.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _o=this.session.requestAddOrUpdateChannelAttributes(A,k,z).toPromise(),_d.prev=10,_d.next=13,_o;case 13:this.channelAttributesCacheLru.set(A,_n),_d.next=21;break;case 16:if(_d.prev=16,_d.t0=_d.catch(10),!sa(_d.t0)){_d.next=20;break}throw _d.t0;case 20:throw new I("arguments is not valid",Ja);case 21:case"end":return _d.stop()}},_,this,[[10,16]])}));return function(_,A){return p.apply(this,arguments)}}()},{key:"deleteLocalUserAttributesByKeys",value:function(){var p=J(w.mark(function _(A){var k,j,B,z;return w.wrap(function(Vt){for(;;)switch(Vt.prev=Vt.next){case 0:if(Array.isArray(A)&&A.length!==0&&!A.some(function(_e){return _e.length===0})){Vt.next=2;break}throw new K("arguments is not valid",Ja);case 2:if(this.connectionState===T.CONNECTED){Vt.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){Vt.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return k=this.session.requestDeleteLocalUserAttributesByKeys(A).toPromise(),j={attribute:Gk(this.attributes,A),promise:k},this.attributeDrafts.add(j),Vt.prev=9,Vt.next=12,k;case 12:for(B=0;B<A.length;B++)z=A[B],delete this.attributes[z];Vt.next=20;break;case 15:if(Vt.prev=15,Vt.t0=Vt.catch(9),!sa(Vt.t0)){Vt.next=19;break}throw Vt.t0;case 19:throw new I("arguments is not valid",Ja);case 20:return Vt.prev=20,this.attributeDrafts.delete(j),Vt.finish(20);case 23:case"end":return Vt.stop()}},_,this,[[9,15,20,23]])}));return function(_){return p.apply(this,arguments)}}()},{key:"deleteChannelAttributesByKeys",value:function(){var p=J(w.mark(function _(A,k){var j,B,z,Vt,_e,_n,_o,_c=arguments;return w.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:if(j=2<_c.length&&_c[2]!==void 0?_c[2]:{},B=j.enableNotificationToChannelMembers,z=B!==void 0&&B,Array.isArray(k)&&k.length!==0&&za(A)&&!k.some(function(_h){return _h.length===0||512<_h.length})){_d.next=3;break}throw new K("arguments is not valid",Ja);case 3:if(this.connectionState===T.CONNECTED){_d.next=5;break}throw new K("The client is not logged in",Ub);case 5:if(this.session!==void 0){_d.next=7;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 7:return Vt=this.session.requestDeleteChannelAttributesByKeys(A,k,z).toPromise(),_d.prev=8,_d.next=11,Vt;case 11:if(_e=this.channelAttributesCacheLru.get(A))for(_n=0;_n<k.length;_n++)_o=k[_n],delete _e[_o];_d.next=20;break;case 15:if(_d.prev=15,_d.t0=_d.catch(8),!sa(_d.t0)){_d.next=19;break}throw _d.t0;case 19:throw new I("arguments is not valid",Ja);case 20:case"end":return _d.stop()}},_,this,[[8,15]])}));return function(_,A){return p.apply(this,arguments)}}()},{key:"clearLocalUserAttributes",value:function(){var p=J(w.mark(function _(){var A,k;return w.wrap(function(j){for(;;)switch(j.prev=j.next){case 0:if(this.connectionState===T.CONNECTED){j.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){j.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return A=this.session.requestClearLocalUserAttributes().toPromise(),k={attribute:{},promise:A},this.attributeDrafts.add(k),j.prev=7,j.next=10,A;case 10:this.attributes={},j.next=18;break;case 13:if(j.prev=13,j.t0=j.catch(7),!sa(j.t0)){j.next=17;break}throw j.t0;case 17:throw new I("arguments is not valid",Ja);case 18:return j.prev=18,this.attributeDrafts.delete(k),j.finish(18);case 21:case"end":return j.stop()}},_,this,[[7,13,18,21]])}));return function(){return p.apply(this,arguments)}}()},{key:"clearChannelAttributes",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt=arguments;return w.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(k=1<Vt.length&&Vt[1]!==void 0?Vt[1]:{},j=k.enableNotificationToChannelMembers,B=j!==void 0&&j,this.connectionState===T.CONNECTED){_e.next=3;break}throw new K("The client is not logged in",Ub);case 3:if(this.session!==void 0){_e.next=5;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 5:return z=this.session.requestClearChannelAttributes(A,B).toPromise(),_e.prev=6,_e.next=9,z;case 9:this.channelAttributesCacheLru.delete(A),_e.next=17;break;case 12:if(_e.prev=12,_e.t0=_e.catch(6),!sa(_e.t0)){_e.next=16;break}throw _e.t0;case 16:throw new I("arguments is not valid",Ja);case 17:case"end":return _e.stop()}},_,this,[[6,12]])}));return function(_){return p.apply(this,arguments)}}()},{key:"getUserAttributes",value:function(){var p=J(w.mark(function _(A){var k,j,B;return w.wrap(function(z){for(;;)switch(z.prev=z.next){case 0:if(za(A)){z.next=2;break}throw new I("Not a valid user ID",Ja);case 2:if(this.connectionState===T.CONNECTED){z.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){z.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return z.prev=6,z.next=9,this.session.requestGetUserAttributeKeys(A).toPromise();case 9:return k=z.sent,j=k.keys,z.next=13,this.session.requestGetUserAttributesByKeys(A,j.slice(0,512)).toPromise();case 13:B=z.sent,z.next=21;break;case 16:if(z.prev=16,z.t0=z.catch(6),!sa(z.t0)){z.next=20;break}throw z.t0;case 20:throw new I("arguments is not valid",Ja);case 21:return z.abrupt("return",Yp(B.attributeInfos.map(function(Vt){return[Vt.key,Vt.value]})));case 22:case"end":return z.stop()}},_,this,[[6,16]])}));return function(_){return p.apply(this,arguments)}}()},{key:"getChannelAttributes",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt,_e,_n,_o,_c,_d,_h;return w.wrap(function(_p){for(;;)switch(_p.prev=_p.next){case 0:if(za(A)){_p.next=2;break}throw new I("Not a valid channel ID",Ja);case 2:if(this.connectionState===T.CONNECTED){_p.next=4;break}throw new K("The client is not logged in",Ub);case 4:if(this.session!==void 0){_p.next=6;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 6:return _p.prev=6,_p.next=9,this.session.requestGetChannelAttributesKeys(A).toPromise();case 9:return k=_p.sent,j=k.keys,_p.next=13,this.session.requestGetChannelAttributesByKeys(A,j).toPromise();case 13:B=_p.sent,z=B.attributeMaps,_p.next=22;break;case 17:if(_p.prev=17,_p.t0=_p.catch(6),!sa(_p.t0)){_p.next=21;break}throw _p.t0;case 21:throw new I("arguments is not valid",Ja);case 22:Vt={},_e=0;case 24:if(!(_e<z.length)){_p.next=32;break}if(_n=z[_e],_o=_n.key,_c=_n.ms,_d=_n.value,_h=_n.origin,typeof _o=="string"&&U.isLong(_c)&&typeof _d=="string"&&za(_h)){_p.next=28;break}return _p.abrupt("break",32);case 28:Vt[_o]={value:_d,lastUpdateUserId:_h,lastUpdateTs:_c.toNumber()};case 29:_e++,_p.next=24;break;case 32:return this.channelAttributesCacheLru.set(A,uc(Vt,function(_f){return new Blob([_f.value]).size})),_p.abrupt("return",Vt);case 34:case"end":return _p.stop()}},_,this,[[6,17]])}));return function(_){return p.apply(this,arguments)}}()},{key:"getChannelAttributesByKeys",value:function(){var p=J(w.mark(function _(A,k){var j,B,z,Vt,_e,_n,_o,_c,_d,_h;return w.wrap(function(_p){for(;;)switch(_p.prev=_p.next){case 0:if(this.connectionState===T.CONNECTED){_p.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){_p.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(A,k),_p.prev=5,_p.next=8,this.session.requestGetChannelAttributesByKeys(A,k).toPromise();case 8:j=_p.sent,B=j.attributeMaps,_p.next=17;break;case 12:if(_p.prev=12,_p.t0=_p.catch(5),!sa(_p.t0)){_p.next=16;break}throw _p.t0;case 16:throw new I("arguments is not valid",Ja);case 17:z={},Vt=this.channelAttributesCacheLru.get(A,{}),_e=0;case 20:if(!(_e<B.length)){_p.next=29;break}if(_n=B[_e],_o=_n.key,_c=_n.ms,_d=_n.value,_h=_n.origin,typeof _o=="string"&&U.isLong(_c)&&typeof _d=="string"&&za(_h)){_p.next=24;break}return _p.abrupt("break",29);case 24:Vt[_o]=new Blob([_d]).size,z[_o]={value:_d,lastUpdateUserId:_h,lastUpdateTs:_c.toNumber()};case 26:_e++,_p.next=20;break;case 29:return this.channelAttributesCacheLru.set(A,Vt),_p.abrupt("return",z);case 31:case"end":return _p.stop()}},_,this,[[5,12]])}));return function(_,A){return p.apply(this,arguments)}}()},{key:"getUserAttributesByKeys",value:function(){var p=J(w.mark(function _(A,k){var j;return w.wrap(function(B){for(;;)switch(B.prev=B.next){case 0:if(this.connectionState===T.CONNECTED){B.next=2;break}throw new K("The client is not logged in",Ub);case 2:if(this.session!==void 0){B.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:return Hm(A,k),B.prev=5,B.next=8,this.session.requestGetUserAttributesByKeys(A,k).toPromise();case 8:j=B.sent,B.next=16;break;case 11:if(B.prev=11,B.t0=B.catch(5),!sa(B.t0)){B.next=15;break}throw B.t0;case 15:throw new I("arguments is not valid",Ja);case 16:return B.abrupt("return",Yp(j.attributeInfos.map(function(z){return[z.key,z.value]})));case 17:case"end":return B.stop()}},_,this,[[5,11]])}));return function(_,A){return p.apply(this,arguments)}}()},{key:"login",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt=this;return w.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(Uk=!0,k=Bg(),j=A.token,A.token===this.context.appId&&(j=void 0),setTimeout(function(){var _n;eb("Session",{appId:Vt.context.appId,did:navigator.userAgent,elapse:fb(Vt.session&&Vt.session.startTime),index:{index1:A.uid,index2:Vt.context.appId,index3:"enableLogUpload=".concat(Vt.context.config.enableLogUpload)},installId:gg,lts:U.fromNumber(Date.now()),os:7,sid:Xa(k),token:j||"",userId:A.uid,ver:"1.4.3-203",buildno:603,subVersion:203,version:4},(_n=Vt.context.config.enableCloudProxy)!==null&&_n!==void 0&&_n)},1e4),yd(A)&&za(A.uid)){_e.next=7;break}throw new I("not a valid user id",Jh);case 7:if(typeof j!="string"||!j){_e.next=11;break}this.context.token=j,_e.next=13;break;case 11:if(typeof j=="string"||j==null){_e.next=13;break}throw new I('The "token" is not a valid string.',Jh);case 13:return B=Date.now(),this.context.sid=Xa(k),this.loginPromise=this.loginImpl({uid:A.uid,instanceId:k}),this.info("RTM Client logging in as ".concat(oa(A.uid))),_e.prev=17,_e.next=20,this.loginPromise;case 20:_e.next=27;break;case 22:throw _e.prev=22,_e.t0=_e.catch(17),sa(_e.t0)&&eb("Link",{ackedServerIp:"",destServerIp:"",ec:_e.t0.code||1,sc:_e.t0.serverCode,elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),responseTime:Date.now()-B,sid:Xa(k),userId:A.uid},(z=this.context.config.enableCloudProxy)!==null&&z!==void 0&&z),this.context.token=void 0,_e.t0;case 27:return _e.prev=27,this.loginPromise=void 0,_e.finish(27);case 30:Uk=!1;case 31:case"end":return _e.stop()}},_,this,[[17,22,27,30]])}));return function(_){return p.apply(this,arguments)}}()},{key:"logout",value:function(){var p=J(w.mark(function _(){var A;return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(!this.loginPromise){k.next=3;break}return k.next=3,this.loginPromise;case 3:if(this.connectionState!==T.DISCONNECTED){k.next=6;break}throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);case 6:if(this.connectionState!==T.ABORTED){k.next=10;break}return this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),k.abrupt("return");case 10:if(this.session!==void 0){k.next=13;break}return this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),k.abrupt("return");case 13:return eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(A=this.context.config.enableCloudProxy)!==null&&A!==void 0&&A),k.next=16,this.session.logoutHandler();case 16:this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT),this.log("Log out success");case 18:case"end":return k.stop()}},_,this)}));return function(){return p.apply(this,arguments)}}()},{key:"logoutSync",value:function(){var p,_=this;if(this.connectionState===T.DISCONNECTED)throw this.logError("Already in logout state"),new K("Logout failure. The client has already been logged out",br);this.connectionState===T.ABORTED?this.info('Reset connection state from "ABORTED" to "DISCONNECTED"'):this.session!==void 0&&(eb("Logout",{elapse:fb(this.session.startTime),lts:U.fromNumber(Date.now()),sid:Xa(this.session.instanceId),userId:this.context.uid},(p=this.context.config.enableCloudProxy)!==null&&p!==void 0&&p),this.session.logoutHandler().then(function(){_.log("Log out success")})),this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGOUT)}},{key:"sendMessageToPeer",value:function(){var p=J(w.mark(function _(A,k){var j,B,z,Vt,_e,_n,_o=this,_c=arguments;return w.wrap(function(_d){for(;;)switch(_d.prev=_d.next){case 0:if(j=2<_c.length&&_c[2]!==void 0?_c[2]:{},B=j.enableOfflineMessaging,z=B!==void 0&&B,Vt=j.enableHistoricalMessaging,_e=Vt!==void 0&&Vt,Tm(A,ve),this.connectionState!==T.RECONNECTING){_d.next=5;break}return _n=Date.now(),_d.abrupt("return",new Promise(function(_h,_p){var _f=function(){var u_=J(w.mark(function w_(){var O_;return w.wrap(function(y_){for(;;)switch(y_.prev=y_.next){case 0:if(_o.session!==void 0){y_.next=2;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 2:return O_=Date.now()-_n,y_.prev=3,y_.t0=_h,y_.next=7,Gg({message:A,peerId:k,toPeer:!0,session:_o.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:O_,logger:_o.logger,options:{enableHistoricalMessaging:_e,enableOfflineMessaging:z}});case 7:y_.t1=y_.sent,(0,y_.t0)(y_.t1),y_.next=16;break;case 11:y_.prev=11,y_.t2=y_.catch(3),Sa(y_.t2)&&_p(new db(Yd(_o.name,"sendMessageToPeer",1e4),Zk)),sa(y_.t2)&&_p(y_.t2),_p(new da("Peer-to-peer message send failure",{code:cr,originalError:y_.t2}));case 16:return y_.prev=16,clearTimeout(e_),y_.finish(16);case 19:case"end":return y_.stop()}},w_,null,[[3,11,16,19]])}));return function(){return u_.apply(this,arguments)}}();_o.internalEmitter.once("RECONNECTED",_f);var e_=setTimeout(function(){_o.internalEmitter.off("RECONNECTED",_f),_p(new db(Yd(_o.name,"sendMessageToPeer",1e4),Zk))},9e3)}));case 5:if(this.connectionState===T.CONNECTED){_d.next=7;break}throw new K("Failed to send the peer-to-peer message. The client is not logged in",al);case 7:if(this.session!==void 0){_d.next=9;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 9:return _d.prev=9,_d.next=12,Gg({message:A,peerId:k,toPeer:!0,session:this.session,errorCodes:{NOT_LOGGED_IN:al,TOO_OFTEN:dr},diff:0,logger:this.logger,options:{enableHistoricalMessaging:_e,enableOfflineMessaging:z}});case 12:return _d.abrupt("return",_d.sent);case 15:if(_d.prev=15,_d.t0=_d.catch(9),!Sa(_d.t0)){_d.next=19;break}throw new db(Yd(this.name,"sendMessageToPeer",1e4),Zk);case 19:if(!sa(_d.t0)){_d.next=21;break}throw _d.t0;case 21:throw new da("Peer-to-peer message send failure",{code:cr,originalError:_d.t0});case 22:case"end":return _d.stop()}},_,this,[[9,15]])}));return function(_,A){return p.apply(this,arguments)}}()},{key:"createChannel",value:function(p){var _=this;if(!za(p))throw new I(["The %s in the arguments is invalid",Object.keys({channelId:p})[0]],Zz);return new pD(p,function(){return _.session},this,this.logger)}},{key:"createLocalInvitation",value:function(p){if(!za(p))throw new I(["The %s in the arguments is invalid",Object.keys({calleeId:p})[0]],xc);return this.invitationManager.genLocalInvitation(p)}},{key:"subscribePeersOnlineStatus",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt,_e,_n,_o,_c,_d,_h,_p,_f,e_=this;return w.wrap(function(u_){for(;;)switch(u_.prev=u_.next){case 0:if(this.connectionState===T.CONNECTED){u_.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){u_.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(A)&&A.length!==0){u_.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:k=0;case 7:if(!(k<A.length)){u_.next=14;break}if(za(j=A[k])){u_.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",j],kg);case 11:k++,u_.next=7;break;case 14:if(!(512<(B=A&&A.length?vk(A):[]).length+Object.keys(this.subscribedPeerStatusCache).length)){u_.next=17;break}throw new ib("Subscribed peers overflows",gr);case 17:return u_.next=19,this.session.requestSubscribePeersOnlineStatus(B).toPromise();case 19:z=u_.sent,Vt=z.errors,_e=[],_n=[],_o=0;case 24:if(!(_o<Vt.length)){u_.next=32;break}if(_c=Vt[_o],_d=_c.code,typeof(_h=_c.account)=="string"){u_.next=28;break}throw new da("Returned account is invalid",fr);case 28:_d!==0&&_e.push(_h);case 29:_o++,u_.next=24;break;case 32:for(_p=0;_p<B.length;_p++)_f=B[_p],_e.includes(_f)||(_n.push(_f),this.subscribedPeerStatusCache[_f]=void 0);if(this.session.requestPeersOnlineStatus(_n).pipe(ba(function(w_){return uc(Jk(w_.userInfos,"account"),function(O_){return!!O_.ts})})).subscribe(function(w_){w_=uc(w_,function(O_,y_){return O_=O_?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,e_.subscribedPeerStatusCache[y_]=O_}),e_.emit("PeersOnlineStatusChanged",w_)}),_e.length===0){u_.next=36;break}throw new da("Subscription failed",fr);case 36:case"end":return u_.stop()}},_,this)}));return function(_){return p.apply(this,arguments)}}()},{key:"unsubscribePeersOnlineStatus",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt;return w.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(this.connectionState===T.CONNECTED){_e.next=2;break}throw new K("The client is not logged in",bl);case 2:if(this.session!==void 0){_e.next=4;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 4:if(Array.isArray(A)&&A.length!==0){_e.next=6;break}throw new I("Invalid arguments: peerIds",kg);case 6:k=0;case 7:if(!(k<A.length)){_e.next=14;break}if(za(j=A[k])){_e.next=11;break}throw new I(["subscribePeersOnlineStatus peer id %s is invalid",j],kg);case 11:k++,_e.next=7;break;case 14:if(!(512<A.length)){_e.next=16;break}throw new ib("Unsubscribed peers overflows",gr);case 16:for(B=A&&A.length?vk(A):[],this.session.requestUnsubscribePeersOnlineStatus(B),z=0;z<B.length;z++)Vt=B[z],delete this.subscribedPeerStatusCache[Vt];case 19:case"end":return _e.stop()}},_,this)}));return function(_){return p.apply(this,arguments)}}()},{key:"queryPeersBySubscriptionOption",value:function(){var p=J(w.mark(function _(A){return w.wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(this.connectionState===T.CONNECTED){k.next=2;break}throw new K("The client is not logged in",bl);case 2:if(A!==S.PeerSubscriptionOption.ONLINE_STATUS){k.next=4;break}return k.abrupt("return",Object.keys(this.subscribedPeerStatusCache));case 4:throw new I("Subscription option not supported",kg);case 5:case"end":return k.stop()}},_,this)}));return function(_){return p.apply(this,arguments)}}()},{key:"createMessage",value:function(p){return p.messageType==="IMAGE"?ua({width:0,height:0,fileName:"",description:"",thumbnail:new Blob,thumbnailWidth:0,thumbnailHeight:0,size:0},p):p.messageType==="FILE"?ua({fileName:"",description:"",thumbnail:new Blob,size:0},p):p}},{key:"downloadMedia",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt,_e,_n,_o,_c,_d,_h,_p,_f,e_,u_=this,w_=arguments;return w.wrap(function(O_){for(;;)switch(O_.prev=O_.next){case 0:if(k=1<w_.length&&w_[1]!==void 0?w_[1]:{},typeof A=="string"){O_.next=3;break}throw new I("invalid mediaId format",cl);case 3:if(O_.prev=3,j=A.split("z"),B=ra(j,3),z=B[0],Vt=B[1],_e=B[2],_n=z.slice(1,65),_o=bD(_n),_c=parseInt(z.slice(65),10),_d=parseInt(Vt,10),_h=parseInt(_e,10),!(Number.isNaN(_c)||Number.isNaN(_d)||Number.isNaN(_h))){O_.next=12;break}throw new I("Invalid mediaId content",cl);case 12:O_.next=19;break;case 14:if(O_.prev=14,O_.t0=O_.catch(3),!sa(O_.t0)){O_.next=18;break}throw O_.t0;case 18:throw new I("parse mediaId failure",{code:cl,originalError:O_.t0});case 19:if(this.connectionState===T.CONNECTED){O_.next=21;break}throw new K("The client is not logged in, cannot download",CA);case 21:if(this.session!==void 0){O_.next=23;break}throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});case 23:return _p=this.mediaTaskManager.addDownloadTask({unit:_d,zone:_c,hashHexStr:_n,size:_h},function(){if(u_.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return u_.session.requestFileDownloadIndexGet({hash:_o,zone:_c,unit:_d,size:_h}).toPromise()},k),O_.next=26,this.mediaTaskManager.waitMediaTask(_p);case 26:return _f=O_.sent,e_=_f.payload,O_.abrupt("return",e_);case 29:case"end":return O_.stop()}},_,this,[[3,14]])}));return function(_){return p.apply(this,arguments)}}()},{key:"createMediaMessageByUploading",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt,_e,_n,_o,_c,_d,_h,_p,_f,e_,u_,w_,O_,y_,Z_,NE,i_,S_,h_,I_,vf=this,o_=arguments;return w.wrap(function(d_){for(;;)switch(d_.prev=d_.next){case 0:if(k=1<o_.length&&o_[1]!==void 0?o_[1]:{},j=2<o_.length&&o_[2]!==void 0?o_[2]:{},yd(k)){d_.next=4;break}throw new I("Invalid params",wf);case 4:if(B="thumbnailWidth"in k||"thumbnailHeight"in k||"width"in k||"height"in k,z=k.messageType,Vt=z===void 0?B?"IMAGE":"FILE":z,_e=k.description,_n=_e===void 0?"":_e,_o=k.fileName,_c=_o===void 0?"":_o,_d=k.thumbnail,typeof k.messageType=="string"&&typeof _n=="string"&&typeof _c=="string"&&(Pm(_d)||_d===void 0)&&Pm(A)){d_.next=8;break}throw new I("Invalid message params type",wf);case 8:if(!B||Vt!=="FILE"){d_.next=10;break}throw new I("Invalid message params, unexpected field in RtmFileMessage",wf);case 10:if(!(33554432<(_h=A.size))){d_.next=13;break}throw new ib("The payload size overflow 32 MB",wA);case 13:return d_.next=15,Ji(A);case 15:return _p=d_.sent,d_.next=18,aD(_p);case 18:if(_f=d_.sent,this.connectionState===T.CONNECTED){d_.next=21;break}throw new K("The client is not logged in",yA);case 21:if(Vt!=="IMAGE"){d_.next=29;break}return d_.next=24,Xt(k,_p);case 24:e_=d_.sent,u_=e_.height,w_=e_.width,O_=e_.thumbnailWidth,y_=e_.thumbnailHeight;case 29:return Z_=this.mediaTaskManager.addUploadTask({file:new Uint8Array(_p),hash:_f},function(){if(vf.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return vf.session.fetchFileUploadIndexGet({hash:_f,size:_h})},function(g_,v_){if(vf.session===void 0)throw new Fa({SESSION_NOT_FOUND:"Failed to get session of the client"});return vf.session.requestFileUploadIndexSet({hash:_f,unit:g_,servers:v_}).toPromise()},j),d_.next=32,this.mediaTaskManager.waitMediaTask(Z_);case 32:if(NE=d_.sent,i_=NE.zone,S_=NE.retUnit,Vt!=="IMAGE"){d_.next=38;break}return h_={height:u_,width:w_,fileName:_c,size:_h,description:_n,thumbnail:_d,messageType:Vt,thumbnailWidth:O_,thumbnailHeight:y_,mediaId:"0".concat($r(_f)).concat(i_,"z").concat(S_,"z").concat(_h,"z").concat(u_,"z").concat(w_)},d_.abrupt("return",h_);case 38:return I_={fileName:_c,size:_h,description:_n,mediaId:"0".concat($r(_f)).concat(i_,"z").concat(S_,"z").concat(_h),thumbnail:_d,messageType:Vt},d_.abrupt("return",I_);case 40:case"end":return d_.stop()}},_,this)}));return function(_){return p.apply(this,arguments)}}()},{key:"loginImpl",value:function(){var p=J(w.mark(function _(A){var k,j,B,z,Vt=this;return w.wrap(function(_e){for(;;)switch(_e.prev=_e.next){case 0:if(k=A.uid,j=A.instanceId,!(this.lastLoginTime!==void 0&&500>Date.now()-this.lastLoginTime)){_e.next=4;break}throw new rC(["The frequency of login exceeded the limit of %d queries per second",2],mA);case 4:if(this.connectionState===T.DISCONNECTED){_e.next=6;break}throw new K("The SDK is either logging in or has logged in the Agora RTM system",kA);case 6:_e.prev=6,this.context.uid=k,_e.next=13;break;case 10:throw _e.prev=10,_e.t0=_e.catch(6),new I(["The %s in the arguments is invalid",Object.keys({uid:k})[0]],Jh);case 13:return this.onConnectionStateChanged(T.CONNECTING,Eb.LOGIN),this.session=B=new ls(this.context,new Yr(this.context,this.logger,!1),j,this.logger),z=function(){Vt.connectionState===T.CONNECTED&&(Vt.onConnectionStateChanged(T.RECONNECTING,Eb.INTERRUPTED),Vt.session)&&Vt.session.once("userJoined",function(){Vt.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS)})},B.on("connectionLost",z),B.on("tokenExpired",function(){Vt.emit("TokenExpired")}),B.once("userDrop",this.userDropHandler),this.session.on("peerTextMessage",function(_n){Vt.emit("MessageFromPeer",{text:_n.text,messageType:S.MessageType.TEXT},_n.peerId,_n.properties)}),this.session.on("peerMediaMessage",function(_n){var _o=_n.peerId,_c=_n.properties,_d=_n.messageType;_n=_n.details,_d==="FILE"?Vt.emit("MessageFromPeer",{messageType:S.MessageType.FILE,size:parseInt(pa(_n.media_size),10),description:pa(_n.media_description),fileName:pa(_n.media_filename),mediaId:pa(_n.media_id),thumbnail:new Blob([_n.media_thumbnail])},_o,_c):_d==="IMAGE"&&Vt.emit("MessageFromPeer",{messageType:S.MessageType.IMAGE,size:parseInt(pa(_n.media_size),10),description:pa(_n.media_description),fileName:pa(_n.media_filename),mediaId:pa(_n.media_id),thumbnail:new Blob([_n.media_thumbnail]),height:parseInt(pa(_n.media_height),10),width:parseInt(pa(_n.media_width),10),thumbnailHeight:parseInt(pa(_n.media_thumbnailheight),10),thumbnailWidth:parseInt(pa(_n.media_thumbnailwidth),10)},_o,_c)}),this.session.on("peerRawMessage",function(_n){Vt.emit("MessageFromPeer",{rawMessage:_n.raw,description:_n.desc,messageType:S.MessageType.RAW},_n.peerId,_n.properties)}),B.on("instanceChanged",function(_n){return j=_n}),B.on("peerOnlineStatusChanged",function(_n){var _o=_n.instance.toString()+_n.state,_c=Vt.peerStatusSeqLru.get(_o);!_c||_n.seq.greaterThan(_c)?(Vt.peerStatusSeqLru.set(_o,_n.seq),_n.state!==Vt.subscribedPeerStatusCache[_n.peerId]&&Vt.emit("PeersOnlineStatusChanged",m({},_n.peerId,_n.state)),Vt.subscribedPeerStatusCache[_n.peerId]=_n.state,clearTimeout(Vt.peerUnreachableTimers[_o]),_n.state===S.PeerOnlineState.UNREACHABLE&&(Vt.peerUnreachableTimers[_o]=setTimeout(function(){Vt.subscribedPeerStatusCache[_n.peerId]===S.PeerOnlineState.UNREACHABLE&&(Vt.subscribedPeerStatusCache[_n.peerId]=S.PeerOnlineState.ONLINE,Vt.emit("PeersOnlineStatusChanged",m({},_n.peerId,S.PeerOnlineState.ONLINE)))},3e4))):Vt.log("peerOnlineStatusChanged dedup for %s, %d",_o,_n.seq.toNumber())}),B.on("invitationMessage",this.invitationManager.invitationMessageHandler.bind(this.invitationManager)),B.on("channelAttributesUpdated",function(_n){var _o=_n.channelId;_n=_n.attributeMaps;for(var _c={},_d=0;_d<_n.length;_d++){var _h=_n[_d],_p=_h.key,_f=_h.ms,e_=_h.value;if(_h=_h.origin,typeof _p!="string"||!U.isLong(_f)||typeof e_!="string"||!za(_h))break;_c[_p]=new Blob([e_]).size}Vt.channelAttributesCacheLru.set(_o,_c)}),B.on("userJoined",function(_n){if(Object.keys(Vt.attributes).length!==0){if(Vt.session===void 0)return;Vt.session.requestSetLocalUserAttributes(Vt.attributes,_n).toPromise()}if(Vt.attributeDrafts.size!==0)for(var _o=function(_h,_p){var _f=(_h=_p[_h]).attribute;_h.promise.then(function(){Vt.session!==void 0&&Vt.session.requestSetLocalUserAttributes(_f,_n).toPromise()})},_c=0,_d=Array.from(Vt.attributeDrafts);_c<_d.length;_c++)_o(_c,_d);Object.keys(Vt.subscribedPeerStatusCache).length!==0&&B.requestSubscribePeersOnlineStatus(Object.keys(Vt.subscribedPeerStatusCache))}),this.lastLoginTime=Date.now(),_e.prev=29,_e.next=32,B.loginHandler().toPromise();case 32:this.mediaTaskManager.setAuthInfo({ticket:B.connection.curOpenSockets.filter(function(_n){return _n!==void 0})[0].ticket,instance:B.instanceId,useNewDomain:.5<=Math.random(),loginOpt:B.userJoinOptions.toLong()}),_e.next=44;break;case 35:if(_e.prev=35,_e.t1=_e.catch(29),!Sa(_e.t1)){_e.next=40;break}throw this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_TIMEOUT),new db(Yd(this.name,"login",2e4),lA);case 40:if(this.onConnectionStateChanged(T.DISCONNECTED,Eb.LOGIN_FAILURE),!sa(_e.t1)){_e.next=43;break}throw _e.t1;case 43:throw new da("Login failure",{code:Zq,originalError:_e.t1});case 44:this.onConnectionStateChanged(T.CONNECTED,Eb.LOGIN_SUCCESS);case 45:case"end":return _e.stop()}},_,this,[[6,10],[29,35]])}));return function(_){return p.apply(this,arguments)}}()},{key:"onConnectionStateChanged",value:function(p,_){var A,k=this;p===T.RECONNECTING&&(this.reconnId+=1),eb("ConnectionStateChange",{elapse:fb(this.session&&this.session.startTime),lts:U.fromNumber(Date.now()),newState:os[p],oldState:os[this.connectionState],reason:qD[_],sid:Xa(this.session&&this.session.instanceId||U.fromNumber(0)),userId:this.context.uid,reconnId:this.reconnId},(A=this.context.config.enableCloudProxy)!==null&&A!==void 0&&A),this.connectionState===T.RECONNECTING&&p===T.CONNECTED&&(Object.keys(this.subscribedPeerStatusCache).length!==0&&this.session!==void 0&&this.session.requestPeersOnlineStatus(Object.keys(this.subscribedPeerStatusCache)).pipe(ba(function(j){return uc(Jk(j.userInfos,"account"),function(B){return!!B.ts})})).subscribe(function(j){j=uc(j,function(B,z){return B=B?S.PeerOnlineState.ONLINE:S.PeerOnlineState.OFFLINE,k.subscribedPeerStatusCache[z]=B}),k.emit("PeersOnlineStatusChanged",j)}),this.internalEmitter.emit("RECONNECTED")),this.connectionState=p,p!==T.ABORTED&&p!==T.DISCONNECTED||(this.reconnId=0,this.attributes={},this.session&&(this.session.removeAllListeners(),this.session.joinedChannels.clear(),this.session.msgDedupLru.empty(),this.session.dialogueSequenceLru.empty(),this.session.dialPendingMsgSubjectMap.clear()),this.session=void 0,this.channelAttributesCacheLru.empty(),this.peerStatusSeqLru.empty(),this.peerUnreachableTimers={},this.subscribedPeerStatusCache={},this.attributeDrafts.clear(),this.context.token=void 0),this.mediaTaskManager.emit("connectionStateChanged",p),this.emit("ConnectionStateChanged",p,_)}}]),o}(tb()),fa(E.prototype,"renewToken",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"renewToken"),E.prototype),fa(E.prototype,"queryPeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersOnlineStatus"),E.prototype),fa(E.prototype,"getChannelMemberCount",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelMemberCount"),E.prototype),fa(E.prototype,"setLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setLocalUserAttributes"),E.prototype),fa(E.prototype,"setChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"setChannelAttributes"),E.prototype),fa(E.prototype,"addOrUpdateLocalUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateLocalUserAttributes"),E.prototype),fa(E.prototype,"addOrUpdateChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"addOrUpdateChannelAttributes"),E.prototype),fa(E.prototype,"deleteLocalUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteLocalUserAttributesByKeys"),E.prototype),fa(E.prototype,"deleteChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"deleteChannelAttributesByKeys"),E.prototype),fa(E.prototype,"clearLocalUserAttributes",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"clearLocalUserAttributes"),E.prototype),fa(E.prototype,"clearChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"clearChannelAttributes"),E.prototype),fa(E.prototype,"getUserAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributes"),E.prototype),fa(E.prototype,"getChannelAttributes",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributes"),E.prototype),fa(E.prototype,"getChannelAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getChannelAttributesByKeys"),E.prototype),fa(E.prototype,"getUserAttributesByKeys",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"getUserAttributesByKeys"),E.prototype),fa(E.prototype,"login",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"login"),E.prototype),fa(E.prototype,"logout",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logout"),E.prototype),fa(E.prototype,"logoutSync",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"logoutSync"),E.prototype),fa(E.prototype,"sendMessageToPeer",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"sendMessageToPeer"),E.prototype),fa(E.prototype,"createChannel",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createChannel"),E.prototype),fa(E.prototype,"createLocalInvitation",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"createLocalInvitation"),E.prototype),fa(E.prototype,"subscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"subscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"unsubscribePeersOnlineStatus",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"unsubscribePeersOnlineStatus"),E.prototype),fa(E.prototype,"queryPeersBySubscriptionOption",[Ma],Object.getOwnPropertyDescriptor(E.prototype,"queryPeersBySubscriptionOption"),E.prototype),fa(E.prototype,"createMessage",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMessage"),E.prototype),fa(E.prototype,"downloadMedia",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"downloadMedia"),E.prototype),fa(E.prototype,"createMediaMessageByUploading",[Nb],Object.getOwnPropertyDescriptor(E.prototype,"createMediaMessageByUploading"),E.prototype),E),ps={LOG_FILTER_OFF:{error:!1,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_ERROR:{error:!0,warn:!1,info:!1,track:!1,debug:!1},LOG_FILTER_WARNING:{error:!0,warn:!0,info:!1,track:!1,debug:!1},LOG_FILTER_INFO:{error:!0,warn:!0,info:!0,track:!1,debug:!1},LOG_FILTER_DEBUG:{error:!0,warn:!0,info:!0,track:!0,debug:!0}},qs={enableLogUpload:!1,logFilter:ps.LOG_FILTER_INFO,enableCloudProxy:!1},Zd=ua(ua({createInstance:function(s){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{},l=2<arguments.length?arguments[2]:void 0;if(!/^[\dA-Za-z]{32}$/.test(s))throw new I(["The %s in the arguments is invalid",Object.keys({appId:s})[0]],Nq);var p=Object.keys(o).filter(function(Vt){return!(Vt in qs)});if(p.length!==0)throw new I("Invalid RTM config: ".concat(p.join(", ")),Nq);var _=ua(ua({},qs),o);if(l!==void 0&&(!Array.isArray(l)||l.length===0))throw new I("Invalid area config");if(l!=null){if(!l.every(function(Vt){return Vt in S.LegacyAreaCode}))throw new I("Invalid area codes: ".concat(l.filter(function(Vt){return!(Vt in S)}).join(", ")));M=xe(l.map(function(Vt){return zC[Vt]}))}l=jl=Ya.__global_unique_id__=(Ya.__global_unique_id__||0)+1;var A=DC(_);p=EC(_);var k=FC(_),j=GC(l,_),B=Tr(l,_),z=B("RTM:DEBUG","<Entry> ");return Mr.rtmConfig=_,A("The Agora RTM Web SDK version is %s","1.4.3-203"),o.enableCloudProxy&&A("RTM cloud proxy enabled"),o.enableLogUpload&&A("Log upload enabled"),M&&z("Area is set to %s",Array.from(M.CODES).map(function(Vt){return xf(F).find(function(_e){return F[_e]===Vt})}).join(", ")),z("Creating an RtmClient instance"),z('The Git commit ID is "'.concat("v1.4.3-17-g1e27aa38",'"')),z("The App ID is %s",Um(s,4,10,"*".repeat(6))),A("The process ID is %s",gg),z("The build is %s","v1.4.3-17-g1e27aa38"),z("NODE_ENV is %s","production"),new rD(s,{genLogger:B,genTracker:j,info:A,warn:p,logError:k,loggerId:l},_,function(Vt){for(var _e=0,_n=xf(Vt);_e<_n.length;_e++){var _o=_n[_e];try{var _c=Vt[_o];_c!=null&&(Vt.enableCloudProxy&&A("RTM cloud proxy enabled"),Vt.enableLogUpload&&A("Log upload enabled"),_[_o]=_c)}catch{throw new I(["The %s in the arguments is invalid",_o],void 0)}}})},BUILD:"v1.4.3-17-g1e27aa38",VERSION:"1.4.3-203",END_CALL_PREFIX:"AgoraRTMLegacyEndcallCompatibleMessagePrefix",processId:gg,ConnectionChangeReason:S.ConnectionChangeReason,ConnectionState:S.ConnectionState,LocalInvitationFailureReason:S.LocalInvitationFailureReason,LocalInvitationState:S.LocalInvitationState,RemoteInvitationFailureReason:S.RemoteInvitationFailureReason,RemoteInvitationState:S.RemoteInvitationState,MessageType:S.MessageType,PeerOnlineState:S.PeerOnlineState,PeerSubscriptionOption:S.PeerSubscriptionOption},ps),{},{setParameter:function(s,o){Object.keys(Nc).includes(s)&&(Nc[s]=o)},getParameter:function(s){return Nc[s]},setArea:function(s){var o=s.areaCodes;if(s=s.excludedArea,!Array.isArray(o)||o.length===0||!o.every(function(l){return l in S.AreaCode}))throw new I("Invalid area config");if(s!==void 0&&s===S.AreaCode.GLOBAL)throw new I("Excluded area cannot be global");if(s===void 0)M=xe(o.map(function(l){return F[l]}));else{if(o.includes(s))throw new I("Excluded area cannot be in areaCodes");if(!(s in F))throw new I("Invalid excludedArea:",s);M=bu({areas:o.map(function(l){return F[l]}),excludedArea:F[s]})}}});return Zd})})(agoraRtmSdk,agoraRtmSdk.exports);var agoraRtmSdkExports=agoraRtmSdk.exports;const AgoraRTM__default=getDefaultExportFromCjs(agoraRtmSdkExports);var createLazyClient=function s(){var o;function l(p,_,A){return o||(o=AgoraRTM__default.createInstance(p,_,A)),o}return function(p,_,A){return l(p,_,A)}},createLazyChannel=function s(){var o;function l(p,_){return o||(o=p.createChannel(_)),o}return function(p,_){return l(p,_)}},AreaCode;(function(s){s.GLOBAL="GLOBAL",s.INDIA="INDIA",s.JAPAN="JAPAN",s.ASIA="ASIA",s.EUROPE="EUROPE",s.CHINA="CHINA",s.NORTH_AMERICA="NORTH_AMERICA"})(AreaCode||(AreaCode={}));function _extends(){return _extends=Object.assign||function(s){for(var o=1;o<arguments.length;o++){var l=arguments[o];for(var p in l)Object.prototype.hasOwnProperty.call(l,p)&&(s[p]=l[p])}return s},_extends.apply(this,arguments)}typeof Symbol<"u"&&(Symbol.iterator||(Symbol.iterator=Symbol("Symbol.iterator")));typeof Symbol<"u"&&(Symbol.asyncIterator||(Symbol.asyncIterator=Symbol("Symbol.asyncIterator")));function _catch(s,o){try{var l=s()}catch(p){return o(p)}return l&&l.then?l.then(void 0,o):l}var RtcContext=React.createContext({}),RtcProvider=RtcContext.Provider;RtcContext.Consumer;var remoteTrackState;(function(s){s[s.yes=0]="yes",s[s.subbed=1]="subbed",s[s.no=2]="no"})(remoteTrackState||(remoteTrackState={}));var layout;(function(s){s[s.grid=0]="grid",s[s.pin=1]="pin"})(layout||(layout={}));var ToggleState;(function(s){s[s.disabled=0]="disabled",s[s.enabled=1]="enabled",s[s.disabling=2]="disabling",s[s.enabling=3]="enabling"})(ToggleState||(ToggleState={}));var initialValue={rtcProps:{appId:"",channel:"",role:"host"},rtmProps:{}},PropsContext=React.createContext(initialValue),PropsProvider=PropsContext.Provider,MaxUidContext=React.createContext([]),MaxUidProvider=MaxUidContext.Provider,MaxUidConsumer=MaxUidContext.Consumer,MinUidContext=React.createContext([]),MinUidProvider=MinUidContext.Provider,MinUidConsumer=MinUidContext.Consumer,TracksContext=React.createContext({}),TracksProvider=TracksContext.Provider,initState={max:[{uid:0,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}],min:[],isScreensharing:!1},reducer=function s(o,l){var p=initState,_=[].concat(o.max,o.min).map(function(z){return z.uid});switch(l.type){case"Screensharing":p=_extends({},o,{isScreensharing:l.value[0]}),console.log("!Screensharingstate",o,p);break;case"update-user-video":p={min:o.min.map(function(z){return z.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:z}),max:o.max.map(function(z){return z.uid===0?{uid:0,hasAudio:remoteTrackState.subbed,hasVideo:remoteTrackState.subbed}:z}),isScreensharing:o.isScreensharing};break;case"user-joined":if(_.indexOf(l.value[0].uid)===-1){var A=[].concat(o.min,[{uid:l.value[0].uid,hasAudio:remoteTrackState.no,hasVideo:remoteTrackState.no}]);A.length===1&&o.max[0].uid===0?p={max:A,min:o.max,isScreensharing:o.isScreensharing}:p={min:A,max:o.max,isScreensharing:o.isScreensharing}}break;case"user-unpublished":if(o.max[0].uid===l.value[0].uid)p={max:[{uid:l.value[0].uid,hasAudio:l.value[1]==="audio"?remoteTrackState.no:o.max[0].hasAudio,hasVideo:l.value[1]==="video"?remoteTrackState.no:o.max[0].hasVideo}],min:o.min,isScreensharing:o.isScreensharing};else{var k=o.min.find(function(z){return z.uid===l.value[0].uid});if(k){var j=[].concat(o.min.filter(function(z){return z.uid!==l.value[0].uid}),[{uid:l.value[0].uid,hasAudio:l.value[1]==="audio"?remoteTrackState.no:k.hasAudio,hasVideo:l.value[1]==="video"?remoteTrackState.no:k.hasVideo}]);p={min:j,max:o.max,isScreensharing:o.isScreensharing}}}break;case"user-published":o.max[0].uid===l.value[0].uid?p={max:[{uid:l.value[0].uid,hasAudio:l.value[1]==="audio"?remoteTrackState.subbed:o.max[0].hasAudio,hasVideo:l.value[1]==="video"?remoteTrackState.subbed:o.max[0].hasVideo}],min:o.min,isScreensharing:o.isScreensharing}:p={min:o.min.map(function(z){return z.uid!==l.value[0].uid?z:{uid:z.uid,hasAudio:l.value[1]==="audio"?remoteTrackState.subbed:z.hasAudio,hasVideo:l.value[1]==="video"?remoteTrackState.subbed:z.hasVideo}}),max:o.max,isScreensharing:o.isScreensharing};break;case"user-left":if(o.max[0].uid===l.value[0].uid){var B=[].concat(o.min);p={max:[B.pop()],min:B,isScreensharing:o.isScreensharing}}else p={min:o.min.filter(function(z){return z.uid!==l.value[0].uid}),max:o.max,isScreensharing:o.isScreensharing};break;case"user-swap":o.max[0].uid===l.value[0].uid||(p={max:[l.value[0]],min:[].concat(o.min.filter(function(z){return z.uid!==l.value[0].uid}),[o.max[0]]),isScreensharing:o.isScreensharing});break;case"local-user-mute-video":p={min:o.min.map(function(z){return z.uid===0?{uid:0,hasAudio:z.hasAudio,hasVideo:l.value[0]}:z}),max:o.max.map(function(z){return z.uid===0?{uid:0,hasAudio:z.hasAudio,hasVideo:l.value[0]}:z}),isScreensharing:o.isScreensharing};break;case"local-user-mute-audio":p={min:o.min.map(function(z){return z.uid===0?{uid:0,hasAudio:l.value[0],hasVideo:z.hasVideo}:z}),max:o.max.map(function(z){return z.uid===0?{uid:0,hasAudio:l.value[0],hasVideo:z.hasVideo}:z}),isScreensharing:o.isScreensharing};break;case"remote-user-mute-video":p={min:o.min.map(function(z){return z.uid===l.value[0].uid?{uid:z.uid,hasVideo:l.value[1],hasAudio:z.hasAudio}:z}),max:o.max.map(function(z){return z.uid===l.value[0].uid?{uid:z.uid,hasVideo:l.value[1],hasAudio:z.hasAudio}:z}),isScreensharing:o.isScreensharing};break;case"remote-user-mute-audio":p={min:o.min.map(function(z){return z.uid===l.value[0].uid?{uid:z.uid,hasAudio:l.value[1],hasVideo:z.hasVideo}:z}),max:o.max.map(function(z){return z.uid===l.value[0].uid?{uid:z.uid,hasAudio:l.value[1],hasVideo:z.hasVideo}:z}),isScreensharing:o.isScreensharing};break;case"leave-channel":p=initState;break;case"ActiveSpeaker":o.max[0].uid===l.value[0]?p=_extends({},o):p={max:[o.min.find(function(z){return z.uid===l.value[0]})],min:[].concat(o.min.filter(function(z){return z.uid!==l.value[0]}),[o.max[0]]),isScreensharing:o.isScreensharing};break}return console.log("!state-update",_extends({},o,p),p),_extends({},o,p)},startScreenshare=function s(o,l,p,_,A,k,j){try{var B=function(){try{try{console.log(_e),k&&(_e.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(k+"/rtc/"+l+"/publisher/uid/"+_o+"/")).then(function(_p){return Promise.resolve(_p.json()).then(function(_f){var e_=_f.rtcToken;_e.renewToken(e_)})})}catch(_p){return Promise.reject(_p)}}),_e.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(k+"/rtc/"+l+"/publisher/uid/"+_o+"/")).then(function(_p){return Promise.resolve(_p.json()).then(function(_f){var e_=_f.rtcToken;_e.renewToken(e_)})})}catch(_p){return Promise.reject(_p)}})),p.on("track-ended",function(){_e.leave(),_e.removeAllListeners()})}catch(_p){console.log(_p)}return Promise.resolve()}catch(_p){return Promise.reject(_p)}},z=function(){try{_e.setClientRole("host");var _p=function(){if(k){var _f=_catch(function(){return Promise.resolve(fetch(k+"/rtc/"+l+"/publisher/uid/"+_o+"/")).then(function(e_){return Promise.resolve(e_.json()).then(function(u_){var w_=u_.rtcToken;return Promise.resolve(_e.join(o,l,w_,_o)).then(function(O_){_n=O_})})})},function(e_){console.log(e_)});if(_f&&_f.then)return _f.then(function(){})}else return Promise.resolve(_e.join(o,l,_||null,_o||0)).then(function(e_){_n=e_})}();return Promise.resolve(_p&&_p.then?_p.then(function(){}):void 0)}catch(_f){return Promise.reject(_f)}},Vt=function(){try{var _p=function(){var u_=function(){if(p.enabled){var w_=function(){if(!_c)return Promise.resolve(_e.publish([p]).then(function(){_c=!0})).then(function(){})}();if(w_&&w_.then)return w_.then(function(){})}}();if(u_&&u_.then)return u_.then(function(){})},_f=function(){if(j)return Promise.resolve(_e.enableDualStream()).then(function(){})}();return Promise.resolve(_f&&_f.then?_f.then(_p):_p(_f))}catch(e_){return Promise.reject(e_)}},_e=AgoraRTC__default.createClient({mode:"live",role:"host",codec:"vp8"}),_n=0,_o=A||1,_c=!1,_d=function(){try{var _p=_catch(function(){return p.close(),Promise.resolve(_e.leave()).then(function(){_e.removeAllListeners()})},function(_f){console.log(_f)});return Promise.resolve(_p&&_p.then?_p.then(function(){}):void 0)}catch(_f){return Promise.reject(_f)}};return stopScreenshare=_d,Promise.resolve(B()).then(function(){return Promise.resolve(z()).then(function(){return Promise.resolve(Vt()).then(function(){_n&&console.log(_n)})})})}catch(_h){return Promise.reject(_h)}},stopScreenshare=function s(){},useClient=createClient({codec:"vp8",mode:"live"}),RtcConfigure=function s(o){var l=reactExports.useRef(),p=reactExports.useRef(),_=reactExports.useRef(!1),A=reactExports.useContext(TracksContext),k=A.localVideoTrack,j=A.localAudioTrack,B=reactExports.useContext(PropsContext),z=B.callbacks,Vt=B.rtcProps,_e=reactExports.useState(!1),_n=_e[0],_o=_e[1],_c=reactExports.useState(!1),_d=_c[0],_h=_c[1],_p=null,_f=reactExports.useRef(new Promise(function(h_,I_){_p=h_,console.log(I_)})),e_=useClient();Vt.customRtcClient&&(e_.removeAllListeners(),e_=Vt.customRtcClient);var u_=!1,w_=!1,O_=reactExports.useRef({}),y_=o.callActive;y_===void 0&&(y_=!0);var Z_=reactExports.useReducer(reducer,initState),NE=Z_[0],i_=Z_[1];reactExports.useEffect(function(){var h_=function(){try{try{if(console.log(e_),e_.on("user-joined",function(){try{for(var v_=arguments.length,M_=new Array(v_),R_=0;R_<v_;R_++)M_[R_]=arguments[R_];var X_=M_[0];return X_.uid===o.screenshareUid&&_.current||X_.uid===1&&_.current||(O_.current[X_.uid]={}),i_({type:"user-joined",value:M_}),Promise.resolve()}catch(q_){return Promise.reject(q_)}}),e_.on("user-published",function(){for(var v_=arguments.length,M_=new Array(v_),R_=0;R_<v_;R_++)M_[R_]=arguments[R_];try{var X_=M_[0],q_=M_[1];return console.log("user-published",X_.uid),X_.uid===o.screenshareUid&&_.current||X_.uid===1&&_.current?i_({type:"user-published",value:M_}):e_.subscribe(X_,q_).then(function(lE){if(O_.current[X_.uid][q_+"Track"]=X_[q_+"Track"],q_==="audio"){var Lb;(Lb=X_.audioTrack)===null||Lb===void 0||Lb.play()}else Vt.enableDualStream&&Vt.dualStreamMode&&e_.setStreamFallbackOption(X_.uid,Vt.dualStreamMode);i_({type:"user-published",value:M_})}).catch(function(lE){return console.log(lE)}),Promise.resolve()}catch(lE){return Promise.reject(lE)}}),e_.on("user-unpublished",function(){try{for(var v_=arguments.length,M_=new Array(v_),R_=0;R_<v_;R_++)M_[R_]=arguments[R_];var X_=M_[0],q_=M_[1];if(console.log("user-unpublished",X_.uid),q_==="audio"){var lE;(lE=X_.audioTrack)===null||lE===void 0||lE.stop()}return i_({type:"user-unpublished",value:M_}),Promise.resolve()}catch(Lb){return Promise.reject(Lb)}}),e_.on("connection-state-change",function(){try{for(var v_=arguments.length,M_=new Array(v_),R_=0;R_<v_;R_++)M_[R_]=arguments[R_];var X_=M_[0],q_=M_[1],lE=M_[2];if(console.log("connection",q_,X_,lE),X_==="CONNECTED")_h(!0);else if(X_==="DISCONNECTED"){try{stopScreenshare(),_.current=!1}catch(Lb){console.log("stopscreenshare",Lb)}i_({type:"leave-channel",value:null})}else _h(!1);return Promise.resolve()}catch(Lb){return Promise.reject(Lb)}}),e_.on("user-left",function(){for(var v_=arguments.length,M_=new Array(v_),R_=0;R_<v_;R_++)M_[R_]=arguments[R_];i_({type:"user-left",value:M_})}),Vt.tokenUrl){var vf=Vt.tokenUrl,o_=Vt.channel,d_=Vt.uid;e_.on("token-privilege-will-expire",function(){try{return console.log("token will expire"),Promise.resolve(fetch(vf+"/rtc/"+o_+"/publisher/uid/"+(d_||0)+"/")).then(function(v_){return Promise.resolve(v_.json()).then(function(M_){var R_=M_.rtcToken;e_.renewToken(R_)})})}catch(v_){return Promise.reject(v_)}}),e_.on("token-privilege-did-expire",function(){try{return Promise.resolve(fetch(vf+"/rtc/"+o_+"/publisher/uid/"+(d_||0)+"/")).then(function(v_){return Promise.resolve(v_.json()).then(function(M_){var R_=M_.rtcToken;e_.renewToken(R_)})})}catch(v_){return Promise.reject(v_)}})}if(z){var g_=Object.keys(z);g_.map(function(v_){try{e_.on(v_,function(){for(var M_=arguments.length,R_=new Array(M_),X_=0;X_<M_;X_++)R_[X_]=arguments[X_];z[v_].apply(null,R_)})}catch(M_){console.log(M_)}})}_p(!0),_o(!0)}catch(v_){console.log("!!!",v_)}return Promise.resolve()}catch(v_){return Promise.reject(v_)}};return _p?(h_(),function(){try{e_.removeAllListeners()}catch(I_){console.log(I_)}}):function(){}},[Vt.appId]),reactExports.useEffect(function(){var h_=function(){try{return Promise.resolve(_f.current).then(function(){var o_=Vt.tokenUrl,d_=Vt.channel,g_=Vt.uid,v_=Vt.appId,M_=Vt.token,R_=function(){if(e_&&!I_){Vt.role==="audience"?e_.setClientRole(Vt.role):e_.setClientRole("host");var X_=function(){if(o_){var q_=_catch(function(){return Promise.resolve(fetch(o_+"/rtc/"+d_+"/publisher/uid/"+(g_||0)+"/")).then(function(lE){return Promise.resolve(lE.json()).then(function(Lb){var vS=Lb.rtcToken;return Promise.resolve(e_.join(v_,d_,vS,g_||0)).then(function(jT){l.current=jT})})})},function(lE){console.log(lE)});if(q_&&q_.then)return q_.then(function(){})}else return Promise.resolve(e_.join(v_,d_,M_||null,g_||0)).then(function(lE){l.current=lE})}();if(X_&&X_.then)return X_.then(function(){})}else console.error("trying to join before RTC Engine was initialized")}();if(R_&&R_.then)return R_.then(function(){})})}catch(o_){return Promise.reject(o_)}},I_=!1;return y_?(h_(),console.log("Attempted join: ",Vt.channel)):console.log("In precall - waiting to join"),function(){if(I_=!0,y_){console.log("Leaving channel");try{stopScreenshare(),_.current=!1}catch(vf){console.log(vf)}_f.current=e_.leave().catch(function(vf){return console.log(vf)})}}},[Vt.channel,Vt.uid,y_,Vt.tokenUrl]),reactExports.useEffect(function(){var h_=function(){try{var vf=function(){function g_(){var M_=function(){if(k!=null&&k.enabled&&_d){var R_=function(){if(!u_)return Promise.resolve(e_.publish([k]).then(function(){u_=!0})).then(function(){})}();if(R_&&R_.then)return R_.then(function(){})}}();if(M_&&M_.then)return M_.then(function(){})}var v_=function(){if(j!=null&&j.enabled&&_d){var M_=function(){if(!w_)return Promise.resolve(e_.publish([j]).then(function(){w_=!0})).then(function(){})}();if(M_&&M_.then)return M_.then(function(){})}}();return v_&&v_.then?v_.then(g_):g_(v_)},o_=function(){if(Vt.enableDualStream)return Promise.resolve(e_.enableDualStream()).then(function(){})}();return Promise.resolve(o_&&o_.then?o_.then(vf):vf(o_))}catch(d_){return Promise.reject(d_)}};console.log("Publish",k,j,y_),y_&&h_()},[y_,k==null?void 0:k.enabled,j==null?void 0:j.enabled,_d]),reactExports.useEffect(function(){k&&j!==null&&(O_.current[0]={audioTrack:j,videoTrack:k},i_({type:"update-user-video",value:[j,k]}))},[Vt.channel,_d]),reactExports.useEffect(function(){_d&&Vt.token&&e_.renewToken(Vt.token).then(function(h_){return console.log("renewed token",h_)})},[Vt.token,_d]),reactExports.useEffect(function(){Vt.role&&e_.setClientRole(Vt.role).then(function(h_){return console.log("changed role",h_)})},[Vt.role,_d]),reactExports.useEffect(function(){var h_=function(){try{var vf=function(){if(Vt.activeSpeaker&&Vt.layout!==layout.grid)return e_.on("volume-indicator",function(o_){var d_=o_.reduce(function(M_,R_){return M_===null||R_.level>M_.level?R_:M_},null),g_=d_?d_.uid:void 0,v_=g_===l.current?0:g_;g_!==void 0&&i_({type:"ActiveSpeaker",value:[v_]})}),Promise.resolve(e_.enableAudioVolumeIndicator()).then(function(){})}();return Promise.resolve(vf&&vf.then?vf.then(function(){}):void 0)}catch(o_){return Promise.reject(o_)}};return y_&&h_(),function(){e_.removeAllListeners("volume-indicator")}},[Vt.activeSpeaker,Vt.layout]);var S_=function(){try{var I_=function(){try{return i_({type:"Screensharing",value:[!0]}),Promise.resolve(AgoraRTC__default.createScreenVideoTrack({},"disable")).then(function(d_){p.current=d_;var g_=Vt.screenshareUid||1;return O_.current[g_]={videoTrack:p.current},p.current.on("track-ended",function(){_.current=!1,i_({type:"Screensharing",value:[!1]})}),_.current=!0,Promise.resolve(startScreenshare(Vt.appId,Vt.channel,p.current,Vt.screenshareToken,Vt.screenshareUid,Vt.tokenUrl,Vt.enableDualStream)).then(function(){})})}catch(d_){return Promise.reject(d_)}},vf=function(){stopScreenshare(),_.current=!1};return _.current?vf():I_(),Promise.resolve()}catch(o_){return Promise.reject(o_)}};return React.createElement(RtcProvider,{value:{client:e_,mediaStore:O_.current,localVideoTrack:k,localAudioTrack:j,dispatch:i_,localUid:l,channelJoined:_d,toggleScreensharing:S_,isScreensharing:_.current}},React.createElement(MaxUidProvider,{value:NE.max},React.createElement(MinUidProvider,{value:NE.min},_n?o.children:null)))},icons={videocam:React.createElement(React.Fragment,null,React.createElement("polygon",{points:"23 7 16 12 23 17 23 7"}),React.createElement("rect",{x:"1",y:"5",width:"15",height:"14",rx:"2",ry:"2"})),videocamOff:React.createElement(React.Fragment,null,React.createElement("path",{d:"M16 16v1a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2m5.66 0H14a2 2 0 0 1 2 2v3.34l1 1L23 7v10"}),React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"})),remoteSwap:React.createElement(React.Fragment,null,React.createElement("polyline",{points:"15 3 21 3 21 9"}),React.createElement("polyline",{points:"9 21 3 21 3 15"}),React.createElement("line",{x1:"21",y1:"3",x2:"14",y2:"10"}),React.createElement("line",{x1:"3",y1:"21",x2:"10",y2:"14"})),callEnd:React.createElement(React.Fragment,null,React.createElement("path",{d:"M10.68 13.31a16 16 0 0 0 3.41 2.6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7 2 2 0 0 1 1.72 2v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.42 19.42 0 0 1-3.33-2.67m-2.67-3.34a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91"}),React.createElement("line",{x1:"23",y1:"1",x2:"1",y2:"23"})),mic:React.createElement(React.Fragment,null,React.createElement("path",{d:"M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"}),React.createElement("path",{d:"M19 10v2a7 7 0 0 1-14 0v-2"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),micOff:React.createElement(React.Fragment,null,React.createElement("line",{x1:"1",y1:"1",x2:"23",y2:"23"}),React.createElement("path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12M15 9.34V4a3 3 0 0 0-5.94-.6"}),React.createElement("path",{d:"M17 16.95A7 7 0 0 1 5 12v-2m14 0v2a7 7 0 0 1-.11 1.23"}),React.createElement("line",{x1:"12",y1:"19",x2:"12",y2:"23"}),React.createElement("line",{x1:"8",y1:"23",x2:"16",y2:"23"})),screen:React.createElement(React.Fragment,null,React.createElement("rect",{x:"2",y:"3",width:"20",height:"14",rx:"2",ry:"2"}),React.createElement("line",{x1:"8",y1:"21",x2:"16",y2:"21"}),React.createElement("line",{x1:"12",y1:"17",x2:"12",y2:"21"})),stop:React.createElement(React.Fragment,null,React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))},BtnTemplate=function s(o){var l=o.onClick,p=o.name,_=o.disabled,A=o.style,k=reactExports.useContext(PropsContext),j=k.styleProps,B=j||{},z=B.theme,Vt=B.BtnTemplateStyles,_e=B.iconSize,_n=B.customIcon;return React.createElement("div",{style:_extends({},{width:35,height:35,borderRadius:"100%",borderWidth:2,borderStyle:"solid",borderColor:"#fff",backgroundColor:"rgba(0,80,180,0.2)",alignItems:"center",justifyContent:"center",display:"flex",cursor:_?"auto":"pointer",margin:4},Vt,A),onClick:l},_n?React.createElement("img",{src:_n[p],alt:p}):React.createElement("svg",{style:{width:_e||24,height:_e||24},xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",opacity:_?"0.5":"1",stroke:z||"#fff",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"},icons[p]))};function EndCall(){var s=reactExports.useContext(PropsContext),o=s.styleProps,l=s.callbacks,p=o||{},_=p.localBtnStyles,A=_||{},k=A.endCall;return React.createElement(BtnTemplate,{style:k||{backgroundColor:"#ef5588",borderColor:"#f00"},name:"callEnd",onClick:function(){return(l==null?void 0:l.EndCall)&&l.EndCall()}})}var LocalContext=reactExports.createContext({}),LocalUserContext=function s(o){var l=reactExports.useContext(MaxUidContext),p=reactExports.useContext(MinUidContext),_;return l[0].uid===0?_=l[0]:_=p.find(function(A){return A.uid===0}),React.createElement(LocalContext.Provider,{value:_},o.children)},muteAudio=function(s,o,l,p){try{var _=function(){if(s.uid===0){var A=s.hasAudio,k=function(){if(A===ToggleState.enabled||A===ToggleState.disabled){var j=A===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;o({type:"local-user-mute-audio",value:[j]}),p&&p["local-user-mute-audio"]&&p["local-user-mute-audio"](j);var B=_catch(function(){return Promise.resolve(l==null?void 0:l.setEnabled(A!==ToggleState.enabled)).then(function(){j=A===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,p&&p["local-user-mute-audio"]&&p["local-user-mute-audio"](j),o({type:"local-user-mute-audio",value:[A===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled]})})},function(){o({type:"local-user-mute-audio",value:[A]})});if(B&&B.then)return B.then(function(){})}}();if(k&&k.then)return k.then(function(){})}}();return Promise.resolve(_&&_.then?_.then(function(){}):void 0)}catch(A){return Promise.reject(A)}};function LocalAudioMute(){var s=reactExports.useContext(PropsContext),o=s.styleProps,l=s.callbacks,p=o||{},_=p.localBtnStyles,A=_||{},k=A.muteLocalAudio,j=reactExports.useContext(RtcContext),B=j.dispatch,z=j.localAudioTrack,Vt=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:k,name:Vt.hasAudio===ToggleState.enabled?"mic":"micOff",onClick:function(){return z&&muteAudio(Vt,B,z,l)}}))}function Screenshare(){var s=reactExports.useContext(PropsContext),o=s.styleProps,l=o||{},p=l.localBtnStyles,_=p||{},A=_.screenshare,k=reactExports.useContext(RtcContext),j=k.toggleScreensharing,B=k.isScreensharing;return React.createElement("div",null,React.createElement(BtnTemplate,{style:A,name:B?"stop":"screen",onClick:function(){return j()}}))}var muteVideo=function(s,o,l,p){try{var _=function(){if(s.uid===0){var A=s.hasVideo,k=function(){if(A===ToggleState.enabled||A===ToggleState.disabled){var j=A===ToggleState.enabled?ToggleState.disabling:ToggleState.enabling;o({type:"local-user-mute-video",value:[j]}),p&&p["local-user-mute-video"]&&p["local-user-mute-video"](j);var B=_catch(function(){return Promise.resolve(l==null?void 0:l.setEnabled(A!==ToggleState.enabled)).then(function(){j=A===ToggleState.enabled?ToggleState.disabled:ToggleState.enabled,p&&p["local-user-mute-video"]&&p["local-user-mute-video"](j),o({type:"local-user-mute-video",value:[j]})})},function(){o({type:"local-user-mute-video",value:[A]})});if(B&&B.then)return B.then(function(){})}}();if(k&&k.then)return k.then(function(){})}}();return Promise.resolve(_&&_.then?_.then(function(){}):void 0)}catch(A){return Promise.reject(A)}};function LocalVideoMute(){var s=reactExports.useContext(PropsContext),o=s.styleProps,l=s.callbacks,p=o||{},_=p.localBtnStyles,A=_||{},k=A.muteLocalVideo,j=reactExports.useContext(RtcContext),B=j.dispatch,z=j.localVideoTrack,Vt=reactExports.useContext(LocalContext);return React.createElement("div",null,React.createElement(BtnTemplate,{style:k,name:Vt.hasVideo===ToggleState.enabled?"videocam":"videocamOff",onClick:function(){return z&&muteVideo(Vt,B,z,l)}}))}function LocalControls(){var s=reactExports.useContext(PropsContext),o=s.styleProps,l=s.rtcProps,p=o||{},_=p.localBtnContainer;return React.createElement("div",{style:_extends({},{backgroundColor:"#007bff",width:"100%",height:70,zIndex:10,display:"flex",flexDirection:"row",justifyContent:"space-evenly",alignItems:"center"},_)},l.role!=="audience"&&React.createElement(LocalVideoMute,null),l.role!=="audience"&&React.createElement(LocalAudioMute,null),l.role!=="audience"&&l.enableScreensharing&&React.createElement(Screenshare,null),React.createElement(EndCall,null))}var rtmStatusEnum;(function(s){s[s.initFailed=0]="initFailed",s[s.offline=1]="offline",s[s.initialising=2]="initialising",s[s.loggingIn=3]="loggingIn",s[s.loggedIn=4]="loggedIn",s[s.connected=5]="connected",s[s.loginFailed=6]="loginFailed"})(rtmStatusEnum||(rtmStatusEnum={}));var clientRoleRaw;(function(s){s[s.broadcaster=0]="broadcaster",s[s.audience=1]="audience"})(clientRoleRaw||(clientRoleRaw={}));var mutingDevice;(function(s){s[s.camera=0]="camera",s[s.microphone=1]="microphone"})(mutingDevice||(mutingDevice={}));var popUpStateEnum;(function(s){s[s.closed=0]="closed",s[s.muteMic=1]="muteMic",s[s.muteCamera=2]="muteCamera",s[s.unmuteMic=3]="unmuteMic",s[s.unmuteCamera=4]="unmuteCamera"})(popUpStateEnum||(popUpStateEnum={}));var RtmContext=reactExports.createContext(null),RtmProvider=RtmContext.Provider;RtmContext.Consumer;function RemoteVideoMute(s){var o=reactExports.useContext(PropsContext),l=o.styleProps,p=reactExports.useContext(RtmContext),_=p.sendMuteRequest,A=p.uidMap,k=l||{},j=k.remoteBtnStyles,B=j||{},z=B.muteRemoteVideo,Vt=s.UIKitUser,_e=Vt.hasVideo===remoteTrackState.no;return Vt.uid!==0&&A[Vt.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{name:Vt.hasVideo===remoteTrackState.subbed?"videocam":"videocamOff",style:z,onClick:function(){return _(mutingDevice.camera,Vt.uid,!_e)}})):null}function RemoteAudioMute(s){var o=reactExports.useContext(PropsContext),l=o.styleProps,p=l||{},_=p.remoteBtnStyles,A=reactExports.useContext(RtmContext),k=A.sendMuteRequest,j=A.uidMap,B=_||{},z=B.muteRemoteAudio,Vt=s.UIKitUser,_e=Vt.hasAudio===remoteTrackState.no;return Vt.uid!==0&&j[Vt.uid]?React.createElement("div",null,React.createElement(BtnTemplate,{style:z,name:Vt.hasAudio===remoteTrackState.subbed?"mic":"micOff",onClick:function(){return k(mutingDevice.microphone,Vt.uid,!_e)}})):null}function SwapUser(s){var o=reactExports.useContext(RtcContext),l=o.dispatch,p=s.UIKitUser;return React.createElement("div",null,React.createElement(BtnTemplate,{name:"remoteSwap",onClick:function(){return l({type:"user-swap",value:[p]})}}))}var VideoPlaceholder=function s(o){var l=reactExports.useContext(PropsContext),p=l.styleProps,_=l.rtcProps,A=p||{},k=A.maxViewStyles,j=A.maxViewOverlayContainer,B=o.user,z=_.CustomVideoPlaceholder;return z?z&&z(_extends({},o),null):React.createElement("div",{key:B.uid,style:_extends({},style.max,k)},React.createElement("div",{style:style.imgContainer},React.createElement("img",{style:style.img,src:"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiBzdHJva2U9ImN1cnJlbnRDb2xvciIgc3Ryb2tlLXdpZHRoPSIyIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiIGNsYXNzPSJmZWF0aGVyIGZlYXRoZXItdXNlciI+PHBhdGggZD0iTTIwIDIxdi0yYTQgNCAwIDAgMC00LTRIOGE0IDQgMCAwIDAtNCA0djIiPjwvcGF0aD48Y2lyY2xlIGN4PSIxMiIgY3k9IjciIHI9IjQiPjwvY2lyY2xlPjwvc3ZnPg=="})),o.isShown&&React.createElement("div",{style:_extends({},style.btnContainer,j)},o.showButtons&&React.createElement(React.Fragment,null,!_.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:B}),!_.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:B}),o.showSwap&&React.createElement(SwapUser,{UIKitUser:B}))))},style={max:{flex:1,display:"flex",backgroundColor:"#007bff33",flexDirection:"row",position:"relative"},imgContainer:{flex:10,display:"flex",justifyContent:"center"},img:{width:100,height:100,position:"absolute",alignSelf:"center",justifySelf:"center",margin:"auto",display:"flex"},btnContainer:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},Username=function s(o){var l=reactExports.useContext(RtmContext),p=l.usernames,_=reactExports.useContext(PropsContext),A=_.rtmProps,k=_.styleProps,j=o.user;return A!=null&&A.displayUsername?React.createElement("p",{style:_extends({},styles.username,k==null?void 0:k.usernameText)},j.uid===1?"Screenshare":p[j.uid]):React.createElement(React.Fragment,null)},styles={username:{position:"absolute",background:"#007bffaa",padding:"2px 8px",color:"#fff",margin:0,bottom:0,right:0,zIndex:90}},MaxVideoView=function s(o){var l=reactExports.useContext(RtcContext),p=l.mediaStore,_=reactExports.useContext(PropsContext),A=_.styleProps,k=_.rtcProps,j=A||{},B=j.maxViewStyles,z=j.videoMode,Vt=j.maxViewOverlayContainer,_e=z==null?void 0:z.max,_n=reactExports.useState(!1),_o=_n[0],_c=_n[1],_d=o.user;return React.createElement("div",{style:_extends({},styles$1.container,o.style,B),onMouseEnter:function(){return _c(!0)},onMouseLeave:function(){return _c(!1)}},_d.hasVideo===1?React.createElement("div",{style:styles$1.videoContainer},!k.disableRtm&&React.createElement(Username,{user:_d}),React.createElement(AgoraVideoPlayer,{style:styles$1.videoplayer,config:{fit:_e||"cover"},videoTrack:p[_d.uid].videoTrack}),_o&&React.createElement("div",{style:_extends({},styles$1.overlay,Vt)},!k.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:_d}),!k.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:_d}))):React.createElement("div",{style:styles$1.videoContainer},!k.disableRtm&&React.createElement(Username,{user:_d}),React.createElement(VideoPlaceholder,{user:_d,isShown:_o,showButtons:!0})))},styles$1={container:{display:"flex",flex:1},videoContainer:{display:"flex",flex:1,position:"relative"},videoplayer:{width:"100%",display:"flex",flex:1},overlay:{position:"absolute",margin:5,flexDirection:"column",display:"flex"}},MinVideoView=function s(o){var l=reactExports.useContext(RtcContext),p=l.mediaStore,_=reactExports.useContext(PropsContext),A=_.styleProps,k=_.rtcProps,j=A||{},B=j.minViewStyles,z=j.videoMode,Vt=j.minViewOverlayContainer,_e=z==null?void 0:z.min,_n=reactExports.useState(!1),_o=_n[0],_c=_n[1],_d=o.user;return React.createElement("div",{style:_extends({},{display:"flex",flex:1},B),onMouseEnter:function(){return _c(!0)},onMouseLeave:function(){return _c(!1)}},_d.hasVideo===1?React.createElement("div",{style:_extends({},{display:"flex",flex:1,position:"relative"})},React.createElement(AgoraVideoPlayer,{style:{flex:10,display:"flex"},config:{fit:_e!==void 0?_e:"cover"},videoTrack:p[_d.uid].videoTrack}),_o&&React.createElement("div",{style:_extends({},{margin:4,position:"absolute",flex:1,display:"flex",flexDirection:"column"},Vt)},!k.disableRtm&&React.createElement(RemoteVideoMute,{UIKitUser:_d}),!k.disableRtm&&React.createElement(RemoteAudioMute,{UIKitUser:_d}),React.createElement(SwapUser,{UIKitUser:_d}))):React.createElement(VideoPlaceholder,{user:_d,isShown:_o,showButtons:!0,showSwap:!0}))},styles$2={scrollbar:"_3Sxu7"},PinnedVideo=function s(){var o=reactExports.useContext(PropsContext),l=o.styleProps,p=o.rtcProps,_=l||{},A=_.minViewContainer,k=_.pinnedVideoContainer,j=_.maxViewContainer,B=_.scrollViewContainer,z=reactExports.useRef(null),Vt=reactExports.useState(0),_e=Vt[0],_n=Vt[1],_o=reactExports.useState(0),_c=_o[0],_d=_o[1],_h=_e>_c;return reactExports.useEffect(function(){var _p=function(){z.current&&(_n(z.current.offsetWidth),_d(z.current.offsetHeight))};return window.addEventListener("resize",_p),z.current&&(_n(z.current.offsetWidth),_d(z.current.offsetHeight)),function(){window.removeEventListener("resize",_p)}},[]),React.createElement("div",{ref:z,style:_extends({},{display:"flex",flex:1,flexDirection:_h?"row":"column-reverse",overflow:"hidden"},k)},React.createElement("div",{style:_extends({},{display:"flex",flex:_h?5:4},j)},React.createElement(MaxUidConsumer,null,function(_p){return p.role==="audience"&&_p[0].uid===0?null:React.createElement(MaxVideoView,{user:_p[0]})})),React.createElement("div",{className:styles$2.scrollbar,style:_extends({},{overflowY:_h?"scroll":"hidden",overflowX:_h?"hidden":"scroll",display:"flex",flex:1,flexDirection:_h?"column":"row"},B)},React.createElement(MinUidConsumer,null,function(_p){return _p.map(function(_f){return p.role==="audience"&&_f.uid===0?null:React.createElement("div",{style:_extends({},{minHeight:_h?"35vh":"99%",minWidth:_h?"99%":"40vw",margin:2,display:"flex"},A),key:_f.uid},React.createElement(MinVideoView,{user:_f}))})})))},GridVideo=function s(){var o=reactExports.useContext(PropsContext),l=o.styleProps,p=o.rtcProps,_=l||{},A=_.gridVideoCells,k=_.gridVideoContainer,j=reactExports.useContext(MaxUidContext),B=reactExports.useContext(MinUidContext),z=p.role==="audience"?[].concat(j,B).filter(function(e_){return e_.uid!==0}):[].concat(j,B),Vt=reactExports.useRef(null),_e=reactExports.useState(window.innerWidth),_n=_e[0],_o=_e[1],_c=reactExports.useState(window.innerHeight),_d=_c[0],_h=_c[1],_p=_n>_d,_f="minmax(0, 1fr) ";return reactExports.useEffect(function(){var e_=function(){Vt.current&&(_o(Vt.current.offsetWidth),_h(Vt.current.offsetHeight))};return window.addEventListener("resize",e_),Vt.current&&(_o(Vt.current.offsetWidth),_h(Vt.current.offsetHeight)),function(){window.removeEventListener("resize",e_)}},[]),React.createElement("div",{ref:Vt,style:_extends({},{width:"100%",height:"100%",display:"grid",gridTemplateColumns:_p?z.length>9?_f.repeat(4):z.length>4?_f.repeat(3):z.length>1?_f.repeat(2):_f:z.length>8?_f.repeat(3):z.length>2?_f.repeat(2):_f},k)},z.map(function(e_){return React.createElement(MaxVideoView,{user:e_,style:_extends({},{height:"100%",width:"100%"},A),key:e_.uid})}))},useTracks=createMicrophoneAndCameraTracks({encoderConfig:{}},{encoderConfig:{}}),TracksConfigure=function s(o){var l=reactExports.useState(!1),p=l[0],_=l[1],A=reactExports.useState(null),k=A[0],j=A[1],B=reactExports.useState(null),z=B[0],Vt=B[1],_e=useTracks(),_n=_e.ready,_o=_e.tracks,_c=_e.error,_d=reactExports.useRef({});return reactExports.useEffect(function(){return _o!==null?(Vt(_o[0]),j(_o[1]),_d.current[0]={audioTrack:_o[0],videoTrack:_o[1]},_(!0)):_c&&(console.error(_c),_(!1)),function(){if(_o){var _h,_p;(_h=_o[0])===null||_h===void 0||_h.close(),(_p=_o[1])===null||_p===void 0||_p.close()}}},[_n,_c]),React.createElement(TracksProvider,{value:{localVideoTrack:k,localAudioTrack:z}},p?o.children:null)},timeNow=function s(){return new Date().getTime()},useChannel=createLazyChannel(),useClient$1=createLazyClient(),RtmConfigure=function s(o){var l=reactExports.useContext(PropsContext),p=l.rtcProps,_=l.rtmProps,A=reactExports.useState(!1),k=A[0],j=A[1],B=useClient$1(p.appId),z=useChannel(B,p.channel),Vt=reactExports.useRef(""),_e=reactExports.useRef(5),_n=reactExports.useContext(LocalContext),_o=reactExports.useContext(PropsContext),_c=_o.rtmCallbacks,_d=reactExports.useState({}),_h=_d[0],_p=_d[1],_f=reactExports.useState({}),e_=_f[0],u_=_f[1],w_=reactExports.useState({}),O_=w_[0],y_=w_[1],Z_=reactExports.useState(popUpStateEnum.closed),NE=Z_[0],i_=Z_[1],S_=reactExports.useState(rtmStatusEnum.offline),h_=S_[0],I_=S_[1],vf=reactExports.useContext(RtcContext),o_=vf.localUid,d_=vf.localAudioTrack,g_=vf.localVideoTrack,v_=vf.dispatch,M_=vf.channelJoined,R_=function hS(){try{var vE=p.tokenUrl,Eg=function(){if(vE){var z_=_catch(function(){return Promise.resolve(fetch(vE+"/rtm/"+((_==null?void 0:_.uid)||Vt.current))).then(function(UE){return Promise.resolve(UE.json()).then(function(bS){var J0=bS.rtmToken;return Promise.resolve(B.login({uid:(_==null?void 0:_.uid)||Vt.current,token:J0})).then(function(){_e.current=5})})})},function(){setTimeout(function(){try{return _e.current=_e.current+_e.current,hS(),Promise.resolve()}catch(UE){return Promise.reject(UE)}},_e.current*1e3)});if(z_&&z_.then)return z_.then(function(){})}else{var YE=_catch(function(){return Promise.resolve(B.login({uid:(_==null?void 0:_.uid)||Vt.current,token:(_==null?void 0:_.token)||void 0})).then(function(){_e.current=5})},function(){setTimeout(function(){try{return _e.current=_e.current+_e.current,hS(),Promise.resolve()}catch(UE){return Promise.reject(UE)}},_e.current*1e3)});if(YE&&YE.then)return YE.then(function(){})}}();return Promise.resolve(Eg&&Eg.then?Eg.then(function(){}):void 0)}catch(z_){return Promise.reject(z_)}},X_=function hS(){try{var vE=_catch(function(){return Promise.resolve(z.join()).then(function(){_e.current=5})},function(){setTimeout(function(){try{return _e.current=_e.current+_e.current,hS(),Promise.resolve()}catch(Eg){return Promise.reject(Eg)}},_e.current*1e3)});return Promise.resolve(vE&&vE.then?vE.then(function(){}):void 0)}catch(Eg){return Promise.reject(Eg)}},q_=function(){try{if(I_(rtmStatusEnum.initialising),p.uid?Vt.current=String(p.uid):Vt.current=String(timeNow()),B.on("ConnectionStateChanged",function(z_,YE){console.log(z_,YE)}),B.on("TokenExpired",function(){try{var z_=p.tokenUrl;console.log("token expired - renewing");var YE=function(){if(z_){var UE=_catch(function(){return Promise.resolve(fetch(z_+"/rtm/"+((_==null?void 0:_.uid)||Vt.current))).then(function(bS){return Promise.resolve(bS.json()).then(function(J0){var eN=J0.rtmToken;return Promise.resolve(B.renewToken(eN)).then(function(){_e.current=5})})})},function(bS){console.error("TokenExpiredError",bS)});if(UE&&UE.then)return UE.then(function(){})}}();return Promise.resolve(YE&&YE.then?YE.then(function(){}):void 0)}catch(UE){return Promise.reject(UE)}}),B.on("MessageFromPeer",function(z_,YE){vS(z_,YE)}),z.on("ChannelMessage",function(z_,YE){vS(z_,YE)}),z.on("MemberJoined",function(z_){try{return Promise.resolve(Y0(lE(),z_)).then(function(){})}catch(YE){return Promise.reject(YE)}}),z.on("MemberCountUpdated",function(z_){try{return console.log("RTM-MemberCountUpdated: ",z_),Promise.resolve()}catch(YE){return Promise.reject(YE)}}),_c!=null&&_c.channel?Object.keys(_c.channel).map(function(z_){_c.channel&&z.on(z_,_c.channel[z_])}):_c!=null&&_c.client&&Object.keys(_c.client).map(function(z_){_c.client&&B.on(z_,_c.client[z_])}),p.tokenUrl){var vE=p.tokenUrl,Eg=p.uid;B.on("TokenExpired",function(){try{return console.log("token expired"),Promise.resolve(fetch(vE+"/rtm/"+(Eg||0)+"/")).then(function(z_){return Promise.resolve(z_.json()).then(function(YE){var UE=YE.rtmToken;B.renewToken(UE)})})}catch(z_){return Promise.reject(z_)}})}return I_(rtmStatusEnum.loggingIn),Promise.resolve(R_()).then(function(){return I_(rtmStatusEnum.loggedIn),Promise.resolve(X_()).then(function(){I_(rtmStatusEnum.connected),u_(function(z_){return _extends({},z_,{0:_==null?void 0:_.username})}),z0(lE())})})}catch(z_){return Promise.reject(z_)}},lE=function(){return{messageType:"UserData",rtmId:(_==null?void 0:_.uid)||Vt.current,rtcId:o_.current,username:_==null?void 0:_.username,role:p.role==="audience"?1:0,uikit:{platform:"web",framework:"react",version:"1.2.0"},agora:{rtm:AgoraRTM__default.VERSION,rtc:AgoraRTC__default.VERSION}}},Lb=function(vE,Eg,z_){var YE=(_==null?void 0:_.showPopUpBeforeRemoteMute)===!1,UE={messageType:"MuteRequest",device:vE,rtcId:Eg,mute:z_,isForceful:YE},bS=_h[Eg];YE&&!z_?console.log("cannot send force unmute request"):bS?Y0(UE,bS):console.log("peer not found")},vS=function(vE,Eg){var z_;if(vE.messageType==="RAW"?z_=parsePayload(vE.rawMessage):vE.messageType==="TEXT"&&(z_=JSON.parse(vE.text)),console.log(z_,Eg),z_)switch(z_.messageType){case"UserData":jT(z_);break;case"MuteRequest":tN(z_);break;case"RtmDataRequest":switch(z_.type){case"ping":z1(Eg);break;case"userData":UI(Eg);break;default:console.log(Eg)}break;default:console.log("unknown message content")}else console.log("unknown rtm message type")},jT=function(vE){_p(function(Eg){var z_;return _extends({},Eg,(z_={},z_[vE.rtcId]=vE.rtmId,z_))}),u_(function(Eg){var z_;return _extends({},Eg,(z_={},z_[vE.rtcId]=vE.username,z_))}),y_(function(Eg){var z_;return _extends({},Eg,(z_={},z_[vE.rtmId]=vE,z_))})},tN=function(vE){o_.current===vE.rtcId&&(vE.isForceful?vE.mute?vE.device===mutingDevice.microphone?d_&&muteAudio(_n,v_,d_):vE.device===mutingDevice.camera&&g_&&muteVideo(_n,v_,g_):console.error("cannot force unmute"):vE.device===mutingDevice.microphone?vE.mute?i_(popUpStateEnum.muteMic):i_(popUpStateEnum.unmuteMic):vE.device===mutingDevice.camera&&(vE.mute?i_(popUpStateEnum.muteCamera):i_(popUpStateEnum.unmuteCamera)))},z1=function(vE){Y0({messageType:"RtmDataRequest",type:"pong"},vE)},UI=function(vE){Y0(lE(),vE)},z0=function(vE){try{var Eg=B.createMessage({text:JSON.stringify(vE),messageType:AgoraRTM__default.MessageType.TEXT}),z_=_catch(function(){return Promise.resolve(z.sendMessage(Eg)).then(function(){})},function(YE){console.error(YE)});return Promise.resolve(z_&&z_.then?z_.then(function(){}):void 0)}catch(YE){return Promise.reject(YE)}},Y0=function(vE,Eg){try{var z_=B.createMessage({text:JSON.stringify(vE),messageType:AgoraRTM__default.MessageType.TEXT}),YE=_catch(function(){return Promise.resolve(B.sendMessageToPeer(z_,String(Eg))).then(function(){})},function(UE){console.error(UE)});return Promise.resolve(YE&&YE.then?YE.then(function(){}):void 0)}catch(UE){return Promise.reject(UE)}},Y1=function(){try{return Promise.resolve(B.logout()).then(function(){return Promise.resolve(B.removeAllListeners()).then(function(){})})}catch(vE){return Promise.reject(vE)}};return reactExports.useEffect(function(){return M_&&(q_(),j(!0)),function(){M_&&Y1()}},[p.channel,p.appId,M_]),React.createElement(RtmProvider,{value:{rtmStatus:h_,sendPeerMessage:Y0,sendChannelMessage:z0,sendMuteRequest:Lb,rtmClient:B,uidMap:_h,usernames:e_,userDataMap:O_,popUpState:NE,setPopUpState:i_}},k?o.children:React.createElement(React.Fragment,null))};new TextEncoder;var dec=new TextDecoder,parsePayload=function s(o){return JSON.parse(dec.decode(o))};function PopUp(){var s=reactExports.useContext(PropsContext),o=s.styleProps,l=reactExports.useContext(RtmContext),p=l.popUpState,_=l.setPopUpState,A=o||{},k=A.popUpContainer,j=reactExports.useContext(RtcContext),B=j.dispatch,z=j.localVideoTrack,Vt=j.localAudioTrack,_e=reactExports.useContext(LocalContext);return p!==popUpStateEnum.closed?React.createElement("div",{style:_extends({},styles$3.container,k)},React.createElement("div",{style:{color:"#fff",fontSize:18,fontWeight:700}},p===popUpStateEnum.muteCamera||p===popUpStateEnum.muteMic?"Mute ":"Unmute ",p===popUpStateEnum.muteCamera||p===popUpStateEnum.unmuteCamera?"Camera":"Mic","?"),React.createElement("div",{style:{flexDirection:"row",display:"flex",width:"100%",justifyContent:"space-around"}},React.createElement("div",{onClick:function(){switch(p){case popUpStateEnum.muteCamera:_e.hasVideo&&z&&muteVideo(_e,B,z);break;case popUpStateEnum.muteMic:_e.hasAudio&&Vt&&muteAudio(_e,B,Vt);break;case popUpStateEnum.unmuteCamera:!_e.hasVideo&&z&&muteVideo(_e,B,z);break;case popUpStateEnum.unmuteMic:!_e.hasAudio&&Vt&&muteAudio(_e,B,Vt);break}_(popUpStateEnum.closed)},style:styles$3.button},"Confirm"),React.createElement("div",{style:styles$3.buttonClose,onClick:function(){return _(popUpStateEnum.closed)}},"Close"))):null}var styles$3={button:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},buttonClose:{color:"#fff",cursor:"pointer",borderWidth:2,borderStyle:"solid",borderColor:"#fff",padding:"2px 4px",borderRadius:4},container:{backgroundColor:"#007bffaa",position:"absolute",width:240,height:80,top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:100,display:"flex",flexDirection:"column",justifyContent:"space-evenly",alignItems:"center"}},AgoraUIKit=function s(o){var l=o.styleProps,p=o.rtcProps,_=l||{},A=_.UIKitContainer;return React.createElement(PropsProvider,{value:o},React.createElement("div",{style:_extends({},style$1,A)},p.role==="audience"?React.createElement(VideocallUI,null):React.createElement(TracksConfigure,null,React.createElement(VideocallUI,null))))},VideocallUI=function s(){var o=reactExports.useContext(PropsContext),l=o.rtcProps;return React.createElement(RtcConfigure,{callActive:l.callActive},React.createElement(LocalUserContext,null,l.disableRtm?React.createElement(React.Fragment,null,(l==null?void 0:l.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null)):React.createElement(RtmConfigure,null,React.createElement(PopUp,null),(l==null?void 0:l.layout)===layout.grid?React.createElement(GridVideo,null):React.createElement(PinnedVideo,null),React.createElement(LocalControls,null))))},style$1={display:"flex",flex:1,minHeight:0,flexDirection:"column"};const AGORA_APP_ID="e7f6e9aeecf14b2ba10e3f40be9f56e7",VideoCallModal=({isOpen:s,onClose:o,sessionId:l="default-session",sessionTitle:p="Sesión de Terapia",participants:_=[]})=>{const[A,k]=reactExports.useState(!1),[j,B]=reactExports.useState(!1),[z,Vt]=reactExports.useState(!1),[_e,_n]=reactExports.useState(l),_o={appId:AGORA_APP_ID,channel:_e,token:null},_c={EndCall:()=>{console.log("🔴 Llamada finalizada"),k(!1),o()}};reactExports.useEffect(()=>{_n(l)},[l]);const _d=()=>{console.log("📞 Uniéndose a la llamada:",_e),k(!0)},_h=()=>{console.log("📞 Saliendo de la llamada"),k(!1),o()},_p=()=>{B(!j),console.log("🎤",j?"Desmuteado":"Muteado")},_f=()=>{Vt(!z),console.log("📹",z?"Video encendido":"Video apagado")};return jsxRuntimeExports.jsx(AnimatePresence,{children:s&&jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 flex items-center justify-center bg-black/80",children:jsxRuntimeExports.jsxs(motion.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.9,opacity:0},className:"relative w-full max-w-6xl h-full max-h-[90vh] bg-white rounded-xl shadow-2xl overflow-hidden",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-primary-600 to-secondary-600 text-white",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-3",children:[jsxRuntimeExports.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),jsxRuntimeExports.jsx("h2",{className:"text-lg font-semibold",children:p}),jsxRuntimeExports.jsxs("span",{className:"text-sm opacity-80",children:["Sala: ",_e]})]}),jsxRuntimeExports.jsx("button",{onClick:o,className:"p-2 hover:bg-white/20 rounded-lg transition-colors",children:jsxRuntimeExports.jsx(X,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsx("div",{className:"flex-1 h-full",children:A?jsxRuntimeExports.jsxs("div",{className:"relative h-full",children:[jsxRuntimeExports.jsx("div",{className:"h-full",children:jsxRuntimeExports.jsx(AgoraUIKit,{rtcProps:_o,callbacks:_c})}),jsxRuntimeExports.jsxs("div",{className:"absolute bottom-4 left-1/2 transform -translate-x-1/2 flex items-center space-x-4 bg-black/50 backdrop-blur-sm rounded-full px-6 py-3",children:[jsxRuntimeExports.jsx("button",{onClick:_p,className:`p-3 rounded-full transition-colors ${j?"bg-red-500 text-white":"bg-white/20 text-white hover:bg-white/30"}`,children:j?jsxRuntimeExports.jsx(MicOff,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Mic,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("button",{onClick:_f,className:`p-3 rounded-full transition-colors ${z?"bg-red-500 text-white":"bg-white/20 text-white hover:bg-white/30"}`,children:z?jsxRuntimeExports.jsx(VideoOff,{className:"w-5 h-5"}):jsxRuntimeExports.jsx(Video,{className:"w-5 h-5"})}),jsxRuntimeExports.jsx("button",{onClick:_h,className:"p-3 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors",children:jsxRuntimeExports.jsx(PhoneOff,{className:"w-5 h-5"})})]}),jsxRuntimeExports.jsx("div",{className:"absolute top-4 right-4 bg-black/50 backdrop-blur-sm rounded-lg px-3 py-2",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-2 text-white text-sm",children:[jsxRuntimeExports.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),jsxRuntimeExports.jsx("span",{children:"Conectado"})]})})]}):jsxRuntimeExports.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-8 bg-gradient-to-br from-gray-50 to-gray-100",children:[jsxRuntimeExports.jsxs("div",{className:"text-center mb-8",children:[jsxRuntimeExports.jsx("div",{className:"w-20 h-20 bg-primary-100 rounded-full flex items-center justify-center mx-auto mb-4",children:jsxRuntimeExports.jsx(Phone,{className:"w-10 h-10 text-primary-600"})}),jsxRuntimeExports.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:p}),jsxRuntimeExports.jsx("p",{className:"text-gray-600 mb-6",children:"Sala de videollamada para terapia del habla"}),_.length>0&&jsxRuntimeExports.jsxs("div",{className:"mb-6",children:[jsxRuntimeExports.jsx("h4",{className:"text-sm font-medium text-gray-700 mb-2",children:"Participantes:"}),jsxRuntimeExports.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:_.map(e_=>jsxRuntimeExports.jsxs("span",{className:"px-3 py-1 bg-white rounded-full text-sm border border-gray-200",children:[e_.name," (",e_.role,")"]},e_.id))})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-lg p-4 mb-6 border border-gray-200",children:[jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:[jsxRuntimeExports.jsx("strong",{children:"Sala:"})," ",_e]}),jsxRuntimeExports.jsxs("p",{className:"text-sm text-gray-600",children:[jsxRuntimeExports.jsx("strong",{children:"Estado:"})," Esperando participantes"]})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-4",children:[jsxRuntimeExports.jsxs("button",{onClick:_d,className:"btn-primary flex items-center space-x-2",children:[jsxRuntimeExports.jsx(Phone,{className:"w-4 h-4"}),jsxRuntimeExports.jsx("span",{children:"Unirse a la Llamada"})]}),jsxRuntimeExports.jsx("button",{onClick:o,className:"btn-outline",children:"Cancelar"})]})]})})]})})})},mockStats={totalSessions:24,activeSessions:2,totalStudents:8,gamesPlayed:156,averageAccuracy:87,totalTime:48},mockRecentSessions=[{id:"1",studentName:"María González",date:"2024-01-15",duration:"45 min",accuracy:92,status:"completed"},{id:"2",studentName:"Carlos Rodríguez",date:"2024-01-14",duration:"30 min",accuracy:78,status:"completed"},{id:"3",studentName:"Ana Martínez",date:"2024-01-13",duration:"60 min",accuracy:85,status:"completed"}],mockUpcomingSessions=[{id:"1",studentName:"Luis Pérez",date:"2024-01-16",time:"10:00 AM",type:"Terapia del Habla"},{id:"2",studentName:"Sofia López",date:"2024-01-16",time:"2:00 PM",type:"Juego Interactivo"},{id:"3",studentName:"Diego Silva",date:"2024-01-17",time:"9:00 AM",type:"Evaluación"}],Dashboard=()=>{useUserRole();const s=useProfileInfo(),{token:o}=useAuthStore(),[l,p]=reactExports.useState(mockStats),[_,A]=reactExports.useState(mockRecentSessions),[k,j]=reactExports.useState(mockUpcomingSessions),[B,z]=reactExports.useState(!0),[Vt,_e]=reactExports.useState(null),[_n,_o]=reactExports.useState(!1),[_c,_d]=reactExports.useState(!1),_h=async()=>{if(o)try{z(!0);const u_=await fetch("/api/dashboard/stats",{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(u_.ok){const y_=await u_.json();p(y_.data)}const w_=await fetch("/api/dashboard/recent-sessions",{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(w_.ok){const y_=await w_.json();A(y_.data)}const O_=await fetch("/api/dashboard/upcoming-sessions",{headers:{Authorization:`Bearer ${o}`,"Content-Type":"application/json"}});if(O_.ok){const y_=await O_.json();j(y_.data)}}catch(u_){console.error("Error cargando datos del dashboard:",u_),_e("Error cargando datos del dashboard. Usando datos de ejemplo.")}finally{z(!1)}};reactExports.useEffect(()=>{_h()},[o]);const _p=u_=>{switch(u_){case"completed":return"bg-success-100 text-success-800";case"active":return"bg-primary-100 text-primary-800";case"scheduled":return"bg-warning-100 text-warning-800";default:return"bg-gray-100 text-gray-800"}},_f=u_=>{switch(u_){case"completed":return"Completada";case"active":return"Activa";case"scheduled":return"Programada";default:return"Desconocido"}},e_=u_=>new Date(u_).toLocaleDateString("es-ES",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return B?jsxRuntimeExports.jsx("div",{className:"flex items-center justify-center min-h-screen",children:jsxRuntimeExports.jsxs("div",{className:"text-center",children:[jsxRuntimeExports.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600 mx-auto mb-4"}),jsxRuntimeExports.jsx("p",{className:"text-gray-600",children:"Cargando dashboard..."})]})}):jsxRuntimeExports.jsxs("div",{className:"space-y-6",children:[Vt&&jsxRuntimeExports.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:jsxRuntimeExports.jsxs("div",{className:"flex",children:[jsxRuntimeExports.jsx("div",{className:"flex-shrink-0",children:jsxRuntimeExports.jsx("svg",{className:"h-5 w-5 text-yellow-400",viewBox:"0 0 20 20",fill:"currentColor",children:jsxRuntimeExports.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),jsxRuntimeExports.jsx("div",{className:"ml-3",children:jsxRuntimeExports.jsx("p",{className:"text-sm text-yellow-700",children:Vt})})]})}),jsxRuntimeExports.jsx(motion.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"bg-white rounded-xl shadow-soft p-6",children:jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"¡Bienvenido de vuelta!"}),jsxRuntimeExports.jsxs("p",{className:"text-gray-600 mt-2",children:[(s==null?void 0:s.title)||"Usuario"," • ",(s==null?void 0:s.type)||"Rol"]})]}),jsxRuntimeExports.jsxs("div",{className:"flex space-x-3",children:[jsxRuntimeExports.jsxs("button",{className:"btn-primary",onClick:()=>{console.log("🔘 Botón Nueva Sesión del Dashboard clickeado"),_o(!0)},children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-2"}),"Nueva Sesión"]}),jsxRuntimeExports.jsxs("button",{className:"btn-secondary",onClick:()=>{console.log("📞 Botón Iniciar Llamada clickeado"),_d(!0)},children:[jsxRuntimeExports.jsx(Video,{className:"w-4 h-4 mr-2"}),"Iniciar Llamada"]})]})]})}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6 border-l-4 border-primary-500",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Total Sesiones"}),jsxRuntimeExports.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l.totalSessions})]}),jsxRuntimeExports.jsx("div",{className:"p-3 bg-primary-100 rounded-full",children:jsxRuntimeExports.jsx(Calendar,{className:"w-6 h-6 text-primary-600"})})]}),jsxRuntimeExports.jsxs("div",{className:"mt-4 flex items-center text-sm text-gray-600",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-4 h-4 mr-1 text-success-500"}),jsxRuntimeExports.jsx("span",{children:"+12% este mes"})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6 border-l-4 border-success-500",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Sesiones Activas"}),jsxRuntimeExports.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l.activeSessions})]}),jsxRuntimeExports.jsx("div",{className:"p-3 bg-success-100 rounded-full",children:jsxRuntimeExports.jsx(Video,{className:"w-6 h-6 text-success-600"})})]}),jsxRuntimeExports.jsxs("div",{className:"mt-4 flex items-center text-sm text-gray-600",children:[jsxRuntimeExports.jsx(Clock,{className:"w-4 h-4 mr-1 text-success-500"}),jsxRuntimeExports.jsx("span",{children:"En tiempo real"})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6 border-l-4 border-secondary-500",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Estudiantes"}),jsxRuntimeExports.jsx("p",{className:"text-3xl font-bold text-gray-900",children:l.totalStudents})]}),jsxRuntimeExports.jsx("div",{className:"p-3 bg-secondary-100 rounded-full",children:jsxRuntimeExports.jsx(Users,{className:"w-6 h-6 text-secondary-600"})})]}),jsxRuntimeExports.jsxs("div",{className:"mt-4 flex items-center text-sm text-gray-600",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-4 h-4 mr-1 text-success-500"}),jsxRuntimeExports.jsx("span",{children:"+2 este mes"})]})]}),jsxRuntimeExports.jsxs("div",{className:"bg-white rounded-xl shadow-soft p-6 border-l-4 border-warning-500",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between",children:[jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Precisión Promedio"}),jsxRuntimeExports.jsxs("p",{className:"text-3xl font-bold text-gray-900",children:[l.averageAccuracy,"%"]})]}),jsxRuntimeExports.jsx("div",{className:"p-3 bg-warning-100 rounded-full",children:jsxRuntimeExports.jsx(Award,{className:"w-6 h-6 text-warning-600"})})]}),jsxRuntimeExports.jsxs("div",{className:"mt-4 flex items-center text-sm text-gray-600",children:[jsxRuntimeExports.jsx(TrendingUp,{className:"w-4 h-4 mr-1 text-success-500"}),jsxRuntimeExports.jsx("span",{children:"+5% este mes"})]})]})]}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.2},className:"lg:col-span-2 bg-white rounded-xl shadow-soft p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Sesiones Recientes"}),jsxRuntimeExports.jsxs("button",{className:"text-primary-600 hover:text-primary-700 font-medium text-sm flex items-center",children:["Ver todas",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4 ml-1"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:_.map((u_,w_)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1*w_},className:"flex items-center justify-between p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-full flex items-center justify-center",children:jsxRuntimeExports.jsx(Users,{className:"w-5 h-5 text-primary-600"})}),jsxRuntimeExports.jsxs("div",{children:[jsxRuntimeExports.jsx("p",{className:"font-medium text-gray-900",children:u_.studentName}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:e_(u_.date)})]})]}),jsxRuntimeExports.jsxs("div",{className:"flex items-center space-x-4",children:[jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:"Duración"}),jsxRuntimeExports.jsx("p",{className:"font-medium text-gray-900",children:u_.duration})]}),jsxRuntimeExports.jsxs("div",{className:"text-right",children:[jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-500",children:"Precisión"}),jsxRuntimeExports.jsxs("p",{className:"font-medium text-gray-900",children:[u_.accuracy,"%"]})]}),jsxRuntimeExports.jsx("span",{className:`px-3 py-1 rounded-full text-xs font-medium ${_p(u_.status)}`,children:_f(u_.status)})]})]},u_.id))})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.5,delay:.3},className:"bg-white rounded-xl shadow-soft p-6",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Próximas Sesiones"}),jsxRuntimeExports.jsxs("button",{className:"text-primary-600 hover:text-primary-700 font-medium text-sm flex items-center",children:["Ver todas",jsxRuntimeExports.jsx(ArrowRight,{className:"w-4 h-4 ml-1"})]})]}),jsxRuntimeExports.jsx("div",{className:"space-y-4",children:k.map((u_,w_)=>jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1*w_},className:"p-4 bg-gray-50 rounded-lg hover:bg-gray-100 transition-colors duration-200",children:[jsxRuntimeExports.jsxs("div",{className:"flex items-center justify-between mb-2",children:[jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-900",children:u_.studentName}),jsxRuntimeExports.jsx("span",{className:"text-xs text-gray-500",children:u_.time})]}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600 mb-2",children:u_.type}),jsxRuntimeExports.jsx("p",{className:"text-xs text-gray-500",children:e_(u_.date)})]},u_.id))}),jsxRuntimeExports.jsxs("button",{className:"w-full mt-4 btn-outline",children:[jsxRuntimeExports.jsx(Plus,{className:"w-4 h-4 mr-2"}),"Programar Sesión"]})]})]}),jsxRuntimeExports.jsxs(motion.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"bg-white rounded-xl shadow-soft p-6",children:[jsxRuntimeExports.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Acciones Rápidas"}),jsxRuntimeExports.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[jsxRuntimeExports.jsxs("button",{className:"p-4 bg-primary-50 rounded-lg hover:bg-primary-100 transition-colors duration-200 text-left",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-primary-100 rounded-lg flex items-center justify-center mb-3",children:jsxRuntimeExports.jsx(Video,{className:"w-5 h-5 text-primary-600"})}),jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-900",children:"Iniciar Sesión"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Comenzar terapia virtual"})]}),jsxRuntimeExports.jsxs("button",{className:"p-4 bg-success-50 rounded-lg hover:bg-success-100 transition-colors duration-200 text-left",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-success-100 rounded-lg flex items-center justify-center mb-3",children:jsxRuntimeExports.jsx(Gamepad2,{className:"w-5 h-5 text-success-600"})}),jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-900",children:"Crear Juego"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Diseñar actividad interactiva"})]}),jsxRuntimeExports.jsxs("button",{className:"p-4 bg-secondary-50 rounded-lg hover:bg-secondary-100 transition-colors duration-200 text-left",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-secondary-100 rounded-lg flex items-center justify-center mb-3",children:jsxRuntimeExports.jsx(Users,{className:"w-5 h-5 text-secondary-600"})}),jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-900",children:"Agregar Estudiante"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Registrar nuevo paciente"})]}),jsxRuntimeExports.jsxs("button",{className:"p-4 bg-warning-50 rounded-lg hover:bg-warning-100 transition-colors duration-200 text-left",children:[jsxRuntimeExports.jsx("div",{className:"w-10 h-10 bg-warning-100 rounded-lg flex items-center justify-center mb-3",children:jsxRuntimeExports.jsx(BarChart3,{className:"w-5 h-5 text-warning-600"})}),jsxRuntimeExports.jsx("h3",{className:"font-medium text-gray-900",children:"Ver Reportes"}),jsxRuntimeExports.jsx("p",{className:"text-sm text-gray-600",children:"Analizar progreso"})]})]})]}),jsxRuntimeExports.jsx(CreateSessionModal,{isOpen:_n,onClose:()=>_o(!1),onSuccess:()=>{_h(),_o(!1)}}),jsxRuntimeExports.jsx(VideoCallModal,{isOpen:_c,onClose:()=>_d(!1),sessionId:`session-${Date.now()}`,sessionTitle:"Sesión de Terapia Virtual",participants:[{id:"1",name:(s==null?void 0:s.title)||"Terapeuta",role:"slp"},{id:"2",name:"Estudiante",role:"child"}]})]})};export{Dashboard as default};
//# sourceMappingURL=Dashboard-Bb_EGjsc.js.map
