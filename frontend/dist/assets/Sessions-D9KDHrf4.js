import{u as L,j as e}from"./index-67lOYeQn.js";import{r as l}from"./vendor-CytKP1XG.js";import{C as q}from"./CreateSessionModal-c5Wfvj6q.js";import{A as F,m as x,g as k,X as I,J as G,I as J,K as U,F as R,N as H,O as K,D as A,S as Q,Q as W,R as X,W as Y,P as V,Y as Z,_ as ee,$ as se,e as ae,d as te}from"./ui-B9NvKoMF.js";import"./router-RO4D7ex0.js";import"./charts-DqeNaFAB.js";const re=({isOpen:i,onClose:c,onSuccess:w,session:r})=>{const{token:f}=L(),[S,C]=l.useState(!1),[N,m]=l.useState(null),[t,u]=l.useState({scheduledDate:"",duration:45,sessionType:"therapy",notes:"",goals:[]}),[h,j]=l.useState("");l.useEffect(()=>{i&&r&&(u({scheduledDate:r.scheduledDate.split("T")[0],duration:r.duration||45,sessionType:r.sessionType,notes:r.notes||"",goals:[...r.goals||[]]}),j(""),m(null))},[i,r]);const p=(a,n)=>{u(d=>({...d,[a]:n}))},y=()=>{h.trim()&&!t.goals.includes(h.trim())&&(u(a=>({...a,goals:[...a.goals||[],h.trim()]})),j(""))},T=a=>{u(n=>({...n,goals:n.goals.filter(d=>d!==a)}))},g=async a=>{var n;if(a.preventDefault(),!(!f||!r)){if(!t.scheduledDate){m("Debes seleccionar una fecha");return}if(t.duration<15||t.duration>180){m("La duración debe estar entre 15 y 180 minutos");return}try{C(!0),m(null);const d=await fetch(`/api/sessions/${r._id}`,{method:"PUT",headers:{Authorization:`Bearer ${f}`,"Content-Type":"application/json"},body:JSON.stringify(t)});if(d.ok)w(),c();else{const v=await d.json();m(((n=v.error)==null?void 0:n.message)||"Error al actualizar la sesión")}}catch{m("Error de conexión")}finally{C(!1)}}};return r?e.jsx(F,{children:i&&e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx(x.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:c}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(x.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-6 w-6 text-blue-600 mr-3"}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Editar Sesión"}),e.jsxs("p",{className:"text-sm text-gray-500",children:[r.childId.firstName," ",r.childId.lastName]})]})]}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-500 p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(I,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:g,className:"p-6 space-y-6",children:[N&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-red-800 text-sm flex items-center",children:[e.jsx(G,{className:"h-4 w-4 mr-2"}),N]})}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:"Información del Sistema"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Estudiante:"}),e.jsxs("p",{className:"font-medium",children:[r.childId.firstName," ",r.childId.lastName]})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Estado:"}),e.jsx("p",{className:"font-medium capitalize",children:r.status})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"ID de Sesión:"}),e.jsx("p",{className:"font-medium text-xs",children:r._id})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-500",children:"Juegos jugados:"}),e.jsx("p",{className:"font-medium",children:r.gamesPlayed||0})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(k,{className:"h-5 w-5 mr-2"}),"Detalles de la Sesión"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(k,{className:"h-4 w-4 inline mr-1"}),"Fecha *"]}),e.jsx("input",{type:"date",value:t.scheduledDate,onChange:a=>p("scheduledDate",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(J,{className:"h-4 w-4 inline mr-1"}),"Duración (minutos) *"]}),e.jsx("input",{type:"number",min:"15",max:"180",value:t.duration,onChange:a=>p("duration",parseInt(a.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Sesión"}),e.jsxs("select",{value:t.sessionType,onChange:a=>p("sessionType",a.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"therapy",children:"Terapia"}),e.jsx("option",{value:"evaluation",children:"Evaluación"}),e.jsx("option",{value:"game",children:"Juego"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:[e.jsx(U,{className:"h-5 w-5 inline mr-2"}),"Objetivos de la Sesión"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:h,onChange:a=>j(a.target.value),onKeyPress:a=>a.key==="Enter"&&(a.preventDefault(),y()),placeholder:"Escribir objetivo y presionar Enter",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("button",{type:"button",onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Agregar"})]}),t.goals&&t.goals.length>0&&e.jsx("div",{className:"space-y-2",children:t.goals.map((a,n)=>e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 px-3 py-2 rounded-lg",children:[e.jsx("span",{className:"text-sm text-blue-900",children:a}),e.jsx("button",{type:"button",onClick:()=>T(a),className:"text-blue-600 hover:text-blue-800 p-1",children:e.jsx(I,{className:"h-4 w-4"})})]},n))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(R,{className:"h-4 w-4 inline mr-1"}),"Notas Adicionales"]}),e.jsx("textarea",{value:t.notes,onChange:a=>p("notes",a.target.value),rows:3,placeholder:"Notas o comentarios sobre la sesión",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:S,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:S?e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"h-4 w-4 animate-spin"}),"Guardando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(K,{className:"h-4 w-4"}),"Guardar Cambios"]})})]})]})]})})]})}):null},ue=()=>{const{user:i,token:c}=L(),[w,r]=l.useState([]),[f,S]=l.useState([]),[C,N]=l.useState(!0),[m,t]=l.useState(null),[u,h]=l.useState(!1),[j,p]=l.useState(null),[y,T]=l.useState("all"),[g,a]=l.useState(""),[n,d]=l.useState(1),[v]=l.useState(10),b=async()=>{if(c)try{N(!0);const s=await fetch("/api/sessions",{headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}});if(s.ok){const o=await s.json();r(o.data.sessions||[])}else t("Error al cargar las sesiones")}catch{t("Error de conexión")}finally{N(!1)}};l.useEffect(()=>{let s=w;y!=="all"&&(s=s.filter(o=>o.status===y)),g&&(s=s.filter(o=>o.childId.firstName.toLowerCase().includes(g.toLowerCase())||o.childId.lastName.toLowerCase().includes(g.toLowerCase())||o.sessionType.toLowerCase().includes(g.toLowerCase()))),S(s),d(1)},[w,y,g]),l.useEffect(()=>{b()},[c]),l.useEffect(()=>{console.log("🎭 Estado showCreateModal cambiado:",u)},[u]),l.useEffect(()=>{console.log("👤 Usuario actual:",i),console.log("🎯 Rol del usuario:",i==null?void 0:i.role)},[i]);const D=(n-1)*v,M=D+v,P=f.slice(D,M),E=Math.ceil(f.length/v),z=async s=>{if(c)try{(await fetch(`/api/sessions/${s}/start`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}})).ok?b():t("Error al iniciar la sesión")}catch{t("Error de conexión")}},B=async s=>{if(c)try{(await fetch(`/api/sessions/${s}/end`,{method:"POST",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"},body:JSON.stringify({notes:"Sesión completada",gamesPlayed:0,accuracy:0})})).ok?b():t("Error al finalizar la sesión")}catch{t("Error de conexión")}},_=async s=>{if(!(!c||!confirm("¿Estás seguro de que quieres eliminar esta sesión?")))try{(await fetch(`/api/sessions/${s}`,{method:"DELETE",headers:{Authorization:`Bearer ${c}`,"Content-Type":"application/json"}})).ok?b():t("Error al eliminar la sesión")}catch{t("Error de conexión")}},$=s=>{switch(s){case"scheduled":return"bg-blue-100 text-blue-800";case"in_progress":return"bg-green-100 text-green-800";case"completed":return"bg-gray-100 text-gray-800";case"cancelled":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},O=s=>{switch(s){case"scheduled":return"Programada";case"in_progress":return"En Progreso";case"completed":return"Completada";case"cancelled":return"Cancelada";default:return s}};return C?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Cargando sesiones..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-6",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx(x.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Gestión de Sesiones"}),e.jsx("p",{className:"text-gray-600",children:"Administra todas las sesiones de terapia"})]}),e.jsxs(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{console.log("🔘 Botón Nueva Sesión clickeado"),console.log("👤 Usuario:",i),console.log("🎯 Estado showCreateModal antes:",u),h(!0),console.log("🎯 Estado showCreateModal después:",!0),alert("¡Botón clickeado! Modal debería abrirse.")},className:"bg-red-600 hover:bg-red-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors duration-200 text-lg font-bold",children:[e.jsx(A,{className:"h-6 w-6"}),"🚨 BOTÓN DE PRUEBA 🚨"]}),(i==null?void 0:i.role)==="slp"&&e.jsxs(x.button,{whileHover:{scale:1.05},whileTap:{scale:.95},onClick:()=>{console.log("🔘 Botón Nueva Sesión clickeado"),console.log("👤 Usuario:",i),console.log("🎯 Estado showCreateModal antes:",u),h(!0),console.log("🎯 Estado showCreateModal después:",!0)},className:"bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg flex items-center gap-2 transition-colors duration-200",children:[e.jsx(A,{className:"h-5 w-5"}),"Nueva Sesión (SLP)"]})]})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white rounded-xl shadow-sm p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Q,{className:"h-5 w-5 absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar por estudiante o tipo de sesión...",value:g,onChange:s=>a(s.target.value),className:"w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:"h-5 w-5 text-gray-400"}),e.jsxs("select",{value:y,onChange:s=>T(s.target.value),className:"border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"all",children:"Todos los estados"}),e.jsx("option",{value:"scheduled",children:"Programadas"}),e.jsx("option",{value:"in_progress",children:"En Progreso"}),e.jsx("option",{value:"completed",children:"Completadas"}),e.jsx("option",{value:"cancelled",children:"Canceladas"})]})]})]})}),m&&e.jsx(x.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:e.jsx("p",{className:"text-red-800",children:m})}),e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white rounded-xl shadow-sm overflow-hidden",children:P.length===0?e.jsxs("div",{className:"p-12 text-center",children:[e.jsx(X,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No hay sesiones"}),e.jsx("p",{className:"text-gray-600",children:g||y!=="all"?"No se encontraron sesiones con los filtros aplicados":"Aún no has creado ninguna sesión"})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"bg-gray-50 px-6 py-3 border-b border-gray-200",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-6 gap-4 text-sm font-medium text-gray-500 uppercase tracking-wider",children:[e.jsx("div",{children:"Estudiante"}),e.jsx("div",{children:"Fecha y Hora"}),e.jsx("div",{children:"Tipo"}),e.jsx("div",{children:"Estado"}),e.jsx("div",{children:"Duración"}),e.jsx("div",{children:"Acciones"})]})}),e.jsx("div",{className:"divide-y divide-gray-200",children:e.jsx(F,{children:P.map((s,o)=>e.jsx(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:o*.05},className:"px-6 py-4 hover:bg-gray-50 transition-colors duration-150",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-6 gap-4 items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"h-8 w-8 bg-blue-100 rounded-full flex items-center justify-center mr-3",children:e.jsx(Y,{className:"h-4 w-4 text-blue-600"})}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm font-medium text-gray-900",children:[s.childId.firstName," ",s.childId.lastName]})})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-900",children:new Date(s.scheduledDate).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"numeric"})}),e.jsx("p",{className:"text-sm text-gray-500",children:new Date(s.scheduledDate).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-indigo-100 text-indigo-800",children:s.sessionType==="therapy"?"Terapia":s.sessionType==="evaluation"?"Evaluación":"Juego"})}),e.jsx("div",{children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${$(s.status)}`,children:O(s.status)})}),e.jsx("div",{children:e.jsxs("p",{className:"text-sm text-gray-900",children:[s.duration||45," min"]})}),(i==null?void 0:i.role)==="slp"&&e.jsxs("div",{className:"flex items-center gap-2",children:[s.status==="scheduled"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>z(s._id),className:"p-2 text-green-600 hover:bg-green-100 rounded-lg transition-colors duration-150",title:"Iniciar sesión",children:e.jsx(V,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>p(s),className:"p-2 text-blue-600 hover:bg-blue-100 rounded-lg transition-colors duration-150",title:"Editar sesión",children:e.jsx(Z,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>_(s._id),className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors duration-150",title:"Eliminar sesión",children:e.jsx(ee,{className:"h-4 w-4"})})]}),s.status==="in_progress"&&e.jsx("button",{onClick:()=>B(s._id),className:"p-2 text-red-600 hover:bg-red-100 rounded-lg transition-colors duration-150",title:"Finalizar sesión",children:e.jsx(se,{className:"h-4 w-4"})})]})]})},s._id))})})]})}),E>1&&e.jsx(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.3},className:"mt-6 flex justify-center",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>d(Math.max(1,n-1)),disabled:n===1,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(ae,{className:"h-4 w-4"})}),e.jsxs("span",{className:"px-4 py-2 text-sm text-gray-700",children:["Página ",n," de ",E]}),e.jsx("button",{onClick:()=>d(Math.min(E,n+1)),disabled:n===E,className:"p-2 rounded-lg border border-gray-300 disabled:opacity-50 disabled:cursor-not-allowed hover:bg-gray-50",children:e.jsx(te,{className:"h-4 w-4"})})]})})]}),e.jsx(q,{isOpen:u,onClose:()=>h(!1),onSuccess:()=>{b(),h(!1)}}),e.jsx(re,{isOpen:!!j,onClose:()=>p(null),onSuccess:()=>{b(),p(null)},session:j})]})};export{ue as default};
//# sourceMappingURL=Sessions-D9KDHrf4.js.map
