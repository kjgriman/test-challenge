import{u as A,j as e}from"./index-67lOYeQn.js";import{r as l}from"./vendor-CytKP1XG.js";import{A as F,m as y,g as j,X as N,J as z,h as L,N as v,I as q,K as G,F as J,O as P}from"./ui-B9NvKoMF.js";const O=({isOpen:o,onClose:c,onSuccess:w})=>{console.log("🎭 CreateSessionModal renderizado"),console.log("🎭 isOpen:",o);const{token:d}=A(),[h,g]=l.useState(!1),[p,r]=l.useState(null),[S,C]=l.useState([]),[k,b]=l.useState(!1),[a,u]=l.useState({childId:"",scheduledDate:"",duration:45,sessionType:"therapy",notes:"",goals:[]}),[m,x]=l.useState(""),D=async()=>{if(d)try{b(!0);const s=await fetch("/api/students",{headers:{Authorization:`Bearer ${d}`}});if(s.ok){const t=await s.json();C(t.data.students||[])}}catch(s){console.error("Error cargando estudiantes:",s)}finally{b(!1)}};l.useEffect(()=>{o&&(u({childId:"",scheduledDate:"",duration:45,sessionType:"therapy",notes:"",goals:[]}),x(""),r(null),D())},[o]);const i=(s,t)=>{u(n=>({...n,[s]:t}))},f=()=>{m.trim()&&!a.goals.includes(m.trim())&&(u(s=>({...s,goals:[...s.goals||[],m.trim()]})),x(""))},E=s=>{u(t=>({...t,goals:t.goals.filter(n=>n!==s)}))},I=async s=>{var t;if(s.preventDefault(),!!d){if(!a.childId){r("Debes seleccionar un estudiante");return}if(!a.scheduledDate){r("Debes seleccionar una fecha");return}if(a.duration<15||a.duration>180){r("La duración debe estar entre 15 y 180 minutos");return}try{g(!0),r(null);const n=await fetch("/api/sessions",{method:"POST",headers:{Authorization:`Bearer ${d}`,"Content-Type":"application/json"},body:JSON.stringify(a)});if(n.ok)w(),c();else{const T=await n.json();r(((t=T.error)==null?void 0:t.message)||"Error al crear la sesión")}}catch{r("Error de conexión")}finally{g(!1)}}};return e.jsx(F,{children:o&&e.jsxs("div",{className:"fixed inset-0 z-50 overflow-y-auto",children:[e.jsx(y.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 bg-black bg-opacity-50 transition-opacity",onClick:c}),e.jsx("div",{className:"flex min-h-full items-center justify-center p-4",children:e.jsxs(y.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},exit:{opacity:0,scale:.95},className:"bg-white rounded-xl shadow-xl max-w-2xl w-full max-h-[90vh] overflow-y-auto",children:[e.jsxs("div",{className:"flex items-center justify-between p-6 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(j,{className:"h-6 w-6 text-blue-600 mr-3"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Nueva Sesión"})]}),e.jsx("button",{onClick:c,className:"text-gray-400 hover:text-gray-500 p-2 hover:bg-gray-100 rounded-lg transition-colors",children:e.jsx(N,{className:"h-5 w-5"})})]}),e.jsxs("form",{onSubmit:I,className:"p-6 space-y-6",children:[p&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:e.jsxs("p",{className:"text-red-800 text-sm flex items-center",children:[e.jsx(z,{className:"h-4 w-4 mr-2"}),p]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2"}),"Información de la Sesión"]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estudiante *"}),k?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx(v,{className:"h-4 w-4 animate-spin mr-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Cargando estudiantes..."})]}):e.jsxs("select",{value:a.childId,onChange:s=>i("childId",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0,children:[e.jsx("option",{value:"",children:"Seleccionar estudiante"}),S.map(s=>e.jsxs("option",{value:s._id,children:[s.firstName," ",s.lastName," (",s.email,")"]},s._id))]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(j,{className:"h-4 w-4 inline mr-1"}),"Fecha *"]}),e.jsx("input",{type:"date",value:a.scheduledDate,onChange:s=>i("scheduledDate",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(q,{className:"h-4 w-4 inline mr-1"}),"Duración (minutos) *"]}),e.jsx("input",{type:"number",min:"15",max:"180",value:a.duration,onChange:s=>i("duration",parseInt(s.target.value)),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",required:!0})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Tipo de Sesión"}),e.jsxs("select",{value:a.sessionType,onChange:s=>i("sessionType",s.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"therapy",children:"Terapia"}),e.jsx("option",{value:"evaluation",children:"Evaluación"}),e.jsx("option",{value:"game",children:"Juego"})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900",children:[e.jsx(G,{className:"h-5 w-5 inline mr-2"}),"Objetivos de la Sesión"]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("input",{type:"text",value:m,onChange:s=>x(s.target.value),onKeyPress:s=>s.key==="Enter"&&(s.preventDefault(),f()),placeholder:"Escribir objetivo y presionar Enter",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"}),e.jsx("button",{type:"button",onClick:f,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:"Agregar"})]}),a.goals&&a.goals.length>0&&e.jsx("div",{className:"space-y-2",children:a.goals.map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between bg-blue-50 px-3 py-2 rounded-lg",children:[e.jsx("span",{className:"text-sm text-blue-900",children:s}),e.jsx("button",{type:"button",onClick:()=>E(s),className:"text-blue-600 hover:text-blue-800 p-1",children:e.jsx(N,{className:"h-4 w-4"})})]},t))})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:[e.jsx(J,{className:"h-4 w-4 inline mr-1"}),"Notas Adicionales"]}),e.jsx("textarea",{value:a.notes,onChange:s=>i("notes",s.target.value),rows:3,placeholder:"Notas o comentarios sobre la sesión (opcional)",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"})]}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-200",children:[e.jsx("button",{type:"button",onClick:c,className:"px-4 py-2 text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-lg transition-colors",children:"Cancelar"}),e.jsx("button",{type:"submit",disabled:h,className:"px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2",children:h?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"h-4 w-4 animate-spin"}),"Creando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{className:"h-4 w-4"}),"Crear Sesión"]})})]})]})]})})]})})};export{O as C};
//# sourceMappingURL=CreateSessionModal-c5Wfvj6q.js.map
